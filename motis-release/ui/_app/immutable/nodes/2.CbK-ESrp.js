import{b as IM,d as l0,a as Z,c as We,f as Fe,t as Br}from"../chunks/dfoeAPey.js";import{aJ as c0,aK as dE,aL as CM,j as On,N as ud,aM as fE,M as Td,aN as MT,R as pE,U as Gc,T as Jb,V as xa,Y as u0,ao as xp,I as hd,ab as ex,aO as RM,aj as MM,aP as kM,aQ as DM,a9 as OM,aR as gE,a4 as mE,h as h0,q as S,y as d0,Q as FM,k as Kl,ai as NM,aE as LM,i as Op,l as BM,aS as cy,aT as uy,b as Xh,aU as _E,aC as yE,d as vE,g as zM,aV as zv,e as Fp,aW as UM,aX as VM,ay as jM,aY as WM,aB as $M,aZ as HM,w as bE,a_ as ZM,O as XM,a$ as qM,b0 as xE,W as f0,A as Ms,b1 as GM,b2 as YM,b3 as KM,b4 as QM,b5 as JM,b6 as ek,b7 as tk,b8 as rk,b9 as nk,ba as ik,ae as p0,X as sk,bb as ok,ad as wt,bc as P_,v as pe,ah as Ql,_ as g0,$ as kr,u as tn,af as me,p as Tt,c as Ae,s as ve,bd as Ht,r as we,a as St,f as ue,be as m0,aH as hy,t as mt,aI as Sa,aG as hc,bf as ak,bg as lk,bh as ck,ac as ag,ap as Yr,a2 as I_}from"../chunks/Bxh0jIsv.js";import{i as uk,a as hk,c as dk,d as yu,n as fk,b as pk,e as gk,o as li,m as c_,u as u_,s as pt}from"../chunks/BOvMP_pS.js";import{B as _0,p as ae,r as hr,s as zr,l as C_}from"../chunks/DSDjCylQ.js";import{i as Ze,b as as,c as ar,_ as kT}from"../chunks/QYjMzVAS.js";import{S as mk,u as DT,v as jo,w as tx,r as wp,f as _k,x as OT,y as FT,z as yk,A as Nm,i as vk,B as bk,C as NT,n as xk,D as wk,E as Tk,q as Ot,t as wE,F as Sk,G as Ak,H as TE,I as rx,c as nx,J as Ek,K as Pk,L as Uv,M as Ik,N as Ck,O as Rk}from"../chunks/CiUS-Jn9.js";import{r as SE,a as ix}from"../chunks/BUbfTBxF.js";import{p as ri,i as dy}from"../chunks/BQfBOZq0.js";const Mk=[];function ps(r,e=!1,t=!1){return h_(r,new Map,"",Mk,null,t)}function h_(r,e,t,n,s=null,l=!1){if(typeof r=="object"&&r!==null){var c=e.get(r);if(c!==void 0)return c;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(c0(r)){var a=Array(r.length);e.set(r,a),s!==null&&e.set(s,a);for(var g=0;g<r.length;g+=1){var v=r[g];g in r&&(a[g]=h_(v,e,t,n,null,l))}return a}if(dE(r)===CM){a={},e.set(r,a),s!==null&&e.set(s,a);for(var w in r)a[w]=h_(r[w],e,t,n,null,l);return a}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function"&&!l)return h_(r.toJSON(),e,t,n,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}const LT=0,Vv=1;function Ja(r,e,t,n,s){On&&ud();var l=fE(),c=gE,a=l?hd(c):ex(c,!1,!1),g=l?hd(c):ex(c,!1,!1),v=new _0(r);Td(()=>{var w=e(),P=!1;let I=On&&MT(w)===(r.data===pE);if(I&&(Gc(Jb()),xa(!1)),MT(w)){var k=RM(),N=!1;const D=B=>{if(!P){N=!0,k(!1),MM.ensure(),On&&xa(!1);try{B()}finally{kM(),DM||OM()}}};w.then(B=>{D(()=>{xp(a,B),v.ensure(Vv,n&&(U=>n(U,a)))})},B=>{D(()=>{if(xp(g,B),v.ensure(Vv,s&&(U=>s(U,g))),!s)throw g.v})}),On?v.ensure(LT,t):u0(()=>{N||D(()=>{v.ensure(LT,t)})})}else xp(a,w),v.ensure(Vv,n&&(D=>n(D,a)));return I&&xa(!0),()=>{P=!0}})}function kk(r,e,t){On&&ud();var n=new _0(r),s=!fE();Td(()=>{var l=e();s&&l!==null&&typeof l=="object"&&(l={}),n.ensure(l,t)})}function di(r,e){return e}function Dk(r,e,t){for(var n=r.items,s=[],l=e.length,c=0;c<l;c++)WM(e[c].e,s,!0);var a=l>0&&s.length===0&&t!==null;if(a){var g=t.parentNode;$M(g),g.append(t),n.clear(),fa(r,e[0].prev,e[l-1].next)}HM(s,()=>{for(var v=0;v<l;v++){var w=e[v];a||(n.delete(w.k),fa(r,w.prev,w.next)),Fp(w.e,!a)}})}function xn(r,e,t,n,s,l=null){var c=r,a={flags:e,items:new Map,first:null},g=(e&_E)!==0;if(g){var v=r;c=On?Gc(mE(v)):v.appendChild(h0())}On&&ud();var w=null,P=!1,I=new Map,k=d0(()=>{var U=t();return c0(U)?U:U==null?[]:yE(U)}),N,D;function B(){Ok(D,N,a,I,c,s,e,n,t),l!==null&&(N.length===0?w?vE(w):w=Op(()=>l(c)):w!==null&&zM(w,()=>{w=null}))}Td(()=>{D??=bE,N=S(k);var U=N.length;if(P&&U===0)return;P=U===0;let V=!1;if(On){var L=FM(c)===pE;L!==(U===0)&&(c=Jb(),Gc(c),xa(!1),V=!0)}if(On){for(var $=null,te,G=0;G<U;G++){if(Kl.nodeType===NM&&Kl.data===LM){c=Kl,V=!0,xa(!1);break}var le=N[G],se=n(le,G);te=sx(Kl,a,$,null,le,se,G,s,e,t),a.items.set(se,te),$=te}U>0&&Gc(Jb())}if(On)U===0&&l&&(w=Op(()=>l(c)));else if(BM()){var oe=new Set,be=Xh;for(G=0;G<U;G+=1){le=N[G],se=n(le,G);var xe=a.items.get(se)??I.get(se);xe?(e&(cy|uy))!==0&&AE(xe,le,G,e):(te=sx(null,a,null,null,le,se,G,s,e,t,!0),I.set(se,te)),oe.add(se)}for(const[_e,Ne]of a.items)oe.has(_e)||be.skipped_effects.add(Ne.e);be.oncommit(B)}else B();V&&xa(!0),S(k)}),On&&(c=Kl)}function Ok(r,e,t,n,s,l,c,a,g){var v=(c&VM)!==0,w=(c&(cy|uy))!==0,P=e.length,I=t.items,k=t.first,N=k,D,B=null,U,V=[],L=[],$,te,G,le;if(v)for(le=0;le<P;le+=1)$=e[le],te=a($,le),G=I.get(te),G!==void 0&&(G.a?.measure(),(U??=new Set).add(G));for(le=0;le<P;le+=1){if($=e[le],te=a($,le),G=I.get(te),G===void 0){var se=n.get(te);if(se!==void 0){n.delete(te),I.set(te,se);var oe=B?B.next:N;fa(t,B,se),fa(t,se,oe),jv(se,oe,s),B=se}else{var be=N?N.e.nodes_start:s;B=sx(be,t,B,B===null?t.first:B.next,$,te,le,l,c,g)}I.set(te,B),V=[],L=[],N=B.next;continue}if(w&&AE(G,$,le,c),(G.e.f&zv)!==0&&(vE(G.e),v&&(G.a?.unfix(),(U??=new Set).delete(G))),G!==N){if(D!==void 0&&D.has(G)){if(V.length<L.length){var xe=L[0],_e;B=xe.prev;var Ne=V[0],fe=V[V.length-1];for(_e=0;_e<V.length;_e+=1)jv(V[_e],xe,s);for(_e=0;_e<L.length;_e+=1)D.delete(L[_e]);fa(t,Ne.prev,fe.next),fa(t,B,Ne),fa(t,fe,xe),N=xe,B=fe,le-=1,V=[],L=[]}else D.delete(G),jv(G,N,s),fa(t,G.prev,G.next),fa(t,G,B===null?t.first:B.next),fa(t,B,G),B=G;continue}for(V=[],L=[];N!==null&&N.k!==te;)(N.e.f&zv)===0&&(D??=new Set).add(N),L.push(N),N=N.next;if(N===null)continue;G=N}V.push(G),B=G,N=G.next}if(N!==null||D!==void 0){for(var Le=D===void 0?[]:yE(D);N!==null;)(N.e.f&zv)===0&&Le.push(N),N=N.next;var tt=Le.length;if(tt>0){var Ye=(c&_E)!==0&&P===0?s:null;if(v){for(le=0;le<tt;le+=1)Le[le].a?.measure();for(le=0;le<tt;le+=1)Le[le].a?.fix()}Dk(t,Le,Ye)}}v&&u0(()=>{if(U!==void 0)for(G of U)G.a?.apply()}),r.first=t.first&&t.first.e,r.last=B&&B.e;for(var rt of n.values())Fp(rt.e);n.clear()}function AE(r,e,t,n){(n&cy)!==0&&xp(r.v,e),(n&uy)!==0?xp(r.i,t):r.i=t}function sx(r,e,t,n,s,l,c,a,g,v,w){var P=(g&cy)!==0,I=(g&UM)===0,k=P?I?ex(s,!1,!1):hd(s):s,N=(g&uy)===0?c:hd(c),D={i:N,v:k,k:l,a:null,e:null,prev:t,next:n};try{if(r===null){var B=document.createDocumentFragment();B.append(r=h0())}return D.e=Op(()=>a(r,k,N,v),On),D.e.prev=t&&t.e,D.e.next=n&&n.e,t===null?w||(e.first=D):(t.next=D,t.e.next=D.e),n!==null&&(n.prev=D,n.e.prev=D.e),D}finally{}}function jv(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==null&&l!==n;){var c=jM(l);s.before(l),l=c}}function fa(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function EE(r,e,t,n,s){On&&ud();var l=e.$$slots?.[t],c=!1;l===!0&&(l=e.children,c=!0),l===void 0||l(r,c?()=>n:n)}function Fk(r,e,t,n,s,l){let c=On;On&&ud();var a=null;On&&Kl.nodeType===ZM&&(a=Kl,ud());var g=On?Kl:r,v=new _0(g,!1);Td(()=>{const w=e()||null;var P=qM;if(w===null){v.ensure(null,null);return}return v.ensure(w,I=>{if(w){if(a=On?a:document.createElementNS(P,w),IM(a,a),n){On&&uk(w)&&a.append(document.createComment(""));var k=On?mE(a):a.appendChild(h0());On&&(k===null?xa(!1):Gc(k)),n(a,k)}bE.nodes_end=a,I.before(a)}On&&Gc(I)}),()=>{}},XM),xE(()=>{}),c&&(xa(!0),Gc(g))}function Nk(r,e,t){f0(()=>{var n=Ms(()=>e(r,t?.())||{});if(n?.destroy)return()=>n.destroy()})}function Lk(r,e){var t=void 0,n;Td(()=>{t!==(t=e())&&(n&&(Fp(n),n=null),t&&(n=Op(()=>{f0(()=>t(r))})))})}function PE(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=PE(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Tp(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=PE(r))&&(n&&(n+=" "),n+=e);return n}function bo(r){return typeof r=="object"?Tp(r):r??""}const BT=[...` 	
\r\fÂ \v\uFEFF`];function Bk(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var s in t)if(t[s])n=n?n+" "+s:s;else if(n.length)for(var l=s.length,c=0;(c=n.indexOf(s,c))>=0;){var a=c+l;(c===0||BT.includes(n[c-1]))&&(a===n.length||BT.includes(n[a]))?n=(c===0?"":n.substring(0,c))+n.substring(a+1):c=a}}return n===""?null:n}function zT(r,e=!1){var t=e?" !important;":";",n="";for(var s in r){var l=r[s];l!=null&&l!==""&&(n+=" "+s+": "+l+t)}return n}function Wv(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function zk(r,e){if(e){var t="",n,s;if(Array.isArray(e)?(n=e[0],s=e[1]):n=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var l=!1,c=0,a=!1,g=[];n&&g.push(...Object.keys(n).map(Wv)),s&&g.push(...Object.keys(s).map(Wv));var v=0,w=-1;const D=r.length;for(var P=0;P<D;P++){var I=r[P];if(a?I==="/"&&r[P-1]==="*"&&(a=!1):l?l===I&&(l=!1):I==="/"&&r[P+1]==="*"?a=!0:I==='"'||I==="'"?l=I:I==="("?c++:I===")"&&c--,!a&&l===!1&&c===0){if(I===":"&&w===-1)w=P;else if(I===";"||P===D-1){if(w!==-1){var k=Wv(r.substring(v,w).trim());if(!g.includes(k)){I!==";"&&P++;var N=r.substring(v,P).trim();t+=" "+N+";"}}v=P+1,w=-1}}}}return n&&(t+=zT(n)),s&&(t+=zT(s,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function fi(r,e,t,n,s,l){var c=r.__className;if(On||c!==t||c===void 0){var a=Bk(t,n,l);(!On||a!==r.getAttribute("class"))&&(a==null?r.removeAttribute("class"):e?r.className=a:r.setAttribute("class",a)),r.__className=t}else if(l&&s!==l)for(var g in l){var v=!!l[g];(s==null||v!==!!s[g])&&r.classList.toggle(g,v)}return l}function $v(r,e={},t,n){for(var s in t){var l=t[s];e[s]!==l&&(t[s]==null?r.style.removeProperty(s):r.style.setProperty(s,l,n))}}function wa(r,e,t,n){var s=r.__style;if(On||s!==e){var l=zk(e,n);(!On||l!==r.getAttribute("style"))&&(l==null?r.removeAttribute("style"):r.style.cssText=l),r.__style=e}else n&&(Array.isArray(n)?($v(r,t?.[0],n[0]),$v(r,t?.[1],n[1],"important")):$v(r,t,n));return n}function ox(r,e,t=!1){if(r.multiple){if(e==null)return;if(!c0(e))return GM();for(var n of r.options)n.selected=e.includes(UT(n));return}for(n of r.options){var s=UT(n);if(YM(s,e)){n.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Uk(r){var e=new MutationObserver(()=>{ox(r,r.__value)});e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),xE(()=>{e.disconnect()})}function UT(r){return"__value"in r?r.__value:r.value}const $f=Symbol("class"),Hf=Symbol("style"),IE=Symbol("is custom element"),CE=Symbol("is html");function RE(r){if(On){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;Fn(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var s=r.checked;Fn(r,"checked",null),r.checked=s}}};r.__on_r=t,u0(t),tk()}}function Vk(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function Fn(r,e,t,n){var s=ME(r);On&&(s[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(r[rk]=t),t==null?r.removeAttribute(e):typeof t!="string"&&kE(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function fy(r,e,t){r.setAttributeNS("http://www.w3.org/1999/xlink",e,t)}function jk(r,e,t,n,s=!1,l=!1){if(On&&s&&r.tagName==="INPUT"){var c=r,a=c.type==="checkbox"?"defaultChecked":"defaultValue";a in t||RE(c)}var g=ME(r),v=g[IE],w=!g[CE];let P=On&&v;P&&xa(!1);var I=e||{},k=r.tagName==="OPTION";for(var N in e)N in t||(t[N]=null);t.class?t.class=bo(t.class):t[$f]&&(t.class=null),t[Hf]&&(t.style??=null);var D=kE(r);for(const G in t){let le=t[G];if(k&&G==="value"&&le==null){r.value=r.__value="",I[G]=le;continue}if(G==="class"){var B=r.namespaceURI==="http://www.w3.org/1999/xhtml";fi(r,B,le,n,e?.[$f],t[$f]),I[G]=le,I[$f]=t[$f];continue}if(G==="style"){wa(r,le,e?.[Hf],t[Hf]),I[G]=le,I[Hf]=t[Hf];continue}var U=I[G];if(!(le===U&&!(le===void 0&&r.hasAttribute(G)))){I[G]=le;var V=G[0]+G[1];if(V!=="$$")if(V==="on"){const se={},oe="$$"+G;let be=G.slice(2);var L=pk(be);if(hk(be)&&(be=be.slice(0,-7),se.capture=!0),!L&&U){if(le!=null)continue;r.removeEventListener(be,I[oe],se),I[oe]=null}if(le!=null)if(L)r[`__${be}`]=le,yu([be]);else{let xe=function(_e){I[G].call(this,_e)};I[oe]=dk(be,r,xe,se)}else L&&(r[`__${be}`]=void 0)}else if(G==="style")Fn(r,G,le);else if(G==="autofocus")JM(r,!!le);else if(!v&&(G==="__value"||G==="value"&&le!=null))r.value=r.__value=le;else if(G==="selected"&&k)Vk(r,le);else{var $=G;w||($=fk($));var te=$==="defaultValue"||$==="defaultChecked";if(le==null&&!v&&!te)if(g[G]=null,$==="value"||$==="checked"){let se=r;const oe=e===void 0;if($==="value"){let be=se.defaultValue;se.removeAttribute($),se.defaultValue=be,se.value=se.__value=oe?be:null}else{let be=se.defaultChecked;se.removeAttribute($),se.defaultChecked=be,se.checked=oe?be:!1}}else r.removeAttribute(G);else te||D.includes($)&&(v||typeof le!="string")?(r[$]=le,$ in g&&(g[$]=gE)):typeof le!="function"&&Fn(r,$,le)}}}return P&&xa(!0),I}function sn(r,e,t=[],n=[],s=[],l,c=!1,a=!1){KM(s,t,n,g=>{var v=void 0,w={},P=r.nodeName==="SELECT",I=!1;if(Td(()=>{var N=e(...g.map(S)),D=jk(r,v,N,l,c,a);I&&P&&"value"in N&&ox(r,N.value);for(let U of Object.getOwnPropertySymbols(w))N[U]||Fp(w[U]);for(let U of Object.getOwnPropertySymbols(N)){var B=N[U];U.description===QM&&(!v||B!==v[U])&&(w[U]&&Fp(w[U]),w[U]=Op(()=>Lk(r,()=>B))),D[U]=B}v=D}),P){var k=r;f0(()=>{ox(k,v.value,!0),Uk(k)})}I=!0})}function ME(r){return r.__attributes??={[IE]:r.nodeName.includes("-"),[CE]:r.namespaceURI===ek}}var VT=new Map;function kE(r){var e=r.getAttribute("is")||r.nodeName,t=VT.get(e);if(t)return t;VT.set(e,t=[]);for(var n,s=r,l=Element.prototype;l!==s;){n=nk(s);for(var c in n)n[c].set&&t.push(c);s=dE(s)}return t}function DE(r,e,t=e){var n=new WeakSet;ik(r,"input",async s=>{var l=s?r.defaultValue:r.value;if(l=Hv(r)?Zv(l):l,t(l),Xh!==null&&n.add(Xh),await p0(),l!==(l=e())){var c=r.selectionStart,a=r.selectionEnd,g=r.value.length;if(r.value=l??"",a!==null){var v=r.value.length;c===a&&a===g&&v>g?(r.selectionStart=v,r.selectionEnd=v):(r.selectionStart=c,r.selectionEnd=Math.min(a,v))}}}),(On&&r.defaultValue!==r.value||Ms(e)==null&&r.value)&&(t(Hv(r)?Zv(r.value):r.value),Xh!==null&&n.add(Xh)),sk(()=>{var s=e();if(r===document.activeElement){var l=ok??Xh;if(n.has(l))return}Hv(r)&&s===Zv(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function Hv(r){var e=r.type;return e==="number"||e==="range"}function Zv(r){return r===""?null:+r}var Wk=class extends mk{constructor(r,e){super(),this.options=e,this.#t=r,this.#a=null,this.#o=DT(),this.bindMethods(),this.setOptions(e)}#t;#e=void 0;#r=void 0;#n=void 0;#i;#s;#o;#a;#l;#c;#p;#d;#u;#h;#g=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),jT(this.#e,this.options)?this.#f():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ax(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ax(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#x(),this.#e.removeObserver(this)}setOptions(r){const e=this.options,t=this.#e;if(this.options=this.#t.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof jo(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#e.setOptions(this.options),e._defaulted&&!tx(this.options,e)&&this.#t.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const n=this.hasListeners();n&&WT(this.#e,t,this.options,e)&&this.#f(),this.updateResult(),n&&(this.#e!==t||jo(this.options.enabled,this.#e)!==jo(e.enabled,this.#e)||wp(this.options.staleTime,this.#e)!==wp(e.staleTime,this.#e))&&this.#_();const s=this.#m();n&&(this.#e!==t||jo(this.options.enabled,this.#e)!==jo(e.enabled,this.#e)||s!==this.#h)&&this.#y(s)}getOptimisticResult(r){const e=this.#t.getQueryCache().build(this.#t,r),t=this.createResult(e,r);return Hk(this,t)&&(this.#n=t,this.#s=this.options,this.#i=this.#e.state),t}getCurrentResult(){return this.#n}trackResult(r,e){return new Proxy(r,{get:(t,n)=>(this.trackProp(n),e?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(t,n))})}trackProp(r){this.#g.add(r)}getCurrentQuery(){return this.#e}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const e=this.#t.defaultQueryOptions(r),t=this.#t.getQueryCache().build(this.#t,e);return t.fetch().then(()=>this.createResult(t,e))}fetch(r){return this.#f({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#f(r){this.#w();let e=this.#e.fetch(this.options,r);return r?.throwOnError||(e=e.catch(_k)),e}#_(){this.#b();const r=wp(this.options.staleTime,this.#e);if(OT||this.#n.isStale||!FT(r))return;const t=yk(this.#n.dataUpdatedAt,r)+1;this.#d=Nm.setTimeout(()=>{this.#n.isStale||this.updateResult()},t)}#m(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#y(r){this.#x(),this.#h=r,!(OT||jo(this.options.enabled,this.#e)===!1||!FT(this.#h)||this.#h===0)&&(this.#u=Nm.setInterval(()=>{(this.options.refetchIntervalInBackground||vk.isFocused())&&this.#f()},this.#h))}#v(){this.#_(),this.#y(this.#m())}#b(){this.#d&&(Nm.clearTimeout(this.#d),this.#d=void 0)}#x(){this.#u&&(Nm.clearInterval(this.#u),this.#u=void 0)}createResult(r,e){const t=this.#e,n=this.options,s=this.#n,l=this.#i,c=this.#s,g=r!==t?r.state:this.#r,{state:v}=r;let w={...v},P=!1,I;if(e._optimisticResults){const se=this.hasListeners(),oe=!se&&jT(r,e),be=se&&WT(r,t,e,n);(oe||be)&&(w={...w,...bk(v.data,r.options)}),e._optimisticResults==="isRestoring"&&(w.fetchStatus="idle")}let{error:k,errorUpdatedAt:N,status:D}=w;I=w.data;let B=!1;if(e.placeholderData!==void 0&&I===void 0&&D==="pending"){let se;s?.isPlaceholderData&&e.placeholderData===c?.placeholderData?(se=s.data,B=!0):se=typeof e.placeholderData=="function"?e.placeholderData(this.#p?.state.data,this.#p):e.placeholderData,se!==void 0&&(D="success",I=NT(s?.data,se,e),P=!0)}if(e.select&&I!==void 0&&!B)if(s&&I===l?.data&&e.select===this.#l)I=this.#c;else try{this.#l=e.select,I=e.select(I),I=NT(s?.data,I,e),this.#c=I,this.#a=null}catch(se){this.#a=se}this.#a&&(k=this.#a,I=this.#c,N=Date.now(),D="error");const U=w.fetchStatus==="fetching",V=D==="pending",L=D==="error",$=V&&U,te=I!==void 0,le={status:D,fetchStatus:w.fetchStatus,isPending:V,isSuccess:D==="success",isError:L,isInitialLoading:$,isLoading:$,data:I,dataUpdatedAt:w.dataUpdatedAt,error:k,errorUpdatedAt:N,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>g.dataUpdateCount||w.errorUpdateCount>g.errorUpdateCount,isFetching:U,isRefetching:U&&!V,isLoadingError:L&&!te,isPaused:w.fetchStatus==="paused",isPlaceholderData:P,isRefetchError:L&&te,isStale:y0(r,e),refetch:this.refetch,promise:this.#o,isEnabled:jo(e.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const se=xe=>{le.status==="error"?xe.reject(le.error):le.data!==void 0&&xe.resolve(le.data)},oe=()=>{const xe=this.#o=le.promise=DT();se(xe)},be=this.#o;switch(be.status){case"pending":r.queryHash===t.queryHash&&se(be);break;case"fulfilled":(le.status==="error"||le.data!==be.value)&&oe();break;case"rejected":(le.status!=="error"||le.error!==be.reason)&&oe();break}}return le}updateResult(){const r=this.#n,e=this.createResult(this.#e,this.options);if(this.#i=this.#e.state,this.#s=this.options,this.#i.data!==void 0&&(this.#p=this.#e),tx(e,r))return;this.#n=e;const t=()=>{if(!r)return!0;const{notifyOnChangeProps:n}=this.options,s=typeof n=="function"?n():n;if(s==="all"||!s&&!this.#g.size)return!0;const l=new Set(s??this.#g);return this.options.throwOnError&&l.add("error"),Object.keys(this.#n).some(c=>{const a=c;return this.#n[a]!==r[a]&&l.has(a)})};this.#T({listeners:t()})}#w(){const r=this.#t.getQueryCache().build(this.#t,this.options);if(r===this.#e)return;const e=this.#e;this.#e=r,this.#r=r.state,this.hasListeners()&&(e?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#T(r){xk.batch(()=>{r.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#t.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function $k(r,e){return jo(e.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&e.retryOnMount===!1)}function jT(r,e){return $k(r,e)||r.state.data!==void 0&&ax(r,e,e.refetchOnMount)}function ax(r,e,t){if(jo(e.enabled,r)!==!1&&wp(e.staleTime,r)!=="static"){const n=typeof t=="function"?t(r):t;return n==="always"||n!==!1&&y0(r,e)}return!1}function WT(r,e,t,n){return(r!==e||jo(n.enabled,r)===!1)&&(!t.suspense||r.state.status!=="error")&&y0(r,t)}function y0(r,e){return jo(e.enabled,r)!==!1&&r.isStaleByTime(wp(e.staleTime,r))}function Hk(r,e){return!tx(r.getCurrentResult(),e)}function Zk(){return wk()}function Xk(r){return Tk()}var qk=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Gk=["difference","intersection","symmetricDifference","union"],$T=!1;class Yc extends Set{#t=new Map;#e=wt(0);#r=wt(0);#n=P_||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#r.v=super.size}$T||this.#s()}#i(e){return P_===this.#n?wt(e):hd(e)}#s(){$T=!0;var e=Yc.prototype,t=Set.prototype;for(const n of qk)e[n]=function(...s){return S(this.#e),t[n].apply(this,s)};for(const n of Gk)e[n]=function(...s){S(this.#e);var l=t[n].apply(this,s);return new Yc(l)}}has(e){var t=super.has(e),n=this.#t,s=n.get(e);if(s===void 0){if(!t)return S(this.#e),!1;s=this.#i(!0),n.set(e,s)}return S(s),t}add(e){return super.has(e)||(super.add(e),pe(this.#r,super.size),Ql(this.#e)),this}delete(e){var t=super.delete(e),n=this.#t,s=n.get(e);return s!==void 0&&(n.delete(e),pe(s,!1)),t&&(pe(this.#r,super.size),Ql(this.#e)),t}clear(){if(super.size!==0){super.clear();var e=this.#t;for(var t of e.values())pe(t,!1);e.clear(),pe(this.#r,0),Ql(this.#e)}}keys(){return this.values()}values(){return S(this.#e),super.values()}entries(){return S(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return S(this.#r)}}class lx extends Map{#t=new Map;#e=wt(0);#r=wt(0);#n=P_||-1;constructor(e){if(super(),e){for(var[t,n]of e)super.set(t,n);this.#r.v=super.size}}#i(e){return P_===this.#n?wt(e):hd(e)}has(e){var t=this.#t,n=t.get(e);if(n===void 0){var s=super.get(e);if(s!==void 0)n=this.#i(0),t.set(e,n);else return S(this.#e),!1}return S(n),!0}forEach(e,t){this.#s(),super.forEach(e,t)}get(e){var t=this.#t,n=t.get(e);if(n===void 0){var s=super.get(e);if(s!==void 0)n=this.#i(0),t.set(e,n);else{S(this.#e);return}}return S(n),super.get(e)}set(e,t){var n=this.#t,s=n.get(e),l=super.get(e),c=super.set(e,t),a=this.#e;if(s===void 0)s=this.#i(0),n.set(e,s),pe(this.#r,super.size),Ql(a);else if(l!==t){Ql(s);var g=a.reactions===null?null:new Set(a.reactions),v=g===null||!s.reactions?.every(w=>g.has(w));v&&Ql(a)}return c}delete(e){var t=this.#t,n=t.get(e),s=super.delete(e);return n!==void 0&&(t.delete(e),pe(this.#r,super.size),pe(n,-1),Ql(this.#e)),s}clear(){if(super.size!==0){super.clear();var e=this.#t;pe(this.#r,0);for(var t of e.values())pe(t,-1);Ql(this.#e),e.clear()}}#s(){S(this.#e);var e=this.#t;if(this.#r.v!==e.size){for(var t of super.keys())if(!e.has(t)){var n=this.#i(0);e.set(t,n)}}for([,n]of this.#t)S(n)}keys(){return S(this.#e),super.keys()}values(){return this.#s(),super.values()}entries(){return this.#s(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return S(this.#r),super.size}}function Yk(r){const e=Array.isArray(r)?[]:{},t=new Yc,n=new Proxy(e,{set(l,c,a,g){if(t.delete(c),c in l)return Reflect.set(l,c,a,g);let v=wt(a);return Object.defineProperty(l,c,{configurable:!0,enumerable:!0,get:()=>S(v)&&Qk(S(v))?S(v)():S(v),set:w=>{pe(v,w)}}),!0},has:(l,c)=>t.has(c)?!1:c in l,ownKeys(l){return Reflect.ownKeys(l).filter(c=>!t.has(c))},getOwnPropertyDescriptor(l,c){if(!t.has(c))return Reflect.getOwnPropertyDescriptor(l,c)},deleteProperty(l,c){return c in l?(l[c]=void 0,t.add(c),Array.isArray(l)&&l.length--,!0):!1}});function s(l){const c=Object.keys(n),a=Object.keys(l),g=c.filter(v=>!a.includes(v));for(const v of g)delete n[v];for(const v of a)n[v]=Kk(()=>l[v])}return s(r),[n,s]}const OE=Symbol("LazyValue");function Kk(r){return r[OE]=!0,r}function Qk(r){return!!r[OE]}function Jk(r,e){switch(r){case"post":kr(e);break;case"pre":g0(e);break}}const Xv=(r,e,t)=>{let n=!1,s=Array.isArray(r)?[]:void 0;Jk(e,()=>{const l=Array.isArray(r)?r.map(a=>a()):r();if(!n){n=!0,s=l;return}const c=Ms(()=>t(l,s));return s=l,c})};function eD(r,e,t){const n=me(()=>Xk()),s=Zk(),l=me(()=>{const w=S(n).defaultQueryOptions(r());return w._optimisticResults=s.current?"isRestoring":"optimistic",w});let c=wt(tn(new e(S(n),S(l))));Xv(()=>S(n),"pre",()=>{pe(c,new e(S(n),S(l)),!0)});function a(){const w=S(c).getOptimisticResult(S(l));return S(l).notifyOnChangeProps?w:S(c).trackResult(w)}const[g,v]=Yk(a());return kr(()=>{const w=s.current?()=>{}:S(c).subscribe(()=>v(a()));return S(c).updateResult(),w}),Xv(()=>S(l),"pre",()=>{S(c).setOptions(S(l))}),Xv(()=>[S(l),S(c)],"pre",()=>{v(a())}),g}function tD(r,e){return eD(r,Wk)}/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const rD={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var nD=l0("<svg><!><!></svg>");function jn(r,e){Tt(e,!0);const t=ae(e,"color",3,"currentColor"),n=ae(e,"size",3,24),s=ae(e,"strokeWidth",3,2),l=ae(e,"absoluteStrokeWidth",3,!1),c=ae(e,"iconNode",19,()=>[]),a=hr(e,["$$slots","$$events","$$legacy","name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","children"]);var g=nD();sn(g,P=>({...rD,...a,width:n(),height:n(),stroke:t(),"stroke-width":P,class:["lucide-icon lucide",e.name&&`lucide-${e.name}`,e.class]}),[()=>l()?Number(s())*24/Number(n()):s()]);var v=Ae(g);xn(v,17,c,di,(P,I)=>{var k=me(()=>m0(S(I),2));let N=()=>S(k)[0],D=()=>S(k)[1];var B=We(),U=ue(B);Fk(U,N,!0,(V,L)=>{sn(V,()=>({...D()}))}),Z(P,B)});var w=ve(v);Ot(w,()=>e.children??Ht),we(g),Z(r,g),St()}function iD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]];jn(r,zr({name:"arrow-down"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function v0(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];jn(r,zr({name:"arrow-right"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function sD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];jn(r,zr({name:"arrow-up-down"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function oD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];jn(r,zr({name:"arrow-up"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function aD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M4.929 4.929 19.07 19.071"}],["circle",{cx:"12",cy:"12",r:"10"}]];jn(r,zr({name:"ban"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function lD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M12 20v-9"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z"}],["path",{d:"M14.12 3.88 16 2"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97"}],["path",{d:"M22 13h-4"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97"}],["path",{d:"M6 13H2"}],["path",{d:"m8 2 1.88 1.88"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13"}]];jn(r,zr({name:"bug"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function cD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M4 6 2 7"}],["path",{d:"M10 6h4"}],["path",{d:"m22 7-2-1"}],["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2"}],["path",{d:"M4 11h16"}],["path",{d:"M8 15h.01"}],["path",{d:"M16 15h.01"}],["path",{d:"M6 19v2"}],["path",{d:"M18 21v-2"}]];jn(r,zr({name:"bus-front"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function uD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M20 6 9 17l-5-5"}]];jn(r,zr({name:"check"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function py(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"m6 9 6 6 6-6"}]];jn(r,zr({name:"chevron-down"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function hD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"m9 18 6-6-6-6"}]];jn(r,zr({name:"chevron-right"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function FE(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"m18 15-6-6-6 6"}]];jn(r,zr({name:"chevron-up"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function gy(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]];jn(r,zr({name:"circle-x"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function dD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["circle",{cx:"12",cy:"12",r:"10"}]];jn(r,zr({name:"circle"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function b0(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];jn(r,zr({name:"copy"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function fD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["line",{x1:"12",x2:"12",y1:"2",y2:"22"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}]];jn(r,zr({name:"dollar-sign"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function pD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M18 22V2.8a.8.8 0 0 0-1.17-.71L5.45 7.78a.8.8 0 0 0 0 1.44L18 15.5"}]];jn(r,zr({name:"flag-triangle-left"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function qv(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16"}],["path",{d:"M2 21h13"}],["path",{d:"M3 9h11"}]];jn(r,zr({name:"fuel"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function Gv(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];jn(r,zr({name:"info"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function Np(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];jn(r,zr({name:"loader-circle"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function x0(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["line",{x1:"2",x2:"5",y1:"12",y2:"12"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}],["circle",{cx:"12",cy:"12",r:"7"}],["circle",{cx:"12",cy:"12",r:"3"}]];jn(r,zr({name:"locate-fixed"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function gD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M15 22a1 1 0 0 1-1-1v-4a1 1 0 0 1 .445-.832l3-2a1 1 0 0 1 1.11 0l3 2A1 1 0 0 1 22 17v4a1 1 0 0 1-1 1z"}],["path",{d:"M18 10a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 .601.2"}],["path",{d:"M18 22v-3"}],["circle",{cx:"10",cy:"10",r:"3"}]];jn(r,zr({name:"map-pin-house"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function mD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}],["circle",{cx:"12",cy:"10",r:"3"}]];jn(r,zr({name:"map-pin"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function _D(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor"}]];jn(r,zr({name:"palette"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function HT(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z"}],["path",{d:"m2 22 3-3"}],["path",{d:"M7.5 13.5 10 11"}],["path",{d:"M10.5 16.5 13 14"}],["path",{d:"m18 3-4 4h6l-4 4"}]];jn(r,zr({name:"plug-zap"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function yD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"}],["path",{d:"M16 16h5v5"}]];jn(r,zr({name:"refresh-ccw"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function vD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M4 11a9 9 0 0 1 9 9"}],["path",{d:"M4 4a16 16 0 0 1 16 16"}],["circle",{cx:"5",cy:"19",r:"1"}]];jn(r,zr({name:"rss"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function bD(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M8 3.1V7a4 4 0 0 0 8 0V3.1"}],["path",{d:"m9 15-1-1"}],["path",{d:"m15 15 1-1"}],["path",{d:"M9 19c-2.8 0-5-2.2-5-5v-4a8 8 0 0 1 16 0v4c0 2.8-2.2 5-5 5Z"}],["path",{d:"m8 19-2 3"}],["path",{d:"m16 19 2 3"}]];jn(r,zr({name:"train-front"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function Kc(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];jn(r,zr({name:"x"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}function ZT(r,e){Tt(e,!0);/**
 * @license @lucide/svelte v0.548.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */let t=hr(e,["$$slots","$$events","$$legacy"]);const n=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"}]];jn(r,zr({name:"zap"},()=>t,{get iconNode(){return n},children:(s,l)=>{var c=We(),a=ue(c);Ot(a,()=>e.children??Ht),Z(s,c)},$$slots:{default:!0}})),St()}const xD={light:{background:"#f8f4f0",water:"#99ddff",rail:"#a8a8a8",pedestrian:"#e8e7eb",ferryRoute:"rgba(102, 102, 255, 0.5)",sport:"#d0f4be",sportOutline:"#b3e998",building:"#ded7d3",buildingOutline:"#cfc8c4",landuseComplex:"#f0e6d1",landuseCommercial:"hsla(0, 60%, 87%, 0.23)",landuseIndustrial:"#e0e2eb",landuseResidential:"#ece7e4",landuseRetail:"hsla(0, 60%, 87%, 0.23)",landuseConstruction:"#aaa69d",landusePark:"#b8ebad",landuseNatureLight:"#ddecd7",landuseNatureHeavy:"#a3e39c",landuseCemetery:"#e0e4dd",landuseBeach:"#fffcd3",indoorCorridor:"#fdfcfa",indoor:"#d4edff",indoorOutline:"#808080",indoorText:"#333333",publicTransport:"rgba(218,140,140,0.3)",footway:"#fff",steps:"#ff4524",elevatorOutline:"#808080",elevator:"#bcf1ba",roadBackResidential:"#ffffff",roadBackNonResidential:"#ffffff",motorway:"#ffb366",motorwayLink:"#f7e06e",primarySecondary:"#fffbf8",linkTertiary:"#ffffff",residential:"#ffffff",road:"#ffffff",townText:"#333333",townTextHalo:"white",text:"#333333",textHalo:"white",citiesText:"#111111",citiesTextHalo:"white",shield:"shield"},dark:{background:"#292929",water:"#1f2830",rail:"#808080",pedestrian:"#292929",ferryRoute:"rgba(58, 77, 139, 0.5)",sport:"#272525",sportOutline:"#272525",building:"#1F1F1F",buildingOutline:"#1A1A1A",landuseComplex:"#292929",landuseCommercial:"#292929",landuseIndustrial:"#353538",landuseResidential:"#292929",landuseRetail:"#292929",landuseConstruction:"red",landusePark:"#18221f",landuseNatureLight:"#1e2322",landuseNatureHeavy:"#1a2020",landuseCemetery:"#202423",landuseBeach:"#4c4b3e",indoorCorridor:"#494949",indoor:"#1a1a1a",indoorOutline:"#0d0d0d",indoorText:"#eeeeee",publicTransport:"rgba(89, 45, 45, 0.405)",footway:"#3D3D3D",steps:"#70504b",elevatorOutline:"#808080",elevator:"#3b423b",roadBackResidential:"#414141",roadBackNonResidential:"#414141",motorway:"#414141",motorwayLink:"#414141",primarySecondary:"#414141",linkTertiary:"#414141",residential:"#414141",road:"#414141",text:"#9a9a9a",textHalo:"#151515",townText:"#bebebe",townTextHalo:"#1A1A1A",citiesText:"#bebebe",citiesTextHalo:"#1A1A1A",shield:"shield-dark"}};function wD(r){const{origin:e,pathname:t}=new URL(r);return e+t.slice(0,t.lastIndexOf("/")+1)}function Yv(r,e){return wD(r)+e}const TD=(r,e,t,n)=>{const s=xD[r];return{version:8,sources:{osm:{type:"vector",tiles:[Yv(n,"tiles/{z}/{x}/{y}.mvt")],maxzoom:20,attribution:""}},glyphs:Yv(n,"tiles/glyphs/{fontstack}/{range}.pbf"),sprite:Yv(t,"sprite_sdf"),layers:[{id:"background",type:"background",paint:{"background-color":s.background}},{id:"coastline",type:"fill",source:"osm","source-layer":"coastline",paint:{"fill-color":s.water}},{id:"landuse_park",type:"fill",source:"osm","source-layer":"landuse",filter:["==",["get","landuse"],"park"],paint:{"fill-color":s.landusePark}},{id:"landuse",type:"fill",source:"osm","source-layer":"landuse",filter:["!in","landuse","park","public_transport"],paint:{"fill-color":["match",["get","landuse"],"complex",s.landuseComplex,"commercial",s.landuseCommercial,"industrial",s.landuseIndustrial,"residential",s.landuseResidential,"retail",s.landuseRetail,"construction",s.landuseConstruction,"nature_light",s.landuseNatureLight,"nature_heavy",s.landuseNatureHeavy,"cemetery",s.landuseCemetery,"beach",s.landuseBeach,"magenta"]}},{id:"water",type:"fill",source:"osm","source-layer":"water",paint:{"fill-color":s.water}},{id:"sport",type:"fill",source:"osm","source-layer":"sport",paint:{"fill-color":s.sport,"fill-outline-color":s.sportOutline}},{id:"pedestrian",type:"fill",source:"osm","source-layer":"pedestrian",paint:{"fill-color":s.pedestrian}},{id:"waterway",type:"line",source:"osm","source-layer":"waterway",paint:{"line-color":s.water}},{id:"building",type:"fill",source:"osm","source-layer":"building",paint:{"fill-color":s.building,"fill-outline-color":s.buildingOutline,"fill-opacity":["interpolate",["linear"],["zoom"],14,0,16,.8]}},{id:"indoor-corridor",type:"fill",source:"osm","source-layer":"indoor",filter:["all",["==","indoor","corridor"],["==","level",e]],paint:{"fill-color":s.indoorCorridor,"fill-opacity":.8}},{id:"indoor",type:"fill",source:"osm","source-layer":"indoor",filter:["all",["!in","indoor","corridor","wall","elevator"],["==","level",e]],paint:{"fill-color":s.indoor,"fill-opacity":.8}},{id:"indoor-outline",type:"line",source:"osm","source-layer":"indoor",filter:["all",["!in","indoor","corridor","wall","elevator"],["==","level",e]],minzoom:18,paint:{"line-color":s.indoorOutline,"line-width":2}},{id:"indoor-names",type:"symbol",source:"osm","source-layer":"indoor",minzoom:18,filter:["any",["!has","level"],["==","level",e]],layout:{"symbol-placement":"point","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12},paint:{"text-color":s.indoorText}},{id:"landuse-public-transport",type:"fill",source:"osm","source-layer":"landuse",filter:["all",["==","landuse","public_transport"],["any",["!has","level"],["==","level",e]]],paint:{"fill-color":s.publicTransport}},{id:"footway",type:"line",source:"osm","source-layer":"road",filter:["all",["in","highway","footway","track","cycleway","path","unclassified","service"],e===0?["any",["!has","level"],["==","level",e]]:["==","level",e]],layout:{"line-cap":"round"},minzoom:14,paint:{"line-dasharray":[.75,1.5],"line-color":s.footway,"line-opacity":.5,"line-width":["let","base",.4,["interpolate",["linear"],["zoom"],5,["+",["*",["var","base"],.1],1],9,["+",["*",["var","base"],.4],1],12,["+",["*",["var","base"],1],1],16,["+",["*",["var","base"],4],1],20,["+",["*",["var","base"],8],1]]]}},{id:"stairs-ground",type:"line",source:"osm","source-layer":"road",minzoom:18,filter:["all",["==","highway","steps"],e===0?["any",["!has","from_level"],["any",["==","from_level",e],["==","to_level",e]]]:["any",["==","from_level",e],["==","to_level",e]]],paint:{"line-color":"#ddddddff","line-width":["interpolate",["exponential",2],["zoom"],10,["*",4,["^",2,-6]],24,["*",4,["^",2,8]]]}},{id:"stairs-steps",type:"line",source:"osm","source-layer":"road",minzoom:18,filter:["all",["==","highway","steps"],e===0?["any",["!has","from_level"],["any",["==","from_level",e],["==","to_level",e]]]:["any",["==","from_level",e],["==","to_level",e]]],paint:{"line-color":"#bfbfbf","line-dasharray":["literal",[.01,.1]],"line-width":["interpolate",["exponential",2],["zoom"],10,["*",4,["^",2,-6]],24,["*",4,["^",2,8]]]}},{id:"stairs-rail",type:"line",source:"osm","source-layer":"road",minzoom:18,filter:["all",["==","highway","steps"],e===0?["any",["!has","from_level"],["any",["==","from_level",e],["==","to_level",e]]]:["any",["==","from_level",e],["==","to_level",e]]],paint:{"line-color":"#808080","line-width":["interpolate",["exponential",2],["zoom"],10,["*",.25,["^",2,-6]],24,["*",.25,["^",2,8]]],"line-gap-width":["interpolate",["exponential",2],["zoom"],10,["*",4,["^",2,-6]],24,["*",4,["^",2,8]]]}},{id:"indoor-elevator-outline",type:"circle",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],paint:{"circle-color":s.elevatorOutline,"circle-radius":16}},{id:"indoor-elevator",type:"circle",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],paint:{"circle-color":s.elevator,"circle-radius":14}},{id:"indoor-elevator-icon",type:"symbol",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],layout:{"icon-image":"elevator","icon-size":.9}},{id:"road_back_residential",type:"line",source:"osm","source-layer":"road",filter:["==","highway","residential"],layout:{"line-cap":"round"},paint:{"line-color":s.roadBackResidential,"line-width":["interpolate",["linear"],["zoom"],5,0,9,.5,12,1,16,4,20,20],"line-opacity":["interpolate",["linear"],["zoom"],12,.4,15,1]}},{id:"road_back_non_residential",type:"line",source:"osm","source-layer":"road",filter:["!in","highway","footway","track","steps","cycleway","path","unclassified","residential","service"],layout:{"line-cap":"round"},paint:{"line-color":s.roadBackNonResidential,"line-width":["let","base",["match",["get","highway"],"motorway",4,["trunk","motorway_link"],3.5,["primary","secondary","aeroway","trunk_link"],3,["primary_link","secondary_link","tertiary","tertiary_link"],1.75,0],["interpolate",["linear"],["zoom"],5,["+",["*",["var","base"],.1],1],9,["+",["*",["var","base"],.4],1],12,["+",["*",["var","base"],1],1],16,["+",["*",["var","base"],4],1],20,["+",["*",["var","base"],8],1]]]}},{id:"road",type:"line",source:"osm","source-layer":"road",layout:{"line-cap":"round"},filter:["all",["has","ref"],["any",["==",["get","highway"],"motorway"],["==",["get","highway"],"trunk"],["==",["get","highway"],"secondary"],[">",["zoom"],11]]],paint:{"line-color":["match",["get","highway"],"motorway",s.motorway,["trunk","motorway_link"],s.motorwayLink,["primary","secondary","aeroway","trunk_link"],s.primarySecondary,["primary_link","secondary_link","tertiary","tertiary_link"],s.linkTertiary,"residential",s.residential,s.road],"line-width":["let","base",["match",["get","highway"],"motorway",3.5,["trunk","motorway_link"],3,["primary","secondary","aeroway","trunk_link"],2.5,["primary_link","secondary_link","tertiary","tertiary_link"],1.75,"residential",1.5,.75],["interpolate",["linear"],["zoom"],5,["*",["var","base"],.5],9,["*",["var","base"],1],12,["*",["var","base"],2],16,["*",["var","base"],2.5],20,["*",["var","base"],3]]]}},{id:"ferry_routes",type:"line",source:"osm","source-layer":"ferry",paint:{"line-width":1.5,"line-dasharray":[2,3],"line-color":s.ferryRoute}},{id:"rail_detail",type:"line",source:"osm","source-layer":"rail",filter:["==","rail","detail"],paint:{"line-color":s.rail}},{id:"rail_secondary",type:"line",source:"osm","source-layer":"rail",filter:["all",["==","rail","secondary"],["any",["!has","level"],["==","level",e]]],paint:{"line-color":s.rail,"line-width":1.15}},{id:"rail_primary",type:"line",source:"osm","source-layer":"rail",filter:["all",["==","rail","primary"],["any",["!has","level"],["==","level",e]]],paint:{"line-color":s.rail,"line-width":1.3}},{id:"road-ref-shield",type:"symbol",source:"osm","source-layer":"road",minzoom:6,filter:["all",["has","ref"],["any",["==",["get","highway"],"motorway"],["==",["get","highway"],"trunk"],["==",["get","highway"],"secondary"],[">",["zoom"],11]]],layout:{"symbol-placement":"line","text-field":["get","ref"],"text-font":["Noto Sans Display Regular"],"text-size":["case",["==",["get","highway"],"motorway"],11,10],"text-justify":"center","text-rotation-alignment":"viewport","text-pitch-alignment":"viewport","icon-image":s.shield,"icon-text-fit":"both","icon-text-fit-padding":[.5,4,.5,4],"icon-rotation-alignment":"viewport","icon-pitch-alignment":"viewport"},paint:{"text-color":s.text}},{id:"road-name-text",type:"symbol",source:"osm","source-layer":"road",minzoom:14,layout:{"symbol-placement":"line","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":9},paint:{"text-halo-width":11,"text-halo-color":s.textHalo,"text-color":s.text}},{id:"towns",type:"symbol",source:"osm","source-layer":"cities",filter:["!=",["get","place"],"city"],layout:{"text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12},paint:{"text-halo-width":1,"text-halo-color":s.textHalo,"text-color":s.text}},{id:"cities",type:"symbol",source:"osm","source-layer":"cities",filter:["==",["get","place"],"city"],layout:{"symbol-sort-key":["-",["coalesce",["get","population"],0]],"text-field":["get","name"],"text-font":["Noto Sans Display Bold"],"text-size":["interpolate",["linear"],["zoom"],6,12,9,16]},paint:{"text-halo-width":2,"text-halo-color":"white","text-color":"hsl(0, 0%, 20%)"}}]}};function w0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var d_={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.10.0/LICENSE.txt
 */var SD=d_.exports,XT;function AD(){return XT||(XT=1,(function(r,e){(function(t,n){r.exports=n()})(SD,(function(){var t={},n={};function s(c,a,g){if(n[c]=g,c==="index"){var v="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",w={};return n.shared(w),n.index(t,w),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}s("shared",["exports"],(function(c){function a(h,o,u,f){return new(u||(u=Promise))((function(m,b){function T(O){try{C(f.next(O))}catch(F){b(F)}}function E(O){try{C(f.throw(O))}catch(F){b(F)}}function C(O){var F;O.done?m(O.value):(F=O.value,F instanceof u?F:new u((function(W){W(F)}))).then(T,E)}C((f=f.apply(h,o||[])).next())}))}function g(h,o){this.x=h,this.y=o}function v(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var w,P;typeof SuppressedError=="function"&&SuppressedError,g.prototype={clone(){return new g(this.x,this.y)},add(h){return this.clone()._add(h)},sub(h){return this.clone()._sub(h)},multByPoint(h){return this.clone()._multByPoint(h)},divByPoint(h){return this.clone()._divByPoint(h)},mult(h){return this.clone()._mult(h)},div(h){return this.clone()._div(h)},rotate(h){return this.clone()._rotate(h)},rotateAround(h,o){return this.clone()._rotateAround(h,o)},matMult(h){return this.clone()._matMult(h)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(h){return this.x===h.x&&this.y===h.y},dist(h){return Math.sqrt(this.distSqr(h))},distSqr(h){const o=h.x-this.x,u=h.y-this.y;return o*o+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith(h){return this.angleWithSep(h.x,h.y)},angleWithSep(h,o){return Math.atan2(this.x*o-this.y*h,this.x*h+this.y*o)},_matMult(h){const o=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=o,this},_add(h){return this.x+=h.x,this.y+=h.y,this},_sub(h){return this.x-=h.x,this.y-=h.y,this},_mult(h){return this.x*=h,this.y*=h,this},_div(h){return this.x/=h,this.y/=h,this},_multByPoint(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint(h){return this.x/=h.x,this.y/=h.y,this},_unit(){return this._div(this.mag()),this},_perp(){const h=this.y;return this.y=this.x,this.x=-h,this},_rotate(h){const o=Math.cos(h),u=Math.sin(h),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround(h,o){const u=Math.cos(h),f=Math.sin(h),m=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:g},g.convert=function(h){if(h instanceof g)return h;if(Array.isArray(h))return new g(+h[0],+h[1]);if(h.x!==void 0&&h.y!==void 0)return new g(+h.x,+h.y);throw new Error("Expected [x, y] or {x, y} point format")};var I=(function(){if(P)return w;function h(o,u,f,m){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=u,this.p2x=f,this.p2y=m}return P=1,w=h,h.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,u){if(u===void 0&&(u=1e-6),o<0)return 0;if(o>1)return 1;for(var f=o,m=0;m<8;m++){var b=this.sampleCurveX(f)-o;if(Math.abs(b)<u)return f;var T=this.sampleCurveDerivativeX(f);if(Math.abs(T)<1e-6)break;f-=b/T}var E=0,C=1;for(f=o,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-o)<u));m++)o>b?E=f:C=f,f=.5*(C-E)+E;return f},solve:function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))}},w})(),k=v(I);let N,D;function B(){return N==null&&(N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),N}function U(){if(D==null&&(D=!1,B())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let f=0;f<25;f++){const m=4*f;o.fillStyle=`rgb(${m},${m+1},${m+2})`,o.fillRect(f%5,Math.floor(f/5),1,1)}const u=o.getImageData(0,0,5,5).data;for(let f=0;f<100;f++)if(f%4!=3&&u[f]!==f){D=!0;break}}}return D||!1}var V=1e-6,L=typeof Float32Array<"u"?Float32Array:Array;function $(){var h=new L(9);return L!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function te(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function G(){var h=new L(3);return L!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function le(h){var o=h[0],u=h[1],f=h[2];return Math.sqrt(o*o+u*u+f*f)}function se(h,o,u){var f=new L(3);return f[0]=h,f[1]=o,f[2]=u,f}function oe(h,o,u){return h[0]=o[0]+u[0],h[1]=o[1]+u[1],h[2]=o[2]+u[2],h}function be(h,o,u){return h[0]=o[0]*u,h[1]=o[1]*u,h[2]=o[2]*u,h}function xe(h,o,u){var f=o[0],m=o[1],b=o[2],T=u[0],E=u[1],C=u[2];return h[0]=m*C-b*E,h[1]=b*T-f*C,h[2]=f*E-m*T,h}var _e,Ne=le;function fe(h,o,u){var f=o[0],m=o[1],b=o[2],T=o[3];return h[0]=u[0]*f+u[4]*m+u[8]*b+u[12]*T,h[1]=u[1]*f+u[5]*m+u[9]*b+u[13]*T,h[2]=u[2]*f+u[6]*m+u[10]*b+u[14]*T,h[3]=u[3]*f+u[7]*m+u[11]*b+u[15]*T,h}function Le(){var h=new L(4);return L!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function tt(h,o,u,f){var m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",b=Math.PI/360;o*=b,f*=b,u*=b;var T=Math.sin(o),E=Math.cos(o),C=Math.sin(u),O=Math.cos(u),F=Math.sin(f),W=Math.cos(f);switch(m){case"xyz":h[0]=T*O*W+E*C*F,h[1]=E*C*W-T*O*F,h[2]=E*O*F+T*C*W,h[3]=E*O*W-T*C*F;break;case"xzy":h[0]=T*O*W-E*C*F,h[1]=E*C*W-T*O*F,h[2]=E*O*F+T*C*W,h[3]=E*O*W+T*C*F;break;case"yxz":h[0]=T*O*W+E*C*F,h[1]=E*C*W-T*O*F,h[2]=E*O*F-T*C*W,h[3]=E*O*W+T*C*F;break;case"yzx":h[0]=T*O*W+E*C*F,h[1]=E*C*W+T*O*F,h[2]=E*O*F-T*C*W,h[3]=E*O*W-T*C*F;break;case"zxy":h[0]=T*O*W-E*C*F,h[1]=E*C*W+T*O*F,h[2]=E*O*F+T*C*W,h[3]=E*O*W-T*C*F;break;case"zyx":h[0]=T*O*W-E*C*F,h[1]=E*C*W+T*O*F,h[2]=E*O*F-T*C*W,h[3]=E*O*W+T*C*F;break;default:throw new Error("Unknown angle order "+m)}return h}function Ye(){var h=new L(2);return L!=Float32Array&&(h[0]=0,h[1]=0),h}function rt(h,o){var u=new L(2);return u[0]=h,u[1]=o,u}G(),_e=new L(4),L!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=0),G(),se(1,0,0),se(0,1,0),Le(),Le(),$(),Ye();const it=8192;function Ct(h,o,u){return o*(it/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function Mt(h,o){return(h%o+o)%o}function jt(h,o,u){return h*(1-u)+o*u}function Gt(h){if(h<=0)return 0;if(h>=1)return 1;const o=h*h,u=o*h;return 4*(h<.5?u:3*(h-o)+u-.75)}function Or(h,o,u,f){const m=new k(h,o,u,f);return b=>m.solve(b)}const _r=Or(.25,.1,.25,1);function wr(h,o,u){return Math.min(u,Math.max(o,h))}function Dr(h,o,u){const f=u-o,m=((h-o)%f+f)%f+o;return m===o?u:m}function Et(h,...o){for(const u of o)for(const f in u)h[f]=u[f];return h}let vt=1;function Pr(h,o,u){const f={};for(const m in h)f[m]=o.call(this,h[m],m,h);return f}function yr(h,o,u){const f={};for(const m in h)o.call(this,h[m],m,h)&&(f[m]=h[m]);return f}function Ar(h){return Array.isArray(h)?h.map(Ar):typeof h=="object"&&h?Pr(h,Ar):h}const br={};function lr(h){br[h]||(typeof console<"u"&&console.warn(h),br[h]=!0)}function ut(h,o,u){return(u.y-h.y)*(o.x-h.x)>(o.y-h.y)*(u.x-h.x)}function Zt(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let dr=null;function er(h){if(dr==null){const o=h.navigator?h.navigator.userAgent:null;dr=!!h.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return dr}function Bt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const mr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Tr(h,o,u,f,m){return a(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(h,{timestamp:0});try{const T=b?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const E=T.startsWith("BGR"),C=new Uint8ClampedArray(f*m*4);if(yield b.copyTo(C,(function(O,F,W,q,K){const J=4*Math.max(-F,0),ne=(Math.max(0,W)-W)*q*4+J,ce=4*q,Se=Math.max(0,F),qe=Math.max(0,W);return{rect:{x:Se,y:qe,width:Math.min(O.width,F+q)-Se,height:Math.min(O.height,W+K)-qe},layout:[{offset:ne,stride:ce}]}})(h,o,u,f,m)),E)for(let O=0;O<C.length;O+=4){const F=C[O];C[O]=C[O+2],C[O+2]=F}return C}finally{b.close()}}))}let fr,nr;function rr(h,o,u,f){return h.addEventListener(o,u,f),{unsubscribe:()=>{h.removeEventListener(o,u,f)}}}function Nr(h){return h*Math.PI/180}function Cr(h){return h/Math.PI*180}const qr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ir={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},or="AbortError";function Re(){return new Error(or)}const Y={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ee(h){return Y.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const ie="global-dispatcher";class Te extends Error{constructor(o,u,f,m){super(`AJAXError: ${u} (${o}): ${f}`),this.status=o,this.statusText=u,this.url=f,this.body=m}}const Ce=()=>Zt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Be=function(h,o){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const f=ee(h.url);if(f)return f(h,o);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:ie},o)}if(!(/^file:/.test(u=h.url)||/^file:/.test(Ce())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(f,m){return a(this,void 0,void 0,(function*(){const b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Ce(),signal:m.signal});let T,E;f.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{T=yield fetch(b)}catch(O){throw new Te(0,O.message,f.url,new Blob)}if(!T.ok){const O=yield T.blob();throw new Te(T.status,T.statusText,f.url,O)}E=f.type==="arrayBuffer"||f.type==="image"?T.arrayBuffer():f.type==="json"?T.json():T.text();const C=yield E;if(m.signal.aborted)throw Re();return{data:C,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}}))})(h,o);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:ie},o)}var u;return(function(f,m){return new Promise(((b,T)=>{var E;const C=new XMLHttpRequest;C.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(C.responseType="arraybuffer");for(const O in f.headers)C.setRequestHeader(O,f.headers[O]);f.type==="json"&&(C.responseType="text",!((E=f.headers)===null||E===void 0)&&E.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=f.credentials==="include",C.onerror=()=>{T(new Error(C.statusText))},C.onload=()=>{if(!m.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let O=C.response;if(f.type==="json")try{O=JSON.parse(C.response)}catch(F){return void T(F)}b({data:O,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const O=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});T(new Te(C.status,C.statusText,f.url,O))}},m.signal.addEventListener("abort",(()=>{C.abort(),T(Re())})),C.send(f.body)}))})(h,o)};function Ge(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const o=new URL(h),u=window.location;return o.protocol===u.protocol&&o.host===u.host}function Ve(h,o,u){u[h]&&u[h].indexOf(o)!==-1||(u[h]=u[h]||[],u[h].push(o))}function nt(h,o,u){if(u&&u[h]){const f=u[h].indexOf(o);f!==-1&&u[h].splice(f,1)}}class At{constructor(o,u={}){Et(this,u),this.type=o}}class bt extends At{constructor(o,u={}){super("error",Et({error:o},u))}}class ur{on(o,u){return this._listeners=this._listeners||{},Ve(o,u,this._listeners),{unsubscribe:()=>{this.off(o,u)}}}off(o,u){return nt(o,u,this._listeners),nt(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ve(o,u,this._oneTimeListeners),this):new Promise((f=>this.once(o,f)))}fire(o,u){typeof o=="string"&&(o=new At(o,u||{}));const f=o.type;if(this.listens(f)){o.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of m)E.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of b)nt(f,E,this._oneTimeListeners),E.call(this,o);const T=this._eventedParent;T&&(Et(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(o))}else o instanceof bt&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xr(h,o){const u={};for(const f in h)f!=="ref"&&(u[f]=h[f]);return Xt.forEach((f=>{f in o&&(u[f]=o[f])})),u}function Lt(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let u=0;u<h.length;u++)if(!Lt(h[u],o[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const u in h)if(!Lt(h[u],o[u]))return!1;return!0}return h===o}function gr(h,o){h.push(o)}function Lr(h,o,u){gr(u,{command:"addSource",args:[h,o[h]]})}function je(h,o,u){gr(o,{command:"removeSource",args:[h]}),u[h]=!0}function ht(h,o,u,f){je(h,u,f),Lr(h,o,u)}function Rt(h,o,u){let f;for(f in h[u])if(Object.prototype.hasOwnProperty.call(h[u],f)&&f!=="data"&&!Lt(h[u][f],o[u][f]))return!1;for(f in o[u])if(Object.prototype.hasOwnProperty.call(o[u],f)&&f!=="data"&&!Lt(h[u][f],o[u][f]))return!1;return!0}function gt(h,o,u,f,m,b){h=h||{},o=o||{};for(const T in h)Object.prototype.hasOwnProperty.call(h,T)&&(Lt(h[T],o[T])||u.push({command:b,args:[f,T,o[T],m]}));for(const T in o)Object.prototype.hasOwnProperty.call(o,T)&&!Object.prototype.hasOwnProperty.call(h,T)&&(Lt(h[T],o[T])||u.push({command:b,args:[f,T,o[T],m]}))}function Ut(h){return h.id}function kt(h,o){return h[o.id]=o,h}class $e{constructor(o,u,f,m){this.message=(o?`${o}: `:"")+f,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)}}function cr(h,...o){for(const u of o)for(const f in u)h[f]=u[f];return h}class Rr extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}class rn{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[f,m]of u)this.bindings[f]=m}concat(o){return new rn(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const vn={kind:"null"},xt={kind:"number"},Wt={kind:"string"},sr={kind:"boolean"},Qr={kind:"color"},Gr={kind:"projectionDefinition"},cn={kind:"object"},Yt={kind:"value"},un={kind:"collator"},nn={kind:"formatted"},wn={kind:"padding"},jr={kind:"colorArray"},Tn={kind:"numberArray"},Pn={kind:"resolvedImage"},dn={kind:"variableAnchorOffsetCollection"};function It(h,o){return{kind:"array",itemType:h,N:o}}function Hr(h){if(h.kind==="array"){const o=Hr(h.itemType);return typeof h.N=="number"?`array<${o}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${o}>`}return h.kind}const bn=[vn,xt,Wt,sr,Qr,Gr,nn,cn,It(Yt),wn,Tn,jr,Pn,dn];function fn(h,o){if(o.kind==="error")return null;if(h.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!fn(h.itemType,o.itemType))&&(typeof h.N!="number"||h.N===o.N))return null}else{if(h.kind===o.kind)return null;if(h.kind==="value"){for(const u of bn)if(!fn(u,o))return null}}return`Expected ${Hr(h)} but found ${Hr(o)} instead.`}function Mi(h,o){return o.some((u=>u.kind===h.kind))}function ls(h,o){return o.some((u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h))}function gi(h,o){return h.kind==="array"&&o.kind==="array"?h.itemType.kind===o.itemType.kind&&typeof h.N=="number":h.kind===o.kind}const zd=.96422,ll=.82521,dc=4/29,Po=6/29,cl=3*Po*Po,Ud=Po*Po*Po,Eu=Math.PI/180,Vd=180/Math.PI;function Pu(h){return(h%=360)<0&&(h+=360),h}function Iu([h,o,u,f]){let m,b;const T=Ca((.2225045*(h=io(h))+.7168786*(o=io(o))+.0606169*(u=io(u)))/1);h===o&&o===u?m=b=T:(m=Ca((.4360747*h+.3850649*o+.1430804*u)/zd),b=Ca((.0139322*h+.0971045*o+.7141733*u)/ll));const E=116*T-16;return[E<0?0:E,500*(m-T),200*(T-b),f]}function io(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Ca(h){return h>Ud?Math.pow(h,1/3):h/cl+dc}function Go([h,o,u,f]){let m=(h+16)/116,b=isNaN(o)?m:m+o/500,T=isNaN(u)?m:m-u/200;return m=1*pc(m),b=zd*pc(b),T=ll*pc(T),[fc(3.1338561*b-1.6168667*m-.4906146*T),fc(-.9787684*b+1.9161415*m+.033454*T),fc(.0719453*b-.2289914*m+1.4052427*T),f]}function fc(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function pc(h){return h>Po?h*h*h:cl*(h-dc)}const ks=Object.hasOwn||function(h,o){return Object.prototype.hasOwnProperty.call(h,o)};function Yo(h,o){return ks(h,o)?h[o]:void 0}function ul(h){return parseInt(h.padEnd(2,h),16)/255}function Cu(h,o){return Io(o?h/100:h,0,1)}function Io(h,o,u){return Math.min(Math.max(o,h),u)}function so(h){return!h.some(Number.isNaN)}const oo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Jr(h,o,u){return h+u*(o-h)}function zs(h,o,u){return h.map(((f,m)=>Jr(f,o[m],u)))}class Kr{constructor(o,u,f,m=1,b=!0){this.r=o,this.g=u,this.b=f,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[o,u,f,m]))}static parse(o){if(o instanceof Kr)return o;if(typeof o!="string")return;const u=(function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Yo(oo,f);if(m){const[T,E,C]=m;return[T/255,E/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const T=f.length<6?1:2;let E=1;return[ul(f.slice(E,E+=T)),ul(f.slice(E,E+=T)),ul(f.slice(E,E+=T)),ul(f.slice(E,E+T)||"ff")]}if(f.startsWith("rgb")){const T=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,C,O,F,W,q,K,J,ne,ce,Se,qe]=T,ke=[F||" ",K||" ",ce].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const ze=[O,q,ne].join(""),at=ze==="%%%"?100:ze===""?255:0;if(at){const _t=[Io(+C/at,0,1),Io(+W/at,0,1),Io(+J/at,0,1),Se?Cu(+Se,qe):1];if(so(_t))return _t}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,E,C,O,F,W,q,K,J]=b,ne=[C||" ",F||" ",q].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ce=[+E,Io(+O,0,100),Io(+W,0,100),K?Cu(+K,J):1];if(so(ce))return(function([Se,qe,ke,ze]){function at(_t){const Ft=(_t+Se/30)%12,tr=qe*Math.min(ke,1-ke);return ke-tr*Math.max(-1,Math.min(Ft-3,9-Ft,1))}return Se=Pu(Se),qe/=100,ke/=100,[at(0),at(8),at(4),ze]})(ce)}}})(o);return u?new Kr(...u,!1):void 0}get rgb(){const{r:o,g:u,b:f,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[o/b,u/b,f/b,m])}get hcl(){return this.overwriteGetter("hcl",(function(o){const[u,f,m,b]=Iu(o),T=Math.sqrt(f*f+m*m);return[Math.round(1e4*T)?Pu(Math.atan2(m,f)*Vd):NaN,T,u,b]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Iu(this.rgb))}overwriteGetter(o,u){return Object.defineProperty(this,o,{value:u}),u}toString(){const[o,u,f,m]=this.rgb;return`rgba(${[o,u,f].map((b=>Math.round(255*b))).join(",")},${m})`}static interpolate(o,u,f,m="rgb"){switch(m){case"rgb":{const[b,T,E,C]=zs(o.rgb,u.rgb,f);return new Kr(b,T,E,C,!1)}case"hcl":{const[b,T,E,C]=o.hcl,[O,F,W,q]=u.hcl;let K,J;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?K=NaN:(K=O,E!==1&&E!==0||(J=F)):(K=b,W!==1&&W!==0||(J=T));else{let ke=O-b;O>b&&ke>180?ke-=360:O<b&&b-O>180&&(ke+=360),K=b+f*ke}const[ne,ce,Se,qe]=(function([ke,ze,at,_t]){return ke=isNaN(ke)?0:ke*Eu,Go([at,Math.cos(ke)*ze,Math.sin(ke)*ze,_t])})([K,J??Jr(T,F,f),Jr(E,W,f),Jr(C,q,f)]);return new Kr(ne,ce,Se,qe,!1)}case"lab":{const[b,T,E,C]=Go(zs(o.lab,u.lab,f));return new Kr(b,T,E,C,!1)}}}}Kr.black=new Kr(0,0,0,1),Kr.white=new Kr(1,1,1,1),Kr.transparent=new Kr(0,0,0,0),Kr.red=new Kr(1,0,0,1);class Ru{constructor(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const gg=["bottom","center","top"];class gc{constructor(o,u,f,m,b,T){this.text=o,this.image=u,this.scale=f,this.fontStack=m,this.textColor=b,this.verticalAlign=T}}class $i{constructor(o){this.sections=o}static fromString(o){return new $i([new gc(o,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((o=>o.text.length!==0||o.image&&o.image.name.length!==0))}static factory(o){return o instanceof $i?o:$i.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map((o=>o.text)).join("")}}class ki{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof ki)return o;if(typeof o=="number")return new ki([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const u of o)if(typeof u!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new ki(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,u,f){return new ki(zs(o.values,u.values,f))}}class es{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof es)return o;if(typeof o=="number")return new es([o]);if(Array.isArray(o)){for(const u of o)if(typeof u!="number")return;return new es(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,u,f){return new es(zs(o.values,u.values,f))}}class Si{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Si)return o;if(typeof o=="string"){const f=Kr.parse(o);return f?new Si([f]):void 0}if(!Array.isArray(o))return;const u=[];for(const f of o){if(typeof f!="string")return;const m=Kr.parse(f);if(!m)return;u.push(m)}return new Si(u)}toString(){return JSON.stringify(this.values)}static interpolate(o,u,f,m="rgb"){const b=[];if(o.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${o.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let T=0;T<o.values.length;T++)b.push(Kr.interpolate(o.values[T],u.values[T],f,m));return new Si(b)}}class $n extends Error{constructor(o){super(o),this.name="RuntimeError"}toJSON(){return this.message}}const Oy=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Hi{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Hi)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let u=0;u<o.length;u+=2){const f=o[u],m=o[u+1];if(typeof f!="string"||!Oy.has(f)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Hi(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,u,f){const m=o.values,b=u.values;if(m.length!==b.length)throw new $n(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${u.toString()}`);const T=[];for(let E=0;E<m.length;E+=2){if(m[E]!==b[E])throw new $n(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${m[E]}, to[${E}]: ${b[E]}`);T.push(m[E]);const[C,O]=m[E+1],[F,W]=b[E+1];T.push([Jr(C,F,f),Jr(O,W,f)])}return new Hi(T)}}class Zi{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Zi({name:o,available:!1}):null}}class gs{constructor(o,u,f){this.from=o,this.to=u,this.transition=f}static interpolate(o,u,f){return new gs(o,u,f)}static parse(o){return o instanceof gs?o:Array.isArray(o)&&o.length===3&&typeof o[0]=="string"&&typeof o[1]=="string"&&typeof o[2]=="number"?new gs(o[0],o[1],o[2]):typeof o=="object"&&typeof o.from=="string"&&typeof o.to=="string"&&typeof o.transition=="number"?new gs(o.from,o.to,o.transition):typeof o=="string"?new gs(o,o,1):void 0}}function jd(h,o,u,f){return typeof h=="number"&&h>=0&&h<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[h,o,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[h,o,u,f]:[h,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hl(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof gs||h instanceof Kr||h instanceof Ru||h instanceof $i||h instanceof ki||h instanceof es||h instanceof Si||h instanceof Hi||h instanceof Zi)return!0;if(Array.isArray(h)){for(const o of h)if(!hl(o))return!1;return!0}if(typeof h=="object"){for(const o in h)if(!hl(h[o]))return!1;return!0}return!1}function Qn(h){if(h===null)return vn;if(typeof h=="string")return Wt;if(typeof h=="boolean")return sr;if(typeof h=="number")return xt;if(h instanceof Kr)return Qr;if(h instanceof gs)return Gr;if(h instanceof Ru)return un;if(h instanceof $i)return nn;if(h instanceof ki)return wn;if(h instanceof es)return Tn;if(h instanceof Si)return jr;if(h instanceof Hi)return dn;if(h instanceof Zi)return Pn;if(Array.isArray(h)){const o=h.length;let u;for(const f of h){const m=Qn(f);if(u){if(u===m)continue;u=Yt;break}u=m}return It(u||Yt,o)}return cn}function Mn(h){const o=typeof h;return h===null?"":o==="string"||o==="number"||o==="boolean"?String(h):h instanceof Kr||h instanceof gs||h instanceof $i||h instanceof ki||h instanceof es||h instanceof Si||h instanceof Hi||h instanceof Zi?h.toString():JSON.stringify(h)}class Co{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(o.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!hl(o[1]))return u.error("invalid value");const f=o[1];let m=Qn(f);const b=u.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Co(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const yn={string:Wt,number:xt,boolean:sr,object:cn};class Wr{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f,m=1;const b=o[0];if(b==="array"){let E,C;if(o.length>2){const O=o[1];if(typeof O!="string"||!(O in yn)||O==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=yn[O],m++}else E=Yt;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);C=o[2],m++}f=It(E,C)}else{if(!yn[b])throw new Error(`Types doesn't contain name = ${b}`);f=yn[b]}const T=[];for(;m<o.length;m++){const E=u.parse(o[m],m,Yt);if(!E)return null;T.push(E)}return new Wr(f,T)}evaluate(o){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(o);if(!fn(this.type,Qn(f)))return f;if(u===this.args.length-1)throw new $n(`Expected value to be of type ${Hr(this.type)}, but found ${Hr(Qn(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}const Mu={"to-boolean":sr,"to-color":Qr,"to-number":xt,"to-string":Wt};class on{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[0];if(!Mu[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return u.error("Expected one argument.");const m=Mu[f],b=[];for(let T=1;T<o.length;T++){const E=u.parse(o[T],T,Yt);if(!E)return null;b.push(E)}return new on(m,b)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let u,f;for(const m of this.args){if(u=m.evaluate(o),f=null,u instanceof Kr)return u;if(typeof u=="string"){const b=o.parseColor(u);if(b)return b}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:jd(u[0],u[1],u[2],u[3]),!f))return new Kr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new $n(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(o);const m=ki.parse(u);if(m)return m}throw new $n(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const f of this.args){u=f.evaluate(o);const m=es.parse(u);if(m)return m}throw new $n(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const f of this.args){u=f.evaluate(o);const m=Si.parse(u);if(m)return m}throw new $n(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(o);const m=Hi.parse(u);if(m)return m}throw new $n(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(o),u===null)return 0;const m=Number(u);if(!isNaN(m))return m}throw new $n(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return $i.fromString(Mn(this.args[0].evaluate(o)));case"resolvedImage":return Zi.fromString(Mn(this.args[0].evaluate(o)));case"projectionDefinition":return this.args[0].evaluate(o);default:return Mn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}const Wd=["Unknown","Point","LineString","Polygon"];class ao{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let u=this._parseColorCache.get(o);return u||(u=Kr.parse(o),this._parseColorCache.set(o,u)),u}}class dl{constructor(o,u,f=[],m,b=new rn,T=[]){this.registry=o,this.path=f,this.key=f.map((E=>`[${E}]`)).join(""),this.scope=b,this.errors=T,this.expectedType=m,this._isConstant=u}parse(o,u,f,m,b={}){return u?this.concat(u,f,m)._parse(o,b):this._parse(o,b)}_parse(o,u){function f(m,b,T){return T==="assert"?new Wr(b,[m]):T==="coerce"?new on(b,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=o[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let T=b.parse(o,this);if(!T)return null;if(this.expectedType){const E=this.expectedType,C=T.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||C.kind!=="value"){if(E.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(E.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(E.kind)&&["value","number","array"].includes(C.kind)||E.kind==="colorArray"&&["value","string","array"].includes(C.kind)||E.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))T=f(T,E,u.typeAnnotation||"coerce");else if(this.checkSubtype(E,C))return null}else T=f(T,E,u.typeAnnotation||"assert")}if(!(T instanceof Co)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const E=new ao;try{T=new Co(T.type,T.evaluate(E))}catch(C){return this.error(C.message),null}}return T}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,f){const m=typeof o=="number"?this.path.concat(o):this.path,b=f?this.scope.concat(f):this.scope;return new dl(this.registry,this._isConstant,m,u||null,b,this.errors)}error(o,...u){const f=`${this.key}${u.map((m=>`[${m}]`)).join("")}`;this.errors.push(new Rr(f,o))}checkSubtype(o,u){const f=fn(o,u);return f&&this.error(f),f}}class Ra{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let b=1;b<o.length-1;b+=2){const T=o[b];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,b);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",b);const E=u.parse(o[b+1],b+1);if(!E)return null;f.push([T,E])}const m=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return m?new Ra(f,m):null}outputDefined(){return this.result.outputDefined()}}class mc{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=o[1];return u.scope.has(f)?new mc(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class _c{constructor(o,u,f){this.type=o,this.index=u,this.input=f}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,xt),m=u.parse(o[2],2,It(u.expectedType||Yt));return f&&m?new _c(m.type.itemType,f,m):null}evaluate(o){const u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new $n(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new $n(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new $n(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class ku{constructor(o,u){this.type=sr,this.needle=o,this.haystack=u}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Yt),m=u.parse(o[2],2,Yt);return f&&m?Mi(f.type,[sr,Wt,xt,vn,Yt])?new ku(f,m):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(f.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!ls(u,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(Qn(u))} instead.`);if(!ls(f,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${Hr(Qn(f))} instead.`);return f.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Du{constructor(o,u,f){this.type=xt,this.needle=o,this.haystack=u,this.fromIndex=f}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Yt),m=u.parse(o[2],2,Yt);if(!f||!m)return null;if(!Mi(f.type,[sr,Wt,xt,vn,Yt]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(f.type)} instead`);if(o.length===4){const b=u.parse(o[3],3,xt);return b?new Du(f,m,b):null}return new Du(f,m)}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!ls(u,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(Qn(u))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(o)),ls(f,["string"])){const b=f.indexOf(u,m);return b===-1?-1:[...f.slice(0,b)].length}if(ls(f,["array"]))return f.indexOf(u,m);throw new $n(`Expected second argument to be of type array or string, but found ${Hr(Qn(f))} instead.`)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class Ou{constructor(o,u,f,m,b,T){this.inputType=o,this.type=u,this.input=f,this.cases=m,this.outputs=b,this.otherwise=T}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let f,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const b={},T=[];for(let O=2;O<o.length-1;O+=2){let F=o[O];const W=o[O+1];Array.isArray(F)||(F=[F]);const q=u.concat(O);if(F.length===0)return q.error("Expected at least one branch label.");for(const J of F){if(typeof J!="number"&&typeof J!="string")return q.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return q.error("Numeric branch labels must be integer values.");if(f){if(q.checkSubtype(f,Qn(J)))return null}else f=Qn(J);if(b[String(J)]!==void 0)return q.error("Branch labels must be unique.");b[String(J)]=T.length}const K=u.parse(W,O,m);if(!K)return null;m=m||K.type,T.push(K)}const E=u.parse(o[1],1,Yt);if(!E)return null;const C=u.parse(o[o.length-1],o.length-1,m);return C?E.type.kind!=="value"&&u.concat(1).checkSubtype(f,E.type)?null:new Ou(f,m,E,b,T,C):null}evaluate(o){const u=this.input.evaluate(o);return(Qn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))&&this.otherwise.outputDefined()}}class Fu{constructor(o,u,f){this.type=o,this.branches=u,this.otherwise=f}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const m=[];for(let T=1;T<o.length-1;T+=2){const E=u.parse(o[T],T,sr);if(!E)return null;const C=u.parse(o[T+1],T+1,f);if(!C)return null;m.push([E,C]),f=f||C.type}const b=u.parse(o[o.length-1],o.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new Fu(f,m,b)}evaluate(o){for(const[u,f]of this.branches)if(u.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,f]of this.branches)o(u),o(f);o(this.otherwise)}outputDefined(){return this.branches.every((([o,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}}class Us{constructor(o,u,f,m){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=m}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Yt),m=u.parse(o[2],2,xt);if(!f||!m)return null;if(!Mi(f.type,[It(Yt),Wt,Yt]))return u.error(`Expected first argument to be of type array or string, but found ${Hr(f.type)} instead`);if(o.length===4){const b=u.parse(o[3],3,xt);return b?new Us(f.type,f,m,b):null}return new Us(f.type,f,m)}evaluate(o){const u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);let m;if(this.endIndex&&(m=this.endIndex.evaluate(o)),ls(u,["string"]))return[...u].slice(f,m).join("");if(ls(u,["array"]))return u.slice(f,m);throw new $n(`Expected first argument to be of type array or string, but found ${Hr(Qn(u))} instead.`)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Ai(h,o){const u=h.length-1;let f,m,b=0,T=u,E=0;for(;b<=T;)if(E=Math.floor((b+T)/2),f=h[E],m=h[E+1],f<=o){if(E===u||o<m)return E;b=E+1}else{if(!(f>o))throw new $n("Input is not a number.");T=E-1}return 0}class Ko{constructor(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,b]of f)this.labels.push(m),this.outputs.push(b)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(o[1],1,xt);if(!f)return null;const m=[];let b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(let T=1;T<o.length;T+=2){const E=T===1?-1/0:o[T],C=o[T+1],O=T,F=T+1;if(typeof E!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(m.length&&m[m.length-1][0]>=E)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const W=u.parse(C,F,b);if(!W)return null;b=b||W.type,m.push([E,W])}return new Ko(b,f,m)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);const b=u.length;return m>=u[b-1]?f[b-1].evaluate(o):f[Ai(u,m)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))}}function mg(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var fl,Ei,_g=(function(){if(Ei)return fl;function h(o,u,f,m){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=u,this.p2x=f,this.p2y=m}return Ei=1,fl=h,h.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,u){if(u===void 0&&(u=1e-6),o<0)return 0;if(o>1)return 1;for(var f=o,m=0;m<8;m++){var b=this.sampleCurveX(f)-o;if(Math.abs(b)<u)return f;var T=this.sampleCurveDerivativeX(f);if(Math.abs(T)<1e-6)break;f-=b/T}var E=0,C=1;for(f=o,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-o)<u));m++)o>b?E=f:C=f,f=.5*(C-E)+E;return f},solve:function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))}},fl})(),$d=mg(_g);class cs{constructor(o,u,f,m,b){this.type=o,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[T,E]of b)this.labels.push(T),this.outputs.push(E)}static interpolationFactor(o,u,f,m){let b=0;if(o.name==="exponential")b=Hd(u,o.base,f,m);else if(o.name==="linear")b=Hd(u,1,f,m);else if(o.name==="cubic-bezier"){const T=o.controlPoints;b=new $d(T[0],T[1],T[2],T[3]).solve(Hd(u,1,f,m))}return b}static parse(o,u){let[f,m,b,...T]=o;if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const O=m[1];if(typeof O!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:O}}else{if(m[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const O=m.slice(1);if(O.length!==4||O.some((F=>typeof F!="number"||F<0||F>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:O}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(b=u.parse(b,2,xt),!b)return null;const E=[];let C=null;f!=="interpolate-hcl"&&f!=="interpolate-lab"||u.expectedType==jr?u.expectedType&&u.expectedType.kind!=="value"&&(C=u.expectedType):C=Qr;for(let O=0;O<T.length;O+=2){const F=T[O],W=T[O+1],q=O+3,K=O+4;if(typeof F!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(E.length&&E[E.length-1][0]>=F)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const J=u.parse(W,K,C);if(!J)return null;C=C||J.type,E.push([F,J])}return gi(C,xt)||gi(C,Gr)||gi(C,Qr)||gi(C,wn)||gi(C,Tn)||gi(C,jr)||gi(C,dn)||gi(C,It(xt))?new cs(C,f,m,b,E):u.error(`Type ${Hr(C)} is not interpolatable.`)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);const b=u.length;if(m>=u[b-1])return f[b-1].evaluate(o);const T=Ai(u,m),E=cs.interpolationFactor(this.interpolation,m,u[T],u[T+1]),C=f[T].evaluate(o),O=f[T+1].evaluate(o);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Jr(C,O,E);case"color":return Kr.interpolate(C,O,E);case"padding":return ki.interpolate(C,O,E);case"colorArray":return Si.interpolate(C,O,E);case"numberArray":return es.interpolate(C,O,E);case"variableAnchorOffsetCollection":return Hi.interpolate(C,O,E);case"array":return zs(C,O,E);case"projectionDefinition":return gs.interpolate(C,O,E)}case"interpolate-hcl":switch(this.type.kind){case"color":return Kr.interpolate(C,O,E,"hcl");case"colorArray":return Si.interpolate(C,O,E,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Kr.interpolate(C,O,E,"lab");case"colorArray":return Si.interpolate(C,O,E,"lab")}}}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every((o=>o.outputDefined()))}}function Hd(h,o,u,f){const m=f-u,b=h-u;return m===0?0:o===1?b/m:(Math.pow(o,b)-1)/(Math.pow(o,m)-1)}const us={color:Kr.interpolate,number:Jr,padding:ki.interpolate,numberArray:es.interpolate,colorArray:Si.interpolate,variableAnchorOffsetCollection:Hi.interpolate,array:zs};class Ma{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f=null;const m=u.expectedType;m&&m.kind!=="value"&&(f=m);const b=[];for(const E of o.slice(1)){const C=u.parse(E,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,b.push(C)}if(!f)throw new Error("No output type");const T=m&&b.some((E=>fn(m,E.type)));return new Ma(T?Yt:f,b)}evaluate(o){let u,f=null,m=0;for(const b of this.args)if(m++,f=b.evaluate(o),f&&f instanceof Zi&&!f.available&&(u||(u=f.name),f=null,m===this.args.length&&(f=u)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every((o=>o.outputDefined()))}}function Nu(h,o){return h==="=="||h==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function yg(h,o,u,f){return f.compare(o,u)===0}function ka(h,o,u){const f=h!=="=="&&h!=="!=";return class NE{constructor(b,T,E){this.type=sr,this.lhs=b,this.rhs=T,this.collator=E,this.hasUntypedArgument=b.type.kind==="value"||T.type.kind==="value"}static parse(b,T){if(b.length!==3&&b.length!==4)return T.error("Expected two or three arguments.");const E=b[0];let C=T.parse(b[1],1,Yt);if(!C)return null;if(!Nu(E,C.type))return T.concat(1).error(`"${E}" comparisons are not supported for type '${Hr(C.type)}'.`);let O=T.parse(b[2],2,Yt);if(!O)return null;if(!Nu(E,O.type))return T.concat(2).error(`"${E}" comparisons are not supported for type '${Hr(O.type)}'.`);if(C.type.kind!==O.type.kind&&C.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${Hr(C.type)}' and '${Hr(O.type)}'.`);f&&(C.type.kind==="value"&&O.type.kind!=="value"?C=new Wr(O.type,[C]):C.type.kind!=="value"&&O.type.kind==="value"&&(O=new Wr(C.type,[O])));let F=null;if(b.length===4){if(C.type.kind!=="string"&&O.type.kind!=="string"&&C.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(F=T.parse(b[3],3,un),!F)return null}return new NE(C,O,F)}evaluate(b){const T=this.lhs.evaluate(b),E=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const C=Qn(T),O=Qn(E);if(C.kind!==O.kind||C.kind!=="string"&&C.kind!=="number")throw new $n(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${C.kind}, ${O.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=Qn(T),O=Qn(E);if(C.kind!=="string"||O.kind!=="string")return o(b,T,E)}return this.collator?u(b,T,E,this.collator.evaluate(b)):o(b,T,E)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Lu=ka("==",(function(h,o,u){return o===u}),yg),Bu=ka("!=",(function(h,o,u){return o!==u}),(function(h,o,u,f){return!yg(0,o,u,f)})),Vs=ka("<",(function(h,o,u){return o<u}),(function(h,o,u,f){return f.compare(o,u)<0})),vg=ka(">",(function(h,o,u){return o>u}),(function(h,o,u,f){return f.compare(o,u)>0})),zu=ka("<=",(function(h,o,u){return o<=u}),(function(h,o,u,f){return f.compare(o,u)<=0})),Fy=ka(">=",(function(h,o,u){return o>=u}),(function(h,o,u,f){return f.compare(o,u)>=0}));class pl{constructor(o,u,f){this.type=un,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(o.length!==2)return u.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const m=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,sr);if(!m)return null;const b=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,sr);if(!b)return null;let T=null;return f.locale&&(T=u.parse(f.locale,1,Wt),!T)?null:new pl(m,b,T)}evaluate(o){return new Ru(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class Zd{constructor(o,u,f,m,b){this.type=Wt,this.number=o,this.locale=u,this.currency=f,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(o,u){if(o.length!==3)return u.error("Expected two arguments.");const f=u.parse(o[1],1,xt);if(!f)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=u.parse(m.locale,1,Wt),!b))return null;let T=null;if(m.currency&&(T=u.parse(m.currency,1,Wt),!T))return null;let E=null;if(m["min-fraction-digits"]&&(E=u.parse(m["min-fraction-digits"],1,xt),!E))return null;let C=null;return m["max-fraction-digits"]&&(C=u.parse(m["max-fraction-digits"],1,xt),!C)?null:new Zd(f,b,T,E,C)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Uu{constructor(o){this.type=nn,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const m=[];let b=!1;for(let T=1;T<=o.length-1;++T){const E=o[T];if(b&&typeof E=="object"&&!Array.isArray(E)){b=!1;let C=null;if(E["font-scale"]&&(C=u.parse(E["font-scale"],1,xt),!C))return null;let O=null;if(E["text-font"]&&(O=u.parse(E["text-font"],1,It(Wt)),!O))return null;let F=null;if(E["text-color"]&&(F=u.parse(E["text-color"],1,Qr),!F))return null;let W=null;if(E["vertical-align"]){if(typeof E["vertical-align"]=="string"&&!gg.includes(E["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${E["vertical-align"]}' instead.`);if(W=u.parse(E["vertical-align"],1,Wt),!W)return null}const q=m[m.length-1];q.scale=C,q.font=O,q.textColor=F,q.verticalAlign=W}else{const C=u.parse(o[T],1,Yt);if(!C)return null;const O=C.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Uu(m)}evaluate(o){return new $i(this.sections.map((u=>{const f=u.content.evaluate(o);return Qn(f)===Pn?new gc("",f,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(o):null):new gc(Mn(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null,u.verticalAlign?u.verticalAlign.evaluate(o):null)})))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor),u.verticalAlign&&o(u.verticalAlign)}outputDefined(){return!1}}class Xd{constructor(o){this.type=Pn,this.input=o}static parse(o,u){if(o.length!==2)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Wt);return f?new Xd(f):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),f=Zi.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class qd{constructor(o){this.type=xt,this.input=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=u.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Hr(f.type)} instead.`):new qd(f):null}evaluate(o){const u=this.input.evaluate(o);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new $n(`Expected value to be of type string or array, but found ${Hr(Qn(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const Ts=8192;function Ny(h,o){const u=(180+h[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(u*m*Ts),Math.round(f*m*Ts)]}function Vu(h,o){const u=Math.pow(2,o.z);return[(m=(h[0]/Ts+o.x)/u,360*m-180),(f=(h[1]/Ts+o.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,m}function gl(h,o){h[0]=Math.min(h[0],o[0]),h[1]=Math.min(h[1],o[1]),h[2]=Math.max(h[2],o[0]),h[3]=Math.max(h[3],o[1])}function yc(h,o){return!(h[0]<=o[0]||h[2]>=o[2]||h[1]<=o[1]||h[3]>=o[3])}function bg(h,o,u){const f=h[0]-o[0],m=h[1]-o[1],b=h[0]-u[0],T=h[1]-u[1];return f*T-b*m==0&&f*b<=0&&m*T<=0}function ju(h,o,u,f){return(m=[f[0]-u[0],f[1]-u[1]])[0]*(b=[o[0]-h[0],o[1]-h[1]])[1]-m[1]*b[0]!=0&&!(!Gd(h,o,u,f)||!Gd(u,f,h,o));var m,b}function Ly(h,o,u){for(const f of u)for(let m=0;m<f.length-1;++m)if(ju(h,o,f[m],f[m+1]))return!0;return!1}function ml(h,o,u=!1){let f=!1;for(const E of o)for(let C=0;C<E.length-1;C++){if(bg(h,E[C],E[C+1]))return u;(b=E[C])[1]>(m=h)[1]!=(T=E[C+1])[1]>m[1]&&m[0]<(T[0]-b[0])*(m[1]-b[1])/(T[1]-b[1])+b[0]&&(f=!f)}var m,b,T;return f}function By(h,o){for(const u of o)if(ml(h,u))return!0;return!1}function xg(h,o){for(const u of h)if(!ml(u,o))return!1;for(let u=0;u<h.length-1;++u)if(Ly(h[u],h[u+1],o))return!1;return!0}function wg(h,o){for(const u of o)if(xg(h,u))return!0;return!1}function Gd(h,o,u,f){const m=f[0]-u[0],b=f[1]-u[1],T=(h[0]-u[0])*b-m*(h[1]-u[1]),E=(o[0]-u[0])*b-m*(o[1]-u[1]);return T>0&&E<0||T<0&&E>0}function Wu(h,o,u){const f=[];for(let m=0;m<h.length;m++){const b=[];for(let T=0;T<h[m].length;T++){const E=Ny(h[m][T],u);gl(o,E),b.push(E)}f.push(b)}return f}function Tg(h,o,u){const f=[];for(let m=0;m<h.length;m++){const b=Wu(h[m],o,u);f.push(b)}return f}function Sg(h,o,u,f){if(h[0]<u[0]||h[0]>u[2]){const m=.5*f;let b=h[0]-u[0]>m?-f:u[0]-h[0]>m?f:0;b===0&&(b=h[0]-u[2]>m?-f:u[2]-h[0]>m?f:0),h[0]+=b}gl(o,h)}function Ag(h,o,u,f){const m=Math.pow(2,f.z)*Ts,b=[f.x*Ts,f.y*Ts],T=[];for(const E of h)for(const C of E){const O=[C.x+b[0],C.y+b[1]];Sg(O,o,u,m),T.push(O)}return T}function Eg(h,o,u,f){const m=Math.pow(2,f.z)*Ts,b=[f.x*Ts,f.y*Ts],T=[];for(const C of h){const O=[];for(const F of C){const W=[F.x+b[0],F.y+b[1]];gl(o,W),O.push(W)}T.push(O)}if(o[2]-o[0]<=m/2){(E=o)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const C of T)for(const O of C)Sg(O,o,u,m)}var E;return T}class lo{constructor(o,u){this.type=sr,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(hl(o[1])){const f=o[1];if(f.type==="FeatureCollection"){const m=[];for(const b of f.features){const{type:T,coordinates:E}=b.geometry;T==="Polygon"&&m.push(E),T==="MultiPolygon"&&m.push(...E)}if(m.length)return new lo(f,{type:"MultiPolygon",coordinates:m})}else if(f.type==="Feature"){const m=f.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new lo(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new lo(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return(function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const E=Wu(f.coordinates,b,T),C=Ag(u.geometry(),m,b,T);if(!yc(m,b))return!1;for(const O of C)if(!ml(O,E))return!1}if(f.type==="MultiPolygon"){const E=Tg(f.coordinates,b,T),C=Ag(u.geometry(),m,b,T);if(!yc(m,b))return!1;for(const O of C)if(!By(O,E))return!1}return!0})(o,this.geometries);if(o.geometryType()==="LineString")return(function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const E=Wu(f.coordinates,b,T),C=Eg(u.geometry(),m,b,T);if(!yc(m,b))return!1;for(const O of C)if(!xg(O,E))return!1}if(f.type==="MultiPolygon"){const E=Tg(f.coordinates,b,T),C=Eg(u.geometry(),m,b,T);if(!yc(m,b))return!1;for(const O of C)if(!wg(O,E))return!1}return!0})(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Pg=class{constructor(h=[],o=(u,f)=>u<f?-1:u>f?1:0){if(this.data=h,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:o,compare:u}=this,f=o[h];for(;h>0;){const m=h-1>>1,b=o[m];if(u(f,b)>=0)break;o[h]=b,h=m}o[h]=f}_down(h){const{data:o,compare:u}=this,f=this.length>>1,m=o[h];for(;h<f;){let b=1+(h<<1);const T=b+1;if(T<this.length&&u(o[T],o[b])<0&&(b=T),u(o[b],m)>=0)break;o[h]=o[b],h=b}o[h]=m}};function Ig(h,o,u=0,f=h.length-1,m=zy){for(;f>u;){if(f-u>600){const C=f-u+1,O=o-u+1,F=Math.log(C),W=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*W*(C-W)/C)*(O-C/2<0?-1:1);Ig(h,o,Math.max(u,Math.floor(o-O*W/C+q)),Math.min(f,Math.floor(o+(C-O)*W/C+q)),m)}const b=h[o];let T=u,E=f;for(vc(h,u,o),m(h[f],b)>0&&vc(h,u,f);T<E;){for(vc(h,T,E),T++,E--;m(h[T],b)<0;)T++;for(;m(h[E],b)>0;)E--}m(h[u],b)===0?vc(h,u,E):(E++,vc(h,E,f)),E<=o&&(u=E+1),o<=E&&(f=E-1)}}function vc(h,o,u){const f=h[o];h[o]=h[u],h[u]=f}function zy(h,o){return h<o?-1:h>o?1:0}function _l(h,o){if(h.length<=1)return[h];const u=[];let f,m;for(const b of h){const T=Uy(b);T!==0&&(b.area=Math.abs(T),m===void 0&&(m=T<0),m===T<0?(f&&u.push(f),f=[b]):f.push(b))}if(f&&u.push(f),o>1)for(let b=0;b<u.length;b++)u[b].length<=o||(Ig(u[b],o,1,u[b].length-1,Cg),u[b]=u[b].slice(0,o));return u}function Cg(h,o){return o.area-h.area}function Uy(h){let o=0;for(let u,f,m=0,b=h.length,T=b-1;m<b;T=m++)u=h[m],f=h[T],o+=(f.x-u.x)*(u.y+f.y);return o}const Rg=1/298.257223563,Yd=Rg*(2-Rg),Kd=Math.PI/180;class Qd{constructor(o){const u=6378.137*Kd*1e3,f=Math.cos(o*Kd),m=1/(1-Yd*(1-f*f)),b=Math.sqrt(m);this.kx=u*b*f,this.ky=u*b*m*(1-Yd)}distance(o,u){const f=this.wrap(o[0]-u[0])*this.kx,m=(o[1]-u[1])*this.ky;return Math.sqrt(f*f+m*m)}pointOnLine(o,u){let f,m,b,T,E=1/0;for(let C=0;C<o.length-1;C++){let O=o[C][0],F=o[C][1],W=this.wrap(o[C+1][0]-O)*this.kx,q=(o[C+1][1]-F)*this.ky,K=0;W===0&&q===0||(K=(this.wrap(u[0]-O)*this.kx*W+(u[1]-F)*this.ky*q)/(W*W+q*q),K>1?(O=o[C+1][0],F=o[C+1][1]):K>0&&(O+=W/this.kx*K,F+=q/this.ky*K)),W=this.wrap(u[0]-O)*this.kx,q=(u[1]-F)*this.ky;const J=W*W+q*q;J<E&&(E=J,f=O,m=F,b=C,T=K)}return{point:[f,m],index:b,t:Math.max(0,Math.min(1,T))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function Mg(h,o){return o[0]-h[0]}function $u(h){return h[1]-h[0]+1}function co(h,o){return h[1]>=h[0]&&h[1]<o}function Jd(h,o){if(h[0]>h[1])return[null,null];const u=$u(h);if(o){if(u===2)return[h,null];const m=Math.floor(u/2);return[[h[0],h[0]+m],[h[0]+m,h[1]]]}if(u===1)return[h,null];const f=Math.floor(u/2)-1;return[[h[0],h[0]+f],[h[0]+f+1,h[1]]]}function ef(h,o){if(!co(o,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let f=o[0];f<=o[1];++f)gl(u,h[f]);return u}function tf(h){const o=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const f of u)gl(o,f);return o}function kg(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Sn(h,o,u){if(!kg(h)||!kg(o))return NaN;let f=0,m=0;return h[2]<o[0]&&(f=o[0]-h[2]),h[0]>o[2]&&(f=h[0]-o[2]),h[1]>o[3]&&(m=h[1]-o[3]),h[3]<o[1]&&(m=o[1]-h[3]),u.distance([0,0],[f,m])}function Da(h,o,u){const f=u.pointOnLine(o,h);return u.distance(h,f.point)}function rf(h,o,u,f,m){const b=Math.min(Da(h,[u,f],m),Da(o,[u,f],m)),T=Math.min(Da(u,[h,o],m),Da(f,[h,o],m));return Math.min(b,T)}function Vy(h,o,u,f,m){if(!co(o,h.length)||!co(f,u.length))return 1/0;let b=1/0;for(let T=o[0];T<o[1];++T){const E=h[T],C=h[T+1];for(let O=f[0];O<f[1];++O){const F=u[O],W=u[O+1];if(ju(E,C,F,W))return 0;b=Math.min(b,rf(E,C,F,W,m))}}return b}function jy(h,o,u,f,m){if(!co(o,h.length)||!co(f,u.length))return NaN;let b=1/0;for(let T=o[0];T<=o[1];++T)for(let E=f[0];E<=f[1];++E)if(b=Math.min(b,m.distance(h[T],u[E])),b===0)return b;return b}function Wy(h,o,u){if(ml(h,o,!0))return 0;let f=1/0;for(const m of o){const b=m[0],T=m[m.length-1];if(b!==T&&(f=Math.min(f,Da(h,[T,b],u)),f===0))return f;const E=u.pointOnLine(m,h);if(f=Math.min(f,u.distance(h,E.point)),f===0)return f}return f}function $y(h,o,u,f){if(!co(o,h.length))return NaN;for(let b=o[0];b<=o[1];++b)if(ml(h[b],u,!0))return 0;let m=1/0;for(let b=o[0];b<o[1];++b){const T=h[b],E=h[b+1];for(const C of u)for(let O=0,F=C.length,W=F-1;O<F;W=O++){const q=C[W],K=C[O];if(ju(T,E,q,K))return 0;m=Math.min(m,rf(T,E,q,K,f))}}return m}function Dg(h,o){for(const u of h)for(const f of u)if(ml(f,o,!0))return!0;return!1}function Hy(h,o,u,f=1/0){const m=tf(h),b=tf(o);if(f!==1/0&&Sn(m,b,u)>=f)return f;if(yc(m,b)){if(Dg(h,o))return 0}else if(Dg(o,h))return 0;let T=1/0;for(const E of h)for(let C=0,O=E.length,F=O-1;C<O;F=C++){const W=E[F],q=E[C];for(const K of o)for(let J=0,ne=K.length,ce=ne-1;J<ne;ce=J++){const Se=K[ce],qe=K[J];if(ju(W,q,Se,qe))return 0;T=Math.min(T,rf(W,q,Se,qe,u))}}return T}function Og(h,o,u,f,m,b){if(!b)return;const T=Sn(ef(f,b),m,u);T<o&&h.push([T,b,[0,0]])}function Hu(h,o,u,f,m,b,T){if(!b||!T)return;const E=Sn(ef(f,b),ef(m,T),u);E<o&&h.push([E,b,T])}function Zu(h,o,u,f,m=1/0){let b=Math.min(f.distance(h[0],u[0][0]),m);if(b===0)return b;const T=new Pg([[0,[0,h.length-1],[0,0]]],Mg),E=tf(u);for(;T.length>0;){const C=T.pop();if(C[0]>=b)continue;const O=C[1],F=o?50:100;if($u(O)<=F){if(!co(O,h.length))return NaN;if(o){const W=$y(h,O,u,f);if(isNaN(W)||W===0)return W;b=Math.min(b,W)}else for(let W=O[0];W<=O[1];++W){const q=Wy(h[W],u,f);if(b=Math.min(b,q),b===0)return 0}}else{const W=Jd(O,o);Og(T,b,f,h,E,W[0]),Og(T,b,f,h,E,W[1])}}return b}function Xu(h,o,u,f,m,b=1/0){let T=Math.min(b,m.distance(h[0],u[0]));if(T===0)return T;const E=new Pg([[0,[0,h.length-1],[0,u.length-1]]],Mg);for(;E.length>0;){const C=E.pop();if(C[0]>=T)continue;const O=C[1],F=C[2],W=o?50:100,q=f?50:100;if($u(O)<=W&&$u(F)<=q){if(!co(O,h.length)&&co(F,u.length))return NaN;let K;if(o&&f)K=Vy(h,O,u,F,m),T=Math.min(T,K);else if(o&&!f){const J=h.slice(O[0],O[1]+1);for(let ne=F[0];ne<=F[1];++ne)if(K=Da(u[ne],J,m),T=Math.min(T,K),T===0)return T}else if(!o&&f){const J=u.slice(F[0],F[1]+1);for(let ne=O[0];ne<=O[1];++ne)if(K=Da(h[ne],J,m),T=Math.min(T,K),T===0)return T}else K=jy(h,O,u,F,m),T=Math.min(T,K)}else{const K=Jd(O,o),J=Jd(F,f);Hu(E,T,m,h,u,K[0],J[0]),Hu(E,T,m,h,u,K[0],J[1]),Hu(E,T,m,h,u,K[1],J[0]),Hu(E,T,m,h,u,K[1],J[1])}}return T}function nf(h){return h.type==="MultiPolygon"?h.coordinates.map((o=>({type:"Polygon",coordinates:o}))):h.type==="MultiLineString"?h.coordinates.map((o=>({type:"LineString",coordinates:o}))):h.type==="MultiPoint"?h.coordinates.map((o=>({type:"Point",coordinates:o}))):[h]}class Oa{constructor(o,u){this.type=xt,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(hl(o[1])){const f=o[1];if(f.type==="FeatureCollection")return new Oa(f,f.features.map((m=>nf(m.geometry))).flat());if(f.type==="Feature")return new Oa(f,nf(f.geometry));if("type"in f&&"coordinates"in f)return new Oa(f,nf(f))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return(function(u,f){const m=u.geometry(),b=m.flat().map((C=>Vu([C.x,C.y],u.canonical)));if(m.length===0)return NaN;const T=new Qd(b[0][1]);let E=1/0;for(const C of f){switch(C.type){case"Point":E=Math.min(E,Xu(b,!1,[C.coordinates],!1,T,E));break;case"LineString":E=Math.min(E,Xu(b,!1,C.coordinates,!0,T,E));break;case"Polygon":E=Math.min(E,Zu(b,!1,C.coordinates,T,E))}if(E===0)return E}return E})(o,this.geometries);if(o.geometryType()==="LineString")return(function(u,f){const m=u.geometry(),b=m.flat().map((C=>Vu([C.x,C.y],u.canonical)));if(m.length===0)return NaN;const T=new Qd(b[0][1]);let E=1/0;for(const C of f){switch(C.type){case"Point":E=Math.min(E,Xu(b,!0,[C.coordinates],!1,T,E));break;case"LineString":E=Math.min(E,Xu(b,!0,C.coordinates,!0,T,E));break;case"Polygon":E=Math.min(E,Zu(b,!0,C.coordinates,T,E))}if(E===0)return E}return E})(o,this.geometries);if(o.geometryType()==="Polygon")return(function(u,f){const m=u.geometry();if(m.length===0||m[0].length===0)return NaN;const b=_l(m,0).map((C=>C.map((O=>O.map((F=>Vu([F.x,F.y],u.canonical))))))),T=new Qd(b[0][0][0][1]);let E=1/0;for(const C of f)for(const O of b){switch(C.type){case"Point":E=Math.min(E,Zu([C.coordinates],!1,O,T,E));break;case"LineString":E=Math.min(E,Zu(C.coordinates,!0,O,T,E));break;case"Polygon":E=Math.min(E,Hy(O,C.coordinates,T,E))}if(E===0)return E}return E})(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class bc{constructor(o){this.type=Yt,this.key=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=o[1];return f==null?u.error("Global state property must be defined."):typeof f!="string"?u.error(`Global state property must be string, but found ${typeof o[1]} instead.`):new bc(f)}evaluate(o){var u;const f=(u=o.globals)===null||u===void 0?void 0:u.globalState;return f&&Object.keys(f).length!==0?Yo(f,this.key):null}eachChild(){}outputDefined(){return!1}}const yl={"==":Lu,"!=":Bu,">":vg,"<":Vs,">=":Fy,"<=":zu,array:Wr,at:_c,boolean:Wr,case:Fu,coalesce:Ma,collator:pl,format:Uu,image:Xd,in:ku,"index-of":Du,interpolate:cs,"interpolate-hcl":cs,"interpolate-lab":cs,length:qd,let:Ra,literal:Co,match:Ou,number:Wr,"number-format":Zd,object:Wr,slice:Us,step:Ko,string:Wr,"to-boolean":on,"to-color":on,"to-number":on,"to-string":on,var:mc,within:lo,distance:Oa,"global-state":bc};class Ds{constructor(o,u,f,m){this.name=o,this.type=u,this._evaluate=f,this.args=m}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,u){const f=o[0],m=Ds.definitions[f];if(!m)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,T=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,E=T.filter((([O])=>!Array.isArray(O)||O.length===o.length-1));let C=null;for(const[O,F]of E){C=new dl(u.registry,qu,u.path,null,u.scope);const W=[];let q=!1;for(let K=1;K<o.length;K++){const J=o[K],ne=Array.isArray(O)?O[K-1]:O.type,ce=C.parse(J,1+W.length,ne);if(!ce){q=!0;break}W.push(ce)}if(!q)if(Array.isArray(O)&&O.length!==W.length)C.error(`Expected ${O.length} arguments, but found ${W.length} instead.`);else{for(let K=0;K<W.length;K++){const J=Array.isArray(O)?O[K]:O.type,ne=W[K];C.concat(K+1).checkSubtype(J,ne.type)}if(C.errors.length===0)return new Ds(f,b,F,W)}}if(E.length===1)u.errors.push(...C.errors);else{const O=(E.length?E:T).map((([W])=>{return q=W,Array.isArray(q)?`(${q.map(Hr).join(", ")})`:`(${Hr(q.type)}...)`;var q})).join(" | "),F=[];for(let W=1;W<o.length;W++){const q=u.parse(o[W],1+F.length);if(!q)return null;F.push(Hr(q.type))}u.error(`Expected arguments of type ${O}, but found (${F.join(", ")}) instead.`)}return null}static register(o,u){Ds.definitions=u;for(const f in u)o[f]=Ds}}function Fg(h,[o,u,f,m]){o=o.evaluate(h),u=u.evaluate(h),f=f.evaluate(h);const b=m?m.evaluate(h):1,T=jd(o,u,f,b);if(T)throw new $n(T);return new Kr(o/255,u/255,f/255,b,!1)}function Ng(h,o){return h in o}function sf(h,o){const u=o[h];return u===void 0?null:u}function Fa(h){return{type:h}}function qu(h){if(h instanceof mc)return qu(h.boundExpression);if(h instanceof Ds&&h.name==="error"||h instanceof pl||h instanceof lo||h instanceof Oa||h instanceof bc)return!1;const o=h instanceof on||h instanceof Wr;let u=!0;return h.eachChild((f=>{u=o?u&&qu(f):u&&f instanceof Co})),!!u&&Gu(h)&&Yu(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Gu(h){if(h instanceof Ds&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof lo||h instanceof Oa)return!1;let o=!0;return h.eachChild((u=>{o&&!Gu(u)&&(o=!1)})),o}function xc(h){if(h instanceof Ds&&h.name==="feature-state")return!1;let o=!0;return h.eachChild((u=>{o&&!xc(u)&&(o=!1)})),o}function Yu(h,o){if(h instanceof Ds&&o.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild((f=>{u&&!Yu(f,o)&&(u=!1)})),u}function Lg(h){return{result:"success",value:h}}function vl(h){return{result:"error",value:h}}function bl(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function Bg(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function of(h){return!!h.expression&&h.expression.interpolated}function hn(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function xl(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Qn(h)===cn}function Zy(h){return h}function zg(h,o){const u=h.stops&&typeof h.stops[0][0]=="object",f=u||!(u||h.property!==void 0),m=h.type||(of(o)?"exponential":"interval"),b=(function(F){switch(F.type){case"color":return Kr.parse;case"padding":return ki.parse;case"numberArray":return es.parse;case"colorArray":return Si.parse;default:return null}})(o);if(b&&((h=cr({},h)).stops&&(h.stops=h.stops.map((F=>[F[0],b(F[1])]))),h.default=b(h.default?h.default:o.default)),h.colorSpace&&(T=h.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var T;const E=(function(F){switch(F){case"exponential":return Vg;case"interval":return Xy;case"categorical":return Ug;case"identity":return Ku;default:throw new Error(`Unknown function type "${F}"`)}})(m);let C,O;if(m==="categorical"){C=Object.create(null);for(const F of h.stops)C[F[0]]=F[1];O=typeof h.stops[0][0]}if(u){const F={},W=[];for(let J=0;J<h.stops.length;J++){const ne=h.stops[J],ce=ne[0].zoom;F[ce]===void 0&&(F[ce]={zoom:ce,type:h.type,property:h.property,default:h.default,stops:[]},W.push(ce)),F[ce].stops.push([ne[0].value,ne[1]])}const q=[];for(const J of W)q.push([F[J].zoom,zg(F[J],o)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:cs.interpolationFactor.bind(void 0,K),zoomStops:q.map((J=>J[0])),evaluate:({zoom:J},ne)=>Vg({stops:q,base:h.base},o,J).evaluate(J,ne)}}if(f){const F=m==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:cs.interpolationFactor.bind(void 0,F),zoomStops:h.stops.map((W=>W[0])),evaluate:({zoom:W})=>E(h,o,W,C,O)}}return{kind:"source",evaluate(F,W){const q=W&&W.properties?W.properties[h.property]:void 0;return q===void 0?wc(h.default,o.default):E(h,o,q,C,O)}}}function wc(h,o,u){return h!==void 0?h:o!==void 0?o:u!==void 0?u:void 0}function Ug(h,o,u,f,m){return wc(typeof u===m?f[u]:void 0,h.default,o.default)}function Xy(h,o,u){if(hn(u)!=="number")return wc(h.default,o.default);const f=h.stops.length;if(f===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[f-1][0])return h.stops[f-1][1];const m=Ai(h.stops.map((b=>b[0])),u);return h.stops[m][1]}function Vg(h,o,u){const f=h.base!==void 0?h.base:1;if(hn(u)!=="number")return wc(h.default,o.default);const m=h.stops.length;if(m===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[m-1][0])return h.stops[m-1][1];const b=Ai(h.stops.map((F=>F[0])),u),T=(function(F,W,q,K){const J=K-q,ne=F-q;return J===0?0:W===1?ne/J:(Math.pow(W,ne)-1)/(Math.pow(W,J)-1)})(u,f,h.stops[b][0],h.stops[b+1][0]),E=h.stops[b][1],C=h.stops[b+1][1],O=us[o.type]||Zy;return typeof E.evaluate=="function"?{evaluate(...F){const W=E.evaluate.apply(void 0,F),q=C.evaluate.apply(void 0,F);if(W!==void 0&&q!==void 0)return O(W,q,T,h.colorSpace)}}:O(E,C,T,h.colorSpace)}function Ku(h,o,u){switch(o.type){case"color":u=Kr.parse(u);break;case"formatted":u=$i.fromString(u.toString());break;case"resolvedImage":u=Zi.fromString(u.toString());break;case"padding":u=ki.parse(u);break;case"colorArray":u=Si.parse(u);break;case"numberArray":u=es.parse(u);break;default:hn(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0)}return wc(u,h.default,o.default)}Ds.register(yl,{error:[{kind:"error"},[Wt],(h,[o])=>{throw new $n(o.evaluate(h))}],typeof:[Wt,[Yt],(h,[o])=>Hr(Qn(o.evaluate(h)))],"to-rgba":[It(xt,4),[Qr],(h,[o])=>{const[u,f,m,b]=o.evaluate(h).rgb;return[255*u,255*f,255*m,b]}],rgb:[Qr,[xt,xt,xt],Fg],rgba:[Qr,[xt,xt,xt,xt],Fg],has:{type:sr,overloads:[[[Wt],(h,[o])=>Ng(o.evaluate(h),h.properties())],[[Wt,cn],(h,[o,u])=>Ng(o.evaluate(h),u.evaluate(h))]]},get:{type:Yt,overloads:[[[Wt],(h,[o])=>sf(o.evaluate(h),h.properties())],[[Wt,cn],(h,[o,u])=>sf(o.evaluate(h),u.evaluate(h))]]},"feature-state":[Yt,[Wt],(h,[o])=>sf(o.evaluate(h),h.featureState||{})],properties:[cn,[],h=>h.properties()],"geometry-type":[Wt,[],h=>h.geometryType()],id:[Yt,[],h=>h.id()],zoom:[xt,[],h=>h.globals.zoom],"heatmap-density":[xt,[],h=>h.globals.heatmapDensity||0],elevation:[xt,[],h=>h.globals.elevation||0],"line-progress":[xt,[],h=>h.globals.lineProgress||0],accumulated:[Yt,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[xt,Fa(xt),(h,o)=>{let u=0;for(const f of o)u+=f.evaluate(h);return u}],"*":[xt,Fa(xt),(h,o)=>{let u=1;for(const f of o)u*=f.evaluate(h);return u}],"-":{type:xt,overloads:[[[xt,xt],(h,[o,u])=>o.evaluate(h)-u.evaluate(h)],[[xt],(h,[o])=>-o.evaluate(h)]]},"/":[xt,[xt,xt],(h,[o,u])=>o.evaluate(h)/u.evaluate(h)],"%":[xt,[xt,xt],(h,[o,u])=>o.evaluate(h)%u.evaluate(h)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(h,[o,u])=>Math.pow(o.evaluate(h),u.evaluate(h))],sqrt:[xt,[xt],(h,[o])=>Math.sqrt(o.evaluate(h))],log10:[xt,[xt],(h,[o])=>Math.log(o.evaluate(h))/Math.LN10],ln:[xt,[xt],(h,[o])=>Math.log(o.evaluate(h))],log2:[xt,[xt],(h,[o])=>Math.log(o.evaluate(h))/Math.LN2],sin:[xt,[xt],(h,[o])=>Math.sin(o.evaluate(h))],cos:[xt,[xt],(h,[o])=>Math.cos(o.evaluate(h))],tan:[xt,[xt],(h,[o])=>Math.tan(o.evaluate(h))],asin:[xt,[xt],(h,[o])=>Math.asin(o.evaluate(h))],acos:[xt,[xt],(h,[o])=>Math.acos(o.evaluate(h))],atan:[xt,[xt],(h,[o])=>Math.atan(o.evaluate(h))],min:[xt,Fa(xt),(h,o)=>Math.min(...o.map((u=>u.evaluate(h))))],max:[xt,Fa(xt),(h,o)=>Math.max(...o.map((u=>u.evaluate(h))))],abs:[xt,[xt],(h,[o])=>Math.abs(o.evaluate(h))],round:[xt,[xt],(h,[o])=>{const u=o.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[xt,[xt],(h,[o])=>Math.floor(o.evaluate(h))],ceil:[xt,[xt],(h,[o])=>Math.ceil(o.evaluate(h))],"filter-==":[sr,[Wt,Yt],(h,[o,u])=>h.properties()[o.value]===u.value],"filter-id-==":[sr,[Yt],(h,[o])=>h.id()===o.value],"filter-type-==":[sr,[Wt],(h,[o])=>h.geometryType()===o.value],"filter-<":[sr,[Wt,Yt],(h,[o,u])=>{const f=h.properties()[o.value],m=u.value;return typeof f==typeof m&&f<m}],"filter-id-<":[sr,[Yt],(h,[o])=>{const u=h.id(),f=o.value;return typeof u==typeof f&&u<f}],"filter->":[sr,[Wt,Yt],(h,[o,u])=>{const f=h.properties()[o.value],m=u.value;return typeof f==typeof m&&f>m}],"filter-id->":[sr,[Yt],(h,[o])=>{const u=h.id(),f=o.value;return typeof u==typeof f&&u>f}],"filter-<=":[sr,[Wt,Yt],(h,[o,u])=>{const f=h.properties()[o.value],m=u.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[sr,[Yt],(h,[o])=>{const u=h.id(),f=o.value;return typeof u==typeof f&&u<=f}],"filter->=":[sr,[Wt,Yt],(h,[o,u])=>{const f=h.properties()[o.value],m=u.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[sr,[Yt],(h,[o])=>{const u=h.id(),f=o.value;return typeof u==typeof f&&u>=f}],"filter-has":[sr,[Yt],(h,[o])=>o.value in h.properties()],"filter-has-id":[sr,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[sr,[It(Wt)],(h,[o])=>o.value.indexOf(h.geometryType())>=0],"filter-id-in":[sr,[It(Yt)],(h,[o])=>o.value.indexOf(h.id())>=0],"filter-in-small":[sr,[Wt,It(Yt)],(h,[o,u])=>u.value.indexOf(h.properties()[o.value])>=0],"filter-in-large":[sr,[Wt,It(Yt)],(h,[o,u])=>(function(f,m,b,T){for(;b<=T;){const E=b+T>>1;if(m[E]===f)return!0;m[E]>f?T=E-1:b=E+1}return!1})(h.properties()[o.value],u.value,0,u.value.length-1)],all:{type:sr,overloads:[[[sr,sr],(h,[o,u])=>o.evaluate(h)&&u.evaluate(h)],[Fa(sr),(h,o)=>{for(const u of o)if(!u.evaluate(h))return!1;return!0}]]},any:{type:sr,overloads:[[[sr,sr],(h,[o,u])=>o.evaluate(h)||u.evaluate(h)],[Fa(sr),(h,o)=>{for(const u of o)if(u.evaluate(h))return!0;return!1}]]},"!":[sr,[sr],(h,[o])=>!o.evaluate(h)],"is-supported-script":[sr,[Wt],(h,[o])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(o.evaluate(h))}],upcase:[Wt,[Wt],(h,[o])=>o.evaluate(h).toUpperCase()],downcase:[Wt,[Wt],(h,[o])=>o.evaluate(h).toLowerCase()],concat:[Wt,Fa(Yt),(h,o)=>o.map((u=>Mn(u.evaluate(h)))).join("")],"resolved-locale":[Wt,[un],(h,[o])=>o.evaluate(h).resolvedLocale()]});class Qu{constructor(o,u,f){this.expression=o,this._warningHistory={},this._evaluator=new ao,this._defaultValue=u?(function(m){if(m.type==="color"&&xl(m.default))return new Kr(0,0,0,0);switch(m.type){case"color":return Kr.parse(m.default)||null;case"padding":return ki.parse(m.default)||null;case"numberArray":return es.parse(m.default)||null;case"colorArray":return Si.parse(m.default)||null;case"variableAnchorOffsetCollection":return Hi.parse(m.default)||null;case"projectionDefinition":return gs.parse(m.default)||null;default:return m.default===void 0?null:m.default}})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this._globalState=f}evaluateWithoutErrorHandling(o,u,f,m,b,T){return this._globalState&&(o=wl(o,this._globalState)),this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(o,u,f,m,b,T){this._globalState&&(o=wl(o,this._globalState)),this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map((C=>JSON.stringify(C))).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ju(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in yl}function eh(h,o,u){const f=new dl(yl,qu,[],o?(function(b){const T={color:Qr,string:Wt,number:xt,enum:Wt,boolean:sr,formatted:nn,padding:wn,numberArray:Tn,colorArray:jr,projectionDefinition:Gr,resolvedImage:Pn,variableAnchorOffsetCollection:dn};return b.type==="array"?It(T[b.value]||Yt,b.length):T[b.type]})(o):void 0),m=f.parse(h,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Lg(new Qu(m,o,u)):vl(f.errors)}class th{constructor(o,u,f){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!xc(u.expression),this.globalStateRefs=rh(u.expression),this._globalState=f}evaluateWithoutErrorHandling(o,u,f,m,b,T){return this._globalState&&(o=wl(o,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,b,T)}evaluate(o,u,f,m,b,T){return this._globalState&&(o=wl(o,this._globalState)),this._styleExpression.evaluate(o,u,f,m,b,T)}}class af{constructor(o,u,f,m,b){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!xc(u.expression),this.globalStateRefs=rh(u.expression),this.interpolationType=m,this._globalState=b}evaluateWithoutErrorHandling(o,u,f,m,b,T){return this._globalState&&(o=wl(o,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,b,T)}evaluate(o,u,f,m,b,T){return this._globalState&&(o=wl(o,this._globalState)),this._styleExpression.evaluate(o,u,f,m,b,T)}interpolationFactor(o,u,f){return this.interpolationType?cs.interpolationFactor(this.interpolationType,o,u,f):0}}function jg(h,o,u){const f=eh(h,o,u);if(f.result==="error")return f;const m=f.value.expression,b=Gu(m);if(!b&&!bl(o))return vl([new Rr("","data expressions not supported")]);const T=Yu(m,["zoom"]);if(!T&&!Bg(o))return vl([new Rr("","zoom expressions not supported")]);const E=Sc(m);return E||T?E instanceof Rr?vl([E]):E instanceof cs&&!of(o)?vl([new Rr("",'"interpolate" expressions cannot be used with this property')]):Lg(E?new af(b?"camera":"composite",f.value,E.labels,E instanceof cs?E.interpolation:void 0,u):new th(b?"constant":"source",f.value,u)):vl([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tc{constructor(o,u){this._parameters=o,this._specification=u,cr(this,zg(this._parameters,this._specification))}static deserialize(o){return new Tc(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Sc(h){let o=null;if(h instanceof Ra)o=Sc(h.result);else if(h instanceof Ma){for(const u of h.args)if(o=Sc(u),o)break}else(h instanceof Ko||h instanceof cs)&&h.input instanceof Ds&&h.input.name==="zoom"&&(o=h);return o instanceof Rr||h.eachChild((u=>{const f=Sc(u);f instanceof Rr?o=f:!o&&f?o=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),o}function rh(h,o=new Set){return h instanceof bc&&o.add(h.key),h.eachChild((u=>{rh(u,o)})),o}function wl(h,o){const{zoom:u,heatmapDensity:f,elevation:m,lineProgress:b,isSupportedScript:T,accumulated:E}=h??{};return{zoom:u,heatmapDensity:f,elevation:m,lineProgress:b,isSupportedScript:T,accumulated:E,globalState:o}}function nh(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const o of h.slice(1))if(!nh(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Wg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tl(h,o){if(h==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};nh(h)||(h=ih(h));const u=eh(h,Wg,o);if(u.result==="error")throw new Error(u.value.map((f=>`${f.key}: ${f.message}`)).join(", "));return{filter:(f,m,b)=>u.value.evaluate(f,m,{},b),needGeometry:$g(h),getGlobalStateRefs:()=>rh(u.value.expression)}}function qy(h,o){return h<o?-1:h>o?1:0}function $g(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let o=1;o<h.length;o++)if($g(h[o]))return!0;return!1}function ih(h){if(!h)return!0;const o=h[0];return h.length<=1?o!=="any":o==="=="?lf(h[1],h[2],"=="):o==="!="?Sl(lf(h[1],h[2],"==")):o==="<"||o===">"||o==="<="||o===">="?lf(h[1],h[2],o):o==="any"?(u=h.slice(1),["any"].concat(u.map(ih))):o==="all"?["all"].concat(h.slice(1).map(ih)):o==="none"?["all"].concat(h.slice(1).map(ih).map(Sl)):o==="in"?cf(h[1],h.slice(2)):o==="!in"?Sl(cf(h[1],h.slice(2))):o==="has"?uf(h[1]):o!=="!has"||Sl(uf(h[1]));var u}function lf(h,o,u){switch(h){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,h,o]}}function cf(h,o){if(o.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some((u=>typeof u!=typeof o[0]))?["filter-in-large",h,["literal",o.sort(qy)]]:["filter-in-small",h,["literal",o]]}}function uf(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Sl(h){return["!",h]}function Ac(h){const o=typeof h;if(o==="number"||o==="boolean"||o==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let m="[";for(const b of h)m+=`${Ac(b)},`;return`${m}]`}const u=Object.keys(h).sort();let f="{";for(let m=0;m<u.length;m++)f+=`${JSON.stringify(u[m])}:${Ac(h[u[m]])},`;return`${f}}`}function hf(h){let o="";for(const u of Xt)o+=`/${Ac(h[u])}`;return o}function sh(h){const o=h.value;return o?[new $e(h.key,o,"constants have been deprecated as of v8")]:[]}function Kn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Na(h){if(Array.isArray(h))return h.map(Na);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const o={};for(const u in h)o[u]=Na(h[u]);return o}return Kn(h)}function Os(h){const o=h.key,u=h.value,f=h.valueSpec||{},m=h.objectElementValidators||{},b=h.style,T=h.styleSpec,E=h.validateSpec;let C=[];const O=hn(u);if(O!=="object")return[new $e(o,u,`object expected, ${O} found`)];for(const F in u){const W=F.split(".")[0],q=Yo(f,W)||f["*"];let K;if(Yo(m,W))K=m[W];else if(Yo(f,W))K=E;else if(m["*"])K=m["*"];else{if(!f["*"]){C.push(new $e(o,u[F],`unknown property "${F}"`));continue}K=E}C=C.concat(K({key:(o&&`${o}.`)+F,value:u[F],valueSpec:q,style:b,styleSpec:T,object:u,objectKey:F,validateSpec:E},u))}for(const F in f)m[F]||f[F].required&&f[F].default===void 0&&u[F]===void 0&&C.push(new $e(o,u,`missing required property "${F}"`));return C}function df(h){const o=h.value,u=h.valueSpec,f=h.style,m=h.styleSpec,b=h.key,T=h.arrayElementValidator||h.validateSpec;if(hn(o)!=="array")return[new $e(b,o,`array expected, ${hn(o)} found`)];if(u.length&&o.length!==u.length)return[new $e(b,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new $e(b,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let E={type:u.value,values:u.values};m.$version<7&&(E.function=u.function),hn(u.value)==="object"&&(E=u.value);let C=[];for(let O=0;O<o.length;O++)C=C.concat(T({array:o,arrayIndex:O,value:o[O],valueSpec:E,validateSpec:h.validateSpec,style:f,styleSpec:m,key:`${b}[${O}]`}));return C}function oh(h){const o=h.key,u=h.value,f=h.valueSpec;let m=hn(u);return m==="number"&&u!=u&&(m="NaN"),m!=="number"?[new $e(o,u,`number expected, ${m} found`)]:"minimum"in f&&u<f.minimum?[new $e(o,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new $e(o,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Hg(h){const o=h.valueSpec,u=Kn(h.value.type);let f,m,b,T={};const E=u!=="categorical"&&h.value.property===void 0,C=!E,O=hn(h.value.stops)==="array"&&hn(h.value.stops[0])==="array"&&hn(h.value.stops[0][0])==="object",F=Os({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(K){if(u==="identity")return[new $e(K.key,K.value,'identity function may not have a "stops" property')];let J=[];const ne=K.value;return J=J.concat(df({key:K.key,value:ne,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:W})),hn(ne)==="array"&&ne.length===0&&J.push(new $e(K.key,ne,"array must have at least one stop")),J},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:o,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return u==="identity"&&E&&F.push(new $e(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||F.push(new $e(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!of(h.valueSpec)&&F.push(new $e(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(C&&!bl(h.valueSpec)?F.push(new $e(h.key,h.value,"property functions not supported")):E&&!Bg(h.valueSpec)&&F.push(new $e(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!O||h.value.property!==void 0||F.push(new $e(h.key,h.value,'"property" property is required')),F;function W(K){let J=[];const ne=K.value,ce=K.key;if(hn(ne)!=="array")return[new $e(ce,ne,`array expected, ${hn(ne)} found`)];if(ne.length!==2)return[new $e(ce,ne,`array length 2 expected, length ${ne.length} found`)];if(O){if(hn(ne[0])!=="object")return[new $e(ce,ne,`object expected, ${hn(ne[0])} found`)];if(ne[0].zoom===void 0)return[new $e(ce,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new $e(ce,ne,"object stop key must have value")];if(b&&b>Kn(ne[0].zoom))return[new $e(ce,ne[0].zoom,"stop zoom values must appear in ascending order")];Kn(ne[0].zoom)!==b&&(b=Kn(ne[0].zoom),m=void 0,T={}),J=J.concat(Os({key:`${ce}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:oh,value:q}}))}else J=J.concat(q({key:`${ce}[0]`,value:ne[0],validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},ne));return Ju(Na(ne[1]))?J.concat([new $e(`${ce}[1]`,ne[1],"expressions are not allowed in function stops.")]):J.concat(K.validateSpec({key:`${ce}[1]`,value:ne[1],valueSpec:o,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function q(K,J){const ne=hn(K.value),ce=Kn(K.value),Se=K.value!==null?K.value:J;if(f){if(ne!==f)return[new $e(K.key,Se,`${ne} stop domain type must match previous stop domain type ${f}`)]}else f=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new $e(K.key,Se,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&u!=="categorical"){let qe=`number expected, ${ne} found`;return bl(o)&&u===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(K.key,Se,qe)]}return u!=="categorical"||ne!=="number"||isFinite(ce)&&Math.floor(ce)===ce?u!=="categorical"&&ne==="number"&&m!==void 0&&ce<m?[new $e(K.key,Se,"stop domain values must appear in ascending order")]:(m=ce,u==="categorical"&&ce in T?[new $e(K.key,Se,"stop domain values must be unique")]:(T[ce]=!0,[])):[new $e(K.key,Se,`integer expected, found ${ce}`)]}}function Al(h){const o=(h.expressionContext==="property"?jg:eh)(Na(h.value),h.valueSpec);if(o.result==="error")return o.value.map((f=>new $e(`${h.key}${f.key}`,h.value,f.message)));const u=o.value.expression||o.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new $e(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!xc(u))return[new $e(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!xc(u))return[new $e(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Yu(u,["zoom","feature-state"]))return[new $e(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Gu(u))return[new $e(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ah(h){const o=h.key,u=h.value,f=hn(u);return f!=="string"?[new $e(o,u,`color expected, ${f} found`)]:Kr.parse(String(u))?[]:[new $e(o,u,`color expected, "${u}" found`)]}function El(h){const o=h.key,u=h.value,f=h.valueSpec,m=[];return Array.isArray(f.values)?f.values.indexOf(Kn(u))===-1&&m.push(new $e(o,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Kn(u))===-1&&m.push(new $e(o,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),m}function Pl(h){return nh(Na(h.value))?Al(cr({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zg(h)}function Zg(h){const o=h.value,u=h.key;if(hn(o)!=="array")return[new $e(u,o,`array expected, ${hn(o)} found`)];const f=h.styleSpec;let m,b=[];if(o.length<1)return[new $e(u,o,"filter array must have at least 1 element")];switch(b=b.concat(El({key:`${u}[0]`,value:o[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),Kn(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Kn(o[1])==="$type"&&b.push(new $e(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&b.push(new $e(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(m=hn(o[1]),m!=="string"&&b.push(new $e(`${u}[1]`,o[1],`string expected, ${m} found`)));for(let T=2;T<o.length;T++)m=hn(o[T]),Kn(o[1])==="$type"?b=b.concat(El({key:`${u}[${T}]`,value:o[T],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new $e(`${u}[${T}]`,o[T],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let T=1;T<o.length;T++)b=b.concat(Zg({key:`${u}[${T}]`,value:o[T],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":m=hn(o[1]),o.length!==2?b.push(new $e(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new $e(`${u}[1]`,o[1],`string expected, ${m} found`))}return b}function ff(h,o){const u=h.key,f=h.validateSpec,m=h.style,b=h.styleSpec,T=h.value,E=h.objectKey,C=b[`${o}_${h.layerType}`];if(!C)return[];const O=E.match(/^(.*)-transition$/);if(o==="paint"&&O&&C[O[1]]&&C[O[1]].transition)return f({key:u,value:T,valueSpec:b.transition,style:m,styleSpec:b});const F=h.valueSpec||C[E];if(!F)return[new $e(u,T,`unknown property "${E}"`)];let W;if(hn(T)==="string"&&bl(F)&&!F.tokens&&(W=/^{([^}]+)}$/.exec(T)))return[new $e(u,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const q=[];return h.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&q.push(new $e(u,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&xl(Na(T))&&Kn(T.type)==="identity"&&q.push(new $e(u,T,'"text-font" does not support identity functions'))),q.concat(f({key:h.key,value:T,valueSpec:F,style:m,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:E}))}function pf(h){return ff(h,"paint")}function Xg(h){return ff(h,"layout")}function gf(h){let o=[];const u=h.value,f=h.key,m=h.style,b=h.styleSpec;if(hn(u)!=="object")return[new $e(f,u,`object expected, ${hn(u)} found`)];u.type||u.ref||o.push(new $e(f,u,'either "type" or "ref" is required'));let T=Kn(u.type);const E=Kn(u.ref);if(u.id){const C=Kn(u.id);for(let O=0;O<h.arrayIndex;O++){const F=m.layers[O];Kn(F.id)===C&&o.push(new $e(f,u.id,`duplicate layer id "${u.id}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let C;["type","source","source-layer","filter","layout"].forEach((O=>{O in u&&o.push(new $e(f,u[O],`"${O}" is prohibited for ref layers`))})),m.layers.forEach((O=>{Kn(O.id)===E&&(C=O)})),C?C.ref?o.push(new $e(f,u.ref,"ref cannot reference another ref layer")):T=Kn(C.type):o.push(new $e(f,u.ref,`ref layer "${E}" not found`))}else if(T!=="background")if(u.source){const C=m.sources&&m.sources[u.source],O=C&&Kn(C.type);C?O==="vector"&&T==="raster"?o.push(new $e(f,u.source,`layer "${u.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"||O!=="raster-dem"&&T==="color-relief"?o.push(new $e(f,u.source,`layer "${u.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?o.push(new $e(f,u.source,`layer "${u.id}" requires a vector source`)):O!=="vector"||u["source-layer"]?O==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?o.push(new $e(f,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||O==="geojson"&&C.lineMetrics||o.push(new $e(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new $e(f,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new $e(f,u.source,`source "${u.source}" not found`))}else o.push(new $e(f,u,'missing required property "source"'));return o=o.concat(Os({key:f,value:u,valueSpec:b.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${f}.type`,value:u.type,valueSpec:b.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:Pl,layout:C=>Os({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":O=>Xg(cr({layerType:T},O))}}),paint:C=>Os({layer:u,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":O=>pf(cr({layerType:T},O))}})}})),o}function Qo(h){const o=h.value,u=h.key,f=hn(o);return f!=="string"?[new $e(u,o,`string expected, ${f} found`)]:[]}const Il={promoteId:function({key:h,value:o}){if(hn(o)==="string")return Qo({key:h,value:o});{const u=[];for(const f in o)u.push(...Qo({key:`${h}.${f}`,value:o[f]}));return u}}};function qg(h){const o=h.value,u=h.key,f=h.styleSpec,m=h.style,b=h.validateSpec;if(!o.type)return[new $e(u,o,'"type" is required')];const T=Kn(o.type);let E;switch(T){case"vector":case"raster":return E=Os({key:u,value:o,valueSpec:f[`source_${T.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Il,validateSpec:b}),E;case"raster-dem":return E=(function(C){var O;const F=(O=C.sourceName)!==null&&O!==void 0?O:"",W=C.value,q=C.styleSpec,K=q.source_raster_dem,J=C.style;let ne=[];const ce=hn(W);if(W===void 0)return ne;if(ce!=="object")return ne.push(new $e("source_raster_dem",W,`object expected, ${ce} found`)),ne;const Se=Kn(W.encoding)==="custom",qe=["redFactor","greenFactor","blueFactor","baseShift"],ke=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const ze in W)!Se&&qe.includes(ze)?ne.push(new $e(ze,W[ze],`In "${F}": "${ze}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):K[ze]?ne=ne.concat(C.validateSpec({key:ze,value:W[ze],valueSpec:K[ze],validateSpec:C.validateSpec,style:J,styleSpec:q})):ne.push(new $e(ze,W[ze],`unknown property "${ze}"`));return ne})({sourceName:u,value:o,style:h.style,styleSpec:f,validateSpec:b}),E;case"geojson":if(E=Os({key:u,value:o,valueSpec:f.source_geojson,style:m,styleSpec:f,validateSpec:b,objectElementValidators:Il}),o.cluster)for(const C in o.clusterProperties){const[O,F]=o.clusterProperties[C],W=typeof O=="string"?[O,["accumulated"],["get",C]]:O;E.push(...Al({key:`${u}.${C}.map`,value:F,expressionContext:"cluster-map"})),E.push(...Al({key:`${u}.${C}.reduce`,value:W,expressionContext:"cluster-reduce"}))}return E;case"video":return Os({key:u,value:o,valueSpec:f.source_video,style:m,validateSpec:b,styleSpec:f});case"image":return Os({key:u,value:o,valueSpec:f.source_image,style:m,validateSpec:b,styleSpec:f});case"canvas":return[new $e(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return El({key:`${u}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Gg(h){const o=h.value,u=h.styleSpec,f=u.light,m=h.style;let b=[];const T=hn(o);if(o===void 0)return b;if(T!=="object")return b=b.concat([new $e("light",o,`object expected, ${T} found`)]),b;for(const E in o){const C=E.match(/^(.*)-transition$/);b=b.concat(C&&f[C[1]]&&f[C[1]].transition?h.validateSpec({key:E,value:o[E],valueSpec:u.transition,validateSpec:h.validateSpec,style:m,styleSpec:u}):f[E]?h.validateSpec({key:E,value:o[E],valueSpec:f[E],validateSpec:h.validateSpec,style:m,styleSpec:u}):[new $e(E,o[E],`unknown property "${E}"`)])}return b}function Yg(h){const o=h.value,u=h.styleSpec,f=u.sky,m=h.style,b=hn(o);if(o===void 0)return[];if(b!=="object")return[new $e("sky",o,`object expected, ${b} found`)];let T=[];for(const E in o)T=T.concat(f[E]?h.validateSpec({key:E,value:o[E],valueSpec:f[E],style:m,styleSpec:u}):[new $e(E,o[E],`unknown property "${E}"`)]);return T}function Kg(h){const o=h.value,u=h.styleSpec,f=u.terrain,m=h.style;let b=[];const T=hn(o);if(o===void 0)return b;if(T!=="object")return b=b.concat([new $e("terrain",o,`object expected, ${T} found`)]),b;for(const E in o)b=b.concat(f[E]?h.validateSpec({key:E,value:o[E],valueSpec:f[E],validateSpec:h.validateSpec,style:m,styleSpec:u}):[new $e(E,o[E],`unknown property "${E}"`)]);return b}function Qg(h){let o=[];const u=h.value,f=h.key;if(Array.isArray(u)){const m=[],b=[];for(const T in u)u[T].id&&m.includes(u[T].id)&&o.push(new $e(f,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),m.push(u[T].id),u[T].url&&b.includes(u[T].url)&&o.push(new $e(f,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),b.push(u[T].url),o=o.concat(Os({key:`${f}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return o}return Qo({key:f,value:u})}function Jg(h){return o=h.value,o&&o.constructor===Object?[]:[new $e(h.key,h.value,`object expected, ${hn(h.value)} found`)];var o}const Cl={"*":()=>[],array:df,boolean:function(h){const o=h.value,u=h.key,f=hn(o);return f!=="boolean"?[new $e(u,o,`boolean expected, ${f} found`)]:[]},number:oh,color:ah,constants:sh,enum:El,filter:Pl,function:Hg,layer:gf,object:Os,source:qg,light:Gg,sky:Yg,terrain:Kg,projection:function(h){const o=h.value,u=h.styleSpec,f=u.projection,m=h.style,b=hn(o);if(o===void 0)return[];if(b!=="object")return[new $e("projection",o,`object expected, ${b} found`)];let T=[];for(const E in o)T=T.concat(f[E]?h.validateSpec({key:E,value:o[E],valueSpec:f[E],style:m,styleSpec:u}):[new $e(E,o[E],`unknown property "${E}"`)]);return T},projectionDefinition:function(h){const o=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const f=hn(u);return f!=="array"||(function(m){return Array.isArray(m)&&m.length===3&&typeof m[0]=="string"&&typeof m[1]=="string"&&typeof m[2]=="number"})(u)||(function(m){return!!["interpolate","step","literal"].includes(m[0])})(u)?["array","string"].includes(f)?[]:[new $e(o,u,`projection expected, invalid type "${f}" found`)]:[new $e(o,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:Qo,formatted:function(h){return Qo(h).length===0?[]:Al(h)},resolvedImage:function(h){return Qo(h).length===0?[]:Al(h)},padding:function(h){const o=h.key,u=h.value;if(hn(u)==="array"){if(u.length<1||u.length>4)return[new $e(o,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let m=[];for(let b=0;b<u.length;b++)m=m.concat(h.validateSpec({key:`${o}[${b}]`,value:u[b],validateSpec:h.validateSpec,valueSpec:f}));return m}return oh({key:o,value:u,valueSpec:{}})},numberArray:function(h){const o=h.key,u=h.value;if(hn(u)==="array"){const f={type:"number"};if(u.length<1)return[new $e(o,u,"array length at least 1 expected, length 0 found")];let m=[];for(let b=0;b<u.length;b++)m=m.concat(h.validateSpec({key:`${o}[${b}]`,value:u[b],validateSpec:h.validateSpec,valueSpec:f}));return m}return oh({key:o,value:u,valueSpec:{}})},colorArray:function(h){const o=h.key,u=h.value;if(hn(u)==="array"){if(u.length<1)return[new $e(o,u,"array length at least 1 expected, length 0 found")];let f=[];for(let m=0;m<u.length;m++)f=f.concat(ah({key:`${o}[${m}]`,value:u[m]}));return f}return ah({key:o,value:u})},variableAnchorOffsetCollection:function(h){const o=h.key,u=h.value,f=hn(u),m=h.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new $e(o,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let T=0;T<u.length;T+=2)b=b.concat(El({key:`${o}[${T}]`,value:u[T],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(df({key:`${o}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:m}));return b},sprite:Qg,state:Jg};function Jo(h){const o=h.value,u=h.valueSpec,f=h.styleSpec;return h.validateSpec=Jo,u.expression&&xl(Kn(o))?Hg(h):u.expression&&Ju(Na(o))?Al(h):u.type&&Cl[u.type]?Cl[u.type](h):Os(cr({},h,{valueSpec:u.type?f[u.type]:u}))}function ms(h){const o=h.value,u=h.key,f=Qo(h);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new $e(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new $e(u,o,'"glyphs" url must include a "{range}" token'))),f}function ts(h,o=Xe){let u=[];return u=u.concat(Jo({key:"",value:h,valueSpec:o.$root,styleSpec:o,style:h,validateSpec:Jo,objectElementValidators:{glyphs:ms,"*":()=>[]}})),h.constants&&(u=u.concat(sh({key:"constants",value:h.constants}))),em(u)}function Fs(h){return function(o){return h(Object.assign({},o,{validateSpec:Jo}))}}function em(h){return[].concat(h).sort(((o,u)=>o.line-u.line))}function js(h){return function(...o){return em(h.apply(this,o))}}ts.source=js(Fs(qg)),ts.sprite=js(Fs(Qg)),ts.glyphs=js(Fs(ms)),ts.light=js(Fs(Gg)),ts.sky=js(Fs(Yg)),ts.terrain=js(Fs(Kg)),ts.state=js(Fs(Jg)),ts.layer=js(Fs(gf)),ts.filter=js(Fs(Pl)),ts.paintProperty=js(Fs(pf)),ts.layoutProperty=js(Fs(Xg));const uo=ts,tm=uo.light,mf=uo.sky,Gy=uo.paintProperty,_f=uo.layoutProperty;function rm(h,o){let u=!1;if(o&&o.length)for(const f of o)h.fire(new bt(new Error(f.message))),u=!0;return u}class Ro{constructor(o,u,f){const m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const T=new Int32Array(this.arrayBuffer);o=T[0],this.d=(u=T[1])+2*(f=T[2]);for(let C=0;C<this.d*this.d;C++){const O=T[3+C],F=T[3+C+1];m.push(O===F?null:T.subarray(O,F))}const E=T[3+m.length+1];this.keys=T.subarray(T[3+m.length],E),this.bboxes=T.subarray(E),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let T=0;T<this.d*this.d;T++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;const b=f/u*o;this.min=-b,this.max=o+b}insert(o,u,f,m,b){this._forEachCell(u,f,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,u,f,m,b,T){this.cells[b].push(T)}query(o,u,f,m,b){const T=this.min,E=this.max;if(o<=T&&u<=T&&E<=f&&E<=m&&!b)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(o,u,f,m,this._queryCell,C,{},b),C}}_queryCell(o,u,f,m,b,T,E,C){const O=this.cells[b];if(O!==null){const F=this.keys,W=this.bboxes;for(let q=0;q<O.length;q++){const K=O[q];if(E[K]===void 0){const J=4*K;(C?C(W[J+0],W[J+1],W[J+2],W[J+3]):o<=W[J+2]&&u<=W[J+3]&&f>=W[J+0]&&m>=W[J+1])?(E[K]=!0,T.push(F[K])):E[K]=!1}}}}_forEachCell(o,u,f,m,b,T,E,C){const O=this._convertToCellCoord(o),F=this._convertToCellCoord(u),W=this._convertToCellCoord(f),q=this._convertToCellCoord(m);for(let K=O;K<=W;K++)for(let J=F;J<=q;J++){const ne=this.d*J+K;if((!C||C(this._convertFromCellCoord(K),this._convertFromCellCoord(J),this._convertFromCellCoord(K+1),this._convertFromCellCoord(J+1)))&&b.call(this,o,u,f,m,ne,T,E,C))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,u=3+this.cells.length+1+1;let f=0;for(let T=0;T<this.cells.length;T++)f+=this.cells[T].length;const m=new Int32Array(u+f+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=u;for(let T=0;T<o.length;T++){const E=o[T];m[3+T]=b,m.set(E,b),b+=E.length}return m[3+o.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+o.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(o,u){const f=o.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(o){return new Ro(o.buffer)}}const Mo={};function pr(h,o,u={}){if(Mo[h])throw new Error(`${h} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:h,writeable:!1}),Mo[h]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}pr("Object",Object),pr("Set",Set),pr("TransferableGridIndex",Ro),pr("Color",Kr),pr("Error",Error),pr("AJAXError",Te),pr("ResolvedImage",Zi),pr("StylePropertyFunction",Tc),pr("StyleExpression",Qu,{omit:["_evaluator"]}),pr("ZoomDependentExpression",af),pr("ZoomConstantExpression",th),pr("CompoundExpression",Ds,{omit:["_evaluate"]});for(const h in yl)yl[h]._classRegistryKey||pr(`Expression_${h}`,yl[h]);function nm(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function La(h){return h.$name||h.constructor._classRegistryKey}function im(h){return!(function(o){if(o===null||typeof o!="object")return!1;const u=La(o);return!(!u||u==="Object")})(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||nm(h)||Bt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function Ec(h,o){if(im(h))return(nm(h)||Bt(h))&&o&&o.push(h),ArrayBuffer.isView(h)&&o&&o.push(h.buffer),h instanceof ImageData&&o&&o.push(h.data.buffer),h;if(Array.isArray(h)){const b=[];for(const T of h)b.push(Ec(T,o));return b}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=La(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!Mo[u])throw new Error(`${u} is not registered.`);const{klass:f}=Mo[u],m=f.serialize?f.serialize(h,o):{};if(f.serialize){if(o&&m===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in h){if(!h.hasOwnProperty(b)||Mo[u].omit.indexOf(b)>=0)continue;const T=h[b];m[b]=Mo[u].shallow.indexOf(b)>=0?T:Ec(T,o)}h instanceof Error&&(m.message=h.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}function ea(h){if(im(h))return h;if(Array.isArray(h))return h.map(ea);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const o=La(h)||"Object";if(!Mo[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:u}=Mo[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(h);const f=Object.create(u.prototype);for(const m of Object.keys(h)){if(m==="$name")continue;const b=h[m];f[m]=Mo[o].shallow.indexOf(m)>=0?b:ea(b)}return f}class yf{constructor(){this.first=!0}update(o,u){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const an={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Hangul Syllables":h=>h>=44032&&h<=55215,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Rl(h){for(const o of h)if(uh(o.charCodeAt(0)))return!0;return!1}function sm(h){for(const o of h)if(!am(o.charCodeAt(0)))return!1;return!0}function lh(h){const o=h.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}})).filter((u=>u));return new RegExp(o.join("|"),"u")}const om=lh(["Arab","Dupl","Mong","Ougr","Syrc"]);function am(h){return!om.test(String.fromCodePoint(h))}const ch=lh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function uh(h){return!(h!==746&&h!==747&&(h<4352||!(an["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||an["CJK Compatibility"](h)||an["CJK Strokes"](h)||!(!an["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||an["Enclosed CJK Letters and Months"](h)||an["Ideographic Description Characters"](h)||an.Kanbun(h)||an.Katakana(h)&&h!==12540||!(!an["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!an["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||an["Vertical Forms"](h)||an["Yijing Hexagram Symbols"](h)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(h))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(h))||ch.test(String.fromCodePoint(h)))))}function lm(h){return!(uh(h)||(function(o){return!!(an["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||an["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||an["Letterlike Symbols"](o)||an["Number Forms"](o)||an["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||an["Control Pictures"](o)&&o!==9251||an["Optical Character Recognition"](o)||an["Enclosed Alphanumerics"](o)||an["Geometric Shapes"](o)||an["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||an["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||an["CJK Symbols and Punctuation"](o)||an.Katakana(o)||an["Private Use Area"](o)||an["CJK Compatibility Forms"](o)||an["Small Form Variants"](o)||an["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)})(h))}const cm=lh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function um(h){return cm.test(String.fromCodePoint(h))}function hm(h,o){return!(!o&&um(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||an.Khmer(h))}function Yy(h){for(const o of h)if(um(o.charCodeAt(0)))return!0;return!1}const ko=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(ko.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,o){return a(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,f=new Promise((b=>{this.loadScriptResolve=b}));o(u);const m=new Promise((b=>setTimeout((()=>b()),this.TIMEOUT)));if(yield Promise.race([f,m]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:u};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}};class kn{constructor(o,u){this.isSupportedScript=Ky,this.zoom=o,u?(this.now=u.now||0,this.fadeDuration=u.fadeDuration||0,this.zoomHistory=u.zoomHistory||new yf,this.transition=u.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yf,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,u=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}function Ky(h){return(function(o,u){for(const f of o)if(!hm(f.charCodeAt(0),u))return!1;return!0})(h,ko.getRTLTextPluginStatus()==="loaded")}class hh{constructor(o,u,f){this.property=o,this.value=u,this.expression=(function(m,b,T){if(xl(m))return new Tc(m,b);if(Ju(m)){const E=jg(m,b,T);if(E.result==="error")throw new Error(E.value.map((C=>`${C.key}: ${C.message}`)).join(", "));return E.value}{let E=m;return b.type==="color"&&typeof m=="string"?E=Kr.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type!=="numberArray"||typeof m!="number"&&!Array.isArray(m)?b.type!=="colorArray"||typeof m!="string"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)?E=Hi.parse(m):b.type==="projectionDefinition"&&typeof m=="string"&&(E=gs.parse(m)):E=Si.parse(m):E=es.parse(m):E=ki.parse(m),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>E}}})(u===void 0?o.specification.default:u,o.specification,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)}}class dh{constructor(o,u){this.property=o,this.value=new hh(o,void 0,u)}transitioned(o,u){return new bf(this.property,this.value,u,Et({},o.transition,this.transition),o.now)}untransitioned(){return new bf(this.property,this.value,null,{},0)}}class vf{constructor(o,u){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._globalState=u}getValue(o){return Ar(this._values[o].value.value)}setValue(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new dh(this._values[o].property,this._globalState)),this._values[o].value=new hh(this._values[o].property,u===null?void 0:Ar(u),this._globalState)}getTransition(o){return Ar(this._values[o].transition)}setTransition(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new dh(this._values[o].property,this._globalState)),this._values[o].transition=Ar(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f);const m=this.getTransition(u);m!==void 0&&(o[`${u}-transition`]=m)}return o}transitioned(o,u){const f=new xf(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(o,u._values[m]);return f}untransitioned(){const o=new xf(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class bf{constructor(o,u,f,m,b){this.property=o,this.value=u,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(o,u,f){const m=o.now||0,b=this.value.possiblyEvaluate(o,u,f),T=this.prior;if(T){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return T.possiblyEvaluate(o,u,f);{const E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(o,u,f),b,Gt(E))}}return b}}class xf{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,f){const m=new Ml(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,u,f);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class fh{constructor(o,u){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._globalState=u}hasValue(o){return this._values[o].value!==void 0}getValue(o){return Ar(this._values[o].value)}setValue(o,u){this._values[o]=new hh(this._values[o].property,u===null?void 0:Ar(u),this._globalState)}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f)}return o}possiblyEvaluate(o,u,f){const m=new Ml(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,u,f);return m}}class ho{constructor(o,u,f){this.property=o,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,u,f,m){return this.property.evaluate(this.value,this.parameters,o,u,f,m)}}class Ml{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ir{constructor(o){this.specification=o}possiblyEvaluate(o,u){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(u)}interpolate(o,u,f){const m=us[this.specification.type];return m?m(o,u,f):o}}class Ur{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,f,m){return new ho(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},f,m)}:o.expression,u)}interpolate(o,u,f){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new ho(this,{kind:"constant",value:void 0},o.parameters);const m=us[this.specification.type];if(m){const b=m(o.value.value,u.value.value,f);return new ho(this,{kind:"constant",value:b},o.parameters)}return o}evaluate(o,u,f,m,b,T){return o.kind==="constant"?o.value:o.evaluate(u,f,m,b,T)}}class kl extends Ur{possiblyEvaluate(o,u,f,m){if(o.value===void 0)return new ho(this,{kind:"constant",value:void 0},u);if(o.expression.kind==="constant"){const b=o.expression.evaluate(u,null,{},f,m),T=o.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,E=this._calculate(T,T,T,u);return new ho(this,{kind:"constant",value:E},u)}if(o.expression.kind==="camera"){const b=this._calculate(o.expression.evaluate({zoom:u.zoom-1}),o.expression.evaluate({zoom:u.zoom}),o.expression.evaluate({zoom:u.zoom+1}),u);return new ho(this,{kind:"constant",value:b},u)}return new ho(this,o.expression,u)}evaluate(o,u,f,m,b,T){if(o.kind==="source"){const E=o.evaluate(u,f,m,b,T);return this._calculate(E,E,E,u)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(u.zoom)-1},f,m),o.evaluate({zoom:Math.floor(u.zoom)},f,m),o.evaluate({zoom:Math.floor(u.zoom)+1},f,m),u):o.value}_calculate(o,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}}interpolate(o){return o}}class wf{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,m){if(o.value!==void 0){if(o.expression.kind==="constant"){const b=o.expression.evaluate(u,null,{},f,m);return this._calculate(b,b,b,u)}return this._calculate(o.expression.evaluate(new kn(Math.floor(u.zoom-1),u)),o.expression.evaluate(new kn(Math.floor(u.zoom),u)),o.expression.evaluate(new kn(Math.floor(u.zoom+1),u)),u)}}_calculate(o,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}}interpolate(o){return o}}class Pc{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,m){return!!o.expression.evaluate(u,null,{},f,m)}interpolate(){return!1}}class hs{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new hh(f,void 0,void 0),b=this.defaultTransitionablePropertyValues[u]=new dh(f,void 0);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}}}pr("DataDrivenProperty",Ur),pr("DataConstantProperty",Ir),pr("CrossFadedDataDrivenProperty",kl),pr("CrossFadedProperty",wf),pr("ColorRampProperty",Pc);const dm="-transition";class Ws extends ur{constructor(o,u,f){if(super(),this.id=o.id,this.type=o.type,this._globalState=f,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter,this._featureFilter=Tl(o.filter,f)),u.layout&&(this._unevaluatedLayout=new fh(u.layout,f)),u.paint)){this._transitionablePaint=new vf(u.paint,f);for(const m in o.paint)this.setPaintProperty(m,o.paint[m],{validate:!1});for(const m in o.layout)this.setLayoutProperty(m,o.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(u.paint)}}setFilter(o){this.filter=o,this._featureFilter=Tl(o,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}getLayoutAffectingGlobalStateRefs(){const o=new Set;if(this._unevaluatedLayout)for(const u in this._unevaluatedLayout._values){const f=this._unevaluatedLayout._values[u];for(const m of f.getGlobalStateRefs())o.add(m)}for(const u of this._featureFilter.getGlobalStateRefs())o.add(u);return o}getPaintAffectingGlobalStateRefs(){var o;const u=new globalThis.Map;if(this._transitionablePaint)for(const f in this._transitionablePaint._values){const m=this._transitionablePaint._values[f].value;for(const b of m.getGlobalStateRefs()){const T=(o=u.get(b))!==null&&o!==void 0?o:[];T.push({name:f,value:m.value}),u.set(b,T)}}return u}setLayoutProperty(o,u,f={}){u!=null&&this._validate(_f,`layers.${this.id}.layout.${o}`,o,u,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return o.endsWith(dm)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,f={}){if(u!=null&&this._validate(Gy,`layers.${this.id}.paint.${o}`,o,u,f))return!1;if(o.endsWith(dm))return this._transitionablePaint.setTransition(o.slice(0,-11),u||void 0),!1;{const m=this._transitionablePaint._values[o],b=m.property.specification["property-type"]==="cross-faded-data-driven",T=m.value.isDataDriven(),E=m.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const C=this._transitionablePaint._values[o].value;return C.isDataDriven()||T||b||this._handleOverridablePaintPropertyUpdate(o,E,C)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,u,f){return!1}isHidden(o,u=!1){return!!(this.minzoom&&o<(u?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),yr(o,((u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length)))}_validate(o,u,f,m,b={}){return(!b||b.validate!==!1)&&rm(this,o.call(uo,{key:u,layerType:this.type,objectKey:f,value:m,styleSpec:Xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof ho&&bl(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}let fm;var Qy={get paint(){return fm=fm||new hs({"raster-opacity":new Ir(Xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ir(Xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ir(Xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ir(Xe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ir(Xe.paint_raster["raster-saturation"]),"raster-contrast":new Ir(Xe.paint_raster["raster-contrast"]),"raster-resampling":new Ir(Xe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ir(Xe.paint_raster["raster-fade-duration"])})}};class Dl extends Ws{constructor(o,u){super(o,Qy,u)}}const Jy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ic{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ii(h,o=1){let u=0,f=0;return{members:h.map((m=>{const b=Jy[m.type].BYTES_PER_ELEMENT,T=u=pm(u,Math.max(o,b)),E=m.components||1;return f=Math.max(f,b),u+=b*E,{name:m.name,type:m.type,components:E,offset:T}})),size:pm(u,Math.max(f,o)),alignment:o}}function pm(h,o){return Math.ceil(h/o)*o}class Cc extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const m=2*o;return this.int16[m+0]=u,this.int16[m+1]=f,o}}Cc.prototype.bytesPerElement=4,pr("StructArrayLayout2i4",Cc);class fo extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,u,f)}emplace(o,u,f,m){const b=3*o;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=m,o}}fo.prototype.bytesPerElement=6,pr("StructArrayLayout3i6",fo);class ph extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,u,f,m)}emplace(o,u,f,m,b){const T=4*o;return this.int16[T+0]=u,this.int16[T+1]=f,this.int16[T+2]=m,this.int16[T+3]=b,o}}ph.prototype.bytesPerElement=8,pr("StructArrayLayout4i8",ph);class Rc extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,m,b,T)}emplace(o,u,f,m,b,T,E){const C=6*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=m,this.int16[C+3]=b,this.int16[C+4]=T,this.int16[C+5]=E,o}}Rc.prototype.bytesPerElement=12,pr("StructArrayLayout2i4i12",Rc);class gh extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,m,b,T)}emplace(o,u,f,m,b,T,E){const C=4*o,O=8*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.uint8[O+4]=m,this.uint8[O+5]=b,this.uint8[O+6]=T,this.uint8[O+7]=E,o}}gh.prototype.bytesPerElement=8,pr("StructArrayLayout2i4ub8",gh);class Ba extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const m=2*o;return this.float32[m+0]=u,this.float32[m+1]=f,o}}Ba.prototype.bytesPerElement=8,pr("StructArrayLayout2f8",Ba);class Tf extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C,O,F){const W=this.length;return this.resize(W+1),this.emplace(W,o,u,f,m,b,T,E,C,O,F)}emplace(o,u,f,m,b,T,E,C,O,F,W){const q=10*o;return this.uint16[q+0]=u,this.uint16[q+1]=f,this.uint16[q+2]=m,this.uint16[q+3]=b,this.uint16[q+4]=T,this.uint16[q+5]=E,this.uint16[q+6]=C,this.uint16[q+7]=O,this.uint16[q+8]=F,this.uint16[q+9]=W,o}}Tf.prototype.bytesPerElement=20,pr("StructArrayLayout10ui20",Tf);class Ol extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C){const O=this.length;return this.resize(O+1),this.emplace(O,o,u,f,m,b,T,E,C)}emplace(o,u,f,m,b,T,E,C,O){const F=8*o;return this.uint16[F+0]=u,this.uint16[F+1]=f,this.uint16[F+2]=m,this.uint16[F+3]=b,this.uint16[F+4]=T,this.uint16[F+5]=E,this.uint16[F+6]=C,this.uint16[F+7]=O,o}}Ol.prototype.bytesPerElement=16,pr("StructArrayLayout8ui16",Ol);class za extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C,O,F,W,q){const K=this.length;return this.resize(K+1),this.emplace(K,o,u,f,m,b,T,E,C,O,F,W,q)}emplace(o,u,f,m,b,T,E,C,O,F,W,q,K){const J=12*o;return this.int16[J+0]=u,this.int16[J+1]=f,this.int16[J+2]=m,this.int16[J+3]=b,this.uint16[J+4]=T,this.uint16[J+5]=E,this.uint16[J+6]=C,this.uint16[J+7]=O,this.int16[J+8]=F,this.int16[J+9]=W,this.int16[J+10]=q,this.int16[J+11]=K,o}}za.prototype.bytesPerElement=24,pr("StructArrayLayout4i4ui4i24",za);class Sf extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,u,f)}emplace(o,u,f,m){const b=3*o;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=m,o}}Sf.prototype.bytesPerElement=12,pr("StructArrayLayout3f12",Sf);class mh extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}mh.prototype.bytesPerElement=4,pr("StructArrayLayout1ul4",mh);class Ua extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C,O){const F=this.length;return this.resize(F+1),this.emplace(F,o,u,f,m,b,T,E,C,O)}emplace(o,u,f,m,b,T,E,C,O,F){const W=10*o,q=5*o;return this.int16[W+0]=u,this.int16[W+1]=f,this.int16[W+2]=m,this.int16[W+3]=b,this.int16[W+4]=T,this.int16[W+5]=E,this.uint32[q+3]=C,this.uint16[W+8]=O,this.uint16[W+9]=F,o}}Ua.prototype.bytesPerElement=20,pr("StructArrayLayout6i1ul2ui20",Ua);class Af extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,m,b,T)}emplace(o,u,f,m,b,T,E){const C=6*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=m,this.int16[C+3]=b,this.int16[C+4]=T,this.int16[C+5]=E,o}}Af.prototype.bytesPerElement=12,pr("StructArrayLayout2i2i2i12",Af);class Ef extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,o,u,f,m,b)}emplace(o,u,f,m,b,T){const E=4*o,C=8*o;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=m,this.int16[C+6]=b,this.int16[C+7]=T,o}}Ef.prototype.bytesPerElement=16,pr("StructArrayLayout2f1f2i16",Ef);class _h extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,m,b,T)}emplace(o,u,f,m,b,T,E){const C=16*o,O=4*o,F=8*o;return this.uint8[C+0]=u,this.uint8[C+1]=f,this.float32[O+1]=m,this.float32[O+2]=b,this.int16[F+6]=T,this.int16[F+7]=E,o}}_h.prototype.bytesPerElement=16,pr("StructArrayLayout2ub2f2i16",_h);class yh extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,u,f)}emplace(o,u,f,m){const b=3*o;return this.uint16[b+0]=u,this.uint16[b+1]=f,this.uint16[b+2]=m,o}}yh.prototype.bytesPerElement=6,pr("StructArrayLayout3ui6",yh);class y extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se){const qe=this.length;return this.resize(qe+1),this.emplace(qe,o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se)}emplace(o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se,qe){const ke=24*o,ze=12*o,at=48*o;return this.int16[ke+0]=u,this.int16[ke+1]=f,this.uint16[ke+2]=m,this.uint16[ke+3]=b,this.uint32[ze+2]=T,this.uint32[ze+3]=E,this.uint32[ze+4]=C,this.uint16[ke+10]=O,this.uint16[ke+11]=F,this.uint16[ke+12]=W,this.float32[ze+7]=q,this.float32[ze+8]=K,this.uint8[at+36]=J,this.uint8[at+37]=ne,this.uint8[at+38]=ce,this.uint32[ze+10]=Se,this.int16[ke+22]=qe,o}}y.prototype.bytesPerElement=48,pr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class i extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se,qe,ke,ze,at,_t,Ft,tr,qt,Qt,Mr,Kt){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se,qe,ke,ze,at,_t,Ft,tr,qt,Qt,Mr,Kt)}emplace(o,u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se,qe,ke,ze,at,_t,Ft,tr,qt,Qt,Mr,Kt,Jt){const Pt=32*o,Vr=16*o;return this.int16[Pt+0]=u,this.int16[Pt+1]=f,this.int16[Pt+2]=m,this.int16[Pt+3]=b,this.int16[Pt+4]=T,this.int16[Pt+5]=E,this.int16[Pt+6]=C,this.int16[Pt+7]=O,this.uint16[Pt+8]=F,this.uint16[Pt+9]=W,this.uint16[Pt+10]=q,this.uint16[Pt+11]=K,this.uint16[Pt+12]=J,this.uint16[Pt+13]=ne,this.uint16[Pt+14]=ce,this.uint16[Pt+15]=Se,this.uint16[Pt+16]=qe,this.uint16[Pt+17]=ke,this.uint16[Pt+18]=ze,this.uint16[Pt+19]=at,this.uint16[Pt+20]=_t,this.uint16[Pt+21]=Ft,this.uint16[Pt+22]=tr,this.uint32[Vr+12]=qt,this.float32[Vr+13]=Qt,this.float32[Vr+14]=Mr,this.uint16[Pt+30]=Kt,this.uint16[Pt+31]=Jt,o}}i.prototype.bytesPerElement=64,pr("StructArrayLayout8i15ui1ul2f2ui64",i);class d extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}d.prototype.bytesPerElement=4,pr("StructArrayLayout1f4",d);class p extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,u,f)}emplace(o,u,f,m){const b=3*o;return this.uint16[6*o+0]=u,this.float32[b+1]=f,this.float32[b+2]=m,o}}p.prototype.bytesPerElement=12,pr("StructArrayLayout1ui2f12",p);class _ extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,u,f)}emplace(o,u,f,m){const b=4*o;return this.uint32[2*o+0]=u,this.uint16[b+2]=f,this.uint16[b+3]=m,o}}_.prototype.bytesPerElement=8,pr("StructArrayLayout1ul2ui8",_);class x extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const m=2*o;return this.uint16[m+0]=u,this.uint16[m+1]=f,o}}x.prototype.bytesPerElement=4,pr("StructArrayLayout2ui4",x);class A extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}A.prototype.bytesPerElement=2,pr("StructArrayLayout1ui2",A);class R extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,u,f,m)}emplace(o,u,f,m,b){const T=4*o;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=m,this.float32[T+3]=b,o}}R.prototype.bytesPerElement=16,pr("StructArrayLayout4f16",R);class M extends Ic{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new g(this.anchorPointX,this.anchorPointY)}}M.prototype.size=20;class z extends Ua{get(o){return new M(this,o)}}pr("CollisionBoxArray",z);class j extends Ic{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}j.prototype.size=48;class X extends y{get(o){return new j(this,o)}}pr("PlacedSymbolArray",X);class H extends Ic{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}H.prototype.size=64;class Q extends i{get(o){return new H(this,o)}}pr("SymbolInstanceArray",Q);class re extends d{getoffsetX(o){return this.float32[1*o+0]}}pr("GlyphOffsetArray",re);class he extends fo{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}pr("SymbolLineVertexArray",he);class de extends Ic{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}de.prototype.size=12;class ge extends p{get(o){return new de(this,o)}}pr("TextAnchorOffsetArray",ge);class Pe extends Ic{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pe.prototype.size=8;class De extends _{get(o){return new Pe(this,o)}}pr("FeatureIndexArray",De);class Ee extends Cc{}class Oe extends Cc{}class Ue extends Cc{}class Me extends Rc{}class He extends gh{}class dt extends Ba{}class ot extends Tf{}class lt extends Ol{}class ft extends za{}class Vt extends Sf{}class $t extends mh{}class Dt extends Af{}class Sr extends _h{}class $r extends yh{}class En extends x{}const Hn=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:Un}=Hn;class en{constructor(o=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=o}prepareSegment(o,u,f,m){const b=this.segments[this.segments.length-1];return o>en.MAX_VERTEX_ARRAY_LENGTH&&lr(`Max vertices per segment is ${en.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${en.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+o>en.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m?this.createNewSegment(u,f,m):b}createNewSegment(o,u,f){const m={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return f!==void 0&&(m.sortKey=f),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(m),m}getOrCreateLatestSegment(o,u,f){return this.prepareSegment(0,o,u,f)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,f,m){return new en([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}function Ln(h,o){return 256*(h=wr(Math.floor(h),0,255))+wr(Math.floor(o),0,255)}en.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pr("SegmentVector",en);const Pi=ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ei=ii([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Di,ci,mi,Oi={exports:{}},ta={exports:{}},ra={exports:{}},Va=(function(){if(mi)return Oi.exports;mi=1;var h=(Di||(Di=1,ta.exports=function(u,f){var m,b,T,E,C,O,F,W;for(b=u.length-(m=3&u.length),T=f,C=3432918353,O=461845907,W=0;W<b;)F=255&u.charCodeAt(W)|(255&u.charCodeAt(++W))<<8|(255&u.charCodeAt(++W))<<16|(255&u.charCodeAt(++W))<<24,++W,T=27492+(65535&(E=5*(65535&(T=(T^=F=(65535&(F=(F=(65535&F)*C+(((F>>>16)*C&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(F=0,m){case 3:F^=(255&u.charCodeAt(W+2))<<16;case 2:F^=(255&u.charCodeAt(W+1))<<8;case 1:T^=F=(65535&(F=(F=(65535&(F^=255&u.charCodeAt(W)))*C+(((F>>>16)*C&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295}return T^=u.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),ta.exports),o=(ci||(ci=1,ra.exports=function(u,f){for(var m,b=u.length,T=f^b,E=0;b>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(m>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),b-=4,++E;switch(b){case 3:T^=(255&u.charCodeAt(E+2))<<16;case 2:T^=(255&u.charCodeAt(E+1))<<8;case 1:T=1540483477*(65535&(T^=255&u.charCodeAt(E)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),ra.exports);return Oi.exports=h,Oi.exports.murmur3=h,Oi.exports.murmur2=o,Oi.exports})(),na=v(Va);class ja{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,f,m){this.ids.push(Mc(o)),this.positions.push(u,f,m)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Mc(o);let f=0,m=this.ids.length-1;for(;f<m;){const T=f+m>>1;this.ids[T]>=u?m=T:f=T+1}const b=[];for(;this.ids[f]===u;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(o,u){const f=new Float64Array(o.ids),m=new Uint32Array(o.positions);return ia(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(o){const u=new ja;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function Mc(h){const o=+h;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:na(String(h))}function ia(h,o,u,f){for(;u<f;){const m=h[u+f>>1];let b=u-1,T=f+1;for(;;){do b++;while(h[b]<m);do T--;while(h[T]>m);if(b>=T)break;ds(h,b,T),ds(o,3*b,3*T),ds(o,3*b+1,3*T+1),ds(o,3*b+2,3*T+2)}T-u<f-T?(ia(h,o,u,T),u=T+1):(ia(h,o,T+1,f),f=T)}}function ds(h,o,u){const f=h[o];h[o]=h[u],h[u]=f}pr("FeaturePositionMap",ja);class rs{constructor(o,u){this.gl=o.gl,this.location=u}}class po extends rs{constructor(o,u){super(o,u),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Fl extends rs{constructor(o,u){super(o,u),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class vi extends rs{constructor(o,u){super(o,u),this.current=Kr.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Fi=new Float32Array(16);function _s(h){return[Ln(255*h.r,255*h.g),Ln(255*h.b,255*h.a)]}class ui{constructor(o,u,f){this.value=o,this.uniformNames=u.map((m=>`u_${m}`)),this.type=f}setUniform(o,u,f){o.set(f.constantOr(this.value))}getBinding(o,u,f){return this.type==="color"?new vi(o,u):new po(o,u)}}class Wa{constructor(o,u){this.uniformNames=u.map((f=>`u_${f}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr}setConstantDashPositions(o,u){this.dashTo=[0,o.y,o.height,o.width],this.dashFrom=[0,u.y,u.height,u.width]}setUniform(o,u,f,m){let b=null;m==="u_pattern_to"?b=this.patternTo:m==="u_pattern_from"?b=this.patternFrom:m==="u_dasharray_to"?b=this.dashTo:m==="u_dasharray_from"?b=this.dashFrom:m==="u_pixel_ratio_to"?b=this.pixelRatioTo:m==="u_pixel_ratio_from"&&(b=this.pixelRatioFrom),b!==null&&o.set(b)}getBinding(o,u,f){return f.substr(0,9)==="u_pattern"||f.substr(0,12)==="u_dasharray_"?new Fl(o,u):new po(o,u)}}class Do{constructor(o,u,f,m){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map((b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0}))),this.paintVertexArray=new m}populatePaintArray(o,u,f){const m=this.paintVertexArray.length,b=this.expression.evaluate(new kn(0,f),u,{},f.canonical,[],f.formattedSection);this.paintVertexArray.resize(o),this._setPaintValue(m,o,b)}updatePaintArray(o,u,f,m,b){const T=this.expression.evaluate(new kn(0,b),f,m);this._setPaintValue(o,u,T)}_setPaintValue(o,u,f){if(this.type==="color"){const m=_s(f);for(let b=o;b<u;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=o;m<u;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $s{constructor(o,u,f,m,b,T){this.expression=o,this.uniformNames=u.map((E=>`u_${E}_t`)),this.type=f,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map((E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0}))),this.paintVertexArray=new T}populatePaintArray(o,u,f){const m=this.expression.evaluate(new kn(this.zoom,f),u,{},f.canonical,[],f.formattedSection),b=this.expression.evaluate(new kn(this.zoom+1,f),u,{},f.canonical,[],f.formattedSection),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,m,b)}updatePaintArray(o,u,f,m,b){const T=this.expression.evaluate(new kn(this.zoom,b),f,m),E=this.expression.evaluate(new kn(this.zoom+1,b),f,m);this._setPaintValue(o,u,T,E)}_setPaintValue(o,u,f,m){if(this.type==="color"){const b=_s(f),T=_s(m);for(let E=o;E<u;E++)this.paintVertexArray.emplace(E,b[0],b[1],T[0],T[1])}else{for(let b=o;b<u;b++)this.paintVertexArray.emplace(b,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=wr(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(m)}getBinding(o,u,f){return new po(o,u)}}class sa{constructor(o,u,f,m,b,T){this.expression=o,this.type=u,this.useIntegerZoom=f,this.zoom=m,this.layerId=T,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(o,u,f){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,this.getPositionIds(u),f)}updatePaintArray(o,u,f,m,b){this._setPaintValues(o,u,this.getPositionIds(f),b)}_setPaintValues(o,u,f,m){const b=this.getPositions(m);if(!b||!f)return;const T=b[f.min],E=b[f.mid],C=b[f.max];if(T&&E&&C)for(let O=o;O<u;O++)this.emplace(this.zoomInPaintVertexArray,O,E,T),this.emplace(this.zoomOutPaintVertexArray,O,E,C)}upload(o){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const u=this.getVertexAttributes();this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,u,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,u,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gm extends sa{getPositions(o){return o.imagePositions}getPositionIds(o){return o.patterns&&o.patterns[this.layerId]}getVertexAttributes(){return Pi.members}emplace(o,u,f,m){o.emplace(u,f.tlbr[0],f.tlbr[1],f.tlbr[2],f.tlbr[3],m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],f.pixelRatio,m.pixelRatio)}}class mm extends sa{getPositions(o){return o.dashPositions}getPositionIds(o){return o.dashes&&o.dashes[this.layerId]}getVertexAttributes(){return ei.members}emplace(o,u,f,m){o.emplace(u,0,f.y,f.height,f.width,0,m.y,m.height,m.width)}}class oa{constructor(o,u,f){this.binders={},this._buffers=[];const m=[];for(const b in o.paint._values){if(!f(b))continue;const T=o.paint.get(b);if(!(T instanceof ho&&bl(T.property.specification)))continue;const E=_m(b,o.type),C=T.value,O=T.property.specification.type,F=T.property.useIntegerZoom,W=T.property.specification["property-type"],q=W==="cross-faded"||W==="cross-faded-data-driven";if(C.kind==="constant")this.binders[b]=q?new Wa(C.value,E):new ui(C.value,E,O),m.push(`/u_${b}`);else if(C.kind==="source"||q){const K=Pf(b,O,"source");this.binders[b]=q?b==="line-dasharray"?new mm(C,O,F,u,K,o.id):new gm(C,O,F,u,K,o.id):new Do(C,E,O,K),m.push(`/a_${b}`)}else{const K=Pf(b,O,"composite");this.binders[b]=new $s(C,E,O,F,u,K),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof Do||u instanceof $s?u.maxValue:0}populatePaintArrays(o,u,f){for(const m in this.binders){const b=this.binders[m];(b instanceof Do||b instanceof $s||b instanceof sa)&&b.populatePaintArray(o,u,f)}}setConstantPatternPositions(o,u){for(const f in this.binders){const m=this.binders[f];m instanceof Wa&&m.setConstantPatternPositions(o,u)}}setConstantDashPositions(o,u){for(const f in this.binders){const m=this.binders[f];m instanceof Wa&&m.setConstantDashPositions(o,u)}}updatePaintArrays(o,u,f,m,b){let T=!1;for(const E in o){const C=u.getPositions(E);for(const O of C){const F=f.feature(O.index);for(const W in this.binders){const q=this.binders[W];if((q instanceof Do||q instanceof $s||q instanceof sa)&&q.expression.isStateDependent===!0){const K=m.paint.get(W);q.expression=K.value,q.updatePaintArray(O.start,O.end,F,o[E],b),T=!0}}}}return T}defines(){const o=[];for(const u in this.binders){const f=this.binders[u];(f instanceof ui||f instanceof Wa)&&o.push(...f.uniformNames.map((m=>`#define HAS_UNIFORM_${m}`)))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Do||f instanceof $s)for(let m=0;m<f.paintVertexAttributes.length;m++)o.push(f.paintVertexAttributes[m].name);else if(f instanceof sa){const m=f.getVertexAttributes();for(const b of m)o.push(b.name)}}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ui||f instanceof Wa||f instanceof $s)for(const m of f.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,u){const f=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof ui||b instanceof Wa||b instanceof $s){for(const T of b.uniformNames)if(u[T]){const E=b.getBinding(o,u[T],T);f.push({name:T,property:m,binding:E})}}}return f}setUniforms(o,u,f,m){for(const{name:b,property:T,binding:E}of u)this.binders[T].setUniform(E,m,f.get(T),b)}updatePaintBuffers(o){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(o&&f instanceof sa){const m=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof Do||f instanceof $s)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const u in this.binders){const f=this.binders[u];(f instanceof Do||f instanceof $s||f instanceof sa)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof Do||u instanceof $s||u instanceof sa)&&u.destroy()}}}class aa{constructor(o,u,f=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new oa(m,u,f);this.needsUpload=!1,this._featureMap=new ja,this._bufferOffset=0}populatePaintArrays(o,u,f,m){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(o,u,m);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,f,m){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,u,b,m)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function _m(h,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${o}-`,"").replace(/-/g,"_")]}function Pf(h,o,u){const f={color:{source:Ba,composite:R},number:{source:d,composite:Ba}},m=(function(b){return{"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot},"line-dasharray":{source:lt,composite:lt}}[b]})(h);return m&&m[u]||f[o][u]}pr("ConstantBinder",ui),pr("CrossFadedConstantBinder",Wa),pr("SourceExpressionBinder",Do),pr("CrossFadedPatternBinder",gm),pr("CrossFadedDasharrayBinder",mm),pr("CompositeExpressionBinder",$s),pr("ProgramConfiguration",oa,{omit:["_buffers"]}),pr("ProgramConfigurationSet",aa);const kc=Math.pow(2,14)-1,If=-kc-1;function Oo(h){const o=it/h.extent,u=h.loadGeometry();for(let f=0;f<u.length;f++){const m=u[f];for(let b=0;b<m.length;b++){const T=m[b],E=Math.round(T.x*o),C=Math.round(T.y*o);T.x=wr(E,If,kc),T.y=wr(C,If,kc),(E<T.x||E>T.x+1||C<T.y||C>T.y+1)&&lr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Dc(h,o){return{type:h.type,id:h.id,properties:h.properties,geometry:o?Oo(h):[]}}const Qw=-32768;function DR(h,o,u,f,m){h.emplaceBack(Qw+8*o+f,Qw+8*u+m)}class ev{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=o.index,this.hasDependencies=!1,this.layoutVertexArray=new Oe,this.indexArray=new $r,this.segments=new en,this.programConfigurations=new aa(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(o,u,f){const m=this.layers[0],b=[];let T=null,E=!1,C=m.type==="heatmap";if(m.type==="circle"){const F=m;T=F.layout.get("circle-sort-key"),E=!T.isConstant(),C=C||F.paint.get("circle-pitch-alignment")==="map"}const O=C?u.subdivisionGranularity.circle:1;for(const{feature:F,id:W,index:q,sourceLayerIndex:K}of o){const J=this.layers[0]._featureFilter.needGeometry,ne=Dc(F,J);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),ne,f))continue;const ce=E?T.evaluate(ne,{},f):void 0,Se={id:W,properties:F.properties,type:F.type,sourceLayerIndex:K,index:q,geometry:J?ne.geometry:Oo(F),patterns:{},sortKey:ce};b.push(Se)}E&&b.sort(((F,W)=>F.sortKey-W.sortKey));for(const F of b){const{geometry:W,index:q,sourceLayerIndex:K}=F,J=o[q].feature;this.addFeature(F,W,q,f,O),u.featureIndex.insert(J,W,q,K,this.index)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,{imagePositions:f})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Un),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,f,m,b=1){let T;switch(b){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const E=T.length;for(const C of u)for(const O of C){const F=O.x,W=O.y;if(F<0||F>=it||W<0||W>=it)continue;const q=this.segments.prepareSegment(E*E,this.layoutVertexArray,this.indexArray,o.sortKey),K=q.vertexLength;for(let J=0;J<E;J++)for(let ne=0;ne<E;ne++)DR(this.layoutVertexArray,F,W,T[ne],T[J]);for(let J=0;J<E-1;J++)for(let ne=0;ne<E-1;ne++){const ce=K+J*E+ne,Se=K+(J+1)*E+ne;this.indexArray.emplaceBack(ce,Se+1,ce+1),this.indexArray.emplaceBack(ce,Se,Se+1)}q.vertexLength+=E*E,q.primitiveLength+=(E-1)*(E-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{imagePositions:{},canonical:m})}}function Jw(h,o){for(let u=0;u<h.length;u++)if(vh(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(vh(h,o[u]))return!0;return!!tv(h,o)}function ym(h,o,u){return!!vh(h,o)||!!rv(o,h,u)}function e1(h,o){if(h.length===1)return r1(o,h[0]);for(let u=0;u<o.length;u++){const f=o[u];for(let m=0;m<f.length;m++)if(vh(h,f[m]))return!0}for(let u=0;u<h.length;u++)if(r1(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(tv(h,o[u]))return!0;return!1}function OR(h,o,u){if(h.length>1){if(tv(h,o))return!0;for(let f=0;f<o.length;f++)if(rv(o[f],h,u))return!0}for(let f=0;f<h.length;f++)if(rv(h[f],o,u))return!0;return!1}function tv(h,o){if(h.length===0||o.length===0)return!1;for(let u=0;u<h.length-1;u++){const f=h[u],m=h[u+1];for(let b=0;b<o.length-1;b++)if(FR(f,m,o[b],o[b+1]))return!0}return!1}function FR(h,o,u,f){return ut(h,u,f)!==ut(o,u,f)&&ut(h,o,u)!==ut(h,o,f)}function rv(h,o,u){const f=u*u;if(o.length===1)return h.distSqr(o[0])<f;for(let m=1;m<o.length;m++)if(t1(h,o[m-1],o[m])<f)return!0;return!1}function t1(h,o,u){const f=o.distSqr(u);if(f===0)return h.distSqr(o);const m=((h.x-o.x)*(u.x-o.x)+(h.y-o.y)*(u.y-o.y))/f;return h.distSqr(m<0?o:m>1?u:u.sub(o)._mult(m)._add(o))}function r1(h,o){let u,f,m,b=!1;for(let T=0;T<h.length;T++){u=h[T];for(let E=0,C=u.length-1;E<u.length;C=E++)f=u[E],m=u[C],f.y>o.y!=m.y>o.y&&o.x<(m.x-f.x)*(o.y-f.y)/(m.y-f.y)+f.x&&(b=!b)}return b}function vh(h,o){let u=!1;for(let f=0,m=h.length-1;f<h.length;m=f++){const b=h[f],T=h[m];b.y>o.y!=T.y>o.y&&o.x<(T.x-b.x)*(o.y-b.y)/(T.y-b.y)+b.x&&(u=!u)}return u}function NR(h,o,u){const f=u[0],m=u[2];if(h.x<f.x&&o.x<f.x||h.x>m.x&&o.x>m.x||h.y<f.y&&o.y<f.y||h.y>m.y&&o.y>m.y)return!1;const b=ut(h,o,u[0]);return b!==ut(h,o,u[1])||b!==ut(h,o,u[2])||b!==ut(h,o,u[3])}function bh(h,o,u){const f=o.paint.get(h).value;return f.kind==="constant"?f.value:u.programConfigurations.get(o.id).getMaxValue(h)}function vm(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function bm(h,o,u,f,m){if(!o[0]&&!o[1])return h;const b=g.convert(o)._mult(m);u==="viewport"&&b._rotate(-f);const T=[];for(let E=0;E<h.length;E++)T.push(h[E].sub(b));return T}function LR({queryGeometry:h,size:o},u){return ym(h,u,o)}function BR({queryGeometry:h,size:o,transform:u,unwrappedTileID:f,getElevation:m},b){return ym(h,b,o*(u.projectTileCoordinates(b.x,b.y,f,m).signedDistanceFromCamera/u.cameraToCenterDistance))}function zR({queryGeometry:h,size:o,transform:u,unwrappedTileID:f,getElevation:m},b){const T=u.projectTileCoordinates(b.x,b.y,f,m).signedDistanceFromCamera,E=o*(u.cameraToCenterDistance/T);return ym(h,nv(b,u,f,m),E)}function UR({queryGeometry:h,size:o,transform:u,unwrappedTileID:f,getElevation:m},b){return ym(h,nv(b,u,f,m),o)}function n1({queryGeometry:h,size:o,transform:u,unwrappedTileID:f,getElevation:m,pitchAlignment:b="map",pitchScale:T="map"},E){const C=b==="map"?T==="map"?LR:BR:T==="map"?zR:UR,O={queryGeometry:h,size:o,transform:u,unwrappedTileID:f,getElevation:m};for(const F of E)for(const W of F)if(C(O,W))return!0;return!1}function nv(h,o,u,f){const m=o.projectTileCoordinates(h.x,h.y,u,f).point;return new g((.5*m.x+.5)*o.width,(.5*-m.y+.5)*o.height)}let i1,s1;pr("CircleBucket",ev,{omit:["layers"]});var VR={get paint(){return s1=s1||new hs({"circle-radius":new Ur(Xe.paint_circle["circle-radius"]),"circle-color":new Ur(Xe.paint_circle["circle-color"]),"circle-blur":new Ur(Xe.paint_circle["circle-blur"]),"circle-opacity":new Ur(Xe.paint_circle["circle-opacity"]),"circle-translate":new Ir(Xe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ir(Xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ir(Xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ir(Xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ur(Xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ur(Xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ur(Xe.paint_circle["circle-stroke-opacity"])})},get layout(){return i1=i1||new hs({"circle-sort-key":new Ur(Xe.layout_circle["circle-sort-key"])})}};class jR extends Ws{constructor(o,u){super(o,VR,u)}createBucket(o){return new ev(o)}queryRadius(o){const u=o;return bh("circle-radius",this,u)+bh("circle-stroke-width",this,u)+vm(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:o,feature:u,featureState:f,geometry:m,transform:b,pixelsToTileUnits:T,unwrappedTileID:E,getElevation:C}){const O=bm(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,T),F=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),W=this.paint.get("circle-pitch-scale"),q=this.paint.get("circle-pitch-alignment");let K,J;return q==="map"?(K=O,J=F*T):(K=(function(ne,ce,Se,qe){return ne.map((ke=>nv(ke,ce,Se,qe)))})(O,b,E,C),J=F),n1({queryGeometry:K,size:J,transform:b,unwrappedTileID:E,getElevation:C,pitchAlignment:q,pitchScale:W},m)}}class o1 extends ev{}let a1;pr("HeatmapBucket",o1,{omit:["layers"]});var WR={get paint(){return a1=a1||new hs({"heatmap-radius":new Ur(Xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ur(Xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ir(Xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pc(Xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ir(Xe.paint_heatmap["heatmap-opacity"])})}};function iv(h,{width:o,height:u},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*u*f)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${o*u*f}`)}else m=new Uint8Array(o*u*f);return h.width=o,h.height=u,h.data=m,h}function l1(h,{width:o,height:u},f){if(o===h.width&&u===h.height)return;const m=iv({},{width:o,height:u},f);sv(h,m,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,o),height:Math.min(h.height,u)},f),h.width=o,h.height=u,h.data=m.data}function sv(h,o,u,f,m,b){if(m.width===0||m.height===0)return o;if(m.width>h.width||m.height>h.height||u.x>h.width-m.width||u.y>h.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||f.x>o.width-m.width||f.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const T=h.data,E=o.data;if(T===E)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<m.height;C++){const O=((u.y+C)*h.width+u.x)*b,F=((f.y+C)*o.width+f.x)*b;for(let W=0;W<m.width*b;W++)E[F+W]=T[O+W]}return o}class Cf{constructor(o,u){iv(this,o,1,u)}resize(o){l1(this,o,1)}clone(){return new Cf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,m,b){sv(o,u,f,m,b,1)}}class Ss{constructor(o,u){iv(this,o,4,u)}resize(o){l1(this,o,4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,m,b){sv(o,u,f,m,b,4)}setPixel(o,u,f){const m=4*(o*this.width+u);this.data[m+0]=Math.round(255*f.r/f.a),this.data[m+1]=Math.round(255*f.g/f.a),this.data[m+2]=Math.round(255*f.b/f.a),this.data[m+3]=Math.round(255*f.a)}}function c1(h){const o={},u=h.resolution||256,f=h.clips?h.clips.length:1,m=h.image||new Ss({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const b=(T,E,C)=>{o[h.evaluationKey]=C;const O=h.expression.evaluate(o);m.setPixel(T/4/u,E/4,O)};if(h.clips)for(let T=0,E=0;T<f;++T,E+=4*u)for(let C=0,O=0;C<u;C++,O+=4){const F=C/(u-1),{start:W,end:q}=h.clips[T];b(E,O,W*(1-F)+q*F)}else for(let T=0,E=0;T<u;T++,E+=4)b(0,E,T/(u-1));return m}pr("AlphaImage",Cf),pr("RGBAImage",Ss);const ov="big-fb";class $R extends Ws{createBucket(o){return new o1(o)}constructor(o,u){super(o,WR,u),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=c1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ov)&&this.heatmapFbos.delete(ov)}queryRadius(o){return bh("heatmap-radius",this,o)}queryIntersectsFeature({queryGeometry:o,feature:u,featureState:f,geometry:m,transform:b,pixelsToTileUnits:T,unwrappedTileID:E,getElevation:C}){return n1({queryGeometry:o,size:this.paint.get("heatmap-radius").evaluate(u,f)*T,transform:b,unwrappedTileID:E,getElevation:C},m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let u1;var HR={get paint(){return u1=u1||new hs({"hillshade-illumination-direction":new Ir(Xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ir(Xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ir(Xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ir(Xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ir(Xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ir(Xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ir(Xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ir(Xe.paint_hillshade["hillshade-method"])})}};class ZR extends Ws{constructor(o,u){super(o,HR,u),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let o=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,f=this.paint.get("hillshade-highlight-color").values,m=this.paint.get("hillshade-shadow-color").values;const b=Math.max(o.length,u.length,f.length,m.length);o=o.concat(Array(b-o.length).fill(o.at(-1))),u=u.concat(Array(b-u.length).fill(u.at(-1))),f=f.concat(Array(b-f.length).fill(f.at(-1))),m=m.concat(Array(b-m.length).fill(m.at(-1)));const T=u.map(Nr);return{directionRadians:o.map(Nr),altitudeRadians:T,shadowColor:m,highlightColor:f}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let h1;var XR={get paint(){return h1=h1||new hs({"color-relief-opacity":new Ir(Xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Pc(Xe["paint_color-relief"]["color-relief-color"])})}};class av{constructor(o,u,f,m){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,m)}update(o,u,f){const{width:m,height:b}=o,T=!(this.size&&this.size[0]===m&&this.size[1]===b||f),{context:E}=this,{gl:C}=E;if(this.useMipmap=!!(u&&u.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!u||u.premultiply!==!1)),T)this.size=[m,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||Bt(o)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,o):C.texImage2D(C.TEXTURE_2D,0,this.format,m,b,0,this.format,C.UNSIGNED_BYTE,o.data);else{const{x:O,y:F}=f||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||Bt(o)?C.texSubImage2D(C.TEXTURE_2D,0,O,F,C.RGBA,C.UNSIGNED_BYTE,o):C.texSubImage2D(C.TEXTURE_2D,0,O,F,m,b,C.RGBA,C.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D),E.pixelStoreUnpackFlipY.setDefault(),E.pixelStoreUnpack.setDefault(),E.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(o,u,f){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),f!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f||o),this.filter=o),u!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class d1{constructor(o,u,f,m=1,b=1,T=1,E=0){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void lr(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const C=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=T,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<C;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(C,O)]=this.data[this._idx(C-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,C)]=this.data[this._idx(O,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<C;O++)for(let F=0;F<C;F++){const W=this.get(O,F);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(o,u){const f=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return this.unpack(f[m],f[m+1],f[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}unpack(o,u,f){return o*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}pack(o){return f1(o,this.getUnpackVector())}getPixels(){return new Ss({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=u*this.dim,b=u*this.dim+this.dim,T=f*this.dim,E=f*this.dim+this.dim;switch(u){case-1:m=b-1;break;case 1:b=m+1}switch(f){case-1:T=E-1;break;case 1:E=T+1}const C=-u*this.dim,O=-f*this.dim;for(let F=T;F<E;F++)for(let W=m;W<b;W++)this.data[this._idx(W,F)]=o.data[this._idx(W+C,F+O)]}}function f1(h,o){const u=o[0],f=o[1],m=o[2],b=o[3],T=Math.min(u,f,m),E=Math.round((h+b)/T);return{r:Math.floor(E*T/u)%256,g:Math.floor(E*T/f)%256,b:Math.floor(E*T/m)%256}}pr("DEMData",d1);class qR extends Ws{constructor(o,u){super(o,XR,u)}_createColorRamp(o){const u={elevationStops:[],colorStops:[]},f=this._transitionablePaint._values["color-relief-color"].value.expression;if(f instanceof th&&f._styleExpression.expression instanceof cs){this.colorRampExpression=f;const T=f._styleExpression.expression;u.elevationStops=T.labels,u.colorStops=[];for(const E of u.elevationStops)u.colorStops.push(T.evaluate({globals:{elevation:E}}))}if(u.elevationStops.length<1&&(u.elevationStops=[0],u.colorStops=[Kr.transparent]),u.elevationStops.length<2&&(u.elevationStops.push(u.elevationStops[0]+1),u.colorStops.push(u.colorStops[0])),u.elevationStops.length<=o)return u;const m={elevationStops:[],colorStops:[]},b=(u.elevationStops.length-1)/(o-1);for(let T=0;T<u.elevationStops.length-.5;T+=b)m.elevationStops.push(u.elevationStops[Math.round(T)]),m.colorStops.push(u.colorStops[Math.round(T)]);return lr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),m}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(o,u,f){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const m=this._createColorRamp(u),b=new Ss({width:m.colorStops.length,height:1}),T=new Ss({width:m.colorStops.length,height:1});for(let E=0;E<m.elevationStops.length;E++){const C=f1(m.elevationStops[E],f);T.setPixel(0,E,new Kr(C.r/255,C.g/255,C.b/255,1)),b.setPixel(0,E,m.colorStops[E])}return this.colorRampTextures={elevationTexture:new av(o,T,o.gl.RGBA),colorTexture:new av(o,b,o.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const GR=ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:YR}=GR;function xm(h,o,u){const f=u.patternDependencies;let m=!1;for(const b of o){const T=b.paint.get(`${h}-pattern`);T.isConstant()||(m=!0);const E=T.constantOr(null);E&&(m=!0,f[E.to]=!0,f[E.from]=!0)}return m}function lv(h,o,u,f,m){const{zoom:b}=f,T=m.patternDependencies;for(const E of o){const C=E.paint.get(`${h}-pattern`).value;if(C.kind!=="constant"){let O=C.evaluate({zoom:b-1},u,{},m.availableImages),F=C.evaluate({zoom:b},u,{},m.availableImages),W=C.evaluate({zoom:b+1},u,{},m.availableImages);O=O&&O.name?O.name:O,F=F&&F.name?F.name:F,W=W&&W.name?W.name:W,T[O]=!0,T[F]=!0,T[W]=!0,u.patterns[E.id]={min:O,mid:F,max:W}}}return u}function p1(h,o,u,f,m){let b;if(m===(function(T,E,C,O){let F=0;for(let W=E,q=C-O;W<C;W+=O)F+=(T[q]-T[W])*(T[W+1]+T[q+1]),q=W;return F})(h,o,u,f)>0)for(let T=o;T<u;T+=f)b=y1(T/f|0,h[T],h[T+1],b);else for(let T=u-f;T>=o;T-=f)b=y1(T/f|0,h[T],h[T+1],b);return b&&xh(b,b.next)&&(Df(b),b=b.next),b}function Oc(h,o){if(!h)return h;o||(o=h);let u,f=h;do if(u=!1,f.steiner||!xh(f,f.next)&&_i(f.prev,f,f.next)!==0)f=f.next;else{if(Df(f),f=o=f.prev,f===f.next)break;u=!0}while(u||f!==o);return o}function Rf(h,o,u,f,m,b,T){if(!h)return;!T&&b&&(function(C,O,F,W){let q=C;do q.z===0&&(q.z=cv(q.x,q.y,O,F,W)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==C);q.prevZ.nextZ=null,q.prevZ=null,(function(K){let J,ne=1;do{let ce,Se=K;K=null;let qe=null;for(J=0;Se;){J++;let ke=Se,ze=0;for(let _t=0;_t<ne&&(ze++,ke=ke.nextZ,ke);_t++);let at=ne;for(;ze>0||at>0&&ke;)ze!==0&&(at===0||!ke||Se.z<=ke.z)?(ce=Se,Se=Se.nextZ,ze--):(ce=ke,ke=ke.nextZ,at--),qe?qe.nextZ=ce:K=ce,ce.prevZ=qe,qe=ce;Se=ke}qe.nextZ=null,ne*=2}while(J>1)})(q)})(h,f,m,b);let E=h;for(;h.prev!==h.next;){const C=h.prev,O=h.next;if(b?QR(h,f,m,b):KR(h))o.push(C.i,h.i,O.i),Df(h),h=O.next,E=O.next;else if((h=O)===E){T?T===1?Rf(h=JR(Oc(h),o),o,u,f,m,b,2):T===2&&e3(h,o,u,f,m,b):Rf(Oc(h),o,u,f,m,b,1);break}}}function KR(h){const o=h.prev,u=h,f=h.next;if(_i(o,u,f)>=0)return!1;const m=o.x,b=u.x,T=f.x,E=o.y,C=u.y,O=f.y,F=Math.min(m,b,T),W=Math.min(E,C,O),q=Math.max(m,b,T),K=Math.max(E,C,O);let J=f.next;for(;J!==o;){if(J.x>=F&&J.x<=q&&J.y>=W&&J.y<=K&&Mf(m,E,b,C,T,O,J.x,J.y)&&_i(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function QR(h,o,u,f){const m=h.prev,b=h,T=h.next;if(_i(m,b,T)>=0)return!1;const E=m.x,C=b.x,O=T.x,F=m.y,W=b.y,q=T.y,K=Math.min(E,C,O),J=Math.min(F,W,q),ne=Math.max(E,C,O),ce=Math.max(F,W,q),Se=cv(K,J,o,u,f),qe=cv(ne,ce,o,u,f);let ke=h.prevZ,ze=h.nextZ;for(;ke&&ke.z>=Se&&ze&&ze.z<=qe;){if(ke.x>=K&&ke.x<=ne&&ke.y>=J&&ke.y<=ce&&ke!==m&&ke!==T&&Mf(E,F,C,W,O,q,ke.x,ke.y)&&_i(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,ze.x>=K&&ze.x<=ne&&ze.y>=J&&ze.y<=ce&&ze!==m&&ze!==T&&Mf(E,F,C,W,O,q,ze.x,ze.y)&&_i(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;ke&&ke.z>=Se;){if(ke.x>=K&&ke.x<=ne&&ke.y>=J&&ke.y<=ce&&ke!==m&&ke!==T&&Mf(E,F,C,W,O,q,ke.x,ke.y)&&_i(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;ze&&ze.z<=qe;){if(ze.x>=K&&ze.x<=ne&&ze.y>=J&&ze.y<=ce&&ze!==m&&ze!==T&&Mf(E,F,C,W,O,q,ze.x,ze.y)&&_i(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function JR(h,o){let u=h;do{const f=u.prev,m=u.next.next;!xh(f,m)&&m1(f,u,u.next,m)&&kf(f,m)&&kf(m,f)&&(o.push(f.i,u.i,m.i),Df(u),Df(u.next),u=h=m),u=u.next}while(u!==h);return Oc(u)}function e3(h,o,u,f,m,b){let T=h;do{let E=T.next.next;for(;E!==T.prev;){if(T.i!==E.i&&s3(T,E)){let C=_1(T,E);return T=Oc(T,T.next),C=Oc(C,C.next),Rf(T,o,u,f,m,b,0),void Rf(C,o,u,f,m,b,0)}E=E.next}T=T.next}while(T!==h)}function t3(h,o){let u=h.x-o.x;return u===0&&(u=h.y-o.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(o.next.y-o.y)/(o.next.x-o.x)),u}function r3(h,o){const u=(function(m,b){let T=b;const E=m.x,C=m.y;let O,F=-1/0;if(xh(m,T))return T;do{if(xh(m,T.next))return T.next;if(C<=T.y&&C>=T.next.y&&T.next.y!==T.y){const ne=T.x+(C-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(ne<=E&&ne>F&&(F=ne,O=T.x<T.next.x?T:T.next,ne===E))return O}T=T.next}while(T!==b);if(!O)return null;const W=O,q=O.x,K=O.y;let J=1/0;T=O;do{if(E>=T.x&&T.x>=q&&E!==T.x&&g1(C<K?E:F,C,q,K,C<K?F:E,C,T.x,T.y)){const ne=Math.abs(C-T.y)/(E-T.x);kf(T,m)&&(ne<J||ne===J&&(T.x>O.x||T.x===O.x&&n3(O,T)))&&(O=T,J=ne)}T=T.next}while(T!==W);return O})(h,o);if(!u)return o;const f=_1(u,h);return Oc(f,f.next),Oc(u,u.next)}function n3(h,o){return _i(h.prev,h,o.prev)<0&&_i(o.next,h,h.next)<0}function cv(h,o,u,f,m){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*m|0)|h<<8))|h<<4))|h<<2))|h<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function i3(h){let o=h,u=h;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==h);return u}function g1(h,o,u,f,m,b,T,E){return(m-T)*(o-E)>=(h-T)*(b-E)&&(h-T)*(f-E)>=(u-T)*(o-E)&&(u-T)*(b-E)>=(m-T)*(f-E)}function Mf(h,o,u,f,m,b,T,E){return!(h===T&&o===E)&&g1(h,o,u,f,m,b,T,E)}function s3(h,o){return h.next.i!==o.i&&h.prev.i!==o.i&&!(function(u,f){let m=u;do{if(m.i!==u.i&&m.next.i!==u.i&&m.i!==f.i&&m.next.i!==f.i&&m1(m,m.next,u,f))return!0;m=m.next}while(m!==u);return!1})(h,o)&&(kf(h,o)&&kf(o,h)&&(function(u,f){let m=u,b=!1;const T=(u.x+f.x)/2,E=(u.y+f.y)/2;do m.y>E!=m.next.y>E&&m.next.y!==m.y&&T<(m.next.x-m.x)*(E-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==u);return b})(h,o)&&(_i(h.prev,h,o.prev)||_i(h,o.prev,o))||xh(h,o)&&_i(h.prev,h,h.next)>0&&_i(o.prev,o,o.next)>0)}function _i(h,o,u){return(o.y-h.y)*(u.x-o.x)-(o.x-h.x)*(u.y-o.y)}function xh(h,o){return h.x===o.x&&h.y===o.y}function m1(h,o,u,f){const m=Tm(_i(h,o,u)),b=Tm(_i(h,o,f)),T=Tm(_i(u,f,h)),E=Tm(_i(u,f,o));return m!==b&&T!==E||!(m!==0||!wm(h,u,o))||!(b!==0||!wm(h,f,o))||!(T!==0||!wm(u,h,f))||!(E!==0||!wm(u,o,f))}function wm(h,o,u){return o.x<=Math.max(h.x,u.x)&&o.x>=Math.min(h.x,u.x)&&o.y<=Math.max(h.y,u.y)&&o.y>=Math.min(h.y,u.y)}function Tm(h){return h>0?1:h<0?-1:0}function kf(h,o){return _i(h.prev,h,h.next)<0?_i(h,o,h.next)>=0&&_i(h,h.prev,o)>=0:_i(h,o,h.prev)<0||_i(h,h.next,o)<0}function _1(h,o){const u=uv(h.i,h.x,h.y),f=uv(o.i,o.x,o.y),m=h.next,b=o.prev;return h.next=o,o.prev=h,u.next=m,m.prev=u,f.next=u,u.prev=f,b.next=f,f.prev=b,f}function y1(h,o,u,f){const m=uv(h,o,u);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function Df(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function uv(h,o,u){return{i:h,x:o,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class wh{constructor(o,u){if(u>o)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=o,this._minGranularity=u}getGranularityForZoomLevel(o){return Math.max(Math.floor(this._baseZoomGranularity/(1<<o)),this._minGranularity,1)}}class Sm{constructor(o){this.fill=o.fill,this.line=o.line,this.tile=o.tile,this.stencil=o.stencil,this.circle=o.circle}}Sm.noSubdivision=new Sm({fill:new wh(0,0),line:new wh(0,0),tile:new wh(0,0),stencil:new wh(0,0),circle:1}),pr("SubdivisionGranularityExpression",wh),pr("SubdivisionGranularitySetting",Sm);const Th=-32768,Of=32767;class o3{constructor(o,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=o,this._granularityCellSize=it/o,this._canonical=u}_getKey(o,u){return(o+=32768)<<16|u+32768}_vertexToIndex(o,u){if(o<-32768||u<-32768||o>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const f=0|Math.round(o),m=0|Math.round(u),b=this._getKey(f,m);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,T),this._vertexBuffer.push(f,m),T}_subdivideTrianglesScanline(o){if(this._granularity<2)return(function(m,b){const T=[];for(let E=0;E<b.length;E+=3){const C=b[E],O=b[E+1],F=b[E+2],W=m[2*C],q=m[2*C+1];(m[2*O]-W)*(m[2*F+1]-q)-(m[2*O+1]-q)*(m[2*F]-W)>0?(T.push(C),T.push(F),T.push(O)):(T.push(C),T.push(O),T.push(F))}return T})(this._vertexBuffer,o);const u=[],f=o.length;for(let m=0;m<f;m+=3){const b=[o[m+0],o[m+1],o[m+2]],T=[this._vertexBuffer[2*o[m+0]+0],this._vertexBuffer[2*o[m+0]+1],this._vertexBuffer[2*o[m+1]+0],this._vertexBuffer[2*o[m+1]+1],this._vertexBuffer[2*o[m+2]+0],this._vertexBuffer[2*o[m+2]+1]];let E=1/0,C=1/0,O=-1/0,F=-1/0;for(let ne=0;ne<3;ne++){const ce=T[2*ne],Se=T[2*ne+1];E=Math.min(E,ce),O=Math.max(O,ce),C=Math.min(C,Se),F=Math.max(F,Se)}if(E===O||C===F)continue;const W=Math.floor(E/this._granularityCellSize),q=Math.ceil(O/this._granularityCellSize),K=Math.floor(C/this._granularityCellSize),J=Math.ceil(F/this._granularityCellSize);if(W!==q||K!==J)for(let ne=K;ne<J;ne++){const ce=this._scanlineGenerateVertexRingForCellRow(ne,T,b);a3(this._vertexBuffer,ce,u)}else u.push(...b)}return u}_scanlineGenerateVertexRingForCellRow(o,u,f){const m=o*this._granularityCellSize,b=m+this._granularityCellSize,T=[];for(let E=0;E<3;E++){const C=u[2*E],O=u[2*E+1],F=u[2*(E+1)%6],W=u[(2*(E+1)+1)%6],q=u[2*(E+2)%6],K=u[(2*(E+2)+1)%6],J=F-C,ne=W-O,ce=J===0,Se=ne===0,qe=(m-O)/ne,ke=(b-O)/ne,ze=Math.min(qe,ke),at=Math.max(qe,ke);if(!Se&&(ze>=1||at<=0)||Se&&(O<m||O>b)){W>=m&&W<=b&&T.push(f[(E+1)%3]);continue}!Se&&ze>0&&T.push(this._vertexToIndex(C+J*ze,O+ne*ze));const _t=C+J*Math.max(ze,0),Ft=C+J*Math.min(at,1);ce||this._generateIntraEdgeVertices(T,C,O,F,W,_t,Ft),!Se&&at<1&&T.push(this._vertexToIndex(C+J*at,O+ne*at)),(Se||W>=m&&W<=b)&&T.push(f[(E+1)%3]),!Se&&(W<=m||W>=b)&&this._generateInterEdgeVertices(T,C,O,F,W,q,K,Ft,m,b)}return T}_generateIntraEdgeVertices(o,u,f,m,b,T,E){const C=m-u,O=b-f,F=O===0,W=F?Math.min(u,m):Math.min(T,E),q=F?Math.max(u,m):Math.max(T,E),K=Math.floor(W/this._granularityCellSize)+1,J=Math.ceil(q/this._granularityCellSize)-1;if(F?u<m:T<E)for(let ne=K;ne<=J;ne++){const ce=ne*this._granularityCellSize;o.push(this._vertexToIndex(ce,f+O*(ce-u)/C))}else for(let ne=J;ne>=K;ne--){const ce=ne*this._granularityCellSize;o.push(this._vertexToIndex(ce,f+O*(ce-u)/C))}}_generateInterEdgeVertices(o,u,f,m,b,T,E,C,O,F){const W=b-f,q=T-m,K=E-b,J=(O-b)/K,ne=(F-b)/K,ce=Math.min(J,ne),Se=Math.max(J,ne),qe=m+q*ce;let ke=Math.floor(Math.min(qe,C)/this._granularityCellSize)+1,ze=Math.ceil(Math.max(qe,C)/this._granularityCellSize)-1,at=C<qe;const _t=K===0;if(_t&&(E===O||E===F))return;if(_t||ce>=1||Se<=0){const tr=f-E,qt=T+(u-T)*Math.min((O-E)/tr,(F-E)/tr);ke=Math.floor(Math.min(qt,C)/this._granularityCellSize)+1,ze=Math.ceil(Math.max(qt,C)/this._granularityCellSize)-1,at=C<qt}const Ft=W>0?F:O;if(at)for(let tr=ke;tr<=ze;tr++)o.push(this._vertexToIndex(tr*this._granularityCellSize,Ft));else for(let tr=ze;tr>=ke;tr--)o.push(this._vertexToIndex(tr*this._granularityCellSize,Ft))}_generateOutline(o){const u=[];for(const f of o){const m=Fc(f,this._granularity,!0),b=this._pointArrayToIndices(m),T=[];for(let E=1;E<b.length;E++)T.push(b[E-1]),T.push(b[E]);u.push(T)}return u}_handlePoles(o){let u=!1,f=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(f=!0)),(u||f)&&this._fillPoles(o,u,f)}_ensureNoPoleVertices(){const o=this._vertexBuffer;for(let u=0;u<o.length;u+=2){const f=o[u+1];f===Th&&(o[u+1]=-32767),f===Of&&(o[u+1]=32766)}}_generatePoleQuad(o,u,f,m,b,T){m>b!=(T===Th)?(o.push(u),o.push(f),o.push(this._vertexToIndex(m,T)),o.push(f),o.push(this._vertexToIndex(b,T)),o.push(this._vertexToIndex(m,T))):(o.push(f),o.push(u),o.push(this._vertexToIndex(m,T)),o.push(this._vertexToIndex(b,T)),o.push(f),o.push(this._vertexToIndex(m,T)))}_fillPoles(o,u,f){const m=this._vertexBuffer,b=it,T=o.length;for(let E=2;E<T;E+=3){const C=o[E-2],O=o[E-1],F=o[E],W=m[2*C],q=m[2*C+1],K=m[2*O],J=m[2*O+1],ne=m[2*F],ce=m[2*F+1];u&&(q===0&&J===0&&this._generatePoleQuad(o,C,O,W,K,Th),J===0&&ce===0&&this._generatePoleQuad(o,O,F,K,ne,Th),ce===0&&q===0&&this._generatePoleQuad(o,F,C,ne,W,Th)),f&&(q===b&&J===b&&this._generatePoleQuad(o,C,O,W,K,Of),J===b&&ce===b&&this._generatePoleQuad(o,O,F,K,ne,Of),ce===b&&q===b&&this._generatePoleQuad(o,F,C,ne,W,Of))}}_initializeVertices(o){for(let u=0;u<o.length;u+=2)this._vertexToIndex(o[u],o[u+1])}subdividePolygonInternal(o,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:f,holeIndices:m}=(function(E){const C=[],O=[];for(const F of E)if(F.length!==0){F!==E[0]&&C.push(O.length/2);for(let W=0;W<F.length;W++)O.push(F[W].x),O.push(F[W].y)}return{flattened:O,holeIndices:C}})(o);let b;this._initializeVertices(f);try{const E=(function(O,F,W=2){const q=F&&F.length,K=q?F[0]*W:O.length;let J=p1(O,0,K,W,!0);const ne=[];if(!J||J.next===J.prev)return ne;let ce,Se,qe;if(q&&(J=(function(ke,ze,at,_t){const Ft=[];for(let tr=0,qt=ze.length;tr<qt;tr++){const Qt=p1(ke,ze[tr]*_t,tr<qt-1?ze[tr+1]*_t:ke.length,_t,!1);Qt===Qt.next&&(Qt.steiner=!0),Ft.push(i3(Qt))}Ft.sort(t3);for(let tr=0;tr<Ft.length;tr++)at=r3(Ft[tr],at);return at})(O,F,J,W)),O.length>80*W){ce=O[0],Se=O[1];let ke=ce,ze=Se;for(let at=W;at<K;at+=W){const _t=O[at],Ft=O[at+1];_t<ce&&(ce=_t),Ft<Se&&(Se=Ft),_t>ke&&(ke=_t),Ft>ze&&(ze=Ft)}qe=Math.max(ke-ce,ze-Se),qe=qe!==0?32767/qe:0}return Rf(J,ne,W,ce,Se,qe,0),ne})(f,m),C=this._convertIndices(f,E);b=this._subdivideTrianglesScanline(C)}catch(E){console.error(E)}let T=[];return u&&(T=this._generateOutline(o)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:T}}_convertIndices(o,u){const f=[];for(let m=0;m<u.length;m++)f.push(this._vertexToIndex(o[2*u[m]],o[2*u[m]+1]));return f}_pointArrayToIndices(o){const u=[];for(let f=0;f<o.length;f++){const m=o[f];u.push(this._vertexToIndex(m.x,m.y))}return u}}function v1(h,o,u,f=!0){return new o3(u,o).subdividePolygonInternal(h,f)}function Fc(h,o,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const f=h[0],m=h[h.length-1],b=u&&(f.x!==m.x||f.y!==m.y);if(o<2)return b?[...h,h[0]]:[...h];const T=Math.floor(it/o),E=[];E.push(new g(h[0].x,h[0].y));const C=h.length,O=b?C:C-1;for(let F=0;F<O;F++){const W=h[F],q=F<C-1?h[F+1]:h[0],K=W.x,J=W.y,ne=q.x,ce=q.y,Se=K!==ne,qe=J!==ce;if(!Se&&!qe)continue;const ke=ne-K,ze=ce-J,at=Math.abs(ke),_t=Math.abs(ze);let Ft=K,tr=J;for(;;){const Qt=ke>0?(Math.floor(Ft/T)+1)*T:(Math.ceil(Ft/T)-1)*T,Mr=ze>0?(Math.floor(tr/T)+1)*T:(Math.ceil(tr/T)-1)*T,Kt=Math.abs(Ft-Qt),Jt=Math.abs(tr-Mr),Pt=Math.abs(Ft-ne),Vr=Math.abs(tr-ce),Zr=Se?Kt/at:Number.POSITIVE_INFINITY,Fr=qe?Jt/_t:Number.POSITIVE_INFINITY;if((Pt<=Kt||!Se)&&(Vr<=Jt||!qe))break;if(Zr<Fr&&Se||!qe){Ft=Qt,tr+=ze*Zr;const Er=new g(Ft,Math.round(tr));E[E.length-1].x===Er.x&&E[E.length-1].y===Er.y||E.push(Er)}else{Ft+=ke*Fr,tr=Mr;const Er=new g(Math.round(Ft),tr);E[E.length-1].x===Er.x&&E[E.length-1].y===Er.y||E.push(Er)}}const qt=new g(ne,ce);E[E.length-1].x===qt.x&&E[E.length-1].y===qt.y||E.push(qt)}return E}function a3(h,o,u){if(o.length===0)throw new Error("Subdivision vertex ring is empty.");let f=0,m=h[2*o[0]];for(let C=1;C<o.length;C++){const O=h[2*o[C]];O<m&&(m=O,f=C)}const b=o.length;let T=f,E=(T+1)%b;for(;;){const C=T-1>=0?T-1:b-1,O=(E+1)%b,F=h[2*o[C]],W=h[2*o[O]],q=h[2*o[T]],K=h[2*o[T]+1],J=h[2*o[E]+1];let ne=!1;if(F<W)ne=!0;else if(F>W)ne=!1;else{const ce=J-K,Se=-(h[2*o[E]]-q),qe=K<J?1:-1;((F-q)*ce+(h[2*o[C]+1]-K)*Se)*qe>((W-q)*ce+(h[2*o[O]+1]-K)*Se)*qe&&(ne=!0)}if(ne){const ce=o[C],Se=o[T],qe=o[E];ce!==Se&&ce!==qe&&Se!==qe&&u.push(qe,Se,ce),T--,T<0&&(T=b-1)}else{const ce=o[O],Se=o[T],qe=o[E];ce!==Se&&ce!==qe&&Se!==qe&&u.push(qe,Se,ce),E++,E>=b&&(E=0)}if(C===O)break}}function b1(h,o,u,f,m,b,T,E,C){const O=m.length/2,F=T&&E&&C;if(O<en.MAX_VERTEX_ARRAY_LENGTH){const W=o.prepareSegment(O,u,f),q=W.vertexLength;for(let ne=0;ne<b.length;ne+=3)f.emplaceBack(q+b[ne],q+b[ne+1],q+b[ne+2]);let K,J;W.vertexLength+=O,W.primitiveLength+=b.length/3,F&&(J=T.prepareSegment(O,u,E),K=J.vertexLength,J.vertexLength+=O);for(let ne=0;ne<m.length;ne+=2)h(m[ne],m[ne+1]);if(F)for(let ne=0;ne<C.length;ne++){const ce=C[ne];for(let Se=1;Se<ce.length;Se+=2)E.emplaceBack(K+ce[Se-1],K+ce[Se]);J.primitiveLength+=ce.length/2}}else(function(W,q,K,J,ne,ce){const Se=[];for(let _t=0;_t<J.length/2;_t++)Se.push(-1);const qe={count:0};let ke=0,ze=W.getOrCreateLatestSegment(q,K),at=ze.vertexLength;for(let _t=2;_t<ne.length;_t+=3){const Ft=ne[_t-2],tr=ne[_t-1],qt=ne[_t];let Qt=Se[Ft]<ke,Mr=Se[tr]<ke,Kt=Se[qt]<ke;ze.vertexLength+((Qt?1:0)+(Mr?1:0)+(Kt?1:0))>en.MAX_VERTEX_ARRAY_LENGTH&&(ze=W.createNewSegment(q,K),ke=qe.count,Qt=!0,Mr=!0,Kt=!0,at=0);const Jt=Ff(Se,J,ce,qe,Ft,Qt,ze),Pt=Ff(Se,J,ce,qe,tr,Mr,ze),Vr=Ff(Se,J,ce,qe,qt,Kt,ze);K.emplaceBack(at+Jt-ke,at+Pt-ke,at+Vr-ke),ze.primitiveLength++}})(o,u,f,m,b,h),F&&(function(W,q,K,J,ne,ce){const Se=[];for(let _t=0;_t<J.length/2;_t++)Se.push(-1);const qe={count:0};let ke=0,ze=W.getOrCreateLatestSegment(q,K),at=ze.vertexLength;for(let _t=0;_t<ne.length;_t++){const Ft=ne[_t];for(let tr=1;tr<ne[_t].length;tr+=2){const qt=Ft[tr-1],Qt=Ft[tr];let Mr=Se[qt]<ke,Kt=Se[Qt]<ke;ze.vertexLength+((Mr?1:0)+(Kt?1:0))>en.MAX_VERTEX_ARRAY_LENGTH&&(ze=W.createNewSegment(q,K),ke=qe.count,Mr=!0,Kt=!0,at=0);const Jt=Ff(Se,J,ce,qe,qt,Mr,ze),Pt=Ff(Se,J,ce,qe,Qt,Kt,ze);K.emplaceBack(at+Jt-ke,at+Pt-ke),ze.primitiveLength++}}})(T,u,E,m,C,h),o.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function Ff(h,o,u,f,m,b,T){if(b){const E=f.count;return u(o[2*m],o[2*m+1]),h[m]=f.count,f.count++,T.vertexLength++,E}return h[m]}class hv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=o.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ue,this.indexArray=new $r,this.indexArray2=new En,this.programConfigurations=new aa(o.layers,o.zoom),this.segments=new en,this.segments2=new en,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(o,u,f){this.hasDependencies=xm("fill",this.layers,u);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),T=[];for(const{feature:E,id:C,index:O,sourceLayerIndex:F}of o){const W=this.layers[0]._featureFilter.needGeometry,q=Dc(E,W);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),q,f))continue;const K=b?m.evaluate(q,{},f,u.availableImages):void 0,J={id:C,properties:E.properties,type:E.type,sourceLayerIndex:F,index:O,geometry:W?q.geometry:Oo(E),patterns:{},sortKey:K};T.push(J)}b&&T.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of T){const{geometry:C,index:O,sourceLayerIndex:F}=E;if(this.hasDependencies){const W=lv("fill",this.layers,E,{zoom:this.zoom},u);this.patternFeatures.push(W)}else this.addFeature(E,C,O,f,{},u.subdivisionGranularity);u.featureIndex.insert(o[O].feature,C,O,F,this.index)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,{imagePositions:f})}addFeatures(o,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,u,f,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,YR),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,f,m,b,T){for(const E of _l(u,500)){const C=v1(E,m,T.fill.getGranularityForZoomLevel(m.z)),O=this.layoutVertexArray;b1(((F,W)=>{O.emplaceBack(F,W)}),this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{imagePositions:b,canonical:m})}}let x1,w1;pr("FillBucket",hv,{omit:["layers","patternFeatures"]});var l3={get paint(){return w1=w1||new hs({"fill-antialias":new Ir(Xe.paint_fill["fill-antialias"]),"fill-opacity":new Ur(Xe.paint_fill["fill-opacity"]),"fill-color":new Ur(Xe.paint_fill["fill-color"]),"fill-outline-color":new Ur(Xe.paint_fill["fill-outline-color"]),"fill-translate":new Ir(Xe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ir(Xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new kl(Xe.paint_fill["fill-pattern"])})},get layout(){return x1=x1||new hs({"fill-sort-key":new Ur(Xe.layout_fill["fill-sort-key"])})}};class c3 extends Ws{constructor(o,u){super(o,l3,u)}recalculate(o,u){super.recalculate(o,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new hv(o)}queryRadius(){return vm(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:o,geometry:u,transform:f,pixelsToTileUnits:m}){return e1(bm(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-f.bearingInRadians,m),u)}isTileClipped(){return!0}}const u3=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),h3=ii([{name:"a_centroid",components:2,type:"Int16"}],4),{members:d3}=u3;class Sh{constructor(o,u,f,m,b){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=b,o.readFields(f3,this,u)}loadGeometry(){const o=this._pbf;o.pos=this._geometry;const u=o.readVarint()+o.pos,f=[];let m,b=1,T=0,E=0,C=0;for(;o.pos<u;){if(T<=0){const O=o.readVarint();b=7&O,T=O>>3}if(T--,b===1||b===2)E+=o.readSVarint(),C+=o.readSVarint(),b===1&&(m&&f.push(m),m=[]),m&&m.push(new g(E,C));else{if(b!==7)throw new Error(`unknown command ${b}`);m&&m.push(m[0].clone())}}return m&&f.push(m),f}bbox(){const o=this._pbf;o.pos=this._geometry;const u=o.readVarint()+o.pos;let f=1,m=0,b=0,T=0,E=1/0,C=-1/0,O=1/0,F=-1/0;for(;o.pos<u;){if(m<=0){const W=o.readVarint();f=7&W,m=W>>3}if(m--,f===1||f===2)b+=o.readSVarint(),T+=o.readSVarint(),b<E&&(E=b),b>C&&(C=b),T<O&&(O=T),T>F&&(F=T);else if(f!==7)throw new Error(`unknown command ${f}`)}return[E,O,C,F]}toGeoJSON(o,u,f){const m=this.extent*Math.pow(2,f),b=this.extent*o,T=this.extent*u,E=this.loadGeometry();function C(q){return[360*(q.x+b)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+T)/m)*Math.PI))-90]}function O(q){return q.map(C)}let F;if(this.type===1){const q=[];for(const J of E)q.push(J[0]);const K=O(q);F=q.length===1?{type:"Point",coordinates:K[0]}:{type:"MultiPoint",coordinates:K}}else if(this.type===2){const q=E.map(O);F=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=(function(J){const ne=J.length;if(ne<=1)return[J];const ce=[];let Se,qe;for(let ke=0;ke<ne;ke++){const ze=p3(J[ke]);ze!==0&&(qe===void 0&&(qe=ze<0),qe===ze<0?(Se&&ce.push(Se),Se=[J[ke]]):Se&&Se.push(J[ke]))}return Se&&ce.push(Se),ce})(E),K=[];for(const J of q)K.push(J.map(O));F=K.length===1?{type:"Polygon",coordinates:K[0]}:{type:"MultiPolygon",coordinates:K}}}const W={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(W.id=this.id),W}}function f3(h,o,u){h===1?o.id=u.readVarint():h===2?(function(f,m){const b=f.readVarint()+f.pos;for(;f.pos<b;){const T=m._keys[f.readVarint()],E=m._values[f.readVarint()];m.properties[T]=E}})(u,o):h===3?o.type=u.readVarint():h===4&&(o._geometry=u.pos)}function p3(h){let o=0;for(let u,f,m=0,b=h.length,T=b-1;m<b;T=m++)u=h[m],f=h[T],o+=(f.x-u.x)*(u.y+f.y);return o}Sh.types=["Unknown","Point","LineString","Polygon"];class T1{constructor(o,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(g3,this,u),this.length=this._features.length}feature(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];const u=this._pbf.readVarint()+this._pbf.pos;return new Sh(this._pbf,u,this.extent,this._keys,this._values)}}function g3(h,o,u){h===15?o.version=u.readVarint():h===1?o.name=u.readString():h===5?o.extent=u.readVarint():h===2?o._features.push(u.pos):h===3?o._keys.push(u.readString()):h===4&&o._values.push((function(f){let m=null;const b=f.readVarint()+f.pos;for(;f.pos<b;){const T=f.readVarint()>>3;m=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}if(m==null)throw new Error("unknown feature value");return m})(u))}class S1{constructor(o,u){this.layers=o.readFields(m3,{},u)}}function m3(h,o,u){if(h===3){const f=new T1(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}const dv=Math.pow(2,13);function Nf(h,o,u,f,m,b,T,E){h.emplaceBack(o,u,2*Math.floor(f*dv)+T,m*dv*2,b*dv*2,Math.round(E))}class fv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=o.index,this.hasDependencies=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new Ee,this.indexArray=new $r,this.programConfigurations=new aa(o.layers,o.zoom),this.segments=new en,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(o,u,f){this.features=[],this.hasDependencies=xm("fill-extrusion",this.layers,u);for(const{feature:m,id:b,index:T,sourceLayerIndex:E}of o){const C=this.layers[0]._featureFilter.needGeometry,O=Dc(m,C);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),O,f))continue;const F={id:b,sourceLayerIndex:E,index:T,geometry:C?O.geometry:Oo(m),properties:m.properties,type:m.type,patterns:{}};this.hasDependencies?this.features.push(lv("fill-extrusion",this.layers,F,{zoom:this.zoom},u)):this.addFeature(F,F.geometry,T,f,{},u.subdivisionGranularity),u.featureIndex.insert(m,F.geometry,T,E,this.index,!0)}}addFeatures(o,u,f){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,u,f,o.subdivisionGranularity)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,{imagePositions:f})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,d3),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,h3.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,u,f,m,b,T){for(const E of _l(u,500)){const C={x:0,y:0,sampleCount:0},O=this.layoutVertexArray.length;this.processPolygon(C,m,o,E,T);const F=this.layoutVertexArray.length-O,W=Math.floor(C.x/C.sampleCount),q=Math.floor(C.y/C.sampleCount);for(let K=0;K<F;K++)this.centroidVertexArray.emplaceBack(W,q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{imagePositions:b,canonical:m})}processPolygon(o,u,f,m,b){if(m.length<1||A1(m[0]))return;for(const W of m)W.length!==0&&_3(o,W);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},E=b.fill.getGranularityForZoomLevel(u.z),C=Sh.types[f.type]==="Polygon";for(const W of m){if(W.length===0||A1(W))continue;const q=Fc(W,E,C);this._generateSideFaces(q,T)}if(!C)return;const O=v1(m,u,E,!1),F=this.layoutVertexArray;b1(((W,q)=>{Nf(F,W,q,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,O.verticesFlattened,O.indicesTriangles)}_generateSideFaces(o,u){let f=0;for(let m=1;m<o.length;m++){const b=o[m],T=o[m-1];if(y3(b,T))continue;u.segment.vertexLength+4>en.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const E=b.sub(T)._perp()._unit(),C=T.dist(b);f+C>32768&&(f=0),Nf(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,0,f),Nf(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,1,f),f+=C,Nf(this.layoutVertexArray,T.x,T.y,E.x,E.y,0,0,f),Nf(this.layoutVertexArray,T.x,T.y,E.x,E.y,0,1,f);const O=u.segment.vertexLength;this.indexArray.emplaceBack(O,O+2,O+1),this.indexArray.emplaceBack(O+1,O+2,O+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function _3(h,o){for(let u=0;u<o.length;u++){const f=o[u];u===o.length-1&&o[0].x===f.x&&o[0].y===f.y||(h.x+=f.x,h.y+=f.y,h.sampleCount++)}}function y3(h,o){return h.x===o.x&&(h.x<0||h.x>it)||h.y===o.y&&(h.y<0||h.y>it)}function A1(h){return h.every((o=>o.x<0))||h.every((o=>o.x>it))||h.every((o=>o.y<0))||h.every((o=>o.y>it))}let E1;pr("FillExtrusionBucket",fv,{omit:["layers","features"]});var v3={get paint(){return E1=E1||new hs({"fill-extrusion-opacity":new Ir(Xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ur(Xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ir(Xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ir(Xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kl(Xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ur(Xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ur(Xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ir(Xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class b3 extends Ws{constructor(o,u){super(o,v3,u)}createBucket(o){return new fv(o)}queryRadius(){return vm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:o,feature:u,featureState:f,geometry:m,transform:b,pixelsToTileUnits:T,pixelPosMatrix:E}){const C=bm(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,T),O=this.paint.get("fill-extrusion-height").evaluate(u,f),F=this.paint.get("fill-extrusion-base").evaluate(u,f),W=(function(K,J){const ne=[];for(const ce of K){const Se=[ce.x,ce.y,0,1];fe(Se,Se,J),ne.push(new g(Se[0]/Se[3],Se[1]/Se[3]))}return ne})(C,E),q=(function(K,J,ne,ce){const Se=[],qe=[],ke=ce[8]*J,ze=ce[9]*J,at=ce[10]*J,_t=ce[11]*J,Ft=ce[8]*ne,tr=ce[9]*ne,qt=ce[10]*ne,Qt=ce[11]*ne;for(const Mr of K){const Kt=[],Jt=[];for(const Pt of Mr){const Vr=Pt.x,Zr=Pt.y,Fr=ce[0]*Vr+ce[4]*Zr+ce[12],Er=ce[1]*Vr+ce[5]*Zr+ce[13],pn=ce[2]*Vr+ce[6]*Zr+ce[14],si=ce[3]*Vr+ce[7]*Zr+ce[15],Ii=pn+at,is=si+_t,Zs=Fr+Ft,As=Er+tr,Xi=pn+qt,ti=si+Qt,Li=new g((Fr+ke)/is,(Er+ze)/is);Li.z=Ii/is,Kt.push(Li);const qi=new g(Zs/ti,As/ti);qi.z=Xi/ti,Jt.push(qi)}Se.push(Kt),qe.push(Jt)}return[Se,qe]})(m,F,O,E);return(function(K,J,ne){let ce=1/0;e1(ne,J)&&(ce=P1(ne,J[0]));for(let Se=0;Se<J.length;Se++){const qe=J[Se],ke=K[Se];for(let ze=0;ze<qe.length-1;ze++){const at=qe[ze],_t=[at,qe[ze+1],ke[ze+1],ke[ze],at];Jw(ne,_t)&&(ce=Math.min(ce,P1(ne,_t)))}}return ce!==1/0&&ce})(q[0],q[1],W)}}function Lf(h,o){return h.x*o.x+h.y*o.y}function P1(h,o){if(h.length===1){let u=0;const f=o[u++];let m;for(;!m||f.equals(m);)if(m=o[u++],!m)return 1/0;for(;u<o.length;u++){const b=o[u],T=h[0],E=m.sub(f),C=b.sub(f),O=T.sub(f),F=Lf(E,E),W=Lf(E,C),q=Lf(C,C),K=Lf(O,E),J=Lf(O,C),ne=F*q-W*W,ce=(q*K-W*J)/ne,Se=(F*J-W*K)/ne,qe=f.z*(1-ce-Se)+m.z*ce+b.z*Se;if(isFinite(qe))return qe}return 1/0}{let u=1/0;for(const f of o)u=Math.min(u,f.z);return u}}const x3=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:w3}=x3,T3=ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:S3}=T3,A3=Math.cos(Math.PI/180*37.5),I1=Math.pow(2,14)/.5;class pv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=o.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new He,this.layoutVertexArray2=new dt,this.indexArray=new $r,this.programConfigurations=new aa(o.layers,o.zoom),this.segments=new en,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(o,u,f){this.hasDependencies=xm("line",this.layers,u)||this.hasLineDasharray(this.layers);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),T=[];for(const{feature:E,id:C,index:O,sourceLayerIndex:F}of o){const W=this.layers[0]._featureFilter.needGeometry,q=Dc(E,W);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),q,f))continue;const K=b?m.evaluate(q,{},f):void 0,J={id:C,properties:E.properties,type:E.type,sourceLayerIndex:F,index:O,geometry:W?q.geometry:Oo(E),patterns:{},dashes:{},sortKey:K};T.push(J)}b&&T.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of T){const{geometry:C,index:O,sourceLayerIndex:F}=E;this.hasDependencies?(xm("line",this.layers,u)?lv("line",this.layers,E,{zoom:this.zoom},u):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,E,this.zoom,u),this.patternFeatures.push(E)):this.addFeature(E,C,O,f,{},{},u.subdivisionGranularity),u.featureIndex.insert(o[O].feature,C,O,F,this.index)}}update(o,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,{imagePositions:f,dashPositions:m})}addFeatures(o,u,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,u,f,m,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,S3)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,w3),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,f,m,b,T,E){const C=this.layers[0].layout,O=C.get("line-join").evaluate(o,{}),F=C.get("line-cap"),W=C.get("line-miter-limit"),q=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const K of u)this.addLine(K,o,O,F,W,q,m,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{imagePositions:b,dashPositions:T,canonical:m})}addLine(o,u,f,m,b,T,E,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,o=Fc(o,E?C.line.getGranularityForZoomLevel(E.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<o.length-1;ke++)this.totalDistance+=o[ke].dist(o[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=Sh.types[u.type]==="Polygon";let F=o.length;for(;F>=2&&o[F-1].equals(o[F-2]);)F--;let W=0;for(;W<F-1&&o[W].equals(o[W+1]);)W++;if(F<(O?3:2))return;f==="bevel"&&(b=1.05);const q=this.overscaling<=16?122880/(512*this.overscaling):0,K=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let J,ne,ce,Se,qe;this.e1=this.e2=-1,O&&(J=o[F-2],qe=o[W].sub(J)._unit()._perp());for(let ke=W;ke<F;ke++){if(ce=ke===F-1?O?o[W+1]:void 0:o[ke+1],ce&&o[ke].equals(ce))continue;qe&&(Se=qe),J&&(ne=J),J=o[ke],qe=ce?ce.sub(J)._unit()._perp():Se,Se=Se||qe;let ze=Se.add(qe);ze.x===0&&ze.y===0||ze._unit();const at=Se.x*qe.x+Se.y*qe.y,_t=ze.x*qe.x+ze.y*qe.y,Ft=_t!==0?1/_t:1/0,tr=2*Math.sqrt(2-2*_t),qt=_t<A3&&ne&&ce,Qt=Se.x*qe.y-Se.y*qe.x>0;if(qt&&ke>W){const Jt=J.dist(ne);if(Jt>2*q){const Pt=J.sub(J.sub(ne)._mult(q/Jt)._round());this.updateDistance(ne,Pt),this.addCurrentVertex(Pt,Se,0,0,K),ne=Pt}}const Mr=ne&&ce;let Kt=Mr?f:O?"butt":m;if(Mr&&Kt==="round"&&(Ft<T?Kt="miter":Ft<=2&&(Kt="fakeround")),Kt==="miter"&&Ft>b&&(Kt="bevel"),Kt==="bevel"&&(Ft>2&&(Kt="flipbevel"),Ft<b&&(Kt="miter")),ne&&this.updateDistance(ne,J),Kt==="miter")ze._mult(Ft),this.addCurrentVertex(J,ze,0,0,K);else if(Kt==="flipbevel"){if(Ft>100)ze=qe.mult(-1);else{const Jt=Ft*Se.add(qe).mag()/Se.sub(qe).mag();ze._perp()._mult(Jt*(Qt?-1:1))}this.addCurrentVertex(J,ze,0,0,K),this.addCurrentVertex(J,ze.mult(-1),0,0,K)}else if(Kt==="bevel"||Kt==="fakeround"){const Jt=-Math.sqrt(Ft*Ft-1),Pt=Qt?Jt:0,Vr=Qt?0:Jt;if(ne&&this.addCurrentVertex(J,Se,Pt,Vr,K),Kt==="fakeround"){const Zr=Math.round(180*tr/Math.PI/20);for(let Fr=1;Fr<Zr;Fr++){let Er=Fr/Zr;if(Er!==.5){const si=Er-.5;Er+=Er*si*(Er-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*si*si+(.848013+at*(.215638*at-1.06021)))}const pn=qe.sub(Se)._mult(Er)._add(Se)._unit()._mult(Qt?-1:1);this.addHalfVertex(J,pn.x,pn.y,!1,Qt,0,K)}}ce&&this.addCurrentVertex(J,qe,-Pt,-Vr,K)}else if(Kt==="butt")this.addCurrentVertex(J,ze,0,0,K);else if(Kt==="square"){const Jt=ne?1:-1;this.addCurrentVertex(J,ze,Jt,Jt,K)}else Kt==="round"&&(ne&&(this.addCurrentVertex(J,Se,0,0,K),this.addCurrentVertex(J,Se,1,1,K,!0)),ce&&(this.addCurrentVertex(J,qe,-1,-1,K,!0),this.addCurrentVertex(J,qe,0,0,K)));if(qt&&ke<F-1){const Jt=J.dist(ce);if(Jt>2*q){const Pt=J.add(ce.sub(J)._mult(q/Jt)._round());this.updateDistance(J,Pt),this.addCurrentVertex(Pt,qe,0,0,K),J=Pt}}}}addCurrentVertex(o,u,f,m,b,T=!1){const E=u.y*m-u.x,C=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,T,!1,f,b),this.addHalfVertex(o,E,C,T,!0,-m,b),this.distance>I1/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,u,f,m,b,T))}addHalfVertex({x:o,y:u},f,m,b,T,E,C){const O=.5*(this.lineClips?this.scaledDistance*(I1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(u<<1)+(T?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(E===0?0:E<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),C.primitiveLength++),T?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}hasLineDasharray(o){for(const u of o){const f=u.paint.get("line-dasharray");if(f&&!f.isConstant())return!0}return!1}addLineDashDependencies(o,u,f,m){for(const b of o){const T=b.paint.get("line-dasharray");if(!T||T.value.kind==="constant")continue;const E=b.layout.get("line-cap")==="round",C={dasharray:T.value.evaluate({zoom:f-1},u,{}),round:E},O={dasharray:T.value.evaluate({zoom:f},u,{}),round:E},F={dasharray:T.value.evaluate({zoom:f+1},u,{}),round:E},W=`${C.dasharray.join(",")},${C.round}`,q=`${O.dasharray.join(",")},${O.round}`,K=`${F.dasharray.join(",")},${F.round}`;m.dashDependencies[W]=C,m.dashDependencies[q]=O,m.dashDependencies[K]=F,u.dashes[b.id]={min:W,mid:q,max:K}}}}let C1,R1;pr("LineBucket",pv,{omit:["layers","patternFeatures"]});var M1={get paint(){return R1=R1||new hs({"line-opacity":new Ur(Xe.paint_line["line-opacity"]),"line-color":new Ur(Xe.paint_line["line-color"]),"line-translate":new Ir(Xe.paint_line["line-translate"]),"line-translate-anchor":new Ir(Xe.paint_line["line-translate-anchor"]),"line-width":new Ur(Xe.paint_line["line-width"]),"line-gap-width":new Ur(Xe.paint_line["line-gap-width"]),"line-offset":new Ur(Xe.paint_line["line-offset"]),"line-blur":new Ur(Xe.paint_line["line-blur"]),"line-dasharray":new kl(Xe.paint_line["line-dasharray"]),"line-pattern":new kl(Xe.paint_line["line-pattern"]),"line-gradient":new Pc(Xe.paint_line["line-gradient"])})},get layout(){return C1=C1||new hs({"line-cap":new Ir(Xe.layout_line["line-cap"]),"line-join":new Ur(Xe.layout_line["line-join"]),"line-miter-limit":new Ir(Xe.layout_line["line-miter-limit"]),"line-round-limit":new Ir(Xe.layout_line["line-round-limit"]),"line-sort-key":new Ur(Xe.layout_line["line-sort-key"])})}};class E3 extends Ur{possiblyEvaluate(o,u){return u=new kn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(o,u)}evaluate(o,u,f,m){return u=Et({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(o,u,f,m)}}let Am;class P3 extends Ws{constructor(o,u){super(o,M1,u),this.gradientVersion=0,Am||(Am=new E3(M1.paint.properties["line-width"].specification),Am.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!(function(f){return f._styleExpression!==void 0})(u)&&u._styleExpression.expression instanceof Ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,u){super.recalculate(o,u),this.paint._values["line-floorwidth"]=Am.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new pv(o)}queryRadius(o){const u=o,f=k1(bh("line-width",this,u),bh("line-gap-width",this,u)),m=bh("line-offset",this,u);return f/2+Math.abs(m)+vm(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:o,feature:u,featureState:f,geometry:m,transform:b,pixelsToTileUnits:T}){const E=bm(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,T),C=T/2*k1(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),O=this.paint.get("line-offset").evaluate(u,f);return O&&(m=(function(F,W){const q=[];for(let K=0;K<F.length;K++){const J=F[K],ne=[];for(let ce=0;ce<J.length;ce++){const Se=J[ce-1],qe=J[ce],ke=J[ce+1],ze=ce===0?new g(0,0):qe.sub(Se)._unit()._perp(),at=ce===J.length-1?new g(0,0):ke.sub(qe)._unit()._perp(),_t=ze._add(at)._unit(),Ft=_t.x*at.x+_t.y*at.y;Ft!==0&&_t._mult(1/Ft),ne.push(_t._mult(W)._add(qe))}q.push(ne)}return q})(m,O*T)),(function(F,W,q){for(let K=0;K<W.length;K++){const J=W[K];if(F.length>=3){for(let ne=0;ne<J.length;ne++)if(vh(F,J[ne]))return!0}if(OR(F,J,q))return!0}return!1})(E,m,C)}isTileClipped(){return!0}}function k1(h,o){return o>0?o+2*h:h}const I3=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),C3=ii([{name:"a_projected_pos",components:3,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const R3=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const D1=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M3=ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function k3(h,o,u){return h.sections.forEach((f=>{f.text=(function(m,b,T){const E=b.layout.get("text-transform").evaluate(T,{});return E==="uppercase"?m=m.toLocaleUpperCase():E==="lowercase"&&(m=m.toLocaleLowerCase()),ko.applyArabicShaping&&(m=ko.applyArabicShaping(m)),m})(f.text,o,u)})),h}ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ii([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Bf={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Ni=24;const gv=4294967296,O1=1/gv,F1=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class mv{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,u,f=this.length){for(;this.pos<f;){const m=this.readVarint(),b=m>>3,T=this.pos;this.type=7&m,o(b,u,this),this.pos===T&&this.skip(m)}return u}readMessage(o,u){return this.readFields(o,u,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gv;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gv;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const u=this.buf;let f,m;return m=u[this.pos++],f=127&m,m<128?f:(m=u[this.pos++],f|=(127&m)<<7,m<128?f:(m=u[this.pos++],f|=(127&m)<<14,m<128?f:(m=u[this.pos++],f|=(127&m)<<21,m<128?f:(m=u[this.pos],f|=(15&m)<<28,(function(b,T,E){const C=E.buf;let O,F;if(F=C[E.pos++],O=(112&F)>>4,F<128||(F=C[E.pos++],O|=(127&F)<<3,F<128)||(F=C[E.pos++],O|=(127&F)<<10,F<128)||(F=C[E.pos++],O|=(127&F)<<17,F<128)||(F=C[E.pos++],O|=(127&F)<<24,F<128)||(F=C[E.pos++],O|=(1&F)<<31,F<128))return Ah(b,O,T);throw new Error("Expected varint not more than 10 bytes")})(f,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&F1?F1.decode(this.buf.subarray(u,o)):(function(f,m,b){let T="",E=m;for(;E<b;){const C=f[E];let O,F,W,q=null,K=C>239?4:C>223?3:C>191?2:1;if(E+K>b)break;K===1?C<128&&(q=C):K===2?(O=f[E+1],(192&O)==128&&(q=(31&C)<<6|63&O,q<=127&&(q=null))):K===3?(O=f[E+1],F=f[E+2],(192&O)==128&&(192&F)==128&&(q=(15&C)<<12|(63&O)<<6|63&F,(q<=2047||q>=55296&&q<=57343)&&(q=null))):K===4&&(O=f[E+1],F=f[E+2],W=f[E+3],(192&O)==128&&(192&F)==128&&(192&W)==128&&(q=(15&C)<<18|(63&O)<<12|(63&F)<<6|63&W,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,K=1):q>65535&&(q-=65536,T+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),T+=String.fromCharCode(q),E+=K}return T})(this.buf,u,o)}readBytes(){const o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u}readPackedVarint(o=[],u){const f=this.readPackedEnd();for(;this.pos<f;)o.push(this.readVarint(u));return o}readPackedSVarint(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const u=this.readPackedEnd();for(;this.pos<u;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const u=7&o;if(u===0)for(;this.buf[this.pos++]>127;);else if(u===2)this.pos=this.readVarint()+this.pos;else if(u===5)this.pos+=4;else{if(u!==1)throw new Error(`Unimplemented type: ${u}`);this.pos+=8}}writeTag(o,u){this.writeVarint(o<<3|u)}realloc(o){let u=this.length||16;for(;u<this.pos+o;)u*=2;if(u!==this.length){const f=new Uint8Array(u);f.set(this.buf),this.buf=f,this.dataView=new DataView(f.buffer),this.length=u}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*O1),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*O1),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(u,f){let m,b;if(u>=0?(m=u%4294967296|0,b=u/4294967296|0):(m=~(-u%4294967296),b=~(-u/4294967296),4294967295^m?m=m+1|0:(m=0,b=b+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),(function(T,E,C){C.buf[C.pos++]=127&T|128,T>>>=7,C.buf[C.pos++]=127&T|128,T>>>=7,C.buf[C.pos++]=127&T|128,T>>>=7,C.buf[C.pos++]=127&T|128,C.buf[C.pos]=127&(T>>>=7)})(m,0,f),(function(T,E){const C=(7&T)<<4;E.buf[E.pos++]|=C|((T>>>=3)?128:0),T&&(E.buf[E.pos++]=127&T|((T>>>=7)?128:0),T&&(E.buf[E.pos++]=127&T|((T>>>=7)?128:0),T&&(E.buf[E.pos++]=127&T|((T>>>=7)?128:0),T&&(E.buf[E.pos++]=127&T|((T>>>=7)?128:0),T&&(E.buf[E.pos++]=127&T)))))})(b,f)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const u=this.pos;this.pos=(function(m,b,T){for(let E,C,O=0;O<b.length;O++){if(E=b.charCodeAt(O),E>55295&&E<57344){if(!C){E>56319||O+1===b.length?(m[T++]=239,m[T++]=191,m[T++]=189):C=E;continue}if(E<56320){m[T++]=239,m[T++]=191,m[T++]=189,C=E;continue}E=C-55296<<10|E-56320|65536,C=null}else C&&(m[T++]=239,m[T++]=191,m[T++]=189,C=null);E<128?m[T++]=E:(E<2048?m[T++]=E>>6|192:(E<65536?m[T++]=E>>12|224:(m[T++]=E>>18|240,m[T++]=E>>12&63|128),m[T++]=E>>6&63|128),m[T++]=63&E|128)}return T})(this.buf,o,this.pos);const f=this.pos-u;f>=128&&N1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const u=o.length;this.writeVarint(u),this.realloc(u);for(let f=0;f<u;f++)this.buf[this.pos++]=o[f]}writeRawMessage(o,u){this.pos++;const f=this.pos;o(u,this);const m=this.pos-f;m>=128&&N1(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m}writeMessage(o,u,f){this.writeTag(o,2),this.writeRawMessage(u,f)}writePackedVarint(o,u){u.length&&this.writeMessage(o,D3,u)}writePackedSVarint(o,u){u.length&&this.writeMessage(o,O3,u)}writePackedBoolean(o,u){u.length&&this.writeMessage(o,L3,u)}writePackedFloat(o,u){u.length&&this.writeMessage(o,F3,u)}writePackedDouble(o,u){u.length&&this.writeMessage(o,N3,u)}writePackedFixed32(o,u){u.length&&this.writeMessage(o,B3,u)}writePackedSFixed32(o,u){u.length&&this.writeMessage(o,z3,u)}writePackedFixed64(o,u){u.length&&this.writeMessage(o,U3,u)}writePackedSFixed64(o,u){u.length&&this.writeMessage(o,V3,u)}writeBytesField(o,u){this.writeTag(o,2),this.writeBytes(u)}writeFixed32Field(o,u){this.writeTag(o,5),this.writeFixed32(u)}writeSFixed32Field(o,u){this.writeTag(o,5),this.writeSFixed32(u)}writeFixed64Field(o,u){this.writeTag(o,1),this.writeFixed64(u)}writeSFixed64Field(o,u){this.writeTag(o,1),this.writeSFixed64(u)}writeVarintField(o,u){this.writeTag(o,0),this.writeVarint(u)}writeSVarintField(o,u){this.writeTag(o,0),this.writeSVarint(u)}writeStringField(o,u){this.writeTag(o,2),this.writeString(u)}writeFloatField(o,u){this.writeTag(o,5),this.writeFloat(u)}writeDoubleField(o,u){this.writeTag(o,1),this.writeDouble(u)}writeBooleanField(o,u){this.writeVarintField(o,+u)}}function Ah(h,o,u){return u?4294967296*o+(h>>>0):4294967296*(o>>>0)+(h>>>0)}function N1(h,o,u){const f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(f);for(let m=u.pos-1;m>=h;m--)u.buf[m+f]=u.buf[m]}function D3(h,o){for(let u=0;u<h.length;u++)o.writeVarint(h[u])}function O3(h,o){for(let u=0;u<h.length;u++)o.writeSVarint(h[u])}function F3(h,o){for(let u=0;u<h.length;u++)o.writeFloat(h[u])}function N3(h,o){for(let u=0;u<h.length;u++)o.writeDouble(h[u])}function L3(h,o){for(let u=0;u<h.length;u++)o.writeBoolean(h[u])}function B3(h,o){for(let u=0;u<h.length;u++)o.writeFixed32(h[u])}function z3(h,o){for(let u=0;u<h.length;u++)o.writeSFixed32(h[u])}function U3(h,o){for(let u=0;u<h.length;u++)o.writeFixed64(h[u])}function V3(h,o){for(let u=0;u<h.length;u++)o.writeSFixed64(h[u])}function j3(h,o,u){h===1&&u.readMessage(W3,o)}function W3(h,o,u){if(h===3){const{id:f,bitmap:m,width:b,height:T,left:E,top:C,advance:O}=u.readMessage($3,{});o.push({id:f,bitmap:new Cf({width:b+6,height:T+6},m),metrics:{width:b,height:T,left:E,top:C,advance:O}})}}function $3(h,o,u){h===1?o.id=u.readVarint():h===2?o.bitmap=u.readBytes():h===3?o.width=u.readVarint():h===4?o.height=u.readVarint():h===5?o.left=u.readSVarint():h===6?o.top=u.readSVarint():h===7&&(o.advance=u.readVarint())}function L1(h){let o=0,u=0;for(const T of h)o+=T.w*T.h,u=Math.max(u,T.w);h.sort(((T,E)=>E.h-T.h));const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let m=0,b=0;for(const T of h)for(let E=f.length-1;E>=0;E--){const C=f[E];if(!(T.w>C.w||T.h>C.h)){if(T.x=C.x,T.y=C.y,b=Math.max(b,T.y+T.h),m=Math.max(m,T.x+T.w),T.w===C.w&&T.h===C.h){const O=f.pop();O&&E<f.length&&(f[E]=O)}else T.h===C.h?(C.x+=T.w,C.w-=T.w):T.w===C.w?(C.y+=T.h,C.h-=T.h):(f.push({x:C.x+T.w,y:C.y,w:C.w-T.w,h:T.h}),C.y+=T.h,C.h-=T.h);break}}return{w:m,h:b,fill:o/(m*b)||0}}class _v{constructor(o,{pixelRatio:u,version:f,stretchX:m,stretchY:b,content:T,textFitWidth:E,textFitHeight:C}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=m,this.stretchY=b,this.content=T,this.version=f,this.textFitWidth=E,this.textFitHeight=C}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class B1{constructor(o,u){const f={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,f,b),this.addImages(u,m,b);const{w:T,h:E}=L1(b),C=new Ss({width:T||1,height:E||1});for(const O in o){const F=o[O],W=f[O].paddedRect;Ss.copy(F.data,C,{x:0,y:0},{x:W.x+1,y:W.y+1},F.data)}for(const O in u){const F=u[O],W=m[O].paddedRect,q=W.x+1,K=W.y+1,J=F.data.width,ne=F.data.height;Ss.copy(F.data,C,{x:0,y:0},{x:q,y:K},F.data),Ss.copy(F.data,C,{x:0,y:ne-1},{x:q,y:K-1},{width:J,height:1}),Ss.copy(F.data,C,{x:0,y:0},{x:q,y:K+ne},{width:J,height:1}),Ss.copy(F.data,C,{x:J-1,y:0},{x:q-1,y:K},{width:1,height:ne}),Ss.copy(F.data,C,{x:0,y:0},{x:q+J,y:K},{width:1,height:ne})}this.image=C,this.iconPositions=f,this.patternPositions=m}addImages(o,u,f){for(const m in o){const b=o[m],T={x:0,y:0,w:b.data.width+2,h:b.data.height+2};f.push(T),u[m]=new _v(T,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,u){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)}patchUpdatedImage(o,u,f){if(!o||!u||o.version===u.version)return;o.version=u.version;const[m,b]=o.tl;f.update(u.data,void 0,{x:m,y:b})}}var Nl;pr("ImagePosition",_v),pr("ImageAtlas",B1),c.ao=void 0,(Nl=c.ao||(c.ao={}))[Nl.none=0]="none",Nl[Nl.horizontal=1]="horizontal",Nl[Nl.vertical=2]="vertical",Nl[Nl.horizontalOnly=3]="horizontalOnly";class zf{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(o,u,f){const m=new zf;return m.scale=o||1,m.fontStack=u,m.verticalAlign=f||"bottom",m}static forImage(o,u){const f=new zf;return f.imageName=o,f.verticalAlign=u||"bottom",f}}class Eh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const f=new Eh;for(let m=0;m<o.sections.length;m++){const b=o.sections[m];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=(function(o){let u="";for(let f=0;f<o.length;f++){const m=o.charCodeAt(f+1)||null,b=o.charCodeAt(f-1)||null;u+=m&&lm(m)&&!Bf[o[f+1]]||b&&lm(b)&&!Bf[o[f-1]]||!Bf[o[f]]?o[f]:Bf[o[f]]}return u})(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&Pm[this.text.charCodeAt(f)];f++)o++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&Pm[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const f=new Eh;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((o,u)=>Math.max(o,this.sections[u].scale)),0)}getMaxImageSize(o){let u=0,f=0;for(let m=0;m<this.length();m++){const b=this.getSection(m);if(b.imageName){const T=o[b.imageName];if(!T)continue;const E=T.displaySize;u=Math.max(u,E[0]),f=Math.max(f,E[1])}}return{maxImageWidth:u,maxImageHeight:f}}addTextSection(o,u){this.text+=o.text,this.sections.push(zf.forText(o.scale,o.fontStack||u,o.verticalAlign));const f=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(f)}addImageSection(o){const u=o.image?o.image.name:"";if(u.length===0)return void lr("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(zf.forImage(u,o.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):lr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Em(h,o,u,f,m,b,T,E,C,O,F,W,q,K,J){const ne=Eh.fromFeature(h,m);let ce;W===c.ao.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:qe}=ko;if(Se&&ne.sections.length===1){ce=[];const at=Se(ne.toString(),yv(ne,O,b,o,f,K));for(const _t of at){const Ft=new Eh;Ft.text=_t,Ft.sections=ne.sections;for(let tr=0;tr<_t.length;tr++)Ft.sectionIndex.push(0);ce.push(Ft)}}else if(qe){ce=[];const at=qe(ne.text,ne.sectionIndex,yv(ne,O,b,o,f,K));for(const _t of at){const Ft=new Eh;Ft.text=_t[0],Ft.sectionIndex=_t[1],Ft.sections=ne.sections,ce.push(Ft)}}else ce=(function(at,_t){const Ft=[],tr=at.text;let qt=0;for(const Qt of _t)Ft.push(at.substring(qt,Qt)),qt=Qt;return qt<tr.length&&Ft.push(at.substring(qt,tr.length)),Ft})(ne,yv(ne,O,b,o,f,K));const ke=[],ze={positionedLines:ke,text:ne.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:W,iconsInText:!1,verticalizable:!1};return(function(at,_t,Ft,tr,qt,Qt,Mr,Kt,Jt,Pt,Vr,Zr){let Fr=0,Er=0,pn=0,si=0;const Ii=Kt==="right"?1:Kt==="left"?0:.5,is=Ni/Zr;let Zs=0;for(const ti of qt){ti.trim();const Li=ti.getMaxScale(),qi={positionedGlyphs:[],lineOffset:0};at.positionedLines[Zs]=qi;const Gi=qi.positionedGlyphs;let ys=0;if(!ti.length()){Er+=Qt,++Zs;continue}const Xs=q3(tr,ti,is);for(let Es=0;Es<ti.length();Es++){const Ci=ti.getSection(Es),zi=ti.getSectionIndex(Es),Ui=ti.getCharCode(Es),bi=G3(Jt,Vr,Ui);let Zn;if(Ci.imageName){if(at.iconsInText=!0,Ci.scale=Ci.scale*is,Zn=K3(Ci,bi,Li,Xs,tr),!Zn)continue;ys=Math.max(ys,Zn.imageOffset)}else if(Zn=Y3(Ci,Ui,bi,Xs,_t,Ft),!Zn)continue;const{rect:Fo,metrics:Rh,baselineOffset:No}=Zn;Gi.push({glyph:Ui,imageName:Ci.imageName,x:Fr,y:Er+No+-17,vertical:bi,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:zi,metrics:Rh,rect:Fo}),bi?(at.verticalizable=!0,Fr+=(Ci.imageName?Rh.advance:Ni)*Ci.scale+Pt):Fr+=Rh.advance*Ci.scale+Pt}Gi.length!==0&&(pn=Math.max(Fr-Pt,pn),Q3(Gi,0,Gi.length-1,Ii)),Fr=0,qi.lineOffset=Math.max(ys,(Li-1)*Ni);const Bi=Qt*Li+ys;Er+=Bi,si=Math.max(Bi,si),++Zs}const{horizontalAlign:As,verticalAlign:Xi}=vv(Mr);(function(ti,Li,qi,Gi,ys,Xs,Bi,Es,Ci){const zi=(Li-qi)*ys;let Ui=0;Ui=Xs!==Bi?-Es*Gi- -17:-Gi*Ci*Bi+.5*Bi;for(const bi of ti)for(const Zn of bi.positionedGlyphs)Zn.x+=zi,Zn.y+=Ui})(at.positionedLines,Ii,As,Xi,pn,si,Qt,Er,qt.length),at.top+=-Xi*Er,at.bottom=at.top+Er,at.left+=-As*pn,at.right=at.left+pn})(ze,o,u,f,ce,T,E,C,W,O,q,J),!(function(at){for(const _t of at)if(_t.positionedGlyphs.length!==0)return!1;return!0})(ke)&&ze}const Pm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},H3={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Z3={40:!0};function z1(h,o,u,f,m,b){if(o.imageName){const T=f[o.imageName];return T?T.displaySize[0]*o.scale*Ni/b+m:0}{const T=u[o.fontStack],E=T&&T[h];return E?E.metrics.advance*o.scale+m:0}}function U1(h,o,u,f){const m=Math.pow(h-o,2);return f?h<o?m/2:2*m:m+Math.abs(u)*u}function X3(h,o,u){let f=0;return h===10&&(f-=1e4),u&&(f+=150),h!==40&&h!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function V1(h,o,u,f,m,b){let T=null,E=U1(o,u,m,b);for(const C of f){const O=U1(o-C.x,u,m,b)+C.badness;O<=E&&(T=C,E=O)}return{index:h,x:o,priorBreak:T,badness:E}}function j1(h){return h?j1(h.priorBreak).concat(h.index):[]}function yv(h,o,u,f,m,b){if(!h)return[];const T=[],E=(function(W,q,K,J,ne,ce){let Se=0;for(let qe=0;qe<W.length();qe++){const ke=W.getSection(qe);Se+=z1(W.getCharCode(qe),ke,J,ne,q,ce)}return Se/Math.max(1,Math.ceil(Se/K))})(h,o,u,f,m,b),C=h.text.indexOf("â")>=0;let O=0;for(let W=0;W<h.length();W++){const q=h.getSection(W),K=h.getCharCode(W);if(Pm[K]||(O+=z1(K,q,f,m,o,b)),W<h.length()-1){const J=!((F=K)<11904)&&(!!an["CJK Compatibility Forms"](F)||!!an["CJK Compatibility"](F)||!!an["CJK Strokes"](F)||!!an["CJK Symbols and Punctuation"](F)||!!an["Enclosed CJK Letters and Months"](F)||!!an["Halfwidth and Fullwidth Forms"](F)||!!an["Ideographic Description Characters"](F)||!!an["Vertical Forms"](F)||ch.test(String.fromCodePoint(F)));(H3[K]||J||q.imageName||W!==h.length()-2&&Z3[h.getCharCode(W+1)])&&T.push(V1(W+1,O,E,T,X3(K,h.getCharCode(W+1),J&&C),!1))}}var F;return j1(V1(h.length(),O,E,T,0,!0))}function vv(h){let o=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function q3(h,o,u){const f=o.getMaxScale()*Ni,{maxImageWidth:m,maxImageHeight:b}=o.getMaxImageSize(h),T=Math.max(f,b*u);return{verticalLineContentWidth:Math.max(f,m*u),horizontalLineContentHeight:T}}function W1(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function G3(h,o,u){return!(h===c.ao.horizontal||!o&&!uh(u)||o&&(Pm[u]||(f=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(f)))));var f}function Y3(h,o,u,f,m,b){const T=b[h.fontStack],E=(function(O,F,W,q){if(O&&O.rect)return O;const K=F[W.fontStack],J=K&&K[q];return J?{rect:null,metrics:J.metrics}:null})(T&&T[o],m,h,o);if(E===null)return null;let C;if(u)C=f.verticalLineContentWidth-h.scale*Ni;else{const O=W1(h.verticalAlign);C=(f.horizontalLineContentHeight-h.scale*Ni)*O}return{rect:E.rect,metrics:E.metrics,baselineOffset:C}}function K3(h,o,u,f,m){const b=m[h.imageName];if(!b)return null;const T=b.paddedRect,E=b.displaySize,C={width:E[0],height:E[1],left:1,top:-3,advance:o?E[1]:E[0]};let O;if(o)O=f.verticalLineContentWidth-E[1]*h.scale;else{const F=W1(h.verticalAlign);O=(f.horizontalLineContentHeight-E[1]*h.scale)*F}return{rect:T,metrics:C,baselineOffset:O,imageOffset:(o?E[0]:E[1])*h.scale-Ni*u}}function Q3(h,o,u,f){if(f===0)return;const m=h[u],b=(h[u].x+m.metrics.advance*m.scale)*f;for(let T=o;T<=u;T++)h[T].x-=b}function J3(h,o,u){const{horizontalAlign:f,verticalAlign:m}=vv(u),b=o[0]-h.displaySize[0]*f,T=o[1]-h.displaySize[1]*m;return{image:h,top:T,bottom:T+h.displaySize[1],left:b,right:b+h.displaySize[0]}}function $1(h){var o,u;let f=h.left,m=h.top,b=h.right-f,T=h.bottom-m;const E=(o=h.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",C=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",O=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(C==="proportional"){if(E==="stretchOnly"&&b/T<O||E==="proportional"){const F=Math.ceil(T*O);f*=F/b,b=F}}else if(E==="proportional"&&C==="stretchOnly"&&O!==0&&b/T>O){const F=Math.ceil(b/O);m*=F/T,T=F}return{x1:f,y1:m,x2:f+b,y2:m+T}}function H1(h,o,u,f,m,b){const T=h.image;let E;if(T.content){const ce=T.content,Se=T.pixelRatio||1;E=[ce[0]/Se,ce[1]/Se,T.displaySize[0]-ce[2]/Se,T.displaySize[1]-ce[3]/Se]}const C=o.left*b,O=o.right*b;let F,W,q,K;u==="width"||u==="both"?(K=m[0]+C-f[3],W=m[0]+O+f[1]):(K=m[0]+(C+O-T.displaySize[0])/2,W=K+T.displaySize[0]);const J=o.top*b,ne=o.bottom*b;return u==="height"||u==="both"?(F=m[1]+J-f[0],q=m[1]+ne+f[2]):(F=m[1]+(J+ne-T.displaySize[1])/2,q=F+T.displaySize[1]),{image:T,top:F,right:W,bottom:q,left:K,collisionPadding:E}}const $a=128,Ll=32640;function Z1(h,o){const{expression:u}=o;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new kn(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=u;let b=0;for(;b<f.length&&f[b]<=h;)b++;b=Math.max(0,b-1);let T=b;for(;T<f.length&&f[T]<h+1;)T++;T=Math.min(f.length-1,T);const E=f[b],C=f[T];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:C,minSize:u.evaluate(new kn(E)),maxSize:u.evaluate(new kn(C)),interpolationType:m}}}function bv(h,o,u){let f="never";const m=h.get(o);return m?f=m:h.get(u)&&(f="always"),f}const eM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Im(h,o,u,f,m,b,T,E,C,O,F,W,q){const K=E?Math.min(Ll,Math.round(E[0])):0,J=E?Math.min(Ll,Math.round(E[1])):0;h.emplaceBack(o,u,Math.round(32*f),Math.round(32*m),b,T,(K<<1)+(C?1:0),J,16*O,16*F,256*W,256*q)}function xv(h,o,u){h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u)}function tM(h){for(const o of h.sections)if(Yy(o.text))return!0;return!1}class wv{constructor(o){this.layoutVertexArray=new ft,this.indexArray=new $r,this.programConfigurations=o,this.segments=new en,this.dynamicLayoutVertexArray=new Vt,this.opacityVertexArray=new $t,this.hasVisibleVertices=!1,this.placedSymbolArray=new X}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,I3.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,C3.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,eM,!0),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pr("SymbolBuffers",wv);class Tv{constructor(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new en,this.collisionVertexArray=new Sr}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,R3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pr("CollisionBuffers",Tv);class Ph{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=er(globalThis)?Math.min(o.overscaling,128):o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map((T=>T.id)),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Z1(this.zoom,u["text-size"]),this.iconSizeData=Z1(this.zoom,u["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=bv(f,"text-overlap","text-allow-overlap")!=="never"||bv(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map((T=>c.ao[T]))),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.sourceID=o.sourceID}createArrays(){this.text=new wv(new aa(this.layers,this.zoom,(o=>/^text/.test(o)))),this.icon=new wv(new aa(this.layers,this.zoom,(o=>/^icon/.test(o)))),this.glyphOffsetArray=new re,this.lineVertexArray=new he,this.symbolInstances=new Q,this.textAnchorOffsets=new ge}calculateGlyphDependencies(o,u,f,m,b){for(let T=0;T<o.length;T++)if(u[o.charCodeAt(T)]=!0,(f||m)&&b){const E=Bf[o.charAt(T)];E&&(u[E.charCodeAt(0)]=!0)}}populate(o,u,f){const m=this.layers[0],b=m.layout,T=b.get("text-font"),E=b.get("text-field"),C=b.get("icon-image"),O=(E.value.kind!=="constant"||E.value.value instanceof $i&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),F=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,W=b.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const q=u.iconDependencies,K=u.glyphDependencies,J=u.availableImages,ne=new kn(this.zoom);for(const{feature:ce,id:Se,index:qe,sourceLayerIndex:ke}of o){const ze=m._featureFilter.needGeometry,at=Dc(ce,ze);if(!m._featureFilter.filter(ne,at,f))continue;let _t,Ft;if(ze||(at.geometry=Oo(ce)),O){const qt=m.getValueAndResolveTokens("text-field",at,f,J),Qt=$i.factory(qt),Mr=this.hasRTLText=this.hasRTLText||tM(Qt);(!Mr||ko.getRTLTextPluginStatus()==="unavailable"||Mr&&ko.isParsed())&&(_t=k3(Qt,m,at))}if(F){const qt=m.getValueAndResolveTokens("icon-image",at,f,J);Ft=qt instanceof Zi?qt:Zi.fromString(qt)}if(!_t&&!Ft)continue;const tr=this.sortFeaturesByKey?W.evaluate(at,{},f):void 0;if(this.features.push({id:Se,text:_t,icon:Ft,index:qe,sourceLayerIndex:ke,geometry:at.geometry,properties:ce.properties,type:Sh.types[ce.type],sortKey:tr}),Ft&&(q[Ft.name]=!0),_t){const qt=T.evaluate(at,{},f).join(","),Qt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ao.vertical)>=0;for(const Mr of _t.sections)if(Mr.image)q[Mr.image.name]=!0;else{const Kt=Rl(_t.toString()),Jt=Mr.fontStack||qt,Pt=K[Jt]=K[Jt]||{};this.calculateGlyphDependencies(Mr.text,Pt,Qt,this.allowVerticalPlacement,Kt)}}}b.get("symbol-placement")==="line"&&(this.features=(function(ce){const Se={},qe={},ke=[];let ze=0;function at(qt){ke.push(ce[qt]),ze++}function _t(qt,Qt,Mr){const Kt=qe[qt];return delete qe[qt],qe[Qt]=Kt,ke[Kt].geometry[0].pop(),ke[Kt].geometry[0]=ke[Kt].geometry[0].concat(Mr[0]),Kt}function Ft(qt,Qt,Mr){const Kt=Se[Qt];return delete Se[Qt],Se[qt]=Kt,ke[Kt].geometry[0].shift(),ke[Kt].geometry[0]=Mr[0].concat(ke[Kt].geometry[0]),Kt}function tr(qt,Qt,Mr){const Kt=Mr?Qt[0][Qt[0].length-1]:Qt[0][0];return`${qt}:${Kt.x}:${Kt.y}`}for(let qt=0;qt<ce.length;qt++){const Qt=ce[qt],Mr=Qt.geometry,Kt=Qt.text?Qt.text.toString():null;if(!Kt){at(qt);continue}const Jt=tr(Kt,Mr),Pt=tr(Kt,Mr,!0);if(Jt in qe&&Pt in Se&&qe[Jt]!==Se[Pt]){const Vr=Ft(Jt,Pt,Mr),Zr=_t(Jt,Pt,ke[Vr].geometry);delete Se[Jt],delete qe[Pt],qe[tr(Kt,ke[Zr].geometry,!0)]=Zr,ke[Vr].geometry=null}else Jt in qe?_t(Jt,Pt,Mr):Pt in Se?Ft(Jt,Pt,Mr):(at(qt),Se[Jt]=ze-1,qe[Pt]=ze-1)}return ke.filter((qt=>qt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ce,Se)=>ce.sortKey-Se.sortKey))}update(o,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,{imagePositions:f}),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,{imagePositions:f}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const f=this.lineVertexArray.length;if(o.segment!==void 0){let m=o.dist(u[o.segment+1]),b=o.dist(u[o.segment]);const T={};for(let E=o.segment+1;E<u.length;E++)T[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:m},E<u.length-1&&(m+=u[E+1].dist(u[E]));for(let E=o.segment||0;E>=0;E--)T[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:b},E>0&&(b+=u[E-1].dist(u[E]));for(let E=0;E<u.length;E++){const C=T[E];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,u,f,m,b,T,E,C,O,F,W,q){const K=o.indexArray,J=o.layoutVertexArray,ne=o.segments.prepareSegment(4*u.length,J,K,this.canOverlap?T.sortKey:void 0),ce=this.glyphOffsetArray.length,Se=ne.vertexLength,qe=this.allowVerticalPlacement&&E===c.ao.vertical?Math.PI/2:0,ke=T.text&&T.text.sections;for(let ze=0;ze<u.length;ze++){const{tl:at,tr:_t,bl:Ft,br:tr,tex:qt,pixelOffsetTL:Qt,pixelOffsetBR:Mr,minFontScaleX:Kt,minFontScaleY:Jt,glyphOffset:Pt,isSDF:Vr,sectionIndex:Zr}=u[ze],Fr=ne.vertexLength,Er=Pt[1];Im(J,C.x,C.y,at.x,Er+at.y,qt.x,qt.y,f,Vr,Qt.x,Qt.y,Kt,Jt),Im(J,C.x,C.y,_t.x,Er+_t.y,qt.x+qt.w,qt.y,f,Vr,Mr.x,Qt.y,Kt,Jt),Im(J,C.x,C.y,Ft.x,Er+Ft.y,qt.x,qt.y+qt.h,f,Vr,Qt.x,Mr.y,Kt,Jt),Im(J,C.x,C.y,tr.x,Er+tr.y,qt.x+qt.w,qt.y+qt.h,f,Vr,Mr.x,Mr.y,Kt,Jt),xv(o.dynamicLayoutVertexArray,C,qe),K.emplaceBack(Fr,Fr+2,Fr+1),K.emplaceBack(Fr+1,Fr+2,Fr+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pt[0]),ze!==u.length-1&&Zr===u[ze+1].sectionIndex||o.programConfigurations.populatePaintArrays(J.length,T,T.index,{imagePositions:{},canonical:q,formattedSection:ke&&ke[Zr]})}o.placedSymbolArray.emplaceBack(C.x,C.y,ce,this.glyphOffsetArray.length-ce,Se,O,F,C.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],E,0,!1,0,W)}_addCollisionDebugVertex(o,u,f,m,b,T){return u.emplaceBack(0,0),o.emplaceBack(f.x,f.y,m,b,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(o,u,f,m,b,T,E){const C=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),O=C.vertexLength,F=b.layoutVertexArray,W=b.collisionVertexArray,q=E.anchorX,K=E.anchorY;this._addCollisionDebugVertex(F,W,T,q,K,new g(o,u)),this._addCollisionDebugVertex(F,W,T,q,K,new g(f,u)),this._addCollisionDebugVertex(F,W,T,q,K,new g(f,m)),this._addCollisionDebugVertex(F,W,T,q,K,new g(o,m)),C.vertexLength+=4;const J=b.indexArray;J.emplaceBack(O,O+1),J.emplaceBack(O+1,O+2),J.emplaceBack(O+2,O+3),J.emplaceBack(O+3,O),C.primitiveLength+=4}addDebugCollisionBoxes(o,u,f,m){for(let b=o;b<u;b++){const T=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,m?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tv(Dt,D1.members,En),this.iconCollisionBox=new Tv(Dt,D1.members,En);for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(o,u,f,m,b,T,E,C,O){const F={};for(let W=u;W<f;W++){const q=o.get(W);F.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.textFeatureIndex=q.featureIndex;break}for(let W=m;W<b;W++){const q=o.get(W);F.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalTextFeatureIndex=q.featureIndex;break}for(let W=T;W<E;W++){const q=o.get(W);F.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.iconFeatureIndex=q.featureIndex;break}for(let W=C;W<O;W++){const q=o.get(W);F.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},F.verticalIconFeatureIndex=q.featureIndex;break}return F}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const f=o.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<m;b+=4)o.indexArray.emplaceBack(b,b+2,b+1),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(o),f=Math.cos(o),m=[],b=[],T=[];for(let E=0;E<this.symbolInstances.length;++E){T.push(E);const C=this.symbolInstances.get(E);m.push(0|Math.round(u*C.anchorX+f*C.anchorY)),b.push(C.featureIndex)}return T.sort(((E,C)=>m[E]-m[C]||b[C]-b[E])),T}addToSortKeyRanges(o,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach(((m,b,T)=>{m>=0&&T.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)})),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let X1,q1;pr("SymbolBucket",Ph,{omit:["layers","collisionBoxArray","features","compareText"]}),Ph.MAX_GLYPHS=65535,Ph.addDynamicAttributes=xv;var Sv={get paint(){return q1=q1||new hs({"icon-opacity":new Ur(Xe.paint_symbol["icon-opacity"]),"icon-color":new Ur(Xe.paint_symbol["icon-color"]),"icon-halo-color":new Ur(Xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ur(Xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ur(Xe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ir(Xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ir(Xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ur(Xe.paint_symbol["text-opacity"]),"text-color":new Ur(Xe.paint_symbol["text-color"],{runtimeType:Qr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Ur(Xe.paint_symbol["text-halo-color"]),"text-halo-width":new Ur(Xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ur(Xe.paint_symbol["text-halo-blur"]),"text-translate":new Ir(Xe.paint_symbol["text-translate"]),"text-translate-anchor":new Ir(Xe.paint_symbol["text-translate-anchor"])})},get layout(){return X1=X1||new hs({"symbol-placement":new Ir(Xe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ir(Xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ir(Xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ur(Xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ir(Xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ir(Xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ir(Xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ir(Xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ir(Xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ir(Xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ur(Xe.layout_symbol["icon-size"]),"icon-text-fit":new Ir(Xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ir(Xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ur(Xe.layout_symbol["icon-image"]),"icon-rotate":new Ur(Xe.layout_symbol["icon-rotate"]),"icon-padding":new Ur(Xe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ir(Xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ur(Xe.layout_symbol["icon-offset"]),"icon-anchor":new Ur(Xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ir(Xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ir(Xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ir(Xe.layout_symbol["text-rotation-alignment"]),"text-field":new Ur(Xe.layout_symbol["text-field"]),"text-font":new Ur(Xe.layout_symbol["text-font"]),"text-size":new Ur(Xe.layout_symbol["text-size"]),"text-max-width":new Ur(Xe.layout_symbol["text-max-width"]),"text-line-height":new Ir(Xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ur(Xe.layout_symbol["text-letter-spacing"]),"text-justify":new Ur(Xe.layout_symbol["text-justify"]),"text-radial-offset":new Ur(Xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ir(Xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ur(Xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ur(Xe.layout_symbol["text-anchor"]),"text-max-angle":new Ir(Xe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ir(Xe.layout_symbol["text-writing-mode"]),"text-rotate":new Ur(Xe.layout_symbol["text-rotate"]),"text-padding":new Ir(Xe.layout_symbol["text-padding"]),"text-keep-upright":new Ir(Xe.layout_symbol["text-keep-upright"]),"text-transform":new Ur(Xe.layout_symbol["text-transform"]),"text-offset":new Ur(Xe.layout_symbol["text-offset"]),"text-allow-overlap":new Ir(Xe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ir(Xe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ir(Xe.layout_symbol["text-ignore-placement"]),"text-optional":new Ir(Xe.layout_symbol["text-optional"])})}};class G1{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:vn,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pr("FormatSectionOverride",G1,{omit:["defaultValue"]});class Cm extends Ws{constructor(o,u){super(o,Sv,u)}recalculate(o,u){if(super.recalculate(o,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const b of f)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,u,f,m){const b=this.layout.get(o).evaluate(u,{},f,m),T=this._unevaluatedLayout._values[o];return T.isDataDriven()||Ju(T.value)||!b?b:(function(E,C){return C.replace(/{([^{}]+)}/g,((O,F)=>E&&F in E?String(E[F]):""))})(u.properties,b)}createBucket(o){return new Ph(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of Sv.paint.overridableProperties){if(!Cm.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),f=new G1(u),m=new Qu(f,u.property.specification);let b=null;b=u.value.kind==="constant"||u.value.kind==="source"?new th("source",m):new af("composite",m,u.value.zoomStops),this.paint._values[o]=new ho(u.property,b,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Cm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const f=o.get("text-field"),m=Sv.paint.properties[u];let b=!1;const T=E=>{for(const C of E)if(m.overrides&&m.overrides.hasOverride(C))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof $i)T(f.value.value.sections);else if(f.value.kind==="source"||f.value.kind==="composite"){const E=O=>{b||(O instanceof Co&&Qn(O.value)===nn?T(O.value.sections):O instanceof Uu?T(O.sections):O.eachChild(E))},C=f.value;C._styleExpression&&E(C._styleExpression.expression)}return b}}let Y1;var rM={get paint(){return Y1=Y1||new hs({"background-color":new Ir(Xe.paint_background["background-color"]),"background-pattern":new wf(Xe.paint_background["background-pattern"]),"background-opacity":new Ir(Xe.paint_background["background-opacity"])})}};class nM extends Ws{constructor(o,u){super(o,rM,u)}}class iM extends Ws{constructor(o,u){super(o,{},u),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class sM{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const oM={once:!0},Av=63710088e-1;class Bl{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bl(Dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,f=this.lat*u,m=o.lat*u,b=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return Av*Math.acos(Math.min(b,1))}static convert(o){if(o instanceof Bl)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Bl(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Bl(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const K1=2*Math.PI*Av;function Q1(h){return K1*Math.cos(h*Math.PI/180)}function J1(h){return(180+h)/360}function eT(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function tT(h,o){return h/Q1(o)}function Ev(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function rT(h,o){return h*Q1(Ev(o))}class Uf{constructor(o,u,f=0){this.x=+o,this.y=+u,this.z=+f}static fromLngLat(o,u=0){const f=Bl.convert(o);return new Uf(J1(f.lng),eT(f.lat),tT(u,f.lat))}toLngLat(){return new Bl(360*this.x-180,Ev(this.y))}toAltitude(){return rT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/K1*(o=Ev(this.y),1/Math.cos(o*Math.PI/180));var o}}function nT(h,o,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[h*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class Pv{constructor(o,u,f){if(!(function(m,b,T){return!(m<0||m>25||T<0||T>=Math.pow(2,m)||b<0||b>=Math.pow(2,m))})(o,u,f))throw new Error(`x=${u}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=u,this.y=f,this.key=Ih(0,o,o,u,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u,f){const m=(T=this.y,E=this.z,C=nT(256*(b=this.x),256*(T=Math.pow(2,E)-T-1),E),O=nT(256*(b+1),256*(T+1),E),C[0]+","+C[1]+","+O[0]+","+O[1]);var b,T,E,C,O;const F=(function(W,q,K){let J,ne="";for(let ce=W;ce>0;ce--)J=1<<ce-1,ne+=(q&J?1:0)+(K&J?2:0);return ne})(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,m)}isChildOf(o){const u=this.z-o.z;return u>0&&o.x===this.x>>u&&o.y===this.y>>u}getTilePoint(o){const u=Math.pow(2,this.z);return new g((o.x*u-this.x)*it,(o.y*u-this.y)*it)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iT{constructor(o,u){this.wrap=o,this.canonical=u,this.key=Ih(o,u.z,u.z,u.x,u.y)}}class Hs{constructor(o,u,f,m,b){if(this.terrainRttPosMatrix32f=null,o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=u,this.canonical=new Pv(f,+m,+b),this.key=Ih(u,o,f,m,b)}clone(){return new Hs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-o;return o>this.canonical.z?new Hs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hs(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(o,u){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?Ih(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):Ih(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap||this.overscaledZ-o.overscaledZ<=0)return!1;if(o.overscaledZ===0)return this.overscaledZ>0;const u=this.canonical.z-o.canonical.z;return!(u<0)&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new Hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new Hs(u,this.wrap,u,f,m),new Hs(u,this.wrap,u,f+1,m),new Hs(u,this.wrap,u,f,m+1),new Hs(u,this.wrap,u,f+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Hs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Uf(o.x-this.wrap,o.y))}}function Ih(h,o,u,f,m){(h*=2)<0&&(h=-1*h-1);const b=1<<u;return(b*b*h+b*m+f).toString(36)+u.toString(36)+o.toString(36)}function Vf(h,o){return o?h.properties[o]:h.id}pr("CanonicalTileID",Pv),pr("OverscaledTileID",Hs,{omit:["terrainRttPosMatrix32f"]});class Nc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(o){return this.minX=Math.min(this.minX,o.x),this.minY=Math.min(this.minY,o.y),this.maxX=Math.max(this.maxX,o.x),this.maxY=Math.max(this.maxY,o.y),this}expandBy(o){return this.minX-=o,this.minY-=o,this.maxX+=o,this.maxY+=o,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(o){return this.expandBy(-o)}map(o){const u=new Nc;return u.extend(o(new g(this.minX,this.minY))),u.extend(o(new g(this.maxX,this.minY))),u.extend(o(new g(this.minX,this.maxY))),u.extend(o(new g(this.maxX,this.maxY))),u}static fromPoints(o){const u=new Nc;for(const f of o)u.extend(f);return u}contains(o){return o.x>=this.minX&&o.x<=this.maxX&&o.y>=this.minY&&o.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(o){return!this.empty()&&!o.empty()&&o.minX>=this.minX&&o.maxX<=this.maxX&&o.minY>=this.minY&&o.maxY<=this.maxY}intersects(o){return!this.empty()&&!o.empty()&&o.minX<=this.maxX&&o.maxX>=this.minX&&o.minY<=this.maxY&&o.maxY>=this.minY}}class sT{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class oT{constructor(o,u,f,m,b){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=f,o._y=m,this.properties=o.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o}}class aT{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Ro(it,16,0),this.grid3D=new Ro(it,16,0),this.featureIndexArray=new De,this.promoteId=u}insert(o,u,f,m,b,T){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,b);const C=T?this.grid3D:this.grid;for(let O=0;O<u.length;O++){const F=u[O],W=[1/0,1/0,-1/0,-1/0];for(let q=0;q<F.length;q++){const K=F[q];W[0]=Math.min(W[0],K.x),W[1]=Math.min(W[1],K.y),W[2]=Math.max(W[2],K.x),W[3]=Math.max(W[3],K.y)}W[0]<it&&W[1]<it&&W[2]>=0&&W[3]>=0&&C.insert(E,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new S1(new mv(this.rawTileData)).layers,this.sourceLayerCoder=new sT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,u,f,m){this.loadVTLayers();const b=o.params,T=it/o.tileSize/o.scale,E=Tl(b.filter,b.globalState),C=o.queryGeometry,O=o.queryPadding*T,F=Nc.fromPoints(C),W=this.grid.query(F.minX-O,F.minY-O,F.maxX+O,F.maxY+O),q=Nc.fromPoints(o.cameraQueryGeometry).expandBy(O),K=this.grid3D.query(q.minX,q.minY,q.maxX,q.maxY,((ce,Se,qe,ke)=>(function(ze,at,_t,Ft,tr){for(const Qt of ze)if(at<=Qt.x&&_t<=Qt.y&&Ft>=Qt.x&&tr>=Qt.y)return!0;const qt=[new g(at,_t),new g(at,tr),new g(Ft,tr),new g(Ft,_t)];if(ze.length>2){for(const Qt of qt)if(vh(ze,Qt))return!0}for(let Qt=0;Qt<ze.length-1;Qt++)if(NR(ze[Qt],ze[Qt+1],qt))return!0;return!1})(o.cameraQueryGeometry,ce-O,Se-O,qe+O,ke+O)));for(const ce of K)W.push(ce);W.sort(aM);const J={};let ne;for(let ce=0;ce<W.length;ce++){const Se=W[ce];if(Se===ne)continue;ne=Se;const qe=this.featureIndexArray.get(Se);let ke=null;this.loadMatchingFeature(J,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,E,b.layers,b.availableImages,u,f,m,((ze,at,_t)=>(ke||(ke=Oo(ze)),at.queryIntersectsFeature({queryGeometry:C,feature:ze,featureState:_t,geometry:ke,zoom:this.z,transform:o.transform,pixelsToTileUnits:T,pixelPosMatrix:o.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:o.getElevation}))))}return J}loadMatchingFeature(o,u,f,m,b,T,E,C,O,F,W){const q=this.bucketLayerIDs[u];if(T&&!q.some((ce=>T.has(ce))))return;const K=this.sourceLayerCoder.decode(f),J=this.vtLayers[K].feature(m);if(b.needGeometry){const ce=Dc(J,!0);if(!b.filter(new kn(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!b.filter(new kn(this.tileID.overscaledZ),J))return;const ne=this.getId(J,K);for(let ce=0;ce<q.length;ce++){const Se=q[ce];if(T&&!T.has(Se))continue;const qe=C[Se];if(!qe)continue;let ke={};ne&&F&&(ke=F.getState(qe.sourceLayer||"_geojsonTileLayer",ne));const ze=Et({},O[Se]);ze.paint=lT(ze.paint,qe.paint,J,ke,E),ze.layout=lT(ze.layout,qe.layout,J,ke,E);const at=!W||W(J,qe,ke);if(!at)continue;const _t=new oT(J,this.z,this.x,this.y,ne);_t.layer=ze;let Ft=o[Se];Ft===void 0&&(Ft=o[Se]=[]),Ft.push({featureIndex:m,feature:_t,intersectionZ:at})}}lookupSymbolFeatures(o,u,f,m,b,T,E,C){const O={};this.loadVTLayers();const F=Tl(b.filterSpec,b.globalState);for(const W of o)this.loadMatchingFeature(O,f,m,W,F,T,E,C,u);return O}hasLayer(o){for(const u of this.bucketLayerIDs)for(const f of u)if(o===f)return!0;return!1}getId(o,u){var f;let m=o.id;return this.promoteId&&(m=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof m=="boolean"&&(m=Number(m)),m===void 0&&(!((f=o.properties)===null||f===void 0)&&f.cluster)&&this.promoteId&&(m=Number(o.properties.cluster_id))),m}}function lT(h,o,u,f,m){return Pr(h,((b,T)=>{const E=o instanceof Ml?o.get(T):null;return E&&E.evaluate?E.evaluate(u,f,m):E}))}function aM(h,o){return o-h}function cT(h,o,u,f,m){const b=[];for(let T=0;T<h.length;T++){const E=h[T];let C;for(let O=0;O<E.length-1;O++){let F=E[O],W=E[O+1];F.x<o&&W.x<o||(F.x<o?F=new g(o,F.y+(o-F.x)/(W.x-F.x)*(W.y-F.y))._round():W.x<o&&(W=new g(o,F.y+(o-F.x)/(W.x-F.x)*(W.y-F.y))._round()),F.y<u&&W.y<u||(F.y<u?F=new g(F.x+(u-F.y)/(W.y-F.y)*(W.x-F.x),u)._round():W.y<u&&(W=new g(F.x+(u-F.y)/(W.y-F.y)*(W.x-F.x),u)._round()),F.x>=f&&W.x>=f||(F.x>=f?F=new g(f,F.y+(f-F.x)/(W.x-F.x)*(W.y-F.y))._round():W.x>=f&&(W=new g(f,F.y+(f-F.x)/(W.x-F.x)*(W.y-F.y))._round()),F.y>=m&&W.y>=m||(F.y>=m?F=new g(F.x+(m-F.y)/(W.y-F.y)*(W.x-F.x),m)._round():W.y>=m&&(W=new g(F.x+(m-F.y)/(W.y-F.y)*(W.x-F.x),m)._round()),C&&F.equals(C[C.length-1])||(C=[F],b.push(C)),C.push(W)))))}}return b}pr("FeatureIndex",aT,{omit:["rawTileData","sourceLayerCoder"]});class zl extends g{constructor(o,u,f,m){super(o,u),this.angle=f,m!==void 0&&(this.segment=m)}clone(){return new zl(this.x,this.y,this.angle,this.segment)}}function uT(h,o,u,f,m){if(o.segment===void 0||u===0)return!0;let b=o,T=o.segment+1,E=0;for(;E>-u/2;){if(T--,T<0)return!1;E-=h[T].dist(b),b=h[T]}E+=h[T].dist(h[T+1]),T++;const C=[];let O=0;for(;E<u/2;){const F=h[T],W=h[T+1];if(!W)return!1;let q=h[T-1].angleTo(F)-F.angleTo(W);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:E,angleDelta:q}),O+=q;E-C[0].distance>f;)O-=C.shift().angleDelta;if(O>m)return!1;T++,E+=F.dist(W)}return!0}function hT(h){let o=0;for(let u=0;u<h.length-1;u++)o+=h[u].dist(h[u+1]);return o}function dT(h,o,u){return h?.6*o*u:0}function fT(h,o){return Math.max(h?h.right-h.left:0,o?o.right-o.left:0)}function lM(h,o,u,f,m,b){const T=dT(u,m,b),E=fT(u,f)*b;let C=0;const O=hT(h)/2;for(let F=0;F<h.length-1;F++){const W=h[F],q=h[F+1],K=W.dist(q);if(C+K>O){const J=(O-C)/K,ne=us.number(W.x,q.x,J),ce=us.number(W.y,q.y,J),Se=new zl(ne,ce,q.angleTo(W),F);return Se._round(),!T||uT(h,Se,E,T,o)?Se:void 0}C+=K}}function cM(h,o,u,f,m,b,T,E,C){const O=dT(f,b,T),F=fT(f,m),W=F*T,q=h[0].x===0||h[0].x===C||h[0].y===0||h[0].y===C;return o-W<o/4&&(o=W+o/4),pT(h,q?o/2*E%o:(F/2+2*b)*T*E%o,o,O,u,W,q,!1,C)}function pT(h,o,u,f,m,b,T,E,C){const O=b/2,F=hT(h);let W=0,q=o-u,K=[];for(let J=0;J<h.length-1;J++){const ne=h[J],ce=h[J+1],Se=ne.dist(ce),qe=ce.angleTo(ne);for(;q+u<W+Se;){q+=u;const ke=(q-W)/Se,ze=us.number(ne.x,ce.x,ke),at=us.number(ne.y,ce.y,ke);if(ze>=0&&ze<C&&at>=0&&at<C&&q-O>=0&&q+O<=F){const _t=new zl(ze,at,qe,J);_t._round(),f&&!uT(h,_t,b,f,m)||K.push(_t)}}W+=Se}return E||K.length||T||(K=pT(h,W/2,u,f,m,b,T,!0,C)),K}function gT(h,o,u,f){const m=[],b=h.image,T=b.pixelRatio,E=b.paddedRect.w-2,C=b.paddedRect.h-2;let O={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const F=b.stretchX||[[0,E]],W=b.stretchY||[[0,C]],q=(Pt,Vr)=>Pt+Vr[1]-Vr[0],K=F.reduce(q,0),J=W.reduce(q,0),ne=E-K,ce=C-J;let Se=0,qe=K,ke=0,ze=J,at=0,_t=ne,Ft=0,tr=ce;if(b.content&&f){const Pt=b.content,Vr=Pt[2]-Pt[0],Zr=Pt[3]-Pt[1];(b.textFitWidth||b.textFitHeight)&&(O=$1(h)),Se=Rm(F,0,Pt[0]),ke=Rm(W,0,Pt[1]),qe=Rm(F,Pt[0],Pt[2]),ze=Rm(W,Pt[1],Pt[3]),at=Pt[0]-Se,Ft=Pt[1]-ke,_t=Vr-qe,tr=Zr-ze}const qt=O.x1,Qt=O.y1,Mr=O.x2-qt,Kt=O.y2-Qt,Jt=(Pt,Vr,Zr,Fr)=>{const Er=Mm(Pt.stretch-Se,qe,Mr,qt),pn=km(Pt.fixed-at,_t,Pt.stretch,K),si=Mm(Vr.stretch-ke,ze,Kt,Qt),Ii=km(Vr.fixed-Ft,tr,Vr.stretch,J),is=Mm(Zr.stretch-Se,qe,Mr,qt),Zs=km(Zr.fixed-at,_t,Zr.stretch,K),As=Mm(Fr.stretch-ke,ze,Kt,Qt),Xi=km(Fr.fixed-Ft,tr,Fr.stretch,J),ti=new g(Er,si),Li=new g(is,si),qi=new g(is,As),Gi=new g(Er,As),ys=new g(pn/T,Ii/T),Xs=new g(Zs/T,Xi/T),Bi=o*Math.PI/180;if(Bi){const zi=Math.sin(Bi),Ui=Math.cos(Bi),bi=[Ui,-zi,zi,Ui];ti._matMult(bi),Li._matMult(bi),Gi._matMult(bi),qi._matMult(bi)}const Es=Pt.stretch+Pt.fixed,Ci=Vr.stretch+Vr.fixed;return{tl:ti,tr:Li,bl:Gi,br:qi,tex:{x:b.paddedRect.x+1+Es,y:b.paddedRect.y+1+Ci,w:Zr.stretch+Zr.fixed-Es,h:Fr.stretch+Fr.fixed-Ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ys,pixelOffsetBR:Xs,minFontScaleX:_t/T/Mr,minFontScaleY:tr/T/Kt,isSDF:u}};if(f&&(b.stretchX||b.stretchY)){const Pt=mT(F,ne,K),Vr=mT(W,ce,J);for(let Zr=0;Zr<Pt.length-1;Zr++){const Fr=Pt[Zr],Er=Pt[Zr+1];for(let pn=0;pn<Vr.length-1;pn++)m.push(Jt(Fr,Vr[pn],Er,Vr[pn+1]))}}else m.push(Jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:C+1}));return m}function Rm(h,o,u){let f=0;for(const m of h)f+=Math.max(o,Math.min(u,m[1]))-Math.max(o,Math.min(u,m[0]));return f}function mT(h,o,u){const f=[{fixed:-1,stretch:0}];for(const[m,b]of h){const T=f[f.length-1];f.push({fixed:m-T.stretch,stretch:T.stretch}),f.push({fixed:m-T.stretch,stretch:T.stretch+(b-m)})}return f.push({fixed:o+1,stretch:u}),f}function Mm(h,o,u,f){return h/o*u+f}function km(h,o,u,f){return h-o*u/f}pr("Anchor",zl);class Dm{constructor(o,u,f,m,b,T,E,C,O,F){var W;if(this.boxStartIndex=o.length,O){let q=T.top,K=T.bottom;const J=T.collisionPadding;J&&(q-=J[1],K+=J[3]);let ne=K-q;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{const q=!((W=T.image)===null||W===void 0)&&W.content&&(T.image.textFitWidth||T.image.textFitHeight)?$1(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};q.y1=q.y1*E-C[0],q.y2=q.y2*E+C[2],q.x1=q.x1*E-C[3],q.x2=q.x2*E+C[1];const K=T.collisionPadding;if(K&&(q.x1-=K[0]*E,q.y1-=K[1]*E,q.x2+=K[2]*E,q.y2+=K[3]*E),F){const J=new g(q.x1,q.y1),ne=new g(q.x2,q.y1),ce=new g(q.x1,q.y2),Se=new g(q.x2,q.y2),qe=F*Math.PI/180;J._rotate(qe),ne._rotate(qe),ce._rotate(qe),Se._rotate(qe),q.x1=Math.min(J.x,ne.x,ce.x,Se.x),q.x2=Math.max(J.x,ne.x,ce.x,Se.x),q.y1=Math.min(J.y,ne.y,ce.y,Se.y),q.y2=Math.max(J.y,ne.y,ce.y,Se.y)}o.emplaceBack(u.x,u.y,q.x1,q.y1,q.x2,q.y2,f,m,b)}this.boxEndIndex=o.length}}class uM{constructor(o=[],u=(f,m)=>f<m?-1:f>m?1:0){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:f}=this,m=u[o];for(;o>0;){const b=o-1>>1,T=u[b];if(f(m,T)>=0)break;u[o]=T,o=b}u[o]=m}_down(o){const{data:u,compare:f}=this,m=this.length>>1,b=u[o];for(;o<m;){let T=1+(o<<1);const E=T+1;if(E<this.length&&f(u[E],u[T])<0&&(T=E),f(u[T],b)>=0)break;u[o]=u[T],o=T}u[o]=b}}function hM(h,o=1,u=!1){const f=Nc.fromPoints(h[0]),m=Math.min(f.width(),f.height());let b=m/2;const T=new uM([],dM),{minX:E,minY:C,maxX:O,maxY:F}=f;if(m===0)return new g(E,C);for(let K=E;K<O;K+=m)for(let J=C;J<F;J+=m)T.push(new Ch(K+b,J+b,b,h));let W=(function(K){let J=0,ne=0,ce=0;const Se=K[0];for(let qe=0,ke=Se.length,ze=ke-1;qe<ke;ze=qe++){const at=Se[qe],_t=Se[ze],Ft=at.x*_t.y-_t.x*at.y;ne+=(at.x+_t.x)*Ft,ce+=(at.y+_t.y)*Ft,J+=3*Ft}return new Ch(ne/J,ce/J,0,K)})(h),q=T.length;for(;T.length;){const K=T.pop();(K.d>W.d||!W.d)&&(W=K,u&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,q)),K.max-W.d<=o||(b=K.h/2,T.push(new Ch(K.p.x-b,K.p.y-b,b,h)),T.push(new Ch(K.p.x+b,K.p.y-b,b,h)),T.push(new Ch(K.p.x-b,K.p.y+b,b,h)),T.push(new Ch(K.p.x+b,K.p.y+b,b,h)),q+=4)}return u&&(console.log(`num probes: ${q}`),console.log(`best distance: ${W.d}`)),W.p}function dM(h,o){return o.max-h.max}function Ch(h,o,u,f){this.p=new g(h,o),this.h=u,this.d=(function(m,b){let T=!1,E=1/0;for(let C=0;C<b.length;C++){const O=b[C];for(let F=0,W=O.length,q=W-1;F<W;q=F++){const K=O[F],J=O[q];K.y>m.y!=J.y>m.y&&m.x<(J.x-K.x)*(m.y-K.y)/(J.y-K.y)+K.x&&(T=!T),E=Math.min(E,t1(m,K,J))}}return(T?1:-1)*Math.sqrt(E)})(this.p,f),this.max=this.d+this.h*Math.SQRT2}var ns;c.aE=void 0,(ns=c.aE||(c.aE={}))[ns.center=1]="center",ns[ns.left=2]="left",ns[ns.right=3]="right",ns[ns.top=4]="top",ns[ns.bottom=5]="bottom",ns[ns["top-left"]=6]="top-left",ns[ns["top-right"]=7]="top-right",ns[ns["bottom-left"]=8]="bottom-left",ns[ns["bottom-right"]=9]="bottom-right";const Iv=Number.POSITIVE_INFINITY;function _T(h,o){return o[1]!==Iv?(function(u,f,m){let b=0,T=0;switch(f=Math.abs(f),m=Math.abs(m),u){case"top-right":case"top-left":case"top":T=m-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-m}switch(u){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,T]})(h,o[0],o[1]):(function(u,f){let m=0,b=0;f<0&&(f=0);const T=f/Math.SQRT2;switch(u){case"top-right":case"top-left":b=T-7;break;case"bottom-right":case"bottom-left":b=7-T;break;case"bottom":b=7-f;break;case"top":b=f-7}switch(u){case"top-right":case"bottom-right":m=-T;break;case"top-left":case"bottom-left":m=T;break;case"left":m=f;break;case"right":m=-f}return[m,b]})(h,o[0])}function yT(h,o,u){var f;const m=h.layout,b=(f=m.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},u);if(b){const E=b.values,C=[];for(let O=0;O<E.length;O+=2){const F=C[O]=E[O],W=E[O+1].map((q=>q*Ni));F.startsWith("top")?W[1]-=7:F.startsWith("bottom")&&(W[1]+=7),C[O+1]=W}return new Hi(C)}const T=m.get("text-variable-anchor");if(T){let E;E=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(o,{},u)*Ni,Iv]:m.get("text-offset").evaluate(o,{},u).map((O=>O*Ni));const C=[];for(const O of T)C.push(O,_T(O,E));return new Hi(C)}return null}function Cv(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fM(h,o,u,f,m,b,T,E,C,O,F,W){let q=b.textMaxSize.evaluate(o,{});q===void 0&&(q=T);const K=h.layers[0].layout,J=K.get("icon-offset").evaluate(o,{},F),ne=bT(u.horizontal),ce=T/24,Se=h.tilePixelRatio*ce,qe=h.tilePixelRatio*q/24,ke=h.tilePixelRatio*E,ze=h.tilePixelRatio*K.get("symbol-spacing"),at=K.get("text-padding")*h.tilePixelRatio,_t=(function(Zr,Fr,Er,pn=1){const si=Zr.get("icon-padding").evaluate(Fr,{},Er),Ii=si&&si.values;return[Ii[0]*pn,Ii[1]*pn,Ii[2]*pn,Ii[3]*pn]})(K,o,F,h.tilePixelRatio),Ft=K.get("text-max-angle")/180*Math.PI,tr=K.get("text-rotation-alignment")!=="viewport"&&K.get("symbol-placement")!=="point",qt=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Qt=K.get("symbol-placement"),Mr=ze/2,Kt=K.get("icon-text-fit");let Jt;f&&Kt!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(Jt=H1(f,u.vertical,Kt,K.get("icon-text-fit-padding"),J,ce)),ne&&(f=H1(f,ne,Kt,K.get("icon-text-fit-padding"),J,ce)));const Pt=F?W.line.getGranularityForZoomLevel(F.z):1,Vr=(Zr,Fr)=>{Fr.x<0||Fr.x>=it||Fr.y<0||Fr.y>=it||(function(Er,pn,si,Ii,is,Zs,As,Xi,ti,Li,qi,Gi,ys,Xs,Bi,Es,Ci,zi,Ui,bi,Zn,Fo,Rh,No,mM){const Mh=Er.addToLineVertexArray(pn,si);let Lc,kh,Dh,Oh,ST=0,AT=0,ET=0,PT=0,Lv=-1,Bv=-1;const Ha={};let IT=na("");if(Er.allowVerticalPlacement&&Ii.vertical){const fs=Xi.layout.get("text-rotate").evaluate(Zn,{},No)+90;Dh=new Dm(ti,pn,Li,qi,Gi,Ii.vertical,ys,Xs,Bi,fs),As&&(Oh=new Dm(ti,pn,Li,qi,Gi,As,Ci,zi,Bi,fs))}if(is){const fs=Xi.layout.get("icon-rotate").evaluate(Zn,{}),qs=Xi.layout.get("icon-text-fit")!=="none",Bc=gT(is,fs,Rh,qs),Bo=As?gT(As,fs,Rh,qs):void 0;kh=new Dm(ti,pn,Li,qi,Gi,is,Ci,zi,!1,fs),ST=4*Bc.length;const zc=Er.iconSizeData;let la=null;zc.kind==="source"?(la=[$a*Xi.layout.get("icon-size").evaluate(Zn,{})],la[0]>Ll&&lr(`${Er.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):zc.kind==="composite"&&(la=[$a*Fo.compositeIconSizes[0].evaluate(Zn,{},No),$a*Fo.compositeIconSizes[1].evaluate(Zn,{},No)],(la[0]>Ll||la[1]>Ll)&&lr(`${Er.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Er.addSymbols(Er.icon,Bc,la,bi,Ui,Zn,c.ao.none,pn,Mh.lineStartIndex,Mh.lineLength,-1,No),Lv=Er.icon.placedSymbolArray.length-1,Bo&&(AT=4*Bo.length,Er.addSymbols(Er.icon,Bo,la,bi,Ui,Zn,c.ao.vertical,pn,Mh.lineStartIndex,Mh.lineLength,-1,No),Bv=Er.icon.placedSymbolArray.length-1)}const CT=Object.keys(Ii.horizontal);for(const fs of CT){const qs=Ii.horizontal[fs];if(!Lc){IT=na(qs.text);const Bo=Xi.layout.get("text-rotate").evaluate(Zn,{},No);Lc=new Dm(ti,pn,Li,qi,Gi,qs,ys,Xs,Bi,Bo)}const Bc=qs.positionedLines.length===1;if(ET+=vT(Er,pn,qs,Zs,Xi,Bi,Zn,Es,Mh,Ii.vertical?c.ao.horizontal:c.ao.horizontalOnly,Bc?CT:[fs],Ha,Lv,Fo,No),Bc)break}Ii.vertical&&(PT+=vT(Er,pn,Ii.vertical,Zs,Xi,Bi,Zn,Es,Mh,c.ao.vertical,["vertical"],Ha,Bv,Fo,No));const _M=Lc?Lc.boxStartIndex:Er.collisionBoxArray.length,yM=Lc?Lc.boxEndIndex:Er.collisionBoxArray.length,vM=Dh?Dh.boxStartIndex:Er.collisionBoxArray.length,bM=Dh?Dh.boxEndIndex:Er.collisionBoxArray.length,xM=kh?kh.boxStartIndex:Er.collisionBoxArray.length,wM=kh?kh.boxEndIndex:Er.collisionBoxArray.length,TM=Oh?Oh.boxStartIndex:Er.collisionBoxArray.length,SM=Oh?Oh.boxEndIndex:Er.collisionBoxArray.length;let Lo=-1;const Fm=(fs,qs)=>fs&&fs.circleDiameter?Math.max(fs.circleDiameter,qs):qs;Lo=Fm(Lc,Lo),Lo=Fm(Dh,Lo),Lo=Fm(kh,Lo),Lo=Fm(Oh,Lo);const RT=Lo>-1?1:0;RT&&(Lo*=mM/Ni),Er.glyphOffsetArray.length>=Ph.MAX_GLYPHS&&lr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&Er.addToSortKeyRanges(Er.symbolInstances.length,Zn.sortKey);const AM=yT(Xi,Zn,No),[EM,PM]=(function(fs,qs){const Bc=fs.length,Bo=qs?.values;if(Bo?.length>0)for(let zc=0;zc<Bo.length;zc+=2){const la=Bo[zc+1];fs.emplaceBack(c.aE[Bo[zc]],la[0],la[1])}return[Bc,fs.length]})(Er.textAnchorOffsets,AM);Er.symbolInstances.emplaceBack(pn.x,pn.y,Ha.right>=0?Ha.right:-1,Ha.center>=0?Ha.center:-1,Ha.left>=0?Ha.left:-1,Ha.vertical||-1,Lv,Bv,IT,_M,yM,vM,bM,xM,wM,TM,SM,Li,ET,PT,ST,AT,RT,0,ys,Lo,EM,PM)})(h,Fr,Zr,u,f,m,Jt,h.layers[0],h.collisionBoxArray,o.index,o.sourceLayerIndex,h.index,Se,[at,at,at,at],tr,C,ke,_t,qt,J,o,b,O,F,T)};if(Qt==="line")for(const Zr of cT(o.geometry,0,0,it,it)){const Fr=Fc(Zr,Pt),Er=cM(Fr,ze,Ft,u.vertical||ne,f,24,qe,h.overscaling,it);for(const pn of Er)ne&&pM(h,ne.text,Mr,pn)||Vr(Fr,pn)}else if(Qt==="line-center"){for(const Zr of o.geometry)if(Zr.length>1){const Fr=Fc(Zr,Pt),Er=lM(Fr,Ft,u.vertical||ne,f,24,qe);Er&&Vr(Fr,Er)}}else if(o.type==="Polygon")for(const Zr of _l(o.geometry,0)){const Fr=hM(Zr,16);Vr(Fc(Zr[0],Pt,!0),new zl(Fr.x,Fr.y,0))}else if(o.type==="LineString")for(const Zr of o.geometry){const Fr=Fc(Zr,Pt);Vr(Fr,new zl(Fr[0].x,Fr[0].y,0))}else if(o.type==="Point")for(const Zr of o.geometry)for(const Fr of Zr)Vr([Fr],new zl(Fr.x,Fr.y,0))}function vT(h,o,u,f,m,b,T,E,C,O,F,W,q,K,J){const ne=(function(qe,ke,ze,at,_t,Ft,tr,qt){const Qt=at.layout.get("text-rotate").evaluate(Ft,{})*Math.PI/180,Mr=[];for(const Kt of ke.positionedLines)for(const Jt of Kt.positionedGlyphs){if(!Jt.rect)continue;const Pt=Jt.rect||{};let Vr=4,Zr=!0,Fr=1,Er=0;const pn=(_t||qt)&&Jt.vertical,si=Jt.metrics.advance*Jt.scale/2;if(qt&&ke.verticalizable&&(Er=Kt.lineOffset/2-(Jt.imageName?-(Ni-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*Ni)),Jt.imageName){const zi=tr[Jt.imageName];Zr=zi.sdf,Fr=zi.pixelRatio,Vr=1/Fr}const Ii=_t?[Jt.x+si,Jt.y]:[0,0];let is=_t?[0,0]:[Jt.x+si+ze[0],Jt.y+ze[1]-Er],Zs=[0,0];pn&&(Zs=is,is=[0,0]);const As=Jt.metrics.isDoubleResolution?2:1,Xi=(Jt.metrics.left-Vr)*Jt.scale-si+is[0],ti=(-Jt.metrics.top-Vr)*Jt.scale+is[1],Li=Xi+Pt.w/As*Jt.scale/Fr,qi=ti+Pt.h/As*Jt.scale/Fr,Gi=new g(Xi,ti),ys=new g(Li,ti),Xs=new g(Xi,qi),Bi=new g(Li,qi);if(pn){const zi=new g(-si,si- -17),Ui=-Math.PI/2,bi=12-si,Zn=new g(22-bi,-(Jt.imageName?bi:0)),Fo=new g(...Zs);Gi._rotateAround(Ui,zi)._add(Zn)._add(Fo),ys._rotateAround(Ui,zi)._add(Zn)._add(Fo),Xs._rotateAround(Ui,zi)._add(Zn)._add(Fo),Bi._rotateAround(Ui,zi)._add(Zn)._add(Fo)}if(Qt){const zi=Math.sin(Qt),Ui=Math.cos(Qt),bi=[Ui,-zi,zi,Ui];Gi._matMult(bi),ys._matMult(bi),Xs._matMult(bi),Bi._matMult(bi)}const Es=new g(0,0),Ci=new g(0,0);Mr.push({tl:Gi,tr:ys,bl:Xs,br:Bi,tex:Pt,writingMode:ke.writingMode,glyphOffset:Ii,sectionIndex:Jt.sectionIndex,isSDF:Zr,pixelOffsetTL:Es,pixelOffsetBR:Ci,minFontScaleX:0,minFontScaleY:0})}return Mr})(0,u,E,m,b,T,f,h.allowVerticalPlacement),ce=h.textSizeData;let Se=null;ce.kind==="source"?(Se=[$a*m.layout.get("text-size").evaluate(T,{})],Se[0]>Ll&&lr(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ce.kind==="composite"&&(Se=[$a*K.compositeTextSizes[0].evaluate(T,{},J),$a*K.compositeTextSizes[1].evaluate(T,{},J)],(Se[0]>Ll||Se[1]>Ll)&&lr(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),h.addSymbols(h.text,ne,Se,E,b,T,O,o,C.lineStartIndex,C.lineLength,q,J);for(const qe of F)W[qe]=h.text.placedSymbolArray.length-1;return 4*ne.length}function bT(h){for(const o in h)return h[o];return null}function pM(h,o,u,f){const m=h.compareText;if(o in m){const b=m[o];for(let T=b.length-1;T>=0;T--)if(f.dist(b[T])<u)return!0}else m[o]=[];return m[o].push(f),!1}const xT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rv{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(o,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=xT[15&f];if(!b)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(o,2,1),[E]=new Uint32Array(o,4,1);return new Rv(E,T,b,o)}constructor(o,u=64,f=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=xT.indexOf(this.ArrayType),T=2*o*this.ArrayType.BYTES_PER_ELEMENT,E=o*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-E%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+C,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+T+E+C),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+C,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=o)}add(o,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=u,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return Mv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,u,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:T,nodeSize:E}=this,C=[0,b.length-1,0],O=[];for(;C.length;){const F=C.pop()||0,W=C.pop()||0,q=C.pop()||0;if(W-q<=E){for(let ce=q;ce<=W;ce++){const Se=T[2*ce],qe=T[2*ce+1];Se>=o&&Se<=f&&qe>=u&&qe<=m&&O.push(b[ce])}continue}const K=q+W>>1,J=T[2*K],ne=T[2*K+1];J>=o&&J<=f&&ne>=u&&ne<=m&&O.push(b[K]),(F===0?o<=J:u<=ne)&&(C.push(q),C.push(K-1),C.push(1-F)),(F===0?f>=J:m>=ne)&&(C.push(K+1),C.push(W),C.push(1-F))}return O}within(o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:T}=this,E=[0,m.length-1,0],C=[],O=f*f;for(;E.length;){const F=E.pop()||0,W=E.pop()||0,q=E.pop()||0;if(W-q<=T){for(let ce=q;ce<=W;ce++)TT(b[2*ce],b[2*ce+1],o,u)<=O&&C.push(m[ce]);continue}const K=q+W>>1,J=b[2*K],ne=b[2*K+1];TT(J,ne,o,u)<=O&&C.push(m[K]),(F===0?o-f<=J:u-f<=ne)&&(E.push(q),E.push(K-1),E.push(1-F)),(F===0?o+f>=J:u+f>=ne)&&(E.push(K+1),E.push(W),E.push(1-F))}return C}}function Mv(h,o,u,f,m,b){if(m-f<=u)return;const T=f+m>>1;wT(h,o,T,f,m,b),Mv(h,o,u,f,T-1,1-b),Mv(h,o,u,T+1,m,1-b)}function wT(h,o,u,f,m,b){for(;m>f;){if(m-f>600){const O=m-f+1,F=u-f+1,W=Math.log(O),q=.5*Math.exp(2*W/3),K=.5*Math.sqrt(W*q*(O-q)/O)*(F-O/2<0?-1:1);wT(h,o,u,Math.max(f,Math.floor(u-F*q/O+K)),Math.min(m,Math.floor(u+(O-F)*q/O+K)),b)}const T=o[2*u+b];let E=f,C=m;for(jf(h,o,f,u),o[2*m+b]>T&&jf(h,o,f,m);E<C;){for(jf(h,o,E,C),E++,C--;o[2*E+b]<T;)E++;for(;o[2*C+b]>T;)C--}o[2*f+b]===T?jf(h,o,f,C):(C++,jf(h,o,C,m)),C<=u&&(f=C+1),u<=C&&(m=C-1)}}function jf(h,o,u,f){kv(h,u,f),kv(o,2*u,2*f),kv(o,2*u+1,2*f+1)}function kv(h,o,u){const f=h[o];h[o]=h[u],h[u]=f}function TT(h,o,u,f){const m=h-u,b=o-f;return m*m+b*b}var Dv;c.cx=void 0,(Dv=c.cx||(c.cx={})).create="create",Dv.load="load",Dv.fullLoad="fullLoad";let Om=null,Wf=[];const Ov=1e3/60,Fv="loadTime",Nv="fullLoadTime",gM={mark(h){performance.mark(h)},frame(h){const o=h;Om!=null&&Wf.push(o-Om),Om=o},clearMetrics(){Om=null,Wf=[],performance.clearMeasures(Fv),performance.clearMeasures(Nv);for(const h in c.cx)performance.clearMarks(c.cx[h])},getPerformanceMetrics(){performance.measure(Fv,c.cx.create,c.cx.load),performance.measure(Nv,c.cx.create,c.cx.fullLoad);const h=performance.getEntriesByName(Fv)[0].duration,o=performance.getEntriesByName(Nv)[0].duration,u=Wf.length,f=1/(Wf.reduce(((b,T)=>b+T),0)/u/1e3),m=Wf.filter((b=>b>Ov)).reduce(((b,T)=>b+(T-Ov)/Ov),0);return{loadTime:h,fullLoadTime:o,fps:f,percentDroppedFrames:m/(u+m)*100,totalFrames:u}}};c.$=it,c.A=L,c.B=function([h,o,u]){return o+=90,o*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(o)*Math.sin(u),y:h*Math.sin(o)*Math.sin(u),z:h*Math.cos(u)}},c.C=us,c.D=Ir,c.E=ur,c.F=kn,c.G=mf,c.H=er,c.I=_v,c.J=class{constructor(h,o){this.target=h,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new sM((()=>this.process())),this.subscription=rr(this.target,"message",(u=>this.receive(u)),!1),this.globalScope=Zt(self)?h:window}registerMessageHandler(h,o){this.messageHandlers[h]=o}sendAsync(h,o){return new Promise(((u,f)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=o?rr(o.signal,"abort",(()=>{b?.unsubscribe(),delete this.resolveRejects[m];const C={id:m,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)}),oM):null;this.resolveRejects[m]={resolve:C=>{b?.unsubscribe(),u(C)},reject:C=>{b?.unsubscribe(),f(C)}};const T=[],E=Object.assign(Object.assign({},h),{id:m,sourceMapId:this.mapId,origin:location.origin,data:Ec(h.data,T)});this.target.postMessage(E,{transfer:T})}))}receive(h){const o=h.data,u=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!=="resource://android"&&location.origin!=="resource://android"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[u];const f=this.abortControllers[u];return delete this.abortControllers[u],void(f&&f.abort())}if(Zt(self)||o.mustQueue)return this.tasks[u]=o,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,o)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),o=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(h,o)}processTask(h,o){return a(this,void 0,void 0,(function*(){if(o.type==="<response>"){const m=this.resolveRejects[h];return delete this.resolveRejects[h],m?void(o.error?m.reject(ea(o.error)):m.resolve(ea(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=ea(o.data),f=new AbortController;this.abortControllers[h]=f;try{const m=yield this.messageHandlers[o.type](o.sourceMapId,u,f);this.completeTask(h,null,m)}catch(m){this.completeTask(h,m)}}))}completeTask(h,o,u){const f=[];delete this.abortControllers[h];const m={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?Ec(o):null,data:Ec(u,f)};this.target.postMessage(m,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.K=ie,c.L=function(){var h=new L(16);return L!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.M=function(h,o,u){var f,m,b,T,E,C,O,F,W,q,K,J,ne=u[0],ce=u[1],Se=u[2];return o===h?(h[12]=o[0]*ne+o[4]*ce+o[8]*Se+o[12],h[13]=o[1]*ne+o[5]*ce+o[9]*Se+o[13],h[14]=o[2]*ne+o[6]*ce+o[10]*Se+o[14],h[15]=o[3]*ne+o[7]*ce+o[11]*Se+o[15]):(m=o[1],b=o[2],T=o[3],E=o[4],C=o[5],O=o[6],F=o[7],W=o[8],q=o[9],K=o[10],J=o[11],h[0]=f=o[0],h[1]=m,h[2]=b,h[3]=T,h[4]=E,h[5]=C,h[6]=O,h[7]=F,h[8]=W,h[9]=q,h[10]=K,h[11]=J,h[12]=f*ne+E*ce+W*Se+o[12],h[13]=m*ne+C*ce+q*Se+o[13],h[14]=b*ne+O*ce+K*Se+o[14],h[15]=T*ne+F*ce+J*Se+o[15]),h},c.N=function(h,o,u){var f=u[0],m=u[1],b=u[2];return h[0]=o[0]*f,h[1]=o[1]*f,h[2]=o[2]*f,h[3]=o[3]*f,h[4]=o[4]*m,h[5]=o[5]*m,h[6]=o[6]*m,h[7]=o[7]*m,h[8]=o[8]*b,h[9]=o[9]*b,h[10]=o[10]*b,h[11]=o[11]*b,h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.O=function(h,o,u){var f=o[0],m=o[1],b=o[2],T=o[3],E=o[4],C=o[5],O=o[6],F=o[7],W=o[8],q=o[9],K=o[10],J=o[11],ne=o[12],ce=o[13],Se=o[14],qe=o[15],ke=u[0],ze=u[1],at=u[2],_t=u[3];return h[0]=ke*f+ze*E+at*W+_t*ne,h[1]=ke*m+ze*C+at*q+_t*ce,h[2]=ke*b+ze*O+at*K+_t*Se,h[3]=ke*T+ze*F+at*J+_t*qe,h[4]=(ke=u[4])*f+(ze=u[5])*E+(at=u[6])*W+(_t=u[7])*ne,h[5]=ke*m+ze*C+at*q+_t*ce,h[6]=ke*b+ze*O+at*K+_t*Se,h[7]=ke*T+ze*F+at*J+_t*qe,h[8]=(ke=u[8])*f+(ze=u[9])*E+(at=u[10])*W+(_t=u[11])*ne,h[9]=ke*m+ze*C+at*q+_t*ce,h[10]=ke*b+ze*O+at*K+_t*Se,h[11]=ke*T+ze*F+at*J+_t*qe,h[12]=(ke=u[12])*f+(ze=u[13])*E+(at=u[14])*W+(_t=u[15])*ne,h[13]=ke*m+ze*C+at*q+_t*ce,h[14]=ke*b+ze*O+at*K+_t*Se,h[15]=ke*T+ze*F+at*J+_t*qe,h},c.P=g,c.Q=function(h,o){const u={};for(let f=0;f<o.length;f++){const m=o[f];m in h&&(u[m]=h[m])}return u},c.R=Ss,c.S=Bl,c.T=av,c.U=eT,c.V=J1,c.W=B,c.X=U,c.Y=Tr,c.Z=Hs,c._=a,c.a=Y,c.a$=Ne,c.a0=function(h,o){var u,f,m,b,T;if(!h)return o??{};if(!o)return h;let E=Object.assign({},h);if(o.removeAll&&(E={removeAll:!0}),o.remove){const C=new Set(o.remove);E.add&&(E.add=E.add.filter((F=>!C.has(F.id)))),E.update&&(E.update=E.update.filter((F=>!C.has(F.id))));const O=new Set(((u=h.add)!==null&&u!==void 0?u:[]).map((F=>F.id)));o.remove=o.remove.filter((F=>!O.has(F)))}if(o.remove){const C=new Set(E.remove?E.remove.concat(o.remove):o.remove);E.remove=Array.from(C.values())}if(o.add){const C=E.add?E.add.concat(o.add):o.add,O=new Map(C.map((F=>[F.id,F])));E.add=Array.from(O.values())}if(o.update){const C=new Map((f=E.update)===null||f===void 0?void 0:f.map((O=>[O.id,O])));for(const O of o.update){const F=(m=C.get(O.id))!==null&&m!==void 0?m:{id:O.id};O.newGeometry&&(F.newGeometry=O.newGeometry),O.addOrUpdateProperties&&(F.addOrUpdateProperties=((b=F.addOrUpdateProperties)!==null&&b!==void 0?b:[]).concat(O.addOrUpdateProperties)),O.removeProperties&&(F.removeProperties=((T=F.removeProperties)!==null&&T!==void 0?T:[]).concat(O.removeProperties)),O.removeAllProperties&&(F.removeAllProperties=!0),C.set(O.id,F)}E.update=Array.from(C.values())}return E.remove&&E.add&&(E.remove=E.remove.filter((C=>E.add.findIndex((O=>O.id===C))===-1))),E},c.a1=Uf,c.a2=Nc,c.a3=25,c.a4=Pv,c.a5=h=>{const o=window.document.createElement("video");return o.muted=!0,new Promise((u=>{o.onloadstart=()=>{u(o)};for(const f of h){const m=window.document.createElement("source");Ge(f)||(o.crossOrigin="Anonymous"),m.src=f,o.appendChild(m)}}))},c.a6=$e,c.a7=function(){return vt++},c.a8=z,c.a9=Ph,c.aA=function(h){let o=1/0,u=1/0,f=-1/0,m=-1/0;for(const b of h)o=Math.min(o,b.x),u=Math.min(u,b.y),f=Math.max(f,b.x),m=Math.max(m,b.y);return[o,u,f,m]},c.aB=Ni,c.aC=Ct,c.aD=function(h,o,u,f,m=!1){if(!u[0]&&!u[1])return[0,0];const b=m?f==="map"?-h.bearingInRadians:0:f==="viewport"?h.bearingInRadians:0;if(b){const T=Math.sin(b),E=Math.cos(b);u=[u[0]*E-u[1]*T,u[0]*T+u[1]*E]}return[m?u[0]:Ct(o,u[0],h.zoom),m?u[1]:Ct(o,u[1],h.zoom)]},c.aF=bv,c.aG=Cv,c.aH=vv,c.aI=Rv,c.aJ=ii,c.aK=Sm,c.aL=Ee,c.aM=en,c.aN=$r,c.aO=Dr,c.aP=Cr,c.aQ=rT,c.aR=be,c.aS=oe,c.aT=function(h){var o=new L(3);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o},c.aU=function(h,o,u){return h[0]=o[0]-u[0],h[1]=o[1]-u[1],h[2]=o[2]-u[2],h},c.aV=function(h,o){var u=o[0],f=o[1],m=o[2],b=u*u+f*f+m*m;return b>0&&(b=1/Math.sqrt(b)),h[0]=o[0]*b,h[1]=o[1]*b,h[2]=o[2]*b,h},c.aW=xe,c.aX=function(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]},c.aY=function(h,o,u){return h[0]=o[0]*u[0],h[1]=o[1]*u[1],h[2]=o[2]*u[2],h[3]=o[3]*u[3],h},c.aZ=le,c.a_=function(h,o,u){const f=o[0]*u[0]+o[1]*u[1]+o[2]*u[2];return f===0?null:(-(h[0]*u[0]+h[1]*u[1]+h[2]*u[2])-u[3])/f},c.aa=Tl,c.ab=Dc,c.ac=oT,c.ad=function(h){const o={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,f,m,b)=>{const T=m||b;return o[f]=!T||T.toLowerCase(),""})),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o},c.ae=wr,c.af=85.051129,c.ag=Nr,c.ah=function(h){return Math.pow(2,h)},c.ai=te,c.aj=tT,c.ak=function(h){return Math.log(h)/Math.LN2},c.al=function(h){var o=h[0],u=h[1];return o*o+u*u},c.am=function(h){if(!h.length)return new Set;const o=Math.max(...h.map((C=>C.canonical.z)));let u=1/0,f=-1/0,m=1/0,b=-1/0;const T=[];for(const C of h){const{x:O,y:F,z:W}=C.canonical,q=Math.pow(2,o-W),K=O*q,J=F*q;T.push({id:C,x:K,y:J}),K<u&&(u=K),K>f&&(f=K),J<m&&(m=J),J>b&&(b=J)}const E=new Set;for(const C of T)C.x!==u&&C.x!==f&&C.y!==m&&C.y!==b||E.add(C.id);return E},c.an=function(h,o){let u=0,f=0;if(h.kind==="constant")f=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:T}=h,E=m?wr(cs.interpolationFactor(m,o,b,T),0,1):0;h.kind==="camera"?f=us.number(h.minSize,h.maxSize,E):u=E}return{uSizeT:u,uSize:f}},c.ap=function(h,{uSize:o,uSizeT:u},{lowerSize:f,upperSize:m}){return h.kind==="source"?f/$a:h.kind==="composite"?us.number(f/$a,m/$a,u):o},c.aq=function(h,o){var u=o[0],f=o[1],m=o[2],b=o[3],T=o[4],E=o[5],C=o[6],O=o[7],F=o[8],W=o[9],q=o[10],K=o[11],J=o[12],ne=o[13],ce=o[14],Se=o[15],qe=u*E-f*T,ke=u*C-m*T,ze=u*O-b*T,at=f*C-m*E,_t=f*O-b*E,Ft=m*O-b*C,tr=F*ne-W*J,qt=F*ce-q*J,Qt=F*Se-K*J,Mr=W*ce-q*ne,Kt=W*Se-K*ne,Jt=q*Se-K*ce,Pt=qe*Jt-ke*Kt+ze*Mr+at*Qt-_t*qt+Ft*tr;return Pt?(h[0]=(E*Jt-C*Kt+O*Mr)*(Pt=1/Pt),h[1]=(m*Kt-f*Jt-b*Mr)*Pt,h[2]=(ne*Ft-ce*_t+Se*at)*Pt,h[3]=(q*_t-W*Ft-K*at)*Pt,h[4]=(C*Qt-T*Jt-O*qt)*Pt,h[5]=(u*Jt-m*Qt+b*qt)*Pt,h[6]=(ce*ze-J*Ft-Se*ke)*Pt,h[7]=(F*Ft-q*ze+K*ke)*Pt,h[8]=(T*Kt-E*Qt+O*tr)*Pt,h[9]=(f*Qt-u*Kt-b*tr)*Pt,h[10]=(J*_t-ne*ze+Se*qe)*Pt,h[11]=(W*ze-F*_t-K*qe)*Pt,h[12]=(E*qt-T*Mr-C*tr)*Pt,h[13]=(u*Mr-f*qt+m*tr)*Pt,h[14]=(ne*ke-J*at-ce*qe)*Pt,h[15]=(F*at-W*ke+q*qe)*Pt,h):null},c.ar=Ye,c.as=function(h){var o=h[0],u=h[1];return Math.sqrt(o*o+u*u)},c.at=function(h){return h[0]=0,h[1]=0,h},c.au=function(h,o,u){return h[0]=o[0]*u,h[1]=o[1]*u,h},c.av=xv,c.aw=fe,c.ax=function(h,o,u,f){const m=o.y-h.y,b=o.x-h.x,T=f.y-u.y,E=f.x-u.x,C=T*b-E*m;if(C===0)return null;const O=(E*(h.y-u.y)-T*(h.x-u.x))/C;return new g(h.x+O*b,h.y+O*m)},c.ay=cT,c.az=Jw,c.b=Bt,c.b$=class extends rs{constructor(h,o){super(h,o),this.current=new Array}set(h){if(h!=this.current){this.current=h;const o=new Float32Array(h);this.gl.uniform1fv(this.location,o)}}},c.b0=function(h,o,u){return h[0]=o[0]*u,h[1]=o[1]*u,h[2]=o[2]*u,h[3]=o[3]*u,h},c.b1=function(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]+h[3]},c.b2=iT,c.b3=Ih,c.b4=function(h,o,u,f,m){var b=1/Math.tan(o/2);if(h[0]=b/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=b,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,m!=null&&m!==1/0){var T=1/(f-m);h[10]=(m+f)*T,h[14]=2*m*f*T}else h[10]=-1,h[14]=-2*f;return h},c.b5=function(h){var o=new L(16);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],o},c.b6=function(h,o,u){var f=Math.sin(u),m=Math.cos(u),b=o[0],T=o[1],E=o[2],C=o[3],O=o[4],F=o[5],W=o[6],q=o[7];return o!==h&&(h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=b*m+O*f,h[1]=T*m+F*f,h[2]=E*m+W*f,h[3]=C*m+q*f,h[4]=O*m-b*f,h[5]=F*m-T*f,h[6]=W*m-E*f,h[7]=q*m-C*f,h},c.b7=function(h,o,u){var f=Math.sin(u),m=Math.cos(u),b=o[4],T=o[5],E=o[6],C=o[7],O=o[8],F=o[9],W=o[10],q=o[11];return o!==h&&(h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[4]=b*m+O*f,h[5]=T*m+F*f,h[6]=E*m+W*f,h[7]=C*m+q*f,h[8]=O*m-b*f,h[9]=F*m-T*f,h[10]=W*m-E*f,h[11]=q*m-C*f,h},c.b8=function(){const h=new Float32Array(16);return te(h),h},c.b9=function(){const h=new Float64Array(16);return te(h),h},c.bA=function(h,o){const u=Mt(h,360),f=Mt(o,360),m=f-u,b=f>u?m-360:m+360;return Math.abs(m)<Math.abs(b)?m:b},c.bB=function(h){return h[0]=0,h[1]=0,h[2]=0,h},c.bC=function(h,o,u,f){const m=Math.sqrt(h*h+o*o),b=Math.sqrt(u*u+f*f);h/=m,o/=m,u/=b,f/=b;const T=Math.acos(h*u+o*f);return-o*u+h*f>0?T:-T},c.bD=function(h,o){const u=Mt(h,2*Math.PI),f=Mt(o,2*Math.PI);return Math.min(Math.abs(u-f),Math.abs(u-f+2*Math.PI),Math.abs(u-f-2*Math.PI))},c.bE=function(){const h={},o=Xe.$version;for(const u in Xe.$root){const f=Xe.$root[u];if(f.required){let m=null;m=u==="version"?o:f.type==="array"?[]:{},m!=null&&(h[u]=m)}}return h},c.bF=yf,c.bG=Ce,c.bH=function h(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(let f=0;f<o.length;f++)if(!h(o[f],u[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(const f in o)if(!h(o[f],u[f]))return!1;return!0}return o===u},c.bI=function(h){h=h.slice();const o=Object.create(null);for(let u=0;u<h.length;u++)o[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=xr(h[u],o[h[u].ref]));return h},c.bJ=function(h,o){if(h.type==="custom")return new iM(h,o);switch(h.type){case"background":return new nM(h,o);case"circle":return new jR(h,o);case"color-relief":return new qR(h,o);case"fill":return new c3(h,o);case"fill-extrusion":return new b3(h,o);case"heatmap":return new $R(h,o);case"hillshade":return new ZR(h,o);case"line":return new P3(h,o);case"raster":return new Dl(h,o);case"symbol":return new Cm(h,o)}},c.bK=h=>h.type==="raster",c.bL=Ar,c.bM=function(h,o){if(!h)return[{command:"setStyle",args:[o]}];let u=[];try{if(!Lt(h.version,o.version))return[{command:"setStyle",args:[o]}];Lt(h.center,o.center)||u.push({command:"setCenter",args:[o.center]}),Lt(h.state,o.state)||u.push({command:"setGlobalState",args:[o.state]}),Lt(h.centerAltitude,o.centerAltitude)||u.push({command:"setCenterAltitude",args:[o.centerAltitude]}),Lt(h.zoom,o.zoom)||u.push({command:"setZoom",args:[o.zoom]}),Lt(h.bearing,o.bearing)||u.push({command:"setBearing",args:[o.bearing]}),Lt(h.pitch,o.pitch)||u.push({command:"setPitch",args:[o.pitch]}),Lt(h.roll,o.roll)||u.push({command:"setRoll",args:[o.roll]}),Lt(h.sprite,o.sprite)||u.push({command:"setSprite",args:[o.sprite]}),Lt(h.glyphs,o.glyphs)||u.push({command:"setGlyphs",args:[o.glyphs]}),Lt(h.transition,o.transition)||u.push({command:"setTransition",args:[o.transition]}),Lt(h.light,o.light)||u.push({command:"setLight",args:[o.light]}),Lt(h.terrain,o.terrain)||u.push({command:"setTerrain",args:[o.terrain]}),Lt(h.sky,o.sky)||u.push({command:"setSky",args:[o.sky]}),Lt(h.projection,o.projection)||u.push({command:"setProjection",args:[o.projection]});const f={},m=[];(function(T,E,C,O){let F;for(F in E=E||{},T=T||{})Object.prototype.hasOwnProperty.call(T,F)&&(Object.prototype.hasOwnProperty.call(E,F)||je(F,C,O));for(F in E)Object.prototype.hasOwnProperty.call(E,F)&&(Object.prototype.hasOwnProperty.call(T,F)?Lt(T[F],E[F])||(T[F].type==="geojson"&&E[F].type==="geojson"&&Rt(T,E,F)?gr(C,{command:"setGeoJSONSourceData",args:[F,E[F].data]}):ht(F,E,C,O)):Lr(F,E,C))})(h.sources,o.sources,m,f);const b=[];h.layers&&h.layers.forEach((T=>{"source"in T&&f[T.source]?u.push({command:"removeLayer",args:[T.id]}):b.push(T)})),u=u.concat(m),(function(T,E,C){E=E||[];const O=(T=T||[]).map(Ut),F=E.map(Ut),W=T.reduce(kt,{}),q=E.reduce(kt,{}),K=O.slice(),J=Object.create(null);let ne,ce,Se,qe,ke;for(let ze=0,at=0;ze<O.length;ze++)ne=O[ze],Object.prototype.hasOwnProperty.call(q,ne)?at++:(gr(C,{command:"removeLayer",args:[ne]}),K.splice(K.indexOf(ne,at),1));for(let ze=0,at=0;ze<F.length;ze++)ne=F[F.length-1-ze],K[K.length-1-ze]!==ne&&(Object.prototype.hasOwnProperty.call(W,ne)?(gr(C,{command:"removeLayer",args:[ne]}),K.splice(K.lastIndexOf(ne,K.length-at),1)):at++,qe=K[K.length-ze],gr(C,{command:"addLayer",args:[q[ne],qe]}),K.splice(K.length-ze,0,ne),J[ne]=!0);for(let ze=0;ze<F.length;ze++)if(ne=F[ze],ce=W[ne],Se=q[ne],!J[ne]&&!Lt(ce,Se))if(Lt(ce.source,Se.source)&&Lt(ce["source-layer"],Se["source-layer"])&&Lt(ce.type,Se.type)){for(ke in gt(ce.layout,Se.layout,C,ne,null,"setLayoutProperty"),gt(ce.paint,Se.paint,C,ne,null,"setPaintProperty"),Lt(ce.filter,Se.filter)||gr(C,{command:"setFilter",args:[ne,Se.filter]}),Lt(ce.minzoom,Se.minzoom)&&Lt(ce.maxzoom,Se.maxzoom)||gr(C,{command:"setLayerZoomRange",args:[ne,Se.minzoom,Se.maxzoom]}),ce)Object.prototype.hasOwnProperty.call(ce,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?gt(ce[ke],Se[ke],C,ne,ke.slice(6),"setPaintProperty"):Lt(ce[ke],Se[ke])||gr(C,{command:"setLayerProperty",args:[ne,ke,Se[ke]]}));for(ke in Se)Object.prototype.hasOwnProperty.call(Se,ke)&&!Object.prototype.hasOwnProperty.call(ce,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?gt(ce[ke],Se[ke],C,ne,ke.slice(6),"setPaintProperty"):Lt(ce[ke],Se[ke])||gr(C,{command:"setLayerProperty",args:[ne,ke,Se[ke]]}))}else gr(C,{command:"removeLayer",args:[ne]}),qe=K[K.lastIndexOf(ne)+1],gr(C,{command:"addLayer",args:[Se,qe]})})(b,o.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:"setStyle",args:[o]}]}return u},c.bN=function(h){const o=[],u=h.id;return u===void 0&&o.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&o.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},c.bO=Pr,c.bP=yr,c.bQ=class extends rs{constructor(h,o){super(h,o),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.bR=vi,c.bS=class extends rs{constructor(h,o){super(h,o),this.current=Fi}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let o=1;o<16;o++)if(h[o]!==this.current[o]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.bT=Fl,c.bU=class extends rs{constructor(h,o){super(h,o),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.bV=class extends rs{constructor(h,o){super(h,o),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.bW=$,c.bX=function(h,o){var u=Math.sin(o),f=Math.cos(o);return h[0]=f,h[1]=u,h[2]=0,h[3]=-u,h[4]=f,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},c.bY=function(h,o,u){var f=o[0],m=o[1],b=o[2];return h[0]=f*u[0]+m*u[3]+b*u[6],h[1]=f*u[1]+m*u[4]+b*u[7],h[2]=f*u[2]+m*u[5]+b*u[8],h},c.bZ=function(h,o,u,f,m,b,T){var E=1/(o-u),C=1/(f-m),O=1/(b-T);return h[0]=-2*E,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*C,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*O,h[11]=0,h[12]=(o+u)*E,h[13]=(m+f)*C,h[14]=(T+b)*O,h[15]=1,h},c.b_=class extends rs{constructor(h,o){super(h,o),this.current=new Array}set(h){if(h!=this.current){this.current=h;const o=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)o[4*u]=h[u].r,o[4*u+1]=h[u].g,o[4*u+2]=h[u].b,o[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,o)}}},c.ba=function(){return new Float64Array(16)},c.bb=function(h,o,u){const f=new Float64Array(4);return tt(f,h,o-90,u),f},c.bc=function(h,o,u,f){var m,b,T,E,C,O=o[0],F=o[1],W=o[2],q=o[3],K=u[0],J=u[1],ne=u[2],ce=u[3];return(b=O*K+F*J+W*ne+q*ce)<0&&(b=-b,K=-K,J=-J,ne=-ne,ce=-ce),1-b>V?(m=Math.acos(b),T=Math.sin(m),E=Math.sin((1-f)*m)/T,C=Math.sin(f*m)/T):(E=1-f,C=f),h[0]=E*O+C*K,h[1]=E*F+C*J,h[2]=E*W+C*ne,h[3]=E*q+C*ce,h},c.bd=function(h){const o=new Float64Array(9);var u,f,m,b,T,E,C,O,F,W,q,K,J,ne,ce,Se,qe,ke;W=(m=(f=h)[0])*(C=m+m),q=(b=f[1])*C,J=(T=f[2])*C,ne=T*(O=b+b),Se=(E=f[3])*C,qe=E*O,ke=E*(F=T+T),(u=o)[0]=1-(K=b*O)-(ce=T*F),u[3]=q-ke,u[6]=J+qe,u[1]=q+ke,u[4]=1-W-ce,u[7]=ne-Se,u[2]=J-qe,u[5]=ne+Se,u[8]=1-W-K;const ze=Cr(-Math.asin(wr(o[2],-1,1)));let at,_t;return Math.hypot(o[5],o[8])<.001?(at=0,_t=-Cr(Math.atan2(o[3],o[4]))):(at=Cr(o[5]===0&&o[8]===0?0:Math.atan2(o[5],o[8])),_t=Cr(o[1]===0&&o[0]===0?0:Math.atan2(o[1],o[0]))),{roll:at,pitch:ze+90,bearing:_t}},c.be=function(h,o){return h.roll==o.roll&&h.pitch==o.pitch&&h.bearing==o.bearing},c.bf=Kr,c.bg=po,c.bh=Th,c.bi=Of,c.bj=wh,c.bk=jt,c.bl=Gt,c.bm=gs,c.bn=function(h,o,u,f,m){return jt(f,m,wr((h-o)/(u-o),0,1))},c.bo=Mt,c.bp=function(){return new Float64Array(3)},c.bq=function(h,o,u,f){return h[0]=o[0]+u[0]*f,h[1]=o[1]+u[1]*f,h[2]=o[2]+u[2]*f,h},c.br=tt,c.bs=function(h,o,u){var f=u[0],m=u[1],b=u[2],T=u[3],E=o[0],C=o[1],O=o[2],F=m*O-b*C,W=b*E-f*O,q=f*C-m*E;return h[0]=E+T*(F+=F)+m*(q+=q)-b*(W+=W),h[1]=C+T*W+b*F-f*q,h[2]=O+T*q+f*W-m*F,h},c.bt=function(h,o,u){const f=(m=[h[0],h[1],h[2],o[0],o[1],o[2],u[0],u[1],u[2]])[0]*((F=m[8])*(T=m[4])-(E=m[5])*(O=m[7]))+m[1]*(-F*(b=m[3])+E*(C=m[6]))+m[2]*(O*b-T*C);var m,b,T,E,C,O,F;if(f===0)return null;const W=xe([],[o[0],o[1],o[2]],[u[0],u[1],u[2]]),q=xe([],[u[0],u[1],u[2]],[h[0],h[1],h[2]]),K=xe([],[h[0],h[1],h[2]],[o[0],o[1],o[2]]),J=be([],W,-h[3]);return oe(J,J,be([],q,-o[3])),oe(J,J,be([],K,-u[3])),be(J,J,1/f),J},c.bu=Av,c.bv=function(){return new Float64Array(4)},c.bw=function(h,o,u,f){var m=[],b=[];return m[0]=o[0]-u[0],m[1]=o[1]-u[1],m[2]=o[2]-u[2],b[0]=m[0]*Math.cos(f)-m[1]*Math.sin(f),b[1]=m[0]*Math.sin(f)+m[1]*Math.cos(f),b[2]=m[2],h[0]=b[0]+u[0],h[1]=b[1]+u[1],h[2]=b[2]+u[2],h},c.bx=function(h,o,u,f){var m=[],b=[];return m[0]=o[0]-u[0],m[1]=o[1]-u[1],m[2]=o[2]-u[2],b[0]=m[0],b[1]=m[1]*Math.cos(f)-m[2]*Math.sin(f),b[2]=m[1]*Math.sin(f)+m[2]*Math.cos(f),h[0]=b[0]+u[0],h[1]=b[1]+u[1],h[2]=b[2]+u[2],h},c.by=function(h,o,u,f){var m=[],b=[];return m[0]=o[0]-u[0],m[1]=o[1]-u[1],m[2]=o[2]-u[2],b[0]=m[2]*Math.sin(f)+m[0]*Math.cos(f),b[1]=m[1],b[2]=m[2]*Math.cos(f)-m[0]*Math.sin(f),h[0]=b[0]+u[0],h[1]=b[1]+u[1],h[2]=b[2]+u[2],h},c.bz=function(h,o,u){var f=Math.sin(u),m=Math.cos(u),b=o[0],T=o[1],E=o[2],C=o[3],O=o[8],F=o[9],W=o[10],q=o[11];return o!==h&&(h[4]=o[4],h[5]=o[5],h[6]=o[6],h[7]=o[7],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=b*m-O*f,h[1]=T*m-F*f,h[2]=E*m-W*f,h[3]=C*m-q*f,h[8]=b*f+O*m,h[9]=T*f+F*m,h[10]=E*f+W*m,h[11]=C*f+q*m,h},c.c=Re,c.c0=class extends Ef{},c.c1=M3,c.c2=class extends yh{},c.c3=ov,c.c4=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.c5=c1,c.c6=function(h,o,u){var f=o[0],m=o[1],b=o[2],T=u[3]*f+u[7]*m+u[11]*b+u[15];return h[0]=(u[0]*f+u[4]*m+u[8]*b+u[12])/(T=T||1),h[1]=(u[1]*f+u[5]*m+u[9]*b+u[13])/T,h[2]=(u[2]*f+u[6]*m+u[10]*b+u[14])/T,h},c.c7=class extends ph{},c.c8=class extends A{},c.c9=function(h,o){return h[0]===o[0]&&h[1]===o[1]&&h[2]===o[2]&&h[3]===o[3]&&h[4]===o[4]&&h[5]===o[5]&&h[6]===o[6]&&h[7]===o[7]&&h[8]===o[8]&&h[9]===o[9]&&h[10]===o[10]&&h[11]===o[11]&&h[12]===o[12]&&h[13]===o[13]&&h[14]===o[14]&&h[15]===o[15]},c.cA=function(h,o){Y.REGISTERED_PROTOCOLS[h]=o},c.cB=function(h){delete Y.REGISTERED_PROTOCOLS[h]},c.cC=function(h,o){const u={};for(let m=0;m<h.length;m++){const b=o&&o[h[m].id]||hf(h[m]);o&&(o[h[m].id]=b);let T=u[b];T||(T=u[b]=[]),T.push(h[m])}const f=[];for(const m in u)f.push(u[m]);return f},c.cD=pr,c.cE=sT,c.cF=aT,c.cG=B1,c.cH=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=it/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const o=h.bucket.layers[0],u=o.layout,f=o._unevaluatedLayout._values,m={layoutIconSize:f["icon-size"].possiblyEvaluate(new kn(h.bucket.zoom+1),h.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new kn(h.bucket.zoom+1),h.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new kn(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=h.bucket.textSizeData;m.compositeTextSizes=[f["text-size"].possiblyEvaluate(new kn(O),h.canonical),f["text-size"].possiblyEvaluate(new kn(F),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=h.bucket.iconSizeData;m.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new kn(O),h.canonical),f["icon-size"].possiblyEvaluate(new kn(F),h.canonical)]}const b=u.get("text-line-height")*Ni,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",E=u.get("text-keep-upright"),C=u.get("text-size");for(const O of h.bucket.features){const F=u.get("text-font").evaluate(O,{},h.canonical).join(","),W=C.evaluate(O,{},h.canonical),q=m.layoutTextSize.evaluate(O,{},h.canonical),K=m.layoutIconSize.evaluate(O,{},h.canonical),J={horizontal:{},vertical:void 0},ne=O.text;let ce,Se=[0,0];if(ne){const ze=ne.toString(),at=u.get("text-letter-spacing").evaluate(O,{},h.canonical)*Ni,_t=sm(ze)?at:0,Ft=u.get("text-anchor").evaluate(O,{},h.canonical),tr=yT(o,O,h.canonical);if(!tr){const Kt=u.get("text-radial-offset").evaluate(O,{},h.canonical);Se=Kt?_T(Ft,[Kt*Ni,Iv]):u.get("text-offset").evaluate(O,{},h.canonical).map((Jt=>Jt*Ni))}let qt=T?"center":u.get("text-justify").evaluate(O,{},h.canonical);const Qt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(O,{},h.canonical)*Ni:1/0,Mr=()=>{h.bucket.allowVerticalPlacement&&Rl(ze)&&(J.vertical=Em(ne,h.glyphMap,h.glyphPositions,h.imagePositions,F,Qt,b,Ft,"left",_t,Se,c.ao.vertical,!0,q,W))};if(!T&&tr){const Kt=new Set;if(qt==="auto")for(let Pt=0;Pt<tr.values.length;Pt+=2)Kt.add(Cv(tr.values[Pt]));else Kt.add(qt);let Jt=!1;for(const Pt of Kt)if(!J.horizontal[Pt])if(Jt)J.horizontal[Pt]=J.horizontal[0];else{const Vr=Em(ne,h.glyphMap,h.glyphPositions,h.imagePositions,F,Qt,b,"center",Pt,_t,Se,c.ao.horizontal,!1,q,W);Vr&&(J.horizontal[Pt]=Vr,Jt=Vr.positionedLines.length===1)}Mr()}else{qt==="auto"&&(qt=Cv(Ft));const Kt=Em(ne,h.glyphMap,h.glyphPositions,h.imagePositions,F,Qt,b,Ft,qt,_t,Se,c.ao.horizontal,!1,q,W);Kt&&(J.horizontal[qt]=Kt),Mr(),Rl(ze)&&T&&E&&(J.vertical=Em(ne,h.glyphMap,h.glyphPositions,h.imagePositions,F,Qt,b,Ft,qt,_t,Se,c.ao.vertical,!1,q,W))}}let qe=!1;if(O.icon&&O.icon.name){const ze=h.imageMap[O.icon.name];ze&&(ce=J3(h.imagePositions[O.icon.name],u.get("icon-offset").evaluate(O,{},h.canonical),u.get("icon-anchor").evaluate(O,{},h.canonical)),qe=!!ze.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=qe:h.bucket.sdfIcons!==qe&&lr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const ke=bT(J.horizontal)||J.vertical;h.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||ce)&&fM(h.bucket,O,J,ce,h.imageMap,m,q,K,Se,qe,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.cI=hv,c.cJ=fv,c.cK=pv,c.cL=S1,c.cM=mv,c.cN=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.cO=function(h,o,u,f,m){return a(this,void 0,void 0,(function*(){if(U())try{return yield Tr(h,o,u,f,m)}catch{}return(function(b,T,E,C,O){const F=b.width,W=b.height;fr&&nr||(fr=new OffscreenCanvas(F,W),nr=fr.getContext("2d",{willReadFrequently:!0})),fr.width=F,fr.height=W,nr.drawImage(b,0,0,F,W);const q=nr.getImageData(T,E,C,O);return nr.clearRect(0,0,F,W),q.data})(h,o,u,f,m)}))},c.cP=d1,c.cQ=v,c.cR=T1,c.cS=Sh,c.cT=eh,c.cU=function(h,o){const u=new Map;if(h!=null)if(h.type==="Feature")u.set(Vf(h,o),h);else for(const f of h.features)u.set(Vf(f,o),f);return u},c.cV=function(h,o){if(h==null)return!0;if(h.type==="Feature")return Vf(h,o)!=null;if(h.type==="FeatureCollection"){const u=new Set;for(const f of h.features){const m=Vf(f,o);if(m==null||u.has(m))return!1;u.add(m)}return!0}return!1},c.cW=function(h,o,u){var f,m,b,T;if(o.removeAll&&h.clear(),o.remove)for(const E of o.remove)h.delete(E);if(o.add)for(const E of o.add){const C=Vf(E,u);C!=null&&h.set(C,E)}if(o.update)for(const E of o.update){let C=h.get(E.id);if(C==null)continue;const O=!E.removeAllProperties&&(((f=E.removeProperties)===null||f===void 0?void 0:f.length)>0||((m=E.addOrUpdateProperties)===null||m===void 0?void 0:m.length)>0);if((E.newGeometry||E.removeAllProperties||O)&&(C=Object.assign({},C),h.set(E.id,C),O&&(C.properties=Object.assign({},C.properties))),E.newGeometry&&(C.geometry=E.newGeometry),E.removeAllProperties)C.properties={};else if(((b=E.removeProperties)===null||b===void 0?void 0:b.length)>0)for(const F of E.removeProperties)Object.prototype.hasOwnProperty.call(C.properties,F)&&delete C.properties[F];if(((T=E.addOrUpdateProperties)===null||T===void 0?void 0:T.length)>0)for(const{key:F,value:W}of E.addOrUpdateProperties)C.properties[F]=W}},c.cX=ko,c.ca=function(h,o){var u=h[0],f=h[1],m=h[2],b=h[3],T=h[4],E=h[5],C=h[6],O=h[7],F=h[8],W=h[9],q=h[10],K=h[11],J=h[12],ne=h[13],ce=h[14],Se=h[15],qe=o[0],ke=o[1],ze=o[2],at=o[3],_t=o[4],Ft=o[5],tr=o[6],qt=o[7],Qt=o[8],Mr=o[9],Kt=o[10],Jt=o[11],Pt=o[12],Vr=o[13],Zr=o[14],Fr=o[15];return Math.abs(u-qe)<=V*Math.max(1,Math.abs(u),Math.abs(qe))&&Math.abs(f-ke)<=V*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(m-ze)<=V*Math.max(1,Math.abs(m),Math.abs(ze))&&Math.abs(b-at)<=V*Math.max(1,Math.abs(b),Math.abs(at))&&Math.abs(T-_t)<=V*Math.max(1,Math.abs(T),Math.abs(_t))&&Math.abs(E-Ft)<=V*Math.max(1,Math.abs(E),Math.abs(Ft))&&Math.abs(C-tr)<=V*Math.max(1,Math.abs(C),Math.abs(tr))&&Math.abs(O-qt)<=V*Math.max(1,Math.abs(O),Math.abs(qt))&&Math.abs(F-Qt)<=V*Math.max(1,Math.abs(F),Math.abs(Qt))&&Math.abs(W-Mr)<=V*Math.max(1,Math.abs(W),Math.abs(Mr))&&Math.abs(q-Kt)<=V*Math.max(1,Math.abs(q),Math.abs(Kt))&&Math.abs(K-Jt)<=V*Math.max(1,Math.abs(K),Math.abs(Jt))&&Math.abs(J-Pt)<=V*Math.max(1,Math.abs(J),Math.abs(Pt))&&Math.abs(ne-Vr)<=V*Math.max(1,Math.abs(ne),Math.abs(Vr))&&Math.abs(ce-Zr)<=V*Math.max(1,Math.abs(ce),Math.abs(Zr))&&Math.abs(Se-Fr)<=V*Math.max(1,Math.abs(Se),Math.abs(Fr))},c.cb=function(h,o){return h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[4]=o[4],h[5]=o[5],h[6]=o[6],h[7]=o[7],h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.cc=h=>h.type==="symbol",c.cd=h=>h.type==="circle",c.ce=h=>h.type==="heatmap",c.cf=h=>h.type==="line",c.cg=h=>h.type==="fill",c.ch=h=>h.type==="fill-extrusion",c.ci=h=>h.type==="hillshade",c.cj=h=>h.type==="color-relief",c.ck=h=>h.type==="background",c.cl=h=>h.type==="custom",c.cm=Or,c.cn=function(h,o,u){const f=rt(o.x-u.x,o.y-u.y),m=rt(h.x-u.x,h.y-u.y);var b,T;return Cr(Math.atan2(f[0]*m[1]-f[1]*m[0],(b=f)[0]*(T=m)[0]+b[1]*T[1]))},c.co=_r,c.cp=function(h,o){return ir[o]&&(h instanceof MouseEvent||h instanceof WheelEvent)},c.cq=function(h,o){return qr[o]&&"touches"in h},c.cr=function(h){return qr[h]||ir[h]},c.cs=function(h,o,u){var f=o[0],m=o[1];return h[0]=u[0]*f+u[4]*m+u[12],h[1]=u[1]*f+u[5]*m+u[13],h},c.ct=function(h,o){const{x:u,y:f}=Uf.fromLngLat(o);return!(h<0||h>25||f<0||f>=1||u<0||u>=1)},c.cu=function(h,o){return h[0]=o[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=o[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=o[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.cv=class extends fo{},c.cw=gM,c.cy=function(h){return h.message===or},c.cz=Te,c.d=Ge,c.e=Et,c.f=h=>a(void 0,void 0,void 0,(function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(o)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=ee,c.h=h=>new Promise(((o,u)=>{const f=new Image;f.onload=()=>{o(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame((()=>{f.src=mr}))},f.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(h)],{type:"image/png"});f.src=h.byteLength?URL.createObjectURL(m):mr})),c.i=Zt,c.j=(h,o)=>Be(Et(h,{type:"json"}),o),c.k=bt,c.l=At,c.m=Be,c.n=(h,o)=>Be(Et(h,{type:"arrayBuffer"}),o),c.o=function(h){return new mv(h).readFields(j3,[])},c.p=L1,c.q=Cf,c.r=hs,c.s=rr,c.t=vf,c.u=an,c.v=Xe,c.w=lr,c.x=tm,c.y=rm,c.z=uo})),s("worker",["./shared"],(function(c){class a{constructor(Y,ee){this.keyCache={},Y&&this.replace(Y,ee)}replace(Y,ee){this._layerConfigs={},this._layers={},this.update(Y,[],ee)}update(Y,ee,ie){for(const Ce of Y){this._layerConfigs[Ce.id]=Ce;const Be=this._layers[Ce.id]=c.bJ(Ce,ie);Be._featureFilter=c.aa(Be.filter,ie),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id]}for(const Ce of ee)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Te=c.cC(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Te){const Be=Ce.map((ur=>this._layers[ur.id])),Ge=Be[0];if(Ge.visibility==="none")continue;const Ve=Ge.source||"";let nt=this.familiesBySource[Ve];nt||(nt=this.familiesBySource[Ve]={});const At=Ge.sourceLayer||"_geojsonTileLayer";let bt=nt[At];bt||(bt=nt[At]=[]),bt.push(Be)}}}class g{constructor(Y){const ee={},ie=[];for(const Ge in Y){const Ve=Y[Ge],nt=ee[Ge]={};for(const At in Ve){const bt=Ve[+At];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const ur={x:0,y:0,w:bt.bitmap.width+2,h:bt.bitmap.height+2};ie.push(ur),nt[At]={rect:ur,metrics:bt.metrics}}}const{w:Te,h:Ce}=c.p(ie),Be=new c.q({width:Te||1,height:Ce||1});for(const Ge in Y){const Ve=Y[Ge];for(const nt in Ve){const At=Ve[+nt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const bt=ee[Ge][nt].rect;c.q.copy(At.bitmap,Be,{x:0,y:0},{x:bt.x+1,y:bt.y+1},At.bitmap)}}this.image=Be,this.positions=ee}}c.cD("GlyphAtlas",g);class v{constructor(Y){this.tileID=new c.Z(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,ee,ie,Te,Ce){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new c.a8;const Be=new c.cE(Object.keys(Y.layers).sort()),Ge=new c.cF(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Ve={},nt={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ie,subdivisionGranularity:Ce},At=ee.familiesBySource[this.source];for(const $e in At){const cr=Y.layers[$e];if(!cr)continue;cr.version===1&&c.w(`Vector tile source "${this.source}" layer "${$e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Rr=Be.encode($e),rn=[];for(let vn=0;vn<cr.length;vn++){const xt=cr.feature(vn),Wt=Ge.getId(xt,$e);rn.push({feature:xt,id:Wt,index:vn,sourceLayerIndex:Rr})}for(const vn of At[$e]){const xt=vn[0];xt.source!==this.source&&c.w(`layer.source = ${xt.source} does not equal this.source = ${this.source}`),xt.isHidden(this.zoom,!0)||(w(vn,this.zoom,ie),(Ve[xt.id]=xt.createBucket({index:Ge.bucketLayerIDs.length,layers:vn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Rr,sourceID:this.source})).populate(rn,nt,this.tileID.canonical),Ge.bucketLayerIDs.push(vn.map((Wt=>Wt.id))))}}const bt=c.bO(nt.glyphDependencies,($e=>Object.keys($e).map(Number)));this.inFlightDependencies.forEach(($e=>$e?.abort())),this.inFlightDependencies=[];let ur=Promise.resolve({});if(Object.keys(bt).length){const $e=new AbortController;this.inFlightDependencies.push($e),ur=Te.sendAsync({type:"GG",data:{stacks:bt,source:this.source,tileID:this.tileID,type:"glyphs"}},$e)}const Xe=Object.keys(nt.iconDependencies);let Xt=Promise.resolve({});if(Xe.length){const $e=new AbortController;this.inFlightDependencies.push($e),Xt=Te.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},$e)}const xr=Object.keys(nt.patternDependencies);let Lt=Promise.resolve({});if(xr.length){const $e=new AbortController;this.inFlightDependencies.push($e),Lt=Te.sendAsync({type:"GI",data:{icons:xr,source:this.source,tileID:this.tileID,type:"patterns"}},$e)}const gr=nt.dashDependencies;let Lr=Promise.resolve({});if(Object.keys(gr).length){const $e=new AbortController;this.inFlightDependencies.push($e),Lr=Te.sendAsync({type:"GDA",data:{dashes:gr}},$e)}const[je,ht,Rt,gt]=yield Promise.all([ur,Xt,Lt,Lr]),Ut=new g(je),kt=new c.cG(ht,Rt);for(const $e in Ve){const cr=Ve[$e];cr instanceof c.a9?(w(cr.layers,this.zoom,ie),c.cH({bucket:cr,glyphMap:je,glyphPositions:Ut.positions,imageMap:ht,imagePositions:kt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:nt.subdivisionGranularity})):cr.hasDependencies&&(cr instanceof c.cI||cr instanceof c.cJ||cr instanceof c.cK)&&(w(cr.layers,this.zoom,ie),cr.addFeatures(nt,this.tileID.canonical,kt.patternPositions,gt))}return this.status="done",{buckets:Object.values(Ve).filter(($e=>!$e.isEmpty())),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ut.image,imageAtlas:kt,dashPositions:gt,glyphMap:this.returnDependencies?je:null,iconMap:this.returnDependencies?ht:null,glyphPositions:this.returnDependencies?Ut.positions:null}}))}}function w(Re,Y,ee){const ie=new c.F(Y);for(const Te of Re)Te.recalculate(ie,ee)}class P{constructor(Y,ee,ie){this.actor=Y,this.layerIndex=ee,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,ee){return c._(this,void 0,void 0,(function*(){const ie=yield c.n(Y.request,ee);try{return{vectorTile:new c.cL(new c.cM(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(Te){const Ce=new Uint8Array(ie.data);let Be=`Unable to parse the tile at ${Y.request.url}, `;throw Be+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Te.message}`,new Error(Be)}}))}loadTile(Y){return c._(this,void 0,void 0,(function*(){const ee=Y.uid,ie=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new c.cN(Y.request),Te=new v(Y);this.loading[ee]=Te;const Ce=new AbortController;Te.abort=Ce;try{const Be=yield this.loadVectorTile(Y,Ce);if(delete this.loading[ee],!Be)return null;const Ge=Be.rawData,Ve={};Be.expires&&(Ve.expires=Be.expires),Be.cacheControl&&(Ve.cacheControl=Be.cacheControl);const nt={};if(ie){const bt=ie.finish();bt&&(nt.resourceTiming=JSON.parse(JSON.stringify(bt)))}Te.vectorTile=Be.vectorTile;const At=Te.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);this.loaded[ee]=Te,this.fetching[ee]={rawTileData:Ge,cacheControl:Ve,resourceTiming:nt};try{const bt=yield At;return c.e({rawTileData:Ge.slice(0)},bt,Ve,nt)}finally{delete this.fetching[ee]}}catch(Be){throw delete this.loading[ee],Te.status="done",this.loaded[ee]=Te,Be}}))}reloadTile(Y){return c._(this,void 0,void 0,(function*(){const ee=Y.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[ee];if(ie.showCollisionBoxes=Y.showCollisionBoxes,ie.status==="parsing"){const Te=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);let Ce;if(this.fetching[ee]){const{rawTileData:Be,cacheControl:Ge,resourceTiming:Ve}=this.fetching[ee];delete this.fetching[ee],Ce=c.e({rawTileData:Be.slice(0)},Te,Ge,Ve)}else Ce=Te;return Ce}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity)}))}abortTile(Y){return c._(this,void 0,void 0,(function*(){const ee=this.loading,ie=Y.uid;ee&&ee[ie]&&ee[ie].abort&&(ee[ie].abort.abort(),delete ee[ie])}))}removeTile(Y){return c._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]}))}}class I{constructor(){this.loaded={}}loadTile(Y){return c._(this,void 0,void 0,(function*(){const{uid:ee,encoding:ie,rawImageData:Te,redFactor:Ce,greenFactor:Be,blueFactor:Ge,baseShift:Ve}=Y,nt=Te.width+2,At=Te.height+2,bt=c.b(Te)?new c.R({width:nt,height:At},yield c.cO(Te,-1,-1,nt,At)):Te,ur=new c.cP(ee,bt,ie,Ce,Be,Ge,Ve);return this.loaded=this.loaded||{},this.loaded[ee]=ur,ur}))}removeTile(Y){const ee=this.loaded,ie=Y.uid;ee&&ee[ie]&&delete ee[ie]}}var k,N,D=(function(){if(N)return k;function Re(ee,ie){if(ee.length!==0){Y(ee[0],ie);for(var Te=1;Te<ee.length;Te++)Y(ee[Te],!ie)}}function Y(ee,ie){for(var Te=0,Ce=0,Be=0,Ge=ee.length,Ve=Ge-1;Be<Ge;Ve=Be++){var nt=(ee[Be][0]-ee[Ve][0])*(ee[Ve][1]+ee[Be][1]),At=Te+nt;Ce+=Math.abs(Te)>=Math.abs(nt)?Te-At+nt:nt-At+Te,Te=At}Te+Ce>=0!=!!ie&&ee.reverse()}return N=1,k=function ee(ie,Te){var Ce,Be=ie&&ie.type;if(Be==="FeatureCollection")for(Ce=0;Ce<ie.features.length;Ce++)ee(ie.features[Ce],Te);else if(Be==="GeometryCollection")for(Ce=0;Ce<ie.geometries.length;Ce++)ee(ie.geometries[Ce],Te);else if(Be==="Feature")ee(ie.geometry,Te);else if(Be==="Polygon")Re(ie.coordinates,Te);else if(Be==="MultiPolygon")for(Ce=0;Ce<ie.coordinates.length;Ce++)Re(ie.coordinates[Ce],Te);return ie}})(),B=c.cQ(D);class U extends c.cS{constructor(Y,ee){super(new c.cM,0,ee,[],[]),this.feature=Y,this.type=Y.type,this.properties=Y.tags?Y.tags:{},"id"in Y&&(typeof Y.id=="string"?this.id=parseInt(Y.id,10):typeof Y.id!="number"||isNaN(Y.id)||(this.id=Y.id))}loadGeometry(){const Y=[],ee=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ie of ee){const Te=[];for(const Ce of ie)Te.push(new c.P(Ce[0],Ce[1]));Y.push(Te)}return Y}}class V extends c.cR{constructor(Y,ee){super(new c.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=ee?ee.version:1,this.extent=ee?ee.extent:4096,this.length=Y.length,this.features=Y}feature(Y){return new U(this.features[Y],this.extent)}}function L(Re,Y){Y.writeVarintField(15,Re.version||1),Y.writeStringField(1,Re.name||""),Y.writeVarintField(5,Re.extent||4096);const ee={keys:[],values:[],keycache:{},valuecache:{}};for(let Ce=0;Ce<Re.length;Ce++)ee.feature=Re.feature(Ce),Y.writeMessage(2,$,ee);const ie=ee.keys;for(const Ce of ie)Y.writeStringField(3,Ce);const Te=ee.values;for(const Ce of Te)Y.writeMessage(4,oe,Ce)}function $(Re,Y){if(!Re.feature)return;const ee=Re.feature;ee.id!==void 0&&Y.writeVarintField(1,ee.id),Y.writeMessage(2,te,Re),Y.writeVarintField(3,ee.type),Y.writeMessage(4,se,ee)}function te(Re,Y){for(const ee in Re.feature?.properties){let ie=Re.feature.properties[ee],Te=Re.keycache[ee];if(ie===null)continue;Te===void 0&&(Re.keys.push(ee),Te=Re.keys.length-1,Re.keycache[ee]=Te),Y.writeVarint(Te),typeof ie!="string"&&typeof ie!="boolean"&&typeof ie!="number"&&(ie=JSON.stringify(ie));const Ce=typeof ie+":"+ie;let Be=Re.valuecache[Ce];Be===void 0&&(Re.values.push(ie),Be=Re.values.length-1,Re.valuecache[Ce]=Be),Y.writeVarint(Be)}}function G(Re,Y){return(Y<<3)+(7&Re)}function le(Re){return Re<<1^Re>>31}function se(Re,Y){const ee=Re.loadGeometry(),ie=Re.type;let Te=0,Ce=0;for(const Be of ee){let Ge=1;ie===1&&(Ge=Be.length),Y.writeVarint(G(1,Ge));const Ve=ie===3?Be.length-1:Be.length;for(let nt=0;nt<Ve;nt++){nt===1&&ie!==1&&Y.writeVarint(G(2,Ve-1));const At=Be[nt].x-Te,bt=Be[nt].y-Ce;Y.writeVarint(le(At)),Y.writeVarint(le(bt)),Te+=At,Ce+=bt}Re.type===3&&Y.writeVarint(G(7,1))}}function oe(Re,Y){const ee=typeof Re;ee==="string"?Y.writeStringField(1,Re):ee==="boolean"?Y.writeBooleanField(7,Re):ee==="number"&&(Re%1!=0?Y.writeDoubleField(3,Re):Re<0?Y.writeSVarintField(6,Re):Y.writeVarintField(5,Re))}const be={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},xe=Math.fround||(_e=new Float32Array(1),Re=>(_e[0]=+Re,_e[0]));var _e;class Ne{constructor(Y){this.options=Object.assign(Object.create(be),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:ee,minZoom:ie,maxZoom:Te}=this.options;ee&&console.time("total time");const Ce=`prepare ${Y.length} points`;ee&&console.time(Ce),this.points=Y;const Be=[];for(let Ve=0;Ve<Y.length;Ve++){const nt=Y[Ve];if(!nt.geometry)continue;const[At,bt]=nt.geometry.coordinates,ur=xe(tt(At)),Xe=xe(Ye(bt));Be.push(ur,Xe,1/0,Ve,-1,1),this.options.reduce&&Be.push(0)}let Ge=this.trees[Te+1]=this._createTree(Be);ee&&console.timeEnd(Ce);for(let Ve=Te;Ve>=ie;Ve--){const nt=+Date.now();Ge=this.trees[Ve]=this._createTree(this._cluster(Ge,Ve)),ee&&console.log("z%d: %d clusters in %dms",Ve,Ge.numItems,+Date.now()-nt)}return ee&&console.timeEnd("total time"),this}getClusters(Y,ee){let ie=((Y[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,Y[1]));let Ce=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ie=-180,Ce=180;else if(ie>Ce){const bt=this.getClusters([ie,Te,180,Be],ee),ur=this.getClusters([-180,Te,Ce,Be],ee);return bt.concat(ur)}const Ge=this.trees[this._limitZoom(ee)],Ve=Ge.range(tt(ie),Ye(Be),tt(Ce),Ye(Te)),nt=Ge.data,At=[];for(const bt of Ve){const ur=this.stride*bt;At.push(nt[ur+5]>1?fe(nt,ur,this.clusterProps):this.points[nt[ur+3]])}return At}getChildren(Y){const ee=this._getOriginId(Y),ie=this._getOriginZoom(Y),Te="No cluster with the specified id.",Ce=this.trees[ie];if(!Ce)throw new Error(Te);const Be=Ce.data;if(ee*this.stride>=Be.length)throw new Error(Te);const Ge=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Ve=Ce.within(Be[ee*this.stride],Be[ee*this.stride+1],Ge),nt=[];for(const At of Ve){const bt=At*this.stride;Be[bt+4]===Y&&nt.push(Be[bt+5]>1?fe(Be,bt,this.clusterProps):this.points[Be[bt+3]])}if(nt.length===0)throw new Error(Te);return nt}getLeaves(Y,ee,ie){const Te=[];return this._appendLeaves(Te,Y,ee=ee||10,ie=ie||0,0),Te}getTile(Y,ee,ie){const Te=this.trees[this._limitZoom(Y)],Ce=Math.pow(2,Y),{extent:Be,radius:Ge}=this.options,Ve=Ge/Be,nt=(ie-Ve)/Ce,At=(ie+1+Ve)/Ce,bt={features:[]};return this._addTileFeatures(Te.range((ee-Ve)/Ce,nt,(ee+1+Ve)/Ce,At),Te.data,ee,ie,Ce,bt),ee===0&&this._addTileFeatures(Te.range(1-Ve/Ce,nt,1,At),Te.data,Ce,ie,Ce,bt),ee===Ce-1&&this._addTileFeatures(Te.range(0,nt,Ve/Ce,At),Te.data,-1,ie,Ce,bt),bt.features.length?bt:null}getClusterExpansionZoom(Y){let ee=this._getOriginZoom(Y)-1;for(;ee<=this.options.maxZoom;){const ie=this.getChildren(Y);if(ee++,ie.length!==1)break;Y=ie[0].properties.cluster_id}return ee}_appendLeaves(Y,ee,ie,Te,Ce){const Be=this.getChildren(ee);for(const Ge of Be){const Ve=Ge.properties;if(Ve&&Ve.cluster?Ce+Ve.point_count<=Te?Ce+=Ve.point_count:Ce=this._appendLeaves(Y,Ve.cluster_id,ie,Te,Ce):Ce<Te?Ce++:Y.push(Ge),Y.length===ie)break}return Ce}_createTree(Y){const ee=new c.aI(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<Y.length;ie+=this.stride)ee.add(Y[ie],Y[ie+1]);return ee.finish(),ee.data=Y,ee}_addTileFeatures(Y,ee,ie,Te,Ce,Be){for(const Ge of Y){const Ve=Ge*this.stride,nt=ee[Ve+5]>1;let At,bt,ur;if(nt)At=Le(ee,Ve,this.clusterProps),bt=ee[Ve],ur=ee[Ve+1];else{const xr=this.points[ee[Ve+3]];At=xr.properties;const[Lt,gr]=xr.geometry.coordinates;bt=tt(Lt),ur=Ye(gr)}const Xe={type:1,geometry:[[Math.round(this.options.extent*(bt*Ce-ie)),Math.round(this.options.extent*(ur*Ce-Te))]],tags:At};let Xt;Xt=nt||this.options.generateId?ee[Ve+3]:this.points[ee[Ve+3]].id,Xt!==void 0&&(Xe.id=Xt),Be.features.push(Xe)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,ee){const{radius:ie,extent:Te,reduce:Ce,minPoints:Be}=this.options,Ge=ie/(Te*Math.pow(2,ee)),Ve=Y.data,nt=[],At=this.stride;for(let bt=0;bt<Ve.length;bt+=At){if(Ve[bt+2]<=ee)continue;Ve[bt+2]=ee;const ur=Ve[bt],Xe=Ve[bt+1],Xt=Y.within(Ve[bt],Ve[bt+1],Ge),xr=Ve[bt+5];let Lt=xr;for(const gr of Xt){const Lr=gr*At;Ve[Lr+2]>ee&&(Lt+=Ve[Lr+5])}if(Lt>xr&&Lt>=Be){let gr,Lr=ur*xr,je=Xe*xr,ht=-1;const Rt=(bt/At<<5)+(ee+1)+this.points.length;for(const gt of Xt){const Ut=gt*At;if(Ve[Ut+2]<=ee)continue;Ve[Ut+2]=ee;const kt=Ve[Ut+5];Lr+=Ve[Ut]*kt,je+=Ve[Ut+1]*kt,Ve[Ut+4]=Rt,Ce&&(gr||(gr=this._map(Ve,bt,!0),ht=this.clusterProps.length,this.clusterProps.push(gr)),Ce(gr,this._map(Ve,Ut)))}Ve[bt+4]=Rt,nt.push(Lr/Lt,je/Lt,1/0,Rt,-1,Lt),Ce&&nt.push(ht)}else{for(let gr=0;gr<At;gr++)nt.push(Ve[bt+gr]);if(Lt>1)for(const gr of Xt){const Lr=gr*At;if(!(Ve[Lr+2]<=ee)){Ve[Lr+2]=ee;for(let je=0;je<At;je++)nt.push(Ve[Lr+je])}}}}return nt}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,ee,ie){if(Y[ee+5]>1){const Be=this.clusterProps[Y[ee+6]];return ie?Object.assign({},Be):Be}const Te=this.points[Y[ee+3]].properties,Ce=this.options.map(Te);return ie&&Ce===Te?Object.assign({},Ce):Ce}}function fe(Re,Y,ee){return{type:"Feature",id:Re[Y+3],properties:Le(Re,Y,ee),geometry:{type:"Point",coordinates:[(ie=Re[Y],360*(ie-.5)),rt(Re[Y+1])]}};var ie}function Le(Re,Y,ee){const ie=Re[Y+5],Te=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Ce=Re[Y+6],Be=Ce===-1?{}:Object.assign({},ee[Ce]);return Object.assign(Be,{cluster:!0,cluster_id:Re[Y+3],point_count:ie,point_count_abbreviated:Te})}function tt(Re){return Re/360+.5}function Ye(Re){const Y=Math.sin(Re*Math.PI/180),ee=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ee<0?0:ee>1?1:ee}function rt(Re){const Y=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function it(Re,Y,ee,ie){let Te=ie;const Ce=Y+(ee-Y>>1);let Be,Ge=ee-Y;const Ve=Re[Y],nt=Re[Y+1],At=Re[ee],bt=Re[ee+1];for(let ur=Y+3;ur<ee;ur+=3){const Xe=Ct(Re[ur],Re[ur+1],Ve,nt,At,bt);if(Xe>Te)Be=ur,Te=Xe;else if(Xe===Te){const Xt=Math.abs(ur-Ce);Xt<Ge&&(Be=ur,Ge=Xt)}}Te>ie&&(Be-Y>3&&it(Re,Y,Be,ie),Re[Be+2]=Te,ee-Be>3&&it(Re,Be,ee,ie))}function Ct(Re,Y,ee,ie,Te,Ce){let Be=Te-ee,Ge=Ce-ie;if(Be!==0||Ge!==0){const Ve=((Re-ee)*Be+(Y-ie)*Ge)/(Be*Be+Ge*Ge);Ve>1?(ee=Te,ie=Ce):Ve>0&&(ee+=Be*Ve,ie+=Ge*Ve)}return Be=Re-ee,Ge=Y-ie,Be*Be+Ge*Ge}function Mt(Re,Y,ee,ie){const Te={id:Re??null,type:Y,geometry:ee,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")jt(Te,ee);else if(Y==="Polygon")jt(Te,ee[0]);else if(Y==="MultiLineString")for(const Ce of ee)jt(Te,Ce);else if(Y==="MultiPolygon")for(const Ce of ee)jt(Te,Ce[0]);return Te}function jt(Re,Y){for(let ee=0;ee<Y.length;ee+=3)Re.minX=Math.min(Re.minX,Y[ee]),Re.minY=Math.min(Re.minY,Y[ee+1]),Re.maxX=Math.max(Re.maxX,Y[ee]),Re.maxY=Math.max(Re.maxY,Y[ee+1])}function Gt(Re,Y,ee,ie){if(!Y.geometry)return;const Te=Y.geometry.coordinates;if(Te&&Te.length===0)return;const Ce=Y.geometry.type,Be=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Ge=[],Ve=Y.id;if(ee.promoteId?Ve=Y.properties[ee.promoteId]:ee.generateId&&(Ve=ie||0),Ce==="Point")Or(Te,Ge);else if(Ce==="MultiPoint")for(const nt of Te)Or(nt,Ge);else if(Ce==="LineString")_r(Te,Ge,Be,!1);else if(Ce==="MultiLineString"){if(ee.lineMetrics){for(const nt of Te)Ge=[],_r(nt,Ge,Be,!1),Re.push(Mt(Ve,"LineString",Ge,Y.properties));return}wr(Te,Ge,Be,!1)}else if(Ce==="Polygon")wr(Te,Ge,Be,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const nt of Y.geometry.geometries)Gt(Re,{id:Ve,geometry:nt,properties:Y.properties},ee,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of Te){const At=[];wr(nt,At,Be,!0),Ge.push(At)}}Re.push(Mt(Ve,Ce,Ge,Y.properties))}function Or(Re,Y){Y.push(Dr(Re[0]),Et(Re[1]),0)}function _r(Re,Y,ee,ie){let Te,Ce,Be=0;for(let Ve=0;Ve<Re.length;Ve++){const nt=Dr(Re[Ve][0]),At=Et(Re[Ve][1]);Y.push(nt,At,0),Ve>0&&(Be+=ie?(Te*At-nt*Ce)/2:Math.sqrt(Math.pow(nt-Te,2)+Math.pow(At-Ce,2))),Te=nt,Ce=At}const Ge=Y.length-3;Y[2]=1,it(Y,0,Ge,ee),Y[Ge+2]=1,Y.size=Math.abs(Be),Y.start=0,Y.end=Y.size}function wr(Re,Y,ee,ie){for(let Te=0;Te<Re.length;Te++){const Ce=[];_r(Re[Te],Ce,ee,ie),Y.push(Ce)}}function Dr(Re){return Re/360+.5}function Et(Re){const Y=Math.sin(Re*Math.PI/180),ee=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ee<0?0:ee>1?1:ee}function vt(Re,Y,ee,ie,Te,Ce,Be,Ge){if(ie/=Y,Ce>=(ee/=Y)&&Be<ie)return Re;if(Be<ee||Ce>=ie)return null;const Ve=[];for(const nt of Re){const At=nt.geometry;let bt=nt.type;const ur=Te===0?nt.minX:nt.minY,Xe=Te===0?nt.maxX:nt.maxY;if(ur>=ee&&Xe<ie){Ve.push(nt);continue}if(Xe<ee||ur>=ie)continue;let Xt=[];if(bt==="Point"||bt==="MultiPoint")Pr(At,Xt,ee,ie,Te);else if(bt==="LineString")yr(At,Xt,ee,ie,Te,!1,Ge.lineMetrics);else if(bt==="MultiLineString")br(At,Xt,ee,ie,Te,!1);else if(bt==="Polygon")br(At,Xt,ee,ie,Te,!0);else if(bt==="MultiPolygon")for(const xr of At){const Lt=[];br(xr,Lt,ee,ie,Te,!0),Lt.length&&Xt.push(Lt)}if(Xt.length){if(Ge.lineMetrics&&bt==="LineString"){for(const xr of Xt)Ve.push(Mt(nt.id,bt,xr,nt.tags));continue}bt!=="LineString"&&bt!=="MultiLineString"||(Xt.length===1?(bt="LineString",Xt=Xt[0]):bt="MultiLineString"),bt!=="Point"&&bt!=="MultiPoint"||(bt=Xt.length===3?"Point":"MultiPoint"),Ve.push(Mt(nt.id,bt,Xt,nt.tags))}}return Ve.length?Ve:null}function Pr(Re,Y,ee,ie,Te){for(let Ce=0;Ce<Re.length;Ce+=3){const Be=Re[Ce+Te];Be>=ee&&Be<=ie&&lr(Y,Re[Ce],Re[Ce+1],Re[Ce+2])}}function yr(Re,Y,ee,ie,Te,Ce,Be){let Ge=Ar(Re);const Ve=Te===0?ut:Zt;let nt,At,bt=Re.start;for(let Lt=0;Lt<Re.length-3;Lt+=3){const gr=Re[Lt],Lr=Re[Lt+1],je=Re[Lt+2],ht=Re[Lt+3],Rt=Re[Lt+4],gt=Te===0?gr:Lr,Ut=Te===0?ht:Rt;let kt=!1;Be&&(nt=Math.sqrt(Math.pow(gr-ht,2)+Math.pow(Lr-Rt,2))),gt<ee?Ut>ee&&(At=Ve(Ge,gr,Lr,ht,Rt,ee),Be&&(Ge.start=bt+nt*At)):gt>ie?Ut<ie&&(At=Ve(Ge,gr,Lr,ht,Rt,ie),Be&&(Ge.start=bt+nt*At)):lr(Ge,gr,Lr,je),Ut<ee&&gt>=ee&&(At=Ve(Ge,gr,Lr,ht,Rt,ee),kt=!0),Ut>ie&&gt<=ie&&(At=Ve(Ge,gr,Lr,ht,Rt,ie),kt=!0),!Ce&&kt&&(Be&&(Ge.end=bt+nt*At),Y.push(Ge),Ge=Ar(Re)),Be&&(bt+=nt)}let ur=Re.length-3;const Xe=Re[ur],Xt=Re[ur+1],xr=Te===0?Xe:Xt;xr>=ee&&xr<=ie&&lr(Ge,Xe,Xt,Re[ur+2]),ur=Ge.length-3,Ce&&ur>=3&&(Ge[ur]!==Ge[0]||Ge[ur+1]!==Ge[1])&&lr(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&Y.push(Ge)}function Ar(Re){const Y=[];return Y.size=Re.size,Y.start=Re.start,Y.end=Re.end,Y}function br(Re,Y,ee,ie,Te,Ce){for(const Be of Re)yr(Be,Y,ee,ie,Te,Ce,!1)}function lr(Re,Y,ee,ie){Re.push(Y,ee,ie)}function ut(Re,Y,ee,ie,Te,Ce){const Be=(Ce-Y)/(ie-Y);return lr(Re,Ce,ee+(Te-ee)*Be,1),Be}function Zt(Re,Y,ee,ie,Te,Ce){const Be=(Ce-ee)/(Te-ee);return lr(Re,Y+(ie-Y)*Be,Ce,1),Be}function dr(Re,Y){const ee=[];for(let ie=0;ie<Re.length;ie++){const Te=Re[ie],Ce=Te.type;let Be;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Be=er(Te.geometry,Y);else if(Ce==="MultiLineString"||Ce==="Polygon"){Be=[];for(const Ge of Te.geometry)Be.push(er(Ge,Y))}else if(Ce==="MultiPolygon"){Be=[];for(const Ge of Te.geometry){const Ve=[];for(const nt of Ge)Ve.push(er(nt,Y));Be.push(Ve)}}ee.push(Mt(Te.id,Ce,Be,Te.tags))}return ee}function er(Re,Y){const ee=[];ee.size=Re.size,Re.start!==void 0&&(ee.start=Re.start,ee.end=Re.end);for(let ie=0;ie<Re.length;ie+=3)ee.push(Re[ie]+Y,Re[ie+1],Re[ie+2]);return ee}function Bt(Re,Y){if(Re.transformed)return Re;const ee=1<<Re.z,ie=Re.x,Te=Re.y;for(const Ce of Re.features){const Be=Ce.geometry,Ge=Ce.type;if(Ce.geometry=[],Ge===1)for(let Ve=0;Ve<Be.length;Ve+=2)Ce.geometry.push(mr(Be[Ve],Be[Ve+1],Y,ee,ie,Te));else for(let Ve=0;Ve<Be.length;Ve++){const nt=[];for(let At=0;At<Be[Ve].length;At+=2)nt.push(mr(Be[Ve][At],Be[Ve][At+1],Y,ee,ie,Te));Ce.geometry.push(nt)}}return Re.transformed=!0,Re}function mr(Re,Y,ee,ie,Te,Ce){return[Math.round(ee*(Re*ie-Te)),Math.round(ee*(Y*ie-Ce))]}function Tr(Re,Y,ee,ie,Te){const Ce=Y===Te.maxZoom?0:Te.tolerance/((1<<Y)*Te.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:ee,y:ie,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of Re)fr(Be,Ge,Ce,Te);return Be}function fr(Re,Y,ee,ie){const Te=Y.geometry,Ce=Y.type,Be=[];if(Re.minX=Math.min(Re.minX,Y.minX),Re.minY=Math.min(Re.minY,Y.minY),Re.maxX=Math.max(Re.maxX,Y.maxX),Re.maxY=Math.max(Re.maxY,Y.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ge=0;Ge<Te.length;Ge+=3)Be.push(Te[Ge],Te[Ge+1]),Re.numPoints++,Re.numSimplified++;else if(Ce==="LineString")nr(Be,Te,Re,ee,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ge=0;Ge<Te.length;Ge++)nr(Be,Te[Ge],Re,ee,Ce==="Polygon",Ge===0);else if(Ce==="MultiPolygon")for(let Ge=0;Ge<Te.length;Ge++){const Ve=Te[Ge];for(let nt=0;nt<Ve.length;nt++)nr(Be,Ve[nt],Re,ee,!0,nt===0)}if(Be.length){let Ge=Y.tags||null;if(Ce==="LineString"&&ie.lineMetrics){Ge={};for(const nt in Y.tags)Ge[nt]=Y.tags[nt];Ge.mapbox_clip_start=Te.start/Te.size,Ge.mapbox_clip_end=Te.end/Te.size}const Ve={geometry:Be,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ge};Y.id!==null&&(Ve.id=Y.id),Re.features.push(Ve)}}function nr(Re,Y,ee,ie,Te,Ce){const Be=ie*ie;if(ie>0&&Y.size<(Te?Be:ie))return void(ee.numPoints+=Y.length/3);const Ge=[];for(let Ve=0;Ve<Y.length;Ve+=3)(ie===0||Y[Ve+2]>Be)&&(ee.numSimplified++,Ge.push(Y[Ve],Y[Ve+1])),ee.numPoints++;Te&&(function(Ve,nt){let At=0;for(let bt=0,ur=Ve.length,Xe=ur-2;bt<ur;Xe=bt,bt+=2)At+=(Ve[bt]-Ve[Xe])*(Ve[bt+1]+Ve[Xe+1]);if(At>0===nt)for(let bt=0,ur=Ve.length;bt<ur/2;bt+=2){const Xe=Ve[bt],Xt=Ve[bt+1];Ve[bt]=Ve[ur-2-bt],Ve[bt+1]=Ve[ur-1-bt],Ve[ur-2-bt]=Xe,Ve[ur-1-bt]=Xt}})(Ge,Ce),Re.push(Ge)}const rr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nr{constructor(Y,ee){const ie=(ee=this.options=(function(Ce,Be){for(const Ge in Be)Ce[Ge]=Be[Ge];return Ce})(Object.create(rr),ee)).debug;if(ie&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=(function(Ce,Be){const Ge=[];if(Ce.type==="FeatureCollection")for(let Ve=0;Ve<Ce.features.length;Ve++)Gt(Ge,Ce.features[Ve],Be,Ve);else Gt(Ge,Ce.type==="Feature"?Ce:{geometry:Ce},Be);return Ge})(Y,ee);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=(function(Ce,Be){const Ge=Be.buffer/Be.extent;let Ve=Ce;const nt=vt(Ce,1,-1-Ge,Ge,0,-1,2,Be),At=vt(Ce,1,1-Ge,2+Ge,0,-1,2,Be);return(nt||At)&&(Ve=vt(Ce,1,-Ge,1+Ge,0,-1,2,Be)||[],nt&&(Ve=dr(nt,1).concat(Ve)),At&&(Ve=Ve.concat(dr(At,-1)))),Ve})(Te,ee),Te.length&&this.splitTile(Te,0,0,0),ie&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,ee,ie,Te,Ce,Be,Ge){const Ve=[Y,ee,ie,Te],nt=this.options,At=nt.debug;for(;Ve.length;){Te=Ve.pop(),ie=Ve.pop(),ee=Ve.pop(),Y=Ve.pop();const bt=1<<ee,ur=Cr(ee,ie,Te);let Xe=this.tiles[ur];if(!Xe&&(At>1&&console.time("creation"),Xe=this.tiles[ur]=Tr(Y,ee,ie,Te,nt),this.tileCoords.push({z:ee,x:ie,y:Te}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,ie,Te,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));const kt=`z${ee}`;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Xe.source=Y,Ce==null){if(ee===nt.indexMaxZoom||Xe.numPoints<=nt.indexMaxPoints)continue}else{if(ee===nt.maxZoom||ee===Ce)continue;if(Ce!=null){const kt=Ce-ee;if(ie!==Be>>kt||Te!==Ge>>kt)continue}}if(Xe.source=null,Y.length===0)continue;At>1&&console.time("clipping");const Xt=.5*nt.buffer/nt.extent,xr=.5-Xt,Lt=.5+Xt,gr=1+Xt;let Lr=null,je=null,ht=null,Rt=null,gt=vt(Y,bt,ie-Xt,ie+Lt,0,Xe.minX,Xe.maxX,nt),Ut=vt(Y,bt,ie+xr,ie+gr,0,Xe.minX,Xe.maxX,nt);Y=null,gt&&(Lr=vt(gt,bt,Te-Xt,Te+Lt,1,Xe.minY,Xe.maxY,nt),je=vt(gt,bt,Te+xr,Te+gr,1,Xe.minY,Xe.maxY,nt),gt=null),Ut&&(ht=vt(Ut,bt,Te-Xt,Te+Lt,1,Xe.minY,Xe.maxY,nt),Rt=vt(Ut,bt,Te+xr,Te+gr,1,Xe.minY,Xe.maxY,nt),Ut=null),At>1&&console.timeEnd("clipping"),Ve.push(Lr||[],ee+1,2*ie,2*Te),Ve.push(je||[],ee+1,2*ie,2*Te+1),Ve.push(ht||[],ee+1,2*ie+1,2*Te),Ve.push(Rt||[],ee+1,2*ie+1,2*Te+1)}}getTile(Y,ee,ie){Y=+Y,ee=+ee,ie=+ie;const Te=this.options,{extent:Ce,debug:Be}=Te;if(Y<0||Y>24)return null;const Ge=1<<Y,Ve=Cr(Y,ee=ee+Ge&Ge-1,ie);if(this.tiles[Ve])return Bt(this.tiles[Ve],Ce);Be>1&&console.log("drilling down to z%d-%d-%d",Y,ee,ie);let nt,At=Y,bt=ee,ur=ie;for(;!nt&&At>0;)At--,bt>>=1,ur>>=1,nt=this.tiles[Cr(At,bt,ur)];return nt&&nt.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",At,bt,ur),console.time("drilling down")),this.splitTile(nt.source,At,bt,ur,Y,ee,ie),Be>1&&console.timeEnd("drilling down"),this.tiles[Ve]?Bt(this.tiles[Ve],Ce):null):null}}function Cr(Re,Y,ee){return 32*((1<<Re)*ee+Y)+Re}class qr extends P{constructor(Y,ee,ie,Te=ir){super(Y,ee,ie),this._dataUpdateable=new Map,this._createGeoJSONIndex=Te}loadVectorTile(Y,ee){return c._(this,void 0,void 0,(function*(){const ie=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Te=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!Te)return null;const Ce=new V(Te.features,{version:2,extent:c.$});let Be=(function(Ge){const Ve=new c.cM;return(function(nt,At){for(const bt in nt.layers)At.writeMessage(3,L,nt.layers[bt])})(Ge,Ve),Ve.finish()})(Ce);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Ce,rawData:Be.buffer}}))}loadData(Y){return c._(this,void 0,void 0,(function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const ie=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new c.cN(Y.request);this._pendingRequest=new AbortController;try{(!this._pendingData||Y.request||Y.data||Y.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest));const Te=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Te,Y),this.loaded={};const Ce={data:Te};if(ie){const Be=ie.finish();Be&&(Ce.resourceTiming={},Ce.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Be)))}return Ce}catch(Te){if(delete this._pendingRequest,c.cy(Te))return{abandoned:!0};throw Te}}))}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Y){const ee=this.loaded;return ee&&ee[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,ee){return c._(this,void 0,void 0,(function*(){let ie=yield this.loadGeoJSON(Y,ee);if(delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(B(ie,!0),Y.filter){const Te=c.cT(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map((Be=>`${Be.key}: ${Be.message}`)).join(", "));ie={type:"FeatureCollection",features:ie.features.filter((Be=>Te.value.evaluate({zoom:0},Be)))}}return ie}))}loadGeoJSON(Y,ee){return c._(this,void 0,void 0,(function*(){const{promoteId:ie}=Y;if(Y.request){const Te=yield c.j(Y.request,ee);return this._dataUpdateable=c.cV(Te.data,ie)?c.cU(Te.data,ie):void 0,Te.data}if(typeof Y.data=="string")try{const Te=JSON.parse(Y.data);return this._dataUpdateable=c.cV(Te,ie)?c.cU(Te,ie):void 0,Te}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return c.cW(this._dataUpdateable,Y.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Y){return c._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}function ir(Re,Y){return Y.cluster?new Ne((function({superclusterOptions:ee,clusterProperties:ie}){if(!ie||!ee)return ee;const Te={},Ce={},Be={accumulated:null,zoom:0},Ge={properties:null},Ve=Object.keys(ie);for(const nt of Ve){const[At,bt]=ie[nt],ur=c.cT(bt),Xe=c.cT(typeof At=="string"?[At,["accumulated"],["get",nt]]:At);Te[nt]=ur.value,Ce[nt]=Xe.value}return ee.map=nt=>{Ge.properties=nt;const At={};for(const bt of Ve)At[bt]=Te[bt].evaluate(Be,Ge);return At},ee.reduce=(nt,At)=>{Ge.properties=At;for(const bt of Ve)Be.accumulated=nt[bt],nt[bt]=Ce[bt].evaluate(Be,Ge)},ee})(Y)).load(Re.features):(function(ee,ie){return new Nr(ee,ie)})(Re,Y.geojsonVtOptions)}class or{constructor(Y){this.self=Y,this.actor=new c.J(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ee,ie)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=ie},this.self.addProtocol=c.cA,this.self.removeProtocol=c.cB,this.self.registerRTLTextPlugin=ee=>{c.cX.setMethods(ee)},this.actor.registerMessageHandler("LDT",((ee,ie)=>this._getDEMWorkerSource(ee,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RDT",((ee,ie)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ee,ie.source).removeTile(ie)})))),this.actor.registerMessageHandler("GCEZ",((ee,ie)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ie.type,ie.source).getClusterExpansionZoom(ie)})))),this.actor.registerMessageHandler("GCC",((ee,ie)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ie.type,ie.source).getClusterChildren(ie)})))),this.actor.registerMessageHandler("GCL",((ee,ie)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,ie.type,ie.source).getClusterLeaves(ie)})))),this.actor.registerMessageHandler("LD",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).loadData(ie))),this.actor.registerMessageHandler("GD",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).getData())),this.actor.registerMessageHandler("LT",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RT",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).reloadTile(ie))),this.actor.registerMessageHandler("AT",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).abortTile(ie))),this.actor.registerMessageHandler("RMT",((ee,ie)=>this._getWorkerSource(ee,ie.type,ie.source).removeTile(ie))),this.actor.registerMessageHandler("RS",((ee,ie)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[ee]||!this.workerSources[ee][ie.type]||!this.workerSources[ee][ie.type][ie.source])return;const Te=this.workerSources[ee][ie.type][ie.source];delete this.workerSources[ee][ie.type][ie.source],Te.removeSource!==void 0&&Te.removeSource(ie)})))),this.actor.registerMessageHandler("RM",(ee=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],this.globalStates.delete(ee)})))),this.actor.registerMessageHandler("SR",((ee,ie)=>c._(this,void 0,void 0,(function*(){this.referrer=ie})))),this.actor.registerMessageHandler("SRPS",((ee,ie)=>this._syncRTLPluginState(ee,ie))),this.actor.registerMessageHandler("IS",((ee,ie)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(ie)})))),this.actor.registerMessageHandler("SI",((ee,ie)=>this._setImages(ee,ie))),this.actor.registerMessageHandler("UL",((ee,ie)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).update(ie.layers,ie.removedIds,this._getGlobalState(ee))})))),this.actor.registerMessageHandler("UGS",((ee,ie)=>c._(this,void 0,void 0,(function*(){const Te=this._getGlobalState(ee);for(const Ce in ie)Te[Ce]=ie[Ce]})))),this.actor.registerMessageHandler("SL",((ee,ie)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).replace(ie,this._getGlobalState(ee))}))))}_getGlobalState(Y){let ee=this.globalStates.get(Y);return ee||(ee={},this.globalStates.set(Y,ee)),ee}_setImages(Y,ee){return c._(this,void 0,void 0,(function*(){this.availableImages[Y]=ee;for(const ie in this.workerSources[Y]){const Te=this.workerSources[Y][ie];for(const Ce in Te)Te[Ce].availableImages=ee}}))}_syncRTLPluginState(Y,ee){return c._(this,void 0,void 0,(function*(){return yield c.cX.syncState(ee,this.self.importScripts)}))}_getAvailableImages(Y){let ee=this.availableImages[Y];return ee||(ee=[]),ee}_getLayerIndex(Y){let ee=this.layerIndexes[Y];return ee||(ee=this.layerIndexes[Y]=new a),ee}_getWorkerSource(Y,ee,ie){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ee]||(this.workerSources[Y][ee]={}),!this.workerSources[Y][ee][ie]){const Te={sendAsync:(Ce,Be)=>(Ce.targetMapId=Y,this.actor.sendAsync(Ce,Be))};switch(ee){case"vector":this.workerSources[Y][ee][ie]=new P(Te,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][ee][ie]=new qr(Te,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][ee][ie]=new this.externalWorkerSourceTypes[ee](Te,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][ee][ie]}_getDEMWorkerSource(Y,ee){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ee]||(this.demWorkerSources[Y][ee]=new I),this.demWorkerSources[Y][ee]}}return c.i(self)&&(self.worker=new or(self)),or})),s("index",["exports","./shared"],(function(c,a){var g="5.10.0";function v(){var y=new a.A(4);return a.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let w,P;const I={frame(y,i,d){const p=requestAnimationFrame((x=>{_(),i(x)})),{unsubscribe:_}=a.s(y.signal,"abort",(()=>{_(),cancelAnimationFrame(p),d(a.c())}),!1)},frameAsync(y){return new Promise(((i,d)=>{this.frame(y,i,d)}))},getImageData(y,i=0){return this.getImageCanvasContext(y).getImageData(-i,-i,y.width+2*i,y.height+2*i)},getImageCanvasContext(y){const i=window.document.createElement("canvas"),d=i.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return i.width=y.width,i.height=y.height,d.drawImage(y,0,0,y.width,y.height),d},resolveURL:y=>(w||(w=document.createElement("a")),w.href=y,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(P==null&&(P=matchMedia("(prefers-reduced-motion: reduce)")),P.matches)}},k=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function N(){return k.getCurrentTime()}class D{static testProp(i){if(!D.docStyle)return i[0];for(let d=0;d<i.length;d++)if(i[d]in D.docStyle)return i[d];return i[0]}static create(i,d,p){const _=window.document.createElement(i);return d!==void 0&&(_.className=d),p&&p.appendChild(_),_}static createNS(i,d){return window.document.createElementNS(i,d)}static disableDrag(){D.docStyle&&D.selectProp&&(D.userSelect=D.docStyle[D.selectProp],D.docStyle[D.selectProp]="none")}static enableDrag(){D.docStyle&&D.selectProp&&(D.docStyle[D.selectProp]=D.userSelect)}static setTransform(i,d){i.style[D.transformProp]=d}static addEventListener(i,d,p,_={}){i.addEventListener(d,p,"passive"in _?_:_.capture)}static removeEventListener(i,d,p,_={}){i.removeEventListener(d,p,"passive"in _?_:_.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",D.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",D.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",D.suppressClickInternal,!0)}),0)}static getScale(i){const d=i.getBoundingClientRect();return{x:d.width/i.offsetWidth||1,y:d.height/i.offsetHeight||1,boundingClientRect:d}}static getPoint(i,d,p){const _=d.boundingClientRect;return new a.P((p.clientX-_.left)/d.x-i.clientLeft,(p.clientY-_.top)/d.y-i.clientTop)}static mousePos(i,d){const p=D.getScale(i);return D.getPoint(i,p,d)}static touchPos(i,d){const p=[],_=D.getScale(i);for(let x=0;x<d.length;x++)p.push(D.getPoint(i,_,d[x]));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const d=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),p=d.querySelectorAll("script");for(const _ of p)_.remove();return D.clean(d),d.innerHTML}static isPossiblyDangerous(i,d){const p=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!p.includes("javascript:")&&!p.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const d=i.children;for(const p of d)D.removeAttributes(p),D.clean(p)}static removeAttributes(i){for(const{name:d,value:p}of i.attributes)D.isPossiblyDangerous(d,p)&&i.removeAttribute(d)}}D.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,D.selectProp=D.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),D.transformProp=D.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(y){!L&&V&&($?te(y):U=y)}};let U,V,L=!1,$=!1;function te(y){const i=y.createTexture();y.bindTexture(y.TEXTURE_2D,i);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,V),y.isContextLost())return;B.supported=!0}catch{}y.deleteTexture(i),L=!0}var G;typeof document<"u"&&(V=document.createElement("img"),V.onload=()=>{U&&te(U),U=null,$=!0},V.onerror=()=>{L=!0,U=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let i,d,p,_;y.resetRequestQueue=()=>{i=[],d=0,p=0,_={}},y.addThrottleControl=M=>{const z=p++;return _[z]=M,z},y.removeThrottleControl=M=>{delete _[M],A()},y.getImage=(M,z,j=!0)=>new Promise(((X,H)=>{B.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),a.e(M,{type:"image"}),i.push({abortController:z,requestParameters:M,supportImageRefresh:j,state:"queued",onError:Q=>{H(Q)},onSuccess:Q=>{X(Q)}}),A()}));const x=M=>a._(this,void 0,void 0,(function*(){M.state="running";const{requestParameters:z,supportImageRefresh:j,onError:X,onSuccess:H,abortController:Q}=M,re=j===!1&&!a.i(self)&&!a.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((ge,Pe)=>ge&&Pe==="accept"),!0));d++;const he=re?R(z,Q):a.m(z,Q);try{const ge=yield he;delete M.abortController,M.state="completed",ge.data instanceof HTMLImageElement||a.b(ge.data)?H(ge):ge.data&&H({data:yield(de=ge.data,typeof createImageBitmap=="function"?a.f(de):a.h(de)),cacheControl:ge.cacheControl,expires:ge.expires})}catch(ge){delete M.abortController,X(ge)}finally{d--,A()}var de})),A=()=>{const M=(()=>{for(const z of Object.keys(_))if(_[z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=d;z<M&&i.length>0;z++){const j=i.shift();j.abortController.signal.aborted?z--:x(j)}},R=(M,z)=>new Promise(((j,X)=>{const H=new Image,Q=M.url,re=M.credentials;re&&re==="include"?H.crossOrigin="use-credentials":(re&&re==="same-origin"||!a.d(Q))&&(H.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{H.src="",X(a.c())})),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,j({data:H})},H.onerror=()=>{H.onerror=H.onload=null,z.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=Q}))})(G||(G={})),G.resetRequestQueue();class le{constructor(i){this._transformRequestFn=i??null}transformRequest(i,d){return this._transformRequestFn&&this._transformRequestFn(i,d)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function se(y){const i=[];if(typeof y=="string")i.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:p,url:_}of y){const x=`${p}${_}`;d.indexOf(x)===-1&&(d.push(x),i.push({id:p,url:_}))}}return i}function oe(y,i,d){try{const p=new URL(y);return p.pathname+=`${i}${d}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function be(y){const{userImage:i}=y;return!!(i&&i.render&&i.render())&&(y.data.replace(new Uint8Array(i.data.buffer)),!0)}class xe extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:d,promiseResolve:p}of this.requestors)p(this._getImagesForIds(d));this.requestors=[]}}getImage(i){const d=this.images[i];if(d&&!d.data&&d.spriteData){const p=d.spriteData;d.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),d.spriteData=null}return d}addImage(i,d){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,d)&&(this.images[i]=d)}_validate(i,d){let p=!0;const _=d.data||d.spriteData;return this._validateStretch(d.stretchX,_&&_.width)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,_&&_.height)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,d){if(!i)return!0;let p=0;for(const _ of i){if(_[0]<p||_[1]<_[0]||d<_[1])return!1;p=_[1]}return!0}_validateContent(i,d){if(!i)return!0;if(i.length!==4)return!1;const p=d.spriteData,_=p&&p.width||d.data.width,x=p&&p.height||d.data.height;return!(i[0]<0||_<i[0]||i[1]<0||x<i[1]||i[2]<0||_<i[2]||i[3]<0||x<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,d,p=!0){const _=this.getImage(i);if(p&&(_.data.width!==d.data.width||_.data.height!==d.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=_.version+1,this.images[i]=d,this.updatedImages[i]=!0}removeImage(i){const d=this.images[i];delete this.images[i],delete this.patterns[i],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise(((d,p)=>{let _=!0;if(!this.isLoaded())for(const x of i)this.images[x]||(_=!1);this.isLoaded()||_?d(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:d})}))}_getImagesForIds(i){const d={};for(const p of i){let _=this.getImage(p);_||(this.fire(new a.l("styleimagemissing",{id:p})),_=this.getImage(p)),_?d[p]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,textFitWidth:_.textFitWidth,textFitHeight:_.textFitHeight,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:i,height:d}=this.atlasImage;return{width:i,height:d}}getPattern(i){const d=this.patterns[i],p=this.getImage(i);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new a.I(_,p);this.patterns[i]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const d=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(i,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const x in this.patterns)i.push(this.patterns[x].bin);const{w:d,h:p}=a.p(i),_=this.atlasImage;_.resize({width:d||1,height:p||1});for(const x in this.patterns){const{bin:A}=this.patterns[x],R=A.x+1,M=A.y+1,z=this.getImage(x).data,j=z.width,X=z.height;a.R.copy(z,_,{x:0,y:0},{x:R,y:M},{width:j,height:X}),a.R.copy(z,_,{x:0,y:X-1},{x:R,y:M-1},{width:j,height:1}),a.R.copy(z,_,{x:0,y:0},{x:R,y:M+X},{width:j,height:1}),a.R.copy(z,_,{x:j-1,y:0},{x:R-1,y:M},{width:1,height:X}),a.R.copy(z,_,{x:0,y:0},{x:R+j,y:M},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const d of i){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.getImage(d);p||a.w(`Image with ID: "${d}" was not found`),be(p)&&this.updateImage(d,p)}}}const _e=1e20;function Ne(y,i,d,p,_,x,A,R,M){for(let z=i;z<i+p;z++)fe(y,d*x+z,x,_,A,R,M);for(let z=d;z<d+_;z++)fe(y,z*x+i,1,p,A,R,M)}function fe(y,i,d,p,_,x,A){x[0]=0,A[0]=-_e,A[1]=_e,_[0]=y[i];for(let R=1,M=0,z=0;R<p;R++){_[R]=y[i+R*d];const j=R*R;do{const X=x[M];z=(_[R]-_[X]+j-X*X)/(R-X)/2}while(z<=A[M]&&--M>-1);M++,x[M]=R,A[M]=z,A[M+1]=_e}for(let R=0,M=0;R<p;R++){for(;A[M+1]<R;)M++;const z=x[M],j=R-z;y[i+R*d]=_[z]+j*j}}class Le{constructor(i,d,p){this.requestManager=i,this.localIdeographFontFamily=d,this.entries={},this.lang=p}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,(function*(){const d=[];for(const x in i)for(const A of i[x])d.push(this._getAndCacheGlyphsPromise(x,A));const p=yield Promise.all(d),_={};for(const{stack:x,id:A,glyph:R}of p)_[x]||(_[x]={}),_[x][A]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return _}))}_getAndCacheGlyphsPromise(i,d){return a._(this,void 0,void 0,(function*(){let p=this.entries[i];p||(p=this.entries[i]={glyphs:{},requests:{},ranges:{}});let _=p.glyphs[d];if(_!==void 0)return{stack:i,id:d,glyph:_};if(_=this._tinySDF(p,i,d),_)return p.glyphs[d]=_,{stack:i,id:d,glyph:_};const x=Math.floor(d/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[x])return{stack:i,id:d,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[x]){const R=Le.loadGlyphRange(i,x,this.url,this.requestManager);p.requests[x]=R}const A=yield p.requests[x];for(const R in A)this._doesCharSupportLocalGlyph(+R)||(p.glyphs[+R]=A[+R]);return p.ranges[x]=!0,{stack:i,id:d,glyph:A[d]||null}}))}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))||a.u["CJK Unified Ideographs"](i)||a.u["Hangul Syllables"](i)||a.u.Hiragana(i)||a.u.Katakana(i)||a.u["CJK Symbols and Punctuation"](i)||a.u["Halfwidth and Fullwidth Forms"](i))}_tinySDF(i,d,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let x=i.tinySDF;if(!x){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),x=i.tinySDF=new Le.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:_,fontWeight:R})}const A=x.draw(String.fromCharCode(p));return{id:p,bitmap:new a.q({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}Le.loadGlyphRange=function(y,i,d,p){return a._(this,void 0,void 0,(function*(){const _=256*i,x=_+255,A=p.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${_}-${x}`),"Glyphs"),R=yield a.n(A,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${i}, ${_}-${x}`);const M={};for(const z of a.o(R.data))M[z.id]=z;return M}))},Le.TinySDF=class{constructor({fontSize:y=24,buffer:i=3,radius:d=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:A="normal",lang:R=null}={}){this.buffer=i,this.cutoff=p,this.radius=d,this.lang=R;const M=this.size=y+4*i,z=this._createCanvas(M),j=this.ctx=z.getContext("2d",{willReadFrequently:!0});j.font=`${A} ${x} ${y}px ${_}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const i=document.createElement("canvas");return i.width=i.height=y,i}draw(y){const{width:i,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(y),A=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-_))),M=Math.min(this.size-this.buffer,A+Math.ceil(p)),z=R+2*this.buffer,j=M+2*this.buffer,X=Math.max(z*j,0),H=new Uint8ClampedArray(X),Q={data:H,width:z,height:j,glyphWidth:R,glyphHeight:M,glyphTop:A,glyphLeft:0,glyphAdvance:i};if(R===0||M===0)return Q;const{ctx:re,buffer:he,gridInner:de,gridOuter:ge}=this;this.lang&&(re.lang=this.lang),re.clearRect(he,he,R,M),re.fillText(y,he,he+A);const Pe=re.getImageData(he,he,R,M);ge.fill(_e,0,X),de.fill(0,0,X);for(let De=0;De<M;De++)for(let Ee=0;Ee<R;Ee++){const Oe=Pe.data[4*(De*R+Ee)+3]/255;if(Oe===0)continue;const Ue=(De+he)*z+Ee+he;if(Oe===1)ge[Ue]=0,de[Ue]=_e;else{const Me=.5-Oe;ge[Ue]=Me>0?Me*Me:0,de[Ue]=Me<0?Me*Me:0}}Ne(ge,0,0,z,j,z,this.f,this.v,this.z),Ne(de,he,he,R,M,z,this.f,this.v,this.z);for(let De=0;De<X;De++){const Ee=Math.sqrt(ge[De])-Math.sqrt(de[De]);H[De]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return Q}};class tt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,d){return a.B(i.expression.evaluate(d))}interpolate(i,d,p){return{x:a.C.number(i.x,d.x,p),y:a.C.number(i.y,d.y,p),z:a.C.number(i.z,d.z,p)}}}let Ye;class rt extends a.E{constructor(i){super(),Ye=Ye||new a.r({anchor:new a.D(a.v.light.anchor),position:new tt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(Ye,void 0),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,d={}){if(!this._validate(a.x,i,d))for(const p in i){const _=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,d,p){return(!p||p.validate!==!1)&&a.y(this,i.call(a.z,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const it=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Ct extends a.E{constructor(i){super(),this._transitionable=new a.t(it,void 0),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(i,d={}){if(!this._validate(a.G,i,d)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in i){const _=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,d,p={}){return p?.validate!==!1&&a.y(this,i.call(a.z,a.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class Mt{constructor(i,d){this.width=i,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,d){const p=i.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(i,d)),this.dashEntry[p]}getDashRanges(i,d,p){const _=[];let x=i.length%2==1?-i[i.length-1]*p:0,A=i[0]*p,R=!0;_.push({left:x,right:A,isDash:R,zeroLength:i[0]===0});let M=i[0];for(let z=1;z<i.length;z++){R=!R;const j=i[z];x=M*p,M+=j,A=M*p,_.push({left:x,right:A,isDash:R,zeroLength:j===0})}return _}addRoundDash(i,d,p){const _=d/2;for(let x=-p;x<=p;x++){const A=this.width*(this.nextRow+p+x);let R=0,M=i[R];for(let z=0;z<this.width;z++){z/M.right>1&&(M=i[++R]);const j=Math.abs(z-M.left),X=Math.abs(z-M.right),H=Math.min(j,X);let Q;const re=x/p*(_+1);if(M.isDash){const he=_-Math.abs(re);Q=Math.sqrt(H*H+he*he)}else Q=_-Math.sqrt(H*H+re*re);this.data[A+z]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(i){for(let R=i.length-1;R>=0;--R){const M=i[R],z=i[R+1];M.zeroLength?i.splice(R,1):z&&z.isDash===M.isDash&&(z.left=M.left,i.splice(R,1))}const d=i[0],p=i[i.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const _=this.width*this.nextRow;let x=0,A=i[x];for(let R=0;R<this.width;R++){R/A.right>1&&(A=i[++x]);const M=Math.abs(R-A.left),z=Math.abs(R-A.right),j=Math.min(M,z);this.data[_+R]=Math.max(0,Math.min(255,(A.isDash?j:-j)+128))}}addDash(i,d){const p=d?7:0,_=2*p+1;if(this.nextRow+_>this.height)return a.w("LineAtlas out of space"),null;let x=0;for(let R=0;R<i.length;R++)x+=i[R];if(x!==0){const R=this.width/x,M=this.getDashRanges(i,this.width,R);d?this.addRoundDash(M,R,p):this.addRegularDash(M)}const A={y:this.nextRow+p,height:2*p,width:x};return this.nextRow+=_,this.dirty=!0,A}bind(i){const d=i.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const jt="maplibre_preloaded_worker_pool";class Gt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Gt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}const Or=Math.floor(I.hardwareConcurrency/2);let _r,wr;function Dr(){return _r||(_r=new Gt),_r}Gt.workerCount=a.H(globalThis)?Math.max(Math.min(Or,3),1):1;class Et{constructor(i,d){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=d;const p=this.workerPool.acquire(d);for(let _=0;_<p.length;_++){const x=new a.J(p[_],d);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,d){const p=[];for(const _ of this.actors)p.push(_.sendAsync({type:i,data:d}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,d){for(const p of this.actors)p.registerMessageHandler(i,d)}}function vt(){return wr||(wr=new Et(Dr(),a.K),wr.registerMessageHandler("GR",((y,i,d)=>a.m(i,d)))),wr}function Pr(y,i){const d=a.L();return a.M(d,d,[1,1,0]),a.N(d,d,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?a.O(d,d,y.calculatePosMatrix(i.toUnwrapped())):d}function yr(y,i,d,p,_,x,A){var R;const M=(function(H,Q,re){if(H)for(const he of H){const de=Q[he];if(de&&de.source===re&&de.type==="fill-extrusion")return!0}else for(const he in Q){const de=Q[he];if(de.source===re&&de.type==="fill-extrusion")return!0}return!1})((R=_?.layers)!==null&&R!==void 0?R:null,i,y.id),z=x.maxPitchScaleFactor(),j=y.tilesIn(p,z,M);j.sort(Ar);const X=[];for(const H of j)X.push({wrappedTileID:H.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(i,d,y._state,H.queryGeometry,H.cameraQueryGeometry,H.scale,_,x,z,Pr(y.transform,H.tileID),A?(Q,re)=>A(H.tileID,Q,re):void 0)});return(function(H,Q){for(const re in H)for(const he of H[re])br(he,Q);return H})((function(H){const Q={},re={};for(const he of H){const de=he.queryResults,ge=he.wrappedTileID,Pe=re[ge]=re[ge]||{};for(const De in de){const Ee=de[De],Oe=Pe[De]=Pe[De]||{},Ue=Q[De]=Q[De]||[];for(const Me of Ee)Oe[Me.featureIndex]||(Oe[Me.featureIndex]=!0,Ue.push(Me))}}return Q})(X),y)}function Ar(y,i){const d=y.tileID,p=i.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}function br(y,i){const d=y.feature,p=i.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=p}function lr(y,i,d){return a._(this,void 0,void 0,(function*(){let p=y;if(y.url?p=(yield a.j(i.transformRequest(y.url,"Source"),d)).data:yield I.frameAsync(d),!p)return null;const _=a.Q(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(_.vectorLayerIds=p.vector_layers.map((x=>x.id))),_}))}class ut{constructor(i,d){i&&(d?this.setSouthWest(i).setNorthEast(d):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}extend(i){const d=this._sw,p=this._ne;let _,x;if(i instanceof a.S)_=i,x=i;else{if(!(i instanceof ut))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ut.convert(i)):this.extend(a.S.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.S.convert(i)):this;if(_=i._sw,x=i._ne,!_||!x)return this}return d||p?(d.lng=Math.min(_.lng,d.lng),d.lat=Math.min(_.lat,d.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new a.S(_.lng,_.lat),this._ne=new a.S(x.lng,x.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:d,lat:p}=a.S.convert(i);let _=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_}static convert(i){return i instanceof ut?i:i&&new ut(i)}static fromLngLat(i,d=0){const p=360*d/40075017,_=p/Math.cos(Math.PI/180*i.lat);return new ut(new a.S(i.lng-_,i.lat-p),new a.S(i.lng+_,i.lat+p))}adjustAntiMeridian(){const i=new a.S(this._sw.lng,this._sw.lat),d=new a.S(this._ne.lng,this._ne.lat);return new ut(i,i.lng>d.lng?new a.S(d.lng+360,d.lat):d)}}class Zt{constructor(i,d,p){this.bounds=ut.convert(this.validateBounds(i)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const d=Math.pow(2,i.z),p=Math.floor(a.V(this.bounds.getWest())*d),_=Math.floor(a.U(this.bounds.getNorth())*d),x=Math.ceil(a.V(this.bounds.getEast())*d),A=Math.ceil(a.U(this.bounds.getSouth())*d);return i.x>=p&&i.x<x&&i.y>=_&&i.y<A}}class dr extends a.E{constructor(i,d,p,_){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(d,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield lr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new Zt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(i))}}))}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,(function*(){const d=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(d,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};p.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise(((x,A)=>{i.reloadPromise={resolve:x,reject:A}}))}else i.actor=this.dispatcher.getActor(),_="LT";i.abortController=new AbortController;try{const x=yield i.actor.sendAsync({type:_,data:p},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,x)}catch(x){if(delete i.abortController,i.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(i,null)}}))}_afterTileLoadWorkerResponse(i,d){if(d&&d.resourceTiming&&(i.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&i.setExpiryData(d),i.loadVectorData(d,this.map.painter),i.reloadPromise){const p=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(p.resolve).catch(p.reject)}}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class er extends a.E{constructor(i,d,p,_){super(),this.id=i,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},d),a.e(this,a.Q(d,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,(function*(i=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield lr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,d&&(a.e(this,d),d.bounds&&(this.tileBounds=new Zt(d.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(d){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(d))}}))}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,(function*(){const d=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const p=yield G.getImage(this.map._requestManager.transformRequest(d,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const _=this.map.painter.context,x=_.gl,A=p.data;i.texture=this.map.painter.getTileTexture(A.width),i.texture?i.texture.update(A,{useMipmap:!0}):(i.texture=new a.T(_,A,x.RGBA,{useMipmap:!0}),i.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}}))}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)}))}hasTransition(){return!1}}class Bt extends er{constructor(i,d,p,_){super(i,d,p,_),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(i){return a._(this,void 0,void 0,(function*(){const d=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(d,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const _=yield G.getImage(p,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(_&&_.data){const x=_.data;this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&i.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const A=a.b(x)&&a.W()?x:yield this.readImageNow(x),R={type:this.type,uid:i.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:R});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(_){if(delete i.abortController,i.aborted)i.state="unloaded";else if(_)throw i.state="errored",_}}))}readImageNow(i){return a._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&a.X()){const d=i.width+2,p=i.height+2;try{return new a.R({width:d,height:p},yield a.Y(i,-1,-1,d,p))}catch{}}return I.getImageData(i,1)}))}_getNeighboringTiles(i){const d=i.canonical,p=Math.pow(2,d.z),_=(d.x-1+p)%p,x=d.x===0?i.wrap-1:i.wrap,A=(d.x+1+p)%p,R=d.x+1===p?i.wrap+1:i.wrap,M={};return M[new a.Z(i.overscaledZ,x,d.z,_,d.y).key]={backfilled:!1},M[new a.Z(i.overscaledZ,R,d.z,A,d.y).key]={backfilled:!1},d.y>0&&(M[new a.Z(i.overscaledZ,x,d.z,_,d.y-1).key]={backfilled:!1},M[new a.Z(i.overscaledZ,i.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},M[new a.Z(i.overscaledZ,R,d.z,A,d.y-1).key]={backfilled:!1}),d.y+1<p&&(M[new a.Z(i.overscaledZ,x,d.z,_,d.y+1).key]={backfilled:!1},M[new a.Z(i.overscaledZ,i.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},M[new a.Z(i.overscaledZ,R,d.z,A,d.y+1).key]={backfilled:!1}),M}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))}))}}class mr extends a.E{constructor(i,d,p,_){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=p.getActor(),this.setEventedParent(_),this._data=d.data,this._options=a.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(i){return i*(a.$/this.tileSize)}_getClusterMaxZoom(i){const d=i?Math.round(i):this.maxzoom-1;return Number.isInteger(i)||i===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${i}" rounded to "${d}"`),d}load(){return a._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._pendingWorkerUpdate={data:i},this._updateWorkerData(),this}updateData(i){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,i),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,(function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})}))}getCoordinatesFromGeometry(i){return i.type==="GeometryCollection"?i.geometries.map((d=>d.coordinates)).flat(1/0):i.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,(function*(){const i=new ut,d=yield this.getData();let p;switch(d.type){case"FeatureCollection":p=d.features.map((_=>this.getCoordinatesFromGeometry(_.geometry))).flat(1/0);break;case"Feature":p=this.getCoordinatesFromGeometry(d.geometry);break;default:p=this.getCoordinatesFromGeometry(d)}if(p.length==0)return i;for(let _=0;_<p.length-1;_+=2)i.extend([p[_],p[_+1]]);return i}))}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(i.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,d,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:d,offset:p}})}_updateWorkerData(){return a._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void a.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:i,diff:d}=this._pendingWorkerUpdate,p=a.e({type:this.type},this.workerOptions);i?(typeof i=="string"?(p.request=this.map._requestManager.transformRequest(I.resolveURL(i),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingWorkerUpdate.data=void 0):d&&(p.dataDiff=d,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:p});if(this._isUpdatingWorker=!1,this._removed||_.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=_.data;let x=null;_.resourceTiming&&_.resourceTiming[this.id]&&(x=_.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&a.e(A,{resourceTiming:x}),this.fire(new a.l("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(_){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(_))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(i){return a._(this,void 0,void 0,(function*(){const d=i.actor?"RT":"LT";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.abortController=new AbortController;const _=yield this.actor.sendAsync({type:d,data:p},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(_,this.map.painter,d==="RT")}))}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Tr extends a.E{constructor(i,d,p,_){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(i){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield G.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,i&&(this.coordinates=i),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new a.k(d))}}))}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const d=i.map(a.a1.fromLngLat);var p;return this.tileID=(function(_){const x=a.a2.fromPoints(_),A=x.width(),R=x.height(),M=Math.max(A,R),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),j=Math.pow(2,z);return new a.a4(z,Math.floor((x.minX+x.maxX)/2*j),Math.floor((x.minY+x.maxY)/2*j))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((_=>this.tileID.getTilePoint(_)._round())),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,d=i.gl;this.texture||(this.texture=new a.T(i,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(i){const{minX:d,minY:p,maxX:_,maxY:x}=a.a2.fromPoints(i),A={};for(let R=0;R<=a.a3;R++){const M=Math.pow(2,R),z=Math.floor(d*M),j=Math.floor(p*M),X=Math.floor(_*M),H=Math.floor(x*M);A[R]={minTileX:z,minTileY:j,maxTileX:X,maxTileY:H}}return A}}class fr extends Tr{constructor(i,d,p,_){super(i,d,p,_),this.roundZoom=!0,this.type="video",this.options=d}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const d of i.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield a.a5(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new a.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const d=this.video.seekable;i<d.start(0)||i>d.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,d=i.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(i,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nr extends Tr{constructor(i,d,p,_){super(i,d,p,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((A=>typeof A!="number"))))||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,p=d.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(d,this.canvas,p.RGBA,{premultiply:!0});let _=!1;for(const x in this.tiles){const A=this.tiles[x];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const rr={},Nr=y=>{switch(y){case"geojson":return mr;case"image":return Tr;case"raster":return er;case"raster-dem":return Bt;case"vector":return dr;case"video":return fr;case"canvas":return nr}return rr[y]},Cr="RTLPluginLoaded";class qr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vt()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,(function*(d,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=I.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return a._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(Cr))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ir=null;function or(){return ir||(ir=new qr),ir}var Re,Y;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(Re||(Re={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(Y||(Y={}));class ee{constructor(i,d){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=i,this.uid=a.a7(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(i){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(i||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:i,fadingDirection:d,fadingParentID:p,fadeEndTime:_}){this.resetFadeLogic(),this.fadingRole=i,this.fadingDirection=d,this.fadingParentID=p,this.fadeEndTime=_}setSelfFadeLogic(i){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=i}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=N(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=(function(_,x){const A={};if(!x)return A;for(const R of _){const M=R.layerIds.map((z=>x.getLayer(z))).filter(Boolean);if(M.length!==0){R.layers=M,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((z=>M.filter((j=>j.id===z))[0])));for(const z of M)A[z.id]=R}}return A})(i.buckets,d?.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof a.a9){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof a.a9&&x.hasRTLText){this.hasRTLText=!0,or().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(x))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),this.dashPositions=i.dashPositions}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(i)}const d=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(i,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(i,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,d,p,_,x,A,R,M,z,j,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:A,tileSize:this.tileSize,pixelPosMatrix:j,transform:M,params:R,queryPadding:this.queryPadding*z,getElevation:X},i,d,p):{}}querySourceFeatures(i,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",A=_._geojsonTileLayer||_[x];if(!A)return;const R=a.aa(d?.filter,d?.globalState),{z:M,x:z,y:j}=this.tileID.canonical,X={z:M,x:z,y:j};for(let H=0;H<A.length;H++){const Q=A.feature(H);if(R.needGeometry){const de=a.ab(Q,!0);if(!R.filter(new a.F(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!R.filter(new a.F(this.tileID.overscaledZ),Q))continue;const re=p.getId(Q,x),he=new a.ac(Q,M,z,j,re);he.tile=X,i.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const d=this.expirationTime;if(i.cacheControl){const p=a.ad(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const x=this.expirationTime-d;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const x=this.buckets[_],A=x.layers[0].sourceLayer||"_geojsonTileLayer",R=p[A],M=i[A];if(!R||!M||Object.keys(M).length===0)continue;x.update(M,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=d&&d.style&&d.style.getLayer(_);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(x)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(i){this.symbolFadeHoldUntil=N()+i}setDependencies(i,d){const p={};for(const _ of d)p[_]=!0;this.dependencies[i]=p}hasDependency(i,d){for(const p of i){const _=this.dependencies[p];if(_){for(const x of d)if(_[x])return!0}}return!1}}class ie{constructor(i,d){this.max=i,this.onRemove=d,this.reset()}reset(){for(const i in this.data)for(const d of this.data[i])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(i,d,p){const _=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:d,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout((()=>{this.remove(i,x)}),p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const d=this.data[i].shift();return d.timeout&&clearTimeout(d.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),d.value}getByKey(i){const d=this.data[i];return d?d[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,d){if(!this.has(i))return this;const p=i.wrapped().key,_=d===void 0?0:this.data[p].indexOf(d),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(i){const d=[];for(const p in this.data)for(const _ of this.data[p])i(_.value)||d.push(_);for(const p of d)this.remove(p.value.tileID,p)}}class Te{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,d,p){const _=String(d);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][_]=this.stateChanges[i][_]||{},a.e(this.stateChanges[i][_],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const x in this.state[i])x!==_&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][_]===null){this.deletedStates[i][_]={};for(const x in this.state[i][_])p[x]||(this.deletedStates[i][_][x]=null)}else for(const x in p)this.deletedStates[i]&&this.deletedStates[i][_]&&this.deletedStates[i][_][x]===null&&delete this.deletedStates[i][_][x]}removeFeatureState(i,d,p){if(this.deletedStates[i]===null)return;const _=String(d);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&d!==void 0)this.deletedStates[i][_]!==null&&(this.deletedStates[i][_]=this.deletedStates[i][_]||{},this.deletedStates[i][_][p]=null);else if(d!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][_])for(p in this.deletedStates[i][_]={},this.stateChanges[i][_])this.deletedStates[i][_][p]=null;else this.deletedStates[i][_]=null;else this.deletedStates[i]=null}getState(i,d){const p=String(d),_=a.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const x=this.deletedStates[i][d];if(x===null)return{};for(const A in x)delete _[A]}return _}initializeTileState(i,d){i.setFeatureState(this.state,d)}coalesceChanges(i,d){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const A in this.stateChanges[_])this.state[_][A]||(this.state[_][A]={}),a.e(this.state[_][A],this.stateChanges[_][A]),x[A]=this.state[_][A];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const A in this.state[_])x[A]={},this.state[_][A]={};else for(const A in this.deletedStates[_]){if(this.deletedStates[_][A]===null)this.state[_][A]={};else for(const R of Object.keys(this.deletedStates[_][A]))delete this.state[_][A][R];x[A]=this.state[_][A]}p[_]=p[_]||{},a.e(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in i)i[_].setFeatureState(p,d)}}const Ce=89.25;function Be(y,i){const d=a.ae(i.lat,-a.af,a.af);return new a.P(a.V(i.lng)*y,a.U(d)*y)}function Ge(y,i){return new a.a1(i.x/y,i.y/y).toLngLat()}function Ve(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(a.ag(90-y.pitch)),Math.tan(a.ag(Ce-y.pitch)))}function nt(y,i){const d=y.canonical,p=i/a.ah(d.z),_=d.x+Math.pow(2,d.z)*y.wrap,x=a.ai(new Float64Array(16));return a.M(x,x,[_*p,d.y*p,0]),a.N(x,x,[p/a.$,p/a.$,1]),x}function At(y,i,d,p,_){const x=a.a1.fromLngLat(y,i),A=_*a.aj(1,y.lat),R=A*Math.cos(a.ag(d)),M=Math.sqrt(A*A-R*R),z=M*Math.sin(a.ag(-p)),j=M*Math.cos(a.ag(-p));return new a.a1(x.x+z,x.y+j,x.z+R)}function bt(y,i,d){const p=i.intersectsFrustum(y);if(!d||p===0)return p;const _=i.intersectsPlane(d);return _===0?0:p===2&&_===2?2:1}function ur(y,i,d){let p=0;const _=(d-i)/10;for(let x=0;x<10;x++)p+=_*Math.pow(Math.cos(i+(x+.5)/10*(d-i)),y);return p}function Xe(y,i){return function(d,p,_,x,A){const R=2*((y-1)/a.ak(Math.cos(a.ag(Ce-A))/Math.cos(a.ag(Ce)))-1),M=Math.acos(_/x),z=2*ur(R-1,0,a.ag(A/2)),j=Math.min(a.ag(Ce),M+a.ag(A/2)),X=ur(R-1,Math.min(j,M-a.ag(A/2)),j),H=Math.atan(p/_),Q=Math.hypot(p,_);let re=d;return re+=a.ak(x/Q/Math.max(.5,Math.cos(a.ag(A/2)))),re+=R*a.ak(Math.cos(H))/2,re-=a.ak(Math.max(1,X/z/i))/2,re}}const Xt=Xe(9.314,3);function xr(y,i){const d=(i.roundZoom?Math.round:Math.floor)(y.zoom+a.ak(y.tileSize/i.tileSize));return Math.max(0,d)}function Lt(y,i){const d=y.getCameraFrustum(),p=y.getClippingPlane(),_=y.screenPointToMercatorCoordinate(y.getCameraPoint()),x=a.a1.fromLngLat(y.center,y.elevation);_.z=x.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const A=y.getCoveringTilesDetailsProvider(),R=A.allowVariableZoom(y,i),M=xr(y,i),z=i.minzoom||0,j=i.maxzoom!==void 0?i.maxzoom:y.maxZoom,X=Math.min(Math.max(0,M),j),H=Math.pow(2,X),Q=[H*_.x,H*_.y,0],re=[H*x.x,H*x.y,0],he=Math.hypot(x.x-_.x,x.y-_.y),de=Math.abs(x.z-_.z),ge=Math.hypot(he,de),Pe=Oe=>({zoom:0,x:0,y:0,wrap:Oe,fullyVisible:!1}),De=[],Ee=[];if(y.renderWorldCopies&&A.allowWorldCopies())for(let Oe=1;Oe<=3;Oe++)De.push(Pe(-Oe)),De.push(Pe(Oe));for(De.push(Pe(0));De.length>0;){const Oe=De.pop(),Ue=Oe.x,Me=Oe.y;let He=Oe.fullyVisible;const dt={x:Ue,y:Me,z:Oe.zoom},ot=A.getTileBoundingVolume(dt,Oe.wrap,y.elevation,i);if(!He){const $t=bt(d,ot,p);if($t===0)continue;He=$t===2}const lt=A.distanceToTile2d(_.x,_.y,dt,ot);let ft=M;R&&(ft=(i.calculateTileZoom||Xt)(y.zoom+a.ak(y.tileSize/i.tileSize),lt,de,ge,y.fov)),ft=(i.roundZoom?Math.round:Math.floor)(ft),ft=Math.max(0,ft);const Vt=Math.min(ft,j);if(Oe.wrap=A.getWrap(x,dt,Oe.wrap),Oe.zoom>=Vt){if(Oe.zoom<z)continue;const $t=X-Oe.zoom,Dt=Q[0]-.5-(Ue<<$t),Sr=Q[1]-.5-(Me<<$t),$r=i.reparseOverscaled?Math.max(Oe.zoom,ft):Oe.zoom;Ee.push({tileID:new a.Z(Oe.zoom===j?$r:Oe.zoom,Oe.wrap,Oe.zoom,Ue,Me),distanceSq:a.al([re[0]-.5-Ue,re[1]-.5-Me]),tileDistanceToCamera:Math.sqrt(Dt*Dt+Sr*Sr)})}else for(let $t=0;$t<4;$t++)De.push({zoom:Oe.zoom+1,x:(Ue<<1)+$t%2,y:(Me<<1)+($t>>1),wrap:Oe.wrap,fullyVisible:He})}return Ee.sort(((Oe,Ue)=>Oe.distanceSq-Ue.distanceSq)).map((Oe=>Oe.tileID))}const gr=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Lr extends a.E{constructor(i,d,p){super(),this.id=i,this.dispatcher=p,this.on("data",(_=>this._dataHandler(_))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((_,x,A,R)=>{const M=new(Nr(x.type))(_,x,A,R);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return M})(i,d,p,this),this._tiles={},this._cache=new ie(0,(_=>this._unloadTile(_))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Te,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const d=this._tiles[i];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,d,p){return a._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,d,p)}catch(_){i.state="errored",_.status!==404?this._source.fire(new a.k(_,{tile:i})):this.update(this.transform,this.terrain)}}))}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.l("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(i),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((i=>i.tileID)).sort(je).map((i=>i.key))}getRenderableIds(i){const d=[];for(const p in this._tiles)this._isIdRenderable(p,i)&&d.push(this._tiles[p]);return i?d.sort(((p,_)=>{const x=p.tileID,A=_.tileID,R=new a.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians),M=new a.P(A.canonical.x,A.canonical.y)._rotate(-this.transform.bearingInRadians);return x.overscaledZ-A.overscaledZ||M.y-R.y||M.x-R.x})).map((p=>p.tileID.key)):d.map((p=>p.tileID)).sort(je).map((p=>p.key))}hasRenderableParent(i){const d=i.overscaledZ-1;if(d>=this._source.minzoom){const p=this._getLoadedTile(i.scaledTo(d));if(p)return this._isIdRenderable(p.tileID.key)}return!1}_isIdRenderable(i,d=!1){var p;return(p=this._tiles[i])===null||p===void 0?void 0:p.isRenderable(d)}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)i?this._reloadTile(d,"expired"):this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")}}_reloadTile(i,d){return a._(this,void 0,void 0,(function*(){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=d),yield this._loadTile(p,i,d))}))}_tileLoaded(i,d,p){i.timeAdded=N(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(d,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const x=d[_];if(i.neighboringTiles&&i.neighboringTiles[x]){const A=this.getTileByID(x);p(i,A),p(A,i)}}function p(_,x){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let A=x.tileID.canonical.x-_.tileID.canonical.x;const R=x.tileID.canonical.y-_.tileID.canonical.y,M=Math.pow(2,_.tileID.canonical.z),z=x.tileID.key;A===0&&R===0||Math.abs(R)>1||(Math.abs(A)>1&&(Math.abs(A+M)===1?A+=M:Math.abs(A-M)===1&&(A-=M)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,A,R),_.neighboringTiles&&_.neighboringTiles[z]&&(_.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,d){const p=Object.values(i),_=this._getLoadedDescendents(p),x={};for(const A of p){const R=_[A.key];if(!R?.length){x[A.key]=A;continue}const M=A.overscaledZ+Lr.maxUnderzooming,z=R.filter((H=>H.tileID.overscaledZ<=M));if(!z.length){x[A.key]=A;continue}const j=Math.min(...z.map((H=>H.tileID.overscaledZ))),X=z.filter((H=>H.tileID.overscaledZ===j)).map((H=>H.tileID));for(const H of X)d[H.key]=H;this._areDescendentsComplete(X,j,A.overscaledZ)||(x[A.key]=A)}return x}_getLoadedDescendents(i){var d;const p={};for(const _ in this._tiles){const x=this._tiles[_];if(x.hasData())for(const A of i)x.tileID.isChildOf(A)&&(p[d=A.key]||(p[d]=[])).push(x)}return p}_areDescendentsComplete(i,d,p){return i.length===1&&i[0].isOverscaled()?i[0].overscaledZ===d:Math.pow(4,d-p)===i.length}_getLoadedTile(i){const d=this._tiles[i.key];return d?.hasData()?d:null}updateCacheSize(i){const d=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,_=Math.floor(d*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(i){const d=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,d){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),p[x.tileID.key]=x}this._tiles=p,this._resetTileReloadTimers()}}update(i,d){if(!this._sourceLoaded||this._paused)return;let p;this.transform=i,this.terrain=d,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map((M=>new a.Z(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y))):(p=Lt(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter((M=>this._source.hasTile(M))))):p=[],this.usedForTerrain&&(p=this._addTerrainIdealTiles(p));const _=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=xr(i,this._source),A=this._updateRetainedTiles(p,x),R=ht(this._source.type);R&&this._rasterFadeDuration>0&&!d&&this._updateFadingTiles(p,A),R?this._cleanUpRasterTiles(A):this._cleanUpVectorTiles(A)}_cleanUpRasterTiles(i){for(const d in this._tiles)i[d]||this._removeTile(d)}_cleanUpVectorTiles(i){for(const d in this._tiles){const p=this._tiles[d];i[d]?p.clearSymbolFadeHold():p.hasSymbolBuckets?p.holdingForSymbolFade()?p.symbolFadeFinished()&&this._removeTile(d):p.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(d)}}_addTerrainIdealTiles(i){const d=[];for(const p of i)if(p.canonical.z>this._source.minzoom){const _=p.scaledTo(p.canonical.z-1);d.push(_);const x=p.scaledTo(Math.max(this._source.minzoom,Math.min(p.canonical.z,5)));d.push(x)}return i.concat(d)}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForSymbolFade()&&this._removeTile(i)}_updateRetainedTiles(i,d){var p;const _={},x={},A=Math.max(d-Lr.maxOverzooming,this._source.minzoom);let R={};for(const M of i){const z=this._addTile(M);_[M.key]=M,z.hasData()||(R[M.key]=M)}R=this._retainLoadedChildren(R,_);for(const M in R){const z=R[M];let j=this._tiles[M],X=j?.wasRequested();for(let H=z.overscaledZ-1;H>=A;--H){const Q=z.scaledTo(H);if(x[Q.key])break;if(x[Q.key]=!0,j=this.getTile(Q),!j&&X&&(j=this._addTile(Q)),j){const re=j.hasData();if((re||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||X)&&(_[Q.key]=Q),X=j.wasRequested(),re)break}}}return _}_updateFadingTiles(i,d){const p=N(),_=a.am(i);for(const x of i){const A=this._tiles[x.key];A.fadingDirection!==Y.Departing&&A.fadeOpacity!==0||A.resetFadeLogic(),this._updateFadingAncestor(A,d,p)||this._updateFadingDescendents(A,d,p)||this._updateFadingEdge(A,_,p)||A.resetFadeLogic()}}_updateFadingAncestor(i,d,p){if(!i.hasData())return!1;const{tileID:_,fadingRole:x,fadingDirection:A,fadingParentID:R}=i;if(x===Re.Base&&A===Y.Incoming&&R)return d[R.key]=R,!0;const M=Math.max(_.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let z=_.overscaledZ-1;z>=M;z--){const j=_.scaledTo(z),X=this._getLoadedTile(j);if(X)return i.setCrossFadeLogic({fadingRole:Re.Base,fadingDirection:Y.Incoming,fadingParentID:X.tileID,fadeEndTime:p+this._rasterFadeDuration}),X.setCrossFadeLogic({fadingRole:Re.Parent,fadingDirection:Y.Departing,fadeEndTime:p+this._rasterFadeDuration}),d[j.key]=j,!0}return!1}_updateFadingDescendents(i,d,p){if(!i.hasData())return!1;const _=i.tileID.children(this._source.maxzoom);let x=this._updateFadingChildren(i,_,d,p);if(x)return!0;for(const A of _){const R=A.children(this._source.maxzoom);this._updateFadingChildren(i,R,d,p)&&(x=!0)}return x}_updateFadingChildren(i,d,p,_){if(d[0].overscaledZ>=this._source.maxzoom)return!1;let x=!1;for(const A of d){const R=this._getLoadedTile(A);if(!R)continue;const{fadingRole:M,fadingDirection:z,fadingParentID:j}=R;M===Re.Base&&z===Y.Departing&&j||(R.setCrossFadeLogic({fadingRole:Re.Base,fadingDirection:Y.Departing,fadingParentID:i.tileID,fadeEndTime:_+this._rasterFadeDuration}),i.setCrossFadeLogic({fadingRole:Re.Parent,fadingDirection:Y.Incoming,fadeEndTime:_+this._rasterFadeDuration})),p[A.key]=A,x=!0}return x}_updateFadingEdge(i,d,p){const _=i.tileID;return!!i.selfFading||!i.hasData()&&!!d.has(_)&&(i.setSelfFadeLogic(p+this._rasterFadeDuration),!0)}_addTile(i){let d=this._tiles[i.key];if(d)return d;d=this._cache.getAndRemove(i),d&&(d.resetFadeLogic(),this._setTileReloadTimer(i.key,d),d.tileID=i,this._state.initializeTileState(d,this.map?this.map.painter:null));const p=d;return d||(d=new ee(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(d,i.key,d.state)),d.uses++,this._tiles[i.key]=d,p||this._source.fire(new a.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(i,d){this._clearTileReloadTimer(i);const p=d.getExpiryTimeout();p&&(this._timers[i]=setTimeout((()=>{this._reloadTile(i,"expired"),delete this._timers[i]}),p))}_clearTileReloadTimer(i){const d=this._timers[i];d&&(clearTimeout(d),delete this._timers[i])}_resetTileReloadTimers(){for(const i in this._timers)clearTimeout(this._timers[i]),delete this._timers[i];for(const i in this._tiles)this._setTileReloadTimer(i,this._tiles[i])}refreshTiles(i){for(const d in this._tiles)(this._isIdRenderable(d)||this._tiles[d].state=="errored")&&i.some((p=>p.equals(this._tiles[d].tileID.canonical)))&&this._reloadTile(d,"expired")}_removeTile(i){const d=this._tiles[i];d&&(d.uses--,delete this._tiles[i],this._clearTileReloadTimer(i),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(i){i.dataType==="source"&&(i.sourceDataType!=="metadata"?i.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,d,p){const _=[],x=this.transform;if(!x)return _;const A=x.getCoveringTilesDetailsProvider().allowWorldCopies(),R=p?x.getCameraQueryGeometry(i):i,M=Q=>x.screenPointToMercatorCoordinate(Q,this.terrain),z=this.transformBbox(i,M,!A),j=this.transformBbox(R,M,!A),X=this.getIds(),H=a.a2.fromPoints(j);for(let Q=0;Q<X.length;Q++){const re=this._tiles[X[Q]];if(re.holdingForSymbolFade())continue;const he=A?[re.tileID]:[re.tileID.unwrapTo(-1),re.tileID.unwrapTo(0)],de=Math.pow(2,x.zoom-re.tileID.overscaledZ),ge=d*re.queryPadding*a.$/re.tileSize/de;for(const Pe of he){const De=H.map((Ee=>Pe.getTilePoint(new a.a1(Ee.x,Ee.y))));if(De.expandBy(ge),De.intersects(gr)){const Ee=z.map((Ue=>Pe.getTilePoint(Ue))),Oe=j.map((Ue=>Pe.getTilePoint(Ue)));_.push({tile:re,tileID:A?Pe:Pe.unwrapTo(0),queryGeometry:Ee,cameraQueryGeometry:Oe,scale:de})}}}return _}transformBbox(i,d,p){let _=i.map(d);if(p){const x=a.a2.fromPoints(i);x.shrinkBy(.001*Math.min(x.width(),x.height()));const A=x.map(d);a.a2.fromPoints(_).covers(A)||(_=_.map((R=>R.x>.5?new a.a1(R.x-1,R.y,R.z):R)))}return _}getVisibleCoordinates(i){const d=this.getRenderableIds(i).map((p=>this._tiles[p].tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){if(this._source.hasTransition())return!0;if(ht(this._source.type)&&this._rasterFadeDuration>0){const i=N();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=i)return!0}return!1}setRasterFadeDuration(i){this._rasterFadeDuration=i}setFeatureState(i,d,p){this._state.updateState(i=i||"_geojsonTileLayer",d,p)}removeFeatureState(i,d,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",d,p)}getFeatureState(i,d){return this._state.getState(i=i||"_geojsonTileLayer",d)}setDependencies(i,d,p){const _=this._tiles[i];_&&_.setDependencies(d,p)}reloadTilesForDependencies(i,d){for(const p in this._tiles)this._tiles[p].hasDependency(i,d)&&this._reloadTile(p,"reloading");this._cache.filter((p=>!p.hasDependency(i,d)))}}function je(y,i){const d=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return y.overscaledZ-i.overscaledZ||p-d||i.canonical.y-y.canonical.y||i.canonical.x-y.canonical.x}function ht(y){return y==="raster"||y==="image"||y==="video"}Lr.maxOverzooming=10,Lr.maxUnderzooming=3;class Rt{constructor(i,d){this.reset(i,d)}reset(i,d){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ae(i,0,1);let d=1,p=this._distances[d];const _=i*this.paddedLength+this.padding;for(;p<_&&d<this._distances.length;)p=this._distances[++d];const x=d-1,A=this._distances[x],R=p-A,M=R>0?(_-A)/R:0;return this.points[x].mult(1-M).add(this.points[d].mult(M))}}function gt(y,i){let d=!0;return y==="always"||y!=="never"&&i!=="never"||(d=!1),d}class Ut{constructor(i,d,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(d/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=d,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,d,p,_,x){this._forEachCell(d,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(i,d,p,_){this._forEachCell(d-_,p-_,d+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(d),this.circles.push(p),this.circles.push(_)}_insertBoxCell(i,d,p,_,x,A){this.boxCells[x].push(A)}_insertCircleCell(i,d,p,_,x,A){this.circleCells[x].push(A)}_query(i,d,p,_,x,A,R){if(p<0||i>this.width||_<0||d>this.height)return[];const M=[];if(i<=0&&d<=0&&this.width<=p&&this.height<=_){if(x)return[{key:null,x1:i,y1:d,x2:p,y2:_}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const j=this.circles[3*z],X=this.circles[3*z+1],H=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:j-H,y1:X-H,x2:j+H,y2:X+H})}}else this._forEachCell(i,d,p,_,this._queryCell,M,{hitTest:x,overlapMode:A,seenUids:{box:{},circle:{}}},R);return M}query(i,d,p,_){return this._query(i,d,p,_,!1,null)}hitTest(i,d,p,_,x,A){return this._query(i,d,p,_,!0,x,A).length>0}hitTestCircle(i,d,p,_,x){const A=i-p,R=i+p,M=d-p,z=d+p;if(R<0||A>this.width||z<0||M>this.height)return!1;const j=[];return this._forEachCell(A,M,R,z,this._queryCellCircle,j,{hitTest:!0,overlapMode:_,circle:{x:i,y:d,radius:p},seenUids:{box:{},circle:{}}},x),j.length>0}_queryCell(i,d,p,_,x,A,R,M){const{seenUids:z,hitTest:j,overlapMode:X}=R,H=this.boxCells[x];if(H!==null){const re=this.bboxes;for(const he of H)if(!z.box[he]){z.box[he]=!0;const de=4*he,ge=this.boxKeys[he];if(i<=re[de+2]&&d<=re[de+3]&&p>=re[de+0]&&_>=re[de+1]&&(!M||M(ge))&&(!j||!gt(X,ge.overlapMode))&&(A.push({key:ge,x1:re[de],y1:re[de+1],x2:re[de+2],y2:re[de+3]}),j))return!0}}const Q=this.circleCells[x];if(Q!==null){const re=this.circles;for(const he of Q)if(!z.circle[he]){z.circle[he]=!0;const de=3*he,ge=this.circleKeys[he];if(this._circleAndRectCollide(re[de],re[de+1],re[de+2],i,d,p,_)&&(!M||M(ge))&&(!j||!gt(X,ge.overlapMode))){const Pe=re[de],De=re[de+1],Ee=re[de+2];if(A.push({key:ge,x1:Pe-Ee,y1:De-Ee,x2:Pe+Ee,y2:De+Ee}),j)return!0}}}return!1}_queryCellCircle(i,d,p,_,x,A,R,M){const{circle:z,seenUids:j,overlapMode:X}=R,H=this.boxCells[x];if(H!==null){const re=this.bboxes;for(const he of H)if(!j.box[he]){j.box[he]=!0;const de=4*he,ge=this.boxKeys[he];if(this._circleAndRectCollide(z.x,z.y,z.radius,re[de+0],re[de+1],re[de+2],re[de+3])&&(!M||M(ge))&&!gt(X,ge.overlapMode))return A.push(!0),!0}}const Q=this.circleCells[x];if(Q!==null){const re=this.circles;for(const he of Q)if(!j.circle[he]){j.circle[he]=!0;const de=3*he,ge=this.circleKeys[he];if(this._circlesCollide(re[de],re[de+1],re[de+2],z.x,z.y,z.radius)&&(!M||M(ge))&&!gt(X,ge.overlapMode))return A.push(!0),!0}}}_forEachCell(i,d,p,_,x,A,R,M){const z=this._convertToXCellCoord(i),j=this._convertToYCellCoord(d),X=this._convertToXCellCoord(p),H=this._convertToYCellCoord(_);for(let Q=z;Q<=X;Q++)for(let re=j;re<=H;re++)if(x.call(this,i,d,p,_,this.xCellCount*re+Q,A,R,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,d,p,_,x,A){const R=_-i,M=x-d,z=p+A;return z*z>R*R+M*M}_circleAndRectCollide(i,d,p,_,x,A,R){const M=(A-_)/2,z=Math.abs(i-(_+M));if(z>M+p)return!1;const j=(R-x)/2,X=Math.abs(d-(x+j));if(X>j+p)return!1;if(z<=M||X<=j)return!0;const H=z-M,Q=X-j;return H*H+Q*Q<=p*p}}function kt(y,i,d){const p=a.L();if(!y){const{vecSouth:X,vecEast:H}=cr(i),Q=v();Q[0]=H[0],Q[1]=H[1],Q[2]=X[0],Q[3]=X[1],_=Q,(j=(A=(x=Q)[0])*(z=x[3])-(M=x[2])*(R=x[1]))&&(_[0]=z*(j=1/j),_[1]=-R*j,_[2]=-M*j,_[3]=A*j),p[0]=Q[0],p[1]=Q[1],p[4]=Q[2],p[5]=Q[3]}var _,x,A,R,M,z,j;return a.N(p,p,[1/d,1/d,1]),p}function $e(y,i,d,p){if(y){const _=a.L();if(!i){const{vecSouth:x,vecEast:A}=cr(d);_[0]=A[0],_[1]=A[1],_[4]=x[0],_[5]=x[1]}return a.N(_,_,[p,p,1]),_}return d.pixelsToClipSpaceMatrix}function cr(y){const i=Math.cos(y.rollInRadians),d=Math.sin(y.rollInRadians),p=Math.cos(y.pitchInRadians),_=Math.cos(y.bearingInRadians),x=Math.sin(y.bearingInRadians),A=a.ar();A[0]=-_*p*d-x*i,A[1]=-x*p*d+_*i;const R=a.as(A);R<1e-9?a.at(A):a.au(A,A,1/R);const M=a.ar();M[0]=_*p*i-x*d,M[1]=x*p*i+_*d;const z=a.as(M);return z<1e-9?a.at(M):a.au(M,M,1/z),{vecEast:M,vecSouth:A}}function Rr(y,i,d,p){let _;p?(_=[y,i,p(y,i),1],a.aw(_,_,d)):(_=[y,i,0,1],It(_,_,d));const x=_[3];return{point:new a.P(_[0]/x,_[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function rn(y,i){return .5+y/i*.5}function vn(y,i){return y.x>=-i[0]&&y.x<=i[0]&&y.y>=-i[1]&&y.y<=i[1]}function xt(y,i,d,p,_,x,A,R,M,z,j,X,H){const Q=d?y.textSizeData:y.iconSizeData,re=a.an(Q,i.transform.zoom),he=[256/i.width*2+1,256/i.height*2+1],de=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;de.clear();const ge=y.lineVertexArray,Pe=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,De=i.transform.width/i.transform.height;let Ee=!1;for(let Oe=0;Oe<Pe.length;Oe++){const Ue=Pe.get(Oe);if(Ue.hidden||Ue.writingMode===a.ao.vertical&&!Ee){dn(Ue.numGlyphs,de);continue}Ee=!1;const Me=new a.P(Ue.anchorX,Ue.anchorY),He={getElevation:H,pitchedLabelPlaneMatrix:p,lineVertexArray:ge,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:Me,unwrappedTileID:M,width:z,height:j,translation:X},dt=nn(Ue.anchorX,Ue.anchorY,He);if(!vn(dt.point,he)){dn(Ue.numGlyphs,de);continue}const ot=rn(i.transform.cameraToCenterDistance,dt.signedDistanceFromCamera),lt=a.ap(Q,re,Ue),ft=x?lt*i.transform.getPitchedTextCorrection(Ue.anchorX,Ue.anchorY,M)/ot:lt*ot,Vt=Qr({projectionContext:He,pitchedLabelPlaneMatrixInverse:_,symbol:Ue,fontSize:ft,flip:!1,keepUpright:A,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:De,rotateToLine:R});Ee=Vt.useVertical,(Vt.notEnoughRoom||Ee||Vt.needsFlipping&&Qr({projectionContext:He,pitchedLabelPlaneMatrixInverse:_,symbol:Ue,fontSize:ft,flip:!0,keepUpright:A,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:De,rotateToLine:R}).notEnoughRoom)&&dn(Ue.numGlyphs,de)}d?y.text.dynamicLayoutVertexBuffer.updateData(de):y.icon.dynamicLayoutVertexBuffer.updateData(de)}function Wt(y,i,d,p,_,x,A,R){const M=x.glyphStartIndex+x.numGlyphs,z=x.lineStartIndex,j=x.lineStartIndex+x.lineLength,X=i.getoffsetX(x.glyphStartIndex),H=i.getoffsetX(M-1),Q=Tn(y*X,d,p,_,x.segment,z,j,R,A);if(!Q)return null;const re=Tn(y*H,d,p,_,x.segment,z,j,R,A);return re?R.projectionCache.anyProjectionOccluded?null:{first:Q,last:re}:null}function sr(y,i,d,p){return y===a.ao.horizontal&&Math.abs(d.y-i.y)>Math.abs(d.x-i.x)*p?{useVertical:!0}:(y===a.ao.vertical?i.y<d.y:i.x>d.x)?{needsFlipping:!0}:null}function Qr(y){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:d,symbol:p,fontSize:_,flip:x,keepUpright:A,glyphOffsetArray:R,dynamicLayoutVertexArray:M,aspectRatio:z,rotateToLine:j}=y,X=_/24,H=p.lineOffsetX*X,Q=p.lineOffsetY*X;let re;if(p.numGlyphs>1){const he=p.glyphStartIndex+p.numGlyphs,de=p.lineStartIndex,ge=p.lineStartIndex+p.lineLength,Pe=Wt(X,R,H,Q,x,p,j,i);if(!Pe)return{notEnoughRoom:!0};const De=un(Pe.first.point.x,Pe.first.point.y,i,d),Ee=un(Pe.last.point.x,Pe.last.point.y,i,d);if(A&&!x){const Oe=sr(p.writingMode,De,Ee,z);if(Oe)return Oe}re=[Pe.first];for(let Oe=p.glyphStartIndex+1;Oe<he-1;Oe++){const Ue=Tn(X*R.getoffsetX(Oe),H,Q,x,p.segment,de,ge,i,j);if(!Ue)return{notEnoughRoom:!0};re.push(Ue)}re.push(Pe.last)}else{if(A&&!x){const de=Yt(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,ge=p.lineStartIndex+p.segment+1,Pe=new a.P(i.lineVertexArray.getx(ge),i.lineVertexArray.gety(ge)),De=Yt(Pe.x,Pe.y,i),Ee=De.signedDistanceFromCamera>0?De.point:Gr(i.tileAnchorPoint,Pe,de,1,i),Oe=un(de.x,de.y,i,d),Ue=un(Ee.x,Ee.y,i,d),Me=sr(p.writingMode,Oe,Ue,z);if(Me)return Me}const he=Tn(X*R.getoffsetX(p.glyphStartIndex),H,Q,x,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,i,j);if(!he||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};re=[he]}for(const he of re)a.av(M,he.point,he.angle);return{}}function Gr(y,i,d,p,_){const x=y.add(y.sub(i)._unit()),A=Yt(x.x,x.y,_).point,R=d.sub(A);return d.add(R._mult(p/R.mag()))}function cn(y,i,d){const p=i.projectionCache;if(p.projections[y])return p.projections[y];const _=new a.P(i.lineVertexArray.getx(y),i.lineVertexArray.gety(y)),x=Yt(_.x,_.y,i);if(x.signedDistanceFromCamera>0)return p.projections[y]=x.point,p.anyProjectionOccluded=p.anyProjectionOccluded||x.isOccluded,x.point;const A=y-d.direction;return Gr(d.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(A),i.lineVertexArray.gety(A)),_,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,i)}function Yt(y,i,d){const p=y+d.translation[0],_=i+d.translation[1];let x;return d.pitchWithMap?(x=Rr(p,_,d.pitchedLabelPlaneMatrix,d.getElevation),x.isOccluded=!1):(x=d.transform.projectTileCoordinates(p,_,d.unwrappedTileID,d.getElevation),x.point.x=(.5*x.point.x+.5)*d.width,x.point.y=(.5*-x.point.y+.5)*d.height),x}function un(y,i,d,p){if(d.pitchWithMap){const _=[y,i,0,1];return a.aw(_,_,p),d.transform.projectTileCoordinates(_[0]/_[3],_[1]/_[3],d.unwrappedTileID,d.getElevation).point}return{x:y/d.width*2-1,y:1-i/d.height*2}}function nn(y,i,d){return d.transform.projectTileCoordinates(y,i,d.unwrappedTileID,d.getElevation)}function wn(y,i,d){return y._unit()._perp()._mult(i*d)}function jr(y,i,d,p,_,x,A,R,M){if(R.projectionCache.offsets[y])return R.projectionCache.offsets[y];const z=d.add(i);if(y+M.direction<p||y+M.direction>=_)return R.projectionCache.offsets[y]=z,z;const j=cn(y+M.direction,R,M),X=wn(j.sub(d),A,M.direction),H=d.add(X),Q=j.add(X);return R.projectionCache.offsets[y]=a.ax(x,z,H,Q)||z,R.projectionCache.offsets[y]}function Tn(y,i,d,p,_,x,A,R,M){const z=p?y-i:y+i;let j=z>0?1:-1,X=0;p&&(j*=-1,X=Math.PI),j<0&&(X+=Math.PI);let H,Q=j>0?x+_:x+_+1;R.projectionCache.cachedAnchorPoint?H=R.projectionCache.cachedAnchorPoint:(H=Yt(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=H);let re,he,de=H,ge=H,Pe=0,De=0;const Ee=Math.abs(z),Oe=[];let Ue;for(;Pe+De<=Ee;){if(Q+=j,Q<x||Q>=A)return null;Pe+=De,ge=de,he=re;const dt={absOffsetX:Ee,direction:j,distanceFromAnchor:Pe,previousVertex:ge};if(de=cn(Q,R,dt),d===0)Oe.push(ge),Ue=de.sub(ge);else{let ot;const lt=de.sub(ge);ot=lt.mag()===0?wn(cn(Q+j,R,dt).sub(de),d,j):wn(lt,d,j),he||(he=ge.add(ot)),re=jr(Q,ot,de,x,A,he,d,R,dt),Oe.push(he),Ue=re.sub(he)}De=Ue.mag()}const Me=Ue._mult((Ee-Pe)/De)._add(he||ge),He=X+Math.atan2(de.y-ge.y,de.x-ge.x);return Oe.push(Me),{point:Me,angle:M?He:0,path:Oe}}const Pn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dn(y,i){for(let d=0;d<y;d++){const p=i.length;i.resize(p+4),i.float32.set(Pn,3*p)}}function It(y,i,d){const p=i[0],_=i[1];return y[0]=d[0]*p+d[4]*_+d[12],y[1]=d[1]*p+d[5]*_+d[13],y[3]=d[3]*p+d[7]*_+d[15],y}const Hr=100;class bn{constructor(i,d=new Ut(i.width+200,i.height+200,25),p=new Ut(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=p,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Hr,this.screenBottomBoundary=i.height+Hr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,d,p,_,x,A,R,M,z,j,X,H){const Q=this.projectAndGetPerspectiveRatio(i.anchorPointX+M[0],i.anchorPointY+M[1],x,j,H),re=p*Q.perspectiveRatio;let he;if(A||R)he=this._projectCollisionBox(i,re,_,x,A,R,M,Q,j,X,H);else{const Ue=Q.x+(X?X.x*re:0),Me=Q.y+(X?X.y*re:0);he={allPointsOccluded:!1,box:[Ue+i.x1*re,Me+i.y1*re,Ue+i.x2*re,Me+i.y2*re]}}const[de,ge,Pe,De]=he.box,Ee=A?he.allPointsOccluded:Q.isOccluded;let Oe=Ee;return Oe||(Oe=Q.perspectiveRatio<this.perspectiveRatioCutoff),Oe||(Oe=!this.isInsideGrid(de,ge,Pe,De)),Oe||d!=="always"&&this.grid.hitTest(de,ge,Pe,De,d,z)?{box:[de,ge,Pe,De],placeable:!1,offscreen:!1,occluded:Ee}:{box:[de,ge,Pe,De],placeable:!0,offscreen:this.isOffscreen(de,ge,Pe,De),occluded:Ee}}placeCollisionCircles(i,d,p,_,x,A,R,M,z,j,X,H,Q,re){const he=[],de=new a.P(d.anchorX,d.anchorY),ge=this.getPerspectiveRatio(de.x,de.y,A,re),Pe=(z?x*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,A)/ge:x*ge)/a.aB,De={getElevation:re,pitchedLabelPlaneMatrix:R,lineVertexArray:p,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:de,unwrappedTileID:A,width:this.transform.width,height:this.transform.height,translation:Q},Ee=Wt(Pe,_,d.lineOffsetX*Pe,d.lineOffsetY*Pe,!1,d,!1,De);let Oe=!1,Ue=!1,Me=!0;if(Ee){const He=.5*X*ge+H,dt=new a.P(-100,-100),ot=new a.P(this.screenRightBoundary,this.screenBottomBoundary),lt=new Rt,ft=Ee.first,Vt=Ee.last;let $t=[];for(let $r=ft.path.length-1;$r>=1;$r--)$t.push(ft.path[$r]);for(let $r=1;$r<Vt.path.length;$r++)$t.push(Vt.path[$r]);const Dt=2.5*He;if(z){const $r=this.projectPathToScreenSpace($t,De);$t=$r.some((En=>En.signedDistanceFromCamera<=0))?[]:$r.map((En=>En.point))}let Sr=[];if($t.length>0){const $r=$t[0].clone(),En=$t[0].clone();for(let Hn=1;Hn<$t.length;Hn++)$r.x=Math.min($r.x,$t[Hn].x),$r.y=Math.min($r.y,$t[Hn].y),En.x=Math.max(En.x,$t[Hn].x),En.y=Math.max(En.y,$t[Hn].y);Sr=$r.x>=dt.x&&En.x<=ot.x&&$r.y>=dt.y&&En.y<=ot.y?[$t]:En.x<dt.x||$r.x>ot.x||En.y<dt.y||$r.y>ot.y?[]:a.ay([$t],dt.x,dt.y,ot.x,ot.y)}for(const $r of Sr){lt.reset($r,.25*He);let En=0;En=lt.length<=.5*He?1:Math.ceil(lt.paddedLength/Dt)+1;for(let Hn=0;Hn<En;Hn++){const Un=Hn/Math.max(En-1,1),en=lt.lerp(Un),Ln=en.x+Hr,Pi=en.y+Hr;he.push(Ln,Pi,He,0);const ei=Ln-He,Di=Pi-He,ci=Ln+He,mi=Pi+He;if(Me=Me&&this.isOffscreen(ei,Di,ci,mi),Ue=Ue||this.isInsideGrid(ei,Di,ci,mi),i!=="always"&&this.grid.hitTestCircle(Ln,Pi,He,i,j)&&(Oe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!M&&Oe||!Ue||ge<this.perspectiveRatioCutoff?[]:he,offscreen:Me,collisionDetected:Oe}}projectPathToScreenSpace(i,d){const p=(function(_,x){const A=a.L();return a.aq(A,x.pitchedLabelPlaneMatrix),_.map((R=>{const M=Rr(R.x,R.y,A,x.getElevation),z=x.transform.projectTileCoordinates(M.point.x,M.point.y,x.unwrappedTileID,x.getElevation);return z.point.x=(.5*z.point.x+.5)*x.width,z.point.y=(.5*-z.point.y+.5)*x.height,z}))})(i,d);return(function(_){let x=0,A=0,R=0,M=0;for(let z=0;z<_.length;z++)_[z].isOccluded?(R=z+1,M=0):(M++,M>A&&(A=M,x=R));return _.slice(x,x+A)})(p)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],p=new a.a2;for(const X of i){const H=new a.P(X.x+Hr,X.y+Hr);p.extend(H),d.push(H)}const{minX:_,minY:x,maxX:A,maxY:R}=p,M=this.grid.query(_,x,A,R).concat(this.ignoredGrid.query(_,x,A,R)),z={},j={};for(const X of M){const H=X.key;if(z[H.bucketInstanceId]===void 0&&(z[H.bucketInstanceId]={}),z[H.bucketInstanceId][H.featureIndex])continue;const Q=[new a.P(X.x1,X.y1),new a.P(X.x2,X.y1),new a.P(X.x2,X.y2),new a.P(X.x1,X.y2)];a.az(d,Q)&&(z[H.bucketInstanceId][H.featureIndex]=!0,j[H.bucketInstanceId]===void 0&&(j[H.bucketInstanceId]=[]),j[H.bucketInstanceId].push(H.featureIndex))}return j}insertCollisionBox(i,d,p,_,x,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:A,overlapMode:d},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,d,p,_,x,A){const R=p?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:x,collisionGroupID:A,overlapMode:d};for(let z=0;z<i.length;z+=4)R.insertCircle(M,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,d,p,_,x){if(x){let A;_?(A=[i,d,_(i,d),1],a.aw(A,A,x)):(A=[i,d,0,1],It(A,A,x));const R=A[3];return{x:(A[0]/R+1)/2*this.transform.width+Hr,y:(-A[1]/R+1)/2*this.transform.height+Hr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const A=this.transform.projectTileCoordinates(i,d,p,_);return{x:(A.point.x+1)/2*this.transform.width+Hr,y:(1-A.point.y)/2*this.transform.height+Hr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5,isOccluded:A.isOccluded,signedDistanceFromCamera:A.signedDistanceFromCamera}}}getPerspectiveRatio(i,d,p,_){const x=this.transform.projectTileCoordinates(i,d,p,_);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(i,d,p,_){return p<Hr||i>=this.screenRightBoundary||_<Hr||d>this.screenBottomBoundary}isInsideGrid(i,d,p,_){return p>=0&&i<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const i=a.ai([]);return a.M(i,i,[-100,-100,0]),i}_projectCollisionBox(i,d,p,_,x,A,R,M,z,j,X){let H=1,Q=0,re=0,he=1;const de=i.anchorPointX+R[0],ge=i.anchorPointY+R[1];if(A&&!x){const $t=this.projectAndGetPerspectiveRatio(de+1,ge,_,z,X),Dt=$t.x-M.x,Sr=Math.atan(($t.y-M.y)/Dt)+(Dt<0?Math.PI:0),$r=Math.sin(Sr),En=Math.cos(Sr);H=En,Q=$r,re=-$r,he=En}else if(!A&&x){const $t=cr(this.transform);H=$t.vecEast[0],Q=$t.vecEast[1],re=$t.vecSouth[0],he=$t.vecSouth[1]}let Pe=M.x,De=M.y,Ee=d;x&&(Pe=de,De=ge,Ee=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),Ee*=this.transform.getPitchedTextCorrection(de,ge,_),j||(Ee*=a.ae(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),j&&(Pe+=H*j.x*Ee+re*j.y*Ee,De+=Q*j.x*Ee+he*j.y*Ee);const Oe=i.x1*Ee,Ue=i.x2*Ee,Me=(Oe+Ue)/2,He=i.y1*Ee,dt=i.y2*Ee,ot=(He+dt)/2,lt=[{offsetX:Oe,offsetY:He},{offsetX:Me,offsetY:He},{offsetX:Ue,offsetY:He},{offsetX:Ue,offsetY:ot},{offsetX:Ue,offsetY:dt},{offsetX:Me,offsetY:dt},{offsetX:Oe,offsetY:dt},{offsetX:Oe,offsetY:ot}];let ft=[];for(const{offsetX:$t,offsetY:Dt}of lt)ft.push(new a.P(Pe+H*$t+re*Dt,De+Q*$t+he*Dt));let Vt=!1;if(x){const $t=ft.map((Dt=>this.projectAndGetPerspectiveRatio(Dt.x,Dt.y,_,z,X)));Vt=$t.some((Dt=>!Dt.isOccluded)),ft=$t.map((Dt=>new a.P(Dt.x,Dt.y)))}else Vt=!0;return{box:a.aA(ft),allPointsOccluded:!Vt}}}class fn{constructor(i,d,p,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?d:-d))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Mi{constructor(i,d,p,_,x){this.text=new fn(i?i.text:null,d,p,x),this.icon=new fn(i?i.icon:null,d,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ls{constructor(i,d,p){this.text=i,this.icon=d,this.skipFade=p}}class gi{constructor(i,d,p,_,x){this.bucketInstanceId=i,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class zd{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const d=++this.maxGroupID;this.collisionGroups[i]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[i]}}function ll(y,i,d,p,_){const{horizontalAlign:x,verticalAlign:A}=a.aH(y);return new a.P(-(x-.5)*i+p[0]*_,-(A-.5)*d+p[1]*_)}class dc{constructor(i,d,p,_,x){this.transform=i.clone(),this.terrain=d,this.collisionIndex=new bn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new zd(_),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const d=this.terrain;return d?(p,_)=>d.getElevation(i,p,_):null}getBucketParts(i,d,p,_){const x=p.getBucket(d),A=p.latestFeatureIndex;if(!x||!A||d.id!==x.layerIds[0])return;const R=p.collisionBoxArray,M=x.layers[0].layout,z=x.layers[0].paint,j=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),X=p.tileSize/a.$,H=p.tileID.toUnwrapped(),Q=M.get("text-rotation-alignment")==="map",re=a.aC(p,1,this.transform.zoom),he=a.aD(this.collisionIndex.transform,p,z.get("text-translate"),z.get("text-translate-anchor")),de=a.aD(this.collisionIndex.transform,p,z.get("icon-translate"),z.get("icon-translate-anchor")),ge=kt(Q,this.transform,re);this.retainedQueryData[x.bucketInstanceId]=new gi(x.bucketInstanceId,A,x.sourceLayerIndex,x.index,p.tileID);const Pe={bucket:x,layout:M,translationText:he,translationIcon:de,unwrappedTileID:H,pitchedLabelPlaneMatrix:ge,scale:j,textPixelRatio:X,holdingForFade:p.holdingForSymbolFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.an(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const De of x.sortKeyRanges){const{sortKey:Ee,symbolInstanceStart:Oe,symbolInstanceEnd:Ue}=De;i.push({sortKey:Ee,symbolInstanceStart:Oe,symbolInstanceEnd:Ue,parameters:Pe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(i,d,p,_,x,A,R,M,z,j,X,H,Q,re,he,de,ge,Pe,De,Ee){const Oe=a.aE[i.textAnchor],Ue=[i.textOffset0,i.textOffset1],Me=ll(Oe,p,_,Ue,x),He=this.collisionIndex.placeCollisionBox(d,H,M,z,j,R,A,de,X.predicate,De,Me,Ee);if((!Pe||this.collisionIndex.placeCollisionBox(Pe,H,M,z,j,R,A,ge,X.predicate,De,Me,Ee).placeable)&&He.placeable){let dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),Q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Q.crossTileID]={textOffset:Ue,width:p,height:_,anchor:Oe,textBoxScale:x,prevAnchor:dt},this.markUsedJustification(re,Oe,Q,he),re.allowVerticalPlacement&&(this.markUsedOrientation(re,he,Q),this.placedOrientations[Q.crossTileID]=he),{shift:Me,placedGlyphBoxes:He}}}placeLayerBucketPart(i,d,p){const{bucket:_,layout:x,translationText:A,translationIcon:R,unwrappedTileID:M,pitchedLabelPlaneMatrix:z,textPixelRatio:j,holdingForFade:X,collisionBoxArray:H,partiallyEvaluatedTextSize:Q,collisionGroup:re}=i.parameters,he=x.get("text-optional"),de=x.get("icon-optional"),ge=a.aF(x,"text-overlap","text-allow-overlap"),Pe=ge==="always",De=a.aF(x,"icon-overlap","icon-allow-overlap"),Ee=De==="always",Oe=x.get("text-rotation-alignment")==="map",Ue=x.get("text-pitch-alignment")==="map",Me=x.get("icon-text-fit")!=="none",He=x.get("symbol-z-order")==="viewport-y",dt=Pe&&(Ee||!_.hasIconData()||de),ot=Ee&&(Pe||!_.hasTextData()||he);!_.collisionArrays&&H&&_.deserializeCollisionBoxes(H);const lt=this.retainedQueryData[_.bucketInstanceId].tileID,ft=this._getTerrainElevationFunc(lt),Vt=this.transform.getFastPathSimpleProjectionMatrix(lt),$t=(Dt,Sr,$r)=>{var En,Hn;if(d[Dt.crossTileID])return;if(X)return void(this.placements[Dt.crossTileID]=new ls(!1,!1,!1));let Un=!1,en=!1,Ln=!0,Pi=null,ei={box:null,placeable:!1,offscreen:null,occluded:!1},Di={placeable:!1},ci=null,mi=null,Oi=null,ta=0,ra=0,Va=0;Sr.textFeatureIndex?ta=Sr.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(ta=Dt.featureIndex),Sr.verticalTextFeatureIndex&&(ra=Sr.verticalTextFeatureIndex);const na=Sr.textBox;if(na){const ds=vi=>{let Fi=a.ao.horizontal;if(_.allowVerticalPlacement&&!vi&&this.prevPlacement){const _s=this.prevPlacement.placedOrientations[Dt.crossTileID];_s&&(this.placedOrientations[Dt.crossTileID]=_s,Fi=_s,this.markUsedOrientation(_,Fi,Dt))}return Fi},rs=(vi,Fi)=>{if(_.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&Sr.verticalTextBox){for(const _s of _.writingModes)if(_s===a.ao.vertical?(ei=Fi(),Di=ei):ei=vi(),ei&&ei.placeable)break}else ei=vi()},po=Dt.textAnchorOffsetStartIndex,Fl=Dt.textAnchorOffsetEndIndex;if(Fl===po){const vi=(Fi,_s)=>{const ui=this.collisionIndex.placeCollisionBox(Fi,ge,j,lt,M,Ue,Oe,A,re.predicate,ft,void 0,Vt);return ui&&ui.placeable&&(this.markUsedOrientation(_,_s,Dt),this.placedOrientations[Dt.crossTileID]=_s),ui};rs((()=>vi(na,a.ao.horizontal)),(()=>{const Fi=Sr.verticalTextBox;return _.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&Fi?vi(Fi,a.ao.vertical):{box:null,offscreen:null}})),ds(ei&&ei.placeable)}else{let vi=a.aE[(Hn=(En=this.prevPlacement)===null||En===void 0?void 0:En.variableOffsets[Dt.crossTileID])===null||Hn===void 0?void 0:Hn.anchor];const Fi=(ui,Wa,Do)=>{const $s=ui.x2-ui.x1,sa=ui.y2-ui.y1,gm=Dt.textBoxScale,mm=Me&&De==="never"?Wa:null;let oa=null,aa=ge==="never"?1:2,_m="never";vi&&aa++;for(let Pf=0;Pf<aa;Pf++){for(let kc=po;kc<Fl;kc++){const If=_.textAnchorOffsets.get(kc);if(vi&&If.textAnchor!==vi)continue;const Oo=this.attemptAnchorPlacement(If,ui,$s,sa,gm,Oe,Ue,j,lt,M,re,_m,Dt,_,Do,A,R,mm,ft);if(Oo&&(oa=Oo.placedGlyphBoxes,oa&&oa.placeable))return Un=!0,Pi=Oo.shift,oa}vi?vi=null:_m=ge}return p&&!oa&&(oa={box:this.collisionIndex.placeCollisionBox(na,"always",j,lt,M,Ue,Oe,A,re.predicate,ft,void 0,Vt).box,offscreen:!1,placeable:!1,occluded:!1}),oa};rs((()=>Fi(na,Sr.iconBox,a.ao.horizontal)),(()=>{const ui=Sr.verticalTextBox;return _.allowVerticalPlacement&&(!ei||!ei.placeable)&&Dt.numVerticalGlyphVertices>0&&ui?Fi(ui,Sr.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}})),ei&&(Un=ei.placeable,Ln=ei.offscreen);const _s=ds(ei&&ei.placeable);if(!Un&&this.prevPlacement){const ui=this.prevPlacement.variableOffsets[Dt.crossTileID];ui&&(this.variableOffsets[Dt.crossTileID]=ui,this.markUsedJustification(_,ui.anchor,Dt,_s))}}}if(ci=ei,Un=ci&&ci.placeable,Ln=ci&&ci.offscreen,Dt.useRuntimeCollisionCircles&&Dt.centerJustifiedTextSymbolIndex>=0){const ds=_.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex),rs=a.ap(_.textSizeData,Q,ds),po=x.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(ge,ds,_.lineVertexArray,_.glyphOffsetArray,rs,M,z,p,Ue,re.predicate,Dt.collisionCircleDiameter,po,A,ft),mi.circles.length&&mi.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Un=Pe||mi.circles.length>0&&!mi.collisionDetected,Ln=Ln&&mi.offscreen}if(Sr.iconFeatureIndex&&(Va=Sr.iconFeatureIndex),Sr.iconBox){const ds=rs=>this.collisionIndex.placeCollisionBox(rs,De,j,lt,M,Ue,Oe,R,re.predicate,ft,Me&&Pi?Pi:void 0,Vt);Di&&Di.placeable&&Sr.verticalIconBox?(Oi=ds(Sr.verticalIconBox),en=Oi.placeable):(Oi=ds(Sr.iconBox),en=Oi.placeable),Ln=Ln&&Oi.offscreen}const ja=he||Dt.numHorizontalGlyphVertices===0&&Dt.numVerticalGlyphVertices===0,Mc=de||Dt.numIconVertices===0;ja||Mc?Mc?ja||(en=en&&Un):Un=en&&Un:en=Un=en&&Un;const ia=en&&Oi.placeable;if(Un&&ci.placeable&&this.collisionIndex.insertCollisionBox(ci.box,ge,x.get("text-ignore-placement"),_.bucketInstanceId,Di&&Di.placeable&&ra?ra:ta,re.ID),ia&&this.collisionIndex.insertCollisionBox(Oi.box,De,x.get("icon-ignore-placement"),_.bucketInstanceId,Va,re.ID),mi&&Un&&this.collisionIndex.insertCollisionCircles(mi.circles,ge,x.get("text-ignore-placement"),_.bucketInstanceId,ta,re.ID),p&&this.storeCollisionData(_.bucketInstanceId,$r,Sr,ci,Oi,mi),Dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Dt.crossTileID]=new ls((Un||dt)&&!ci?.occluded,(en||ot)&&!Oi?.occluded,Ln||_.justReloaded),d[Dt.crossTileID]=!0};if(He){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Dt=_.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Sr=Dt.length-1;Sr>=0;--Sr){const $r=Dt[Sr];$t(_.symbolInstances.get($r),_.collisionArrays[$r],$r)}}else for(let Dt=i.symbolInstanceStart;Dt<i.symbolInstanceEnd;Dt++)$t(_.symbolInstances.get(Dt),_.collisionArrays[Dt],Dt);_.justReloaded=!1}storeCollisionData(i,d,p,_,x,A){if(p.textBox||p.iconBox){let R,M;this.collisionBoxArrays.has(i)?R=this.collisionBoxArrays.get(i):(R=new Map,this.collisionBoxArrays.set(i,R)),R.has(d)?M=R.get(d):(M={text:null,icon:null},R.set(d,M)),p.textBox&&(M.text=_.box),p.iconBox&&(M.icon=x.box)}if(A){let R=this.collisionCircleArrays[i];R===void 0&&(R=this.collisionCircleArrays[i]=[]);for(let M=0;M<A.circles.length;M+=4)R.push(A.circles[M+0]-Hr),R.push(A.circles[M+1]-Hr),R.push(A.circles[M+2]),R.push(A.collisionDetected?1:0)}}markUsedJustification(i,d,p,_){let x;x=_===a.ao.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.aG(d)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const R of A)R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=x>=0&&R!==x?0:p.crossTileID)}markUsedOrientation(i,d,p){const _=d===a.ao.horizontal||d===a.ao.horizontalOnly?d:0,x=d===a.ao.vertical?d:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const R of A)i.text.placedSymbolArray.get(R).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(i):1,x=d?d.opacities:{},A=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],j=x[M];j?(this.opacities[M]=new Mi(j,_,z.text,z.icon),p=p||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[M]=new Mi(null,_,z.text,z.icon,z.skipFade),p=p||z.text||z.icon)}for(const M in x){const z=x[M];if(!this.opacities[M]){const j=new Mi(z,_,!1,!1);j.isHidden()||(this.opacities[M]=j,p=p||z.text.placed||z.icon.placed)}}for(const M in A)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=A[M]);for(const M in R)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=R[M]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:i)}updateLayerOpacities(i,d){const p={};for(const _ of d){const x=_.getBucket(i);x&&_.latestFeatureIndex&&i.id===x.layerIds[0]&&this.updateBucketOpacities(x,_.tileID,p,_.collisionBoxArray)}}updateBucketOpacities(i,d,p,_){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const x=i.layers[0],A=x.layout,R=new Mi(null,0,!1,!1,!0),M=A.get("text-allow-overlap"),z=A.get("icon-allow-overlap"),j=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=A.get("text-rotation-alignment")==="map",H=A.get("text-pitch-alignment")==="map",Q=A.get("icon-text-fit")!=="none",re=new Mi(null,0,M&&(z||!i.hasIconData()||A.get("icon-optional")),z&&(M||!i.hasTextData()||A.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const he=(ge,Pe,De)=>{for(let Ee=0;Ee<Pe/4;Ee++)ge.opacityVertexArray.emplaceBack(De);ge.hasVisibleVertices=ge.hasVisibleVertices||De!==Go},de=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ge=0;ge<i.symbolInstances.length;ge++){const Pe=i.symbolInstances.get(ge),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:Ee,crossTileID:Oe}=Pe;let Ue=this.opacities[Oe];p[Oe]?Ue=R:Ue||(Ue=re,this.opacities[Oe]=Ue),p[Oe]=!0;const Me=Pe.numIconVertices>0,He=this.placedOrientations[Pe.crossTileID],dt=He===a.ao.vertical,ot=He===a.ao.horizontal||He===a.ao.horizontalOnly;if(De>0||Ee>0){const ft=Ca(Ue.text);he(i.text,De,dt?Go:ft),he(i.text,Ee,ot?Go:ft);const Vt=Ue.text.isHidden();[Pe.rightJustifiedTextSymbolIndex,Pe.centerJustifiedTextSymbolIndex,Pe.leftJustifiedTextSymbolIndex].forEach((Sr=>{Sr>=0&&(i.text.placedSymbolArray.get(Sr).hidden=Vt||dt?1:0)})),Pe.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Pe.verticalPlacedTextSymbolIndex).hidden=Vt||ot?1:0);const $t=this.variableOffsets[Pe.crossTileID];$t&&this.markUsedJustification(i,$t.anchor,Pe,He);const Dt=this.placedOrientations[Pe.crossTileID];Dt&&(this.markUsedJustification(i,"left",Pe,Dt),this.markUsedOrientation(i,Dt,Pe))}if(Me){const ft=Ca(Ue.icon),Vt=!(Q&&Pe.verticalPlacedIconSymbolIndex&&dt);Pe.placedIconSymbolIndex>=0&&(he(i.icon,Pe.numIconVertices,Vt?ft:Go),i.icon.placedSymbolArray.get(Pe.placedIconSymbolIndex).hidden=Ue.icon.isHidden()),Pe.verticalPlacedIconSymbolIndex>=0&&(he(i.icon,Pe.numVerticalIconVertices,Vt?Go:ft),i.icon.placedSymbolArray.get(Pe.verticalPlacedIconSymbolIndex).hidden=Ue.icon.isHidden())}const lt=de&&de.has(ge)?de.get(ge):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const ft=i.collisionArrays[ge];if(ft){let Vt=new a.P(0,0);if(ft.textBox||ft.verticalTextBox){let $t=!0;if(j){const Dt=this.variableOffsets[Oe];Dt?(Vt=ll(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textBoxScale),X&&Vt._rotate(H?-this.transform.bearingInRadians:this.transform.bearingInRadians)):$t=!1}if(ft.textBox||ft.verticalTextBox){let Dt;ft.textBox&&(Dt=dt),ft.verticalTextBox&&(Dt=ot),Po(i.textCollisionBox.collisionVertexArray,Ue.text.placed,!$t||Dt,lt.text,Vt.x,Vt.y)}}if(ft.iconBox||ft.verticalIconBox){const $t=!!(!ot&&ft.verticalIconBox);let Dt;ft.iconBox&&(Dt=$t),ft.verticalIconBox&&(Dt=!$t),Po(i.iconCollisionBox.collisionVertexArray,Ue.icon.placed,Dt,lt.icon,Q?Vt.x:0,Q?Vt.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Po(y,i,d,p,_,x){p&&p.length!==0||(p=[0,0,0,0]);const A=p[0]-Hr,R=p[1]-Hr,M=p[2]-Hr,z=p[3]-Hr;y.emplaceBack(i?1:0,d?1:0,_||0,x||0,A,R),y.emplaceBack(i?1:0,d?1:0,_||0,x||0,M,R),y.emplaceBack(i?1:0,d?1:0,_||0,x||0,M,z),y.emplaceBack(i?1:0,d?1:0,_||0,x||0,A,z)}const cl=Math.pow(2,25),Ud=Math.pow(2,24),Eu=Math.pow(2,17),Vd=Math.pow(2,16),Pu=Math.pow(2,9),Iu=Math.pow(2,8),io=Math.pow(2,1);function Ca(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const i=y.placed?1:0,d=Math.floor(127*y.opacity);return d*cl+i*Ud+d*Eu+i*Vd+d*Pu+i*Iu+d*io+i}const Go=0;class fc{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,d,p,_,x){const A=this._bucketParts;for(;this._currentTileIndex<i.length;)if(d.getBucketParts(A,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(((R,M)=>R.sortKey-M.sortKey)));this._currentPartIndex<A.length;)if(d.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class pc{constructor(i,d,p,_,x,A,R,M){this.placement=new dc(i,d,A,R,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,d,p){const _=N(),x=()=>!this._forceFullPlacement&&N()-_>2;for(;this._currentPlacementIndex>=0;){const A=d[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=R)&&(!A.maxzoom||A.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new fc(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ks=512/a.$/2;class Yo{constructor(i,d,p){this.tileID=i,this.bucketInstanceId=p,this._symbolsByKey={};const _=new Map;for(let x=0;x<d.length;x++){const A=d.get(x),R=A.key,M=_.get(R);M?M.push(A):_.set(R,[A])}for(const[x,A]of _){const R={positions:A.map((M=>({x:Math.floor(M.anchorX*ks),y:Math.floor(M.anchorY*ks)}))),crossTileIDs:A.map((M=>M.crossTileID))};if(R.positions.length>128){const M=new a.aI(R.positions.length,16,Uint16Array);for(const{x:z,y:j}of R.positions)M.add(z,j);M.finish(),delete R.positions,R.index=M}this._symbolsByKey[x]=R}}getScaledCoordinates(i,d){const{x:p,y:_,z:x}=this.tileID.canonical,{x:A,y:R,z:M}=d.canonical,z=ks/Math.pow(2,M-x),j=(R*a.$+i.anchorY)*z,X=_*a.$*ks;return{x:Math.floor((A*a.$+i.anchorX)*z-p*a.$*ks),y:Math.floor(j-X)}}findMatches(i,d,p){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<i.length;x++){const A=i.get(x);if(A.crossTileID)continue;const R=this._symbolsByKey[A.key];if(!R)continue;const M=this.getScaledCoordinates(A,d);if(R.index){const z=R.index.range(M.x-_,M.y-_,M.x+_,M.y+_).sort();for(const j of z){const X=R.crossTileIDs[j];if(!p[X]){p[X]=!0,A.crossTileID=X;break}}}else if(R.positions)for(let z=0;z<R.positions.length;z++){const j=R.positions[z],X=R.crossTileIDs[z];if(Math.abs(j.x-M.x)<=_&&Math.abs(j.y-M.y)<=_&&!p[X]){p[X]=!0,A.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:i})=>i))}}class ul{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const d=Math.round((i-this.lng)/360);if(d!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const A in _){const R=_[A];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),x[R.tileID.key]=R}this.indexes[p]=x}this.lng=i}addBucket(i,d,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const _=this.usedCrossTileIDs[i.overscaledZ];for(const x in this.indexes){const A=this.indexes[x];if(Number(x)>i.overscaledZ)for(const R in A){const M=A[R];M.tileID.isChildOf(i)&&M.findMatches(d.symbolInstances,i,_)}else{const R=A[i.scaledTo(Number(x)).key];R&&R.findMatches(d.symbolInstances,i,_)}}for(let x=0;x<d.symbolInstances.length;x++){const A=d.symbolInstances.get(x);A.crossTileID||(A.crossTileID=p.generate(),_[A.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Yo(i,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(i,d){for(const p of d.getCrossTileIDsLists())for(const _ of p)delete this.usedCrossTileIDs[i][_]}removeStaleBuckets(i){let d=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)i[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],d=!0)}return d}}class Io{constructor(){this.layerIndexes={},this.crossTileIDs=new ul,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,d,p){let _=this.layerIndexes[i.id];_===void 0&&(_=this.layerIndexes[i.id]=new Cu);let x=!1;const A={};_.handleWrapJump(p);for(const R of d){const M=R.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(R.tileID,M,this.crossTileIDs)&&(x=!0),A[M.bucketInstanceId]=!0)}return _.removeStaleBuckets(A)&&(x=!0),x}pruneUnusedLayers(i){const d={};i.forEach((p=>{d[p]=!0}));for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}var so="void main() {fragColor=vec4(1.0);}";const oo={prelude:Jr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Jr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Jr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Jr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Jr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Jr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Jr(so,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Jr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Jr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Jr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Jr(so,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Jr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Jr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Jr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Jr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Jr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Jr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Jr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Jr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Jr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Jr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Jr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Jr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Jr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Jr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Jr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Jr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Jr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Jr(y,i){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/in ([\w]+) ([\w]+)/g),_=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=x?x.concat(_):_,R={};return{fragmentSource:y=y.replace(d,((M,z,j,X,H)=>(R[H]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${j} ${X} ${H};
#else
uniform ${j} ${X} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${j} ${X} ${H} = u_${H};
#endif
`))),vertexSource:i=i.replace(d,((M,z,j,X,H)=>{const Q=X==="float"?"vec2":"vec4",re=H.match(/color/)?"color":Q;return R[H]?z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${j} ${Q} a_${H};
out ${j} ${X} ${H};
#else
uniform ${j} ${X} u_${H};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${j} ${X} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${re}(a_${H}, u_${H}_t);
#else
    ${j} ${X} ${H} = u_${H};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${j} ${Q} a_${H};
#else
uniform ${j} ${X} u_${H};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${j} ${X} ${H} = a_${H};
#else
    ${j} ${X} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${j} ${X} ${H} = unpack_mix_${re}(a_${H}, u_${H}_t);
#else
    ${j} ${X} ${H} = u_${H};
#endif
`})),staticAttributes:p,staticUniforms:A}}class zs{constructor(i,d,p){this.vertexBuffer=i,this.indexBuffer=d,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Kr=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const Ru="#define PROJECTION_MERCATOR",gg="mercator";class gc{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return gg}get shaderDefine(){return Ru}get shaderPreludeCode(){return oo.projectionMercator}get vertexShaderPreludeCode(){return oo.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,d,p,_,x){if(this._cachedMesh)return this._cachedMesh;const A=new a.aL;A.emplaceBack(0,0),A.emplaceBack(a.$,0),A.emplaceBack(0,a.$),A.emplaceBack(a.$,a.$);const R=i.createVertexBuffer(A,Kr.members),M=a.aM.simpleSegment(0,0,4,2),z=new a.aN;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const j=i.createIndexBuffer(z);return this._cachedMesh=new zs(R,j,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}class $i{constructor(i=0,d=0,p=0,_=0){if(isNaN(i)||i<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=d,this.left=p,this.right=_}interpolate(i,d,p){return d.top!=null&&i.top!=null&&(this.top=a.C.number(i.top,d.top,p)),d.bottom!=null&&i.bottom!=null&&(this.bottom=a.C.number(i.bottom,d.bottom,p)),d.left!=null&&i.left!=null&&(this.left=a.C.number(i.left,d.left,p)),d.right!=null&&i.right!=null&&(this.right=a.C.number(i.right,d.right,p)),this}getCenter(i,d){const p=a.ae((this.left+i-this.right)/2,0,i),_=a.ae((this.top+d-this.bottom)/2,0,d);return new a.P(p,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new $i(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ki(y,i){if(!y.renderWorldCopies||y.lngRange)return;const d=i.lng-y.center.lng;i.lng+=d>180?-360:d<-180?360:0}function es(y){return Math.max(0,Math.floor(y))}class Si{constructor(i,d){var p;this._callbacks=i,this._tileSize=512,this._renderWorldCopies=d?.renderWorldCopies===void 0||!!d?.renderWorldCopies,this._minZoom=d?.minZoom||0,this._maxZoom=d?.maxZoom||22,this._minPitch=d?.minPitch==null?0:d?.minPitch,this._maxPitch=d?.maxPitch==null?60:d?.maxPitch,this._constrain=(p=d?.constrain)!==null&&p!==void 0?p:this._callbacks.constrain,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=es(this._zoom),this._scale=a.ah(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new $i,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,d,p){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=es(this._zoom),this._scale=a.ah(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new $i(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!p&&i.autoCalculateNearFarZ,d&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get constrain(){return this._constrain}setConstrain(i){i||(i=this._callbacks.constrain),this._constrain=i,this.constrainInternal(),this._calcMatrices()}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const d=a.aO(i,-180,180)*Math.PI/180;var p,_,x,A,R,M,z,j,X;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=v(),p=this._rotationMatrix,x=-this._bearingInRadians,A=(_=this._rotationMatrix)[0],R=_[1],M=_[2],z=_[3],j=Math.sin(x),X=Math.cos(x),p[0]=A*X+M*j,p[1]=R*X+z*j,p[2]=A*-j+M*X,p[3]=R*-j+z*X)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const d=a.ae(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const d=i/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(i){i=a.ae(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=a.ag(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const d=this.constrain(this._center,i).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=a.ah(d),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,d){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,d,p){this._unmodified=!1,this._edgeInsets.interpolate(i,d,p),this.constrainInternal(),this._calcMatrices()}resize(i,d,p=!0){this._width=i,this._height=d,p&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ut([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-a.af,a.af])}getCameraQueryGeometry(i,d){if(d.length===1)return[d[0],i];{const{minX:p,minY:_,maxX:x,maxY:A}=a.a2.fromPoints(d).extend(i);return[new a.P(p,_),new a.P(x,_),new a.P(x,A),new a.P(p,A),new a.P(p,_)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:d,zoom:p}=this.constrain(this.center,this.zoom);this.setCenter(d),this.setZoom(p),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=a.ai(new Float64Array(16));a.N(i,i,[this._width/2,-this._height/2,1]),a.M(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=a.ai(new Float64Array(16)),a.N(i,i,[1,-1,1]),a.M(i,i,[-1,-1,0]),a.N(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,d,p,_){const x=p!==void 0?p:this.bearing,A=_=_!==void 0?_:this.pitch,R=a.a1.fromLngLat(i,d),M=-Math.cos(a.ag(A)),z=Math.sin(a.ag(A)),j=z*Math.sin(a.ag(x)),X=-z*Math.cos(a.ag(x));let H=this.elevation;const Q=d-H;let re;M*Q>=0||Math.abs(M)<.1?(re=1e4,H=d+re*M):re=-Q/M;let he,de,ge=a.aQ(1,R.y),Pe=0;do{if(Pe+=1,Pe>10)break;de=re/ge,he=new a.a1(R.x+j*de,R.y+X*de),ge=1/he.meterInMercatorCoordinateUnits()}while(Math.abs(re-de*ge)>1e-12);return{center:he.toLngLat(),elevation:H,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/de/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const d=a.aj(1,this.center.lat)*this.worldSize,p=this.cameraToCenterDistance/d,_=a.a1.fromLngLat(this.center,this.elevation),x=At(this.center,this.elevation,this.pitch,this.bearing,p);this._elevation=i;const A=this.calculateCenterFromCameraLngLatAlt(x.toLngLat(),a.aQ(x.z,_.y),this.bearing,this.pitch);this._elevation=A.elevation,this._center=A.center,this.setZoom(A.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return At(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const d=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/d,i.canonical.y/d,1/d/a.$,1/d/a.$]}}class $n{constructor(i,d){this.min=i,this.max=d,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(i){const d=[i%2==0,i<2],p=a.aT(this.min),_=a.aT(this.max);for(let x=0;x<d.length;x++)p[x]=d[x]?this.min[x]:this.center[x],_[x]=d[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new $n(p,_)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let d=!0;for(let p=0;p<i.planes.length;p++){const _=this.intersectsPlane(i.planes[p]);if(_===0)return 0;_===1&&(d=!1)}return d?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let d=i[3],p=i[3];for(let _=0;_<3;_++)i[_]>0?(d+=i[_]*this.min[_],p+=i[_]*this.max[_]):(p+=i[_]*this.min[_],d+=i[_]*this.max[_]);return d>=0?2:p<0?0:1}}class Oy{distanceToTile2d(i,d,p,_){const x=_.distanceX([i,d]),A=_.distanceY([i,d]);return Math.hypot(x,A)}getWrap(i,d,p){return p}getTileBoundingVolume(i,d,p,_){var x,A;let R=0,M=0;if(_?.terrain){const j=new a.Z(i.z,d,i.z,i.x,i.y),X=_.terrain.getMinMaxElevation(j);R=(x=X.minElevation)!==null&&x!==void 0?x:Math.min(0,p),M=(A=X.maxElevation)!==null&&A!==void 0?A:Math.max(0,p)}const z=1<<i.z;return new $n([d+i.x/z,i.y/z,R],[d+(i.x+1)/z,(i.y+1)/z,M])}allowVariableZoom(i,d){const p=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,_=a.ae(78.5-p/2,0,60);return!!d.terrain||i.pitch>_}allowWorldCopies(){return!0}prepareNextFrame(){}}class Hi{constructor(i,d,p){this.points=i,this.planes=d,this.aabb=p}static fromInvProjectionMatrix(i,d=1,p=0,_,x){const A=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,p),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((H=>(function(Q,re,he,de){const ge=a.aw([],Q,re),Pe=1/ge[3]/he*de;return a.aY(ge,ge,[Pe,Pe,1/ge[3],Pe])})(H,i,d,R)));_&&(function(H,Q,re,he){const de=he?4:0,ge=he?0:4;let Pe=0;const De=[],Ee=[];for(let Me=0;Me<4;Me++){const He=a.aU([],H[Me+ge],H[Me+de]),dt=a.aZ(He);a.aR(He,He,1/dt),De.push(dt),Ee.push(He)}for(let Me=0;Me<4;Me++){const He=a.a_(H[Me+de],Ee[Me],re);Pe=He!==null&&He>=0?Math.max(Pe,He):Math.max(Pe,De[Me])}const Oe=(function(Me,He){const dt=a.aU([],Me[He[0]],Me[He[1]]),ot=a.aU([],Me[He[2]],Me[He[1]]),lt=[0,0,0,0];return a.aV(lt,a.aW([],dt,ot)),lt[3]=-a.aX(lt,Me[He[0]]),lt})(H,Q),Ue=(function(Me,He){const dt=a.a$(Me),ot=a.b0([],Me,1/dt),lt=a.aU([],He,a.aR([],ot,a.aX(He,ot))),ft=a.a$(lt);if(ft>0){const Vt=Math.sqrt(1-ot[3]*ot[3]),$t=a.aR([],ot,-ot[3]),Dt=a.aS([],$t,a.aR([],lt,Vt/ft));return a.b1(He,Dt)}return null})(re,Oe);if(Ue!==null){const Me=Ue/a.aX(Ee[0],Oe);Pe=Math.min(Pe,Me)}for(let Me=0;Me<4;Me++){const He=Math.min(Pe,De[Me]);H[Me+ge]=[H[Me+de][0]+Ee[Me][0]*He,H[Me+de][1]+Ee[Me][1]*He,H[Me+de][2]+Ee[Me][2]*He,1]}})(M,A[0],_,x);const z=A.map((H=>{const Q=a.aU([],M[H[0]],M[H[1]]),re=a.aU([],M[H[2]],M[H[1]]),he=a.aV([],a.aW([],Q,re)),de=-a.aX(he,M[H[1]]);return he.concat(de)})),j=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],X=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const H of M)for(let Q=0;Q<3;Q++)j[Q]=Math.min(j[Q],H[Q]),X[Q]=Math.max(X[Q],H[Q]);return new Hi(M,z,new $n(j,X))}}class Zi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,d,p){return this._helper.interpolatePadding(i,d,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,d,p=!0){this._helper.resize(i,d,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}setConstrain(i){this._helper.setConstrain(i)}overrideNearFarZ(i,d){this._helper.overrideNearFarZ(i,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,d){}constructor(i){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(d,p)=>{p=a.ae(+p,this.minZoom,this.maxZoom);const _={center:new a.S(d.lng,d.lat),zoom:p};let x=this._helper._lngRange;if(!this._helper._renderWorldCopies&&x===null){const Ee=179.9999999999;x=[-Ee,Ee]}const A=this.tileSize*a.ah(_.zoom);let R=0,M=A,z=0,j=A,X=0,H=0;const{x:Q,y:re}=this.size;if(this._helper._latRange){const Ee=this._helper._latRange;R=a.U(Ee[1])*A,M=a.U(Ee[0])*A,M-R<re&&(X=re/(M-R))}x&&(z=a.aO(a.V(x[0])*A,0,A),j=a.aO(a.V(x[1])*A,0,A),j<z&&(j+=A),j-z<Q&&(H=Q/(j-z)));const{x:he,y:de}=Be(A,d);let ge,Pe;const De=Math.max(H||0,X||0);if(De){const Ee=new a.P(H?(j+z)/2:he,X?(M+R)/2:de);return _.center=Ge(A,Ee).wrap(),_.zoom+=a.ak(De),_}if(this._helper._latRange){const Ee=re/2;de-Ee<R&&(Pe=R+Ee),de+Ee>M&&(Pe=M-Ee)}if(x){const Ee=(z+j)/2;let Oe=he;this._helper._renderWorldCopies&&(Oe=a.aO(he,Ee-A/2,Ee+A/2));const Ue=Q/2;Oe-Ue<z&&(ge=z+Ue),Oe+Ue>j&&(ge=j-Ue)}if(ge!==void 0||Pe!==void 0){const Ee=new a.P(ge??he,Pe??de);_.center=Ge(A,Ee).wrap()}return _},this._helper=new Si({calcMatrices:()=>{this._calcMatrices()},constrain:(d,p)=>this.defaultConstrain(d,p)},i),this._coveringTilesDetailsProvider=new Oy}clone(){const i=new Zi;return i.apply(this),i}apply(i,d,p){this._helper.apply(i,d,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const d=[new a.b2(0,i)];if(this._helper._renderWorldCopies){const p=this.screenPointToMercatorCoordinate(new a.P(0,0)),_=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),A=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),R=Math.floor(Math.min(p.x,_.x,x.x,A.x)),M=Math.floor(Math.max(p.x,_.x,x.x,A.x)),z=1;for(let j=R-z;j<=M+z;j++)j!==0&&d.push(new a.b2(j,i))}return d}getCameraFrustum(){return Hi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const d=this.screenPointToLocation(this.centerPoint,i),p=i?i.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(i,d){const p=a.aj(this.elevation,this.center.lat),_=this.screenPointToMercatorCoordinateAtZ(d,p),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),A=a.a1.fromLngLat(i),R=new a.a1(A.x-(_.x-x.x),A.y-(_.y-x.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,d){return d?this.coordinatePoint(a.a1.fromLngLat(i),d.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(i))}screenPointToLocation(i,d){var p;return(p=this.screenPointToMercatorCoordinate(i,d))===null||p===void 0?void 0:p.toLngLat()}screenPointToMercatorCoordinate(i,d){if(d){const p=d.pointCoordinate(i);if(p!=null)return p}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,d){const p=d||0,_=[i.x,i.y,0,1],x=[i.x,i.y,1,1];a.aw(_,_,this._pixelMatrixInverse),a.aw(x,x,this._pixelMatrixInverse);const A=_[3],R=x[3],M=_[1]/A,z=x[1]/R,j=_[2]/A,X=x[2]/R,H=j===X?0:(p-j)/(X-j);return new a.a1(a.C.number(_[0]/A,x[0]/R,H)/this.worldSize,a.C.number(M,z,H)/this.worldSize,p)}coordinatePoint(i,d=0,p=this._pixelMatrix){const _=[i.x*this.worldSize,i.y*this.worldSize,d,1];return a.aw(_,_,p),new a.P(_[0]/_[3],_[1]/_[3])}getBounds(){const i=Math.max(0,this._helper._height/2-Ve(this));return new ut().extend(this.screenPointToLocation(new a.P(0,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(i,d){return d?d.pointCoordinate(i)!=null:i.y>this.height/2-Ve(this)}calculatePosMatrix(i,d=!1,p){var _;const x=(_=i.key)!==null&&_!==void 0?_:a.b3(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),A=d?this._alignedPosMatrixCache:this._posMatrixCache;if(A.has(x)){const z=A.get(x);return p?z.f32:z.f64}const R=nt(i,this.worldSize);a.O(R,d?this._alignedProjMatrix:this._viewProjMatrix,R);const M={f64:R,f32:new Float32Array(R)};return A.set(x,M),p?M.f32:M.f64}calculateFogMatrix(i){const d=i.key,p=this._fogMatrixCacheF32;if(p.has(d))return p.get(d);const _=nt(i,this.worldSize);return a.O(_,this._fogMatrix,_),p.set(d,new Float32Array(_)),p.get(d)}calculateCenterFromCameraLngLatAlt(i,d,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,d,p,_)}_calculateNearFarZIfNeeded(i,d,p){if(!this._helper.autoCalculateNearFarZ)return;const _=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=i-_*this._helper._pixelPerMeter/Math.cos(d),A=_<0?x:i,R=Math.PI/2+this.pitchInRadians,M=a.ag(this.fov)*(Math.abs(Math.cos(a.ag(this.roll)))*this.height+Math.abs(Math.sin(a.ag(this.roll)))*this.width)/this.height*(.5+p.y/this.height),z=Math.sin(M)*A/Math.sin(a.ae(Math.PI-R-M,.01,Math.PI-.01)),j=Ve(this),X=Math.atan(j/this._helper.cameraToCenterDistance),H=a.ag(.75),Q=X>H?2*X*(.5+p.y/(2*j)):H,re=Math.sin(Q)*A/Math.sin(a.ae(Math.PI-R-Q,.01,Math.PI-.01)),he=Math.min(z,re);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*he+A),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,d=Be(this.worldSize,this.center),p=d.x,_=d.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const x=a.ag(Math.min(this.pitch,Ce)),A=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let R;this._calculateNearFarZIfNeeded(A,x,i),R=new Float64Array(16),a.b4(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,R),R[8]=2*-i.x/this._helper._width,R[9]=2*i.y/this._helper._height,this._projectionMatrix=a.b5(R),a.N(R,R,[1,-1,1]),a.M(R,R,[0,0,-this._helper.cameraToCenterDistance]),a.b6(R,R,-this.rollInRadians),a.b7(R,R,this.pitchInRadians),a.b6(R,R,-this.bearingInRadians),a.M(R,R,[-p,-_,0]),this._mercatorMatrix=a.N([],R,[this.worldSize,this.worldSize,this.worldSize]),a.N(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),a.M(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=a.aq([],R);const M=[0,0,-1,1];a.aw(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,A,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-p,-_,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const z=this._helper._width%2/2,j=this._helper._height%2/2,X=Math.cos(this.bearingInRadians),H=Math.sin(-this.bearingInRadians),Q=p-Math.round(p)+X*z+H*j,re=_-Math.round(_)+X*j+H*z,he=new Float64Array(R);if(a.M(he,he,[Q>.5?Q-1:Q,re>.5?re-1:re,0]),this._alignedProjMatrix=he,R=a.aq(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new a.P(0,0)),d=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.aw(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return At(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,d){const p=a.a1.fromLngLat(i),_=[p.x*this.worldSize,p.y*this.worldSize,d,1];return a.aw(_,_,this._viewProjMatrix),_[2]/_[3]}getProjectionData(i){const{overscaledTileID:d,aligned:p,applyTerrainMatrix:_}=i,x=this._helper.getMercatorTileCoordinates(d),A=d?this.calculatePosMatrix(d,p,!0):null;let R;return R=d&&d.terrainRttPosMatrix32f&&_?d.terrainRttPosMatrix32f:A||a.b8(),{mainMatrix:R,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,d,p){return 1}transformLightDirection(i){return a.aT(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,d,p,_){const x=this.calculatePosMatrix(p);let A;_?(A=[i,d,_(i,d),1],a.aw(A,A,x)):(A=[i,d,0,1],It(A,A,x));const R=A[3];return{point:new a.P(A[0]/R,A[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(i){for(const d of i)this.calculatePosMatrix(d)}getMatrixForModel(i,d){const p=a.a1.fromLngLat(i,d),_=p.meterInMercatorCoordinateUnits(),x=a.b9();return a.M(x,x,[p.x,p.y,p.z]),a.b6(x,x,Math.PI),a.b7(x,x,Math.PI/2),a.N(x,x,[-_,_,_]),x}getProjectionDataForCustomLayer(i=!0){const d=new a.Z(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:i}),_=nt(d,this.worldSize);a.O(_,this._viewProjMatrix,_),p.tileMercatorCoords=[0,0,1,1];const x=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],A=a.ba();return a.N(A,_,x),p.fallbackMatrix=A,p.mainMatrix=A,p}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function gs(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function jd(y){if(y.useSlerp)if(y.k<1){const i=a.bb(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),d=a.bb(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),p=new Float64Array(4);a.bc(p,i,d,y.k);const _=a.bd(p);y.tr.setRoll(_.roll),y.tr.setPitch(_.pitch),y.tr.setBearing(_.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(a.C.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(a.C.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(a.C.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function hl(y,i,d,p,_){const x=_.padding,A=Be(_.worldSize,d.getNorthWest()),R=Be(_.worldSize,d.getNorthEast()),M=Be(_.worldSize,d.getSouthEast()),z=Be(_.worldSize,d.getSouthWest()),j=a.ag(-p),X=A.rotate(j),H=R.rotate(j),Q=M.rotate(j),re=z.rotate(j),he=new a.P(Math.max(X.x,H.x,re.x,Q.x),Math.max(X.y,H.y,re.y,Q.y)),de=new a.P(Math.min(X.x,H.x,re.x,Q.x),Math.min(X.y,H.y,re.y,Q.y)),ge=he.sub(de),Pe=(_.width-(x.left+x.right+i.left+i.right))/ge.x,De=(_.height-(x.top+x.bottom+i.top+i.bottom))/ge.y;if(De<0||Pe<0)return void gs();const Ee=Math.min(a.ak(_.scale*Math.min(Pe,De)),y.maxZoom),Oe=a.P.convert(y.offset),Ue=new a.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(a.ag(p)),Me=Oe.add(Ue).mult(_.scale/a.ah(Ee));return{center:Ge(_.worldSize,A.add(M).div(2).sub(Me)),zoom:Ee,bearing:p}}class Qn{get useGlobeControls(){return!1}handlePanInertia(i,d){const p=i.mag(),_=Math.abs(Ve(d));return{easingOffset:i.mult(Math.min(.75*_/p,1)),easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(i,d){i.bearingDelta&&d.setBearing(d.bearing+i.bearingDelta),i.pitchDelta&&d.setPitch(d.pitch+i.pitchDelta),i.rollDelta&&d.setRoll(d.roll+i.rollDelta),i.zoomDelta&&d.setZoom(d.zoom+i.zoomDelta)}handleMapControlsPan(i,d,p){i.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(p,i.around)}cameraForBoxAndBearing(i,d,p,_,x){return hl(i,d,p,_,x)}handleJumpToCenterZoom(i,d){i.zoom!==(d.zoom!==void 0?+d.zoom:i.zoom)&&i.setZoom(+d.zoom),d.center!==void 0&&i.setCenter(a.S.convert(d.center))}handleEaseTo(i,d){const p=i.zoom,_=i.padding,x={roll:i.roll,pitch:i.pitch,bearing:i.bearing},A={roll:d.roll===void 0?i.roll:d.roll,pitch:d.pitch===void 0?i.pitch:d.pitch,bearing:d.bearing===void 0?i.bearing:d.bearing},R=d.zoom!==void 0,M=!i.isPaddingEqual(d.padding);let z=!1;const j=R?+d.zoom:i.zoom;let X=i.centerPoint.add(d.offsetAsPoint);const H=i.screenPointToLocation(X),{center:Q,zoom:re}=i.constrain(a.S.convert(d.center||H),j??p);ki(i,Q);const he=Be(i.worldSize,H),de=Be(i.worldSize,Q).sub(he),ge=a.ah(re-p);return z=re!==p,{easeFunc:Pe=>{if(z&&i.setZoom(a.C.number(p,re,Pe)),a.be(x,A)||jd({startEulerAngles:x,endEulerAngles:A,tr:i,k:Pe,useSlerp:x.roll!=A.roll}),M&&(i.interpolatePadding(_,d.padding,Pe),X=i.centerPoint.add(d.offsetAsPoint)),d.around)i.setLocationAtPoint(d.around,d.aroundPoint);else{const De=a.ah(i.zoom-p),Ee=re>p?Math.min(2,ge):Math.max(.5,ge),Oe=Math.pow(Ee,1-Pe),Ue=Ge(i.worldSize,he.add(de.mult(Pe*Oe)).mult(De));i.setLocationAtPoint(i.renderWorldCopies?Ue.wrap():Ue,X)}},isZooming:z,elevationCenter:Q}}handleFlyTo(i,d){const p=d.zoom!==void 0,_=i.zoom,x=i.constrain(a.S.convert(d.center||d.locationAtOffset),p?+d.zoom:_),A=x.center,R=x.zoom;ki(i,A);const M=Be(i.worldSize,d.locationAtOffset),z=Be(i.worldSize,A).sub(M),j=z.mag(),X=a.ah(R-_);let H;if(d.minZoom!==void 0){const Q=Math.min(+d.minZoom,_,R),re=i.constrain(A,Q).zoom;H=a.ah(re-_)}return{easeFunc:(Q,re,he,de)=>{i.setZoom(Q===1?R:_+a.ak(re));const ge=Q===1?A:Ge(i.worldSize,M.add(z.mult(he)).mult(re));i.setLocationAtPoint(i.renderWorldCopies?ge.wrap():ge,de)},scaleOfZoom:X,targetCenter:A,scaleOfMinZoom:H,pixelPathLength:j}}}class Mn{constructor(i,d,p){this.blendFunction=i,this.blendColor=d,this.mask=p}}Mn.Replace=[1,0],Mn.disabled=new Mn(Mn.Replace,a.bf.transparent,[!1,!1,!1,!1]),Mn.unblended=new Mn(Mn.Replace,a.bf.transparent,[!0,!0,!0,!0]),Mn.alphaBlended=new Mn([1,771],a.bf.transparent,[!0,!0,!0,!0]);const Co=2305;class yn{constructor(i,d,p){this.enable=i,this.mode=d,this.frontFace=p}}yn.disabled=new yn(!1,1029,Co),yn.backCCW=new yn(!0,1029,Co),yn.frontCCW=new yn(!0,1028,Co);class Wr{constructor(i,d,p){this.func=i,this.mask=d,this.range=p}}Wr.ReadOnly=!1,Wr.ReadWrite=!0,Wr.disabled=new Wr(519,Wr.ReadOnly,[0,1]);const Mu=7680;class on{constructor(i,d,p,_,x,A){this.test=i,this.ref=d,this.mask=p,this.fail=_,this.depthFail=x,this.pass=A}}on.disabled=new on({func:519,mask:0},0,0,Mu,Mu,Mu);const Wd=new WeakMap;function ao(y){var i;if(Wd.has(y))return Wd.get(y);{const d=(i=y.getParameter(y.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Wd.set(y,d),d}}class dl{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const d=i.context,p=d.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;const _=new a.aL;_.emplaceBack(-1,-1),_.emplaceBack(2,-1),_.emplaceBack(-1,2);const x=new a.aN;x.emplaceBack(0,1,2),this._fullscreenTriangle=new zs(d.createVertexBuffer(_,Kr.members),d.createIndexBuffer(x),a.aM.simpleSegment(0,0,_.length,x.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(p.TEXTURE1);const A=p.createTexture();p.bindTexture(p.TEXTURE_2D,A),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(A),ao(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,d){const p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,d=i.gl;i.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,d){const p=this._cachedRenderContext.context,_=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,_.TRIANGLES,Wr.disabled,on.disabled,Mn.unblended,yn.disabled,((x,A)=>({u_input:x,u_output_expected:A}))(i,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ao(_)){_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.readBuffer(_.COLOR_ATTACHMENT0),_.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,null);const x=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);_.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ao(i)){const d=i.clientWaitSync(this._readbackQueue.sync,0,0);if(d===i.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=dl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let d=0;return d+=i[0]/256,d+=i[1]/65536,d+=i[2]/16777216,i[3]<127&&(d=-d),d/128}}const Ra=a.$/128;function mc(y,i){const d=y.granularity!==void 0?Math.max(y.granularity,1):1,p=d+(y.generateBorders?2:0),_=d+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),x=p+1,A=_+1,R=y.generateBorders?-1:0,M=y.generateBorders||y.extendToNorthPole?-1:0,z=d+(y.generateBorders?1:0),j=d+(y.generateBorders||y.extendToSouthPole?1:0),X=x*A,H=p*_*6,Q=x*A>65536;if(Q&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const re=Q||i==="32bit",he=new Int16Array(2*X);let de=0;for(let De=M;De<=j;De++)for(let Ee=R;Ee<=z;Ee++){let Oe=Ee/d*a.$;Ee===-1&&(Oe=-Ra),Ee===d+1&&(Oe=a.$+Ra);let Ue=De/d*a.$;De===-1&&(Ue=y.extendToNorthPole?a.bh:-Ra),De===d+1&&(Ue=y.extendToSouthPole?a.bi:a.$+Ra),he[de++]=Oe,he[de++]=Ue}const ge=re?new Uint32Array(H):new Uint16Array(H);let Pe=0;for(let De=0;De<_;De++)for(let Ee=0;Ee<p;Ee++){const Oe=Ee+1+De*x,Ue=Ee+(De+1)*x,Me=Ee+1+(De+1)*x;ge[Pe++]=Ee+De*x,ge[Pe++]=Ue,ge[Pe++]=Oe,ge[Pe++]=Oe,ge[Pe++]=Ue,ge[Pe++]=Me}return{vertices:he.buffer.slice(0),indices:ge.buffer.slice(0),uses32bitIndices:re}}const _c=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class ku{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return oo.projectionGlobe}get vertexShaderPreludeCode(){return oo.projectionMercator.vertexSource}get subdivisionGranularity(){return _c}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new dl(i));const d=a.U(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,_=this._errorMeasurement.updateErrorLoop(d,p),x=N();_!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=_,this._errorMeasurementLastChangeTime=x);const A=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(A))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,d,p,_,x){const A=(x==="stencil"?_c.stencil:_c.tile).getGranularityForZoomLevel(d.z);return this._getMesh(i,{granularity:A,generateBorders:p,extendToNorthPole:d.y===0&&_,extendToSouthPole:d.y===(1<<d.z)-1&&_})}_getMesh(i,d){const p=this._getMeshKey(d);if(p in this._tileMeshCache)return this._tileMeshCache[p];const _=(function(x,A){const R=mc(A,"16bit"),M=a.aL.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),z=a.aN.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new zs(x.createVertexBuffer(M,Kr.members),x.createIndexBuffer(z),a.aM.simpleSegment(0,0,M.length,z.length))})(i,d);return this._tileMeshCache[p]=_,_}recalculate(i){}hasTransition(){const i=N();let d=!1;return d=d||(i-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const Du=new a.r({type:new a.D(a.v.projection.type)});class Ou extends a.E{constructor(i){super(),this._transitionable=new a.t(Du,void 0),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new gc,this._verticalPerspectiveProjection=new ku}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof a.bm){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,d,p,_,x){return this.currentProjection.getMeshFromTileID(i,d,p,_,x)}setProjection(i){this._transitionable.setValue("type",i?.type||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function Fu(y){const i=Ko(y.worldSize,y.center.lat);return 2*Math.PI*i}function Us(y,i,d,p,_){const x=1/(1<<_),A=i/a.$*x+p*x,R=a.bo((y/a.$*x+d*x)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-A*Math.PI*2))-.5*Math.PI,z=Math.cos(M),j=new Float64Array(3);return j[0]=Math.sin(R)*z,j[1]=Math.sin(M),j[2]=Math.cos(R)*z,j}function Ai(y){return(function(i,d){const p=Math.cos(d),_=new Float64Array(3);return _[0]=Math.sin(i)*p,_[1]=Math.sin(d),_[2]=Math.cos(i)*p,_})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function Ko(y,i){return y/(2*Math.PI)/Math.cos(i*Math.PI/180)}function mg(y){const i=Math.asin(y[1])/Math.PI*180,d=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(d>1e-6){const p=y[0]/d,_=Math.acos(y[2]/d),x=(p>0?_:-_)/Math.PI*180;return new a.S(a.aO(x,-180,180),i)}return new a.S(0,i)}function fl(y){return Math.cos(y*Math.PI/180)}function Ei(y,i){const d=fl(y),p=fl(i);return a.ak(p/d)}function _g(y,i){const d=y.rotate(i.bearingInRadians),p=i.zoom+Ei(i.center.lat,0),_=a.bk(1/fl(i.center.lat),1/fl(Math.min(Math.abs(i.center.lat),60)),a.bn(p,7,3,0,1)),x=360/Fu({worldSize:i.worldSize,center:{lat:i.center.lat}});return new a.S(i.center.lng-d.x*x*_,a.ae(i.center.lat+d.y*x,-a.af,a.af))}function $d(y){const i=.5*y,d=Math.sin(i),p=Math.cos(i);return Math.log(d+p)-Math.log(p-d)}function cs(y,i,d,p){const _=y.lat+d*p;if(Math.abs(d)>1){const x=(Math.sign(y.lat+d)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,A=Math.abs(y.lat+d)*Math.PI/180,R=$d(x+p*(A-x)),M=$d(x),z=$d(A);return new a.S(y.lng+i*((R-M)/(z-M)),_)}return new a.S(y.lng+i*p,_)}class Hd{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=i}swapBuffers(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(i,d,p,_){const x=`${i.z}_${i.x}_${i.y}_${_?.terrain?"t":""}`,A=this._cache.get(x);if(A)return A;const R=this._cachePrevious.get(x);if(R)return this._cache.set(x,R),R;const M=this._boundingVolumeFactory(i,d,p,_);return this._cache.set(x,M),this._hadAnyChanges=!0,M}}class us{constructor(i,d,p,_){this.min=p,this.max=_,this.points=i,this.planes=d}static fromAabb(i,d){const p=[];for(let _=0;_<8;_++)p.push([1&~_?i[0]:d[0],(_>>1&1)==1?d[1]:i[1],(_>>2&1)==1?d[2]:i[2]]);return new us(p,[[-1,0,0,d[0]],[1,0,0,-i[0]],[0,-1,0,d[1]],[0,1,0,-i[1]],[0,0,-1,d[2]],[0,0,1,-i[2]]],i,d)}static fromCenterSizeAngles(i,d,p){const _=a.br([],p[0],p[1],p[2]),x=a.bs([],[d[0],0,0],_),A=a.bs([],[0,d[1],0],_),R=a.bs([],[0,0,d[2]],_),M=[...i],z=[...i];for(let X=0;X<8;X++)for(let H=0;H<3;H++){const Q=i[H]+x[H]*(1&~X?-1:1)+A[H]*((X>>1&1)==1?1:-1)+R[H]*((X>>2&1)==1?1:-1);M[H]=Math.min(M[H],Q),z[H]=Math.max(z[H],Q)}const j=[];for(let X=0;X<8;X++){const H=[...i];a.aS(H,H,a.aR([],x,1&~X?-1:1)),a.aS(H,H,a.aR([],A,(X>>1&1)==1?1:-1)),a.aS(H,H,a.aR([],R,(X>>2&1)==1?1:-1)),j.push(H)}return new us(j,[[...x,-a.aX(x,j[0])],[...A,-a.aX(A,j[0])],[...R,-a.aX(R,j[0])],[-x[0],-x[1],-x[2],-a.aX(x,j[7])],[-A[0],-A[1],-A[2],-a.aX(A,j[7])],[-R[0],-R[1],-R[2],-a.aX(R,j[7])]],M,z)}intersectsFrustum(i){let d=!0;const p=this.points.length,_=this.planes.length,x=i.planes.length,A=i.points.length;for(let R=0;R<x;R++){const M=i.planes[R];let z=0;for(let j=0;j<p;j++){const X=this.points[j];M[0]*X[0]+M[1]*X[1]+M[2]*X[2]+M[3]>=0&&z++}if(z===0)return 0;z<p&&(d=!1)}if(d)return 2;for(let R=0;R<_;R++){const M=this.planes[R];let z=0;for(let j=0;j<A;j++){const X=i.points[j];M[0]*X[0]+M[1]*X[1]+M[2]*X[2]+M[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(i){const d=this.points.length;let p=0;for(let _=0;_<d;_++){const x=this.points[_];i[0]*x[0]+i[1]*x[1]+i[2]*x[2]+i[3]>=0&&p++}return p===d?2:p===0?0:1}}function Ma(y,i,d){const p=y-i;return p<0?-p:Math.max(0,p-d)}function Nu(y,i,d,p,_){const x=y-d;let A;return A=x<0?Math.min(-x,1+x-_):x>1?Math.min(Math.max(x-_,0),1-x):0,Math.max(A,Ma(i,p,_))}class yg{constructor(){this._boundingVolumeCache=new Hd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(i,d,p,_){const x=1<<p.z,A=1/x,R=p.x/x,M=p.y/x;let z=2;return z=Math.min(z,Nu(i,d,R,M,A)),z=Math.min(z,Nu(i,d,R+.5,-M-A,A)),z=Math.min(z,Nu(i,d,R+.5,2-M-A,A)),z}getWrap(i,d,p){const _=1<<d.z,x=1/_,A=d.x/_,R=Ma(i.x,A,x),M=Ma(i.x,A-1,x),z=Ma(i.x,A+1,x),j=Math.min(R,M,z);return j===z?1:j===M?-1:0}allowVariableZoom(i,d){return xr(i,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(i,d,p,_){return this._boundingVolumeCache.getTileBoundingVolume(i,d,p,_)}_computeTileBoundingVolume(i,d,p,_){var x,A;let R=0,M=0;if(_?.terrain){const z=new a.Z(i.z,d,i.z,i.x,i.y),j=_.terrain.getMinMaxElevation(z);R=(x=j.minElevation)!==null&&x!==void 0?x:Math.min(0,p),M=(A=j.maxElevation)!==null&&A!==void 0?A:Math.max(0,p)}if(R/=a.bu,M/=a.bu,R+=1,M+=1,i.z<=0)return us.fromAabb([-M,-M,-M],[M,M,M]);if(i.z===1)return us.fromAabb([i.x===0?-M:0,i.y===0?0:-M,-M],[i.x===0?0:M,i.y===0?M:0,M]);{const z=[Us(0,0,i.x,i.y,i.z),Us(a.$,0,i.x,i.y,i.z),Us(a.$,a.$,i.x,i.y,i.z),Us(0,a.$,i.x,i.y,i.z)],j=[];for(const lt of z)j.push(a.aR([],lt,M));if(M!==R)for(const lt of z)j.push(a.aR([],lt,R));i.y===0&&j.push([0,1,0]),i.y===(1<<i.z)-1&&j.push([0,-1,0]);const X=[1,1,1],H=[-1,-1,-1];for(const lt of j)for(let ft=0;ft<3;ft++)X[ft]=Math.min(X[ft],lt[ft]),H[ft]=Math.max(H[ft],lt[ft]);const Q=Us(a.$/2,a.$/2,i.x,i.y,i.z),re=a.aW([],[0,1,0],Q);a.aV(re,re);const he=a.aW([],Q,re);a.aV(he,he);const de=a.aW([],z[2],z[1]);a.aV(de,de);const ge=a.aW([],z[0],z[3]);a.aV(ge,ge),j.push(a.aR([],Q,M)),i.y>=(1<<i.z)/2&&j.push(a.aR([],Us(a.$/2,0,i.x,i.y,i.z),M)),i.y<(1<<i.z)/2&&j.push(a.aR([],Us(a.$/2,a.$,i.x,i.y,i.z),M));const Pe=ka(Q,j),De=ka(he,j),Ee=[-Q[0],-Q[1],-Q[2],Pe.max],Oe=[Q[0],Q[1],Q[2],-Pe.min],Ue=[-he[0],-he[1],-he[2],De.max],Me=[he[0],he[1],he[2],-De.min],He=[...de,0],dt=[...ge,0],ot=[];return i.y===0?ot.push(a.bt(dt,He,Ee),a.bt(dt,He,Oe)):ot.push(a.bt(Ue,He,Ee),a.bt(Ue,He,Oe),a.bt(Ue,dt,Ee),a.bt(Ue,dt,Oe)),i.y===(1<<i.z)-1?ot.push(a.bt(dt,He,Ee),a.bt(dt,He,Oe)):ot.push(a.bt(Me,He,Ee),a.bt(Me,He,Oe),a.bt(Me,dt,Ee),a.bt(Me,dt,Oe)),new us(ot,[Ee,Oe,Ue,Me,He,dt],X,H)}}}function ka(y,i){let d=1/0,p=-1/0;for(const _ of i){const x=a.aX(y,_);d=Math.min(d,x),p=Math.max(p,x)}return{min:d,max:p}}class Lu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,d,p){return this._helper.interpolatePadding(i,d,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,d){this._helper.resize(i,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}setConstrain(i){this._helper.setConstrain(i)}overrideNearFarZ(i,d){this._helper.overrideNearFarZ(i,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(i){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(d,p)=>{const _=a.ae(d.lat,-a.af,a.af),x=a.ae(+p,this.minZoom+Ei(0,_),this.maxZoom);return{center:new a.S(d.lng,_),zoom:x}},this._helper=new Si({calcMatrices:()=>{this._calcMatrices()},constrain:(d,p)=>this.defaultConstrain(d,p)},i),this._coveringTilesDetailsProvider=new yg}clone(){const i=new Lu;return i.apply(this),i}apply(i,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=a.bp();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:d,applyGlobeMatrix:p}=i,_=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:_,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const d=this.pitchInRadians,p=this.cameraToCenterDistance/i,_=Math.sin(d)*p,x=Math.cos(d)*p+1,A=1/Math.sqrt(_*_+x*x)*1;let R=-_,M=x;const z=Math.sqrt(R*R+M*M);R/=z,M/=z;const j=[0,R,M];a.bw(j,j,[0,0,0],-this.bearingInRadians),a.bx(j,j,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(j,j,[0,0,0],this.center.lng*Math.PI/180);const X=1/a.aZ(j);return a.aR(j,j,X),[...j,-A*X]}isLocationOccluded(i){return!this.isSurfacePointVisible(Ai(i))}transformLightDirection(i){const d=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,_=Math.cos(p),x=[Math.sin(d)*_,Math.sin(p),Math.cos(d)*_],A=[x[2],0,-x[0]],R=[0,0,0];a.aW(R,A,x),a.aV(A,A),a.aV(R,R);const M=[0,0,0];return a.aV(M,[A[0]*i[0]+R[0]*i[1]+x[0]*i[2],A[1]*i[0]+R[1]*i[1]+x[1]*i[2],A[2]*i[0]+R[2]*i[1]+x[2]*i[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,d,p){const _=(function(R,M,z){const j=1/(1<<z.z);return new a.a1(R/a.$*j+z.x*j,M/a.$*j+z.y*j)})(i,d,p.canonical),x=(A=_.y,[a.bo(_.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-A*Math.PI*2))-.5*Math.PI]);var A;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(i,d,p,_){const x=p.canonical,A=Us(i,d,x.x,x.y,x.z),R=1+(_?_(i,d):0)/a.bu,M=[A[0]*R,A[1]*R,A[2]*R,1];a.aw(M,M,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,j=z[0]*A[0]+z[1]*A[1]+z[2]*A[2]+z[3]<0;return{point:new a.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:j}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=Ko(this.worldSize,this.center.lat),d=a.ba(),p=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),a.b4(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const _=this.centerOffset;d[8]=2*-_.x/this._helper._width,d[9]=2*_.y/this._helper._height,this._projectionMatrix=a.b5(d),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,d),a.M(d,d,[0,0,-this.cameraToCenterDistance]),a.b6(d,d,this.rollInRadians),a.b7(d,d,-this.pitchInRadians),a.b6(d,d,this.bearingInRadians),a.M(d,d,[0,0,-i]);const x=a.bp();x[0]=i,x[1]=i,x[2]=i,a.b7(p,d,this.center.lat*Math.PI/180),a.bz(p,p,-this.center.lng*Math.PI/180),a.N(p,p,x),this._globeViewProjMatrixNoCorrection=p,a.b7(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(d,d,-this.center.lng*Math.PI/180),a.N(d,d,x),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,p);const A=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/i,a.bw(this._cameraPosition,this._cameraPosition,A,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,A,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,A,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,A,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,A,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const R=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(R,R,[1,1,-1]),this._cachedFrustum=Hi.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(i){a.w("calculateFogMatrix is not supported on globe projection.");const d=a.ba();return a.ai(d),d}getVisibleUnwrappedCoordinates(i){return[new a.b2(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const p=Ai(i);a.aR(p,p,1+d/a.bu);const _=a.bv();return a.aw(_,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),_[2]/_[3]}populateCache(i){}getBounds(){const i=.5*this.width,d=.5*this.height,p=[new a.P(0,0),new a.P(i,0),new a.P(this.width,0),new a.P(this.width,d),new a.P(this.width,this.height),new a.P(i,this.height),new a.P(0,this.height),new a.P(0,d)],_=[];for(const X of p)_.push(this.unprojectScreenPoint(X));let x=0,A=0,R=0,M=0;const z=this.center;for(const X of _){const H=a.bA(z.lng,X.lng),Q=a.bA(z.lat,X.lat);H<A&&(A=H),H>x&&(x=H),Q<M&&(M=Q),Q>R&&(R=Q)}const j=[z.lng+A,z.lat+M,z.lng+x,z.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(j[3]=90,j[0]=-180,j[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(j[1]=-90,j[0]=-180,j[2]=180),new ut(j)}calculateCenterFromCameraLngLatAlt(i,d,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,d,p,_)}setLocationAtPoint(i,d){const p=Ai(this.unprojectScreenPoint(d)),_=Ai(i),x=a.bp();a.bB(x);const A=a.bp();a.by(A,p,x,-this.center.lng*Math.PI/180),a.bx(A,A,x,this.center.lat*Math.PI/180);const R=_[0]*_[0]+_[2]*_[2],M=A[0]*A[0];if(R<M)return;const z=Math.sqrt(R-M),j=-z,X=a.bC(_[0],_[2],A[0],z),H=a.bC(_[0],_[2],A[0],j),Q=a.bp();a.by(Q,_,x,-X);const re=a.bC(Q[1],Q[2],A[1],A[2]),he=a.bp();a.by(he,_,x,-H);const de=a.bC(he[1],he[2],A[1],A[2]),ge=.5*Math.PI,Pe=re>=-ge&&re<=ge,De=de>=-ge&&de<=ge;let Ee,Oe;if(Pe&&De){const dt=this.center.lng*Math.PI/180,ot=this.center.lat*Math.PI/180;a.bD(X,dt)+a.bD(re,ot)<a.bD(H,dt)+a.bD(de,ot)?(Ee=X,Oe=re):(Ee=H,Oe=de)}else if(Pe)Ee=X,Oe=re;else{if(!De)return;Ee=H,Oe=de}const Ue=Ee/Math.PI*180,Me=Oe/Math.PI*180,He=this.center.lat;this.setCenter(new a.S(Ue,a.ae(Me,-90,90))),this.setZoom(this.zoom+Ei(He,this.center.lat))}locationToScreenPoint(i,d){const p=Ai(i);if(d){const _=d.getElevationForLngLatZoom(i,this._helper._tileZoom);a.aR(p,p,1+_/a.bu)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(i){const d=a.bv();return a.aw(d,[...i,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new a.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,d){if(d){const p=d.pointCoordinate(i);if(p)return p}return a.a1.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,d){var p;return(p=this.screenPointToMercatorCoordinate(i,d))===null||p===void 0?void 0:p.toLngLat()}isPointOnMapSurface(i,d){const p=this._cameraPosition,_=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(p,_)}getRayDirectionFromPixel(i){const d=a.bv();d[0]=i.x/this.width*2-1,d[1]=-1*(i.y/this.height*2-1),d[2]=1,d[3]=1,a.aw(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const p=a.bp();p[0]=d[0]-this._cameraPosition[0],p[1]=d[1]-this._cameraPosition[1],p[2]=d[2]-this._cameraPosition[2];const _=a.bp();return a.aV(_,p),_}isSurfacePointVisible(i){const d=this._cachedClippingPlane;return d[0]*i[0]+d[1]*i[1]+d[2]*i[2]+d[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const d=a.bv();return a.aw(d,[...i,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(i,d){const p=a.aX(i,d),_=a.bp(),x=a.bp();a.aR(x,d,p),a.aU(_,i,x);const A=1-a.aX(_,_);if(A<0)return null;const R=a.aX(i,i)-1,M=-p+(p<0?1:-1)*Math.sqrt(A),z=R/M,j=M;return{tMin:Math.min(z,j),tMax:Math.max(z,j)}}unprojectScreenPoint(i){const d=this._cameraPosition,p=this.getRayDirectionFromPixel(i),_=this.rayPlanetIntersection(d,p);if(_){const j=a.bp();a.aS(j,d,[p[0]*_.tMin,p[1]*_.tMin,p[2]*_.tMin]);const X=a.bp();return a.aV(X,j),mg(X)}const x=this._cachedClippingPlane,A=x[0]*p[0]+x[1]*p[1]+x[2]*p[2],R=-a.b1(x,d)/A,M=a.bp();if(R>0)a.aS(M,d,[p[0]*R,p[1]*R,p[2]*R]);else{const j=a.bp();a.aS(j,d,[2*p[0],2*p[1],2*p[2]]);const X=a.b1(this._cachedClippingPlane,j);a.aU(M,j,[this._cachedClippingPlane[0]*X,this._cachedClippingPlane[1]*X,this._cachedClippingPlane[2]*X])}const z=(function(j){const X=a.bp();return X[0]=j[0]*-j[3],X[1]=j[1]*-j[3],X[2]=j[2]*-j[3],{center:X,radius:Math.sqrt(1-j[3]*j[3])}})(x);return mg((function(j,X,H){const Q=a.bp();a.aU(Q,H,j);const re=a.bp();return a.bq(re,j,Q,X/a.a$(Q)),re})(z.center,z.radius,M))}getMatrixForModel(i,d){const p=a.S.convert(i),_=1/a.bu,x=a.b9();return a.bz(x,x,p.lng/180*Math.PI),a.b7(x,x,-p.lat/180*Math.PI),a.M(x,x,[0,0,1+d/a.bu]),a.b7(x,x,.5*Math.PI),a.N(x,x,[_,_,_]),x}getProjectionDataForCustomLayer(i=!0){const d=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:i});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(i){}}class Bu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,d,p){return this._helper.interpolatePadding(i,d,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,d,p=!0){this._helper.resize(i,d,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}setConstrain(i){this._helper.setConstrain(i)}overrideNearFarZ(i,d){this._helper.overrideNearFarZ(i,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,d){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(i){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(d,p)=>this.currentTransform.defaultConstrain(d,p),this._helper=new Si({calcMatrices:()=>{this._calcMatrices()},constrain:(d,p)=>this.defaultConstrain(d,p)},i),this._globeness=1,this._mercatorTransform=new Zi,this._verticalPerspectiveTransform=new Lu}clone(){const i=new Bu;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const d=this._mercatorTransform.getProjectionData(i),p=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:d.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,d,p){const _=this._mercatorTransform.getPitchedTextCorrection(i,d,p),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,d,p);return a.bk(_,x,this._globeness)}projectTileCoordinates(i,d,p,_){return this.currentTransform.projectTileCoordinates(i,d,p,_)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,d){return this.currentTransform.lngLatToCameraDepth(i,d)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(i,d,p,_){return this._helper.calculateCenterFromCameraLngLatAlt(i,d,p,_)}setLocationAtPoint(i,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,d),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,d),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,d){return this.currentTransform.locationToScreenPoint(i,d)}screenPointToMercatorCoordinate(i,d){return this.currentTransform.screenPointToMercatorCoordinate(i,d)}screenPointToLocation(i,d){return this.currentTransform.screenPointToLocation(i,d)}isPointOnMapSurface(i,d){return this.currentTransform.isPointOnMapSurface(i,d)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,d){return this.currentTransform.getMatrixForModel(i,d)}getProjectionDataForCustomLayer(i=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return d;const p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return p.fallbackMatrix=d.mainMatrix,p}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class Vs{get useGlobeControls(){return!0}handlePanInertia(i,d){const p=_g(i,d);return Math.abs(p.lng-d.center.lng)>180&&(p.lng=d.center.lng+179.5*Math.sign(p.lng-d.center.lng)),{easingCenter:p,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,d){const p=i.around,_=d.screenPointToLocation(p);i.bearingDelta&&d.setBearing(d.bearing+i.bearingDelta),i.pitchDelta&&d.setPitch(d.pitch+i.pitchDelta),i.rollDelta&&d.setRoll(d.roll+i.rollDelta);const x=d.zoom;i.zoomDelta&&d.setZoom(d.zoom+i.zoomDelta);const A=d.zoom-x;if(A===0)return;const R=a.bA(d.center.lng,_.lng),M=R/(Math.abs(R/180)+1),z=a.bA(d.center.lat,_.lat),j=d.getRayDirectionFromPixel(p),X=d.cameraPosition,H=-1*a.aX(X,j),Q=a.bp();a.aS(Q,X,[j[0]*H,j[1]*H,j[2]*H]);const re=a.aZ(Q)-1,he=Math.exp(.5*-Math.max(re-.3,0)),de=Ko(d.worldSize,d.center.lat)/Math.min(d.width,d.height),ge=a.bn(de,.9,.5,1,.25),Pe=(1-a.ah(-A))*Math.min(he,ge),De=d.center.lat,Ee=d.zoom,Oe=new a.S(d.center.lng+M*Pe,a.ae(d.center.lat+z*Pe,-a.af,a.af));d.setLocationAtPoint(_,p);const Ue=d.center,Me=a.bn(Math.abs(R),45,85,0,1),He=a.bn(de,.75,.35,0,1),dt=Math.pow(Math.max(Me,He),.25),ot=a.bA(Ue.lng,Oe.lng),lt=a.bA(Ue.lat,Oe.lat);d.setCenter(new a.S(Ue.lng+ot*dt,Ue.lat+lt*dt).wrap()),d.setZoom(Ee+Ei(De,d.center.lat))}handleMapControlsPan(i,d,p){if(!i.panDelta)return;const _=d.center.lat,x=d.zoom;d.setCenter(_g(i.panDelta,d).wrap()),d.setZoom(x+Ei(_,d.center.lat))}cameraForBoxAndBearing(i,d,p,_,x){const A=hl(i,d,p,_,x),R=d.left/x.width*2-1,M=(x.width-d.right)/x.width*2-1,z=d.top/x.height*-2+1,j=(x.height-d.bottom)/x.height*-2+1,X=a.bA(p.getWest(),p.getEast())<0,H=X?p.getEast():p.getWest(),Q=X?p.getWest():p.getEast(),re=Math.max(p.getNorth(),p.getSouth()),he=Math.min(p.getNorth(),p.getSouth()),de=H+.5*a.bA(H,Q),ge=re+.5*a.bA(re,he),Pe=x.clone();Pe.setCenter(A.center),Pe.setBearing(A.bearing),Pe.setPitch(0),Pe.setRoll(0),Pe.setZoom(A.zoom);const De=Pe.modelViewProjectionMatrix,Ee=[Ai(p.getNorthWest()),Ai(p.getNorthEast()),Ai(p.getSouthWest()),Ai(p.getSouthEast()),Ai(new a.S(Q,ge)),Ai(new a.S(H,ge)),Ai(new a.S(de,re)),Ai(new a.S(de,he))],Oe=Ai(A.center);let Ue=Number.POSITIVE_INFINITY;for(const Me of Ee)R<0&&(Ue=Vs.getLesserNonNegativeNonNull(Ue,Vs.solveVectorScale(Me,Oe,De,"x",R))),M>0&&(Ue=Vs.getLesserNonNegativeNonNull(Ue,Vs.solveVectorScale(Me,Oe,De,"x",M))),z>0&&(Ue=Vs.getLesserNonNegativeNonNull(Ue,Vs.solveVectorScale(Me,Oe,De,"y",z))),j<0&&(Ue=Vs.getLesserNonNegativeNonNull(Ue,Vs.solveVectorScale(Me,Oe,De,"y",j)));if(Number.isFinite(Ue)&&Ue!==0)return A.zoom=Pe.zoom+a.ak(Ue),A;gs()}handleJumpToCenterZoom(i,d){const p=i.center.lat,_=i.constrain(d.center?a.S.convert(d.center):i.center,i.zoom).center;i.setCenter(_.wrap());const x=d.zoom!==void 0?+d.zoom:i.zoom+Ei(p,_.lat);i.zoom!==x&&i.setZoom(x)}handleEaseTo(i,d){const p=i.zoom,_=i.center,x=i.padding,A={roll:i.roll,pitch:i.pitch,bearing:i.bearing},R={roll:d.roll===void 0?i.roll:d.roll,pitch:d.pitch===void 0?i.pitch:d.pitch,bearing:d.bearing===void 0?i.bearing:d.bearing},M=d.zoom!==void 0,z=!i.isPaddingEqual(d.padding);let j=!1;const X=d.center?a.S.convert(d.center):_,H=i.constrain(X,p).center;ki(i,H);const Q=i.clone();Q.setCenter(H),Q.setZoom(M?+d.zoom:p+Ei(_.lat,X.lat)),Q.setBearing(d.bearing);const re=new a.P(a.ae(i.centerPoint.x+d.offsetAsPoint.x,0,i.width),a.ae(i.centerPoint.y+d.offsetAsPoint.y,0,i.height));Q.setLocationAtPoint(H,re);const he=(d.offset&&d.offsetAsPoint.mag())>0?Q.center:H,de=M?+d.zoom:p+Ei(_.lat,he.lat),ge=p+Ei(_.lat,0),Pe=de+Ei(he.lat,0),De=a.bA(_.lng,he.lng),Ee=a.bA(_.lat,he.lat),Oe=a.ah(Pe-ge);return j=de!==p,{easeFunc:Ue=>{if(a.be(A,R)||jd({startEulerAngles:A,endEulerAngles:R,tr:i,k:Ue,useSlerp:A.roll!=R.roll}),z&&i.interpolatePadding(x,d.padding,Ue),d.around)a.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(d.around,d.aroundPoint);else{const Me=Pe>ge?Math.min(2,Oe):Math.max(.5,Oe),He=Math.pow(Me,1-Ue),dt=cs(_,De,Ee,Ue*He);i.setCenter(dt.wrap())}if(j){const Me=a.C.number(ge,Pe,Ue)+Ei(0,i.center.lat);i.setZoom(Me)}},isZooming:j,elevationCenter:he}}handleFlyTo(i,d){const p=d.zoom!==void 0,_=i.center,x=i.zoom,A=i.padding,R=!i.isPaddingEqual(d.padding),M=i.constrain(a.S.convert(d.center||d.locationAtOffset),x).center,z=p?+d.zoom:i.zoom+Ei(i.center.lat,M.lat),j=i.clone();j.setCenter(M),j.setZoom(z),j.setBearing(d.bearing);const X=new a.P(a.ae(i.centerPoint.x+d.offsetAsPoint.x,0,i.width),a.ae(i.centerPoint.y+d.offsetAsPoint.y,0,i.height));j.setLocationAtPoint(M,X);const H=j.center;ki(i,H);const Q=(function(Ee,Oe,Ue){const Me=Ai(Oe),He=Ai(Ue),dt=a.aX(Me,He),ot=Math.acos(dt),lt=Fu(Ee);return ot/(2*Math.PI)*lt})(i,_,H),re=x+Ei(_.lat,0),he=z+Ei(H.lat,0),de=a.ah(he-re);let ge;if(typeof d.minZoom=="number"){const Ee=+d.minZoom+Ei(H.lat,0),Oe=Math.min(Ee,re,he)+Ei(0,H.lat),Ue=i.constrain(H,Oe).zoom+Ei(H.lat,0);ge=a.ah(Ue-re)}const Pe=a.bA(_.lng,H.lng),De=a.bA(_.lat,H.lat);return{easeFunc:(Ee,Oe,Ue,Me)=>{const He=cs(_,Pe,De,Ue);R&&i.interpolatePadding(A,d.padding,Ee);const dt=Ee===1?H:He;i.setCenter(dt.wrap());const ot=re+a.ak(Oe);i.setZoom(Ee===1?z:ot+Ei(0,dt.lat))},scaleOfZoom:de,targetCenter:H,scaleOfMinZoom:ge,pixelPathLength:Q}}static solveVectorScale(i,d,p,_,x){const A=_==="x"?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],R=[p[3],p[7],p[11],p[15]],M=i[0]*A[0]+i[1]*A[1]+i[2]*A[2],z=i[0]*R[0]+i[1]*R[1]+i[2]*R[2],j=d[0]*A[0]+d[1]*A[1]+d[2]*A[2],X=d[0]*R[0]+d[1]*R[1]+d[2]*R[2];return j+x*z===M+x*X||R[3]*(M-j)+A[3]*(X-z)+M*X==j*z?null:(j+A[3]-x*X-x*R[3])/(j-M-x*X+x*z)}static getLesserNonNegativeNonNull(i,d){return d!==null&&d>=0&&d<i?d:i}}class vg{constructor(i){this._globe=i,this._mercatorCameraHelper=new Qn,this._verticalPerspectiveCameraHelper=new Vs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,d){return this.currentHelper.handlePanInertia(i,d)}handleMapControlsRollPitchBearingZoom(i,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,d)}handleMapControlsPan(i,d,p){this.currentHelper.handleMapControlsPan(i,d,p)}cameraForBoxAndBearing(i,d,p,_,x){return this.currentHelper.cameraForBoxAndBearing(i,d,p,_,x)}handleJumpToCenterZoom(i,d){this.currentHelper.handleJumpToCenterZoom(i,d)}handleEaseTo(i,d){return this.currentHelper.handleEaseTo(i,d)}handleFlyTo(i,d){return this.currentHelper.handleFlyTo(i,d)}}const zu=(y,i)=>a.y(y,i&&i.filter((d=>d.identifier!=="source.canvas"))),Fy=a.bE();class pl extends a.E{constructor(i,d={}){var p,_;super(),this._rtlPluginLoaded=()=>{for(const A in this.sourceCaches){const R=this.sourceCaches[A].getSource().type;R!=="vector"&&R!=="geojson"||this.sourceCaches[A].reload()}},this.map=i,this.dispatcher=new Et(Dr(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",((A,R)=>this.getGlyphs(A,R))),this.dispatcher.registerMessageHandler("GI",((A,R)=>this.getImages(A,R))),this.dispatcher.registerMessageHandler("GDA",((A,R)=>this.getDashes(A,R))),this.imageManager=new xe,this.imageManager.setEventedParent(this);const x=((p=i._container)===null||p===void 0?void 0:p.lang)||typeof document<"u"&&((_=document.documentElement)===null||_===void 0?void 0:_.lang)||void 0;this.glyphManager=new Le(i._requestManager,d.localIdeographFontFamily,x),this.lineAtlas=new Mt(256,512),this.crossTileSymbolIndex=new Io,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),or().on(Cr,this._rtlPluginLoaded),this.on("data",(A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const R=this.sourceCaches[A.sourceId];if(!R)return;const M=R.getSource();if(M&&M.vectorLayerIds)for(const z in this._layers){const j=this._layers[z];j.source===M.id&&this._validateLayer(j)}}))}setGlobalStateProperty(i,d){var p,_,x;this._checkLoaded();const A=d===null?(x=(_=(p=this.stylesheet.state)===null||p===void 0?void 0:p[i])===null||_===void 0?void 0:_.default)!==null&&x!==void 0?x:null:d;if(a.bH(A,this._globalState[i]))return this;this._globalState[i]=A,this._applyGlobalStateChanges([i])}getGlobalState(){return this._globalState}setGlobalState(i){this._checkLoaded();const d=[];for(const p in i)!a.bH(this._globalState[p],i[p].default)&&(d.push(p),this._globalState[p]=i[p].default);this._applyGlobalStateChanges(d)}_applyGlobalStateChanges(i){if(i.length===0)return;const d=new Set,p={};for(const _ of i){p[_]=this._globalState[_];for(const x in this._layers){const A=this._layers[x],R=A.getLayoutAffectingGlobalStateRefs(),M=A.getPaintAffectingGlobalStateRefs();if(R.has(_)&&d.add(A.source),M.has(_))for(const{name:z,value:j}of M.get(_))this._updatePaintProperty(A,z,j)}}this.dispatcher.broadcast("UGS",p);for(const _ in this.sourceCaches)d.has(_)&&(this._reloadSource(_),this._changed=!0)}loadURL(i,d={},p){this.fire(new a.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const _=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;a.j(_,this._loadStyleRequest).then((A=>{this._loadStyleRequest=null,this._load(A.data,d,p)})).catch((A=>{this._loadStyleRequest=null,A&&!x.signal.aborted&&this.fire(new a.k(A))}))}loadJSON(i,d={},p){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(i,d,p)})).catch((()=>{}))}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Fy,{validate:!1})}_load(i,d,p){var _,x;let A=d.transformStyle?d.transformStyle(p,i):i;if(!d.validate||!zu(this,a.z(A))){A=Object.assign({},A),this._loaded=!0,this.stylesheet=A;for(const R in A.sources)this.addSource(R,A.sources[R],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new rt(this.stylesheet.light),this._setProjectionInternal(((_=this.stylesheet.projection)===null||_===void 0?void 0:_.type)||"mercator"),this.sky=new Ct(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){var i,d,p;const _=a.bI(this.stylesheet.layers);this.setGlobalState((i=this.stylesheet.state)!==null&&i!==void 0?i:null),this.dispatcher.broadcast("SL",_),this._order=_.map((x=>x.id)),this._layers={},this._serializedLayers=null;for(const x of _){const A=a.bJ(x,this._globalState);if(A.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=A,a.bK(A)&&this.sourceCaches[A.source]){const R=(p=(d=x.paint)===null||d===void 0?void 0:d["raster-fade-duration"])!==null&&p!==void 0?p:A.paint.get("raster-fade-duration");this.sourceCaches[A.source].setRasterFadeDuration(R)}}}_loadSprite(i,d=!1,p=void 0){let _;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(x,A,R,M){return a._(this,void 0,void 0,(function*(){const z=se(x),j=R>1?"@2x":"",X={},H={};for(const{id:Q,url:re}of z){const he=A.transformRequest(oe(re,j,".json"),"SpriteJSON");X[Q]=a.j(he,M);const de=A.transformRequest(oe(re,j,".png"),"SpriteImage");H[Q]=G.getImage(de,M)}return yield Promise.all([...Object.values(X),...Object.values(H)]),(function(Q,re){return a._(this,void 0,void 0,(function*(){const he={};for(const de in Q){he[de]={};const ge=I.getImageCanvasContext((yield re[de]).data),Pe=(yield Q[de]).data;for(const De in Pe){const{width:Ee,height:Oe,x:Ue,y:Me,sdf:He,pixelRatio:dt,stretchX:ot,stretchY:lt,content:ft,textFitWidth:Vt,textFitHeight:$t}=Pe[De];he[de][De]={data:null,pixelRatio:dt,sdf:He,stretchX:ot,stretchY:lt,content:ft,textFitWidth:Vt,textFitHeight:$t,spriteData:{width:Ee,height:Oe,x:Ue,y:Me,context:ge}}}}return he}))})(X,H)}))})(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((x=>{if(this._spriteRequest=null,x)for(const A in x){this._spritesImagesIds[A]=[];const R=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter((M=>!(M in x))):[];for(const M of R)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in x[A]){const z=A==="default"?M:`${A}:${M}`;this._spritesImagesIds[A].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,x[A][M],!1):this.imageManager.addImage(z,x[A][M]),d&&(this._changedImages[z]=!0)}}})).catch((x=>{this._spriteRequest=null,_=x,this.fire(new a.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),p&&p(_)}))}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(i){const d=this.sourceCaches[i.source];if(!d)return;const p=i.sourceLayer;if(!p)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.k(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,d=!1){const p=this._serializedAllLayers();if(!i||i.length===0)return Object.values(d?a.bL(p):p);const _=[];for(const x of i)if(p[x]){const A=d?a.bL(p[x]):p[x];_.push(A)}return _}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const d=Object.keys(this._layers);for(const p of d){const _=this._layers[p];_.type!=="custom"&&(i[p]=_.serialize())}return i}hasTransitions(){var i,d,p;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((p=this.projection)===null||p===void 0)&&p.hasTransition())return!0;for(const _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(const _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const d=this._changed;if(d){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const A in this._updatedSources){const R=this._updatedSources[A];if(R==="reload")this._reloadSource(A);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(i,this._availableImages),!x.isHidden(i.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in p){const x=this.sourceCaches[_];!!p[_]!=!!x.used&&x.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,d&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,d={}){var p;this._checkLoaded();const _=this.serialize();if(i=d.transformStyle?d.transformStyle(_,i):i,((p=d.validate)===null||p===void 0||p)&&zu(this,a.z(i)))return!1;(i=a.bL(i)).layers=a.bI(i.layers);const x=a.bM(_,i),A=this._getOperationsToPerform(x);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const R of A.operations)R();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const d=[],p=[];for(const _ of i)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,_.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,_.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,_.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,_.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,_.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,_.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,_.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,_.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,_.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,_.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,_.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,_.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,_.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,_.args)));break;case"setProjection":this.setProjection.apply(this,_.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,_.args)));break;case"setTransition":d.push((()=>{}));break;default:p.push(_.command)}return{operations:d,unimplemented:p}}addImage(i,d){if(this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,d),this._afterImageUpdated(i)}updateImage(i,d){this.imageManager.updateImage(i,d)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,d,p={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.z.source,`sources.${i}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[i]=new Lr(i,d,this.dispatcher);_.style=this,_.setEventedParent(this,(()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:i}))),_.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new a.k(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],d.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,d){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const p=this.sourceCaches[i].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,d,p={}){this._checkLoaded();const _=i.id;if(this.getLayer(_))return void this.fire(new a.k(new Error(`Layer "${_}" already exists on this map.`)));let x;if(i.type==="custom"){if(zu(this,a.bN(i)))return;x=a.bJ(i,this._globalState)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(_,i.source),i=a.bL(i),i=a.e(i,{source:_})),this._validate(a.z.layer,`layers.${_}`,i,{arrayIndex:-1},p))return;x=a.bJ(i,this._globalState),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}})}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)this.fire(new a.k(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(A,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(i,d){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.k(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===d)return;const p=this._order.indexOf(i);this._order.splice(p,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new a.k(new Error(`Cannot move layer "${i}" before non-existing layer "${d}".`))):(this._order.splice(_,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const d=this._layers[i];if(!d)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${i}".`)));d.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=d,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],d.onRemove&&d.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,d,p){this._checkLoaded();const _=this.getLayer(i);_?_.minzoom===d&&_.maxzoom===p||(d!=null&&(_.minzoom=d),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,d,p={}){this._checkLoaded();const _=this.getLayer(i);if(_){if(!a.bH(_.filter,d))return d==null?(_.setFilter(void 0),void this._updateLayer(_)):void(this._validate(a.z.filter,`layers.${_.id}.filter`,d,null,p)||(_.setFilter(a.bL(d)),this._updateLayer(_)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.bL(this.getLayer(i).filter)}setLayoutProperty(i,d,p,_={}){this._checkLoaded();const x=this.getLayer(i);x?a.bH(x.getLayoutProperty(d),p)||(x.setLayoutProperty(d,p,_),this._updateLayer(x)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,d){const p=this.getLayer(i);if(p)return p.getLayoutProperty(d);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,d,p,_={}){this._checkLoaded();const x=this.getLayer(i);x?a.bH(x.getPaintProperty(d),p)||this._updatePaintProperty(x,d,p,_):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}_updatePaintProperty(i,d,p,_={}){i.setPaintProperty(d,p,_)&&this._updateLayer(i),a.bK(i)&&d==="raster-fade-duration"&&this.sourceCaches[i.source].setRasterFadeDuration(p),this._changed=!0,this._updatedPaintProps[i.id]=!0,this._serializedLayers=null}getPaintProperty(i,d){return this.getLayer(i).getPaintProperty(d)}setFeatureState(i,d){this._checkLoaded();const p=i.source,_=i.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const A=x.getSource().type;A==="geojson"&&_?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||_?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,i.id,d)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,d){this._checkLoaded();const p=i.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.getSource().type,A=x==="vector"?i.sourceLayer:void 0;x!=="vector"||A?d&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(A,i.id,d):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const d=i.source,p=i.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||p?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,i.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.bO(this.sourceCaches,(x=>x.serialize())),d=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,_=this.stylesheet;return a.bP({version:_.version,name:_.name,metadata:_.metadata,light:_.light,sky:_.sky,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,projection:_.projection,sources:i,layers:d,terrain:p},(x=>x!==void 0))}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const d=A=>this._layers[A].type==="fill-extrusion",p={},_=[];for(let A=this._order.length-1;A>=0;A--){const R=this._order[A];if(d(R)){p[R]=A;for(const M of i){const z=M[R];if(z)for(const j of z)_.push(j)}}}_.sort(((A,R)=>R.intersectionZ-A.intersectionZ));const x=[];for(let A=this._order.length-1;A>=0;A--){const R=this._order[A];if(d(R))for(let M=_.length-1;M>=0;M--){const z=_[M].feature;if(p[z.layer.id]<A)break;x.push(z),_.pop()}else for(const M of i){const z=M[R];if(z)for(const j of z)x.push(j.feature)}}return x}queryRenderedFeatures(i,d,p){d&&d.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of d.layers){const j=this._layers[z];if(!j)return this.fire(new a.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];_[j.source]=!0}}const x=[];d.availableImages=this._availableImages;const A=this._serializedAllLayers(),R=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,M=Object.assign(Object.assign({},d),{layers:R,globalState:this._globalState});for(const z in this.sourceCaches)d.layers&&!_[z]||x.push(yr(this.sourceCaches[z],this._layers,A,i,M,p,this.map.terrain?(j,X,H)=>this.map.terrain.getElevation(j,X,H):void 0));return this.placement&&x.push((function(z,j,X,H,Q,re,he){const de={},ge=re.queryRenderedSymbols(H),Pe=[];for(const De of Object.keys(ge).map(Number))Pe.push(he[De]);Pe.sort(Ar);for(const De of Pe){const Ee=De.featureIndex.lookupSymbolFeatures(ge[De.bucketInstanceId],j,De.bucketIndex,De.sourceLayerIndex,{filterSpec:Q.filter,globalState:Q.globalState},Q.layers,Q.availableImages,z);for(const Oe in Ee){const Ue=de[Oe]=de[Oe]||[],Me=Ee[Oe];Me.sort(((He,dt)=>{const ot=De.featureSortOrder;if(ot){const lt=ot.indexOf(He.featureIndex);return ot.indexOf(dt.featureIndex)-lt}return dt.featureIndex-He.featureIndex}));for(const He of Me)Ue.push(He)}}return(function(De,Ee,Oe){for(const Ue in De)for(const Me of De[Ue])br(Me,Oe[Ee[Ue].source]);return De})(de,z,X)})(this._layers,A,this.sourceCaches,i,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(i,d){d?.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[i];return p?(function(_,x){const A=_.getRenderableIds().map((z=>_.getTileByID(z))),R=[],M={};for(let z=0;z<A.length;z++){const j=A[z],X=j.tileID.canonical.key;M[X]||(M[X]=!0,j.querySourceFeatures(R,x))}return R})(p,d?Object.assign(Object.assign({},d),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(i,d={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const A in i)if(!a.bH(i[A],p[A])){_=!0;break}if(!_)return;const x={now:N(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,d),this.light.updateTransitions(x)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,d={}){this._checkLoaded();const p=this.getSky();let _=!1;if(!i&&!p)return;if(i&&!p)_=!0;else if(!i&&p)_=!0;else for(const A in i)if(!a.bH(i[A],p[A])){_=!0;break}if(!_)return;const x={now:N(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,d),this.sky.updateTransitions(x)}_setProjectionInternal(i){const d=(function(p,_){const x={constrain:_};if(Array.isArray(p)){const A=new Ou({type:p});return{projection:A,transform:new Bu(x),cameraHelper:new vg(A)}}switch(p){case"mercator":return{projection:new gc,transform:new Zi(x),cameraHelper:new Qn};case"globe":{const A=new Ou({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:A,transform:new Bu(x),cameraHelper:new vg(A)}}case"vertical-perspective":return{projection:new ku,transform:new Lu(x),cameraHelper:new Vs};default:return a.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new gc,transform:new Zi(x),cameraHelper:new Qn}}})(i,this.map.transformConstrain);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const p in this.sourceCaches)this.sourceCaches[p].reload()}_validate(i,d,p,_,x={}){return(!x||x.validate!==!1)&&zu(this,i.call(a.z,a.e({key:d,style:this.serialize(),value:p,styleSpec:a.v},_)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),or().off(Cr,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const p=this.sourceCaches[d];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const d in this.sourceCaches)this.sourceCaches[d].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,d,p,_,x=!1){let A=!1,R=!1;const M={};for(const z of this._order){const j=this._layers[z];if(j.type!=="symbol")continue;if(!M[j.source]){const H=this.sourceCaches[j.source];M[j.source]=H.getRenderableIds(!0).map((Q=>H.getTileByID(Q))).sort(((Q,re)=>re.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(re.tileID)?-1:1)))}const X=this.crossTileSymbolIndex.addLayer(j,M[j.source],i.center.lng);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N(),i.zoom))&&(this.pauseablePlacement=new pc(i,this.map.terrain,this._order,x,d,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N()),R=!0),A&&this.pauseablePlacement.placement.setStale()),R||A)for(const z of this._order){const j=this._layers[z];j.type==="symbol"&&this.placement.updateLayerOpacities(j,M[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,d){return a._(this,void 0,void 0,(function*(){const p=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,d.icons),p}))}getGlyphs(i,d){return a._(this,void 0,void 0,(function*(){const p=yield this.glyphManager.getGlyphs(d.stacks),_=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,[""]),p}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,d={}){this._checkLoaded(),i&&this._validate(a.z.glyphs,"glyphs",i,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}getDashes(i,d){return a._(this,void 0,void 0,(function*(){const p={};for(const[_,x]of Object.entries(d.dashes))p[_]=this.lineAtlas.getDash(x.dasharray,x.round);return p}))}addSprite(i,d,p={},_){this._checkLoaded();const x=[{id:i,url:d}],A=[...se(this.stylesheet.sprite),...x];this._validate(a.z.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(x,!0,_))}removeSprite(i){this._checkLoaded();const d=se(this.stylesheet.sprite);if(d.find((p=>p.id===i))){if(this._spritesImagesIds[i])for(const p of this._spritesImagesIds[i])this.imageManager.removeImage(p),this._changedImages[p]=!0;d.splice(d.findIndex((p=>p.id===i)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return se(this.stylesheet.sprite)}setSprite(i,d={},p){this._checkLoaded(),i&&this._validate(a.z.sprite,"sprite",i,null,d)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,p):(this._unloadSprite(),p&&p(null)))}}var Zd=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Uu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,d,p,_,x,A,R,M,z){this.context=i;let j=this.boundPaintVertexBuffers.length!==_.length;for(let X=0;!j&&X<_.length;X++)this.boundPaintVertexBuffers[X]!==_[X]&&(j=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||j||this.boundIndexBuffer!==x||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(d,p,_,x,A,R,M,z):(i.bindVertexArray.set(this.vao),R&&R.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind(),z&&z.bind())}freshBind(i,d,p,_,x,A,R,M){const z=i.numAttributes,j=this.context,X=j.gl;this.vao&&this.destroy(),this.vao=j.createVertexArray(),j.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=M,d.enableAttributes(X,i);for(const H of p)H.enableAttributes(X,i);A&&A.enableAttributes(X,i),R&&R.enableAttributes(X,i),M&&M.enableAttributes(X,i),d.bind(),d.setVertexAttribPointers(X,i,x);for(const H of p)H.bind(),H.setVertexAttribPointers(X,i,x);A&&(A.bind(),A.setVertexAttribPointers(X,i,x)),_&&_.bind(),R&&(R.bind(),R.setVertexAttribPointers(X,i,x)),M&&(M.bind(),M.setVertexAttribPointers(X,i,x)),j.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Xd=(y,i,d,p,_)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:i,u_fog_color:d?d.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?0:d?d.calculateFogBlendOpacity(p):0,u_horizon_color:d?d.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:_?1:0}),qd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ts(y){const i=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const p=y[d].split(" ");i.push(p.pop())}return i}class Ny{constructor(i,d,p,_,x,A,R,M,z=[]){const j=i.gl;this.program=j.createProgram();const X=Ts(d.staticAttributes),H=p?p.getBinderAttributes():[],Q=X.concat(H),re=oo.prelude.staticUniforms?Ts(oo.prelude.staticUniforms):[],he=R.staticUniforms?Ts(R.staticUniforms):[],de=d.staticUniforms?Ts(d.staticUniforms):[],ge=p?p.getBinderUniforms():[],Pe=re.concat(he).concat(de).concat(ge),De=[];for(const ot of Pe)De.indexOf(ot)<0&&De.push(ot);const Ee=p?p.defines():[];ao(j)&&Ee.unshift("#version 300 es"),x&&Ee.push("#define OVERDRAW_INSPECTOR;"),A&&Ee.push("#define TERRAIN3D;"),M&&Ee.push(M),z&&Ee.push(...z);let Oe=Ee.concat(oo.prelude.fragmentSource,R.fragmentSource,d.fragmentSource).join(`
`),Ue=Ee.concat(oo.prelude.vertexSource,R.vertexSource,d.vertexSource).join(`
`);ao(j)||(Oe=(function(ot){return ot.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Oe),Ue=(function(ot){return ot.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ue));const Me=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(Me,Oe),j.compileShader(Me),!j.getShaderParameter(Me,j.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${j.getShaderInfoLog(Me)}`);j.attachShader(this.program,Me);const He=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(He,Ue),j.compileShader(He),!j.getShaderParameter(He,j.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${j.getShaderInfoLog(He)}`);j.attachShader(this.program,He),this.attributes={};const dt={};this.numAttributes=Q.length;for(let ot=0;ot<this.numAttributes;ot++)Q[ot]&&(j.bindAttribLocation(this.program,ot,Q[ot]),this.attributes[Q[ot]]=ot);if(j.linkProgram(this.program),!j.getProgramParameter(this.program,j.LINK_STATUS))throw new Error(`Program failed to link: ${j.getProgramInfoLog(this.program)}`);j.deleteShader(He),j.deleteShader(Me);for(let ot=0;ot<De.length;ot++){const lt=De[ot];if(lt&&!dt[lt]){const ft=j.getUniformLocation(this.program,lt);ft&&(dt[lt]=ft)}}this.fixedUniforms=_(i,dt),this.terrainUniforms=((ot,lt)=>({u_depth:new a.bQ(ot,lt.u_depth),u_terrain:new a.bQ(ot,lt.u_terrain),u_terrain_dim:new a.bg(ot,lt.u_terrain_dim),u_terrain_matrix:new a.bS(ot,lt.u_terrain_matrix),u_terrain_unpack:new a.bT(ot,lt.u_terrain_unpack),u_terrain_exaggeration:new a.bg(ot,lt.u_terrain_exaggeration)}))(i,dt),this.projectionUniforms=((ot,lt)=>({u_projection_matrix:new a.bS(ot,lt.u_projection_matrix),u_projection_tile_mercator_coords:new a.bT(ot,lt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bT(ot,lt.u_projection_clipping_plane),u_projection_transition:new a.bg(ot,lt.u_projection_transition),u_projection_fallback_matrix:new a.bS(ot,lt.u_projection_fallback_matrix)}))(i,dt),this.binderUniforms=p?p.getUniforms(i,dt):[]}draw(i,d,p,_,x,A,R,M,z,j,X,H,Q,re,he,de,ge,Pe,De){const Ee=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(_),i.setColorMode(x),i.setCullFace(A),M){i.activeTexture.set(Ee.TEXTURE2),Ee.bindTexture(Ee.TEXTURE_2D,M.depthTexture),i.activeTexture.set(Ee.TEXTURE3),Ee.bindTexture(Ee.TEXTURE_2D,M.texture);for(const Ue in this.terrainUniforms)this.terrainUniforms[Ue].set(M[Ue])}if(z)for(const Ue in z)this.projectionUniforms[qd[Ue]].set(z[Ue]);if(R)for(const Ue in this.fixedUniforms)this.fixedUniforms[Ue].set(R[Ue]);de&&de.setUniforms(i,this.binderUniforms,re,{zoom:he});let Oe=0;switch(d){case Ee.LINES:Oe=2;break;case Ee.TRIANGLES:Oe=3;break;case Ee.LINE_STRIP:Oe=1}for(const Ue of Q.get()){const Me=Ue.vaos||(Ue.vaos={});(Me[j]||(Me[j]=new Uu)).bind(i,this,X,de?de.getPaintVertexBuffers():[],H,Ue.vertexOffset,ge,Pe,De),Ee.drawElements(d,Ue.primitiveLength*Oe,Ee.UNSIGNED_SHORT,Ue.primitiveOffset*Oe*2)}}}function Vu(y,i,d){const p=1/a.aC(d,1,i.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,i.transform.tileZoom)/_,A=x*(d.tileID.canonical.x+d.tileID.wrap*_),R=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[A>>16,R>>16],u_pixel_coord_lower:[65535&A,65535&R]}}const gl=(y,i,d,p)=>{const _=y.style.light,x=_.properties.get("position"),A=[x.x,x.y,x.z],R=a.bW();_.properties.get("anchor")==="viewport"&&a.bX(R,y.transform.bearingInRadians),a.bY(A,A,R);const M=y.transform.transformLightDirection(A),z=_.properties.get("color");return{u_lightpos:A,u_lightpos_globe:M,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+i,u_opacity:d,u_fill_translate:p}},yc=(y,i,d,p,_,x,A)=>a.e(gl(y,i,d,p),Vu(x,y,A),{u_height_factor:-Math.pow(2,_.overscaledZ)/A.tileSize/8}),bg=(y,i,d,p)=>a.e(Vu(i,y,d),{u_fill_translate:p}),ju=(y,i)=>({u_world:y,u_fill_translate:i}),Ly=(y,i,d,p,_)=>a.e(bg(y,i,d,_),{u_world:p}),ml=(y,i,d,p,_)=>{const x=y.transform;let A,R,M=0;if(d.paint.get("circle-pitch-alignment")==="map"){const z=a.aC(i,1,x.zoom);A=!0,R=[z,z],M=z/(a.$*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*_}else A=!1,R=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+A,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:M,u_translate:p}},By=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),xg=y=>({u_viewport_size:[y.width,y.height]}),wg=(y,i=1)=>({u_color:y,u_overlay:0,u_overlay_scale:i}),Gd=(y,i,d,p)=>{const _=a.aC(y,1,i)/(a.$*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:a.aC(y,1,i),u_intensity:d,u_globe_extrude_scale:_}},Wu=(y,i,d,p)=>{const _=a.L();a.bZ(_,0,y.width,y.height,0,0,1);const x=y.context.gl;return{u_matrix:_,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:d,u_color_ramp:p,u_opacity:i.paint.get("heatmap-opacity")}},Tg=(y,i,d)=>{const p=d.paint.get("hillshade-accent-color");let _;switch(d.paint.get("hillshade-method")){case"basic":_=4;break;case"combined":_=1;break;case"igor":_=2;break;case"multidirectional":_=3;break;default:_=0}const x=d.getIlluminationProperties();for(let A=0;A<x.directionRadians.length;A++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[A]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:Ag(0,i.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:p,u_method:_,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},Sg=(y,i)=>{const d=i.stride,p=a.L();return a.bZ(p,0,a.$,-a.$,0,0,1),a.M(p,p,[0,-a.$,0]),{u_matrix:p,u_image:1,u_dimension:[d,d],u_zoom:y.overscaledZ,u_unpack:i.getUnpackVector()}};function Ag(y,i){const d=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new a.a1(0,p/d).toLngLat().lat,new a.a1(0,(p+1)/d).toLngLat().lat]}const Eg=(y,i,d=0)=>({u_image:0,u_unpack:i.getUnpackVector(),u_dimension:[i.stride,i.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:y.paint.get("color-relief-opacity")}),lo=(y,i,d,p)=>{const _=y.transform;return{u_translation:Cg(y,i,d),u_ratio:p/a.aC(i,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Pg=(y,i,d,p,_)=>a.e(lo(y,i,d,p),{u_image:0,u_image_height:_}),Ig=(y,i,d,p,_)=>{const x=y.transform,A=_l(i,x);return{u_translation:Cg(y,i,d),u_texsize:i.imageAtlasTexture.size,u_ratio:p/a.aC(i,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[A,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},vc=(y,i,d,p,_)=>{const x=_l(i,y.transform);return a.e(lo(y,i,d,p),{u_tileratio:x,u_crossfade_from:_.fromScale,u_crossfade_to:_.toScale,u_image:0,u_mix:_.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},zy=(y,i,d,p,_,x)=>{const A=_l(i,y.transform);return a.e(lo(y,i,d,p),{u_image:0,u_image_height:x,u_tileratio:A,u_crossfade_from:_.fromScale,u_crossfade_to:_.toScale,u_image_dash:1,u_mix:_.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function _l(y,i){return 1/a.aC(y,1,i.tileZoom)}function Cg(y,i,d){return a.aD(y.transform,i,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Uy=(y,i,d,p,_)=>{return{u_tl_parent:y,u_scale_parent:i,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(A=p.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(x=p.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Rg(p.paint.get("raster-hue-rotate")),u_coords_top:[_[0].x,_[0].y,_[1].x,_[1].y],u_coords_bottom:[_[3].x,_[3].y,_[2].x,_[2].y]};var x,A};function Rg(y){y*=Math.PI/180;const i=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*i-d+1)/3,(Math.sqrt(3)*i-d+1)/3]}const Yd=(y,i,d,p,_,x,A,R,M,z,j,X,H)=>{const Q=A.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:Q.width/Q.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:M,u_is_text:+j,u_pitch_with_map:+p,u_is_along_line:_,u_is_variable_anchor:x,u_texsize:X,u_texture:0,u_translation:z,u_pitched_scale:H}},Kd=(y,i,d,p,_,x,A,R,M,z,j,X,H,Q)=>{const re=A.transform;return a.e(Yd(y,i,d,p,_,x,A,R,M,z,j,X,Q),{u_gamma_scale:p?Math.cos(re.pitch*Math.PI/180)*re.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:1})},Qd=(y,i,d,p,_,x,A,R,M,z,j,X,H)=>a.e(Kd(y,i,d,p,_,x,A,R,M,z,!0,j,0,H),{u_texsize_icon:X,u_texture_icon:1}),Mg=(y,i)=>({u_opacity:y,u_color:i}),$u=(y,i,d,p,_)=>a.e((function(x,A,R,M){const z=R.imageManager.getPattern(x.from.toString()),j=R.imageManager.getPattern(x.to.toString()),{width:X,height:H}=R.imageManager.getPixelSize(),Q=Math.pow(2,M.tileID.overscaledZ),re=M.tileSize*Math.pow(2,R.transform.tileZoom)/Q,he=re*(M.tileID.canonical.x+M.tileID.wrap*Q),de=re*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[X,H],u_mix:A.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/a.aC(M,1,R.transform.tileZoom),u_pixel_coord_upper:[he>>16,de>>16],u_pixel_coord_lower:[65535&he,65535&de]}})(d,_,i,p),{u_opacity:y}),co=(y,i)=>{},Jd={fillExtrusion:(y,i)=>({u_lightpos:new a.bU(y,i.u_lightpos),u_lightpos_globe:new a.bU(y,i.u_lightpos_globe),u_lightintensity:new a.bg(y,i.u_lightintensity),u_lightcolor:new a.bU(y,i.u_lightcolor),u_vertical_gradient:new a.bg(y,i.u_vertical_gradient),u_opacity:new a.bg(y,i.u_opacity),u_fill_translate:new a.bV(y,i.u_fill_translate)}),fillExtrusionPattern:(y,i)=>({u_lightpos:new a.bU(y,i.u_lightpos),u_lightpos_globe:new a.bU(y,i.u_lightpos_globe),u_lightintensity:new a.bg(y,i.u_lightintensity),u_lightcolor:new a.bU(y,i.u_lightcolor),u_vertical_gradient:new a.bg(y,i.u_vertical_gradient),u_height_factor:new a.bg(y,i.u_height_factor),u_opacity:new a.bg(y,i.u_opacity),u_fill_translate:new a.bV(y,i.u_fill_translate),u_image:new a.bQ(y,i.u_image),u_texsize:new a.bV(y,i.u_texsize),u_pixel_coord_upper:new a.bV(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bV(y,i.u_pixel_coord_lower),u_scale:new a.bU(y,i.u_scale),u_fade:new a.bg(y,i.u_fade)}),fill:(y,i)=>({u_fill_translate:new a.bV(y,i.u_fill_translate)}),fillPattern:(y,i)=>({u_image:new a.bQ(y,i.u_image),u_texsize:new a.bV(y,i.u_texsize),u_pixel_coord_upper:new a.bV(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bV(y,i.u_pixel_coord_lower),u_scale:new a.bU(y,i.u_scale),u_fade:new a.bg(y,i.u_fade),u_fill_translate:new a.bV(y,i.u_fill_translate)}),fillOutline:(y,i)=>({u_world:new a.bV(y,i.u_world),u_fill_translate:new a.bV(y,i.u_fill_translate)}),fillOutlinePattern:(y,i)=>({u_world:new a.bV(y,i.u_world),u_image:new a.bQ(y,i.u_image),u_texsize:new a.bV(y,i.u_texsize),u_pixel_coord_upper:new a.bV(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bV(y,i.u_pixel_coord_lower),u_scale:new a.bU(y,i.u_scale),u_fade:new a.bg(y,i.u_fade),u_fill_translate:new a.bV(y,i.u_fill_translate)}),circle:(y,i)=>({u_camera_to_center_distance:new a.bg(y,i.u_camera_to_center_distance),u_scale_with_map:new a.bQ(y,i.u_scale_with_map),u_pitch_with_map:new a.bQ(y,i.u_pitch_with_map),u_extrude_scale:new a.bV(y,i.u_extrude_scale),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(y,i.u_globe_extrude_scale),u_translate:new a.bV(y,i.u_translate)}),collisionBox:(y,i)=>({u_pixel_extrude_scale:new a.bV(y,i.u_pixel_extrude_scale)}),collisionCircle:(y,i)=>({u_viewport_size:new a.bV(y,i.u_viewport_size)}),debug:(y,i)=>({u_color:new a.bR(y,i.u_color),u_overlay:new a.bQ(y,i.u_overlay),u_overlay_scale:new a.bg(y,i.u_overlay_scale)}),depth:co,clippingMask:co,heatmap:(y,i)=>({u_extrude_scale:new a.bg(y,i.u_extrude_scale),u_intensity:new a.bg(y,i.u_intensity),u_globe_extrude_scale:new a.bg(y,i.u_globe_extrude_scale)}),heatmapTexture:(y,i)=>({u_matrix:new a.bS(y,i.u_matrix),u_world:new a.bV(y,i.u_world),u_image:new a.bQ(y,i.u_image),u_color_ramp:new a.bQ(y,i.u_color_ramp),u_opacity:new a.bg(y,i.u_opacity)}),hillshade:(y,i)=>({u_image:new a.bQ(y,i.u_image),u_latrange:new a.bV(y,i.u_latrange),u_exaggeration:new a.bg(y,i.u_exaggeration),u_altitudes:new a.b$(y,i.u_altitudes),u_azimuths:new a.b$(y,i.u_azimuths),u_accent:new a.bR(y,i.u_accent),u_method:new a.bQ(y,i.u_method),u_shadows:new a.b_(y,i.u_shadows),u_highlights:new a.b_(y,i.u_highlights)}),hillshadePrepare:(y,i)=>({u_matrix:new a.bS(y,i.u_matrix),u_image:new a.bQ(y,i.u_image),u_dimension:new a.bV(y,i.u_dimension),u_zoom:new a.bg(y,i.u_zoom),u_unpack:new a.bT(y,i.u_unpack)}),colorRelief:(y,i)=>({u_image:new a.bQ(y,i.u_image),u_unpack:new a.bT(y,i.u_unpack),u_dimension:new a.bV(y,i.u_dimension),u_elevation_stops:new a.bQ(y,i.u_elevation_stops),u_color_stops:new a.bQ(y,i.u_color_stops),u_color_ramp_size:new a.bQ(y,i.u_color_ramp_size),u_opacity:new a.bg(y,i.u_opacity)}),line:(y,i)=>({u_translation:new a.bV(y,i.u_translation),u_ratio:new a.bg(y,i.u_ratio),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_units_to_pixels:new a.bV(y,i.u_units_to_pixels)}),lineGradient:(y,i)=>({u_translation:new a.bV(y,i.u_translation),u_ratio:new a.bg(y,i.u_ratio),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_units_to_pixels:new a.bV(y,i.u_units_to_pixels),u_image:new a.bQ(y,i.u_image),u_image_height:new a.bg(y,i.u_image_height)}),linePattern:(y,i)=>({u_translation:new a.bV(y,i.u_translation),u_texsize:new a.bV(y,i.u_texsize),u_ratio:new a.bg(y,i.u_ratio),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_image:new a.bQ(y,i.u_image),u_units_to_pixels:new a.bV(y,i.u_units_to_pixels),u_scale:new a.bU(y,i.u_scale),u_fade:new a.bg(y,i.u_fade)}),lineSDF:(y,i)=>({u_translation:new a.bV(y,i.u_translation),u_ratio:new a.bg(y,i.u_ratio),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_units_to_pixels:new a.bV(y,i.u_units_to_pixels),u_image:new a.bQ(y,i.u_image),u_mix:new a.bg(y,i.u_mix),u_tileratio:new a.bg(y,i.u_tileratio),u_crossfade_from:new a.bg(y,i.u_crossfade_from),u_crossfade_to:new a.bg(y,i.u_crossfade_to),u_lineatlas_width:new a.bg(y,i.u_lineatlas_width),u_lineatlas_height:new a.bg(y,i.u_lineatlas_height)}),lineGradientSDF:(y,i)=>({u_translation:new a.bV(y,i.u_translation),u_ratio:new a.bg(y,i.u_ratio),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_units_to_pixels:new a.bV(y,i.u_units_to_pixels),u_image:new a.bQ(y,i.u_image),u_image_height:new a.bg(y,i.u_image_height),u_tileratio:new a.bg(y,i.u_tileratio),u_crossfade_from:new a.bg(y,i.u_crossfade_from),u_crossfade_to:new a.bg(y,i.u_crossfade_to),u_image_dash:new a.bQ(y,i.u_image_dash),u_mix:new a.bg(y,i.u_mix),u_lineatlas_width:new a.bg(y,i.u_lineatlas_width),u_lineatlas_height:new a.bg(y,i.u_lineatlas_height)}),raster:(y,i)=>({u_tl_parent:new a.bV(y,i.u_tl_parent),u_scale_parent:new a.bg(y,i.u_scale_parent),u_buffer_scale:new a.bg(y,i.u_buffer_scale),u_fade_t:new a.bg(y,i.u_fade_t),u_opacity:new a.bg(y,i.u_opacity),u_image0:new a.bQ(y,i.u_image0),u_image1:new a.bQ(y,i.u_image1),u_brightness_low:new a.bg(y,i.u_brightness_low),u_brightness_high:new a.bg(y,i.u_brightness_high),u_saturation_factor:new a.bg(y,i.u_saturation_factor),u_contrast_factor:new a.bg(y,i.u_contrast_factor),u_spin_weights:new a.bU(y,i.u_spin_weights),u_coords_top:new a.bT(y,i.u_coords_top),u_coords_bottom:new a.bT(y,i.u_coords_bottom)}),symbolIcon:(y,i)=>({u_is_size_zoom_constant:new a.bQ(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bQ(y,i.u_is_size_feature_constant),u_size_t:new a.bg(y,i.u_size_t),u_size:new a.bg(y,i.u_size),u_camera_to_center_distance:new a.bg(y,i.u_camera_to_center_distance),u_pitch:new a.bg(y,i.u_pitch),u_rotate_symbol:new a.bQ(y,i.u_rotate_symbol),u_aspect_ratio:new a.bg(y,i.u_aspect_ratio),u_fade_change:new a.bg(y,i.u_fade_change),u_label_plane_matrix:new a.bS(y,i.u_label_plane_matrix),u_coord_matrix:new a.bS(y,i.u_coord_matrix),u_is_text:new a.bQ(y,i.u_is_text),u_pitch_with_map:new a.bQ(y,i.u_pitch_with_map),u_is_along_line:new a.bQ(y,i.u_is_along_line),u_is_variable_anchor:new a.bQ(y,i.u_is_variable_anchor),u_texsize:new a.bV(y,i.u_texsize),u_texture:new a.bQ(y,i.u_texture),u_translation:new a.bV(y,i.u_translation),u_pitched_scale:new a.bg(y,i.u_pitched_scale)}),symbolSDF:(y,i)=>({u_is_size_zoom_constant:new a.bQ(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bQ(y,i.u_is_size_feature_constant),u_size_t:new a.bg(y,i.u_size_t),u_size:new a.bg(y,i.u_size),u_camera_to_center_distance:new a.bg(y,i.u_camera_to_center_distance),u_pitch:new a.bg(y,i.u_pitch),u_rotate_symbol:new a.bQ(y,i.u_rotate_symbol),u_aspect_ratio:new a.bg(y,i.u_aspect_ratio),u_fade_change:new a.bg(y,i.u_fade_change),u_label_plane_matrix:new a.bS(y,i.u_label_plane_matrix),u_coord_matrix:new a.bS(y,i.u_coord_matrix),u_is_text:new a.bQ(y,i.u_is_text),u_pitch_with_map:new a.bQ(y,i.u_pitch_with_map),u_is_along_line:new a.bQ(y,i.u_is_along_line),u_is_variable_anchor:new a.bQ(y,i.u_is_variable_anchor),u_texsize:new a.bV(y,i.u_texsize),u_texture:new a.bQ(y,i.u_texture),u_gamma_scale:new a.bg(y,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_is_halo:new a.bQ(y,i.u_is_halo),u_translation:new a.bV(y,i.u_translation),u_pitched_scale:new a.bg(y,i.u_pitched_scale)}),symbolTextAndIcon:(y,i)=>({u_is_size_zoom_constant:new a.bQ(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bQ(y,i.u_is_size_feature_constant),u_size_t:new a.bg(y,i.u_size_t),u_size:new a.bg(y,i.u_size),u_camera_to_center_distance:new a.bg(y,i.u_camera_to_center_distance),u_pitch:new a.bg(y,i.u_pitch),u_rotate_symbol:new a.bQ(y,i.u_rotate_symbol),u_aspect_ratio:new a.bg(y,i.u_aspect_ratio),u_fade_change:new a.bg(y,i.u_fade_change),u_label_plane_matrix:new a.bS(y,i.u_label_plane_matrix),u_coord_matrix:new a.bS(y,i.u_coord_matrix),u_is_text:new a.bQ(y,i.u_is_text),u_pitch_with_map:new a.bQ(y,i.u_pitch_with_map),u_is_along_line:new a.bQ(y,i.u_is_along_line),u_is_variable_anchor:new a.bQ(y,i.u_is_variable_anchor),u_texsize:new a.bV(y,i.u_texsize),u_texsize_icon:new a.bV(y,i.u_texsize_icon),u_texture:new a.bQ(y,i.u_texture),u_texture_icon:new a.bQ(y,i.u_texture_icon),u_gamma_scale:new a.bg(y,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(y,i.u_device_pixel_ratio),u_is_halo:new a.bQ(y,i.u_is_halo),u_translation:new a.bV(y,i.u_translation),u_pitched_scale:new a.bg(y,i.u_pitched_scale)}),background:(y,i)=>({u_opacity:new a.bg(y,i.u_opacity),u_color:new a.bR(y,i.u_color)}),backgroundPattern:(y,i)=>({u_opacity:new a.bg(y,i.u_opacity),u_image:new a.bQ(y,i.u_image),u_pattern_tl_a:new a.bV(y,i.u_pattern_tl_a),u_pattern_br_a:new a.bV(y,i.u_pattern_br_a),u_pattern_tl_b:new a.bV(y,i.u_pattern_tl_b),u_pattern_br_b:new a.bV(y,i.u_pattern_br_b),u_texsize:new a.bV(y,i.u_texsize),u_mix:new a.bg(y,i.u_mix),u_pattern_size_a:new a.bV(y,i.u_pattern_size_a),u_pattern_size_b:new a.bV(y,i.u_pattern_size_b),u_scale_a:new a.bg(y,i.u_scale_a),u_scale_b:new a.bg(y,i.u_scale_b),u_pixel_coord_upper:new a.bV(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bV(y,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(y,i.u_tile_units_to_pixels)}),terrain:(y,i)=>({u_texture:new a.bQ(y,i.u_texture),u_ele_delta:new a.bg(y,i.u_ele_delta),u_fog_matrix:new a.bS(y,i.u_fog_matrix),u_fog_color:new a.bR(y,i.u_fog_color),u_fog_ground_blend:new a.bg(y,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(y,i.u_fog_ground_blend_opacity),u_horizon_color:new a.bR(y,i.u_horizon_color),u_horizon_fog_blend:new a.bg(y,i.u_horizon_fog_blend),u_is_globe_mode:new a.bg(y,i.u_is_globe_mode)}),terrainDepth:(y,i)=>({u_ele_delta:new a.bg(y,i.u_ele_delta)}),terrainCoords:(y,i)=>({u_texture:new a.bQ(y,i.u_texture),u_terrain_coords_id:new a.bg(y,i.u_terrain_coords_id),u_ele_delta:new a.bg(y,i.u_ele_delta)}),projectionErrorMeasurement:(y,i)=>({u_input:new a.bg(y,i.u_input),u_output_expected:new a.bg(y,i.u_output_expected)}),atmosphere:(y,i)=>({u_sun_pos:new a.bU(y,i.u_sun_pos),u_atmosphere_blend:new a.bg(y,i.u_atmosphere_blend),u_globe_position:new a.bU(y,i.u_globe_position),u_globe_radius:new a.bg(y,i.u_globe_radius),u_inv_proj_matrix:new a.bS(y,i.u_inv_proj_matrix)}),sky:(y,i)=>({u_sky_color:new a.bR(y,i.u_sky_color),u_horizon_color:new a.bR(y,i.u_horizon_color),u_horizon:new a.bV(y,i.u_horizon),u_horizon_normal:new a.bV(y,i.u_horizon_normal),u_sky_horizon_blend:new a.bg(y,i.u_sky_horizon_blend),u_sky_blend:new a.bg(y,i.u_sky_blend)})};class ef{constructor(i,d,p){this.context=i;const _=i.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kg{constructor(i,d,p,_){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=i;const x=i.gl;this.buffer=x.createBuffer(),i.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,d){for(let p=0;p<this.attributes.length;p++){const _=d.attributes[this.attributes[p].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,d,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],A=d.attributes[x.name];A!==void 0&&i.vertexAttribPointer(A,x.components,i[tf[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Sn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Da extends Sn{getDefault(){return a.bf.transparent}set(i){const d=this.current;(i.r!==d.r||i.g!==d.g||i.b!==d.b||i.a!==d.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class rf extends Sn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Vy extends Sn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class jy extends Sn{getDefault(){return[!0,!0,!0,!0]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||i[3]!==d[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Wy extends Sn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class $y extends Sn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Dg extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const d=this.current;(i.func!==d.func||i.ref!==d.ref||i.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Hy extends Sn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Og extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=i,this.dirty=!1}}class Hu extends Sn{getDefault(){return[0,1]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Zu extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=i,this.dirty=!1}}class Xu extends Sn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class nf extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.BLEND):d.disable(d.BLEND),this.current=i,this.dirty=!1}}class Oa extends Sn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class bc extends Sn{getDefault(){return a.bf.transparent}set(i){const d=this.current;(i.r!==d.r||i.g!==d.g||i.b!==d.b||i.a!==d.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class yl extends Sn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ds extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=i,this.dirty=!1}}class Fg extends Sn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ng extends Sn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class sf extends Sn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Fa extends Sn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class qu extends Sn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||i[3]!==d[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Gu extends Sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class xc extends Sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Yu extends Sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Lg extends Sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class vl extends Sn{getDefault(){return null}set(i){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class bl extends Sn{getDefault(){return null}set(i){var d;if(i===this.current&&!this.dirty)return;const p=this.gl;ao(p)?p.bindVertexArray(i):(d=p.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Bg extends Sn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class of extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class hn extends Sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class xl extends Sn{constructor(i,d){super(i),this.context=i,this.parent=d}getDefault(){return null}}class Zy extends xl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class zg extends xl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class wc extends xl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const Ug="Framebuffer is not complete";class Xy{constructor(i,d,p,_,x){this.context=i,this.width=d,this.height=p;const A=i.gl,R=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new Zy(i,R),_)this.depthAttachment=x?new wc(i,R):new zg(i,R);else if(x)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error(Ug)}destroy(){const i=this.context.gl,d=this.colorAttachment.get();if(d&&i.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class Vg{constructor(i){var d,p;if(this.gl=i,this.clearColor=new Da(this),this.clearDepth=new rf(this),this.clearStencil=new Vy(this),this.colorMask=new jy(this),this.depthMask=new Wy(this),this.stencilMask=new $y(this),this.stencilFunc=new Dg(this),this.stencilOp=new Hy(this),this.stencilTest=new Og(this),this.depthRange=new Hu(this),this.depthTest=new Zu(this),this.depthFunc=new Xu(this),this.blend=new nf(this),this.blendFunc=new Oa(this),this.blendColor=new bc(this),this.blendEquation=new yl(this),this.cullFace=new Ds(this),this.cullFaceSide=new Fg(this),this.frontFace=new Ng(this),this.program=new sf(this),this.activeTexture=new Fa(this),this.viewport=new qu(this),this.bindFramebuffer=new Gu(this),this.bindRenderbuffer=new xc(this),this.bindTexture=new Yu(this),this.bindVertexBuffer=new Lg(this),this.bindElementBuffer=new vl(this),this.bindVertexArray=new bl(this),this.pixelStoreUnpack=new Bg(this),this.pixelStoreUnpackPremultiplyAlpha=new of(this),this.pixelStoreUnpackFlipY=new hn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),ao(i)){this.HALF_FLOAT=i.HALF_FLOAT;const _=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=i.RGBA16F)!==null&&d!==void 0?d:_?.RGBA16F_EXT,this.RGB16F=(p=i.RGB16F)!==null&&p!==void 0?p:_?.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const _=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=_?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,d){return new ef(this,i,d)}createVertexBuffer(i,d,p){return new kg(this,i,d,p)}createRenderbuffer(i,d,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,i,d,p),this.bindRenderbuffer.set(null),x}createFramebuffer(i,d,p,_){return new Xy(this,i,d,p,_)}clear({color:i,depth:d,stencil:p}){const _=this.gl;let x=0;i&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(x)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.bH(i.blendFunction,Mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return ao(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var d;return ao(this.gl)?this.gl.deleteVertexArray(i):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let Ku;function Qu(y,i,d,p,_){const x=y.context,A=y.transform,R=x.gl,M=y.useProgram("collisionBox"),z=[];let j=0,X=0;for(let ge=0;ge<p.length;ge++){const Pe=p[ge],De=i.getTile(Pe).getBucket(d);if(!De)continue;const Ee=_?De.textCollisionBox:De.iconCollisionBox,Oe=De.collisionCircleArray;Oe.length>0&&(z.push({circleArray:Oe,circleOffset:X,coord:Pe}),j+=Oe.length/4,X=j),Ee&&M.draw(x,R.LINES,Wr.disabled,on.disabled,y.colorModeForRenderPass(),yn.disabled,By(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe),A.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,y.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!_||!z.length)return;const H=y.useProgram("collisionCircle"),Q=new a.c0;Q.resize(4*j),Q._trim();let re=0;for(const ge of z)for(let Pe=0;Pe<ge.circleArray.length/4;Pe++){const De=4*Pe,Ee=ge.circleArray[De+0],Oe=ge.circleArray[De+1],Ue=ge.circleArray[De+2],Me=ge.circleArray[De+3];Q.emplace(re++,Ee,Oe,Ue,Me,0),Q.emplace(re++,Ee,Oe,Ue,Me,1),Q.emplace(re++,Ee,Oe,Ue,Me,2),Q.emplace(re++,Ee,Oe,Ue,Me,3)}(!Ku||Ku.length<2*j)&&(Ku=(function(ge){const Pe=2*ge,De=new a.c2;De.resize(Pe),De._trim();for(let Ee=0;Ee<Pe;Ee++){const Oe=6*Ee;De.uint16[Oe+0]=4*Ee+0,De.uint16[Oe+1]=4*Ee+1,De.uint16[Oe+2]=4*Ee+2,De.uint16[Oe+3]=4*Ee+2,De.uint16[Oe+4]=4*Ee+3,De.uint16[Oe+5]=4*Ee+0}return De})(j));const he=x.createIndexBuffer(Ku,!0),de=x.createVertexBuffer(Q,a.c1.members,!0);for(const ge of z){const Pe=xg(y.transform);H.draw(x,R.TRIANGLES,Wr.disabled,on.disabled,y.colorModeForRenderPass(),yn.disabled,Pe,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ge.coord),null,d.id,de,he,a.aM.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,y.transform.zoom,null,null,null)}de.destroy(),he.destroy()}const Ju=a.ai(new Float32Array(16));function eh(y,i,d,p,_,x){const{horizontalAlign:A,verticalAlign:R}=a.aH(y);return new a.P((-(A-.5)*i/_+p[0])*x,(-(R-.5)*d/_+p[1])*x)}function th(y,i,d,p,_,x){const A=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let R=p.mult(x);d||(R=R.rotate(-_));const M=A.add(R);return Rr(M.x,M.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(d){const R=Yt(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(y),M=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return y.add(p.rotate(M))}return y.add(p)}function af(y,i,d,p,_,x,A,R,M,z,j,X){const H=y.text.placedSymbolArray,Q=y.text.dynamicLayoutVertexArray,re=y.icon.dynamicLayoutVertexArray,he={};Q.clear();for(let de=0;de<H.length;de++){const ge=H.get(de),Pe=ge.hidden||!ge.crossTileID||y.allowVerticalPlacement&&!ge.placedOrientation?null:p[ge.crossTileID];if(Pe){const De=new a.P(ge.anchorX,ge.anchorY),Ee={getElevation:X,width:_.width,height:_.height,pitchedLabelPlaneMatrix:x,pitchWithMap:d,transform:_,tileAnchorPoint:De,translation:z,unwrappedTileID:j},Oe=d?nn(De.x,De.y,Ee):Yt(De.x,De.y,Ee),Ue=rn(_.cameraToCenterDistance,Oe.signedDistanceFromCamera);let Me=a.ap(y.textSizeData,R,ge)*Ue/a.aB;d&&(Me*=y.tilePixelRatio/A);const{width:He,height:dt,anchor:ot,textOffset:lt,textBoxScale:ft}=Pe,Vt=eh(ot,He,dt,lt,ft,Me),$t=_.getPitchedTextCorrection(De.x+z[0],De.y+z[1],j),Dt=th(Oe.point,Ee,i,Vt,-_.bearingInRadians,$t),Sr=y.allowVerticalPlacement&&ge.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let $r=0;$r<ge.numGlyphs;$r++)a.av(Q,Dt,Sr);M&&ge.associatedIconIndex>=0&&(he[ge.associatedIconIndex]={shiftedAnchor:Dt,angle:Sr})}else dn(ge.numGlyphs,Q)}if(M){re.clear();const de=y.icon.placedSymbolArray;for(let ge=0;ge<de.length;ge++){const Pe=de.get(ge);if(Pe.hidden)dn(Pe.numGlyphs,re);else{const De=he[ge];if(De)for(let Ee=0;Ee<Pe.numGlyphs;Ee++)a.av(re,De.shiftedAnchor,De.angle);else dn(Pe.numGlyphs,re)}}y.icon.dynamicLayoutVertexBuffer.updateData(re)}y.text.dynamicLayoutVertexBuffer.updateData(Q)}function jg(y,i,d){return d.iconsInText&&i?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Tc(y,i,d,p,_,x,A,R,M,z,j,X,H){const Q=y.context,re=Q.gl,he=y.transform,de=R==="map",ge=M==="map",Pe=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",De=de&&!ge&&!Pe,Ee=!d.layout.get("symbol-sort-key").isConstant();let Oe=!1;const Ue=y.getDepthModeForSublayer(0,Wr.ReadOnly),Me=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),He=[],dt=he.getCircleRadiusCorrection();for(const ot of p){const lt=i.getTile(ot),ft=lt.getBucket(d);if(!ft)continue;const Vt=_?ft.text:ft.icon;if(!Vt||!Vt.segments.get().length||!Vt.hasVisibleVertices)continue;const $t=Vt.programConfigurations.get(d.id),Dt=_||ft.sdfIcons,Sr=_?ft.textSizeData:ft.iconSizeData,$r=ge||he.pitch!==0,En=y.useProgram(jg(Dt,_,ft),$t),Hn=a.an(Sr,he.zoom),Un=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ot);let en,Ln,Pi,ei,Di=[0,0],ci=null;if(_)Ln=lt.glyphAtlasTexture,Pi=re.LINEAR,en=lt.glyphAtlasTexture.size,ft.iconsInText&&(Di=lt.imageAtlasTexture.size,ci=lt.imageAtlasTexture,ei=$r||y.options.rotating||y.options.zooming||Sr.kind==="composite"||Sr.kind==="camera"?re.LINEAR:re.NEAREST);else{const vi=d.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;Ln=lt.imageAtlasTexture,Pi=Dt||y.options.rotating||y.options.zooming||vi||$r?re.LINEAR:re.NEAREST,en=lt.imageAtlasTexture.size}const mi=a.aC(lt,1,y.transform.zoom),Oi=kt(de,y.transform,mi),ta=a.L();a.aq(ta,Oi);const ra=$e(ge,de,y.transform,mi),Va=a.aD(he,lt,x,A),na=he.getProjectionData({overscaledTileID:ot,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),ja=Me&&ft.hasTextData(),Mc=d.layout.get("icon-text-fit")!=="none"&&ja&&ft.hasIconData();if(Pe){const vi=y.style.map.terrain?(_s,ui)=>y.style.map.terrain.getElevation(ot,_s,ui):null,Fi=d.layout.get("text-rotation-alignment")==="map";xt(ft,y,_,Oi,ta,ge,z,Fi,ot.toUnwrapped(),he.width,he.height,Va,vi)}const ia=_&&Me||Mc,ds=Pe||ia?Ju:ge?Oi:y.transform.clipSpaceToPixelsMatrix,rs=Dt&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let po;po=Dt?ft.iconsInText?Qd(Sr.kind,Hn,De,ge,Pe,ia,y,ds,ra,Va,en,Di,dt):Kd(Sr.kind,Hn,De,ge,Pe,ia,y,ds,ra,Va,_,en,0,dt):Yd(Sr.kind,Hn,De,ge,Pe,ia,y,ds,ra,Va,_,en,dt);const Fl={program:En,buffers:Vt,uniformValues:po,projectionData:na,atlasTexture:Ln,atlasTextureIcon:ci,atlasInterpolation:Pi,atlasInterpolationIcon:ei,isSDF:Dt,hasHalo:rs};if(Ee&&ft.canOverlap){Oe=!0;const vi=Vt.segments.get();for(const Fi of vi)He.push({segments:new a.aM([Fi]),sortKey:Fi.sortKey,state:Fl,terrainData:Un})}else He.push({segments:Vt.segments,sortKey:0,state:Fl,terrainData:Un})}Oe&&He.sort(((ot,lt)=>ot.sortKey-lt.sortKey));for(const ot of He){const lt=ot.state;if(Q.activeTexture.set(re.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,re.CLAMP_TO_EDGE),lt.atlasTextureIcon&&(Q.activeTexture.set(re.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),lt.isSDF){const ft=lt.uniformValues;lt.hasHalo&&(ft.u_is_halo=1,Sc(lt.buffers,ot.segments,d,y,lt.program,Ue,j,X,ft,lt.projectionData,ot.terrainData)),ft.u_is_halo=0}Sc(lt.buffers,ot.segments,d,y,lt.program,Ue,j,X,lt.uniformValues,lt.projectionData,ot.terrainData)}}function Sc(y,i,d,p,_,x,A,R,M,z,j){const X=p.context;_.draw(X,X.gl.TRIANGLES,x,A,R,yn.backCCW,M,j,z,d.id,y.layoutVertexBuffer,y.indexBuffer,i,d.paint,p.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function rh(y,i,d,p,_){const x=y.context,A=x.gl,R=on.disabled,M=new Mn([A.ONE,A.ONE],a.bf.transparent,[!0,!0,!0,!0]),z=i.getBucket(d);if(!z)return;const j=p.key;let X=d.heatmapFbos.get(j);X||(X=nh(x,i.tileSize,i.tileSize),d.heatmapFbos.set(j,X)),x.bindFramebuffer.set(X.framebuffer),x.viewport.set([0,0,i.tileSize,i.tileSize]),x.clear({color:a.bf.transparent});const H=z.programConfigurations.get(d.id),Q=y.useProgram("heatmap",H,!_),re=y.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),he=y.style.map.terrain.getTerrainData(p);Q.draw(x,A.TRIANGLES,Wr.disabled,R,M,yn.disabled,Gd(i,y.transform.zoom,d.paint.get("heatmap-intensity"),1),he,re,d.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,d.paint,y.transform.zoom,H)}function wl(y,i,d,p,_){const x=y.context,A=x.gl,R=y.transform;x.setColorMode(y.colorModeForRenderPass());const M=Wg(x,i),z=d.key,j=i.heatmapFbos.get(z);if(!j)return;x.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,j.colorAttachment.get()),x.activeTexture.set(A.TEXTURE1),M.bind(A.LINEAR,A.CLAMP_TO_EDGE);const X=R.getProjectionData({overscaledTileID:d,applyTerrainMatrix:_,applyGlobeMatrix:!p});y.useProgram("heatmapTexture").draw(x,A.TRIANGLES,Wr.disabled,on.disabled,y.colorModeForRenderPass(),yn.disabled,Wu(y,i,0,1),null,X,i.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,i.paint,R.zoom),j.destroy(),i.heatmapFbos.delete(z)}function nh(y,i,d){var p,_;const x=y.gl,A=x.createTexture();x.bindTexture(x.TEXTURE_2D,A),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const R=(p=y.HALF_FLOAT)!==null&&p!==void 0?p:x.UNSIGNED_BYTE,M=(_=y.RGBA16F)!==null&&_!==void 0?_:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,M,i,d,0,x.RGBA,R,null);const z=y.createFramebuffer(i,d,!1,!1);return z.colorAttachment.set(A),z}function Wg(y,i){return i.colorRampTexture||(i.colorRampTexture=new a.T(y,i.colorRamp,y.gl.RGBA)),i.colorRampTexture}function Tl(y,i,d,p,_,x,A,R){let M=256;if(_.stepInterpolant){const z=i.getSource().maxzoom,j=A.canonical.z===z?Math.ceil(1<<y.transform.maxZoom-A.canonical.z):1;M=a.ae(a.c4(x.maxLineLength/a.$*1024*j),256,d.maxTextureSize)}return R.gradient=a.c5({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:M,image:R.gradient||void 0,clips:x.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new a.T(d,R.gradient,p.RGBA),R.version=_.gradientVersion,R.texture}function qy(y,i,d,p,_){y.activeTexture.set(i.TEXTURE0),d.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),p.updatePaintBuffers(_)}function $g(y,i,d,p,_,x){(_||y.lineAtlas.dirty)&&(i.activeTexture.set(d.TEXTURE0),y.lineAtlas.bind(i)),p.updatePaintBuffers(x)}function ih(y,i,d,p,_,x,A){const R=x.gradients[_.id];let M=R.texture;_.gradientVersion!==R.version&&(M=Tl(y,i,d,p,_,x,A,R)),d.activeTexture.set(p.TEXTURE0),M.bind(_.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}function lf(y,i,d,p,_,x,A,R,M){const z=x.gradients[_.id];let j=z.texture;_.gradientVersion!==z.version&&(j=Tl(y,i,d,p,_,x,A,z)),d.activeTexture.set(p.TEXTURE0),j.bind(_.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE),d.activeTexture.set(p.TEXTURE1),y.lineAtlas.bind(d),R.updatePaintBuffers(M)}function cf(y,i,d,p,_){if(!d||!p||!p.imageAtlas)return;const x=p.imageAtlas.patternPositions;let A=x[d.to.toString()],R=x[d.from.toString()];if(!A&&R&&(A=R),!R&&A&&(R=A),!A||!R){const M=_.getPaintProperty(i);A=x[M],R=x[M]}A&&R&&y.setConstantPatternPositions(A,R)}function uf(y,i,d,p,_,x,A,R){const M=y.context.gl,z="fill-pattern",j=d.paint.get(z),X=j&&j.constantOr(1),H=d.getCrossfadeParameters();let Q,re,he,de,ge;const Pe=y.transform,De=d.paint.get("fill-translate"),Ee=d.paint.get("fill-translate-anchor");A?(re=X&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=M.LINES):(re=X?"fillPattern":"fill",Q=M.TRIANGLES);const Oe=j.constantOr(null);for(const Ue of p){const Me=i.getTile(Ue);if(X&&!Me.patternsLoaded())continue;const He=Me.getBucket(d);if(!He)continue;const dt=He.programConfigurations.get(d.id),ot=y.useProgram(re,dt),lt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ue);X&&(y.context.activeTexture.set(M.TEXTURE0),Me.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),dt.updatePaintBuffers(H)),cf(dt,z,Oe,Me,d);const ft=Pe.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Vt=a.aD(Pe,Me,De,Ee);if(A){de=He.indexBuffer2,ge=He.segments2;const Dt=[M.drawingBufferWidth,M.drawingBufferHeight];he=re==="fillOutlinePattern"&&X?Ly(y,H,Me,Dt,Vt):ju(Dt,Vt)}else de=He.indexBuffer,ge=He.segments,he=X?bg(y,H,Me,Vt):{u_fill_translate:Vt};const $t=y.stencilModeForClipping(Ue);ot.draw(y.context,Q,_,$t,x,yn.backCCW,he,lt,ft,d.id,He.layoutVertexBuffer,de,ge,d.paint,y.transform.zoom,dt)}}function Sl(y,i,d,p,_,x,A,R){const M=y.context,z=M.gl,j="fill-extrusion-pattern",X=d.paint.get(j),H=X.constantOr(1),Q=d.getCrossfadeParameters(),re=d.paint.get("fill-extrusion-opacity"),he=X.constantOr(null),de=y.transform;for(const ge of p){const Pe=i.getTile(ge),De=Pe.getBucket(d);if(!De)continue;const Ee=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ge),Oe=De.programConfigurations.get(d.id),Ue=y.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Oe);H&&(y.context.activeTexture.set(z.TEXTURE0),Pe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Oe.updatePaintBuffers(Q));const Me=de.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!R,applyTerrainMatrix:!0});cf(Oe,j,he,Pe,d);const He=a.aD(de,Pe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),dt=d.paint.get("fill-extrusion-vertical-gradient"),ot=H?yc(y,dt,re,He,ge,Q,Pe):gl(y,dt,re,He);Ue.draw(M,M.gl.TRIANGLES,_,x,A,yn.backCCW,ot,Ee,Me,d.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,d.paint,y.transform.zoom,Oe,y.style.map.terrain&&De.centroidVertexBuffer)}}function Ac(y,i,d,p,_,x,A,R,M){var z;const j=y.style.projection,X=y.context,H=y.transform,Q=X.gl,re=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],he=y.useProgram("hillshade",null,!1,re),de=!y.options.moving;for(const ge of p){const Pe=i.getTile(ge),De=Pe.fbo;if(!De)continue;const Ee=j.getMeshFromTileID(X,ge.canonical,R,!0,"raster"),Oe=(z=y.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ge);X.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,De.colorAttachment.get());const Ue=H.getProjectionData({overscaledTileID:ge,aligned:de,applyGlobeMatrix:!M,applyTerrainMatrix:!0});he.draw(X,Q.TRIANGLES,x,_[ge.overscaledZ],A,yn.backCCW,Tg(y,Pe,d),Oe,Ue,d.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}}function hf(y,i,d,p,_,x,A,R,M){var z;const j=y.style.projection,X=y.context,H=y.transform,Q=X.gl,re=y.useProgram("colorRelief"),he=!y.options.moving;let de=!0,ge=0;for(const Pe of p){const De=i.getTile(Pe),Ee=De.dem;if(de){const ot=Q.getParameter(Q.MAX_TEXTURE_SIZE),{elevationTexture:lt,colorTexture:ft}=d.getColorRampTextures(X,ot,Ee.getUnpackVector());X.activeTexture.set(Q.TEXTURE1),lt.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),X.activeTexture.set(Q.TEXTURE4),ft.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),de=!1,ge=lt.size[0]}if(!Ee||!Ee.data)continue;const Oe=Ee.stride,Ue=Ee.getPixels();if(X.activeTexture.set(Q.TEXTURE0),X.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||y.getTileTexture(Oe),De.demTexture){const ot=De.demTexture;ot.update(Ue,{premultiply:!1}),ot.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}else De.demTexture=new a.T(X,Ue,Q.RGBA,{premultiply:!1}),De.demTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Me=j.getMeshFromTileID(X,Pe.canonical,R,!0,"raster"),He=(z=y.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Pe),dt=H.getProjectionData({overscaledTileID:Pe,aligned:he,applyGlobeMatrix:!M,applyTerrainMatrix:!0});re.draw(X,Q.TRIANGLES,x,_[Pe.overscaledZ],A,yn.backCCW,Eg(d,De.dem,ge),He,dt,d.id,Me.vertexBuffer,Me.indexBuffer,Me.segments)}}const sh=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Kn(y,i,d,p,_,x,A,R,M=!1,z=!1){const j=p[p.length-1].overscaledZ,X=y.context,H=X.gl,Q=y.useProgram("raster"),re=y.transform,he=y.style.projection,de=y.colorModeForRenderPass(),ge=!y.options.moving,Pe=d.paint.get("raster-opacity"),De=d.paint.get("raster-resampling"),Ee=d.paint.get("raster-fade-duration"),Oe=!!y.style.map.terrain;for(const Ue of p){const Me=y.getDepthModeForSublayer(Ue.overscaledZ-j,Pe===1?Wr.ReadWrite:Wr.ReadOnly,H.LESS),He=i.getTile(Ue),dt=De==="nearest"?H.NEAREST:H.LINEAR;X.activeTexture.set(H.TEXTURE0),He.texture.bind(dt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(H.TEXTURE1);const{parentTile:ot,parentScaleBy:lt,parentTopLeft:ft,fadeValues:Vt}=Na(He,i,Ee,Oe);He.fadeOpacity=Vt.tileOpacity,ot?(ot.fadeOpacity=Vt.parentTileOpacity,ot.texture.bind(dt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST)):He.texture.bind(dt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&X.extTextureFilterAnisotropic&&y.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const $t=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ue),Dt=re.getProjectionData({overscaledTileID:Ue,aligned:ge,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Sr=Uy(ft,lt,Vt.fadeMix,d,R),$r=he.getMeshFromTileID(X,Ue.canonical,x,A,"raster");Q.draw(X,H.TRIANGLES,Me,_?_[Ue.overscaledZ]:on.disabled,de,M?yn.frontCCW:yn.backCCW,Sr,$t,Dt,d.id,$r.vertexBuffer,$r.indexBuffer,$r.segments)}}function Na(y,i,d,p){const _={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(d===0||p)return _;if(y.fadingParentID){const x=i._getLoadedTile(y.fadingParentID);if(!x)return _;const A=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),R=[y.tileID.canonical.x*A%1,y.tileID.canonical.y*A%1],M=(function(z,j,X){const H=N(),Q=(H-j.timeAdded)/X,re=z.fadingDirection===Y.Incoming,he=a.ae((H-z.timeAdded)/X,0,1),de=a.ae(1-Q,0,1),ge=re?he:de;return{tileOpacity:ge,parentTileOpacity:re?de:he,fadeMix:{opacity:1,mix:1-ge}}})(y,x,d);return{parentTile:x,parentScaleBy:A,parentTopLeft:R,fadeValues:M}}if(y.selfFading){const x=(function(A,R){const M=(N()-A.timeAdded)/R,z=a.ae(M,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(y,d);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:x}}return _}const Os=new a.bf(1,0,0,1),df=new a.bf(0,1,0,1),oh=new a.bf(0,0,1,1),Hg=new a.bf(1,0,1,1),Al=new a.bf(0,1,1,1);function ah(y,i,d,p){Pl(y,0,i+d/2,y.transform.width,d,p)}function El(y,i,d,p){Pl(y,i-d/2,0,d,y.transform.height,p)}function Pl(y,i,d,p,_,x){const A=y.context,R=A.gl;R.enable(R.SCISSOR_TEST),R.scissor(i*y.pixelRatio,d*y.pixelRatio,p*y.pixelRatio,_*y.pixelRatio),A.clear({color:x}),R.disable(R.SCISSOR_TEST)}function Zg(y,i,d){const p=y.context,_=p.gl,x=y.useProgram("debug"),A=Wr.disabled,R=on.disabled,M=y.colorModeForRenderPass(),z="$debug",j=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);p.activeTexture.set(_.TEXTURE0);const X=i.getTileByID(d.key).latestRawTileData,H=Math.floor((X&&X.byteLength||0)/1024),Q=i.getTile(d).tileSize,re=512/Math.min(Q,512)*(d.overscaledZ/y.transform.zoom)*.5;let he=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(he+=` => ${d.overscaledZ}`),(function(ge,Pe){ge.initDebugOverlayCanvas();const De=ge.debugOverlayCanvas,Ee=ge.context.gl,Oe=ge.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,De.width,De.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(Pe,5,5),Oe.strokeText(Pe,5,5),ge.debugOverlayTexture.update(De),ge.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)})(y,`${he} ${H}kB`);const de=y.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(p,_.TRIANGLES,A,R,Mn.alphaBlended,yn.disabled,wg(a.bf.transparent,re),null,de,z,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),x.draw(p,_.LINE_STRIP,A,R,M,yn.disabled,wg(a.bf.red),j,de,z,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function ff(y,i,d,p){const{isRenderingGlobe:_}=p,x=y.context,A=x.gl,R=y.transform,M=y.colorModeForRenderPass(),z=y.getDepthModeFor3D(),j=y.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,y.width,y.height]);for(const X of d){const H=i.getTerrainMesh(X.tileID),Q=y.renderToTexture.getTexture(X),re=i.getTerrainData(X.tileID);x.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Q.texture);const he=i.getMeshFrameDelta(R.zoom),de=R.calculateFogMatrix(X.tileID.toUnwrapped()),ge=Xd(he,de,y.style.sky,R.pitch,_),Pe=R.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});j.draw(x,A.TRIANGLES,z,on.disabled,M,yn.backCCW,ge,re,Pe,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}}function pf(y,i){if(!i.mesh){const d=new a.aL;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const p=new a.aN;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),i.mesh=new zs(y.createVertexBuffer(d,Kr.members),y.createIndexBuffer(p),a.aM.simpleSegment(0,0,d.length,p.length))}return i.mesh}class Xg{constructor(i,d){this.context=new Vg(i),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ai(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Lr.maxUnderzooming+Lr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Io}resize(i,d,p){if(this.width=Math.floor(i*p),this.height=Math.floor(d*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const i=this.context,d=new a.aL;d.emplaceBack(0,0),d.emplaceBack(a.$,0),d.emplaceBack(0,a.$),d.emplaceBack(a.$,a.$),this.tileExtentBuffer=i.createVertexBuffer(d,Kr.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const p=new a.aL;p.emplaceBack(0,0),p.emplaceBack(a.$,0),p.emplaceBack(0,a.$),p.emplaceBack(a.$,a.$),this.debugBuffer=i.createVertexBuffer(p,Kr.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const _=new a.c7;_.emplaceBack(0,0,0,0),_.emplaceBack(a.$,0,a.$,0),_.emplaceBack(0,a.$,0,a.$),_.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=i.createVertexBuffer(_,Zd.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const x=new a.aL;x.emplaceBack(0,0),x.emplaceBack(a.$,0),x.emplaceBack(0,a.$),x.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(x,Kr.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const A=new a.aL;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(A,Kr.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const R=new a.c8;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(R);const M=new a.aN;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(M);const z=this.context.gl;this.stencilClearMode=new on({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new zs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,d=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.L();a.bZ(p,0,this.width,this.height,0,0,1),a.N(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const _={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(i,d.TRIANGLES,Wr.disabled,this.stencilClearMode,Mn.disabled,yn.disabled,null,null,_,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,d,p){if(this.currentStencilSource===i.source||!i.isTileClipped()||!d||!d.length)return;this.currentStencilSource=i.source,this.nextStencilID+d.length>256&&this.clearStencil();const _=this.context;_.setColorMode(Mn.disabled),_.setDepthMode(Wr.disabled);const x={};for(const A of d)x[A.key]=this.nextStencilID++;this._renderTileMasks(x,d,p,!0),this._renderTileMasks(x,d,p,!1),this._tileClippingMaskIDs=x}_renderTileMasks(i,d,p,_){const x=this.context,A=x.gl,R=this.style.projection,M=this.transform,z=this.useProgram("clippingMask");for(const j of d){const X=i[j.key],H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),Q=R.getMeshFromTileID(this.context,j.canonical,_,!0,"stencil"),re=M.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!p,applyTerrainMatrix:!0});z.draw(x,A.TRIANGLES,Wr.disabled,new on({func:A.ALWAYS,mask:0},X,255,A.KEEP,A.KEEP,A.REPLACE),Mn.disabled,p?yn.disabled:yn.backCCW,null,H,re,"$clipping",Q.vertexBuffer,Q.indexBuffer,Q.segments)}}_renderTilesDepthBuffer(){const i=this.context,d=i.gl,p=this.style.projection,_=this.transform,x=this.useProgram("depth"),A=this.getDepthModeFor3D(),R=Lt(_,{tileSize:_.tileSize});for(const M of R){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),j=p.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),X=_.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(i,d.TRIANGLES,A,on.disabled,Mn.disabled,yn.backCCW,null,z,X,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,d=this.context.gl;return new on({func:d.NOTEQUAL,mask:255},i,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(i){const d=this.context.gl;return new on({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const d=this.context.gl,p=i.sort(((A,R)=>R.overscaledZ-A.overscaledZ)),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const A={};for(let R=0;R<x;R++)A[R+_]=new on({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[A,p]}return[{[_]:on.disabled},p]}stencilConfigForOverlapTwoPass(i){const d=this.context.gl,p=i.sort(((A,R)=>R.overscaledZ-A.overscaledZ)),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(this.clearStencil(),x>1){const A={},R={};for(let M=0;M<x;M++)A[M+_]=new on({func:d.GREATER,mask:255},x+1+M,255,d.KEEP,d.KEEP,d.REPLACE),R[M+_]=new on({func:d.GREATER,mask:255},1+M,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*x+1,[A,R,p]}return this.nextStencilID=3,[{[_]:new on({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[_]:new on({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Mn([i.CONSTANT_COLOR,i.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mn.unblended:Mn.alphaBlended}getDepthModeForSublayer(i,d,p){if(!this.opaquePassEnabledForLayer())return Wr.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Wr(p||this.context.gl.LEQUAL,d,[_,_])}getDepthModeFor3D(){return new Wr(this.context.gl.LEQUAL,Wr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,d){var p,_;this.style=i,this.options=d,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(N()),this.imageManager.beginFrame();const x=this.style._order,A=this.style.sourceCaches,R={},M={},z={},j={isRenderingToTexture:!1,isRenderingGlobe:((p=i.projection)===null||p===void 0?void 0:p.transitionState)>0};for(const H in A){const Q=A[H];Q.used&&Q.prepare(this.context),R[H]=Q.getVisibleCoordinates(!1),M[H]=R[H].slice().reverse(),z[H]=Q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<x.length;H++)if(this.style._layers[x[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of x){const Q=this.style._layers[H];if(!Q.hasOffscreenPass()||Q.isHidden(this.transform.zoom))continue;const re=M[Q.source];(Q.type==="custom"||re.length)&&this.renderLayer(this,A[Q.source],Q,re,j)}if((_=this.style.projection)===null||_===void 0||_.updateGPUdependent({context:this.context,useProgram:H=>this.useProgram(H)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(H,Q){const re=H.context,he=re.gl,de=((Ue,Me,He)=>{const dt=Math.cos(Me.rollInRadians),ot=Math.sin(Me.rollInRadians),lt=Ve(Me),ft=Me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ue.properties.get("sky-color"),u_horizon_color:Ue.properties.get("horizon-color"),u_horizon:[(Me.width/2-lt*ot)*He,(Me.height/2+lt*dt)*He],u_horizon_normal:[-ot,dt],u_sky_horizon_blend:Ue.properties.get("sky-horizon-blend")*Me.height/2*He,u_sky_blend:ft}})(Q,H.style.map.transform,H.pixelRatio),ge=new Wr(he.LEQUAL,Wr.ReadWrite,[0,1]),Pe=on.disabled,De=H.colorModeForRenderPass(),Ee=H.useProgram("sky"),Oe=pf(re,Q);Ee.draw(re,he.TRIANGLES,ge,Pe,De,yn.disabled,de,null,void 0,"sky",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[x[this.currentLayer]],Q=A[H.source],re=R[H.source];this._renderTileClippingMasks(H,re,!1),this.renderLayer(this,Q,H,re,j)}this.renderPass="translucent";let X=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const H=this.style._layers[x[this.currentLayer]],Q=A[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H,j))continue;this.opaquePassEnabledForLayer()||X||(X=!0,j.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const re=(H.type==="symbol"?z:M)[H.source];this._renderTileClippingMasks(H,R[H.source],!!this.renderToTexture),this.renderLayer(this,Q,H,re,j)}if(j.isRenderingGlobe&&(function(H,Q,re){const he=H.context,de=he.gl,ge=H.useProgram("atmosphere"),Pe=new Wr(de.LEQUAL,Wr.ReadOnly,[0,1]),De=H.transform,Ee=(function(ft,Vt){const $t=ft.properties.get("position"),Dt=[-$t.x,-$t.y,-$t.z],Sr=a.ai(new Float64Array(16));return ft.properties.get("anchor")==="map"&&(a.b6(Sr,Sr,Vt.rollInRadians),a.b7(Sr,Sr,-Vt.pitchInRadians),a.b6(Sr,Sr,Vt.bearingInRadians),a.b7(Sr,Sr,Vt.center.lat*Math.PI/180),a.bz(Sr,Sr,-Vt.center.lng*Math.PI/180)),a.c6(Dt,Dt,Sr),Dt})(re,H.transform),Oe=De.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ue=Q.properties.get("atmosphere-blend")*Oe.projectionTransition;if(Ue===0)return;const Me=Ko(De.worldSize,De.center.lat),He=De.inverseProjectionMatrix,dt=new Float64Array(4);dt[3]=1,a.aw(dt,dt,De.modelViewProjectionMatrix),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1,a.aw(dt,dt,He),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1;const ot=((ft,Vt,$t,Dt,Sr)=>({u_sun_pos:ft,u_atmosphere_blend:Vt,u_globe_position:$t,u_globe_radius:Dt,u_inv_proj_matrix:Sr}))(Ee,Ue,[dt[0],dt[1],dt[2]],Me,He),lt=pf(he,Q);ge.draw(he,de.TRIANGLES,Pe,on.disabled,Mn.alphaBlended,yn.disabled,ot,null,null,"atmosphere",lt.vertexBuffer,lt.indexBuffer,lt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const H=(function(Q,re){let he=null;const de=Object.values(Q._layers).flatMap((Ee=>Ee.source&&!Ee.isHidden(re)?[Q.sourceCaches[Ee.source]]:[])),ge=de.filter((Ee=>Ee.getSource().type==="vector")),Pe=de.filter((Ee=>Ee.getSource().type!=="vector")),De=Ee=>{(!he||he.getSource().maxzoom<Ee.getSource().maxzoom)&&(he=Ee)};return ge.forEach((Ee=>De(Ee))),he||Pe.forEach((Ee=>De(Ee))),he})(this.style,this.transform.zoom);H&&(function(Q,re,he){for(let de=0;de<he.length;de++)Zg(Q,re,he[de])})(this,H,H.getVisibleCoordinates())}this.options.showPadding&&(function(H){const Q=H.transform.padding;ah(H,H.transform.height-(Q.top||0),3,Os),ah(H,Q.bottom||0,3,df),El(H,Q.left||0,3,oh),El(H,H.transform.width-(Q.right||0),3,Hg);const re=H.transform.centerPoint;(function(he,de,ge,Pe){Pl(he,de-1,ge-10,2,20,Pe),Pl(he,de-10,ge-1,20,2,Pe)})(H,re.x,H.transform.height-re.y,Al)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let _=this.terrainFacilitator.dirty;_||(_=i?!a.c9(d,p):!a.ca(d,p)),_||(_=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),_&&(a.cb(d,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(x,A){const R=x.context,M=R.gl,z=x.transform,j=Mn.unblended,X=new Wr(M.LEQUAL,Wr.ReadWrite,[0,1]),H=A.sourceCache.getRenderableTiles(),Q=x.useProgram("terrainDepth");R.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1});for(const re of H){const he=A.getTerrainMesh(re.tileID),de=A.getTerrainData(re.tileID),ge=z.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Pe={u_ele_delta:A.getMeshFrameDelta(z.zoom)};Q.draw(R,M.TRIANGLES,X,on.disabled,j,yn.backCCW,Pe,de,ge,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain),(function(x,A){const R=x.context,M=R.gl,z=x.transform,j=Mn.unblended,X=new Wr(M.LEQUAL,Wr.ReadWrite,[0,1]),H=A.getCoordsTexture(),Q=A.sourceCache.getRenderableTiles(),re=x.useProgram("terrainCoords");R.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1}),A.coordsIndex=[];for(const he of Q){const de=A.getTerrainMesh(he.tileID),ge=A.getTerrainData(he.tileID);R.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,H.texture);const Pe={u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(z.zoom)},De=z.getProjectionData({overscaledTileID:he.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});re.draw(R,M.TRIANGLES,X,on.disabled,j,yn.backCCW,Pe,ge,De,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),A.coordsIndex.push(he.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain))}renderLayer(i,d,p,_,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,a.cc(p)?(function(A,R,M,z,j,X){if(A.renderPass!=="translucent")return;const{isRenderingToTexture:H}=X,Q=on.disabled,re=A.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(he,de,ge,Pe,De,Ee,Oe,Ue,Me){const He=de.transform,dt=de.style.map.terrain,ot=De==="map",lt=Ee==="map";for(const ft of he){const Vt=Pe.getTile(ft),$t=Vt.getBucket(ge);if(!$t||!$t.text||!$t.text.segments.get().length)continue;const Dt=a.an($t.textSizeData,He.zoom),Sr=a.aC(Vt,1,de.transform.zoom),$r=kt(ot,de.transform,Sr),En=ge.layout.get("icon-text-fit")!=="none"&&$t.hasIconData();if(Dt){const Hn=Math.pow(2,He.zoom-Vt.tileID.overscaledZ),Un=dt?(en,Ln)=>dt.getElevation(ft,en,Ln):null;af($t,ot,lt,Me,He,$r,Hn,Dt,En,a.aD(He,Vt,Oe,Ue),ft.toUnwrapped(),Un)}}})(z,A,M,R,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),j),M.paint.get("icon-opacity").constantOr(1)!==0&&Tc(A,R,M,z,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),Q,re,H),M.paint.get("text-opacity").constantOr(1)!==0&&Tc(A,R,M,z,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),Q,re,H),R.map.showCollisionBoxes&&(Qu(A,R,M,z,!0),Qu(A,R,M,z,!1))})(i,d,p,_,this.style.placement.variableOffsets,x):a.cd(p)?(function(A,R,M,z,j){if(A.renderPass!=="translucent")return;const{isRenderingToTexture:X}=j,H=M.paint.get("circle-opacity"),Q=M.paint.get("circle-stroke-width"),re=M.paint.get("circle-stroke-opacity"),he=!M.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(Q.constantOr(1)===0||re.constantOr(1)===0))return;const de=A.context,ge=de.gl,Pe=A.transform,De=A.getDepthModeForSublayer(0,Wr.ReadOnly),Ee=on.disabled,Oe=A.colorModeForRenderPass(),Ue=[],Me=Pe.getCircleRadiusCorrection();for(let He=0;He<z.length;He++){const dt=z[He],ot=R.getTile(dt),lt=ot.getBucket(M);if(!lt)continue;const ft=M.paint.get("circle-translate"),Vt=M.paint.get("circle-translate-anchor"),$t=a.aD(Pe,ot,ft,Vt),Dt=lt.programConfigurations.get(M.id),Sr=A.useProgram("circle",Dt),$r=lt.layoutVertexBuffer,En=lt.indexBuffer,Hn=A.style.map.terrain&&A.style.map.terrain.getTerrainData(dt),Un={programConfiguration:Dt,program:Sr,layoutVertexBuffer:$r,indexBuffer:En,uniformValues:ml(A,ot,M,$t,Me),terrainData:Hn,projectionData:Pe.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!X,applyTerrainMatrix:!0})};if(he){const en=lt.segments.get();for(const Ln of en)Ue.push({segments:new a.aM([Ln]),sortKey:Ln.sortKey,state:Un})}else Ue.push({segments:lt.segments,sortKey:0,state:Un})}he&&Ue.sort(((He,dt)=>He.sortKey-dt.sortKey));for(const He of Ue){const{programConfiguration:dt,program:ot,layoutVertexBuffer:lt,indexBuffer:ft,uniformValues:Vt,terrainData:$t,projectionData:Dt}=He.state;ot.draw(de,ge.TRIANGLES,De,Ee,Oe,yn.backCCW,Vt,$t,Dt,M.id,lt,ft,He.segments,M.paint,A.transform.zoom,dt)}})(i,d,p,_,x):a.ce(p)?(function(A,R,M,z,j){if(M.paint.get("heatmap-opacity")===0)return;const X=A.context,{isRenderingToTexture:H,isRenderingGlobe:Q}=j;if(A.style.map.terrain){for(const re of z){const he=R.getTile(re);R.hasRenderableParent(re)||(A.renderPass==="offscreen"?rh(A,he,M,re,Q):A.renderPass==="translucent"&&wl(A,M,re,H,Q))}X.viewport.set([0,0,A.width,A.height])}else A.renderPass==="offscreen"?(function(re,he,de,ge){const Pe=re.context,De=Pe.gl,Ee=re.transform,Oe=on.disabled,Ue=new Mn([De.ONE,De.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(Me,He,dt){const ot=Me.gl;Me.activeTexture.set(ot.TEXTURE1),Me.viewport.set([0,0,He.width/4,He.height/4]);let lt=dt.heatmapFbos.get(a.c3);lt?(ot.bindTexture(ot.TEXTURE_2D,lt.colorAttachment.get()),Me.bindFramebuffer.set(lt.framebuffer)):(lt=nh(Me,He.width/4,He.height/4),dt.heatmapFbos.set(a.c3,lt))})(Pe,re,de),Pe.clear({color:a.bf.transparent});for(let Me=0;Me<ge.length;Me++){const He=ge[Me];if(he.hasRenderableParent(He))continue;const dt=he.getTile(He),ot=dt.getBucket(de);if(!ot)continue;const lt=ot.programConfigurations.get(de.id),ft=re.useProgram("heatmap",lt),Vt=Ee.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),$t=Ee.getCircleRadiusCorrection();ft.draw(Pe,De.TRIANGLES,Wr.disabled,Oe,Ue,yn.backCCW,Gd(dt,Ee.zoom,de.paint.get("heatmap-intensity"),$t),null,Vt,de.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,de.paint,Ee.zoom,lt)}Pe.viewport.set([0,0,re.width,re.height])})(A,R,M,z):A.renderPass==="translucent"&&(function(re,he){const de=re.context,ge=de.gl;de.setColorMode(re.colorModeForRenderPass());const Pe=he.heatmapFbos.get(a.c3);Pe&&(de.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Pe.colorAttachment.get()),de.activeTexture.set(ge.TEXTURE1),Wg(de,he).bind(ge.LINEAR,ge.CLAMP_TO_EDGE),re.useProgram("heatmapTexture").draw(de,ge.TRIANGLES,Wr.disabled,on.disabled,re.colorModeForRenderPass(),yn.disabled,Wu(re,he,0,1),null,null,he.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments,he.paint,re.transform.zoom))})(A,M)})(i,d,p,_,x):a.cf(p)?(function(A,R,M,z,j){if(A.renderPass!=="translucent")return;const{isRenderingToTexture:X}=j,H=M.paint.get("line-opacity"),Q=M.paint.get("line-width");if(H.constantOr(1)===0||Q.constantOr(1)===0)return;const re=A.getDepthModeForSublayer(0,Wr.ReadOnly),he=A.colorModeForRenderPass(),de=M.paint.get("line-dasharray"),ge=de.constantOr(1),Pe=M.paint.get("line-pattern"),De=Pe.constantOr(1),Ee=M.paint.get("line-gradient"),Oe=M.getCrossfadeParameters();let Ue;Ue=De?"linePattern":ge&&Ee?"lineGradientSDF":ge?"lineSDF":Ee?"lineGradient":"line";const Me=A.context,He=Me.gl,dt=A.transform;let ot=!0;for(const lt of z){const ft=R.getTile(lt);if(De&&!ft.patternsLoaded())continue;const Vt=ft.getBucket(M);if(!Vt)continue;const $t=Vt.programConfigurations.get(M.id),Dt=A.context.program.get(),Sr=A.useProgram(Ue,$t),$r=ot||Sr.program!==Dt,En=A.style.map.terrain&&A.style.map.terrain.getTerrainData(lt),Hn=Pe.constantOr(null),Un=de&&de.constantOr(null);if(Hn&&ft.imageAtlas){const Di=ft.imageAtlas,ci=Di.patternPositions[Hn.to.toString()],mi=Di.patternPositions[Hn.from.toString()];ci&&mi&&$t.setConstantPatternPositions(ci,mi)}else if(Un){const Di=M.layout.get("line-cap")==="round",ci=A.lineAtlas.getDash(Un.to,Di),mi=A.lineAtlas.getDash(Un.from,Di);$t.setConstantDashPositions(ci,mi)}const en=dt.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),Ln=dt.getPixelScale();let Pi;De?(Pi=Ig(A,ft,M,Ln,Oe),qy(Me,He,ft,$t,Oe)):ge&&Ee?(Pi=zy(A,ft,M,Ln,Oe,Vt.lineClipsArray.length),lf(A,R,Me,He,M,Vt,lt,$t,Oe)):ge?(Pi=vc(A,ft,M,Ln,Oe),$g(A,Me,He,$t,$r,Oe)):Ee?(Pi=Pg(A,ft,M,Ln,Vt.lineClipsArray.length),ih(A,R,Me,He,M,Vt,lt)):Pi=lo(A,ft,M,Ln);const ei=A.stencilModeForClipping(lt);Sr.draw(Me,He.TRIANGLES,re,ei,he,yn.disabled,Pi,En,en,M.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,M.paint,A.transform.zoom,$t,Vt.layoutVertexBuffer2),ot=!1}})(i,d,p,_,x):a.cg(p)?(function(A,R,M,z,j){const X=M.paint.get("fill-color"),H=M.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const{isRenderingToTexture:Q}=j,re=A.colorModeForRenderPass(),he=M.paint.get("fill-pattern"),de=A.opaquePassEnabledForLayer()&&!he.constantOr(1)&&X.constantOr(a.bf.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===de){const ge=A.getDepthModeForSublayer(1,A.renderPass==="opaque"?Wr.ReadWrite:Wr.ReadOnly);uf(A,R,M,z,ge,re,!1,Q)}if(A.renderPass==="translucent"&&M.paint.get("fill-antialias")){const ge=A.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Wr.ReadOnly);uf(A,R,M,z,ge,re,!0,Q)}})(i,d,p,_,x):a.ch(p)?(function(A,R,M,z,j){const X=M.paint.get("fill-extrusion-opacity");if(X===0)return;const{isRenderingToTexture:H}=j;if(A.renderPass==="translucent"){const Q=new Wr(A.context.gl.LEQUAL,Wr.ReadWrite,A.depthRangeFor3D);if(X!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Sl(A,R,M,z,Q,on.disabled,Mn.disabled,H),Sl(A,R,M,z,Q,A.stencilModeFor3D(),A.colorModeForRenderPass(),H);else{const re=A.colorModeForRenderPass();Sl(A,R,M,z,Q,on.disabled,re,H)}}})(i,d,p,_,x):a.ci(p)?(function(A,R,M,z,j){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const{isRenderingToTexture:X}=j,H=A.context,Q=A.style.projection.useSubdivision,re=A.getDepthModeForSublayer(0,Wr.ReadOnly),he=A.colorModeForRenderPass();if(A.renderPass==="offscreen")(function(de,ge,Pe,De,Ee,Oe,Ue){const Me=de.context,He=Me.gl;for(const dt of Pe){const ot=ge.getTile(dt),lt=ot.dem;if(!lt||!lt.data||!ot.needsHillshadePrepare)continue;const ft=lt.dim,Vt=lt.stride,$t=lt.getPixels();if(Me.activeTexture.set(He.TEXTURE1),Me.pixelStoreUnpackPremultiplyAlpha.set(!1),ot.demTexture=ot.demTexture||de.getTileTexture(Vt),ot.demTexture){const Sr=ot.demTexture;Sr.update($t,{premultiply:!1}),Sr.bind(He.NEAREST,He.CLAMP_TO_EDGE)}else ot.demTexture=new a.T(Me,$t,He.RGBA,{premultiply:!1}),ot.demTexture.bind(He.NEAREST,He.CLAMP_TO_EDGE);Me.activeTexture.set(He.TEXTURE0);let Dt=ot.fbo;if(!Dt){const Sr=new a.T(Me,{width:ft,height:ft,data:null},He.RGBA);Sr.bind(He.LINEAR,He.CLAMP_TO_EDGE),Dt=ot.fbo=Me.createFramebuffer(ft,ft,!0,!1),Dt.colorAttachment.set(Sr.texture)}Me.bindFramebuffer.set(Dt.framebuffer),Me.viewport.set([0,0,ft,ft]),de.useProgram("hillshadePrepare").draw(Me,He.TRIANGLES,Ee,Oe,Ue,yn.disabled,Sg(ot.tileID,lt),null,null,De.id,de.rasterBoundsBuffer,de.quadTriangleIndexBuffer,de.rasterBoundsSegments),ot.needsHillshadePrepare=!1}})(A,R,z,M,re,on.disabled,he),H.viewport.set([0,0,A.width,A.height]);else if(A.renderPass==="translucent")if(Q){const[de,ge,Pe]=A.stencilConfigForOverlapTwoPass(z);Ac(A,R,M,Pe,de,re,he,!1,X),Ac(A,R,M,Pe,ge,re,he,!0,X)}else{const[de,ge]=A.getStencilConfigForOverlapAndUpdateStencilID(z);Ac(A,R,M,ge,de,re,he,!1,X)}})(i,d,p,_,x):a.cj(p)?(function(A,R,M,z,j){if(A.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:X}=j,H=A.style.projection.useSubdivision,Q=A.getDepthModeForSublayer(0,Wr.ReadOnly),re=A.colorModeForRenderPass();if(H){const[he,de,ge]=A.stencilConfigForOverlapTwoPass(z);hf(A,R,M,ge,he,Q,re,!1,X),hf(A,R,M,ge,de,Q,re,!0,X)}else{const[he,de]=A.getStencilConfigForOverlapAndUpdateStencilID(z);hf(A,R,M,de,he,Q,re,!1,X)}})(i,d,p,_,x):a.bK(p)?(function(A,R,M,z,j){if(A.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:X}=j,H=R.getSource(),Q=A.style.projection.useSubdivision;if(H instanceof Tr)Kn(A,R,M,z,null,!1,!1,H.tileCoords,H.flippedWindingOrder,X);else if(Q){const[re,he,de]=A.stencilConfigForOverlapTwoPass(z);Kn(A,R,M,de,re,!1,!0,sh,!1,X),Kn(A,R,M,de,he,!0,!0,sh,!1,X)}else{const[re,he]=A.getStencilConfigForOverlapAndUpdateStencilID(z);Kn(A,R,M,he,re,!1,!0,sh,!1,X)}})(i,d,p,_,x):a.ck(p)?(function(A,R,M,z,j){const X=M.paint.get("background-color"),H=M.paint.get("background-opacity");if(H===0)return;const{isRenderingToTexture:Q}=j,re=A.context,he=re.gl,de=A.style.projection,ge=A.transform,Pe=ge.tileSize,De=M.paint.get("background-pattern");if(A.isPatternMissing(De))return;const Ee=!De&&X.a===1&&H===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==Ee)return;const Oe=on.disabled,Ue=A.getDepthModeForSublayer(0,Ee==="opaque"?Wr.ReadWrite:Wr.ReadOnly),Me=A.colorModeForRenderPass(),He=A.useProgram(De?"backgroundPattern":"background"),dt=z||Lt(ge,{tileSize:Pe,terrain:A.style.map.terrain});De&&(re.activeTexture.set(he.TEXTURE0),A.imageManager.bind(A.context));const ot=M.getCrossfadeParameters();for(const lt of dt){const ft=ge.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!Q,applyTerrainMatrix:!0}),Vt=De?$u(H,A,De,{tileID:lt,tileSize:Pe},ot):Mg(H,X),$t=A.style.map.terrain&&A.style.map.terrain.getTerrainData(lt),Dt=de.getMeshFromTileID(re,lt.canonical,!1,!0,"raster");He.draw(re,he.TRIANGLES,Ue,Oe,Me,yn.backCCW,Vt,$t,ft,M.id,Dt.vertexBuffer,Dt.indexBuffer,Dt.segments)}})(i,0,p,_,x):a.cl(p)&&(function(A,R,M,z){const{isRenderingGlobe:j}=z,X=A.context,H=M.implementation,Q=A.style.projection,re=A.transform,he=re.getProjectionDataForCustomLayer(j),de={farZ:re.farZ,nearZ:re.nearZ,fov:re.fov*Math.PI/180,modelViewProjectionMatrix:re.modelViewProjectionMatrix,projectionMatrix:re.projectionMatrix,shaderData:{variantName:Q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Q.shaderPreludeCode.vertexSource}`,define:Q.shaderDefine},defaultProjectionData:he},ge=H.renderingMode?H.renderingMode:"2d";if(A.renderPass==="offscreen"){const Pe=H.prerender;Pe&&(A.setCustomLayerDefaults(),X.setColorMode(A.colorModeForRenderPass()),Pe.call(H,X.gl,de),X.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),X.setColorMode(A.colorModeForRenderPass()),X.setStencilMode(on.disabled);const Pe=ge==="3d"?A.getDepthModeFor3D():A.getDepthModeForSublayer(0,Wr.ReadOnly);X.setDepthMode(Pe),H.render(X.gl,de),X.setDirty(),A.setBaseState(),X.bindFramebuffer.set(null)}})(i,0,p,x))}saveTileTexture(i){const d=this._tileTextures[i.size[0]];d?d.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const d=this._tileTextures[i];return d&&d.length>0?d.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const d=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!d||!p}useProgram(i,d,p=!1,_=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,A=this.style.projection,R=p?oo.projectionMercator:A.shaderPreludeCode,M=p?Ru:A.shaderDefine,z=i+(d?d.cacheKey:"")+`/${p?gg:A.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(_?`/${_.join("/")}`:"");return this.cache[z]||(this.cache[z]=new Ny(this.context,oo[i],d,Jd[i],this._showOverdrawInspector,x,R,M,_)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:d}=this.context.gl;return this.width!==i||this.height!==d}}function gf(y,i){let d,p=!1,_=null,x=null;const A=()=>{_=null,p&&(y.apply(x,d),_=setTimeout(A,i),p=!1)};return(...R)=>(p=!0,x=this,d=R,_||A(),_)}class Qo{constructor(i){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let p;return d.split("&").map((_=>_.split("="))).forEach((_=>{_[0]===this._hashName&&(p=_)})),(p&&p[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:p,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const p=d.join("/");let _=p;_.split("&").length>0&&(_=_.split("&")[0]),this._hashName&&(_=`${this._hashName}=${p}`);let x=window.location.hash.replace(_,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let A=window.location.href.replace(/(#.+)?$/,x);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=gf(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),A=Math.round(d.lng*x)/x,R=Math.round(d.lat*x)/x,M=this._map.getBearing(),z=this._map.getPitch();let j="";if(j+=i?`/${A}/${R}/${p}`:`${p}/${R}/${A}`,(M||z)&&(j+="/"+Math.round(10*M)/10),z&&(j+=`/${Math.round(z)}`),this._hashName){const X=this._hashName;let H=!1;const Q=window.location.hash.slice(1).split("&").map((re=>{const he=re.split("=")[0];return he===X?(H=!0,`${he}=${j}`):re})).filter((re=>re));return H||Q.push(`${X}=${j}`),`#${Q.join("&")}`}return`#${j}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new a.S(+i[2],+i[1])}catch{return!1}const d=+i[0],p=+(i[3]||0),_=+(i[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&p>=-180&&p<=180&&_>=this._map.getMinPitch()&&_<=this._map.getMaxPitch()}}const Il={linearity:.3,easing:a.cm(0,0,.3,1)},qg=a.e({deceleration:2500,maxSpeed:1400},Il),Gg=a.e({deceleration:20,maxSpeed:1400},Il),Yg=a.e({deceleration:1e3,maxSpeed:360},Il),Kg=a.e({deceleration:1e3,maxSpeed:90},Il),Qg=a.e({deceleration:1e3,maxSpeed:360},Il);class Jg{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,d=N();for(;i.length>0&&d-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,d.roll+=x.rollDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const x=Jo(d.pan.mag(),p,a.e({},qg,i||{})),A=d.pan.mult(x.amount/d.pan.mag()),R=this._map.cameraHelper.handlePanInertia(A,this._map.transform);_.center=R.easingCenter,_.offset=R.easingOffset,Cl(_,x)}if(d.zoom){const x=Jo(d.zoom,p,Gg);_.zoom=this._map.transform.zoom+x.amount,Cl(_,x)}if(d.bearing){const x=Jo(d.bearing,p,Yg);_.bearing=this._map.transform.bearing+a.ae(x.amount,-179,179),Cl(_,x)}if(d.pitch){const x=Jo(d.pitch,p,Kg);_.pitch=this._map.transform.pitch+x.amount,Cl(_,x)}if(d.roll){const x=Jo(d.roll,p,Qg);_.roll=this._map.transform.roll+a.ae(x.amount,-179,179),Cl(_,x)}if(_.zoom||_.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),a.e(_,{noMoveStart:!0})}}function Cl(y,i){(!y.duration||y.duration<i.duration)&&(y.duration=i.duration,y.easing=i.easing)}function Jo(y,i,d){const{maxSpeed:p,linearity:_,deceleration:x}=d,A=a.ae(y*_/(i/1e3),-p,p),R=Math.abs(A)/(x*_);return{easing:d.easing,duration:1e3*R,amount:A*(R/2)}}class ms extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,p,_={}){p=p instanceof MouseEvent?p:new MouseEvent(i,p);const x=D.mousePos(d.getCanvas(),p),A=d.unproject(x);super(i,a.e({point:x,lngLat:A,originalEvent:p},_)),this._defaultPrevented=!1,this.target=d}}class ts extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,p){const _=i==="touchend"?p.changedTouches:p.touches,x=D.touchPos(d.getCanvasContainer(),_),A=x.map((M=>d.unproject(M))),R=x.reduce(((M,z,j,X)=>M.add(z.div(X.length))),new a.P(0,0));super(i,{points:x,point:R,lngLats:A,lngLat:d.unproject(R),originalEvent:p}),this._defaultPrevented=!1}}class Fs extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class em{constructor(i,d){this._map=i,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Fs(i.type,this._map,i))}mousedown(i,d){return this._mousedownPos=d,this._firePreventable(new ms(i.type,this._map,i))}mouseup(i){this._map.fire(new ms(i.type,this._map,i))}click(i,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new ms(i.type,this._map,i))}dblclick(i){return this._firePreventable(new ms(i.type,this._map,i))}mouseover(i){this._map.fire(new ms(i.type,this._map,i))}mouseout(i){this._map.fire(new ms(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ts(i.type,this._map,i))}touchmove(i){this._map.fire(new ts(i.type,this._map,i))}touchend(i){this._map.fire(new ts(i.type,this._map,i))}touchcancel(i){this._map.fire(new ts(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class js{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new ms(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new ms(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uo{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(a.P.convert(i),this._map.terrain)}}class tm{constructor(i,d){this._map=i,this._tr=new uo(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,d){this.isEnabled()&&i.shiftKey&&i.button===0&&(D.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(i,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=D.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const x=Math.min(_.x,p.x),A=Math.max(_.x,p.x),R=Math.min(_.y,p.y),M=Math.max(_.y,p.y);D.setTransform(this._box,`translate(${x}px,${R}px)`),this._box.style.width=A-x+"px",this._box.style.height=M-R+"px"}mouseupWindow(i,d){if(!this._active||i.button!==0)return;const p=this._startPos,_=d;if(this.reset(),D.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(D.remove(this._box),this._box=null),D.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,d){return this._map.fire(new a.l(i,{originalEvent:d}))}}function mf(y,i){if(y.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${i.length}`);const d={};for(let p=0;p<y.length;p++)d[y[p].identifier]=i[p];return d}class Gy{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=(function(_){const x=new a.P(0,0);for(const A of _)x._add(A);return x.div(_.length)})(d),this.touches=mf(p,d)))}touchmove(i,d,p){if(this.aborted||!this.centroid)return;const _=mf(p,d);for(const x in this.touches){const A=_[x];(!A||A.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(i,d,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class _f{constructor(i){this.singleTap=new Gy(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,d,p){this.singleTap.touchstart(i,d,p)}touchmove(i,d,p){this.singleTap.touchmove(i,d,p)}touchend(i,d,p){const _=this.singleTap.touchend(i,d,p);if(_){const x=i.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(_)<30;if(x&&A||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class rm{constructor(i){this._tr=new uo(i),this._zoomIn=new _f({numTouches:1,numTaps:2}),this._zoomOut=new _f({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,d,p){this._zoomIn.touchstart(i,d,p),this._zoomOut.touchstart(i,d,p)}touchmove(i,d,p){this._zoomIn.touchmove(i,d,p),this._zoomOut.touchmove(i,d,p)}touchend(i,d,p){const _=this._zoomIn.touchend(i,d,p),x=this._zoomOut.touchend(i,d,p),A=this._tr;return _?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(_)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const d=this._moveFunction(...i);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(i,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,d){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const _=Array.isArray(d)?d[0]:d;return!this._moved&&_.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(p,_))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&D.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Mo=0,pr=2,nm={[Mo]:1,[pr]:2};class La{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const d=D.mouseButton(i);this._eventButton=d}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!(function(d,p){const _=nm[p];return d.buttons===void 0||(d.buttons&_)!==_})(i,this._eventButton)}isValidEndEvent(i){return D.mouseButton(i)===this._eventButton}}class im{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class Ec{constructor(i=new La({checkCorrectEvent:()=>!0}),d=new im){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(i,d,p){return i instanceof MouseEvent?d(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?p(i):void 0}startMove(i){this._executeRelevantHandler(i,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(i){this._executeRelevantHandler(i,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(i){return this._executeRelevantHandler(i,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(i){return this._executeRelevantHandler(i,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(i){return this._executeRelevantHandler(i,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const ea=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=i=>{i.preventDefault()}};class yf{constructor(i,d){this._clickTolerance=i.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,d,p){return this._calculateTransform(i,d,p)}touchmove(i,d,p){if(this._active){if(!this._shouldBePrevented(p.length))return i.preventDefault(),this._calculateTransform(i,d,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,d,p){this._calculateTransform(i,d,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,d,p){p.length>0&&(this._active=!0);const _=mf(p,d),x=new a.P(0,0),A=new a.P(0,0);let R=0;for(const z in _){const j=_[z],X=this._touches[z];X&&(x._add(j),A._add(j.sub(X)),R++,_[z]=j)}if(this._touches=_,this._shouldBePrevented(R)||!A.mag())return;const M=A.div(R);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(R),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class an{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(i,d,p){if(!this._firstTwoTouches)return;i.preventDefault();const[_,x]=this._firstTwoTouches,A=Rl(p,d,_),R=Rl(p,d,x);if(!A||!R)return;const M=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],M,i)}touchend(i,d,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,A=Rl(p,d,_),R=Rl(p,d,x);A&&R||(this._active&&D.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rl(y,i,d){for(let p=0;p<y.length;p++)if(y[p].identifier===d)return i[p]}function sm(y,i){return Math.log(y/i)/Math.LN2}class lh extends an{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,d){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(sm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sm(this._distance,p),pinchAround:d}}}function om(y,i){return 180*y.angleWith(i)/Math.PI}class am extends an{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,d,p){const _=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:om(this._vector,_),pinchAround:d}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const d=25/(Math.PI*this._minDiameter)*360,p=om(i,this._startVector);return Math.abs(p)<d}}function ch(y){return Math.abs(y.y)>Math.abs(y.x)}class uh extends an{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,d,p){super.touchstart(i,d,p),this._currentTouchCount=p.length}_start(i){this._lastPoints=i,ch(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,d,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=i[0].sub(this._lastPoints[0]),x=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(i,d,p){if(this._valid!==void 0)return this._valid;const _=i.mag()>=2,x=d.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=i.y>0==d.y>0;return ch(i)&&ch(d)&&A}}const lm={panStep:100,bearingStep:15,pitchStep:10};class cm{constructor(i){this._tr=new uo(i);const d=lm;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let d=0,p=0,_=0,x=0,A=0;switch(i.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),A=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:R=>{const M=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:um,zoom:d?Math.round(M.zoom)+d*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+p*this._bearingStep,pitch:M.pitch+_*this._pitchStep,offset:[-x*this._panStep,-A*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function um(y){return y*(2-y)}const hm=4.000244140625,Yy=1/450;class ko{constructor(i,d){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=i,this._tr=new uo(i),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yy}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let d=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=N(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%hm==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),i.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=i,this._delta-=d,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=D.mousePos(this._map.getCanvas(),i),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(a.S.convert(p.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>hm?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&M!==0&&(M=1/M);const z=typeof this._targetZoom!="number"?i.scale:a.ah(this._targetZoom);this._targetZoom=i.constrain(i.getCameraLngLat(),a.ak(z*M)).zoom,this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,p=this._startZoom,_=this._easing;let x,A=!1;if(this._type==="wheel"&&p&&_){const R=N()-this._lastWheelEventTime,M=Math.min((R+5)/200,1),z=_(M);x=a.C.number(p,d,z),M<1?this._frameId||(this._frameId=!0):A=!0}else x=d,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!A,zoomDelta:x-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let d=a.co;if(this._prevEase){const p=this._prevEase,_=(N()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),A=.27/Math.sqrt(x*x+1e-4)*.01,R=Math.sqrt(.0729-A*A);d=a.cm(A,R,.25,1)}return this._prevEase={start:N(),duration:i,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class kn{constructor(i,d){this._clickZoom=i,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ky{constructor(i){this._tr=new uo(i),this.reset()}reset(){this._active=!1}dblclick(i,d){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(){this._tap=new _f({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,d,p){if(!this._swipePoint)if(this._tapTime){const _=d[0],x=i.timeStamp-this._tapTime<500,A=this._tapPoint.dist(_)<30;x&&A?p.length>0&&(this._swipePoint=_,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(i,d,p)}touchmove(i,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=d[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,d,p)}touchend(i,d,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const _=this._tap.touchend(i,d,p);_&&(this._tapTime=i.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dh{constructor(i,d,p){this._el=i,this._mousePan=d,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vf{constructor(i,d,p,_){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=d,this._mousePitch=p,this._mouseRoll=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class bf{constructor(i,d,p,_){this._el=i,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class xf{constructor(i,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=D.create("div","maplibregl-cooperative-gesture-screen",i);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=d,this._container.appendChild(_);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=p,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(D.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,d){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:i,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const fh=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class ho extends a.l{}function Ml(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class Ir{constructor(i,d){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,x)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=_.type==="renderFrame"?void 0:_,R={needsRenderFrame:!1},M={},z={};for(const{handlerName:H,handler:Q,allowed:re}of this._handlers){if(!Q.isEnabled())continue;let he;if(this._blockedByActive(z,re,H))Q.reset();else if(Q[x||_.type]){if(a.cp(_,x||_.type)){const de=D.mousePos(this._map.getCanvas(),_);he=Q[x||_.type](_,de)}else if(a.cq(_,x||_.type)){const de=this._getMapTouches(_.touches),ge=D.touchPos(this._map.getCanvas(),de);he=Q[x||_.type](_,ge,de)}else a.cr(x||_.type)||(he=Q[x||_.type](_));this.mergeHandlerResult(R,M,he,H,A),he&&he.needsRenderFrame&&this._triggerRenderFrame()}(he||Q.isActive())&&(z[H]=Q)}const j={};for(const H in this._previousActiveHandlers)z[H]||(j[H]=A);this._previousActiveHandlers=z,(Object.keys(j).length||Ml(R))&&(this._changes.push([R,M,j]),this._triggerRenderFrame()),(Object.keys(z).length||Ml(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=R;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jg(i),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,A]of this._listeners)D.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[i,d,p]of this._listeners)D.removeEventListener(i,d,i===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new em(d,i));const _=d.boxZoom=new tm(d,i);this._add("boxZoom",_),i.interactive&&i.boxZoom&&_.enable();const x=d.cooperativeGestures=new xf(d,i.cooperativeGestures);this._add("cooperativeGestures",x),i.cooperativeGestures&&x.enable();const A=new rm(d),R=new Ky(d);d.doubleClickZoom=new kn(R,A),this._add("tapZoom",A),this._add("clickZoom",R),i.interactive&&i.doubleClickZoom&&d.doubleClickZoom.enable();const M=new hh;this._add("tapDragZoom",M);const z=d.touchPitch=new uh(d);this._add("touchPitch",z),i.interactive&&i.touchPitch&&d.touchPitch.enable(i.touchPitch);const j=()=>d.project(d.getCenter()),X=(function({enable:Ee,clickTolerance:Oe,aroundCenter:Ue=!0,minPixelCenterThreshold:Me=100,rotateDegreesPerPixelMoved:He=.8},dt){const ot=new La({checkCorrectEvent:lt=>D.mouseButton(lt)===0&&lt.ctrlKey||D.mouseButton(lt)===2&&!lt.ctrlKey});return new Ro({clickTolerance:Oe,move:(lt,ft)=>{const Vt=dt();if(Ue&&Math.abs(Vt.y-lt.y)>Me)return{bearingDelta:a.cn(new a.P(lt.x,ft.y),ft,Vt)};let $t=(ft.x-lt.x)*He;return Ue&&ft.y<Vt.y&&($t=-$t),{bearingDelta:$t}},moveStateManager:ot,enable:Ee,assignEvents:ea})})(i,j),H=(function({enable:Ee,clickTolerance:Oe,pitchDegreesPerPixelMoved:Ue=-.5}){const Me=new La({checkCorrectEvent:He=>D.mouseButton(He)===0&&He.ctrlKey||D.mouseButton(He)===2});return new Ro({clickTolerance:Oe,move:(He,dt)=>({pitchDelta:(dt.y-He.y)*Ue}),moveStateManager:Me,enable:Ee,assignEvents:ea})})(i),Q=(function({enable:Ee,clickTolerance:Oe,rollDegreesPerPixelMoved:Ue=.3},Me){const He=new La({checkCorrectEvent:dt=>D.mouseButton(dt)===2&&dt.ctrlKey});return new Ro({clickTolerance:Oe,move:(dt,ot)=>{const lt=Me();let ft=(ot.x-dt.x)*Ue;return ot.y<lt.y&&(ft=-ft),{rollDelta:ft}},moveStateManager:He,enable:Ee,assignEvents:ea})})(i,j);d.dragRotate=new vf(i,X,H,Q),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",H,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Q,["mousePitch"]),i.interactive&&i.dragRotate&&d.dragRotate.enable();const re=(function({enable:Ee,clickTolerance:Oe}){const Ue=new La({checkCorrectEvent:Me=>D.mouseButton(Me)===0&&!Me.ctrlKey});return new Ro({clickTolerance:Oe,move:(Me,He)=>({around:He,panDelta:He.sub(Me)}),activateOnStart:!0,moveStateManager:Ue,enable:Ee,assignEvents:ea})})(i),he=new yf(i,d);d.dragPan=new dh(p,re,he),this._add("mousePan",re),this._add("touchPan",he,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&d.dragPan.enable(i.dragPan);const de=new am,ge=new lh;d.touchZoomRotate=new bf(p,ge,de,M),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&d.touchZoomRotate.enable(i.touchZoomRotate),this._add("blockableMapEvent",new js(d));const Pe=d.scrollZoom=new ko(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Pe,["mousePan"]),i.interactive&&i.scrollZoom&&d.scrollZoom.enable(i.scrollZoom);const De=d.keyboard=new cm(d);this._add("keyboard",De),i.interactive&&i.keyboard&&d.keyboard.enable()}_add(i,d,p){this._handlers.push({handlerName:i,handler:d,allowed:p}),this._handlersById[i]=d}stop(i){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fh(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,d,p){for(const _ in i)if(_!==p&&(!d||d.indexOf(_)<0))return!0;return!1}_getMapTouches(i){const d=[];for(const p of i)this._el.contains(p.target)&&d.push(p);return d}mergeHandlerResult(i,d,p,_,x){if(!p)return;a.e(i,p);const A={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(d.zoom=A),p.panDelta!==void 0&&(d.drag=A),p.rollDelta!==void 0&&(d.roll=A),p.pitchDelta!==void 0&&(d.pitch=A),p.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const i={},d={},p={};for(const[_,x,A]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.rollDelta&&(i.rollDelta=(i.rollDelta||0)+_.rollDelta),_.around!==void 0&&(i.around=_.around),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),a.e(d,x),a.e(p,A);this._updateMapTransform(i,d,p),this._changes=[]}_updateMapTransform(i,d,p){const _=this._map,x=_._getTransformForUpdate(),A=_.terrain;if(!(Ml(i)||A&&this._terrainMovement))return this._fireEvents(d,p,!0);_._stop(!0);let{panDelta:R,zoomDelta:M,bearingDelta:z,pitchDelta:j,rollDelta:X,around:H,pinchAround:Q}=i;Q!==void 0&&(H=Q),H=H||_.transform.centerPoint,A&&!x.isPointOnMapSurface(H)&&(H=x.centerPoint);const re={panDelta:R,zoomDelta:M,rollDelta:X,pitchDelta:j,bearingDelta:z,around:H};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(H)&&(H=x.centerPoint);const he=H.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(R?H.sub(R):H);this._handleMapControls({terrain:A,tr:x,deltasForHelper:re,preZoomAroundLoc:he,combinedEventsInProgress:d,panDelta:R}),_._applyUpdatedTransform(x),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(d,p,!0)}_handleMapControls({terrain:i,tr:d,deltasForHelper:p,preZoomAroundLoc:_,combinedEventsInProgress:x,panDelta:A}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(p,d),i)return R.useGlobeControls?(this._terrainMovement||!x.drag&&!x.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(p,d,_)):this._terrainMovement||!x.drag&&!x.zoom?void(x.drag&&this._terrainMovement&&A?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(A))):R.handleMapControlsPan(p,d,_)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(p,d,_));R.handleMapControlsPan(p,d,_)}_fireEvents(i,d,p){const _=fh(this._eventsInProgress),x=fh(i),A={};for(const X in i){const{originalEvent:H}=i[X];this._eventsInProgress[X]||(A[`${X}start`]=H),this._eventsInProgress[X]=i[X]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const X in A)this._fireEvent(X,A[X]);x&&this._fireEvent("move",x.originalEvent);for(const X in i){const{originalEvent:H}=i[X];this._fireEvent(X,H)}const R={};let M;for(const X in this._eventsInProgress){const{handlerName:H,originalEvent:Q}=this._eventsInProgress[X];this._handlersById[H].isActive()||(delete this._eventsInProgress[X],M=d[H]||Q,R[`${X}end`]=M)}for(const X in R)this._fireEvent(X,R[X]);const z=fh(this._eventsInProgress),j=(_||x)&&!z;if(j&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&X.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(X)}if(p&&j){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;!X||!X.essential&&I.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:M})),H(this._map.getBearing())&&this._map.resetNorth()):(H(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,d){this._map.fire(new a.l(i,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((i=>{delete this._frameId,this.handleEvent(new ho("renderFrame",{timeStamp:i})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ur extends a.E{constructor(i,d,p){super(),this._renderFrameCallback=()=>{const _=Math.min((N()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=p.bearingSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(i,d){i.apply(this.transform),this.transform=i,this.cameraHelper=d}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(i,d){return this.jumpTo({center:i},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,d){return this.jumpTo({elevation:i},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,d,p){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},d),p)}panTo(i,d,p){return this.easeTo(a.e({center:i},d),p)}getZoom(){return this.transform.zoom}setZoom(i,d){return this.jumpTo({zoom:i},d),this}zoomTo(i,d,p){return this.easeTo(a.e({zoom:i},d),p)}zoomIn(i,d){return this.zoomTo(this.getZoom()+1,i,d),this}zoomOut(i,d){return this.zoomTo(this.getZoom()-1,i,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,d){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new a.l("movestart",d)).fire(new a.l("move",d)).fire(new a.l("moveend",d))),this}getBearing(){return this.transform.bearing}setBearing(i,d){return this.jumpTo({bearing:i},d),this}getPadding(){return this.transform.padding}setPadding(i,d){return this.jumpTo({padding:i},d),this}rotateTo(i,d,p){return this.easeTo(a.e({bearing:i},d),p)}resetNorth(i,d){return this.rotateTo(0,a.e({duration:1e3},i),d),this}resetNorthPitch(i,d){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},i),d),this}snapToNorth(i,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,d):this}getPitch(){return this.transform.pitch}setPitch(i,d){return this.jumpTo({pitch:i},d),this}getRoll(){return this.transform.roll}setRoll(i,d){return this.jumpTo({roll:i},d),this}cameraForBounds(i,d){i=ut.convert(i).adjustAntiMeridian();const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,d)}_cameraForBoxAndBearing(i,d,p,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=a.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const z=_.padding;_.padding={top:z,bottom:z,right:z,left:z}}const A=a.e(x,_.padding);_.padding=A;const R=this.transform,M=new ut(i,d);return this.cameraHelper.cameraForBoxAndBearing(_,A,M,p,R)}fitBounds(i,d,p){return this._fitInternal(this.cameraForBounds(i,d),d,p)}fitScreenCoordinates(i,d,p,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(i)),this.transform.screenPointToLocation(a.P.convert(d)),p,_),_,x)}_fitInternal(i,d,p){return i?(delete(d=a.e(i,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(i,d){this.stop();const p=this._getTransformForUpdate();let _=!1,x=!1,A=!1;const R=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,i);const M=p.zoom!==R;return"elevation"in i&&p.elevation!==+i.elevation&&p.setElevation(+i.elevation),"bearing"in i&&p.bearing!==+i.bearing&&(_=!0,p.setBearing(+i.bearing)),"pitch"in i&&p.pitch!==+i.pitch&&(x=!0,p.setPitch(+i.pitch)),"roll"in i&&p.roll!==+i.roll&&(A=!0,p.setRoll(+i.roll)),i.padding==null||p.isPaddingEqual(i.padding)||p.setPadding(i.padding),this._applyUpdatedTransform(p),this.fire(new a.l("movestart",d)).fire(new a.l("move",d)),M&&this.fire(new a.l("zoomstart",d)).fire(new a.l("zoom",d)).fire(new a.l("zoomend",d)),_&&this.fire(new a.l("rotatestart",d)).fire(new a.l("rotate",d)).fire(new a.l("rotateend",d)),x&&this.fire(new a.l("pitchstart",d)).fire(new a.l("pitch",d)).fire(new a.l("pitchend",d)),A&&this.fire(new a.l("rollstart",d)).fire(new a.l("roll",d)).fire(new a.l("rollend",d)),this.fire(new a.l("moveend",d))}calculateCameraOptionsFromTo(i,d,p,_=0){const x=a.a1.fromLngLat(i,d),A=a.a1.fromLngLat(p,_),R=A.x-x.x,M=A.y-x.y,z=A.z-x.z,j=Math.hypot(R,M,z);if(j===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(R,M),H=a.ak(this.transform.cameraToCenterDistance/j/this.transform.tileSize),Q=180*Math.atan2(R,-M)/Math.PI;let re=180*Math.acos(X/j)/Math.PI;return re=z<0?90-re:90+re,{center:A.toLngLat(),elevation:_,zoom:H,pitch:re,bearing:Q}}calculateCameraOptionsFromCameraLngLatAltRotation(i,d,p,_,x){const A=this.transform.calculateCenterFromCameraLngLatAlt(i,d,p,_);return{center:A.center,elevation:A.elevation,zoom:A.zoom,bearing:p,pitch:_,roll:x}}easeTo(i,d){this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.co},i)).animate===!1||!i.essential&&I.prefersReducedMotion)&&(i.duration=0);const p=this._getTransformForUpdate(),_=this.getBearing(),x=p.pitch,A=p.roll,R="bearing"in i?this._normalizeBearing(i.bearing,_):_,M="pitch"in i?+i.pitch:x,z="roll"in i?this._normalizeBearing(i.roll,A):A,j="padding"in i?i.padding:p.padding,X=a.P.convert(i.offset);let H,Q;i.around&&(H=a.S.convert(i.around),Q=p.locationToScreenPoint(H));const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},he=this.cameraHelper.handleEaseTo(p,{bearing:R,pitch:M,roll:z,padding:j,around:H,aroundPoint:Q,offsetAsPoint:X,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||_!==R,this._pitching=this._pitching||M!==x,this._rolling=this._rolling||z!==A,this._padding=!p.isPaddingEqual(j),this._zooming=this._zooming||he.isZooming,this._easeId=i.easeId,this._prepareEase(d,i.noMoveStart,re),this.terrain&&this._prepareElevation(he.elevationCenter),this._ease((de=>{he.easeFunc(de),this.terrain&&!i.freezeElevation&&this._updateElevation(de),this._applyUpdatedTransform(p),this._fireMoveEvents(d)}),(de=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(d,de)}),i),this}_prepareEase(i,d,p={}){this._moving=!0,d||p.moving||this.fire(new a.l("movestart",i)),this._zooming&&!p.zooming&&this.fire(new a.l("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new a.l("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new a.l("pitchstart",i)),this._rolling&&!p.rolling&&this.fire(new a.l("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&d!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(p-(d-(p*i+this._elevationStart))/(1-i)),this._elevationTarget=d}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const d=i.getCameraLngLat(),p=i.getCameraAltitude(),_=this.terrain?this.terrain.getElevationForLngLatZoom(d,i.zoom):0;if(p<_){const x=this.calculateCameraOptionsFromTo(d,_,i.center,i.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(i){const d=[];if(d.push((_=>this._elevateCameraIfInsideTerrain(_))),this.transformCameraUpdate&&d.push((_=>this.transformCameraUpdate(_))),!d.length)return;const p=i.clone();for(const _ of d){const x=p.clone(),{center:A,zoom:R,roll:M,pitch:z,bearing:j,elevation:X}=_(x);A&&x.setCenter(A),X!==void 0&&x.setElevation(X),R!==void 0&&x.setZoom(R),M!==void 0&&x.setRoll(M),z!==void 0&&x.setPitch(z),j!==void 0&&x.setBearing(j),p.apply(x)}this.transform.apply(p)}_fireMoveEvents(i){this.fire(new a.l("move",i)),this._zooming&&this.fire(new a.l("zoom",i)),this._rotating&&this.fire(new a.l("rotate",i)),this._pitching&&this.fire(new a.l("pitch",i)),this._rolling&&this.fire(new a.l("roll",i))}_afterEase(i,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const p=this._zooming,_=this._rotating,x=this._pitching,A=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new a.l("zoomend",i)),_&&this.fire(new a.l("rotateend",i)),x&&this.fire(new a.l("pitchend",i)),A&&this.fire(new a.l("rollend",i)),this.fire(new a.l("moveend",i))}flyTo(i,d){if(!i.essential&&I.prefersReducedMotion){const ft=a.Q(i,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(ft,d)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},i);const p=this._getTransformForUpdate(),_=p.bearing,x=p.pitch,A=p.roll,R=p.padding,M="bearing"in i?this._normalizeBearing(i.bearing,_):_,z="pitch"in i?+i.pitch:x,j="roll"in i?this._normalizeBearing(i.roll,A):A,X="padding"in i?i.padding:p.padding,H=a.P.convert(i.offset);let Q=p.centerPoint.add(H);const re=p.screenPointToLocation(Q),he=this.cameraHelper.handleFlyTo(p,{bearing:M,pitch:z,roll:j,padding:X,locationAtOffset:re,offsetAsPoint:H,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let de=i.curve;const ge=Math.max(p.width,p.height),Pe=ge/he.scaleOfZoom,De=he.pixelPathLength;typeof he.scaleOfMinZoom=="number"&&(de=Math.sqrt(ge/he.scaleOfMinZoom/De*2));const Ee=de*de;function Oe(ft){const Vt=(Pe*Pe-ge*ge+(ft?-1:1)*Ee*Ee*De*De)/(2*(ft?Pe:ge)*Ee*De);return Math.log(Math.sqrt(Vt*Vt+1)-Vt)}function Ue(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function Me(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const He=Oe(!1);let dt=function(ft){return Me(He)/Me(He+de*ft)},ot=function(ft){return ge*((Me(He)*(Ue(Vt=He+de*ft)/Me(Vt))-Ue(He))/Ee)/De;var Vt},lt=(Oe(!0)-He)/de;if(Math.abs(De)<2e-6||!isFinite(lt)){if(Math.abs(ge-Pe)<1e-6)return this.easeTo(i,d);const ft=Pe<ge?-1:1;lt=Math.abs(Math.log(Pe/ge))/de,ot=()=>0,dt=Vt=>Math.exp(ft*de*Vt)}return i.duration="duration"in i?+i.duration:1e3*lt/("screenSpeed"in i?+i.screenSpeed/de:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=_!==M,this._pitching=z!==x,this._rolling=j!==A,this._padding=!p.isPaddingEqual(X),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(he.targetCenter),this._ease((ft=>{const Vt=ft*lt,$t=1/dt(Vt),Dt=ot(Vt);this._rotating&&p.setBearing(a.C.number(_,M,ft)),this._pitching&&p.setPitch(a.C.number(x,z,ft)),this._rolling&&p.setRoll(a.C.number(A,j,ft)),this._padding&&(p.interpolatePadding(R,X,ft),Q=p.centerPoint.add(H)),he.easeFunc(ft,$t,Dt,Q),this.terrain&&!i.freezeElevation&&this._updateElevation(ft),this._applyUpdatedTransform(p),this._fireMoveEvents(d)}),(()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,d){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}return i||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(i,d,p){p.animate===!1||p.duration===0?(i(1),d()):(this._easeStart=N(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,d){i=a.aO(i,-180,180);const p=Math.abs(i-d);return Math.abs(i-360-d)<p&&(i-=360),Math.abs(i+360-d)<p&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(i),this.transform.tileZoom):null}}const kl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wf{constructor(i=kl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=D.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=D.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){D.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,d){const p=this._map._getUIString(`AttributionControl.${d}`);i.title=p,i.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map((_=>typeof _!="string"?"":_))):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const x=d[_];if(x.used||x.usedForTerrain){const A=x.getSource();A.attribution&&i.indexOf(A.attribution)<0&&i.push(A.attribution)}}i=i.filter((_=>String(_).trim())),i.sort(((_,x)=>_.length-x.length)),i=i.filter(((_,x)=>{for(let A=x+1;A<i.length;A++)if(i[A].indexOf(_)>=0)return!1;return!0}));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=D.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pc{constructor(i={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const p=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=D.create("div","maplibregl-ctrl");const d=D.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){D.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class hs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const d=++this._id;return this._queue.push({callback:i,id:d,cancelled:!1}),d}remove(i){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const _ of p)if(_.id===i)return void(_.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var dm=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ws extends a.E{constructor(i){super(),this._lastTilesetChange=N(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,d){this.sourceCache.update(i,d),this._renderableTilesKeys=[];const p={};for(const _ of Lt(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))p[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.terrainRttPosMatrix32f=new Float64Array(16),a.bZ(_.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[_.key]=new ee(_,this.tileSize),this._lastTilesetChange=N());for(const _ in this._tiles)p[_]||delete this._tiles[_]}freeRtt(i){for(const d in this._tiles){const p=this._tiles[d];(!i||p.tileID.equals(i)||p.tileID.isChildOf(i)||i.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((i=>this.getTileByID(i)))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i,d){return d?this._getTerrainCoordsForTileRanges(i,d):this._getTerrainCoordsForRegularTile(i)}_getTerrainCoordsForRegularTile(i){const d={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID,x=i.clone(),A=a.ba();if(_.canonical.equals(i.canonical))a.bZ(A,0,a.$,a.$,0,0,1);else if(_.canonical.isChildOf(i.canonical)){const R=_.canonical.z-i.canonical.z,M=_.canonical.x-(_.canonical.x>>R<<R),z=_.canonical.y-(_.canonical.y>>R<<R),j=a.$>>R;a.bZ(A,0,j,j,0,0,1),a.M(A,A,[-M*j,-z*j,0])}else{if(!i.canonical.isChildOf(_.canonical))continue;{const R=i.canonical.z-_.canonical.z,M=i.canonical.x-(i.canonical.x>>R<<R),z=i.canonical.y-(i.canonical.y>>R<<R),j=a.$>>R;a.bZ(A,0,a.$,a.$,0,0,1),a.M(A,A,[M*j,z*j,0]),a.N(A,A,[1/2**R,1/2**R,0])}}x.terrainRttPosMatrix32f=new Float32Array(A),d[p]=x}return d}_getTerrainCoordsForTileRanges(i,d){const p={};for(const _ of this._renderableTilesKeys){const x=this._tiles[_].tileID;if(!this._isWithinTileRanges(x,d))continue;const A=i.clone(),R=a.ba();if(x.canonical.z===i.canonical.z){const M=i.canonical.x-x.canonical.x,z=i.canonical.y-x.canonical.y;a.bZ(R,0,a.$,a.$,0,0,1),a.M(R,R,[M*a.$,z*a.$,0])}else if(x.canonical.z>i.canonical.z){const M=x.canonical.z-i.canonical.z,z=x.canonical.x-(x.canonical.x>>M<<M),j=x.canonical.y-(x.canonical.y>>M<<M),X=i.canonical.x-(x.canonical.x>>M),H=i.canonical.y-(x.canonical.y>>M),Q=a.$>>M;a.bZ(R,0,Q,Q,0,0,1),a.M(R,R,[-z*Q+X*a.$,-j*Q+H*a.$,0])}else{const M=i.canonical.z-x.canonical.z,z=i.canonical.x-(i.canonical.x>>M<<M),j=i.canonical.y-(i.canonical.y>>M<<M),X=(i.canonical.x>>M)-x.canonical.x,H=(i.canonical.y>>M)-x.canonical.y,Q=a.$<<M;a.bZ(R,0,Q,Q,0,0,1),a.M(R,R,[z*a.$+X*Q,j*a.$+H*Q,0])}A.terrainRttPosMatrix32f=new Float32Array(R),p[_]=A}return p}getSourceTile(i,d){const p=this.sourceCache._source;let _=i.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(_).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!x||!x.dem)&&d)for(;_>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(i.scaledTo(_--).key);return x}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}_isWithinTileRanges(i,d){return d[i.canonical.z]&&i.canonical.x>=d[i.canonical.z].minTileX&&i.canonical.x<=d[i.canonical.z].maxTileX&&i.canonical.y>=d[i.canonical.z].minTileY&&i.canonical.y<=d[i.canonical.z].maxTileY}}class fm{constructor(i,d,p){this._meshCache={},this.painter=i,this.sourceCache=new Ws(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,d,p,_=a.$){var x;if(!(d>=0&&d<_&&p>=0&&p<_))return 0;const A=this.getTerrainData(i),R=(x=A.tile)===null||x===void 0?void 0:x.dem;if(!R)return 0;const M=a.cs([],[d/_*a.$,p/_*a.$],A.u_terrain_matrix),z=[M[0]*R.dim,M[1]*R.dim],j=Math.floor(z[0]),X=Math.floor(z[1]),H=z[0]-j,Q=z[1]-X;return R.get(j,X)*(1-H)*(1-Q)+R.get(j+1,X)*H*(1-Q)+R.get(j,X+1)*(1-H)*Q+R.get(j+1,X+1)*H*Q}getElevationForLngLatZoom(i,d){if(!a.ct(d,i.wrap()))return 0;const{tileID:p,mercatorX:_,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(i,d);return this.getElevation(p,_%a.$,x%a.$,a.$)}getElevation(i,d,p,_=a.$){return this.getDEMElevation(i,d,p,_)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const _=this.painter.context,x=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(_,x,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(_,new a.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ai([])}const d=this.sourceCache.getSourceTile(i,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new a.T(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+i.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let x=i.canonical.z-d.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=_?x=i.canonical.z-_:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=i.canonical.x-(i.canonical.x>>x<<x),R=i.canonical.y-(i.canonical.y>>x<<x),M=a.cu(new Float64Array(16),[1/(a.$<<x),1/(a.$<<x),0]);a.M(M,M,[A*a.$,R*a.$,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(i){const d=this.painter,p=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,_,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,A=0;x<this._coordsTextureSize;x++)for(let R=0;R<this._coordsTextureSize;R++,A+=4)d[A+0]=255&R,d[A+1]=255&x,d[A+2]=R>>8<<4|x>>8,d[A+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new a.T(i,p,i.gl.RGBA,{premultiply:!1});return _.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),p=this.painter.context,_=p.gl,x=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(x,R-A-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null);const M=d[0]+(d[2]>>4<<8),z=d[1]+((15&d[2])<<8),j=this.coordsIndex[255-d[3]],X=j&&this.sourceCache.getTileByID(j);if(!X)return null;const H=this._coordsTextureSize,Q=(1<<X.tileID.canonical.z)*H;return new a.a1((X.tileID.canonical.x*H+M)/Q+X.tileID.wrap,(X.tileID.canonical.y*H+z)/Q,this.getElevation(X.tileID,M,z,H))}depthAtPoint(i){const d=new Uint8Array(4),p=this.painter.context,_=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(i){var d;const p=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,_=p&&i.canonical.y===0,x=p&&i.canonical.y===(1<<i.canonical.z)-1,A=`m_${_?"n":""}_${x?"s":""}`;if(this._meshCache[A])return this._meshCache[A];const R=this.painter.context,M=new a.cv,z=new a.aN,j=this.meshSize,X=a.$/j,H=j*j;for(let Me=0;Me<=j;Me++)for(let He=0;He<=j;He++)M.emplaceBack(He*X,Me*X,0);for(let Me=0;Me<H;Me+=j+1)for(let He=0;He<j;He++)z.emplaceBack(He+Me,j+He+Me+1,j+He+Me+2),z.emplaceBack(He+Me,j+He+Me+2,He+Me+1);const Q=M.length,re=Q+(j+1),he=(j+1)*j,de=_?a.bh:0,ge=_?0:1,Pe=x?a.bi:a.$,De=x?0:1;for(let Me=0;Me<=j;Me++)M.emplaceBack(Me*X,de,ge);for(let Me=0;Me<=j;Me++)M.emplaceBack(Me*X,Pe,De);for(let Me=0;Me<j;Me++)z.emplaceBack(he+Me,re+Me,re+Me+1),z.emplaceBack(he+Me,re+Me+1,he+Me+1),z.emplaceBack(0+Me,Q+Me+1,Q+Me),z.emplaceBack(0+Me,0+Me+1,Q+Me+1);const Ee=M.length,Oe=Ee+2*(j+1);for(const Me of[0,1])for(let He=0;He<=j;He++)for(const dt of[0,1])M.emplaceBack(Me*a.$,He*X,dt);for(let Me=0;Me<2*j;Me+=2)z.emplaceBack(Ee+Me,Ee+Me+1,Ee+Me+3),z.emplaceBack(Ee+Me,Ee+Me+3,Ee+Me+2),z.emplaceBack(Oe+Me,Oe+Me+3,Oe+Me+1),z.emplaceBack(Oe+Me,Oe+Me+2,Oe+Me+3);const Ue=new zs(R.createVertexBuffer(M,dm.members),R.createIndexBuffer(z),a.aM.simpleSegment(0,0,M.length,z.length));return this._meshCache[A]=Ue,Ue}getMeshFrameDelta(i){return 2*Math.PI*a.bu/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,d){var p;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(i,d);return(p=this.getMinMaxElevation(_).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(i){const d=this.getTerrainData(i).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=d.dem.min*this.exaggeration,p.maxElevation=d.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(i,d){const p=a.a1.fromLngLat(i.wrap()),_=(1<<d)*a.$,x=p.x*_,A=p.y*_,R=Math.floor(x/a.$),M=Math.floor(A/a.$);return{tileID:new a.Z(d,0,d,R,M),mercatorX:x,mercatorY:A}}}class Qy{constructor(i,d,p){this._context=i,this._size=d,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(p.texture),{id:i,fbo:d,texture:p,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>i.id!==d)),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((i=>!i.inUse))===!1}}const Dl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Jy{constructor(i,d){this.painter=i,this.terrain=d,this.pool=new Qy(i.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter((p=>!i._layers[p].isHidden(d))),this._coordsAscending={};for(const p in i.sourceCaches){this._coordsAscending[p]={};const _=i.sourceCaches[p].getVisibleCoordinates(),x=i.sourceCaches[p].getSource(),A=x instanceof Tr?x.terrainTileRanges:null;for(const R of _){const M=this.terrain.sourceCache.getTerrainCoords(R,A);for(const z in M)this._coordsAscending[p][z]||(this._coordsAscending[p][z]=[]),this._coordsAscending[p][z].push(M[z])}}this._coordsAscendingStr={};for(const p of i._order){const _=i._layers[p],x=_.source;if(Dl[_.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const A in this._coordsAscending[x])this._coordsAscendingStr[x][A]=this._coordsAscending[x][A].map((R=>R.key)).sort().join()}}for(const p of this._renderableTiles)for(const _ in this._coordsAscendingStr){const x=this._coordsAscendingStr[_][p.tileID.key];x&&x!==p.rttCoords[_]&&(p.rtt=[])}}renderLayer(i,d){if(i.isHidden(this.painter.transform.zoom))return!1;const p=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),_=i.type,x=this.painter,A=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Dl[_]&&(this._prevType&&Dl[this._prevType]||this._stacks.push([]),this._prevType=_,this._stacks[this._stacks.length-1].push(i.id),!A))return!0;if(Dl[this._prevType]||Dl[_]&&A){this._prevType=_;const R=this._stacks.length-1,M=this._stacks[R]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(ff(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[R]){const X=this.pool.getObjectForId(z.rtt[R].id);if(X.stamp===z.rtt[R].stamp){this.pool.useObject(X);continue}}const j=this.pool.getOrCreateFreeObject();this.pool.useObject(j),this.pool.stampObject(j),z.rtt[R]={id:j.id,stamp:j.stamp},x.context.bindFramebuffer.set(j.fbo.framebuffer),x.context.clear({color:a.bf.transparent,stencil:0}),x.currentStencilSource=void 0;for(let X=0;X<M.length;X++){const H=x.style._layers[M[X]],Q=H.source?this._coordsAscending[H.source][z.tileID.key]:[z.tileID];x.context.viewport.set([0,0,j.fbo.width,j.fbo.height]),x._renderTileClippingMasks(H,Q,!0),x.renderLayer(x,x.style.sourceCaches[H.source],H,Q,p),H.source&&(z.rttCoords[H.source]=this._coordsAscendingStr[H.source][z.tileID.key])}}return ff(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),Dl[_]}return!1}}const Ic={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Jn=g,ii={hash:!1,interactive:!0,bearingSnap:7,attributionControl:kl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},pm={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Cc{constructor(i,d,p=!1){this.mousedown=x=>{this.startMove(x,D.mousePos(this.element,x)),D.addEventListener(window,"mousemove",this.mousemove),D.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,D.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHandler.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=D.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),D.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=D.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const _=new Ec;this._rotatePitchHandler=new Ro({clickTolerance:3,move:(x,A)=>{const R=d.getBoundingClientRect(),M=new a.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:a.cn(new a.P(x.x,A.y),A,M),pitchDelta:p?-.5*(A.y-x.y):void 0}},moveStateManager:_,enable:!0,assignEvents:()=>{}}),this.map=i,D.addEventListener(d,"mousedown",this.mousedown),D.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),D.addEventListener(d,"touchcancel",this.reset)}startMove(i,d){this._rotatePitchHandler.dragStart(i,d),D.disableDrag()}move(i,d){const p=this.map,{bearingDelta:_,pitchDelta:x}=this._rotatePitchHandler.dragMove(i,d)||{};_&&p.setBearing(p.getBearing()+_),x&&p.setPitch(p.getPitch()+x)}off(){const i=this.element;D.removeEventListener(i,"mousedown",this.mousedown),D.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend),D.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){D.enableDrag(),D.removeEventListener(window,"mousemove",this.mousemove),D.removeEventListener(window,"mouseup",this.mouseup),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend)}}let fo;function ph(y,i,d,p=!1){if(p||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const _=new a.S(y.lng,y.lat);if(y=new a.S(y.lng,y.lat),i){const x=new a.S(y.lng-360,y.lat),A=new a.S(y.lng+360,y.lat),R=d.locationToScreenPoint(y).distSqr(i);d.locationToScreenPoint(x).distSqr(i)<R?y=x:d.locationToScreenPoint(A).distSqr(i)<R&&(y=A)}for(;Math.abs(y.lng-d.center.lng)>180;){const x=d.locationToScreenPoint(y);if(x.x>=0&&x.y>=0&&x.x<=d.width&&x.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y.lng!==_.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(y))?y:_}const Rc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gh(y,i,d){const p=y.classList;for(const _ in Rc)p.remove(`maplibregl-${d}-anchor-${_}`);p.add(`maplibregl-${d}-anchor-${i}`)}class Ba extends a.E{constructor(i){if(super(),this._onKeyPress=d=>{const p=d.code,_=d.charCode||d.keyCode;p!=="Space"&&p!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=d=>{const p=d.originalEvent.target,_=this._element;this._popup&&(p===_||_.contains(p))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=ph(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),D.setTransform(this._element,`${Rc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${_}`),I.frameAsync(new AbortController).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(i?.opacity,i?.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=D.create("div");const d=D.createNS("http://www.w3.org/2000/svg","svg"),p=41,_=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${p}px`),d.setAttributeNS(null,"width",`${_}px`),d.setAttributeNS(null,"viewBox",`0 0 ${_} ${p}`);const x=D.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const A=D.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const R=D.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of M){const Pe=D.createNS("http://www.w3.org/2000/svg","ellipse");Pe.setAttributeNS(null,"opacity","0.04"),Pe.setAttributeNS(null,"cx","10.5"),Pe.setAttributeNS(null,"cy","5.80029008"),Pe.setAttributeNS(null,"rx",ge.rx),Pe.setAttributeNS(null,"ry",ge.ry),R.appendChild(Pe)}const z=D.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const j=D.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(j);const X=D.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const H=D.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(H);const Q=D.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");const re=D.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=D.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const de=D.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),re.appendChild(he),re.appendChild(de),A.appendChild(R),A.appendChild(z),A.appendChild(X),A.appendChild(Q),A.appendChild(re),d.appendChild(A),d.setAttributeNS(null,"height",p*this._scale+"px"),d.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(d),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),gh(this._element,this._anchor,"marker"),i&&i.className)for(const d of i.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),D.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.S.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const _=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var d,p;const _=(d=this._map)===null||d===void 0?void 0:d.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!_||x){const Q=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Q&&(this._element.style.opacity=Q))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const A=this._map,R=A.terrain.depthAtPoint(this._pos),M=A.terrain.getElevationForLngLatZoom(this._lngLat,A.transform.tileZoom);if(A.transform.lngLatToCameraDepth(this._lngLat,M)-R<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/A.transform.pixelsPerMeter,j=Math.sin(A.getPitch()*Math.PI/180)*z,X=A.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),H=A.transform.lngLatToCameraDepth(this._lngLat,M+j)-X>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,d){return(this._opacity===void 0||i===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Tf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ol=0,za=!1;const Sf={maxWidth:100,unit:"metric"};function mh(y,i,d){const p=d&&d.maxWidth||100,_=y._container.clientHeight/2,x=y._container.clientWidth/2,A=y.unproject([x-p/2,_]),R=y.unproject([x+p/2,_]),M=Math.round(y.project(R).x-y.project(A).x),z=Math.min(p,M,y._container.clientWidth),j=A.distanceTo(R);if(d&&d.unit==="imperial"){const X=3.2808*j;X>5280?Ua(i,z,X/5280,y._getUIString("ScaleControl.Miles")):Ua(i,z,X,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Ua(i,z,j/1852,y._getUIString("ScaleControl.NauticalMiles")):j>=1e3?Ua(i,z,j/1e3,y._getUIString("ScaleControl.Kilometers")):Ua(i,z,j,y._getUIString("ScaleControl.Meters"))}function Ua(y,i,d,p){const _=(function(x){const A=Math.pow(10,`${Math.floor(x)}`.length-1);let R=x/A;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z})(R),A*R})(d);y.style.width=i*(_/d)+"px",y.innerHTML=`${_}&nbsp;${p}`}const Af={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ef=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _h(y){if(y){if(typeof y=="number"){const i=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-y),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const i=a.P.convert(y);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return _h(new a.P(0,0))}const yh=g;c.AJAXError=a.cz,c.Event=a.l,c.Evented=a.E,c.LngLat=a.S,c.MercatorCoordinate=a.a1,c.Point=a.P,c.addProtocol=a.cA,c.config=a.a,c.removeProtocol=a.cB,c.AttributionControl=wf,c.BoxZoomHandler=tm,c.CanvasSource=nr,c.CooperativeGesturesHandler=xf,c.DoubleClickZoomHandler=kn,c.DragPanHandler=dh,c.DragRotateHandler=vf,c.EdgeInsets=$i,c.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var i;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=d?.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){D.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=D.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);D.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=mr,c.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",i)),this._finish()}},this._updateCamera=i=>{const d=new a.S(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,_=this._map.getBearing(),x=a.e({bearing:_},this.options.fitBoundsOptions),A=ut.fromLngLat(d,p);this._map.fitBounds(A,x,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const d=new a.S(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=i.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=i=>{if(this._map){if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&za)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this._geolocateButton=D.create("button","maplibregl-ctrl-geolocate",this._container),D.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ba({element:this._dotElement}),this._circleElement=D.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ba({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const p=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))}))}},this.options=a.e({},Tf,y)}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return a._(this,arguments,void 0,(function*(i=!1){if(fo!==void 0&&!i)return fo;if(window.navigator.permissions===void 0)return fo=!!window.navigator.geolocation,fo;try{fo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fo=!!window.navigator.geolocation}return fo}))})().then((i=>this._finishSetupUI(i))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),D.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ol=0,za=!1}_isOutOfMapMaxBounds(y){const i=this._map.getMaxBounds(),d=y.coords;return i&&(d.longitude<i.getWest()||d.longitude>i.getEast()||d.latitude<i.getSouth()||d.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const i=this._map.project(y),d=this._map.unproject([i.x+100,i.y]),p=y.distanceTo(d)/100,_=2*this._accuracy/p;this._circleElement.style.width=`${_.toFixed(2)}px`,this._circleElement.style.height=`${_.toFixed(2)}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,za=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ol++,Ol>1?(y={maximumAge:6e5,timeout:0},za=!0):(y=this.options.positionOptions,za=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const i=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=D.create("button","maplibregl-ctrl-globe",this._container),D.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){D.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=Qo,c.ImageSource=Tr,c.KeyboardHandler=cm,c.LngLatBounds=ut,c.LogoControl=Pc,c.Map=class extends Ur{constructor(y){var i,d;a.cw.mark(a.cx.create);const p=Object.assign(Object.assign(Object.assign({},ii),y),{canvasContextAttributes:Object.assign(Object.assign({},ii.canvasContextAttributes),y.canvasContextAttributes)});if(p.minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const _=new Zi,x=new Qn;if(p.minZoom!==void 0&&_.setMinZoom(p.minZoom),p.maxZoom!==void 0&&_.setMaxZoom(p.maxZoom),p.minPitch!==void 0&&_.setMinPitch(p.minPitch),p.maxPitch!==void 0&&_.setMaxPitch(p.maxPitch),p.renderWorldCopies!==void 0&&_.setRenderWorldCopies(p.renderWorldCopies),p.transformConstrain!==null&&_.setConstrain(p.transformConstrain),super(_,x,{bearingSnap:p.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new hs,this._controls=[],this._mapId=a.a7(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=p.trackResize===!0,this._bearingSnap=p.bearingSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=p.refreshExpiredTiles===!0,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions===!0,this._collectResourceTiming=p.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ic),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.transformConstrain=p.transformConstrain,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=G.addThrottleControl((()=>this.isMoving())),this._requestManager=new le(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const M=gf((z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((z=>{R?M(z):R=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Ir(this,p),this._hash=p.hash&&new Qo(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,a.e({},p.fitBoundsOptions,{duration:0}))));const A=typeof p.style=="string"||((d=(i=p.style)===null||i===void 0?void 0:i.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,A),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new wf(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new Pc,p.logoPosition),this.on("style.load",(()=>{if(A||this._resizeTransform(),this.transform.unmodified){const R=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new a.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new a.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new a.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,i){return this.style.setGlobalStateProperty(y,i),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,i){if(i===void 0&&(i=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(y);return i>-1&&this._controls.splice(i,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return Lt(this.transform,y)}calculateCameraOptionsFromTo(y,i,d,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,i,d,p)}resize(y,i=!0){const[d,p]=this._containerDimensions(),_=this._getClampedPixelRatio(d,p);if(this._resizeCanvas(d,p,_),this.painter.resize(d,p,_),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const R=this._getClampedPixelRatio(d,p);this._resizeCanvas(d,p,R),this.painter.resize(d,p,R)}this._resizeTransform(i);const x=!this._moving;return x&&(this.stop(),this.fire(new a.l("movestart",y)).fire(new a.l("move",y))),this.fire(new a.l("resize",y)),x&&this.fire(new a.l("moveend",y)),this}_resizeTransform(y=!0){var i;const[d,p]=this._containerDimensions();this.transform.resize(d,p,y),(i=this._requestedCameraState)===null||i===void 0||i.resize(d,p,y)}_getClampedPixelRatio(y,i){const{0:d,1:p}=this._maxCanvasSize,_=this.getPixelRatio(),x=y*_,A=i*_;return Math.min(x>d?d/x:1,A>p?p/A:1)*_}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ut.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.setMinZoom(y),this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.setMaxZoom(y),this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrain(y),this._update()}project(y){return this.transform.locationToScreenPoint(a.S.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,i,d){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layers:i,listener:d,delegates:{mousemove:x=>{const A=i.filter((M=>this.getLayer(M))),R=A.length!==0?this.queryRenderedFeatures(x.point,{layers:A}):[];R.length?p||(p=!0,d.call(this,new ms(y,this,x.originalEvent,{features:R}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layers:i,listener:d,delegates:{mousemove:A=>{const R=i.filter((M=>this.getLayer(M)));(R.length!==0?this.queryRenderedFeatures(A.point,{layers:R}):[]).length?p=!0:p&&(p=!1,d.call(this,new ms(y,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,d.call(this,new ms(y,this,A.originalEvent)))}}}}{const p=_=>{const x=i.filter((R=>this.getLayer(R))),A=x.length!==0?this.queryRenderedFeatures(_.point,{layers:x}):[];A.length&&(_.features=A,d.call(this,_),delete _.features)};return{layers:i,listener:d,delegates:{[y]:p}}}}_saveDelegatedListener(y,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(i)}_removeDelegatedListener(y,i,d){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const p=this._delegatedListeners[y];for(let _=0;_<p.length;_++){const x=p[_];if(x.listener===d&&x.layers.length===i.length&&x.layers.every((A=>i.includes(A)))){for(const A in x.delegates)this.off(A,x.delegates[A]);return void p.splice(_,1)}}}on(y,i,d){if(d===void 0)return super.on(y,i);const p=typeof i=="string"?[i]:i,_=this._createDelegatedListener(y,p,d);this._saveDelegatedListener(y,_);for(const x in _.delegates)this.on(x,_.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(y,p,d)}}}once(y,i,d){if(d===void 0)return super.once(y,i);const p=typeof i=="string"?[i]:i,_=this._createDelegatedListener(y,p,d);for(const x in _.delegates){const A=_.delegates[x];_.delegates[x]=(...R)=>{this._removeDelegatedListener(y,p,d),A(...R)}}this._saveDelegatedListener(y,_);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(y,i,d){return d===void 0?super.off(y,i):(this._removeDelegatedListener(y,typeof i=="string"?[i]:i,d),this)}queryRenderedFeatures(y,i){if(!this.style)return[];let d;const p=y instanceof a.P||Array.isArray(y),_=p?y:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(p?{}:y)||{},_ instanceof a.P||typeof _[0]=="number")d=[a.P.convert(_)];else{const x=a.P.convert(_[0]),A=a.P.convert(_[1]);d=[x,new a.P(A.x,x.y),A,new a.P(x.x,A.y),x]}return this.style.queryRenderedFeatures(d,i,this.transform)}querySourceFeatures(y,i){return this.style.querySourceFeatures(y,i)}setStyle(y,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(y,i))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const i=this._locale[y];if(i==null)throw new Error(`Missing UI string '${y}'`);return i}_updateStyle(y,i){var d,p;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,i)));const _=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new pl(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,i,_):this.style.loadJSON(y,i,_),this):((p=(d=this.style)===null||d===void 0?void 0:d.projection)===null||p===void 0||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new pl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,i){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,"Style");a.j(d,new AbortController).then((p=>{this._updateDiff(p.data,i)})).catch((p=>{p&&this.fire(new a.k(p))}))}else typeof y=="object"&&this._updateDiff(y,i)}_updateDiff(y,i){try{this.style.setState(y,i)&&this._update(!0)}catch(d){a.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,i){return this._lazyInitEmptyStyle(),this.style.addSource(y,i),this._update(!0)}isSourceLoaded(y){const i=this.style&&this.style.sourceCaches[y];if(i!==void 0)return i.loaded();this.fire(new a.k(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const i=this.style.sourceCaches[y.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&i.reload();for(const d in this.style._layers){const p=this.style._layers[d];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),p.type==="color-relief"&&p.source===y.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fm(this.painter,i,y),this.painter.renderToTexture=new Jy(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var p;d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((p=d.source)===null||p===void 0?void 0:p.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:y})),this}getTerrain(){var y,i;return(i=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const i in y){const d=y[i]._tiles;for(const p in d){const _=d[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,i,d){if(d){const p=this.getSource(d);if(!p)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);p.calculateTileZoom=Xe(Math.max(1,y),Math.max(1,i))}else for(const p in this.style.sourceCaches)this.style.sourceCaches[p].getSource().calculateTileZoom=Xe(Math.max(1,y),Math.max(1,i));return this._update(!0),this}refreshTiles(y,i){const d=this.style.sourceCaches[y];if(!d)throw new Error(`There is no source cache with ID "${y}", cannot refresh tile`);i===void 0?d.reload(!0):d.refreshTiles(i.map((p=>new a.a4(p.z,p.x,p.y))))}addImage(y,i,d={}){const{pixelRatio:p=1,sdf:_=!1,stretchX:x,stretchY:A,content:R,textFitWidth:M,textFitHeight:z}=d;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:j,height:X,data:H}=i,Q=i;return this.style.addImage(y,{data:new a.R({width:j,height:X},new Uint8Array(H)),pixelRatio:p,stretchX:x,stretchY:A,content:R,textFitWidth:M,textFitHeight:z,sdf:_,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,y),this}}{const{width:j,height:X,data:H}=I.getImageData(i);this.style.addImage(y,{data:new a.R({width:j,height:X},H),pixelRatio:p,stretchX:x,stretchY:A,content:R,textFitWidth:M,textFitHeight:z,sdf:_,version:0})}}updateImage(y,i){const d=this.style.getImage(y);if(!d)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||a.b(i)?I.getImageData(i):i,{width:_,height:x,data:A}=p;if(_===void 0||x===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||x!==d.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(i instanceof HTMLImageElement||a.b(i));return d.data.replace(A,R),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return G.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,i){return this._lazyInitEmptyStyle(),this.style.addLayer(y,i),this._update(!0)}moveLayer(y,i){return this.style.moveLayer(y,i),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,i,d){return this.style.setLayerZoomRange(y,i,d),this._update(!0)}setFilter(y,i,d={}){return this.style.setFilter(y,i,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,i,d,p={}){return this.style.setPaintProperty(y,i,d,p),this._update(!0)}getPaintProperty(y,i){return this.style.getPaintProperty(y,i)}setLayoutProperty(y,i,d,p={}){return this.style.setLayoutProperty(y,i,d,p),this._update(!0)}getLayoutProperty(y,i){return this.style.getLayoutProperty(y,i)}setGlyphs(y,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,i,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,i,d,(p=>{p||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,i,(d=>{d||this._update(!0)})),this}setLight(y,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,i){return this.style.setFeatureState(y,i),this._update()}removeFeatureState(y,i){return this.style.removeFeatureState(y,i),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,i=0;return this._container&&(y=this._container.clientWidth||400,i=this._container.clientHeight||300),[y,i]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const i=this._canvasContainer=D.create("div","maplibregl-canvas-container",y);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=D.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),p=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],p);const _=this._controlContainer=D.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((A=>{x[A]=D.create("div",`maplibregl-ctrl-${A} `,_)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,i,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*i),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",(p=>{i={requestedAttributes:y},p&&(i.statusMessage=p.statusMessage,i.type=p.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!d){const p="Failed to initialize WebGL";throw i?(i.message=p,new Error(JSON.stringify(i))):new Error(p)}this.painter=new Xg(d,this.transform),B.testSupport(d)}migrateProjection(y,i){super.migrateProjection(y,i),this.painter.transform=y,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var i,d,p,_,x;const A=this._idleTriggered?this._fadeDuration:0,R=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const X=this.transform.zoom,H=N();this.style.zoomHistory.update(X,H);const Q=new a.F(X,{now:H,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=Q.crossFadingFactor();re===1&&re===this._crossFadingFactor||(M=!0,this._crossFadingFactor=re),this.style.update(Q)}const z=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==R;(p=this.style.projection)===null||p===void 0||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((_=this.style.projection)===null||_===void 0?void 0:_.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,A,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const j=this._sourcesDirty||this._styleDirty||this._placementDirty;return j||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i?.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),D.remove(this._canvasContainer),D.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,I.frame(this._frameRequest,(y=>{a.cw.frame(y),this._frameRequest=null;try{this._render(y)}catch(i){if(!a.cy(i)&&!(function(d){return d.message===Ug})(i))throw i}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Jn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},c.MapMouseEvent=ms,c.MapTouchEvent=ts,c.MapWheelEvent=Fs,c.Marker=Ba,c.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const i=this._map.getZoom(),d=i===this._map.getMaxZoom(),p=i===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,d)=>{const p=this._map._getUIString(`NavigationControl.${d}`);i.title=p,i.setAttribute("aria-label",p)},this.options=a.e({},pm,y),this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(i=>this._map.zoomIn({},{originalEvent:i}))),D.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(i=>this._map.zoomOut({},{originalEvent:i}))),D.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})})),this._compassIcon=D.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){D.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,i){const d=D.create("button",y,this._container);return d.type="button",d.addEventListener("click",i),d}},c.Popup=class extends a.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&D.remove(this._content),this._container&&(D.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=D.create("div","maplibregl-popup",this._map.getContainer()),this._tip=D.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ph(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!i)return;const d=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor;const _=_h(this.options.offset);if(!p){const A=this._container.offsetWidth,R=this._container.offsetHeight;let M;M=d.y+_.bottom.y<R?["top"]:d.y>this._map.transform.height-R?["bottom"]:[],d.x<A/2?M.push("left"):d.x>this._map.transform.width-A/2&&M.push("right"),p=M.length===0?"bottom":M.join("-")}let x=d.add(_[p]);this.options.subpixelPositioning||(x=x.round()),D.setTransform(this._container,`${Rc[p]} translate(${x.x}px,${x.y}px)`),gh(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Af),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.S.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const i=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=y;p=d.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=D.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=D.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Ef);y&&y.focus()}},c.RasterDEMTileSource=Bt,c.RasterTileSource=er,c.ScaleControl=class{constructor(y){this._onMove=()=>{mh(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,mh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Sf),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){D.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=ko,c.Style=pl,c.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=D.create("button","maplibregl-ctrl-terrain",this._container),D.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){D.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=uh,c.TwoFingersTouchRotateHandler=am,c.TwoFingersTouchZoomHandler=lh,c.TwoFingersTouchZoomRotateHandler=bf,c.VectorTileSource=dr,c.VideoSource=fr,c.addSourceType=(y,i)=>a._(void 0,void 0,void 0,(function*(){if(Nr(y))throw new Error(`A source type called "${y}" already exists.`);((d,p)=>{rr[d]=p})(y,i)})),c.clearPrewarmedResources=function(){const y=_r;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(jt),_r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=mc,c.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return or().getRTLTextPluginStatus()},c.getVersion=function(){return yh},c.getWorkerCount=function(){return Gt.workerCount},c.getWorkerUrl=function(){return a.a.WORKER_URL},c.importScriptInWorkers=function(y){return vt().broadcast("IS",y)},c.isTimeFrozen=function(){return k.isFrozen()},c.prewarm=function(){Dr().acquire(jt)},c.restoreNow=function(){k.restoreNow()},c.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},c.setNow=function(y){k.setNow(y)},c.setRTLTextPlugin=function(y,i){return or().setRTLTextPlugin(y,i)},c.setWorkerCount=function(y){Gt.workerCount=y},c.setWorkerUrl=function(y){a.a.WORKER_URL=y}}));var l=t;return l}))})(d_)),d_.exports}var ED=AD();const qn=w0(ED);function qT(r){const t=document.createElement("canvas");t.width=32,t.height=32;const n=t.getContext("2d"),s=1,l=31,c=s+2,a=l-2,g=s+1,v=l-1,w=new Path2D;return w.moveTo(c,s),w.lineTo(a,s),w.bezierCurveTo(v,g,v,g,l,c),w.lineTo(l,a),w.bezierCurveTo(v,v,v,v,a,l),w.lineTo(c,l),w.bezierCurveTo(g,v,g,v,s,a),w.lineTo(s,c),w.bezierCurveTo(g,g,g,g,c,s),w.closePath(),n.fillStyle=r.fill,n.fill(w),n.strokeStyle=r.stroke,n.stroke(w),[n.getImageData(0,0,32,32),{content:[c,c,a,a],stretchX:[[c,a]],stretchY:[[c,a]]}]}var PD=Fe("<div><!></div>");function ID(r,e){Tt(e,!0);let t=ae(e,"map",15),n=ae(e,"zoom",15),s=ae(e,"bounds",15),l=ae(e,"center",15),c=null,a=e.style,g=tn({map:void 0});hy("map",g);let v=ps(n()),w=ps(l());const P=()=>{t()&&ps(n())!==v&&(v=t().getZoom(),t().setZoom(n()))},I=()=>{t()&&l().toString()!=qn.LngLat.convert(w).toString()&&(w=t().getCenter(),t().setCenter(l()))},k=()=>{e.style!=a&&(!g.map&&c?N(c):g.map&&g.map.setStyle(e.style||null))},N=V=>{if(!e.style)return;let L;try{L=new qn.Map({container:V,zoom:n(),bounds:s(),center:l(),style:e.style,transformRequest:e.transformRequest,attributionControl:e.attribution===!1||e.attribution===void 0?e.attribution:{customAttribution:e.attribution}}),L.addImage("shield",...qT({fill:"hsl(0, 0%, 98%)",stroke:"hsl(0, 0%, 75%)"})),L.addImage("shield-dark",...qT({fill:"hsl(0, 0%, 16%)",stroke:"hsl(0, 0%, 30%)"}));const $=new qn.ScaleControl({maxWidth:100,unit:"metric"});L.addControl($,wE&&window.innerWidth<768?"top-left":"bottom-left"),L.on("load",()=>{t(L),g.map=L,P(),I(),s(L.getBounds()),a=e.style,L.on("moveend",()=>{n(L.getZoom()),v=n(),l(L.getCenter()),w=l(),s(L.getBounds())})})}catch($){console.log($)}return{destroy(){L?.remove(),g.map=void 0}}};kr(k),kr(P),kr(I);var D=PD(),B=Ae(D);{var U=V=>{var L=We(),$=ue(L);Ot($,()=>e.children),Z(V,L)};Ze(B,V=>{e.children&&V(U)})}we(D),Nk(D,V=>N?.(V)),as(D,V=>c=V,()=>c),mt(()=>fi(D,1,bo(e.class))),Z(r,D),St()}const T0="-",CD=r=>{const e=MD(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:c=>{const a=c.split(T0);return a[0]===""&&a.length!==1&&a.shift(),LE(a,e)||RD(c)},getConflictingClassGroupIds:(c,a)=>{const g=t[c]||[];return a&&n[c]?[...g,...n[c]]:g}}},LE=(r,e)=>{if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?LE(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const l=r.join(T0);return e.validators.find(({validator:c})=>c(l))?.classGroupId},GT=/^\[(.+)\]$/,RD=r=>{if(GT.test(r)){const e=GT.exec(r)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},MD=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return DD(Object.entries(r.classGroups),t).forEach(([l,c])=>{cx(c,n,l,e)}),n},cx=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const l=s===""?e:YT(e,s);l.classGroupId=t;return}if(typeof s=="function"){if(kD(s)){cx(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([l,c])=>{cx(c,YT(e,l),t,n)})})},YT=(r,e)=>{let t=r;return e.split(T0).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},kD=r=>r.isThemeGetter,DD=(r,e)=>e?r.map(([t,n])=>{const s=n.map(l=>typeof l=="string"?e+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([c,a])=>[e+c,a])):l);return[t,s]}):r,OD=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(l,c)=>{t.set(l,c),e++,e>r&&(e=0,n=t,t=new Map)};return{get(l){let c=t.get(l);if(c!==void 0)return c;if((c=n.get(l))!==void 0)return s(l,c),c},set(l,c){t.has(l)?t.set(l,c):s(l,c)}}},BE="!",FD=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,s=e[0],l=e.length,c=a=>{const g=[];let v=0,w=0,P;for(let B=0;B<a.length;B++){let U=a[B];if(v===0){if(U===s&&(n||a.slice(B,B+l)===e)){g.push(a.slice(w,B)),w=B+l;continue}if(U==="/"){P=B;continue}}U==="["?v++:U==="]"&&v--}const I=g.length===0?a:a.substring(w),k=I.startsWith(BE),N=k?I.substring(1):I,D=P&&P>w?P-w:void 0;return{modifiers:g,hasImportantModifier:k,baseClassName:N,maybePostfixModifierPosition:D}};return t?a=>t({className:a,parseClassName:c}):c},ND=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},LD=r=>({cache:OD(r.cacheSize),parseClassName:FD(r),...CD(r)}),BD=/\s+/,zD=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s}=e,l=[],c=r.trim().split(BD);let a="";for(let g=c.length-1;g>=0;g-=1){const v=c[g],{modifiers:w,hasImportantModifier:P,baseClassName:I,maybePostfixModifierPosition:k}=t(v);let N=!!k,D=n(N?I.substring(0,k):I);if(!D){if(!N){a=v+(a.length>0?" "+a:a);continue}if(D=n(I),!D){a=v+(a.length>0?" "+a:a);continue}N=!1}const B=ND(w).join(":"),U=P?B+BE:B,V=U+D;if(l.includes(V))continue;l.push(V);const L=s(D,N);for(let $=0;$<L.length;++$){const te=L[$];l.push(U+te)}a=v+(a.length>0?" "+a:a)}return a};function UD(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=zE(e))&&(n&&(n+=" "),n+=t);return n}const zE=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=zE(r[n]))&&(t&&(t+=" "),t+=e);return t};function VD(r,...e){let t,n,s,l=c;function c(g){const v=e.reduce((w,P)=>P(w),r());return t=LD(v),n=t.cache.get,s=t.cache.set,l=a,a(g)}function a(g){const v=n(g);if(v)return v;const w=zD(g,t);return s(g,w),w}return function(){return l(UD.apply(null,arguments))}}const oi=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},UE=/^\[(?:([a-z-]+):)?(.+)\]$/i,jD=/^\d+\/\d+$/,WD=new Set(["px","full","screen"]),$D=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HD=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ZD=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,XD=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qD=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Za=r=>nd(r)||WD.has(r)||jD.test(r),Ul=r=>Sd(r,"length",rO),nd=r=>!!r&&!Number.isNaN(Number(r)),Kv=r=>Sd(r,"number",nd),Zf=r=>!!r&&Number.isInteger(Number(r)),GD=r=>r.endsWith("%")&&nd(r.slice(0,-1)),gn=r=>UE.test(r),Vl=r=>$D.test(r),YD=new Set(["length","size","percentage"]),KD=r=>Sd(r,YD,VE),QD=r=>Sd(r,"position",VE),JD=new Set(["image","url"]),eO=r=>Sd(r,JD,iO),tO=r=>Sd(r,"",nO),Xf=()=>!0,Sd=(r,e,t)=>{const n=UE.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},rO=r=>HD.test(r)&&!ZD.test(r),VE=()=>!1,nO=r=>XD.test(r),iO=r=>qD.test(r),sO=()=>{const r=oi("colors"),e=oi("spacing"),t=oi("blur"),n=oi("brightness"),s=oi("borderColor"),l=oi("borderRadius"),c=oi("borderSpacing"),a=oi("borderWidth"),g=oi("contrast"),v=oi("grayscale"),w=oi("hueRotate"),P=oi("invert"),I=oi("gap"),k=oi("gradientColorStops"),N=oi("gradientColorStopPositions"),D=oi("inset"),B=oi("margin"),U=oi("opacity"),V=oi("padding"),L=oi("saturate"),$=oi("scale"),te=oi("sepia"),G=oi("skew"),le=oi("space"),se=oi("translate"),oe=()=>["auto","contain","none"],be=()=>["auto","hidden","clip","visible","scroll"],xe=()=>["auto",gn,e],_e=()=>[gn,e],Ne=()=>["",Za,Ul],fe=()=>["auto",nd,gn],Le=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],tt=()=>["solid","dashed","dotted","double","none"],Ye=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rt=()=>["start","end","center","between","around","evenly","stretch"],it=()=>["","0",gn],Ct=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[nd,gn];return{cacheSize:500,separator:":",theme:{colors:[Xf],spacing:[Za,Ul],blur:["none","",Vl,gn],brightness:Mt(),borderColor:[r],borderRadius:["none","","full",Vl,gn],borderSpacing:_e(),borderWidth:Ne(),contrast:Mt(),grayscale:it(),hueRotate:Mt(),invert:it(),gap:_e(),gradientColorStops:[r],gradientColorStopPositions:[GD,Ul],inset:xe(),margin:xe(),opacity:Mt(),padding:_e(),saturate:Mt(),scale:Mt(),sepia:it(),skew:Mt(),space:_e(),translate:_e()},classGroups:{aspect:[{aspect:["auto","square","video",gn]}],container:["container"],columns:[{columns:[Vl]}],"break-after":[{"break-after":Ct()}],"break-before":[{"break-before":Ct()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Le(),gn]}],overflow:[{overflow:be()}],"overflow-x":[{"overflow-x":be()}],"overflow-y":[{"overflow-y":be()}],overscroll:[{overscroll:oe()}],"overscroll-x":[{"overscroll-x":oe()}],"overscroll-y":[{"overscroll-y":oe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[D]}],"inset-x":[{"inset-x":[D]}],"inset-y":[{"inset-y":[D]}],start:[{start:[D]}],end:[{end:[D]}],top:[{top:[D]}],right:[{right:[D]}],bottom:[{bottom:[D]}],left:[{left:[D]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Zf,gn]}],basis:[{basis:xe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",gn]}],grow:[{grow:it()}],shrink:[{shrink:it()}],order:[{order:["first","last","none",Zf,gn]}],"grid-cols":[{"grid-cols":[Xf]}],"col-start-end":[{col:["auto",{span:["full",Zf,gn]},gn]}],"col-start":[{"col-start":fe()}],"col-end":[{"col-end":fe()}],"grid-rows":[{"grid-rows":[Xf]}],"row-start-end":[{row:["auto",{span:[Zf,gn]},gn]}],"row-start":[{"row-start":fe()}],"row-end":[{"row-end":fe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",gn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",gn]}],gap:[{gap:[I]}],"gap-x":[{"gap-x":[I]}],"gap-y":[{"gap-y":[I]}],"justify-content":[{justify:["normal",...rt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",gn,e]}],"min-w":[{"min-w":[gn,e,"min","max","fit"]}],"max-w":[{"max-w":[gn,e,"none","full","min","max","fit","prose",{screen:[Vl]},Vl]}],h:[{h:[gn,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[gn,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[gn,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[gn,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Vl,Ul]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Kv]}],"font-family":[{font:[Xf]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",gn]}],"line-clamp":[{"line-clamp":["none",nd,Kv]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Za,gn]}],"list-image":[{"list-image":["none",gn]}],"list-style-type":[{list:["none","disc","decimal",gn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[U]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[U]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...tt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Za,Ul]}],"underline-offset":[{"underline-offset":["auto",Za,gn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_e()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",gn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",gn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[U]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Le(),QD]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",KD]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},eO]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[N]}],"gradient-via-pos":[{via:[N]}],"gradient-to-pos":[{to:[N]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[U]}],"border-style":[{border:[...tt(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[U]}],"divide-style":[{divide:tt()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...tt()]}],"outline-offset":[{"outline-offset":[Za,gn]}],"outline-w":[{outline:[Za,Ul]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Ne()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[U]}],"ring-offset-w":[{"ring-offset":[Za,Ul]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Vl,tO]}],"shadow-color":[{shadow:[Xf]}],opacity:[{opacity:[U]}],"mix-blend":[{"mix-blend":[...Ye(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ye()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[g]}],"drop-shadow":[{"drop-shadow":["","none",Vl,gn]}],grayscale:[{grayscale:[v]}],"hue-rotate":[{"hue-rotate":[w]}],invert:[{invert:[P]}],saturate:[{saturate:[L]}],sepia:[{sepia:[te]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[g]}],"backdrop-grayscale":[{"backdrop-grayscale":[v]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[w]}],"backdrop-invert":[{"backdrop-invert":[P]}],"backdrop-opacity":[{"backdrop-opacity":[U]}],"backdrop-saturate":[{"backdrop-saturate":[L]}],"backdrop-sepia":[{"backdrop-sepia":[te]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",gn]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",gn]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",gn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[$]}],"scale-x":[{"scale-x":[$]}],"scale-y":[{"scale-y":[$]}],rotate:[{rotate:[Zf,gn]}],"translate-x":[{"translate-x":[se]}],"translate-y":[{"translate-y":[se]}],"skew-x":[{"skew-x":[G]}],"skew-y":[{"skew-y":[G]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",gn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",gn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_e()}],"scroll-mx":[{"scroll-mx":_e()}],"scroll-my":[{"scroll-my":_e()}],"scroll-ms":[{"scroll-ms":_e()}],"scroll-me":[{"scroll-me":_e()}],"scroll-mt":[{"scroll-mt":_e()}],"scroll-mr":[{"scroll-mr":_e()}],"scroll-mb":[{"scroll-mb":_e()}],"scroll-ml":[{"scroll-ml":_e()}],"scroll-p":[{"scroll-p":_e()}],"scroll-px":[{"scroll-px":_e()}],"scroll-py":[{"scroll-py":_e()}],"scroll-ps":[{"scroll-ps":_e()}],"scroll-pe":[{"scroll-pe":_e()}],"scroll-pt":[{"scroll-pt":_e()}],"scroll-pr":[{"scroll-pr":_e()}],"scroll-pb":[{"scroll-pb":_e()}],"scroll-pl":[{"scroll-pl":_e()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",gn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Za,Ul,Kv]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},oO=VD(sO);var Qv={exports:{}},KT;function aO(){return KT||(KT=1,(function(r){var e={};function t(l){return Math.floor(Math.abs(l)+.5)*(l>=0?1:-1)}function n(l,c,a){l=t(l*a),c=t(c*a);var g=(l-c)*2;g<0&&(g=-g-1);for(var v="";g>=32;)v+=String.fromCharCode((32|g&31)+63),g/=32;return v+=String.fromCharCode((g|0)+63),v}e.decode=function(l,c){for(var a=0,g=0,v=0,w=[],P=0,I=0,k=null,N,D,B=Math.pow(10,Number.isInteger(c)?c:5);a<l.length;){k=null,P=1,I=0;do k=l.charCodeAt(a++)-63,I+=(k&31)*P,P*=32;while(k>=32);N=I&1?(-I-1)/2:I/2,P=1,I=0;do k=l.charCodeAt(a++)-63,I+=(k&31)*P,P*=32;while(k>=32);D=I&1?(-I-1)/2:I/2,g+=N,v+=D,w.push([g/B,v/B])}return w},e.encode=function(l,c){if(!l.length)return"";for(var a=Math.pow(10,Number.isInteger(c)?c:5),g=n(l[0][0],0,a)+n(l[0][1],0,a),v=1;v<l.length;v++){var w=l[v],P=l[v-1];g+=n(w[0],P[0],a),g+=n(w[1],P[1],a)}return g};function s(l){for(var c=[],a=0;a<l.length;a++){var g=l[a].slice();c.push([g[1],g[0]])}return c}e.fromGeoJSON=function(l,c){if(l&&l.type==="Feature"&&(l=l.geometry),!l||l.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return e.encode(s(l.coordinates),c)},e.toGeoJSON=function(l,c){var a=e.decode(l,c);return{type:"LineString",coordinates:s(a)}},r.exports&&(r.exports=e)})(Qv)),Qv.exports}var lO=aO();const Qc=w0(lO),jE=r=>{const e=[];for(let t=0;t<r.legs.length;t++)if(r.legs[t].interlineWithPreviousLeg){const n=e[e.length-1],s=r.legs[t];n.intermediateStops.push({...n.to,switchTo:s}),n.to=s.to,n.duration+=s.duration,n.endTime=s.endTime,n.scheduledEndTime=s.scheduledEndTime,n.realTime||=s.realTime,n.intermediateStops.push(...s.intermediateStops),n.legGeometry={points:Qc.encode([...Qc.decode(n.legGeometry.points),...Qc.decode(s.legGeometry.points)]),precision:n.legGeometry.precision,length:n.legGeometry.length+s.legGeometry.length}}else e.push(r.legs[t]);r.legs=e},QT=(r,e)=>{const t=n=>{n.legs[0].from.name==="START"&&(n.legs[0].from.name=r.label),n.legs[n.legs.length-1].to.name==="END"&&(n.legs[n.legs.length-1].to.name=e.label),jE(n)};return n=>{if(n.error?.error)throw new Error(n.error.error);if(n.error)throw new Error(String(n.error));return n.data.itineraries.forEach(t),n.data.direct.forEach(t),n.data}},cO={ticket:"ÐÐ¸Ð»ÐµÑ",ticketOptions:"ÐÐ¿ÑÐ¸Ð¸ Ð·Ð° Ð±Ð¸Ð»ÐµÑ",includedInTicket:"ÐÐºÐ»ÑÑÐµÐ½Ð¾ Ð² Ð±Ð¸Ð»ÐµÑÐ°",journeyDetails:"ÐÐµÑÐ°Ð¹Ð»Ð¸ Ð·Ð° Ð¿ÑÑÑÐ²Ð°Ð½ÐµÑÐ¾",transfers:"Ð¿ÑÐµÐºÐ°ÑÐ²Ð°Ð½Ð¸Ñ",walk:"ÐÐµÑÐ°",bike:"ÐÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",cargoBike:"Ð¢Ð¾Ð²Ð°ÑÐµÐ½ Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",scooterStanding:"ÑÑÐ¾ÑÐ¸Ð½ÐµÑÐºÐ°",scooterSeated:"ÑÑÐ¾ÑÐ¸Ð½ÐµÑÐºÐ°",car:"ÐÐ²ÑÐ¾Ð¼Ð¾Ð±Ð¸Ð»",taxi:"Ð¢Ð°ÐºÑÐ¸",moped:"Ð¡ÐºÑÑÐµÑ",unknownVehicleType:"ÐÐµÐ¸Ð·Ð²ÐµÑÑÐµÐ½ ÑÐ¸Ð¿ Ð¿ÑÐµÐ²Ð¾Ð·Ð½Ð¾ ÑÑÐµÐ´ÑÑÐ²Ð¾",electricAssist:"ÐÐ»ÐµÐºÑÑÐ¸ÑÐµÑÐºÐ° Ð¿Ð¾Ð¼Ð¾Ñ",electric:"ÐÐ»ÐµÐºÑÑÐ¸ÑÐµÑÐºÐ¸",combustion:"ÐÐ²Ð¸Ð³Ð°ÑÐµÐ» Ñ Ð²ÑÑÑÐµÑÐ½Ð¾ Ð³Ð¾ÑÐµÐ½Ðµ",combustionDiesel:"ÐÐ¸Ð·ÐµÐ»",hybrid:"Ð¥Ð¸Ð±ÑÐ¸Ð´",plugInHybrid:"ÐÐ°ÑÐµÐ¶Ð´Ð°ÐµÐ¼ ÑÐ¸Ð±ÑÐ¸Ð´",hydrogenFuelCell:"ÐÐ¾Ð´Ð¾ÑÐ¾Ð´Ð½Ð° Ð³Ð¾ÑÐ¸Ð²Ð½Ð° ÐºÐ»ÐµÑÐºÐ°",from:"ÐÑ",to:"ÐÐ¾",viaStop:"ÐÐµÐ¶Ð´Ð¸Ð½Ð½Ð° ÑÐ¿Ð¸ÑÐºÐ°",viaStops:"ÐÐµÐ¶Ð´Ð¸Ð½Ð½Ð¸ ÑÐ¿Ð¸ÑÐºÐ¸",addViaStop:"ÐÐ¾Ð±Ð°Ð²Ð¸ Ð¼ÐµÐ¶Ð´Ð¸Ð½Ð½Ð° ÑÐ¿Ð¸ÑÐºÐ°",removeViaStop:"ÐÑÐµÐ¼Ð°ÑÐ½Ð¸ Ð¼ÐµÐ¶Ð´Ð¸Ð½Ð½Ð°ÑÐ° ÑÐ¿Ð¸ÑÐºÐ°",viaStayDuration:"ÐÐ¸Ð½Ð¸Ð¼Ð°Ð»ÐµÐ½ Ð¿ÑÐµÑÑÐ¾Ð¹",position:"Ð¼ÐµÑÑÐ¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",arrival:"ÐÑÐ¸ÑÑÐ¸Ð³Ð°Ð½Ðµ",departure:"ÐÐ°Ð¼Ð¸Ð½Ð°Ð²Ð°Ð½Ðµ",duration:"ÐÑÐ¾Ð´ÑÐ»Ð¶Ð¸ÑÐµÐ»Ð½Ð¾ÑÑ",arrivals:"ÐÑÐ¸ÑÑÐ¸Ð³Ð°Ð½Ð¸Ñ",later:"Ð¿Ð¾-ÐºÑÑÐ½Ð¾",earlier:"Ð¿Ð¾-ÑÐ°Ð½Ð¾",connections:"ÐÑÑÐ·ÐºÐ¸",departures:"ÐÐ°Ð¼Ð¸Ð½Ð°Ð²Ð°Ð½Ð¸Ñ",switchToArrivals:"ÐÑÐµÐ²ÐºÐ»ÑÑÐ¸ ÐºÑÐ¼ Ð¿ÑÐ¸ÑÑÐ¸Ð³Ð°Ð½Ð¸Ñ",switchToDepartures:"ÐÑÐµÐ²ÐºÐ»ÑÑÐ¸ ÐºÑÐ¼ Ð·Ð°Ð¼Ð¸Ð½Ð°Ð²Ð°Ð½Ð¸Ñ",track:"ÐÐ¾Ð»Ð¾Ð²Ð¾Ð·",platform:"ÐÐµÑÐ¾Ð½",trackAbr:"ÐÐ¾Ð».",platformAbr:"ÐÐµÑÐ¾Ð½",arrivalOnTrack:"ÐÑÐ¸ÑÑÐ¸Ð³Ð°Ð½Ðµ Ð½Ð° ÐºÐ¾Ð»Ð¾Ð²Ð¾Ð·",tripIntermediateStops:r=>{switch(r){case 0:return"ÐÐµÐ· Ð¼ÐµÐ¶Ð´Ð¸Ð½Ð½Ð¸ ÑÐ¿Ð¸ÑÐºÐ¸";case 1:return"1 Ð¼ÐµÐ¶Ð´Ð¸Ð½Ð½Ð° ÑÐ¿Ð¸ÑÐºÐ°";default:return`${r} Ð¼ÐµÐ¶Ð´Ð¸Ð½Ð½Ð¸ ÑÐ¿Ð¸ÑÐºÐ¸`}},sharingProvider:"ÐÐ¿ÐµÑÐ°ÑÐ¾Ñ",sharingProviders:"ÐÐ¿ÐµÑÐ°ÑÐ¾ÑÐ¸",returnOnlyAtStations:"ÐÑÐµÐ²Ð¾Ð·Ð½Ð¾ÑÐ¾ ÑÑÐµÐ´ÑÑÐ²Ð¾ ÑÑÑÐ±Ð²Ð° Ð´Ð° ÑÐµ Ð²ÑÑÐ½Ðµ Ð½Ð° ÑÑÐ°Ð½ÑÐ¸Ñ.",roundtripStationReturnConstraint:"ÐÑÐµÐ²Ð¾Ð·Ð½Ð¾ÑÐ¾ ÑÑÐµÐ´ÑÑÐ²Ð¾ ÑÑÑÐ±Ð²Ð° Ð´Ð° ÑÐµ Ð²ÑÑÐ½Ðµ Ð½Ð° Ð½Ð°ÑÐ°Ð»Ð½Ð°ÑÐ° ÑÑÐ°Ð½ÑÐ¸Ñ.",rentalStation:"Ð¡ÑÐ°Ð½ÑÐ¸Ñ",rentalGeofencingZone:"ÐÐ¾Ð½Ð°",noItinerariesFound:"ÐÐµ ÑÐ° Ð½Ð°Ð¼ÐµÑÐµÐ½Ð¸ Ð¼Ð°ÑÑÑÑÑÐ¸.",advancedSearchOptions:"Ð Ð°Ð·ÑÐ¸ÑÐµÐ½Ð¸ Ð½Ð°ÑÑÑÐ¾Ð¹ÐºÐ¸",selectTransitModes:"ÐÐ·Ð±ÐµÑÐµÑÐµ Ð²Ð¸Ð´Ð¾Ð²Ðµ ÑÑÐ°Ð½ÑÐ¿Ð¾ÑÑ",defaultSelectedModes:"ÐÑÐ¸ÑÐºÐ¸ Ð²Ð¸Ð´Ð¾Ð²Ðµ ÑÑÐ°Ð½ÑÐ¿Ð¾ÑÑ",defaultSelectedProviders:"ÐÑÐ¸ÑÐºÐ¸ Ð¿ÑÐµÐ²Ð¾Ð·Ð²Ð°ÑÐ¸",selectElevationCosts:"ÐÐ·Ð±ÑÐ³Ð²Ð°Ð¹ ÑÑÑÑÐ¼Ð½Ð¸ Ð½Ð°ÐºÐ»Ð¾Ð½Ð¸.",wheelchair:"Ð¸Ð½Ð²Ð°Ð»Ð¸Ð´Ð½Ð° ÐºÐ¾Ð»Ð¸ÑÐºÐ°",useRoutedTransfers:"ÐÐ·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ Ð¿Ð¾ÑÐ¾ÑÐµÐ½Ð¸ÑÐµ Ð¿ÑÐµÐºÐ°ÑÐ²Ð°Ð½Ð¸Ñ",bikeRental:"Ð½Ð°ÐµÐ¼Ð°Ð½Ðµ Ð½Ð° Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",requireBikeTransport:"ÐÑÐµÐ²Ð¾Ð· Ð½Ð° Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",requireCarTransport:"ÐÑÐµÐ²Ð¾Ð· Ð½Ð° Ð°Ð²ÑÐ¾Ð¼Ð¾Ð±Ð¸Ð»",considerRentalReturnConstraints:"ÐÑÑÐ½Ð¸ Ð½Ð°ÐµÑÐ¸ÑÐµ Ð¿ÑÐµÐ²Ð¾Ð·Ð½Ð¸ ÑÑÐµÐ´ÑÑÐ²Ð° Ð² ÑÐ°Ð¼ÐºÐ¸ÑÐµ Ð½Ð° Ð¿ÑÑÑÐ²Ð°Ð½ÐµÑÐ¾",default:"ÐÐ¾ Ð¿Ð¾Ð´ÑÐ°Ð·Ð±Ð¸ÑÐ°Ð½Ðµ",timetableSources:"ÐÐ·ÑÐ¾ÑÐ½Ð¸ÑÐ¸ Ð½Ð° ÑÐ°Ð·Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ",tripCancelled:"ÐÑÑÑÐ²Ð°Ð½ÐµÑÐ¾ Ðµ Ð¾ÑÐ¼ÐµÐ½ÐµÐ½Ð¾",stopCancelled:"Ð¡Ð¿Ð¸ÑÐºÐ°ÑÐ° Ðµ Ð¾ÑÐ¼ÐµÐ½ÐµÐ½Ð°",inOutDisallowed:"ÐÐ°ÑÐ²Ð°Ð½Ðµ/ÑÐ»Ð¸Ð·Ð°Ð½Ðµ Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",inDisallowed:"ÐÐ°ÑÐ²Ð°Ð½ÐµÑÐ¾ Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",outDisallowed:"Ð¡Ð»Ð¸Ð·Ð°Ð½ÐµÑÐ¾ Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",unscheduledTrip:"Ð¸Ð·Ð²ÑÐ½ÑÐµÐ´ÐµÐ½ ÐºÑÑÑ",alertsAvailable:"Ð½Ð°Ð»Ð¸ÑÐ½Ð¸ Ð¸Ð·Ð²ÐµÑÑÐ¸Ñ",dataExpiredSince:"ÐÐ°Ð½Ð½Ð¸ÑÐµ ÑÐ° Ð¾ÑÑÐ°ÑÐµÐ»Ð¸, Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¾ Ð²Ð°Ð»Ð¸Ð´Ð½Ð¸ Ð½Ð°",FLEX:"ÐÐ¾ Ð·Ð°ÑÐ²ÐºÐ°",WALK:"ÐÐµÑÐ°",BIKE:"ÐÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",RENTAL:"ÐÐ°ÐµÑ",CAR:"ÐÐ²ÑÐ¾Ð¼Ð¾Ð±Ð¸Ð»",CAR_DROPOFF:"Ð¡Ð»Ð¸Ð·Ð°Ð½Ðµ Ð¾Ñ Ð°Ð²ÑÐ¾Ð¼Ð¾Ð±Ð¸Ð»Ð°",CAR_PARKING:"ÐÐ°ÑÐºÐ¸Ð½Ð³ (P+R)",TRANSIT:"ÐÑÐ°Ð´ÑÐºÐ¸ ÑÑÐ°Ð½ÑÐ¿Ð¾ÑÑ",TRAM:"Ð¢ÑÐ°Ð¼Ð²Ð°Ð¹",SUBWAY:"ÐÐµÑÑÐ¾",FERRY:"Ð¤ÐµÑÐ¸Ð±Ð¾Ñ",AIRPLANE:"Ð¡Ð°Ð¼Ð¾Ð»ÐµÑ",SUBURBAN:"ÐÑÐ°Ð´ÑÐºÐ° Ð¶ÐµÐ»ÐµÐ·Ð½Ð¸ÑÐ°",BUS:"ÐÐ²ÑÐ¾Ð±ÑÑ",COACH:"ÐÐµÐ¶Ð´ÑÐ³ÑÐ°Ð´ÑÐºÐ¸ Ð°Ð²ÑÐ¾Ð±ÑÑ",RAIL:"ÐÐ»Ð°Ðº",HIGHSPEED_RAIL:"ÐÐ¸ÑÐ¾ÐºÐ¾ÑÐºÐ¾ÑÐ¾ÑÑÐµÐ½ Ð²Ð»Ð°Ðº",LONG_DISTANCE:"ÐÐµÐ¶Ð´ÑÐ³ÑÐ°Ð´ÑÐºÐ¸ Ð²Ð»Ð°Ðº",NIGHT_RAIL:"ÐÐ¾ÑÐµÐ½ Ð²Ð»Ð°Ðº",REGIONAL_FAST_RAIL:"ÐÑÑÐ· ÑÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÐµÐ½ Ð²Ð»Ð°Ðº",REGIONAL_RAIL:"Ð ÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÐµÐ½ Ð²Ð»Ð°Ðº",OTHER:"ÐÑÑÐ³Ð¸",routingSegments:{maxTransfers:"ÐÐ°ÐºÑ. Ð¿ÑÐµÐºÐ°ÑÐ²Ð°Ð½Ð¸Ñ",maxTravelTime:"ÐÐ°ÐºÑ. Ð²ÑÐµÐ¼Ðµ Ð·Ð° Ð¿ÑÑÑÐ²Ð°Ð½Ðµ",firstMile:"ÐÑÑÐ²Ð¸ ÐºÐ¸Ð»Ð¾Ð¼ÐµÑÑÑ",lastMile:"ÐÐ¾ÑÐ»ÐµÐ´ÐµÐ½ ÐºÐ¸Ð»Ð¾Ð¼ÐµÑÑÑ",direct:"ÐÐ¸ÑÐµÐºÑÐ½Ð° Ð²ÑÑÐ·ÐºÐ°",maxPreTransitTime:"ÐÐ°ÐºÑÐ¸Ð¼Ð°Ð»Ð½Ð¾ Ð²ÑÐµÐ¼Ðµ Ð¿ÑÐµÐ´Ð¸ ÑÑÐ°Ð½Ð·Ð¸Ñ",maxPostTransitTime:"ÐÐ°ÐºÑÐ¸Ð¼Ð°Ð»Ð½Ð¾ Ð²ÑÐµÐ¼Ðµ ÑÐ»ÐµÐ´ ÑÑÐ°Ð½Ð·Ð¸Ñ",maxDirectTime:"ÐÐ°ÐºÑÐ¸Ð¼Ð°Ð»Ð½Ð¾ Ð²ÑÐµÐ¼Ðµ Ð±ÐµÐ· ÑÑÐ°Ð½Ð·Ð¸Ñ"},elevationCosts:{NONE:"ÐÐµÐ· Ð½Ð°ÐºÐ»Ð¾Ð½",LOW:"ÐÐµÐº Ð½Ð°ÐºÐ»Ð¾Ð½",HIGH:"ÐÐ¾Ð»ÑÐ¼ Ð½Ð°ÐºÐ»Ð¾Ð½"},isochrones:{title:"ÐÐ¾ÑÑÑÐ¿ÐµÐ½ Ð¿ÐµÑÐ¸Ð¼ÐµÑÑÑ",displayLevel:"ÐÐ¸Ð²Ð¾ Ð½Ð° Ð¿Ð¾ÐºÐ°Ð·Ð²Ð°Ð½Ðµ",maxComputeLevel:"ÐÐ°ÐºÑ. Ð½Ð¸Ð²Ð¾ Ð½Ð° Ð¸Ð·ÑÐ¸ÑÐ»ÐµÐ½Ð¸Ðµ",canvasRects:"ÐÑÐ°Ð²Ð¾ÑÐ³ÑÐ»Ð½Ð¸ÑÐ¸ (ÑÐ»Ð¾Ð¹)",canvasCircles:"ÐÑÑÐ³Ð¾Ð²Ðµ (ÑÐ»Ð¾Ð¹)",geojsonCircles:"ÐÑÑÐ³Ð¾Ð²Ðµ (Ð³ÐµÐ¾Ð¼ÐµÑÑÐ¸Ñ)",styling:"Ð¡ÑÐ¸Ð»",noData:"ÐÑÐ¼Ð° Ð´Ð°Ð½Ð½Ð¸",requestFailed:"ÐÐ°ÑÐ²ÐºÐ°ÑÐ° Ðµ Ð½ÐµÑÑÐ¿ÐµÑÐ½Ð°"},alerts:{validFrom:"ÐÐ°Ð»Ð¸Ð´Ð½Ð¾ Ð¾Ñ",until:"Ð´Ð¾",information:"ÐÐ½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ",more:"Ð¾ÑÐµ"},RENTAL_BICYCLE:"Ð¡Ð¿Ð¾Ð´ÐµÐ»ÐµÐ½ Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",RENTAL_CARGO_BICYCLE:"Ð¡Ð¿Ð¾Ð´ÐµÐ»ÐµÐ½ ÑÐ¾Ð²Ð°ÑÐµÐ½ Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´",RENTAL_CAR:"ÐÐ°ÐµÑ Ð°Ð²ÑÐ¾Ð¼Ð¾Ð±Ð¸Ð»",RENTAL_MOPED:"Ð¡Ð¿Ð¾Ð´ÐµÐ»ÐµÐ½ ÑÐºÑÑÐµÑ",RENTAL_SCOOTER_STANDING:"Ð¡Ð¿Ð¾Ð´ÐµÐ»ÐµÐ½Ð° ÑÑÐ¾ÑÐ¸Ð½ÐµÑÐºÐ°",RENTAL_SCOOTER_SEATED:"Ð¡Ð¿Ð¾Ð´ÐµÐ»ÐµÐ½Ð° ÑÐµÐ´ÑÑÐ° ÑÑÐ¾ÑÐ¸Ð½ÐµÑÐºÐ°",RENTAL_OTHER:"ÐÑÑÐ³Ð¾ ÑÐ¿Ð¾Ð´ÐµÐ»ÐµÐ½Ð¾ Ð¿ÑÐµÐ²Ð¾Ð·Ð½Ð¾ ÑÑÐµÐ´ÑÑÐ²Ð¾",incline:"ÐÐ°ÐºÐ»Ð¾Ð½",CABLE_CAR:"ÐÑÐ¶ÐµÐ½ Ð»Ð¸ÑÑ",FUNICULAR:"Ð¤ÑÐ½Ð¸ÐºÑÐ»ÐµÑ",AERIAL_LIFT:"ÐÑÐ·Ð´ÑÑÐµÐ½ Ð»Ð¸ÑÑ",toll:"ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÐ»Ð°ÑÐµÐ½ Ð¿ÑÑ.",accessRestriction:"Ð·Ð°Ð±ÑÐ°Ð½ÐµÐ½ Ð´Ð¾ÑÑÑÐ¿",continuesAs:"ÐÑÐ¾Ð´ÑÐ»Ð¶Ð°Ð²Ð° ÐºÐ°ÑÐ¾",rent:"ÐÐ°ÐµÐ¼",copyToClipboard:"ÐÐ¾Ð¿Ð¸ÑÐ°Ð¹ Ð² ÐºÐ»Ð¸Ð¿Ð±Ð¾ÑÐ´Ð°",rideThroughAllowed:"ÐÐ¸Ð½Ð°Ð²Ð°Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",rideThroughNotAllowed:"ÐÐ¸Ð½Ð°Ð²Ð°Ð½Ðµ Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",rideEndAllowed:"ÐÐ°ÑÐºÐ¸ÑÐ°Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾",rideEndNotAllowed:"ÐÐ°ÑÐºÐ¸ÑÐ°Ð½Ðµ Ð½Ðµ Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾"},WE={ticket:"Ticket",ticketOptions:"Ticket Options",includedInTicket:"Included in ticket",journeyDetails:"Journey Details",transfers:"transfers",walk:"Walk",bike:"Bike",cargoBike:"Cargo bike",scooterStanding:"Standing kick scooter",scooterSeated:"Seated kick scooter",car:"Car",taxi:"Taxi",moped:"Moped",unknownVehicleType:"Unknown vehicle type",electricAssist:"Electric motor assist",electric:"Electric",combustion:"Combustion",combustionDiesel:"Diesel",hybrid:"Hybrid",plugInHybrid:"Plug-in hybrid",hydrogenFuelCell:"Hydrogen fuel cell",from:"From",to:"To",viaStop:"Via stop",viaStops:"Via stops",addViaStop:"Add via stop",removeViaStop:"Remove via stop",viaStayDuration:"Minimum stay",position:"Position",arrival:"Arrival",departure:"Departure",connections:"Connections",duration:"Duration",arrivals:"Arrivals",later:"later",earlier:"earlier",departures:"Departures",switchToArrivals:"Switch to arrivals",switchToDepartures:"Switch to departures",track:"Platform",platform:"Platform",trackAbr:"Pl.",platformAbr:"Pl.",arrivalOnTrack:"Arrival on track",tripIntermediateStops:r=>{switch(r){case 0:return"No intermediate stops";case 1:return"1 intermediate stop";default:return`${r} intermediate stops`}},sharingProvider:"Provider",sharingProviders:"Providers",returnOnlyAtStations:"The vehicle must be returned at a station.",roundtripStationReturnConstraint:"The vehicle must be returned to the departure station.",rentalStation:"Station",rentalGeofencingZone:"Zone",noItinerariesFound:"No itineraries found.",advancedSearchOptions:"Options",selectTransitModes:"Select transit modes",defaultSelectedModes:"All transit modes",defaultSelectedProviders:"All providers",selectElevationCosts:"Avoid steep incline.",useRoutedTransfers:"Use routed transfers",wheelchair:"Accessible transfers",bikeRental:"Allow usage of sharing vehicles",requireBikeTransport:"Bike carriage",requireCarTransport:"Car carriage",considerRentalReturnConstraints:"Return rental vehicles within journey",default:"Default",timetableSources:"Timetable sources",tripCancelled:"Trip cancelled",stopCancelled:"Stop cancelled",inOutDisallowed:"Entry/exit not possible",inDisallowed:"Entry not possible",outDisallowed:"Exit not possible",unscheduledTrip:"Additional service",alertsAvailable:"Service alerts present",dataExpiredSince:"Warning: Expired data, last valid",FLEX:"On-Demand",WALK:"Walking",BIKE:"Bike",RENTAL:"Sharing",CAR:"Car",CAR_PARKING:"Car Parking",CAR_DROPOFF:"Drop-off (car)",TRANSIT:"Transit",TRAM:"Tram",SUBWAY:"Subway",FERRY:"Ferry",AIRPLANE:"Airplane",SUBURBAN:"Suburban Rail",BUS:"Bus",COACH:"Long Distance Bus / Coach",RAIL:"Train",HIGHSPEED_RAIL:"High Speed Rail",LONG_DISTANCE:"Intercity Rail",NIGHT_RAIL:"Night Rail",REGIONAL_FAST_RAIL:"Fast Rail",REGIONAL_RAIL:"Regional Rail",OTHER:"Other",RENTAL_BICYCLE:"Shared bike",RENTAL_CARGO_BICYCLE:"Shared cargo bike",RENTAL_CAR:"Shared car",RENTAL_MOPED:"Shared moped",RENTAL_SCOOTER_STANDING:"Shared standing scooter",RENTAL_SCOOTER_SEATED:"Shared seated scooter",RENTAL_OTHER:"Other shared vehicle",CABLE_CAR:"Cable car",FUNICULAR:"Funicular",AERIAL_LIFT:"Aerial lift",routingSegments:{maxTransfers:"Max. transfers",maxTravelTime:"Max. travel time",firstMile:"First mile",lastMile:"Last mile",direct:"Direct connection",maxPreTransitTime:"Max. pre-transit time",maxPostTransitTime:"Max. post-transit time",maxDirectTime:"Max. direct time"},elevationCosts:{NONE:"No detours",LOW:"Small detours",HIGH:"Large detours"},isochrones:{title:"Isochrones",displayLevel:"Display level",maxComputeLevel:"Max. computation level",canvasRects:"Rects (Overlay)",canvasCircles:"Circles (Overlay)",geojsonCircles:"Circles (Geometry)",styling:"Isochrones styling",noData:"No data",requestFailed:"Request failed"},alerts:{validFrom:"Valid from",until:"until",information:"Information",more:"more"},incline:"Incline",toll:"Warning! A fee must be paid to use this route.",accessRestriction:"No access",continuesAs:"Continues as",rent:"Rent",copyToClipboard:"Copy to clipboard",rideThroughAllowed:"Riding through allowed",rideThroughNotAllowed:"Riding through not allowed",rideEndAllowed:"Parking allowed",rideEndNotAllowed:"Parking only at stations"},uO={ticket:"Fahrschein",ticketOptions:"Fahrscheinoptionen",includedInTicket:"Im Fahrschein enthalten",journeyDetails:"Verbindungsdetails",transfers:"Umstiege",walk:"FuÃweg",bike:"Fahrrad",cargoBike:"Lastenfahrrad",scooterStanding:"Stehroller",scooterSeated:"Sitzroller",car:"Auto",taxi:"Taxi",moped:"Moped",unknownVehicleType:"Unbekannter Fahrzeugtyp",electricAssist:"ElektromotorunterstÃ¼tzung",electric:"Elektrisch",combustion:"Benzin",combustionDiesel:"Diesel",hybrid:"Hybrid",plugInHybrid:"Plug-in Hybrid",hydrogenFuelCell:"Wasserstoff-Brennstoffzelle",from:"Von",to:"Nach",viaStop:"Zwischenhalt",viaStops:"Zwischenhalte",addViaStop:"Zwischenhalt hinzufÃ¼gen",removeViaStop:"Zwischenhalt entfernen",viaStayDuration:"Mindestaufenthalt",position:"Position",arrival:"Ankunft",departure:"Abfahrt",duration:"Dauer",arrivals:"AnkÃ¼nfte",connections:"Verbindungen",departures:"Abfahrten",later:"spÃ¤ter",earlier:"frÃ¼her",track:"Gleis",platform:"Steig",trackAbr:"Gl.",platformAbr:"Stg.",arrivalOnTrack:"Ankunft auf Gleis",switchToArrivals:"Wechsel zu AnkÃ¼nften",switchToDepartures:"Wechsel zu Abfahrten",tripIntermediateStops:r=>{switch(r){case 0:return"Fahrt ohne Zwischenhalt";case 1:return"Fahrt eine Station";default:return`Fahrt ${r} Stationen`}},sharingProvider:"Anbieter",sharingProviders:"Anbieter",returnOnlyAtStations:"Das Fahrzeug muss an einer Station zurÃ¼ckgegeben werden.",roundtripStationReturnConstraint:"Das Fahrzeug muss wieder an der Abfahrtsstation abgestellt werden.",rentalStation:"Station",rentalGeofencingZone:"Zone",noItinerariesFound:"Keine Verbindungen gefunden.",advancedSearchOptions:"Optionen",selectTransitModes:"Ãffentliche Verkehrsmittel auswÃ¤hlen",defaultSelectedModes:"Alle Verkehrsmittel",defaultSelectedProviders:"Alle Anbieter",selectElevationCosts:"Steile Steigungen vermeiden.",useRoutedTransfers:"Geroutete Umstiege verwenden",wheelchair:"Barrierefreie Umstiege",bikeRental:"Sharing-Fahrzeuge berÃ¼cksichtigen",requireBikeTransport:"Fahrradmitnahme",requireCarTransport:"Automitnahme",considerRentalReturnConstraints:"Leihfahrzeuge innerhalb der Reise zurÃ¼ckgeben",default:"Vorgabe",timetableSources:"Fahrplandatenquellen",tripCancelled:"Fahrt entfÃ¤llt",stopCancelled:"Halt entfÃ¤llt",inOutDisallowed:"Ein-/Ausstieg nicht mÃ¶glich",inDisallowed:"Einstieg nicht mÃ¶glich",outDisallowed:"Ausstieg nicht mÃ¶glich",unscheduledTrip:"ZusÃ¤tzliche Fahrt",alertsAvailable:"Meldungen liegen vor",dataExpiredSince:"Achtung: Veraltete Daten, zuletzt gÃ¼ltig am",FLEX:"Bedarfsverkehr",WALK:"Zu FuÃ",BIKE:"Fahrrad",RENTAL:"Sharing",CAR:"Auto",CAR_DROPOFF:"Absetzen (Auto)",CAR_PARKING:"P+R Park & Ride",TRANSIT:"ÃPV",TRAM:"Tram",SUBWAY:"U-Bahn",FERRY:"FÃ¤hre",AIRPLANE:"Flugzeug",SUBURBAN:"S-Bahn",BUS:"Bus",COACH:"Reisebus",RAIL:"Zug",HIGHSPEED_RAIL:"Hochgeschwindigkeitszug",LONG_DISTANCE:"Intercityzug",NIGHT_RAIL:"Nachtzug",REGIONAL_FAST_RAIL:"Schnellzug",REGIONAL_RAIL:"Regionalzug",OTHER:"Andere",routingSegments:{maxTransfers:"Max. Umstiege",maxTravelTime:"Max. Reisezeit",firstMile:"Erste Meile",lastMile:"Letzte Meile",direct:"Direktverbindung",maxPreTransitTime:"Max. Vorlaufzeit",maxPostTransitTime:"Max. Nachlaufzeit",maxDirectTime:"Max. Direktzeit"},elevationCosts:{NONE:"Keine Umwege",LOW:"Kleine Umwege",HIGH:"GroÃe Umwege"},isochrones:{title:"Isochronen",displayLevel:"Darstellungsebene",maxComputeLevel:"Max. Berechnungsebene",canvasRects:"Rechtecke (Overlay)",canvasCircles:"Kreise (Overlay)",geojsonCircles:"Kreise (Geometrie)",styling:"Darstellung der Isochronen",noData:"Keine Daten",requestFailed:"Anfrage fehlgeschlagen"},alerts:{validFrom:"GÃ¼ltig von",until:"bis",information:"Informationen",more:"mehr"},RENTAL_BICYCLE:"Bikesharing",RENTAL_CARGO_BICYCLE:"Lastenrad Sharing",RENTAL_CAR:"Car Sharing",RENTAL_MOPED:"Moped Sharing",RENTAL_SCOOTER_STANDING:"Scooter Sharing",RENTAL_SCOOTER_SEATED:"Sitzroller Sharing",RENTAL_OTHER:"Anderes sharing Fahrzeug",incline:"Steigung",CABLE_CAR:"Seilbahn",FUNICULAR:"Standseilbahn",AERIAL_LIFT:"Luftseilbahn",toll:"Achtung! Mautpflichtige StraÃe.",accessRestriction:"Kein Zugang",continuesAs:"Weiter als",rent:"Ausleihen",copyToClipboard:"In die Zwischenablage kopieren",rideThroughAllowed:"Durchfahrt erlaubt",rideThroughNotAllowed:"Durchfahrt verboten",rideEndAllowed:"Parken erlaubt",rideEndNotAllowed:"Parken nur an Stationen"},hO={ticket:"Billet",ticketOptions:"Options de billet",includedInTicket:"Inclus dans le billet",journeyDetails:"DÃ©tails du voyage",walk:"Ã  pied",bike:"VÃ©lo",cargoBike:"VÃ©lo Cargo",scooterStanding:"Trottinette",scooterSeated:"Trottinette avec siÃ¨ge",car:"Voiture",taxi:"Taxi",moped:"Mobylette",unknownVehicleType:"Type de vÃ©hicule inconnu",electricAssist:"Assistance moteur Ã©lectrique",electric:"Ãlectrique",combustion:"Combustion",combustionDiesel:"Diesel",hybrid:"Hybride",plugInHybrid:"Hybride rechargeable",hydrogenFuelCell:"Pile Ã  combustible hydrogÃ¨ne",from:"De",to:"Ã",viaStop:"ArrÃªt intermÃ©diaire",viaStops:"ArrÃªts intermÃ©diaires",addViaStop:"Ajouter un arrÃªt intermÃ©diaire",removeViaStop:"Supprimer l'arrÃªt intermÃ©diaire",viaStayDuration:"DurÃ©e minimale d'arrÃªt",position:"Position",arrival:"ArrivÃ©e",departure:"DÃ©part",duration:"DurÃ©e",arrivals:"ArrivÃ©es",later:"plus tard",earlier:"plus tÃ´t",departures:"DÃ©parts",connections:"ItinÃ©raires",switchToArrivals:"Afficher les arrivÃ©es",switchToDepartures:"Afficher les dÃ©parts",track:"Voie",platform:"Quai",trackAbr:"V.",platformAbr:"Q.",arrivalOnTrack:"ArrivÃ©e sur la voie",tripIntermediateStops:r=>{switch(r){case 0:return"Aucun arrÃªt intermÃ©diaire";case 1:return"1 arrÃªt intermÃ©diaire";default:return`${r} arrÃªts intermÃ©diaires`}},sharingProvider:"Fournisseur",sharingProviders:"Fournisseurs",transfers:"correspondances",returnOnlyAtStations:"Le vÃ©hicule doit Ãªtre retournÃ© Ã  une station.",roundtripStationReturnConstraint:"Le vÃ©hicule doit Ãªtre retournÃ© Ã  la station de dÃ©part.",rentalStation:"Station",rentalGeofencingZone:"Zone",noItinerariesFound:"Aucun itinÃ©raire trouvÃ©.",advancedSearchOptions:"Options",selectTransitModes:"SÃ©lectionner les modes de transport en commun",defaultSelectedModes:"Tous les transports en commun",defaultSelectedProviders:"Tous les fournisseurs",selectElevationCosts:"Ãvitez les pentes abruptes.",wheelchair:"Correspondances accessibles",useRoutedTransfers:"Utiliser les correspondances routÃ©es",bikeRental:"Utiliser vÃ©hicules partagÃ©s",requireBikeTransport:"Transport vÃ©lo",requireCarTransport:"Transport voiture",considerRentalReturnConstraints:"Retourner les vÃ©hicules partagÃ©s pendant le voyage",default:"Faire dÃ©faut",timetableSources:"Sources des horaires",tripCancelled:"Voyage annulÃ©",stopCancelled:"ArrÃªt supprimÃ©",inOutDisallowed:"Impossible de monter/descendre",inDisallowed:"Impossible de monter",outDisallowed:"Impossible de descendre",unscheduledTrip:"Voyage supplÃ©mentaire",alertsAvailable:"Annonces disponibles",dataExpiredSince:"Attention : DonnÃ©es expirÃ©es, valides jusquâau",FLEX:"Transport Ã  la demande",WALK:"Ã pied",BIKE:"VÃ©lo",RENTAL:"LouÃ©",CAR:"Voiture",CAR_PARKING:"Garage voiture",CAR_DROPOFF:"DÃ©pose (voiture)",TRANSIT:"Transports en commun",TRAM:"Tram",SUBWAY:"MÃ©tro",FERRY:"Ferry",AIRPLANE:"Avion",SUBURBAN:"RER",BUS:"Bus",COACH:"Autocar",RAIL:"Train",HIGHSPEED_RAIL:"Train Ã  grande vitesse",LONG_DISTANCE:"Train intercitÃ©",NIGHT_RAIL:"Train de nuit",REGIONAL_FAST_RAIL:"Train express",REGIONAL_RAIL:"Train rÃ©gional",OTHER:"Autres",routingSegments:{maxTransfers:"Max. de correspondances",maxTravelTime:"Temps de trajet max.",firstMile:"Premier kilomÃ¨tre",lastMile:"Dernier kilomÃ¨tre",direct:"Connexion directe",maxPreTransitTime:"DurÃ©e max. avant transit",maxPostTransitTime:"DurÃ©e max. aprÃ¨s transit",maxDirectTime:"DurÃ©e max. directe"},elevationCosts:{NONE:"Pas de dÃ©tours",LOW:"Petits dÃ©tours",HIGH:"Grands dÃ©tours"},isochrones:{title:"Isochrones",displayLevel:"Couche de prÃ©sentation",maxComputeLevel:"Niveau de calcul max.",canvasRects:"Rectes (Superposer)",canvasCircles:"Cercles (Superposer)",geojsonCircles:"Circles (GÃ©omÃ©trie)",styling:"Style pour Isochrone",noData:"Pas de donnÃ©es",requestFailed:"Ãchec de la demande"},alerts:{validFrom:"Valable du",until:"au",information:"Informations",more:"de plus"},RENTAL_BICYCLE:"VÃ©lo partagÃ©",RENTAL_CARGO_BICYCLE:"VÃ©lo cargo partagÃ©",RENTAL_CAR:"Voiture partagÃ©e",RENTAL_MOPED:"Mobylette partagÃ©e",RENTAL_SCOOTER_STANDING:"Trottinette debout partagÃ©e",RENTAL_SCOOTER_SEATED:"Trottinette assise partagÃ©e",RENTAL_OTHER:"Autre vÃ©hicule partagÃ©",incline:"Pente",CABLE_CAR:"TÃ©lÃ©phÃ©rique",FUNICULAR:"Funiculaire",AERIAL_LIFT:"RemontÃ©e mÃ©canique",toll:"Attention ! Route Ã  pÃ©age.",accessRestriction:"AccÃ¨s restreint",continuesAs:"Continue comme",rent:"Louer",copyToClipboard:"Copier dans le presse-papiers",rideThroughAllowed:"Passage autorisÃ©",rideThroughNotAllowed:"Passage non autorisÃ©",rideEndAllowed:"Stationnement autorisÃ©",rideEndNotAllowed:"Stationnement uniquement aux stations"},dO={ticket:"Bilet",ticketOptions:"Opcje biletu",includedInTicket:"Zawarte w ramach biletu",journeyDetails:"SzczegÃ³Åy podrÃ³Å¼y",transfers:"przesiadki",walk:"Pieszo",bike:"Rower",cargoBike:"Rower cargo",scooterStanding:"Hulajnoga stojÄca",scooterSeated:"Hulajnoga z siedziskiem",car:"SamochÃ³d",taxi:"TaksÃ³wka",moped:"Skuter",unknownVehicleType:"Nieznany typ pojazdu",electricAssist:"Wspomaganie elektryczne",electric:"Elektryczny",combustion:"Spalinowy",combustionDiesel:"Diesel",hybrid:"Hybrydowy",plugInHybrid:"Hybryda plug-in",hydrogenFuelCell:"Ogniwo paliwowe na wodÃ³r",from:"Z",to:"Do",viaStop:"Przystanek poÅredni",viaStops:"Przystanki poÅrednie",addViaStop:"Dodaj przystanek poÅredni",removeViaStop:"UsuÅ przystanek poÅredni",viaStayDuration:"Minimalny postÃ³j",position:"Pozycja",arrival:"Przyjazd",departure:"Odjazd",duration:"Czas trwania",arrivals:"Przyjazdy",later:"pÃ³Åºniej",earlier:"wczeÅniej",departures:"Odjazdy",connections:"PoÅÄczenia",switchToArrivals:"PrzeÅÄcz na przyjazdy",switchToDepartures:"PrzeÅÄcz na odjazdy",track:"Tor",platform:"Peron",trackAbr:"T.",platformAbr:"Pr.",arrivalOnTrack:"Przyjazd na tor",tripIntermediateStops:r=>r==0?"Brak przystankÃ³w poÅrednich":r==1?"1 przystanek poÅredni":r%10>1&&r%10<5&&r!=12&&r!=13&&r!=14?`${r} przystanki poÅrednie`:`${r} przystankÃ³w poÅrednich`,sharingProvider:"Dostawca danych",sharingProviders:"Dostawcy danych",returnOnlyAtStations:"Pojazd musi zostaÄ zwrÃ³cony na stacji.",roundtripStationReturnConstraint:"Pojazd musi zostaÄ zwrÃ³cony do stacji poczÄtkowej.",rentalStation:"Stacja",rentalGeofencingZone:"Strefa",noItinerariesFound:"Nie znaleziono poÅÄczeÅ.",advancedSearchOptions:"Opcje",selectTransitModes:"Wybierz Årodki transportu",defaultSelectedModes:"Wszystkie Årodki transportu",defaultSelectedProviders:"Wszyscy dostawcy",selectElevationCosts:"Unikaj stromych nachyleÅ.",wheelchair:"Bezbarierowe przesiadki",useRoutedTransfers:"Wyznacz trasy dla przesiadek",bikeRental:"UÅ¼yj pojazdÃ³w wspÃ³Ådzielonych",requireBikeTransport:"PrzewÃ³z roweru",requireCarTransport:"PrzewÃ³z samochodu",considerRentalReturnConstraints:"ZwrÃ³Ä pojazd wspÃ³Ådzielony podczas podrÃ³Å¼y",default:"DomyÅlne",timetableSources:"Å¹rÃ³dÅa danych rozkÅadowych",tripCancelled:"Kurs odwoÅany",stopCancelled:"Przystanek nieobsÅugiwany",inOutDisallowed:"Zabronione wejÅcie i wyjÅcie",inDisallowed:"Zabronione wejÅcie",outDisallowed:"Zabronione wyjÅcie",unscheduledTrip:"Kurs dodatkowy",alertsAvailable:"IstniejÄ ogÅoszenia",dataExpiredSince:"Uwaga: Dane nieaktualne, ostatnio waÅ¼ne",FLEX:"Transport na Å¼Ädanie",WALK:"Pieszo",BIKE:"Rower",RENTAL:"WspÃ³Ådzielenie pojazdÃ³w",CAR:"SamochÃ³d",CAR_PARKING:"SamochÃ³d (uÅ¼yj parkingÃ³w)",CAR_DROPOFF:"SamochÃ³d (tylko zatrzymanie)",TRANSIT:"Transport publiczny",TRAM:"Tramwaj",SUBWAY:"Metro",FERRY:"Prom",AIRPLANE:"Samolot",SUBURBAN:"Kolej miejska",BUS:"Autobus",COACH:"Autokar dalekobieÅ¼ny",RAIL:"Kolej",HIGHSPEED_RAIL:"Kolej duÅ¼ych prÄdkoÅci",LONG_DISTANCE:"Kolej dalekobieÅ¼na",NIGHT_RAIL:"Nocne pociÄgi",REGIONAL_FAST_RAIL:"PociÄg pospieszny",REGIONAL_RAIL:"Kolej regionalna",OTHER:"Inne",routingSegments:{maxTransfers:"Maks. iloÅÄ przesiadek",maxTravelTime:"Maks. czas podrÃ³Å¼y",firstMile:"PoczÄtek podrÃ³Å¼y",lastMile:"OsiÄgniÄcie celu",direct:"PoÅÄczenie bezpoÅrednie",maxPreTransitTime:"Maks. czas dotarcia",maxPostTransitTime:"Maks. czas dotarcia",maxDirectTime:"Maks. czas dotarcia"},elevationCosts:{NONE:"Bez odchyleÅ od trasy",LOW:"MaÅe odchylenia od trasy",HIGH:"DuÅ¼e odchylenia od trasy"},isochrones:{title:"Izochrony",displayLevel:"Poziom wyÅwietlania",maxComputeLevel:"Maks. poziom wyliczenia",canvasRects:"Kwadraty (warstwa)",canvasCircles:"OkrÄgi (warstwa)",geojsonCircles:"OkrÄgi (geometria)",styling:"Styl izochron",noData:"Brak danych",requestFailed:"BÅÄd zapytania"},alerts:{validFrom:"WaÅ¼ne od",until:"do",information:"Informacje",more:"wiÄcej"},RENTAL_BICYCLE:"Rower wspÃ³Ådzielony",RENTAL_CARGO_BICYCLE:"Rower cargo wspÃ³Ådzielony",RENTAL_CAR:"SamochÃ³d wspÃ³Ådzielony",RENTAL_MOPED:"Skuter wspÃ³Ådzielony",RENTAL_SCOOTER_STANDING:"Hulajnoga stojÄca wspÃ³Ådzielona",RENTAL_SCOOTER_SEATED:"Hulajnoga z siedziskiem wspÃ³Ådzielona",RENTAL_OTHER:"Inny pojazd wspÃ³Ådzielony",incline:"Nachylenie",CABLE_CAR:"Kolej linowa",FUNICULAR:"Kolej linowo-terenowa",AERIAL_LIFT:"WyciÄg krzeseÅkowy",toll:"Uwaga! Za przejazd tÄ trasÄ pobierana jest opÅata.",accessRestriction:"Ograniczony dostÄp",continuesAs:"Kontynuuje jako",rent:"WypoÅ¼ycz",copyToClipboard:"Kopiuj do schowka",rideThroughAllowed:"Przejazd dozwolony",rideThroughNotAllowed:"Przejazd niedozwolony",rideEndAllowed:"Parkowanie dozwolone",rideEndNotAllowed:"Parkowanie tylko na stacjach"},fO={ticket:"JÃ­zdenka",ticketOptions:"MoÅ¾nosti jÃ­zdenky",includedInTicket:"ZahrnutÃ© v jÃ­zdence",journeyDetails:"Detail cesty",transfers:"pÅestupy",walk:"PÄÅ¡ky",bike:"Kolo",cargoBike:"NÃ¡kladnÃ­ kolo",scooterStanding:"KolobÄÅ¾ka",scooterSeated:"KolobÄÅ¾ka se sedaÄkou",car:"Auto",taxi:"Taxi",moped:"SkÃºtr",unknownVehicleType:"NeznÃ¡mÃ½ typ vozidla",electricAssist:"ElektrickÃ¡ podpora",electric:"ElektrickÃ©",combustion:"SpalovacÃ­",combustionDiesel:"Diesel",hybrid:"HybridnÃ­",plugInHybrid:"Plug-in hybrid",hydrogenFuelCell:"VodÃ­kovÃ½ palivovÃ½ ÄlÃ¡nek",from:"Z",to:"Do",viaStop:"MezizastÃ¡vka",viaStops:"MezizastÃ¡vky",addViaStop:"PÅidat mezizastÃ¡vku",removeViaStop:"Odebrat mezizastÃ¡vku",viaStayDuration:"MinimÃ¡lnÃ­ pobyt",position:"Pozice",arrival:"PÅÃ­jezd",departure:"Odjezd",duration:"Äas cesty",arrivals:"PÅÃ­jezdy",later:"pozdÄji",earlier:"dÅive",departures:"Odjezdy",connections:"Spoje",switchToArrivals:"PÅepni na pÅÃ­jezdy",switchToDepartures:"PÅepni na odjezdy",track:"Kolej",platform:"NÃ¡stupiÅ¡tÄ",platformAbr:"NÃ¡st.",trackAbr:"K.",arrivalOnTrack:"PÅÃ­jezd na kolej",tripIntermediateStops:r=>r==0?"Bez mezizastÃ¡vek":r==1?"1 mezizastÃ¡vka":r%10>1&&r%10<5&&r!=12&&r!=13&&r!=14?`${r} mezizastÃ¡vky`:`${r} mezizastÃ¡vek`,sharingProvider:"Poskytovatel dat",sharingProviders:"PoskytovatelÃ© dat",returnOnlyAtStations:"Vozidlo musÃ­ bÃ½t vrÃ¡ceno na stanici.",roundtripStationReturnConstraint:"Pojezd musÃ­ bÃ½t vrÃ¡cen k poÄÃ¡teÄnÃ­ stanice",rentalStation:"Stanice",rentalGeofencingZone:"ZÃ³na",noItinerariesFound:"SpojenÃ­ nebylo nalezeno.",advancedSearchOptions:"MoÅ¾nosti",selectTransitModes:"Vyber dopravnÃ­ prostÅedky",defaultSelectedModes:"VÅ¡echny dopravnÃ­ prostÅedky",defaultSelectedProviders:"VÅ¡ichni poskytovatelÃ©",selectElevationCosts:"Bez prudkÃ©ho stoupÃ¡nÃ­.",wheelchair:"BezbariÃ©rovÃ© pÅestupy",useRoutedTransfers:"PoÄÃ­tej trasu pro pÅestupy",bikeRental:"Povol pouÅ¾itÃ­ sdÃ­lenÃ½ch vozidel",requireBikeTransport:"PÅeprava kola",requireCarTransport:"PÅeprava auta",considerRentalReturnConstraints:"VraÅ¥ sdÃ­lenÃ© vozidla bÄhem cesty",default:"default",timetableSources:"Zdroje dÃ¡t JÅ",tripCancelled:"Spoj odÅeknut",stopCancelled:"ZastÃ¡vka bez obsluhy",inOutDisallowed:"Vstup/vÃ½stup nenÃ­ povolen",inDisallowed:"Vstup nenÃ­ povolen",outDisallowed:"VÃ½stup nenÃ­ povolen",unscheduledTrip:"DoplÅkovÃ½ spoj",alertsAvailable:"OznÃ¡menÃ­ o provozu",dataExpiredSince:"Pozor: ZastaralÃ¡ data, platnÃ¡ naposledy",FLEX:"PoptÃ¡vkovÃ¡ doprava",WALK:"ChÅ¯ze",BIKE:"Kolo",RENTAL:"SdÃ­lenÃ© prostÅedky",CAR:"Auto",CAR_PARKING:"Auto (vyuÅ¾itÃ­ parkovÃ­Å¡Å¥)",CAR_DROPOFF:"Auto (pouze zastavenÃ­)",TRANSIT:"HromadnÃ¡ doprava",TRAM:"Tramvaj",SUBWAY:"Metro",FERRY:"PÅÃ­voz",AIRPLANE:"Letadlo",SUBURBAN:"MÄstskÃ¡ Å¾eleznice",BUS:"Autobus",COACH:"DÃ¡lkovÃ½ autokar",RAIL:"Å½eleznice",HIGHSPEED_RAIL:"VysokorychlostnÃ­ Å¾eleznice",LONG_DISTANCE:"DÃ¡lkovÃ¡ Å¾eleznice",NIGHT_RAIL:"NoÄnÃ­ vlaky",REGIONAL_FAST_RAIL:"ZrychlenÃ¡ Å¾eleznice",REGIONAL_RAIL:"RegionÃ¡lnÃ­ Å¾eleznice",OTHER:"JinÃ©",routingSegments:{maxTransfers:"Max. poÄet pÅestupÅ¯",maxTravelTime:"Max. Äas cesty",firstMile:"PÅesun k prvnÃ­ zastÃ¡vce",lastMile:"PÅesun od poslednÃ­ zastÃ¡vky",direct:"PÅÃ­mÃ© spojenÃ­",maxPreTransitTime:"Max. Äas pÅesunu",maxPostTransitTime:"Max. Äas pÅesunu",maxDirectTime:"Max. Äas pÅesunu"},elevationCosts:{NONE:"Bez odklonÅ¯",LOW:"MalÃ© odklony",HIGH:"VelkÃ© odklony"},isochrones:{title:"Izochrony",displayLevel:"ÃroveÅ ukazovÃ¡nÃ­",maxComputeLevel:"Max. ÃºroveÅ vypoÄÃ­tÃ¡nÃ­",canvasRects:"Ätverce",canvasCircles:"Okruhy (zjednoduÅ¡enÃ¡ projekce)",geojsonCircles:"Okruhy (pokroÄilÃ¡ projekce)",styling:"Styl izochron",noData:"Å½Ã¡dnÃ© data",requestFailed:"Chyba Å¾Ã¡dosti"},alerts:{validFrom:"PlatÃ­ od",until:"do",information:"Informace",more:"vÃ­ce"},RENTAL_BICYCLE:"SdÃ­lenÃ© kolo",RENTAL_CARGO_BICYCLE:"SdÃ­lenÃ© nÃ¡kladnÃ­ kolo",RENTAL_CAR:"SdÃ­lenÃ© auto",RENTAL_MOPED:"SdÃ­lenÃ½ skÃºtr",RENTAL_SCOOTER_STANDING:"SdÃ­lenÃ¡ kolobÄÅ¾ka",RENTAL_SCOOTER_SEATED:"SdÃ­lenÃ¡ kolobÄÅ¾ka se sedaÄkou",RENTAL_OTHER:"JinÃ© sdÃ­lenÃ© vozidla",incline:"Sklon",CABLE_CAR:"LanovÃ¡ drÃ¡ha",FUNICULAR:"LanovÃ¡ drÃ¡ha",AERIAL_LIFT:"LanovÃ¡ drÃ¡ha",toll:"Pozor! PrÅ¯jezd tuto trasou je placenÃ½.",accessRestriction:"OmezenÃ½ dostup",continuesAs:"PokraÄuje jako",rent:"PÅ¯jÄit si",copyToClipboard:"KopÃ­rovat do schrÃ¡nky",rideThroughAllowed:"PrÅ¯jezd povolen",rideThroughNotAllowed:"PrÅ¯jezd zakÃ¡zÃ¡n",rideEndAllowed:"ParkovÃ¡nÃ­ povoleno",rideEndNotAllowed:"ParkovÃ¡nÃ­ pouze na stanicÃ­ch"},ux=new Map(Object.entries({bg:cO,pl:dO,en:WE,de:uO,fr:hO,cz:fO})),f_=new URLSearchParams(window.location.search).get("language"),hx=(f_&&ux.get(f_??"")?f_:navigator.languages.find(r=>ux.has(r.slice(0,2)))??"en")?.slice(0,2),eo=f_??hx,yt=hx?ux.get(hx):WE;function _n(...r){return oO(Tp(r))}const R_=new URLSearchParams(window.location.search),go=(r,e)=>{if(R_){const t=R_.get(r);if(t!=null)return t.split(",").filter(n=>n.length)}return e||[]},qf=(r,e)=>{R_?.has(e)&&(r[e]=R_.get(e))},M_=(r,e,t=!1)=>{qf(r,"debug"),qf(r,"dark"),qf(r,"light"),qf(r,"motis"),qf(r,"language");const n=new URLSearchParams(r);(t?SE:ix)("?"+n.toString(),e)},Ad=(r,e,t,n=!1,s=!1)=>{M_({stopArriveBy:n,stopId:e,time:t.toISOString()},{stopArriveBy:n,selectedStop:{name:r,stopId:e,time:t},selectedItinerary:s?void 0:ri.state.selectedItinerary,tripId:s?void 0:ri.state.tripId,showDepartures:!0},s)},Lp=async(r,e=!1)=>{const{data:t,error:n}=await Sk({query:{tripId:r,joinInterlinedLegs:!1,language:[eo]}});if(n){console.log(n),alert(String(n.error?.toString()??n));return}jE(t),M_({tripId:r},{selectedItinerary:t,tripId:r,selectedStop:e?void 0:ri.state.selectedStop,showDepartures:!1},e)};var pO=Fe("<div><!></div>");function _o(r,e){Tt(e,!0);let t=null,n=wt(!1);class s{onAdd(I){return t}onRemove(I){t?.parentNode?.removeChild(t)}getDefaultPosition}let l=new s,c=Sa("map");kr(()=>{c.map&&t&&e.position!=null&&(c.map.addControl(l,e.position),pe(n,!0))}),hc(()=>c.map?.removeControl(l));var a=pO();let g;var v=Ae(a);{var w=P=>{var I=We(),k=ue(I);Ot(k,()=>e.children),Z(P,I)};Ze(v,P=>{e.children&&P(w)})}we(a),as(a,P=>t=P,()=>t),mt(P=>g=fi(a,1,P,null,g,{hidden:!S(n)&&e.position!=null}),[()=>bo(_n("clear-both pointer-events-auto pt-2 md:pt-4 px-2 md:px-4 max-w-full",e.class))]),Z(r,a),St()}function gO(r){return typeof r=="function"}function mO(r){return r!==null&&typeof r=="object"}const _O=["string","number","bigint","boolean"];function dx(r){return r==null||_O.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>dx(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const Bp=Symbol("box"),S0=Symbol("is-writable");function yO(r){return mO(r)&&Bp in r}function vO(r){return Ke.isBox(r)&&S0 in r}function Ke(r){let e=wt(tn(r));return{[Bp]:!0,[S0]:!0,get current(){return S(e)},set current(t){pe(e,t,!0)}}}function bO(r,e){const t=me(r);return e?{[Bp]:!0,[S0]:!0,get current(){return S(t)},set current(n){e(n)}}:{[Bp]:!0,get current(){return r()}}}function xO(r){return Ke.isBox(r)?r:gO(r)?Ke.with(r):Ke(r)}function wO(r){return Object.entries(r).reduce((e,[t,n])=>Ke.isBox(n)?(Ke.isWritableBox(n)?Object.defineProperty(e,t,{get(){return n.current},set(s){n.current=s}}):Object.defineProperty(e,t,{get(){return n.current}}),e):Object.assign(e,{[t]:n}),{})}function TO(r){return Ke.isWritableBox(r)?{[Bp]:!0,get current(){return r.current}}:r}Ke.from=xO;Ke.with=bO;Ke.flatten=wO;Ke.readonly=TO;Ke.isBox=yO;Ke.isWritableBox=vO;function $E(...r){return function(e){for(const t of r)if(t){if(e.defaultPrevented)return;typeof t=="function"?t.call(this,e):t.current?.call(this,e)}}}var Fh={},Jv,JT;function SO(){if(JT)return Jv;JT=1;var r=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,n=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,s=/^:\s*/,l=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,c=/^[;\s]*/,a=/^\s+|\s+$/g,g=`
`,v="/",w="*",P="",I="comment",k="declaration";Jv=function(D,B){if(typeof D!="string")throw new TypeError("First argument must be a string");if(!D)return[];B=B||{};var U=1,V=1;function L(Ne){var fe=Ne.match(e);fe&&(U+=fe.length);var Le=Ne.lastIndexOf(g);V=~Le?Ne.length-Le:V+Ne.length}function $(){var Ne={line:U,column:V};return function(fe){return fe.position=new te(Ne),se(),fe}}function te(Ne){this.start=Ne,this.end={line:U,column:V},this.source=B.source}te.prototype.content=D;function G(Ne){var fe=new Error(B.source+":"+U+":"+V+": "+Ne);if(fe.reason=Ne,fe.filename=B.source,fe.line=U,fe.column=V,fe.source=D,!B.silent)throw fe}function le(Ne){var fe=Ne.exec(D);if(fe){var Le=fe[0];return L(Le),D=D.slice(Le.length),fe}}function se(){le(t)}function oe(Ne){var fe;for(Ne=Ne||[];fe=be();)fe!==!1&&Ne.push(fe);return Ne}function be(){var Ne=$();if(!(v!=D.charAt(0)||w!=D.charAt(1))){for(var fe=2;P!=D.charAt(fe)&&(w!=D.charAt(fe)||v!=D.charAt(fe+1));)++fe;if(fe+=2,P===D.charAt(fe-1))return G("End of comment missing");var Le=D.slice(2,fe-2);return V+=2,L(Le),D=D.slice(fe),V+=2,Ne({type:I,comment:Le})}}function xe(){var Ne=$(),fe=le(n);if(fe){if(be(),!le(s))return G("property missing ':'");var Le=le(l),tt=Ne({type:k,property:N(fe[0].replace(r,P)),value:Le?N(Le[0].replace(r,P)):P});return le(c),tt}}function _e(){var Ne=[];oe(Ne);for(var fe;fe=xe();)fe!==!1&&(Ne.push(fe),oe(Ne));return Ne}return se(),_e()};function N(D){return D?D.replace(a,P):P}return Jv}var e2;function AO(){if(e2)return Fh;e2=1;var r=Fh&&Fh.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fh,"__esModule",{value:!0}),Fh.default=t;var e=r(SO());function t(n,s){var l=null;if(!n||typeof n!="string")return l;var c=(0,e.default)(n),a=typeof s=="function";return c.forEach(function(g){if(g.type==="declaration"){var v=g.property,w=g.value;a?s(v,w,g):w&&(l=l||{},l[v]=w)}}),l}return Fh}var EO=AO();const t2=w0(EO),PO=t2.default||t2,IO=/\d/,CO=["-","_","/","."];function RO(r=""){if(!IO.test(r))return r!==r.toLowerCase()}function MO(r){const e=[];let t="",n,s;for(const l of r){const c=CO.includes(l);if(c===!0){e.push(t),t="",n=void 0;continue}const a=RO(l);if(s===!1){if(n===!1&&a===!0){e.push(t),t=l,n=a;continue}if(n===!0&&a===!1&&t.length>1){const g=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=g+l,n=a;continue}}t+=l,n=a,s=c}return e.push(t),e}function HE(r){return r?MO(r).map(e=>DO(e)).join(""):""}function kO(r){return OO(HE(r||""))}function DO(r){return r?r[0].toUpperCase()+r.slice(1):""}function OO(r){return r?r[0].toLowerCase()+r.slice(1):""}function lp(r){if(!r)return{};const e={};function t(n,s){if(n.startsWith("-moz-")||n.startsWith("-webkit-")||n.startsWith("-ms-")||n.startsWith("-o-")){e[HE(n)]=s;return}if(n.startsWith("--")){e[n]=s;return}e[kO(n)]=s}return PO(r,t),e}function tl(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function FO(r,e){const t=RegExp(r,"g");return n=>{if(typeof n!="string")throw new TypeError(`expected an argument of type string, but got ${typeof n}`);return n.match(t)?n.replace(t,e):n}}const NO=FO(/[A-Z]/,r=>`-${r.toLowerCase()}`);function LO(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${NO(e)}: ${r[e]};`).join(`
`)}function A0(r={}){return LO(r).replace(`
`," ")}const BO={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"},zO=A0(BO);function UO(r){return r.length>2&&r.startsWith("on")&&r[2]===r[2]?.toLowerCase()}function Cn(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const n=r[t];for(const s in n){const l=e[s],c=n[s],a=typeof l=="function",g=typeof c=="function";if(a&&UO(s)){const v=l,w=c;e[s]=$E(v,w)}else if(a&&g)e[s]=tl(l,c);else if(s==="class"){const v=dx(l),w=dx(c);v&&w?e[s]=Tp(l,c):v?e[s]=Tp(l):w&&(e[s]=Tp(c))}else if(s==="style"){const v=typeof l=="object",w=typeof c=="object",P=typeof l=="string",I=typeof c=="string";if(v&&w)e[s]={...l,...c};else if(v&&I){const k=lp(c);e[s]={...l,...k}}else if(P&&w){const k=lp(l);e[s]={...k,...c}}else if(P&&I){const k=lp(l),N=lp(c);e[s]={...k,...N}}else v?e[s]=l:w?e[s]=c:P?e[s]=l:I&&(e[s]=c)}else e[s]=c!==void 0?c:l}}return typeof e.style=="object"&&(e.style=A0(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const ZE=typeof window<"u"?window:void 0;function VO(r){let e=r.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}class jO{#t;#e;constructor(e={}){const{window:t=ZE,document:n=t?.document}=e;t!==void 0&&(this.#t=n,this.#e=gk(s=>{const l=li(t,"focusin",s),c=li(t,"focusout",s);return()=>{l(),c()}}))}get current(){return this.#e?.(),this.#t?VO(this.#t):null}}new jO;function WO(r){return typeof r=="function"}function $O(r,e){switch(r){case"post":kr(e);break;case"pre":g0(e);break}}function XE(r,e,t,n={}){const{lazy:s=!1}=n;let l=!s,c=Array.isArray(r)?[]:void 0;$O(e,()=>{const a=Array.isArray(r)?r.map(v=>v()):r();if(!l){l=!0,c=a;return}const g=Ms(()=>t(a,c));return c=a,g})}function Rn(r,e,t){XE(r,"post",e,t)}function HO(r,e,t){XE(r,"pre",e,t)}Rn.pre=HO;function ZO(r){return WO(r)?r():r}class XO{#t=wt(tn({width:0,height:0}));constructor(e,t={box:"border-box"}){const n=t.window??ZE;pe(this.#t,{width:t.initialSize?.width??0,height:t.initialSize?.height??0},!0),kr(()=>{if(!n)return;const s=ZO(e);if(!s)return;const l=new n.ResizeObserver(c=>{for(const a of c){const g=t.box==="content-box"?a.contentBoxSize:a.borderBoxSize,v=Array.isArray(g)?g:[g];S(this.#t).width=v.reduce((w,P)=>Math.max(w,P.inlineSize),0),S(this.#t).height=v.reduce((w,P)=>Math.max(w,P.blockSize),0)}});return l.observe(s),()=>{l.disconnect()}})}get current(){return S(this.#t)}get width(){return S(this.#t).width}get height(){return S(this.#t).height}}class qE{#t=wt(void 0);#e;constructor(e){kr(()=>{pe(this.#t,this.#e,!0),this.#e=e()})}get current(){return S(this.#t)}}class Pa{#t;#e;constructor(e){this.#t=e,this.#e=Symbol(e)}get key(){return this.#e}exists(){return ak(this.#e)}get(){const e=Sa(this.#e);if(e===void 0)throw new Error(`Context "${this.#t}" not found`);return e}getOr(e){const t=Sa(this.#e);return t===void 0?e:t}set(e){return hy(this.#e,e)}}function E0(r){kr(()=>()=>{r()})}function zn({id:r,ref:e,deps:t=()=>!0,onRefChange:n,getRootNode:s}){Rn([()=>r.current,t],([l])=>{const a=(s?.()??document)?.getElementById(l);a?e.current=a:e.current=null,n?.(e.current)}),E0(()=>{e.current=null,n?.(null)})}function my(r,e){return setTimeout(e,r)}function Ed(r){p0().then(r)}function P0(r){kr(()=>Ms(()=>r()))}function _y(r){return r?"open":"closed"}function qO(r){return r?"checked":"unchecked"}function GE(r){return r?"true":"false"}function I0(r){return r?"true":"false"}function Ao(r){return r?"":void 0}function YE(r){return r?"true":"false"}function GO(r){return r?"true":"false"}function KE(r,e){return r?"true":"false"}function QE(r){return r?"true":void 0}function YO(r){return r?"":void 0}function KO(r){return r?!0:void 0}function C0(r){return r?!0:void 0}function QO(r){return r?!0:void 0}const JO="Alt",to="ArrowDown",Pd="ArrowLeft",Id="ArrowRight",Rs="ArrowUp",eF="Backspace",tF="CapsLock",rF="Control",Cd="End",sc="Enter",R0="Escape",nF="F1",iF="F10",sF="F11",oF="F12",aF="F2",lF="F3",cF="F4",uF="F5",hF="F6",dF="F7",fF="F8",pF="F9",Rd="Home",gF="Meta",M0="PageDown",k0="PageUp",mF="Shift",nc=" ",zp="Tab";function _F(r){return window.getComputedStyle(r).getPropertyValue("direction")}function yF(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?Pd:Id,vertical:to}[e]}function vF(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?Id:Pd,vertical:Rs}[e]}function bF(r="ltr",e="horizontal"){return["ltr","rtl"].includes(r)||(r="ltr"),["horizontal","vertical"].includes(e)||(e="horizontal"),{nextKey:yF(r,e),prevKey:vF(r,e)}}const yy=typeof document<"u",fx=xF();function xF(){return yy&&window?.navigator?.userAgent&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||window?.navigator?.maxTouchPoints>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function px(r){return r instanceof HTMLElement}function wF(r){return r instanceof Element}function JE(r){return r instanceof Element||r instanceof SVGElement}function TF(r){return r!==null}function SF(r){return r instanceof HTMLInputElement&&"select"in r}function AF(r,e){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function eP(r){const e=Ke(null);function t(){if(!yy)return[];const c=document.getElementById(r.rootNodeId.current);return c?r.candidateSelector?Array.from(c.querySelectorAll(r.candidateSelector)):r.candidateAttr?Array.from(c.querySelectorAll(`[${r.candidateAttr}]:not([data-disabled])`)):[]:[]}function n(){const c=t();c.length&&c[0]?.focus()}function s(c,a,g=!1){const v=document.getElementById(r.rootNodeId.current);if(!v||!c)return;const w=t();if(!w.length)return;const P=w.indexOf(c),I=_F(v),{nextKey:k,prevKey:N}=bF(I,r.orientation.current),D=r.loop.current,B={[k]:P+1,[N]:P-1,[Rd]:0,[Cd]:w.length-1};if(g){const L=k===to?Id:to,$=N===Rs?Pd:Rs;B[L]=P+1,B[$]=P-1}let U=B[a.key];if(U===void 0)return;a.preventDefault(),U<0&&D?U=w.length-1:U===w.length&&D&&(U=0);const V=w[U];if(V)return V.focus(),e.current=V.id,r.onCandidateFocus?.(V),V}function l(c){const a=t(),g=e.current!==null;return c&&!g&&a[0]===c?(e.current=c.id,0):c?.id===e.current?0:-1}return{setCurrentTabStopId(c){e.current=c},getTabIndex:l,handleKeydown:s,focusFirstCandidate:n,currentTabStopId:e}}globalThis.bitsIdCounter??={current:0};function Wn(r="bits"){return globalThis.bitsIdCounter.current++,`${r}-${globalThis.bitsIdCounter.current}`}function In(){}function EF(r,e){const t=Ke(r);function n(l){return e[t.current][l]??t.current}return{state:t,dispatch:l=>{t.current=n(l)}}}function PF(r,e){let t=wt(tn({})),n=wt("none");const s=r.current?"mounted":"unmounted";let l=wt(null);const c=new qE(()=>r.current);Rn([()=>e.current,()=>r.current],([I,k])=>{!I||!k||Ed(()=>{pe(l,document.getElementById(I),!0)})});const{state:a,dispatch:g}=EF(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Rn(()=>r.current,I=>{if(S(l)||pe(l,document.getElementById(e.current),!0),!S(l)||!(I!==c.current))return;const N=S(n),D=Lm(S(l));I?g("MOUNT"):D==="none"||S(t).display==="none"?g("UNMOUNT"):g(c&&N!==D?"ANIMATION_OUT":"UNMOUNT")});function v(I){if(S(l)||pe(l,document.getElementById(e.current),!0),!S(l))return;const k=Lm(S(l)),N=k.includes(I.animationName)||k==="none";I.target===S(l)&&N&&g("ANIMATION_END")}function w(I){S(l)||pe(l,document.getElementById(e.current),!0),S(l)&&I.target===S(l)&&pe(n,Lm(S(l)),!0)}Rn(()=>a.current,()=>{if(S(l)||pe(l,document.getElementById(e.current),!0),!S(l))return;const I=Lm(S(l));pe(n,a.current==="mounted"?I:"none",!0)}),Rn(()=>S(l),I=>{if(I)return pe(t,getComputedStyle(I),!0),tl(li(I,"animationstart",w),li(I,"animationcancel",v),li(I,"animationend",v))});const P=me(()=>["mounted","unmountSuspended"].includes(a.current));return{get current(){return S(P)}}}function Lm(r){return r&&getComputedStyle(r).animationName||"none"}function D0(r,e){Tt(e,!0);const t=PF(Ke.with(()=>e.present),Ke.with(()=>e.id));var n=We(),s=ue(n);{var l=c=>{var a=We(),g=ue(a);Ot(g,()=>e.presence??Ht,()=>({present:t})),Z(c,a)};Ze(s,c=>{(e.forceMount||e.present||t.current)&&c(l)})}Z(r,n),St()}function IF(r){return{content:`data-${r}-content`,trigger:`data-${r}-trigger`,overlay:`data-${r}-overlay`,title:`data-${r}-title`,description:`data-${r}-description`,close:`data-${r}-close`,cancel:`data-${r}-cancel`,action:`data-${r}-action`}}class CF{opts;#t=wt(null);get triggerNode(){return S(this.#t)}set triggerNode(e){pe(this.#t,e,!0)}#e=wt(null);get contentNode(){return S(this.#e)}set contentNode(e){pe(this.#e,e,!0)}#r=wt(null);get descriptionNode(){return S(this.#r)}set descriptionNode(e){pe(this.#r,e,!0)}#n=wt(void 0);get contentId(){return S(this.#n)}set contentId(e){pe(this.#n,e,!0)}#i=wt(void 0);get titleId(){return S(this.#i)}set titleId(e){pe(this.#i,e,!0)}#s=wt(void 0);get triggerId(){return S(this.#s)}set triggerId(e){pe(this.#s,e,!0)}#o=wt(void 0);get descriptionId(){return S(this.#o)}set descriptionId(e){pe(this.#o,e,!0)}#a=wt(null);get cancelNode(){return S(this.#a)}set cancelNode(e){pe(this.#a,e,!0)}#l=me(()=>IF(this.opts.variant.current));get attrs(){return S(this.#l)}set attrs(e){pe(this.#l,e)}constructor(e){this.opts=e,this.handleOpen=this.handleOpen.bind(this),this.handleClose=this.handleClose.bind(this)}handleOpen(){this.opts.open.current||(this.opts.open.current=!0)}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}#c=me(()=>({"data-state":_y(this.opts.open.current)}));get sharedProps(){return S(this.#c)}set sharedProps(e){pe(this.#c,e)}}class RF{opts;root;constructor(e,t){this.opts=e,this.root=t,zn({...e,onRefChange:n=>{this.root.triggerNode=n,this.root.triggerId=n?.id}}),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){this.opts.disabled.current||e.button>0||this.root.handleOpen()}onkeydown(e){this.opts.disabled.current||(e.key===nc||e.key===sc)&&(e.preventDefault(),this.root.handleOpen())}#t=me(()=>({id:this.opts.id.current,"aria-haspopup":"dialog","aria-expanded":I0(this.root.opts.open.current),"aria-controls":this.root.contentId,[this.root.attrs.trigger]:"",onkeydown:this.onkeydown,onclick:this.onclick,disabled:this.opts.disabled.current?!0:void 0,...this.root.sharedProps}));get props(){return S(this.#t)}set props(e){pe(this.#t,e)}}class MF{opts;root;#t=me(()=>this.root.attrs[this.opts.variant.current]);constructor(e,t){this.opts=e,this.root=t,this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this),zn({...e,deps:()=>this.root.opts.open.current})}onclick(e){this.opts.disabled.current||e.button>0||this.root.handleClose()}onkeydown(e){this.opts.disabled.current||(e.key===nc||e.key===sc)&&(e.preventDefault(),this.root.handleClose())}#e=me(()=>({id:this.opts.id.current,[S(this.#t)]:"",onclick:this.onclick,onkeydown:this.onkeydown,disabled:this.opts.disabled.current?!0:void 0,tabindex:0,...this.root.sharedProps}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class kF{opts;root;constructor(e,t){this.opts=e,this.root=t,zn({...e,deps:()=>this.root.opts.open.current,onRefChange:n=>{this.root.descriptionNode=n,this.root.descriptionId=n?.id}})}#t=me(()=>({id:this.opts.id.current,[this.root.attrs.description]:"",...this.root.sharedProps}));get props(){return S(this.#t)}set props(e){pe(this.#t,e)}}class DF{opts;root;constructor(e,t){this.opts=e,this.root=t,zn({...e,deps:()=>this.root.opts.open.current,onRefChange:n=>{this.root.contentNode=n,this.root.contentId=n?.id}})}#t=me(()=>({open:this.root.opts.open.current}));get snippetProps(){return S(this.#t)}set snippetProps(e){pe(this.#t,e)}#e=me(()=>({id:this.opts.id.current,role:this.root.opts.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-modal":"true","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto",outline:this.root.opts.variant.current==="alert-dialog"?"none":void 0},tabindex:this.root.opts.variant.current==="alert-dialog"?-1:void 0,...this.root.sharedProps}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class OF{opts;root;constructor(e,t){this.opts=e,this.root=t,zn({...e,deps:()=>this.root.opts.open.current})}#t=me(()=>({open:this.root.opts.open.current}));get snippetProps(){return S(this.#t)}set snippetProps(e){pe(this.#t,e)}#e=me(()=>({id:this.opts.id.current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}const Md=new Pa("Dialog.Root");function FF(r){return Md.set(new CF(r))}function NF(r){return new RF(r,Md.get())}function LF(r){return new DF(r,Md.get())}function BF(r){return new OF(r,Md.get())}function zF(r){return new kF(r,Md.get())}function UF(r){return new MF(r,Md.get())}function VF(r,e){var t=We(),n=ue(t);kk(n,()=>e.children,s=>{var l=We(),c=ue(l);Ot(c,()=>e.children??Ht),Z(s,l)}),Z(r,t)}function O0(r,e){Tt(e,!0);let t=ae(e,"to",3,"body");const n=lk();let s=me(l);function l(){if(!yy||e.disabled)return null;let P=null;return typeof t()=="string"?P=document.querySelector(t()):(t()instanceof HTMLElement||t()instanceof DocumentFragment)&&(P=t()),P}let c;function a(){c&&(u_(c),c=null)}Rn([()=>S(s),()=>e.disabled],([P,I])=>{if(!P||I){a();return}return c=c_(VF,{target:P,props:{children:e.children},context:n}),()=>{a()}});var g=We(),v=ue(g);{var w=P=>{var I=We(),k=ue(I);Ot(k,()=>e.children??Ht),Z(P,I)};Ze(v,P=>{e.disabled&&P(w)})}Z(r,g),St()}function tP(r,e,t,n){const s=Array.isArray(e)?e:[e];return s.forEach(l=>r.addEventListener(l,t,n)),()=>{s.forEach(l=>r.removeEventListener(l,t,n))}}class rP{eventName;options;constructor(e,t={bubbles:!0,cancelable:!0}){this.eventName=e,this.options=t}createEvent(e){return new CustomEvent(this.eventName,{...this.options,detail:e})}dispatch(e,t){const n=this.createEvent(t);return e.dispatchEvent(n),n}listen(e,t,n){const s=l=>{t(l)};return li(e,this.eventName,s,n)}}function r2(r,e=500){let t=null;const n=(...s)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)};return n.destroy=()=>{t!==null&&(clearTimeout(t),t=null)},n}function F0(r,e){return r===e||r.contains(e)}function nP(r){return r?.ownerDocument??document}function jF(r,e){const{clientX:t,clientY:n}=r,s=e.getBoundingClientRect();return t<s.left||t>s.right||n<s.top||n>s.bottom}globalThis.bitsDismissableLayers??=new Map;class WF{opts;#t;#e;#r={pointerdown:!1};#n=!1;#i=!1;node=Ke(null);#s=void 0;#o;#a=wt(null);get currNode(){return S(this.#a)}set currNode(e){pe(this.#a,e,!0)}#l=In;constructor(e){this.opts=e,zn({id:e.id,ref:this.node,deps:()=>e.enabled.current,onRefChange:s=>{this.currNode=s}}),this.#e=e.interactOutsideBehavior,this.#t=e.onInteractOutside,this.#o=e.onFocusOutside,kr(()=>{this.#s=nP(this.currNode)});let t=In;const n=()=>{this.#m(),globalThis.bitsDismissableLayers.delete(this),this.#u.destroy(),t()};Rn([()=>this.opts.enabled.current,()=>this.currNode],([s,l])=>{if(!(!s||!l))return my(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,this.#e),t(),t=this.#p())}),n}),E0(()=>{this.#m.destroy(),globalThis.bitsDismissableLayers.delete(this),this.#u.destroy(),this.#l(),t()})}#c=e=>{e.defaultPrevented||this.currNode&&Ed(()=>{!this.currNode||this.#_(e.target)||e.target&&!this.#i&&this.#o.current?.(e)})};#p(){return tl(li(this.#s,"pointerdown",tl(this.#h,this.#f),{capture:!0}),li(this.#s,"pointerdown",tl(this.#g,this.#u)),li(this.#s,"focusin",this.#c))}#d=e=>{let t=e;t.defaultPrevented&&(t=n2(e)),this.#t.current(e)};#u=r2(e=>{if(!this.currNode){this.#l();return}const t=this.opts.isValidEvent.current(e,this.currNode)||XF(e,this.currNode);if(!this.#n||this.#y()||!t){this.#l();return}let n=e;if(n.defaultPrevented&&(n=n2(n)),this.#e.current!=="close"&&this.#e.current!=="defer-otherwise-close"){this.#l();return}e.pointerType==="touch"?(this.#l(),this.#l=tP(this.#s,"click",this.#d,{once:!0})):this.#t.current(n)},10);#h=e=>{this.#r[e.type]=!0};#g=e=>{this.#r[e.type]=!1};#f=()=>{this.node.current&&(this.#n=ZF(this.node.current))};#_=e=>this.node.current?F0(this.node.current,e):!1;#m=r2(()=>{for(const e in this.#r)this.#r[e]=!1;this.#n=!1},20);#y(){return Object.values(this.#r).some(Boolean)}#v=()=>{this.#i=!0};#b=()=>{this.#i=!1};props={onfocuscapture:this.#v,onblurcapture:this.#b}}function $F(r){return new WF(r)}function HF(r){return r.findLast(([e,{current:t}])=>t==="close"||t==="ignore")}function ZF(r){const e=[...globalThis.bitsDismissableLayers],t=HF(e);if(t)return t[0].node.current===r;const[n]=e[0];return n.node.current===r}function XF(r,e){if("button"in r&&r.button>0)return!1;const t=r.target;return wF(t)?nP(t).documentElement.contains(t)&&!F0(e,t)&&jF(r,e):!1}function n2(r){const e=r.currentTarget,t=r.target;let n;r instanceof PointerEvent?n=new PointerEvent(r.type,r):n=new PointerEvent("pointerdown",r);let s=!1;return new Proxy(n,{get:(c,a)=>a==="currentTarget"?e:a==="target"?t:a==="preventDefault"?()=>{s=!0,typeof c.preventDefault=="function"&&c.preventDefault()}:a==="defaultPrevented"?s:a in c?c[a]:r[a]})}function iP(r,e){Tt(e,!0);let t=ae(e,"interactOutsideBehavior",3,"close"),n=ae(e,"onInteractOutside",3,In),s=ae(e,"onFocusOutside",3,In),l=ae(e,"isValidEvent",3,()=>!1);const c=$F({id:Ke.with(()=>e.id),interactOutsideBehavior:Ke.with(()=>t()),onInteractOutside:Ke.with(()=>n()),enabled:Ke.with(()=>e.enabled),onFocusOutside:Ke.with(()=>s()),isValidEvent:Ke.with(()=>l())});var a=We(),g=ue(a);Ot(g,()=>e.children??Ht,()=>({props:c.props})),Z(r,a),St()}globalThis.bitsEscapeLayers??=new Map;class qF{opts;constructor(e){this.opts=e;let t=In;Rn(()=>e.enabled.current,n=>(n&&(globalThis.bitsEscapeLayers.set(this,e.escapeKeydownBehavior),t=this.#t()),()=>{t(),globalThis.bitsEscapeLayers.delete(this)}))}#t=()=>li(document,"keydown",this.#e,{passive:!1});#e=e=>{if(e.key!==R0||!YF(this))return;const t=new KeyboardEvent(e.type,e);e.preventDefault();const n=this.opts.escapeKeydownBehavior.current;n!=="close"&&n!=="defer-otherwise-close"||this.opts.onEscapeKeydown.current(t)}}function GF(r){return new qF(r)}function YF(r){const e=[...globalThis.bitsEscapeLayers],t=e.findLast(([s,{current:l}])=>l==="close"||l==="ignore");if(t)return t[0]===r;const[n]=e[0];return n===r}function sP(r,e){Tt(e,!0);let t=ae(e,"escapeKeydownBehavior",3,"close"),n=ae(e,"onEscapeKeydown",3,In);GF({escapeKeydownBehavior:Ke.with(()=>t()),onEscapeKeydown:Ke.with(()=>n()),enabled:Ke.with(()=>e.enabled)});var s=We(),l=ue(s);Ot(l,()=>e.children??Ht),Z(r,s),St()}const jl=Ke([]);function KF(){return{add(r){const e=jl.current[0];e&&r.id!==e.id&&e.pause(),jl.current=i2(jl.current,r),jl.current.unshift(r)},remove(r){jl.current=i2(jl.current,r),jl.current[0]?.resume()},get current(){return jl.current}}}function QF(){let r=wt(!1),e=wt(!1);return{id:Wn(),get paused(){return S(r)},get isHandlingFocus(){return S(e)},set isHandlingFocus(t){pe(e,t,!0)},pause(){pe(r,!0)},resume(){pe(r,!1)}}}function i2(r,e){return[...r].filter(t=>t.id!==e.id)}function JF(r){return r.filter(e=>e.tagName!=="A")}function ql(r,{select:e=!1}={}){if(!(r&&r.focus)||document.activeElement===r)return;const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&SF(r)&&e&&r.select()}function eN(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(ql(n,{select:e}),document.activeElement!==t)return!0}function s2(r,e){for(const t of r)if(!AF(t,e))return t}function oP(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function tN(r){const e=oP(r),t=s2(e,r),n=s2(e.reverse(),r);return[t,n]}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var rN=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],nN=rN.join(","),aP=typeof Element>"u",k_=aP?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,D_=!aP&&Element.prototype.getRootNode?function(r){var e;return r==null||(e=r.getRootNode)===null||e===void 0?void 0:e.call(r)}:function(r){return r?.ownerDocument},iN=function r(e,t){var n;t===void 0&&(t=!0);var s=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),l=s===""||s==="true",c=l||t&&e&&r(e.parentNode);return c},sN=function(e){var t,n=e==null||(t=e.getAttribute)===null||t===void 0?void 0:t.call(e,"contenteditable");return n===""||n==="true"},oN=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},aN=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||sN(e))&&!oN(e)?0:e.tabIndex},lP=function(e){return e.tagName==="INPUT"},lN=function(e){return lP(e)&&e.type==="hidden"},cN=function(e){var t=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return t},uN=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},hN=function(e){if(!e.name)return!0;var t=e.form||D_(e),n=function(a){return t.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=n(window.CSS.escape(e.name));else try{s=n(e.name)}catch(c){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",c.message),!1}var l=uN(s,e.form);return!l||l===e},dN=function(e){return lP(e)&&e.type==="radio"},fN=function(e){return dN(e)&&!hN(e)},pN=function(e){var t,n=e&&D_(e),s=(t=n)===null||t===void 0?void 0:t.host,l=!1;if(n&&n!==e){var c,a,g;for(l=!!((c=s)!==null&&c!==void 0&&(a=c.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(g=e.ownerDocument)!==null&&g!==void 0&&g.contains(e));!l&&s;){var v,w,P;n=D_(s),s=(v=n)===null||v===void 0?void 0:v.host,l=!!((w=s)!==null&&w!==void 0&&(P=w.ownerDocument)!==null&&P!==void 0&&P.contains(s))}}return l},o2=function(e){var t=e.getBoundingClientRect(),n=t.width,s=t.height;return n===0&&s===0},gN=function(e,t){var n=t.displayCheck,s=t.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var l=k_.call(e,"details>summary:first-of-type"),c=l?e.parentElement:e;if(k_.call(c,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var g=e.parentElement,v=D_(e);if(g&&!g.shadowRoot&&s(g)===!0)return o2(e);e.assignedSlot?e=e.assignedSlot:!g&&v!==e.ownerDocument?e=v.host:e=g}e=a}if(pN(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return o2(e);return!1},mN=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if(t.tagName==="FIELDSET"&&t.disabled){for(var n=0;n<t.children.length;n++){var s=t.children.item(n);if(s.tagName==="LEGEND")return k_.call(t,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}t=t.parentElement}return!1},_N=function(e,t){return!(t.disabled||iN(t)||lN(t)||gN(t,e)||cN(t)||mN(t))},yN=function(e,t){return!(fN(t)||aN(t)<0||!_N(e,t))},vN=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return k_.call(e,nN)===!1?!1:yN(t,e)};const bN=new rP("focusScope.autoFocusOnMount",{bubbles:!1,cancelable:!0}),xN=new rP("focusScope.autoFocusOnDestroy",{bubbles:!1,cancelable:!0}),wN=new Pa("FocusScope");function TN({id:r,loop:e,enabled:t,onOpenAutoFocus:n,onCloseAutoFocus:s,forceMount:l}){const c=KF(),a=QF(),g=Ke(null),v=wN.getOr({ignoreCloseAutoFocus:!1});let w=null;zn({id:r,ref:g,deps:()=>t.current});function P(U){if(!(a.paused||!g.current||a.isHandlingFocus)){a.isHandlingFocus=!0;try{const V=U.target;if(!px(V))return;const L=g.current.contains(V);if(U.type==="focusin")if(L)w=V;else{if(v.ignoreCloseAutoFocus)return;ql(w,{select:!0})}else U.type==="focusout"&&!L&&!v.ignoreCloseAutoFocus&&ql(w,{select:!0})}finally{a.isHandlingFocus=!1}}}function I(U){if(!w||!g.current)return;let V=!1;for(const L of U){if(L.type==="childList"&&L.removedNodes.length>0)for(const $ of L.removedNodes){if($===w){V=!0;break}if($.nodeType===Node.ELEMENT_NODE&&$.contains(w)){V=!0;break}}if(V)break}V&&g.current&&!g.current.contains(document.activeElement)&&ql(g.current)}Rn([()=>g.current,()=>t.current],([U,V])=>{if(!U||!V)return;const L=tl(li(document,"focusin",P),li(document,"focusout",P)),$=new MutationObserver(I);return $.observe(U,{childList:!0,subtree:!0,attributes:!1}),()=>{L(),$.disconnect()}}),Rn([()=>l.current,()=>g.current],([U,V])=>{if(U)return;const L=document.activeElement;return k(V,L),()=>{V&&N(L)}}),Rn([()=>l.current,()=>g.current,()=>t.current],([U,V])=>{if(!U)return;const L=document.activeElement;return k(V,L),()=>{V&&N(L)}});function k(U,V){if(U||(U=document.getElementById(r.current)),!U||!t.current)return;if(c.add(a),!U.contains(V)){const $=bN.createEvent();n.current($),$.defaultPrevented||Ed(()=>{if(!U)return;eN(JF(oP(U)),{select:!0})||ql(U)})}}function N(U){const V=xN.createEvent();s.current?.(V);const L=v.ignoreCloseAutoFocus;my(0,()=>{!V.defaultPrevented&&U&&!L&&ql(vN(U)?U:document.body,{select:!0}),c.remove(a)})}function D(U){if(!t.current||!e.current&&!t.current||a.paused)return;const V=U.key===zp&&!U.ctrlKey&&!U.altKey&&!U.metaKey,L=document.activeElement;if(!(V&&L))return;const $=g.current;if(!$)return;const[te,G]=tN($);te&&G?!U.shiftKey&&L===G?(U.preventDefault(),e.current&&ql(te,{select:!0})):U.shiftKey&&L===te&&(U.preventDefault(),e.current&&ql(G,{select:!0})):L===$&&U.preventDefault()}const B=me(()=>({id:r.current,tabindex:-1,onkeydown:D}));return{get props(){return S(B)}}}function cP(r,e){Tt(e,!0);let t=ae(e,"trapFocus",3,!1),n=ae(e,"loop",3,!1),s=ae(e,"onCloseAutoFocus",3,In),l=ae(e,"onOpenAutoFocus",3,In),c=ae(e,"forceMount",3,!1);const a=TN({enabled:Ke.with(()=>t()),loop:Ke.with(()=>n()),onCloseAutoFocus:Ke.with(()=>s()),onOpenAutoFocus:Ke.with(()=>l()),id:Ke.with(()=>e.id),forceMount:Ke.with(()=>c())});var g=We(),v=ue(g);Ot(v,()=>e.focusScope??Ht,()=>({props:a.props})),Z(r,g),St()}globalThis.bitsTextSelectionLayers??=new Map;class SN{opts;#t=In;#e=Ke(null);constructor(e){this.opts=e,zn({id:e.id,ref:this.#e,deps:()=>this.opts.enabled.current});let t=In;Rn(()=>this.opts.enabled.current,n=>(n&&(globalThis.bitsTextSelectionLayers.set(this,this.opts.enabled),t(),t=this.#r()),()=>{t(),this.#i(),globalThis.bitsTextSelectionLayers.delete(this)}))}#r(){return tl(li(document,"pointerdown",this.#n),li(document,"pointerup",$E(this.#i,this.opts.onPointerUp.current)))}#n=e=>{const t=this.#e.current,n=e.target;!px(t)||!px(n)||!this.opts.enabled.current||!PN(this)||!F0(t,n)||(this.opts.onPointerDown.current(e),!e.defaultPrevented&&(this.#t=EN(t)))};#i=()=>{this.#t(),this.#t=In}}function AN(r){return new SN(r)}const a2=r=>r.style.userSelect||r.style.webkitUserSelect;function EN(r){const e=document.body,t=a2(e),n=a2(r);return Bm(e,"none"),Bm(r,"text"),()=>{Bm(e,t),Bm(r,n)}}function Bm(r,e){r.style.userSelect=e,r.style.webkitUserSelect=e}function PN(r){const e=[...globalThis.bitsTextSelectionLayers];if(!e.length)return!1;const t=e.at(-1);return t?t[0]===r:!1}function uP(r,e){Tt(e,!0);let t=ae(e,"preventOverflowTextSelection",3,!0),n=ae(e,"onPointerDown",3,In),s=ae(e,"onPointerUp",3,In);AN({id:Ke.with(()=>e.id),onPointerDown:Ke.with(()=>n()),onPointerUp:Ke.with(()=>s()),enabled:Ke.with(()=>e.enabled&&t())});var l=We(),c=ue(l);Ot(c,()=>e.children??Ht),Z(r,l),St()}function IN(r){let e=0,t=wt(void 0),n;function s(){e-=1,n&&e<=0&&(n(),pe(t,void 0),n=void 0)}return(...l)=>(e+=1,S(t)===void 0&&(n=ck(()=>{pe(t,r(...l),!0)})),kr(()=>()=>{s()}),S(t))}const CN=IN(()=>{const r=new lx,e=me(()=>{for(const l of r.values())if(l)return!0;return!1});let t=wt(null),n=null;function s(){yy&&(document.body.setAttribute("style",S(t)??""),document.body.style.removeProperty("--scrollbar-width"),fx&&n?.())}return kr(()=>{const l=S(e);return Ms(()=>{if(!l)return;pe(t,document.body.getAttribute("style"),!0);const c=getComputedStyle(document.body),a=window.innerWidth-document.documentElement.clientWidth,v={padding:Number.parseInt(c.paddingRight??"0",10)+a,margin:Number.parseInt(c.marginRight??"0",10)};a>0&&(document.body.style.paddingRight=`${v.padding}px`,document.body.style.marginRight=`${v.margin}px`,document.body.style.setProperty("--scrollbar-width",`${a}px`),document.body.style.overflow="hidden"),fx&&(n=tP(document,"touchmove",w=>{w.target===document.documentElement&&(w.touches.length>1||w.preventDefault())},{passive:!1})),Ed(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),kr(()=>()=>{n?.()}),{get map(){return r},resetBodyStyle:s}});function RN(r,e=()=>null){const t=Wn(),n=CN();if(!n)return;const s=me(e);n.map.set(t,r??!1);const l=Ke.with(()=>n.map.get(t)??!1,c=>n.map.set(t,c));return kr(()=>()=>{n.map.delete(t),!MN(n.map)&&(S(s)===null?requestAnimationFrame(()=>n.resetBodyStyle()):my(S(s),()=>n.resetBodyStyle()))}),l}function MN(r){for(const[e,t]of r)if(t)return!0;return!1}function O_(r,e){Tt(e,!0);let t=ae(e,"preventScroll",3,!0),n=ae(e,"restoreScrollDelay",3,null);RN(t(),()=>n()),St()}function kN({forceMount:r,present:e,trapFocus:t,open:n}){return r?n&&t:e&&t&&n}var DN=Fe("<div><!></div>");function ON(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"forceMount",3,!1),s=ae(e,"ref",15,null),l=hr(e,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const c=BF({id:Ke.with(()=>t()),ref:Ke.with(()=>s(),g=>s(g))}),a=me(()=>Cn(l,c.props));{const g=w=>{var P=We(),I=ue(P);{var k=D=>{var B=We(),U=ue(B);{let V=me(()=>({props:Cn(S(a)),...c.snippetProps}));Ot(U,()=>e.child,()=>S(V))}Z(D,B)},N=D=>{var B=DN();sn(B,V=>({...V}),[()=>Cn(S(a))]);var U=Ae(B);Ot(U,()=>e.children??Ht,()=>c.snippetProps),we(B),Z(D,B)};Ze(I,D=>{e.child?D(k):D(N,!1)})}Z(w,P)};let v=me(()=>c.root.opts.open.current||n());D0(r,{get id(){return t()},get present(){return S(v)},presence:g,$$slots:{presence:!0}})}St()}var FN=Fe("<button><!></button>");function NN(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"disabled",3,!1),l=hr(e,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const c=NF({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),I=>n(I)),disabled:Ke.with(()=>!!s())}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=I=>{var k=We(),N=ue(k);Ot(N,()=>e.child,()=>({props:S(a)})),Z(I,k)},P=I=>{var k=FN();sn(k,()=>({...S(a)}));var N=Ae(k);Ot(N,()=>e.children??Ht),we(k),Z(I,k)};Ze(v,I=>{e.child?I(w):I(P,!1)})}Z(r,g),St()}var LN=Fe("<div><!></div>");function BN(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=hr(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const l=zF({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=LN();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}function zN(r,e){return r>=0&&r<e.length}function hP(r,e,t=!0){if(!(r.length===0||e<0||e>=r.length))return r.length===1&&e===0?r[0]:e===r.length-1?t?r[0]:void 0:r[e+1]}function dP(r,e,t=!0){if(!(r.length===0||e<0||e>=r.length))return r.length===1&&e===0?r[0]:e===0?t?r[r.length-1]:void 0:r[e-1]}function fP(r,e,t,n=!0){if(r.length===0||e<0||e>=r.length)return;let s=e+t;return n?s=(s%r.length+r.length)%r.length:s=Math.max(0,Math.min(s,r.length-1)),r[s]}function pP(r,e,t,n=!0){if(r.length===0||e<0||e>=r.length)return;let s=e-t;return n?s=(s%r.length+r.length)%r.length:s=Math.max(0,Math.min(s,r.length-1)),r[s]}function N0(r,e,t){const n=e.toLowerCase();if(n.endsWith(" ")){const P=n.slice(0,-1);if(r.filter(D=>D.toLowerCase().startsWith(P)).length<=1)return N0(r,P,t);const k=t?.toLowerCase();if(k&&k.startsWith(P)&&k.charAt(P.length)===" "&&e.trim()===P)return t;const N=r.filter(D=>D.toLowerCase().startsWith(n));if(N.length>0){const D=t?r.indexOf(t):-1;return l2(N,Math.max(D,0)).find(V=>V!==t)||t}}const l=e.length>1&&Array.from(e).every(P=>P===e[0])?e[0]:e,c=l.toLowerCase(),a=t?r.indexOf(t):-1;let g=l2(r,Math.max(a,0));l.length===1&&(g=g.filter(P=>P!==t));const w=g.find(P=>P?.toLowerCase().startsWith(c));return w!==t?w:void 0}function l2(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var UN=Fe("<input/>"),VN=Fe("<input/>");function L0(r,e){Tt(e,!0);let t=ae(e,"value",15),n=hr(e,["$$slots","$$events","$$legacy","value"]);const s=me(()=>Cn(n,{"aria-hidden":"true",tabindex:-1,style:zO}));var l=We(),c=ue(l);{var a=v=>{var w=UN();sn(w,()=>({...S(s),value:t()}),void 0,void 0,void 0,void 0,!0),Z(v,w)},g=v=>{var w=VN();sn(w,()=>({...S(s)}),void 0,void 0,void 0,void 0,!0),DE(w,t),Z(v,w)};Ze(c,v=>{S(s).type==="checkbox"?v(a):v(g,!1)})}Z(r,l),St()}const jN=["top","right","bottom","left"],oc=Math.min,Qs=Math.max,F_=Math.round,zm=Math.floor,Ta=r=>({x:r,y:r}),WN={left:"right",right:"left",bottom:"top",top:"bottom"},$N={start:"end",end:"start"};function gx(r,e,t){return Qs(r,oc(e,t))}function sl(r,e){return typeof r=="function"?r(e):r}function ol(r){return r.split("-")[0]}function kd(r){return r.split("-")[1]}function B0(r){return r==="x"?"y":"x"}function z0(r){return r==="y"?"height":"width"}function rl(r){return["top","bottom"].includes(ol(r))?"y":"x"}function U0(r){return B0(rl(r))}function HN(r,e,t){t===void 0&&(t=!1);const n=kd(r),s=U0(r),l=z0(s);let c=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[l]>e.floating[l]&&(c=N_(c)),[c,N_(c)]}function ZN(r){const e=N_(r);return[mx(r),e,mx(e)]}function mx(r){return r.replace(/start|end/g,e=>$N[e])}function XN(r,e,t){const n=["left","right"],s=["right","left"],l=["top","bottom"],c=["bottom","top"];switch(r){case"top":case"bottom":return t?e?s:n:e?n:s;case"left":case"right":return e?l:c;default:return[]}}function qN(r,e,t,n){const s=kd(r);let l=XN(ol(r),t==="start",n);return s&&(l=l.map(c=>c+"-"+s),e&&(l=l.concat(l.map(mx)))),l}function N_(r){return r.replace(/left|right|bottom|top/g,e=>WN[e])}function GN(r){return{top:0,right:0,bottom:0,left:0,...r}}function gP(r){return typeof r!="number"?GN(r):{top:r,right:r,bottom:r,left:r}}function L_(r){const{x:e,y:t,width:n,height:s}=r;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function c2(r,e,t){let{reference:n,floating:s}=r;const l=rl(e),c=U0(e),a=z0(c),g=ol(e),v=l==="y",w=n.x+n.width/2-s.width/2,P=n.y+n.height/2-s.height/2,I=n[a]/2-s[a]/2;let k;switch(g){case"top":k={x:w,y:n.y-s.height};break;case"bottom":k={x:w,y:n.y+n.height};break;case"right":k={x:n.x+n.width,y:P};break;case"left":k={x:n.x-s.width,y:P};break;default:k={x:n.x,y:n.y}}switch(kd(e)){case"start":k[c]-=I*(t&&v?-1:1);break;case"end":k[c]+=I*(t&&v?-1:1);break}return k}const YN=async(r,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:l=[],platform:c}=t,a=l.filter(Boolean),g=await(c.isRTL==null?void 0:c.isRTL(e));let v=await c.getElementRects({reference:r,floating:e,strategy:s}),{x:w,y:P}=c2(v,n,g),I=n,k={},N=0;for(let D=0;D<a.length;D++){const{name:B,fn:U}=a[D],{x:V,y:L,data:$,reset:te}=await U({x:w,y:P,initialPlacement:n,placement:I,strategy:s,middlewareData:k,rects:v,platform:c,elements:{reference:r,floating:e}});w=V??w,P=L??P,k={...k,[B]:{...k[B],...$}},te&&N<=50&&(N++,typeof te=="object"&&(te.placement&&(I=te.placement),te.rects&&(v=te.rects===!0?await c.getElementRects({reference:r,floating:e,strategy:s}):te.rects),{x:w,y:P}=c2(v,I,g)),D=-1)}return{x:w,y:P,placement:I,strategy:s,middlewareData:k}};async function Up(r,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:l,rects:c,elements:a,strategy:g}=r,{boundary:v="clippingAncestors",rootBoundary:w="viewport",elementContext:P="floating",altBoundary:I=!1,padding:k=0}=sl(e,r),N=gP(k),B=a[I?P==="floating"?"reference":"floating":P],U=L_(await l.getClippingRect({element:(t=await(l.isElement==null?void 0:l.isElement(B)))==null||t?B:B.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(a.floating)),boundary:v,rootBoundary:w,strategy:g})),V=P==="floating"?{x:n,y:s,width:c.floating.width,height:c.floating.height}:c.reference,L=await(l.getOffsetParent==null?void 0:l.getOffsetParent(a.floating)),$=await(l.isElement==null?void 0:l.isElement(L))?await(l.getScale==null?void 0:l.getScale(L))||{x:1,y:1}:{x:1,y:1},te=L_(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:V,offsetParent:L,strategy:g}):V);return{top:(U.top-te.top+N.top)/$.y,bottom:(te.bottom-U.bottom+N.bottom)/$.y,left:(U.left-te.left+N.left)/$.x,right:(te.right-U.right+N.right)/$.x}}const KN=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:s,rects:l,platform:c,elements:a,middlewareData:g}=e,{element:v,padding:w=0}=sl(r,e)||{};if(v==null)return{};const P=gP(w),I={x:t,y:n},k=U0(s),N=z0(k),D=await c.getDimensions(v),B=k==="y",U=B?"top":"left",V=B?"bottom":"right",L=B?"clientHeight":"clientWidth",$=l.reference[N]+l.reference[k]-I[k]-l.floating[N],te=I[k]-l.reference[k],G=await(c.getOffsetParent==null?void 0:c.getOffsetParent(v));let le=G?G[L]:0;(!le||!await(c.isElement==null?void 0:c.isElement(G)))&&(le=a.floating[L]||l.floating[N]);const se=$/2-te/2,oe=le/2-D[N]/2-1,be=oc(P[U],oe),xe=oc(P[V],oe),_e=be,Ne=le-D[N]-xe,fe=le/2-D[N]/2+se,Le=gx(_e,fe,Ne),tt=!g.arrow&&kd(s)!=null&&fe!==Le&&l.reference[N]/2-(fe<_e?be:xe)-D[N]/2<0,Ye=tt?fe<_e?fe-_e:fe-Ne:0;return{[k]:I[k]+Ye,data:{[k]:Le,centerOffset:fe-Le-Ye,...tt&&{alignmentOffset:Ye}},reset:tt}}}),QN=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:s,middlewareData:l,rects:c,initialPlacement:a,platform:g,elements:v}=e,{mainAxis:w=!0,crossAxis:P=!0,fallbackPlacements:I,fallbackStrategy:k="bestFit",fallbackAxisSideDirection:N="none",flipAlignment:D=!0,...B}=sl(r,e);if((t=l.arrow)!=null&&t.alignmentOffset)return{};const U=ol(s),V=rl(a),L=ol(a)===a,$=await(g.isRTL==null?void 0:g.isRTL(v.floating)),te=I||(L||!D?[N_(a)]:ZN(a)),G=N!=="none";!I&&G&&te.push(...qN(a,D,N,$));const le=[a,...te],se=await Up(e,B),oe=[];let be=((n=l.flip)==null?void 0:n.overflows)||[];if(w&&oe.push(se[U]),P){const Le=HN(s,c,$);oe.push(se[Le[0]],se[Le[1]])}if(be=[...be,{placement:s,overflows:oe}],!oe.every(Le=>Le<=0)){var xe,_e;const Le=(((xe=l.flip)==null?void 0:xe.index)||0)+1,tt=le[Le];if(tt){var Ne;const rt=P==="alignment"?V!==rl(tt):!1,it=((Ne=be[0])==null?void 0:Ne.overflows[0])>0;if(!rt||it)return{data:{index:Le,overflows:be},reset:{placement:tt}}}let Ye=(_e=be.filter(rt=>rt.overflows[0]<=0).sort((rt,it)=>rt.overflows[1]-it.overflows[1])[0])==null?void 0:_e.placement;if(!Ye)switch(k){case"bestFit":{var fe;const rt=(fe=be.filter(it=>{if(G){const Ct=rl(it.placement);return Ct===V||Ct==="y"}return!0}).map(it=>[it.placement,it.overflows.filter(Ct=>Ct>0).reduce((Ct,Mt)=>Ct+Mt,0)]).sort((it,Ct)=>it[1]-Ct[1])[0])==null?void 0:fe[0];rt&&(Ye=rt);break}case"initialPlacement":Ye=a;break}if(s!==Ye)return{reset:{placement:Ye}}}return{}}}};function u2(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function h2(r){return jN.some(e=>r[e]>=0)}const JN=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=sl(r,e);switch(n){case"referenceHidden":{const l=await Up(e,{...s,elementContext:"reference"}),c=u2(l,t.reference);return{data:{referenceHiddenOffsets:c,referenceHidden:h2(c)}}}case"escaped":{const l=await Up(e,{...s,altBoundary:!0}),c=u2(l,t.floating);return{data:{escapedOffsets:c,escaped:h2(c)}}}default:return{}}}}};async function eL(r,e){const{placement:t,platform:n,elements:s}=r,l=await(n.isRTL==null?void 0:n.isRTL(s.floating)),c=ol(t),a=kd(t),g=rl(t)==="y",v=["left","top"].includes(c)?-1:1,w=l&&g?-1:1,P=sl(e,r);let{mainAxis:I,crossAxis:k,alignmentAxis:N}=typeof P=="number"?{mainAxis:P,crossAxis:0,alignmentAxis:null}:{mainAxis:P.mainAxis||0,crossAxis:P.crossAxis||0,alignmentAxis:P.alignmentAxis};return a&&typeof N=="number"&&(k=a==="end"?N*-1:N),g?{x:k*w,y:I*v}:{x:I*v,y:k*w}}const tL=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:s,y:l,placement:c,middlewareData:a}=e,g=await eL(e,r);return c===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+g.x,y:l+g.y,data:{...g,placement:c}}}}},rL=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:l=!0,crossAxis:c=!1,limiter:a={fn:B=>{let{x:U,y:V}=B;return{x:U,y:V}}},...g}=sl(r,e),v={x:t,y:n},w=await Up(e,g),P=rl(ol(s)),I=B0(P);let k=v[I],N=v[P];if(l){const B=I==="y"?"top":"left",U=I==="y"?"bottom":"right",V=k+w[B],L=k-w[U];k=gx(V,k,L)}if(c){const B=P==="y"?"top":"left",U=P==="y"?"bottom":"right",V=N+w[B],L=N-w[U];N=gx(V,N,L)}const D=a.fn({...e,[I]:k,[P]:N});return{...D,data:{x:D.x-t,y:D.y-n,enabled:{[I]:l,[P]:c}}}}}},nL=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:s,rects:l,middlewareData:c}=e,{offset:a=0,mainAxis:g=!0,crossAxis:v=!0}=sl(r,e),w={x:t,y:n},P=rl(s),I=B0(P);let k=w[I],N=w[P];const D=sl(a,e),B=typeof D=="number"?{mainAxis:D,crossAxis:0}:{mainAxis:0,crossAxis:0,...D};if(g){const L=I==="y"?"height":"width",$=l.reference[I]-l.floating[L]+B.mainAxis,te=l.reference[I]+l.reference[L]-B.mainAxis;k<$?k=$:k>te&&(k=te)}if(v){var U,V;const L=I==="y"?"width":"height",$=["top","left"].includes(ol(s)),te=l.reference[P]-l.floating[L]+($&&((U=c.offset)==null?void 0:U[P])||0)+($?0:B.crossAxis),G=l.reference[P]+l.reference[L]+($?0:((V=c.offset)==null?void 0:V[P])||0)-($?B.crossAxis:0);N<te?N=te:N>G&&(N=G)}return{[I]:k,[P]:N}}}},iL=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:s,rects:l,platform:c,elements:a}=e,{apply:g=()=>{},...v}=sl(r,e),w=await Up(e,v),P=ol(s),I=kd(s),k=rl(s)==="y",{width:N,height:D}=l.floating;let B,U;P==="top"||P==="bottom"?(B=P,U=I===(await(c.isRTL==null?void 0:c.isRTL(a.floating))?"start":"end")?"left":"right"):(U=P,B=I==="end"?"top":"bottom");const V=D-w.top-w.bottom,L=N-w.left-w.right,$=oc(D-w[B],V),te=oc(N-w[U],L),G=!e.middlewareData.shift;let le=$,se=te;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(se=L),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(le=V),G&&!I){const be=Qs(w.left,0),xe=Qs(w.right,0),_e=Qs(w.top,0),Ne=Qs(w.bottom,0);k?se=N-2*(be!==0||xe!==0?be+xe:Qs(w.left,w.right)):le=D-2*(_e!==0||Ne!==0?_e+Ne:Qs(w.top,w.bottom))}await g({...e,availableWidth:se,availableHeight:le});const oe=await c.getDimensions(a.floating);return N!==oe.width||D!==oe.height?{reset:{rects:!0}}:{}}}};function vy(){return typeof window<"u"}function Dd(r){return mP(r)?(r.nodeName||"").toLowerCase():"#document"}function no(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function Ia(r){var e;return(e=(mP(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function mP(r){return vy()?r instanceof Node||r instanceof no(r).Node:!1}function Ho(r){return vy()?r instanceof Element||r instanceof no(r).Element:!1}function Aa(r){return vy()?r instanceof HTMLElement||r instanceof no(r).HTMLElement:!1}function d2(r){return!vy()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof no(r).ShadowRoot}function lg(r){const{overflow:e,overflowX:t,overflowY:n,display:s}=Zo(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(s)}function sL(r){return["table","td","th"].includes(Dd(r))}function by(r){return[":popover-open",":modal"].some(e=>{try{return r.matches(e)}catch{return!1}})}function V0(r){const e=j0(),t=Ho(r)?Zo(r):r;return["transform","translate","scale","rotate","perspective"].some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function oL(r){let e=ac(r);for(;Aa(e)&&!dd(e);){if(V0(e))return e;if(by(e))return null;e=ac(e)}return null}function j0(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function dd(r){return["html","body","#document"].includes(Dd(r))}function Zo(r){return no(r).getComputedStyle(r)}function xy(r){return Ho(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ac(r){if(Dd(r)==="html")return r;const e=r.assignedSlot||r.parentNode||d2(r)&&r.host||Ia(r);return d2(e)?e.host:e}function _P(r){const e=ac(r);return dd(e)?r.ownerDocument?r.ownerDocument.body:r.body:Aa(e)&&lg(e)?e:_P(e)}function Vp(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=_P(r),l=s===((n=r.ownerDocument)==null?void 0:n.body),c=no(s);if(l){const a=_x(c);return e.concat(c,c.visualViewport||[],lg(s)?s:[],a&&t?Vp(a):[])}return e.concat(s,Vp(s,[],t))}function _x(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function yP(r){const e=Zo(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=Aa(r),l=s?r.offsetWidth:t,c=s?r.offsetHeight:n,a=F_(t)!==l||F_(n)!==c;return a&&(t=l,n=c),{width:t,height:n,$:a}}function W0(r){return Ho(r)?r:r.contextElement}function id(r){const e=W0(r);if(!Aa(e))return Ta(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:l}=yP(e);let c=(l?F_(t.width):t.width)/n,a=(l?F_(t.height):t.height)/s;return(!c||!Number.isFinite(c))&&(c=1),(!a||!Number.isFinite(a))&&(a=1),{x:c,y:a}}const aL=Ta(0);function vP(r){const e=no(r);return!j0()||!e.visualViewport?aL:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function lL(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==no(r)?!1:e}function uu(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),l=W0(r);let c=Ta(1);e&&(n?Ho(n)&&(c=id(n)):c=id(r));const a=lL(l,t,n)?vP(l):Ta(0);let g=(s.left+a.x)/c.x,v=(s.top+a.y)/c.y,w=s.width/c.x,P=s.height/c.y;if(l){const I=no(l),k=n&&Ho(n)?no(n):n;let N=I,D=_x(N);for(;D&&n&&k!==N;){const B=id(D),U=D.getBoundingClientRect(),V=Zo(D),L=U.left+(D.clientLeft+parseFloat(V.paddingLeft))*B.x,$=U.top+(D.clientTop+parseFloat(V.paddingTop))*B.y;g*=B.x,v*=B.y,w*=B.x,P*=B.y,g+=L,v+=$,N=no(D),D=_x(N)}}return L_({width:w,height:P,x:g,y:v})}function $0(r,e){const t=xy(r).scrollLeft;return e?e.left+t:uu(Ia(r)).left+t}function bP(r,e,t){t===void 0&&(t=!1);const n=r.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:$0(r,n)),l=n.top+e.scrollTop;return{x:s,y:l}}function cL(r){let{elements:e,rect:t,offsetParent:n,strategy:s}=r;const l=s==="fixed",c=Ia(n),a=e?by(e.floating):!1;if(n===c||a&&l)return t;let g={scrollLeft:0,scrollTop:0},v=Ta(1);const w=Ta(0),P=Aa(n);if((P||!P&&!l)&&((Dd(n)!=="body"||lg(c))&&(g=xy(n)),Aa(n))){const k=uu(n);v=id(n),w.x=k.x+n.clientLeft,w.y=k.y+n.clientTop}const I=c&&!P&&!l?bP(c,g,!0):Ta(0);return{width:t.width*v.x,height:t.height*v.y,x:t.x*v.x-g.scrollLeft*v.x+w.x+I.x,y:t.y*v.y-g.scrollTop*v.y+w.y+I.y}}function uL(r){return Array.from(r.getClientRects())}function hL(r){const e=Ia(r),t=xy(r),n=r.ownerDocument.body,s=Qs(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),l=Qs(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let c=-t.scrollLeft+$0(r);const a=-t.scrollTop;return Zo(n).direction==="rtl"&&(c+=Qs(e.clientWidth,n.clientWidth)-s),{width:s,height:l,x:c,y:a}}function dL(r,e){const t=no(r),n=Ia(r),s=t.visualViewport;let l=n.clientWidth,c=n.clientHeight,a=0,g=0;if(s){l=s.width,c=s.height;const v=j0();(!v||v&&e==="fixed")&&(a=s.offsetLeft,g=s.offsetTop)}return{width:l,height:c,x:a,y:g}}function fL(r,e){const t=uu(r,!0,e==="fixed"),n=t.top+r.clientTop,s=t.left+r.clientLeft,l=Aa(r)?id(r):Ta(1),c=r.clientWidth*l.x,a=r.clientHeight*l.y,g=s*l.x,v=n*l.y;return{width:c,height:a,x:g,y:v}}function f2(r,e,t){let n;if(e==="viewport")n=dL(r,t);else if(e==="document")n=hL(Ia(r));else if(Ho(e))n=fL(e,t);else{const s=vP(r);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return L_(n)}function xP(r,e){const t=ac(r);return t===e||!Ho(t)||dd(t)?!1:Zo(t).position==="fixed"||xP(t,e)}function pL(r,e){const t=e.get(r);if(t)return t;let n=Vp(r,[],!1).filter(a=>Ho(a)&&Dd(a)!=="body"),s=null;const l=Zo(r).position==="fixed";let c=l?ac(r):r;for(;Ho(c)&&!dd(c);){const a=Zo(c),g=V0(c);!g&&a.position==="fixed"&&(s=null),(l?!g&&!s:!g&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||lg(c)&&!g&&xP(r,c))?n=n.filter(w=>w!==c):s=a,c=ac(c)}return e.set(r,n),n}function gL(r){let{element:e,boundary:t,rootBoundary:n,strategy:s}=r;const c=[...t==="clippingAncestors"?by(e)?[]:pL(e,this._c):[].concat(t),n],a=c[0],g=c.reduce((v,w)=>{const P=f2(e,w,s);return v.top=Qs(P.top,v.top),v.right=oc(P.right,v.right),v.bottom=oc(P.bottom,v.bottom),v.left=Qs(P.left,v.left),v},f2(e,a,s));return{width:g.right-g.left,height:g.bottom-g.top,x:g.left,y:g.top}}function mL(r){const{width:e,height:t}=yP(r);return{width:e,height:t}}function _L(r,e,t){const n=Aa(e),s=Ia(e),l=t==="fixed",c=uu(r,!0,l,e);let a={scrollLeft:0,scrollTop:0};const g=Ta(0);function v(){g.x=$0(s)}if(n||!n&&!l)if((Dd(e)!=="body"||lg(s))&&(a=xy(e)),n){const k=uu(e,!0,l,e);g.x=k.x+e.clientLeft,g.y=k.y+e.clientTop}else s&&v();l&&!n&&s&&v();const w=s&&!n&&!l?bP(s,a):Ta(0),P=c.left+a.scrollLeft-g.x-w.x,I=c.top+a.scrollTop-g.y-w.y;return{x:P,y:I,width:c.width,height:c.height}}function eb(r){return Zo(r).position==="static"}function p2(r,e){if(!Aa(r)||Zo(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return Ia(r)===t&&(t=t.ownerDocument.body),t}function wP(r,e){const t=no(r);if(by(r))return t;if(!Aa(r)){let s=ac(r);for(;s&&!dd(s);){if(Ho(s)&&!eb(s))return s;s=ac(s)}return t}let n=p2(r,e);for(;n&&sL(n)&&eb(n);)n=p2(n,e);return n&&dd(n)&&eb(n)&&!V0(n)?t:n||oL(r)||t}const yL=async function(r){const e=this.getOffsetParent||wP,t=this.getDimensions,n=await t(r.floating);return{reference:_L(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function vL(r){return Zo(r).direction==="rtl"}const bL={convertOffsetParentRelativeRectToViewportRelativeRect:cL,getDocumentElement:Ia,getClippingRect:gL,getOffsetParent:wP,getElementRects:yL,getClientRects:uL,getDimensions:mL,getScale:id,isElement:Ho,isRTL:vL};function TP(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function xL(r,e){let t=null,n;const s=Ia(r);function l(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function c(a,g){a===void 0&&(a=!1),g===void 0&&(g=1),l();const v=r.getBoundingClientRect(),{left:w,top:P,width:I,height:k}=v;if(a||e(),!I||!k)return;const N=zm(P),D=zm(s.clientWidth-(w+I)),B=zm(s.clientHeight-(P+k)),U=zm(w),L={rootMargin:-N+"px "+-D+"px "+-B+"px "+-U+"px",threshold:Qs(0,oc(1,g))||1};let $=!0;function te(G){const le=G[0].intersectionRatio;if(le!==g){if(!$)return c();le?c(!1,le):n=setTimeout(()=>{c(!1,1e-7)},1e3)}le===1&&!TP(v,r.getBoundingClientRect())&&c(),$=!1}try{t=new IntersectionObserver(te,{...L,root:s.ownerDocument})}catch{t=new IntersectionObserver(te,L)}t.observe(r)}return c(!0),l}function wL(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:l=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:g=!1}=n,v=W0(r),w=s||l?[...v?Vp(v):[],...Vp(e)]:[];w.forEach(U=>{s&&U.addEventListener("scroll",t,{passive:!0}),l&&U.addEventListener("resize",t)});const P=v&&a?xL(v,t):null;let I=-1,k=null;c&&(k=new ResizeObserver(U=>{let[V]=U;V&&V.target===v&&k&&(k.unobserve(e),cancelAnimationFrame(I),I=requestAnimationFrame(()=>{var L;(L=k)==null||L.observe(e)})),t()}),v&&!g&&k.observe(v),k.observe(e));let N,D=g?uu(r):null;g&&B();function B(){const U=uu(r);D&&!TP(D,U)&&t(),D=U,N=requestAnimationFrame(B)}return t(),()=>{var U;w.forEach(V=>{s&&V.removeEventListener("scroll",t),l&&V.removeEventListener("resize",t)}),P?.(),(U=k)==null||U.disconnect(),k=null,g&&cancelAnimationFrame(N)}}const TL=tL,SL=rL,AL=QN,EL=iL,PL=JN,IL=KN,CL=nL,RL=(r,e,t)=>{const n=new Map,s={platform:bL,...t},l={...s.platform,_c:n};return YN(r,e,{...s,platform:l})};function Gf(r){return typeof r=="function"?r():r}function SP(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function g2(r,e){const t=SP(r);return Math.round(e*t)/t}function ML(r){const e=r.whileElementsMounted,t=me(()=>Gf(r.open)??!0),n=me(()=>Gf(r.middleware)),s=me(()=>Gf(r.transform)??!0),l=me(()=>Gf(r.placement)??"bottom"),c=me(()=>Gf(r.strategy)??"absolute"),a=r.reference;let g=wt(0),v=wt(0);const w=Ke(null);let P=wt(tn(S(c))),I=wt(tn(S(l))),k=wt(tn({})),N=wt(!1);const D=me(()=>{const te={position:S(P),left:"0",top:"0"};if(!w.current)return te;const G=g2(w.current,S(g)),le=g2(w.current,S(v));return S(s)?{...te,transform:`translate(${G}px, ${le}px)`,...SP(w.current)>=1.5&&{willChange:"transform"}}:{position:S(P),left:`${G}px`,top:`${le}px`}});let B;function U(){a.current===null||w.current===null||RL(a.current,w.current,{middleware:S(n),placement:S(l),strategy:S(c)}).then(te=>{pe(g,te.x,!0),pe(v,te.y,!0),pe(P,te.strategy,!0),pe(I,te.placement,!0),pe(k,te.middlewareData,!0),pe(N,!0)})}function V(){typeof B=="function"&&(B(),B=void 0)}function L(){if(V(),e===void 0){U();return}a.current===null||w.current===null||(B=e(a.current,w.current,U))}function $(){S(t)||pe(N,!1)}return kr(U),kr(L),kr($),kr(()=>V),{floating:w,reference:a,get strategy(){return S(P)},get placement(){return S(I)},get middlewareData(){return S(k)},get isPositioned(){return S(N)},get floatingStyles(){return S(D)},get update(){return U}}}const kL={top:"bottom",right:"left",bottom:"top",left:"right"};class DL{anchorNode=Ke(null);customAnchorNode=Ke(null);triggerNode=Ke(null);constructor(){kr(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}class OL{opts;root;contentRef=Ke(null);wrapperRef=Ke(null);arrowRef=Ke(null);arrowId=Ke(Wn());#t=me(()=>{if(typeof this.opts.style=="string")return lp(this.opts.style);if(!this.opts.style)return{}});#e=void 0;#r=new XO(()=>this.arrowRef.current??void 0);#n=me(()=>this.#r?.width??0);#i=me(()=>this.#r?.height??0);#s=me(()=>this.opts.side?.current+(this.opts.align.current!=="center"?`-${this.opts.align.current}`:""));#o=me(()=>Array.isArray(this.opts.collisionBoundary.current)?this.opts.collisionBoundary.current:[this.opts.collisionBoundary.current]);#a=me(()=>S(this.#o).length>0);get hasExplicitBoundaries(){return S(this.#a)}set hasExplicitBoundaries(e){pe(this.#a,e)}#l=me(()=>({padding:this.opts.collisionPadding.current,boundary:S(this.#o).filter(TF),altBoundary:this.hasExplicitBoundaries}));get detectOverflowOptions(){return S(this.#l)}set detectOverflowOptions(e){pe(this.#l,e)}#c=wt(void 0);#p=wt(void 0);#d=wt(void 0);#u=wt(void 0);#h=me(()=>[TL({mainAxis:this.opts.sideOffset.current+S(this.#i),alignmentAxis:this.opts.alignOffset.current}),this.opts.avoidCollisions.current&&SL({mainAxis:!0,crossAxis:!1,limiter:this.opts.sticky.current==="partial"?CL():void 0,...this.detectOverflowOptions}),this.opts.avoidCollisions.current&&AL({...this.detectOverflowOptions}),EL({...this.detectOverflowOptions,apply:({rects:e,availableWidth:t,availableHeight:n})=>{const{width:s,height:l}=e.reference;pe(this.#c,t,!0),pe(this.#p,n,!0),pe(this.#d,s,!0),pe(this.#u,l,!0)}}),this.arrowRef.current&&IL({element:this.arrowRef.current,padding:this.opts.arrowPadding.current}),UL({arrowWidth:S(this.#n),arrowHeight:S(this.#i)}),this.opts.hideWhenDetached.current&&PL({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean));get middleware(){return S(this.#h)}set middleware(e){pe(this.#h,e)}floating;#g=me(()=>VL(this.floating.placement));get placedSide(){return S(this.#g)}set placedSide(e){pe(this.#g,e)}#f=me(()=>jL(this.floating.placement));get placedAlign(){return S(this.#f)}set placedAlign(e){pe(this.#f,e)}#_=me(()=>this.floating.middlewareData.arrow?.x??0);get arrowX(){return S(this.#_)}set arrowX(e){pe(this.#_,e)}#m=me(()=>this.floating.middlewareData.arrow?.y??0);get arrowY(){return S(this.#m)}set arrowY(e){pe(this.#m,e)}#y=me(()=>this.floating.middlewareData.arrow?.centerOffset!==0);get cannotCenterArrow(){return S(this.#y)}set cannotCenterArrow(e){pe(this.#y,e)}#v=wt();get contentZIndex(){return S(this.#v)}set contentZIndex(e){pe(this.#v,e,!0)}#b=me(()=>kL[this.placedSide]);get arrowBaseSide(){return S(this.#b)}set arrowBaseSide(e){pe(this.#b,e)}#x=me(()=>({id:this.opts.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${this.floating.middlewareData.transformOrigin?.x} ${this.floating.middlewareData.transformOrigin?.y}`,"--bits-floating-available-width":`${S(this.#c)}px`,"--bits-floating-available-height":`${S(this.#p)}px`,"--bits-floating-anchor-width":`${S(this.#d)}px`,"--bits-floating-anchor-height":`${S(this.#u)}px`,...this.floating.middlewareData.hide?.referenceHidden&&{visibility:"hidden","pointer-events":"none"},...S(this.#t)},dir:this.opts.dir.current}));get wrapperProps(){return S(this.#x)}set wrapperProps(e){pe(this.#x,e)}#w=me(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:A0({...S(this.#t)})}));get props(){return S(this.#w)}set props(e){pe(this.#w,e)}#T=me(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0}));get arrowStyle(){return S(this.#T)}set arrowStyle(e){pe(this.#T,e)}constructor(e,t){this.opts=e,this.root=t,e.customAnchor&&(this.root.customAnchorNode.current=e.customAnchor.current),Rn(()=>e.customAnchor.current,n=>{this.root.customAnchorNode.current=n}),zn({id:this.opts.wrapperId,ref:this.wrapperRef,deps:()=>this.opts.enabled.current}),zn({id:this.opts.id,ref:this.contentRef,deps:()=>this.opts.enabled.current}),this.floating=ML({strategy:()=>this.opts.strategy.current,placement:()=>S(this.#s),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...n)=>wL(...n,{animationFrame:this.#e?.current==="always"}),open:()=>this.opts.enabled.current}),kr(()=>{this.floating.isPositioned&&this.opts.onPlaced?.current()}),Rn(()=>this.contentRef.current,n=>{n&&(this.contentZIndex=window.getComputedStyle(n).zIndex)}),kr(()=>{this.floating.floating.current=this.wrapperRef.current})}}class FL{opts;root;ref=Ke(null);constructor(e,t){this.opts=e,this.root=t,e.virtualEl&&e.virtualEl.current?t.triggerNode=Ke.from(e.virtualEl.current):zn({id:e.id,ref:this.ref,onRefChange:n=>{t.triggerNode.current=n}})}}const H0=new Pa("Floating.Root"),NL=new Pa("Floating.Content");function LL(){return H0.set(new DL)}function BL(r){return NL.set(new OL(r,H0.get()))}function zL(r){return new FL(r,H0.get())}function UL(r){return{name:"transformOrigin",options:r,fn(e){const{placement:t,rects:n,middlewareData:s}=e,c=s.arrow?.centerOffset!==0,a=c?0:r.arrowWidth,g=c?0:r.arrowHeight,[v,w]=Z0(t),P={start:"0%",center:"50%",end:"100%"}[w],I=(s.arrow?.x??0)+a/2,k=(s.arrow?.y??0)+g/2;let N="",D="";return v==="bottom"?(N=c?P:`${I}px`,D=`${-g}px`):v==="top"?(N=c?P:`${I}px`,D=`${n.floating.height+g}px`):v==="right"?(N=`${-g}px`,D=c?P:`${k}px`):v==="left"&&(N=`${n.floating.width+g}px`,D=c?P:`${k}px`),{data:{x:N,y:D}}}}}function Z0(r){const[e,t="center"]=r.split("-");return[e,t]}function VL(r){return Z0(r)[0]}function jL(r){return Z0(r)[1]}function AP(r,e){Tt(e,!0),LL();var t=We(),n=ue(t);Ot(n,()=>e.children??Ht),Z(r,t),St()}function EP(r,e=1e4,t=In){let n=null,s=wt(tn(r));function l(){return window.setTimeout(()=>{pe(s,r,!0),t(r)},e)}return kr(()=>()=>{n&&clearTimeout(n)}),Ke.with(()=>S(s),c=>{pe(s,c,!0),t(c),n&&clearTimeout(n),n=l()})}function WL(r){const e=EP("",1e3),t=r?.onMatch??(c=>c.focus()),n=r?.getCurrentItem??(()=>document.activeElement);function s(c,a){if(!a.length)return;e.current=e.current+c;const g=n(),v=a.find(k=>k===g)?.textContent?.trim()??"",w=a.map(k=>k.textContent?.trim()??""),P=N0(w,e.current,v),I=a.find(k=>k.textContent?.trim()===P);return I&&t(I),I}function l(){e.current=""}return{search:e,handleTypeaheadSearch:s,resetTypeahead:l}}function $L(r){const e=EP("",1e3),t=me(()=>r.candidateValues());function n(l){if(!r.enabled||!S(t).length)return;e.current=e.current+l;const c=r.getCurrentItem(),a=S(t).find(P=>P===c)??"",g=S(t).map(P=>P??""),v=N0(g,e.current,a),w=S(t).find(P=>P===v);return w&&r.onMatch(w),w}function s(){e.current=""}return{search:e,handleTypeaheadSearch:n,resetTypeahead:s}}const m2=[Pd,R0,Id,mF,tF,rF,JO,gF,sc,nF,aF,lF,cF,uF,hF,dF,fF,pF,iF,sF,oF],HL=[to,k0,Rd],ZL=[Rs,M0,Cd],PP=[...HL,...ZL];class IP{opts;#t=wt(!1);get touchedInput(){return S(this.#t)}set touchedInput(e){pe(this.#t,e,!0)}#e=wt("");get inputValue(){return S(this.#e)}set inputValue(e){pe(this.#e,e,!0)}#r=wt(null);get inputNode(){return S(this.#r)}set inputNode(e){pe(this.#r,e,!0)}#n=wt(null);get contentNode(){return S(this.#n)}set contentNode(e){pe(this.#n,e,!0)}#i=wt(null);get triggerNode(){return S(this.#i)}set triggerNode(e){pe(this.#i,e,!0)}#s=wt("");get valueId(){return S(this.#s)}set valueId(e){pe(this.#s,e,!0)}#o=wt(null);get highlightedNode(){return S(this.#o)}set highlightedNode(e){pe(this.#o,e,!0)}#a=me(()=>this.highlightedNode?this.highlightedNode.getAttribute("data-value"):null);get highlightedValue(){return S(this.#a)}set highlightedValue(e){pe(this.#a,e)}#l=me(()=>{if(this.highlightedNode)return this.highlightedNode.id});get highlightedId(){return S(this.#l)}set highlightedId(e){pe(this.#l,e)}#c=me(()=>this.highlightedNode?this.highlightedNode.getAttribute("data-label"):null);get highlightedLabel(){return S(this.#c)}set highlightedLabel(e){pe(this.#c,e)}isUsingKeyboard=!1;isCombobox=!1;bitsAttrs;constructor(e){this.opts=e,this.isCombobox=e.isCombobox,this.bitsAttrs=d4(this),g0(()=>{this.opts.open.current||this.setHighlightedNode(null)})}setHighlightedNode(e,t=!1){this.highlightedNode=e,e&&(this.isUsingKeyboard||t)&&e.scrollIntoView({block:this.opts.scrollAlignment.current})}getCandidateNodes(){const e=this.contentNode;return e?Array.from(e.querySelectorAll(`[${this.bitsAttrs.item}]:not([data-disabled])`)):[]}setHighlightedToFirstCandidate(){this.setHighlightedNode(null);const e=this.getCandidateNodes();e.length&&this.setHighlightedNode(e[0])}getNodeByValue(e){return this.getCandidateNodes().find(n=>n.dataset.value===e)??null}setOpen(e){this.opts.open.current=e}toggleOpen(){this.opts.open.current=!this.opts.open.current}handleOpen(){this.setOpen(!0)}handleClose(){this.setHighlightedNode(null),this.setOpen(!1)}toggleMenu(){this.toggleOpen()}}class XL extends IP{opts;isMulti=!1;#t=me(()=>this.opts.value.current!=="");get hasValue(){return S(this.#t)}set hasValue(e){pe(this.#t,e)}#e=me(()=>this.opts.items.current.length?this.opts.items.current.find(t=>t.value===this.opts.value.current)?.label??"":"");get currentLabel(){return S(this.#e)}set currentLabel(e){pe(this.#e,e)}#r=me(()=>this.opts.items.current.length?this.opts.items.current.filter(t=>!t.disabled).map(t=>t.label):[]);get candidateLabels(){return S(this.#r)}set candidateLabels(e){pe(this.#r,e)}#n=me(()=>!(this.isMulti||this.opts.items.current.length===0));get dataTypeaheadEnabled(){return S(this.#n)}set dataTypeaheadEnabled(e){pe(this.#n,e)}constructor(e){super(e),this.opts=e,kr(()=>{!this.opts.open.current&&this.highlightedNode&&this.setHighlightedNode(null)}),Rn(()=>this.opts.open.current,()=>{this.opts.open.current&&this.setInitialHighlightedNode()})}includesItem(e){return this.opts.value.current===e}toggleItem(e,t=e){this.opts.value.current=this.includesItem(e)?"":e,this.inputValue=t}setInitialHighlightedNode(){Ed(()=>{if(this.highlightedNode&&document.contains(this.highlightedNode))return;if(this.opts.value.current!==""){const t=this.getNodeByValue(this.opts.value.current);if(t){this.setHighlightedNode(t,!0);return}}const e=this.getCandidateNodes()[0];e&&this.setHighlightedNode(e,!0)})}}class qL extends IP{opts;isMulti=!0;#t=me(()=>this.opts.value.current.length>0);get hasValue(){return S(this.#t)}set hasValue(e){pe(this.#t,e)}constructor(e){super(e),this.opts=e,kr(()=>{!this.opts.open.current&&this.highlightedNode&&this.setHighlightedNode(null)}),Rn(()=>this.opts.open.current,()=>{this.opts.open.current&&this.setInitialHighlightedNode()})}includesItem(e){return this.opts.value.current.includes(e)}toggleItem(e,t=e){this.includesItem(e)?this.opts.value.current=this.opts.value.current.filter(n=>n!==e):this.opts.value.current=[...this.opts.value.current,e],this.inputValue=t}setInitialHighlightedNode(){Ed(()=>{if(this.highlightedNode&&document.contains(this.highlightedNode))return;if(this.opts.value.current.length&&this.opts.value.current[0]!==""){const t=this.getNodeByValue(this.opts.value.current[0]);if(t){this.setHighlightedNode(t,!0);return}}const e=this.getCandidateNodes()[0];e&&this.setHighlightedNode(e,!0)})}}class GL{opts;root;constructor(e,t){this.opts=e,this.root=t,zn({...e,onRefChange:n=>{this.root.inputNode=n}}),this.onkeydown=this.onkeydown.bind(this),this.oninput=this.oninput.bind(this),Rn([()=>this.root.opts.value.current,()=>this.opts.clearOnDeselect.current],([n,s],[l])=>{s&&(Array.isArray(n)&&Array.isArray(l)?n.length===0&&l.length!==0&&(this.root.inputValue=""):n===""&&l!==""&&(this.root.inputValue=""))})}onkeydown(e){if(this.root.isUsingKeyboard=!0,e.key!==R0){if((e.key===Rs||e.key===to)&&e.preventDefault(),!this.root.opts.open.current){if(m2.includes(e.key)||e.key===zp||e.key===eF&&this.root.inputValue===""||(this.root.handleOpen(),this.root.hasValue))return;const t=this.root.getCandidateNodes();if(!t.length)return;if(e.key===to){const n=t[0];this.root.setHighlightedNode(n)}else if(e.key===Rs){const n=t[t.length-1];this.root.setHighlightedNode(n)}return}if(e.key===zp){this.root.handleClose();return}if(e.key===sc&&!e.isComposing){e.preventDefault();const t=this.root.highlightedValue===this.root.opts.value.current;if(!this.root.opts.allowDeselect.current&&t&&!this.root.isMulti){this.root.handleClose();return}this.root.highlightedValue&&this.root.toggleItem(this.root.highlightedValue,this.root.highlightedLabel??void 0),!this.root.isMulti&&!t&&this.root.handleClose()}if(e.key===Rs&&e.altKey&&this.root.handleClose(),PP.includes(e.key)){e.preventDefault();const t=this.root.getCandidateNodes(),n=this.root.highlightedNode,s=n?t.indexOf(n):-1,l=this.root.opts.loop.current;let c;if(e.key===to?c=hP(t,s,l):e.key===Rs?c=dP(t,s,l):e.key===M0?c=fP(t,s,10,l):e.key===k0?c=pP(t,s,10,l):e.key===Rd?c=t[0]:e.key===Cd&&(c=t[t.length-1]),!c)return;this.root.setHighlightedNode(c);return}m2.includes(e.key)||this.root.highlightedNode||this.root.setHighlightedToFirstCandidate()}}oninput(e){this.root.inputValue=e.currentTarget.value,this.root.setHighlightedToFirstCandidate()}#t=me(()=>({id:this.opts.id.current,role:"combobox",disabled:this.root.opts.disabled.current?!0:void 0,"aria-activedescendant":this.root.highlightedId,"aria-autocomplete":"list","aria-expanded":I0(this.root.opts.open.current),"data-state":_y(this.root.opts.open.current),"data-disabled":Ao(this.root.opts.disabled.current),onkeydown:this.onkeydown,oninput:this.oninput,[this.root.bitsAttrs.input]:""}));get props(){return S(this.#t)}set props(e){pe(this.#t,e)}}class YL{opts;root;#t;#e;constructor(e,t){this.opts=e,this.root=t,zn({...e,onRefChange:n=>{this.root.triggerNode=n}}),this.#t=WL({getCurrentItem:()=>this.root.highlightedNode,onMatch:n=>{this.root.setHighlightedNode(n)}}),this.#e=$L({getCurrentItem:()=>this.root.isMulti?"":this.root.currentLabel,onMatch:n=>{if(this.root.isMulti||!this.root.opts.items.current)return;const s=this.root.opts.items.current.find(l=>l.label===n);s&&(this.root.opts.value.current=s.value)},enabled:!this.root.isMulti&&this.root.dataTypeaheadEnabled,candidateValues:()=>this.root.isMulti?[]:this.root.candidateLabels}),this.onkeydown=this.onkeydown.bind(this),this.onpointerdown=this.onpointerdown.bind(this),this.onpointerup=this.onpointerup.bind(this),this.onclick=this.onclick.bind(this)}#r(){this.root.opts.open.current=!0,this.#e.resetTypeahead(),this.#t.resetTypeahead()}#n(e){this.#r()}#i(){const e=this.root.highlightedValue===this.root.opts.value.current;return!this.root.opts.allowDeselect.current&&e&&!this.root.isMulti?(this.root.handleClose(),!0):(this.root.highlightedValue!==null&&this.root.toggleItem(this.root.highlightedValue,this.root.highlightedLabel??void 0),!this.root.isMulti&&!e?(this.root.handleClose(),!0):!1)}onkeydown(e){if(this.root.isUsingKeyboard=!0,(e.key===Rs||e.key===to)&&e.preventDefault(),!this.root.opts.open.current){if(e.key===sc||e.key===nc||e.key===to||e.key===Rs)e.preventDefault(),this.root.handleOpen();else if(!this.root.isMulti&&this.root.dataTypeaheadEnabled){this.#e.handleTypeaheadSearch(e.key);return}if(this.root.hasValue)return;const c=this.root.getCandidateNodes();if(!c.length)return;if(e.key===to){const a=c[0];this.root.setHighlightedNode(a)}else if(e.key===Rs){const a=c[c.length-1];this.root.setHighlightedNode(a)}return}if(e.key===zp){this.root.handleClose();return}if((e.key===sc||e.key===nc&&this.#t.search.current==="")&&!e.isComposing&&(e.preventDefault(),this.#i()))return;if(e.key===Rs&&e.altKey&&this.root.handleClose(),PP.includes(e.key)){e.preventDefault();const c=this.root.getCandidateNodes(),a=this.root.highlightedNode,g=a?c.indexOf(a):-1,v=this.root.opts.loop.current;let w;if(e.key===to?w=hP(c,g,v):e.key===Rs?w=dP(c,g,v):e.key===M0?w=fP(c,g,10,v):e.key===k0?w=pP(c,g,10,v):e.key===Rd?w=c[0]:e.key===Cd&&(w=c[c.length-1]),!w)return;this.root.setHighlightedNode(w);return}const t=e.ctrlKey||e.altKey||e.metaKey,n=e.key.length===1,s=e.key===nc,l=this.root.getCandidateNodes();if(e.key!==zp){if(!t&&(n||s)){!this.#t.handleTypeaheadSearch(e.key,l)&&s&&(e.preventDefault(),this.#i());return}this.root.highlightedNode||this.root.setHighlightedToFirstCandidate()}}onclick(e){e.currentTarget.focus()}onpointerdown(e){if(this.root.opts.disabled.current)return;if(e.pointerType==="touch")return e.preventDefault();const t=e.target;t?.hasPointerCapture(e.pointerId)&&t?.releasePointerCapture(e.pointerId),e.button===0&&e.ctrlKey===!1&&(this.root.opts.open.current===!1?this.#n(e):this.root.handleClose())}onpointerup(e){e.preventDefault(),e.pointerType==="touch"&&(this.root.opts.open.current===!1?this.#n(e):this.root.handleClose())}#s=me(()=>({id:this.opts.id.current,disabled:this.root.opts.disabled.current?!0:void 0,"aria-haspopup":"listbox","aria-expanded":I0(this.root.opts.open.current),"aria-activedescendant":this.root.highlightedId,"data-state":_y(this.root.opts.open.current),"data-disabled":Ao(this.root.opts.disabled.current),"data-placeholder":this.root.hasValue?void 0:"",[this.root.bitsAttrs.trigger]:"",onpointerdown:this.onpointerdown,onkeydown:this.onkeydown,onclick:this.onclick,onpointerup:this.onpointerup}));get props(){return S(this.#s)}set props(e){pe(this.#s,e)}}class KL{opts;root;#t=wt(null);get viewportNode(){return S(this.#t)}set viewportNode(e){pe(this.#t,e,!0)}#e=wt(!1);get isPositioned(){return S(this.#e)}set isPositioned(e){pe(this.#e,e,!0)}constructor(e,t){this.opts=e,this.root=t,zn({...e,onRefChange:n=>{this.root.contentNode=n},deps:()=>this.root.opts.open.current}),E0(()=>{this.root.contentNode=null,this.isPositioned=!1}),Rn(()=>this.root.opts.open.current,()=>{this.root.opts.open.current||(this.isPositioned=!1)}),this.onpointermove=this.onpointermove.bind(this)}onpointermove(e){this.root.isUsingKeyboard=!1}#r=me(()=>{const e=this.root.isCombobox?"--bits-combobox":"--bits-select";return{[`${e}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`${e}-content-available-width`]:"var(--bits-floating-available-width)",[`${e}-content-available-height`]:"var(--bits-floating-available-height)",[`${e}-anchor-width`]:" var(--bits-floating-anchor-width)",[`${e}-anchor-height`]:"var(--bits-floating-anchor-height)"}});onInteractOutside=e=>{if(e.target===this.root.triggerNode||e.target===this.root.inputNode){e.preventDefault();return}this.opts.onInteractOutside.current(e),!e.defaultPrevented&&this.root.handleClose()};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current(e),!e.defaultPrevented&&this.root.handleClose()};onOpenAutoFocus=e=>{e.preventDefault()};onCloseAutoFocus=e=>{e.preventDefault()};#n=me(()=>({open:this.root.opts.open.current}));get snippetProps(){return S(this.#n)}set snippetProps(e){pe(this.#n,e)}#i=me(()=>({id:this.opts.id.current,role:"listbox","aria-multiselectable":this.root.isMulti?"true":void 0,"data-state":_y(this.root.opts.open.current),[this.root.bitsAttrs.content]:"",style:{display:"flex",flexDirection:"column",outline:"none",boxSizing:"border-box",pointerEvents:"auto",...S(this.#r)},onpointermove:this.onpointermove}));get props(){return S(this.#i)}set props(e){pe(this.#i,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown,onOpenAutoFocus:this.onOpenAutoFocus,onCloseAutoFocus:this.onCloseAutoFocus,trapFocus:!1,loop:!1,onPlaced:()=>{this.root.opts.open.current&&(this.isPositioned=!0)}}}class QL{opts;root;#t=me(()=>this.root.includesItem(this.opts.value.current));get isSelected(){return S(this.#t)}set isSelected(e){pe(this.#t,e)}#e=me(()=>this.root.highlightedValue===this.opts.value.current);get isHighlighted(){return S(this.#e)}set isHighlighted(e){pe(this.#e,e)}prevHighlighted=new qE(()=>this.isHighlighted);#r=wt(!1);get mounted(){return S(this.#r)}set mounted(e){pe(this.#r,e,!0)}constructor(e,t){this.opts=e,this.root=t,zn({...e,deps:()=>this.mounted}),Rn([()=>this.isHighlighted,()=>this.prevHighlighted.current],()=>{this.isHighlighted?this.opts.onHighlight.current():this.prevHighlighted.current&&this.opts.onUnhighlight.current()}),Rn(()=>this.mounted,()=>{this.mounted&&this.root.setInitialHighlightedNode()}),this.onpointerdown=this.onpointerdown.bind(this),this.onpointerup=this.onpointerup.bind(this),this.onpointermove=this.onpointermove.bind(this)}handleSelect(){if(this.opts.disabled.current)return;const e=this.opts.value.current===this.root.opts.value.current;if(!this.root.opts.allowDeselect.current&&e&&!this.root.isMulti){this.root.handleClose();return}this.root.toggleItem(this.opts.value.current,this.opts.label.current),!this.root.isMulti&&!e&&this.root.handleClose()}#n=me(()=>({selected:this.isSelected,highlighted:this.isHighlighted}));get snippetProps(){return S(this.#n)}set snippetProps(e){pe(this.#n,e)}onpointerdown(e){e.preventDefault()}onpointerup(e){if(!(e.defaultPrevented||!this.opts.ref.current)){if(e.pointerType==="touch"&&!fx){li(this.opts.ref.current,"click",()=>{this.handleSelect(),this.root.setHighlightedNode(this.opts.ref.current)},{once:!0});return}e.preventDefault(),this.handleSelect(),e.pointerType==="touch"&&this.root.setHighlightedNode(this.opts.ref.current)}}onpointermove(e){e.pointerType!=="touch"&&this.root.highlightedNode!==this.opts.ref.current&&this.root.setHighlightedNode(this.opts.ref.current)}#i=me(()=>({id:this.opts.id.current,role:"option","aria-selected":this.root.includesItem(this.opts.value.current)?"true":void 0,"data-value":this.opts.value.current,"data-disabled":Ao(this.opts.disabled.current),"data-highlighted":this.root.highlightedValue===this.opts.value.current&&!this.opts.disabled.current?"":void 0,"data-selected":this.root.includesItem(this.opts.value.current)?"":void 0,"data-label":this.opts.label.current,[this.root.bitsAttrs.item]:"",onpointermove:this.onpointermove,onpointerdown:this.onpointerdown,onpointerup:this.onpointerup}));get props(){return S(this.#i)}set props(e){pe(this.#i,e)}}class JL{opts;root;#t=me(()=>this.root.opts.name.current!=="");get shouldRender(){return S(this.#t)}set shouldRender(e){pe(this.#t,e)}constructor(e,t){this.opts=e,this.root=t,this.onfocus=this.onfocus.bind(this)}onfocus(e){e.preventDefault(),this.root.isCombobox?this.root.inputNode?.focus():this.root.triggerNode?.focus()}#e=me(()=>({disabled:C0(this.root.opts.disabled.current),required:QO(this.root.opts.required.current),name:this.root.opts.name.current,value:this.opts.value.current,onfocus:this.onfocus}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class e4{opts;content;root;#t=wt(0);get prevScrollTop(){return S(this.#t)}set prevScrollTop(e){pe(this.#t,e,!0)}constructor(e,t){this.opts=e,this.content=t,this.root=t.root,zn({...e,onRefChange:n=>{this.content.viewportNode=n},deps:()=>this.root.opts.open.current})}#e=me(()=>({id:this.opts.id.current,role:"presentation",[this.root.bitsAttrs.viewport]:"",style:{position:"relative",flex:1,overflow:"auto"}}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class CP{opts;content;root;autoScrollTimer=null;userScrollTimer=-1;isUserScrolling=!1;onAutoScroll=In;#t=wt(!1);get mounted(){return S(this.#t)}set mounted(e){pe(this.#t,e,!0)}constructor(e,t){this.opts=e,this.content=t,this.root=t.root,zn({...e,deps:()=>this.mounted}),Rn([()=>this.mounted],()=>{if(!this.mounted){this.isUserScrolling=!1;return}this.isUserScrolling}),kr(()=>{this.mounted||this.clearAutoScrollInterval()}),this.onpointerdown=this.onpointerdown.bind(this),this.onpointermove=this.onpointermove.bind(this),this.onpointerleave=this.onpointerleave.bind(this)}handleUserScroll(){window.clearTimeout(this.userScrollTimer),this.isUserScrolling=!0,this.userScrollTimer=window.setTimeout(()=>{this.isUserScrolling=!1},200)}clearAutoScrollInterval(){this.autoScrollTimer!==null&&(window.clearTimeout(this.autoScrollTimer),this.autoScrollTimer=null)}onpointerdown(e){if(this.autoScrollTimer!==null)return;const t=n=>{this.onAutoScroll(),this.autoScrollTimer=window.setTimeout(()=>t(n+1),this.opts.delay.current(n))};this.autoScrollTimer=window.setTimeout(()=>t(1),this.opts.delay.current(0))}onpointermove(e){this.onpointerdown(e)}onpointerleave(e){this.clearAutoScrollInterval()}#e=me(()=>({id:this.opts.id.current,"aria-hidden":QE(!0),style:{flexShrink:0},onpointerdown:this.onpointerdown,onpointermove:this.onpointermove,onpointerleave:this.onpointerleave}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class t4{scrollButtonState;content;root;#t=wt(!1);get canScrollDown(){return S(this.#t)}set canScrollDown(e){pe(this.#t,e,!0)}scrollIntoViewTimer=null;constructor(e){this.scrollButtonState=e,this.content=e.content,this.root=e.root,this.scrollButtonState.onAutoScroll=this.handleAutoScroll,Rn([()=>this.content.viewportNode,()=>this.content.isPositioned],()=>{if(!(!this.content.viewportNode||!this.content.isPositioned))return this.handleScroll(!0),li(this.content.viewportNode,"scroll",()=>this.handleScroll())}),Rn(()=>this.scrollButtonState.mounted,()=>{this.scrollButtonState.mounted&&(this.scrollIntoViewTimer&&clearTimeout(this.scrollIntoViewTimer),this.scrollIntoViewTimer=my(5,()=>{this.root.highlightedNode?.scrollIntoView({block:this.root.opts.scrollAlignment.current})}))})}handleScroll=(e=!1)=>{if(e||this.scrollButtonState.handleUserScroll(),!this.content.viewportNode)return;const t=this.content.viewportNode.scrollHeight-this.content.viewportNode.clientHeight,n=Number.parseInt(getComputedStyle(this.content.viewportNode).paddingTop,10);this.canScrollDown=Math.ceil(this.content.viewportNode.scrollTop)<t-n};handleAutoScroll=()=>{const e=this.content.viewportNode,t=this.root.highlightedNode;!e||!t||(e.scrollTop=e.scrollTop+t.offsetHeight)};#e=me(()=>({...this.scrollButtonState.props,[this.root.bitsAttrs["scroll-down-button"]]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class r4{scrollButtonState;content;root;#t=wt(!1);get canScrollUp(){return S(this.#t)}set canScrollUp(e){pe(this.#t,e,!0)}constructor(e){this.scrollButtonState=e,this.content=e.content,this.root=e.root,this.scrollButtonState.onAutoScroll=this.handleAutoScroll,Rn([()=>this.content.viewportNode,()=>this.content.isPositioned],()=>{if(!(!this.content.viewportNode||!this.content.isPositioned))return this.handleScroll(!0),li(this.content.viewportNode,"scroll",()=>this.handleScroll())})}handleScroll=(e=!1)=>{if(e||this.scrollButtonState.handleUserScroll(),!this.content.viewportNode)return;const t=Number.parseInt(getComputedStyle(this.content.viewportNode).paddingTop,10);this.canScrollUp=this.content.viewportNode.scrollTop-t>.1};handleAutoScroll=()=>{!this.content.viewportNode||!this.root.highlightedNode||(this.content.viewportNode.scrollTop=this.content.viewportNode.scrollTop-this.root.highlightedNode.offsetHeight)};#e=me(()=>({...this.scrollButtonState.props,[this.root.bitsAttrs["scroll-up-button"]]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}const Od=new Pa("Select.Root | Combobox.Root"),wy=new Pa("Select.Content | Combobox.Content");function RP(r){const{type:e,...t}=r,n=e==="single"?new XL(t):new qL(t);return Od.set(n)}function n4(r){return new GL(r,Od.get())}function i4(r){return wy.set(new KL(r,Od.get()))}function s4(r){return new YL(r,Od.get())}function o4(r){return new QL(r,Od.get())}function a4(r){return new e4(r,wy.get())}function l4(r){return new r4(new CP(r,wy.get()))}function c4(r){return new t4(new CP(r,wy.get()))}function u4(r){return new JL(r,Od.get())}const h4=["trigger","content","item","viewport","scroll-up-button","scroll-down-button","group","group-label","separator","arrow","input","content-wrapper","item-text","value"];function d4(r){const e=r.isCombobox,t={};for(const n of h4)t[n]=e?`data-combobox-${n}`:`data-select-${n}`;return t}function B_(r,e){Tt(e,!0);let t=ae(e,"value",15,"");const n=u4({value:Ke.with(()=>t())});var s=We(),l=ue(s);{var c=a=>{L0(a,zr(()=>n.props,{get value(){return t()},set value(g){t(g)}}))};Ze(l,a=>{n.shouldRender&&a(c)})}Z(r,s),St()}var f4=Fe("<!> <!>",1);function p4(r,e){Tt(e,!0);let t=ae(e,"value",15),n=ae(e,"onValueChange",3,In),s=ae(e,"name",3,""),l=ae(e,"disabled",3,!1),c=ae(e,"open",15,!1),a=ae(e,"onOpenChange",3,In),g=ae(e,"loop",3,!1),v=ae(e,"scrollAlignment",3,"nearest"),w=ae(e,"required",3,!1),P=ae(e,"items",19,()=>[]),I=ae(e,"allowDeselect",3,!0);if(t()===void 0){const L=e.type==="single"?"":[];t(L)}Rn.pre(()=>t(),()=>{t()===void 0&&t(e.type==="single"?"":[])});const k=RP({type:e.type,value:Ke.with(()=>t(),L=>{t(L),n()(L)}),disabled:Ke.with(()=>l()),required:Ke.with(()=>w()),open:Ke.with(()=>c(),L=>{c(L),a()(L)}),loop:Ke.with(()=>g()),scrollAlignment:Ke.with(()=>v()),name:Ke.with(()=>s()),isCombobox:!0,items:Ke.with(()=>P()),allowDeselect:Ke.with(()=>I())});var N=f4(),D=ue(N);AP(D,{children:(L,$)=>{var te=We(),G=ue(te);Ot(G,()=>e.children??Ht),Z(L,te)},$$slots:{default:!0}});var B=ve(D,2);{var U=L=>{var $=We(),te=ue($);{var G=le=>{var se=We(),oe=ue(se);xn(oe,17,()=>k.opts.value.current,di,(be,xe)=>{B_(be,{get value(){return S(xe)}})}),Z(le,se)};Ze(te,le=>{k.opts.value.current.length&&le(G)})}Z(L,$)},V=L=>{B_(L,{get value(){return k.opts.value.current},set value($){k.opts.value.current=$}})};Ze(B,L=>{Array.isArray(k.opts.value.current)?L(U):L(V,!1)})}Z(r,N),St()}function MP(r,e){Tt(e,!0),zL({id:Ke.with(()=>e.id),virtualEl:Ke.with(()=>e.virtualEl)});var t=We(),n=ue(t);Ot(n,()=>e.children??Ht),Z(r,t),St()}function g4(r,e){Tt(e,!0);let t=ae(e,"side",3,"bottom"),n=ae(e,"sideOffset",3,0),s=ae(e,"align",3,"center"),l=ae(e,"alignOffset",3,0),c=ae(e,"arrowPadding",3,0),a=ae(e,"avoidCollisions",3,!0),g=ae(e,"collisionBoundary",19,()=>[]),v=ae(e,"collisionPadding",3,0),w=ae(e,"hideWhenDetached",3,!1),P=ae(e,"onPlaced",3,()=>{}),I=ae(e,"sticky",3,"partial"),k=ae(e,"updatePositionStrategy",3,"optimized"),N=ae(e,"strategy",3,"fixed"),D=ae(e,"dir",3,"ltr"),B=ae(e,"style",19,()=>({})),U=ae(e,"wrapperId",19,Wn),V=ae(e,"customAnchor",3,null);const L=BL({side:Ke.with(()=>t()),sideOffset:Ke.with(()=>n()),align:Ke.with(()=>s()),alignOffset:Ke.with(()=>l()),id:Ke.with(()=>e.id),arrowPadding:Ke.with(()=>c()),avoidCollisions:Ke.with(()=>a()),collisionBoundary:Ke.with(()=>g()),collisionPadding:Ke.with(()=>v()),hideWhenDetached:Ke.with(()=>w()),onPlaced:Ke.with(()=>P()),sticky:Ke.with(()=>I()),updatePositionStrategy:Ke.with(()=>k()),strategy:Ke.with(()=>N()),dir:Ke.with(()=>D()),style:Ke.with(()=>B()),enabled:Ke.with(()=>e.enabled),wrapperId:Ke.with(()=>U()),customAnchor:Ke.with(()=>V())}),$=me(()=>Cn(L.wrapperProps,{style:{pointerEvents:"auto"}}));var te=We(),G=ue(te);Ot(G,()=>e.content??Ht,()=>({props:L.props,wrapperProps:S($)})),Z(r,te),St()}function m4(r,e){Tt(e,!0),ag(()=>{e.onPlaced?.()});var t=We(),n=ue(t);Ot(n,()=>e.content??Ht,()=>({props:{},wrapperProps:{}})),Z(r,t),St()}var _4=Fe("<input/>");function y4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"clearOnDeselect",3,!1),l=hr(e,["$$slots","$$events","$$legacy","id","ref","child","defaultValue","clearOnDeselect"]);const c=n4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),w=>n(w)),clearOnDeselect:Ke.with(()=>s())});e.defaultValue&&(c.root.inputValue=e.defaultValue);const a=me(()=>Cn(l,c.props,{value:c.root.inputValue}));var g=We(),v=ue(g);ar(v,()=>MP,(w,P)=>{P(w,{get id(){return t()},children:(I,k)=>{var N=We(),D=ue(N);{var B=V=>{var L=We(),$=ue(L);Ot($,()=>e.child,()=>({props:S(a)})),Z(V,L)},U=V=>{var L=_4();sn(L,()=>({...S(a)}),void 0,void 0,void 0,void 0,!0),Z(V,L)};Ze(D,V=>{e.child?V(B):V(U,!1)})}Z(I,N)},$$slots:{default:!0}})}),Z(r,g),St()}const v4="data-separator-root";class b4{opts;constructor(e){this.opts=e,zn(e)}#t=me(()=>({id:this.opts.id.current,role:this.opts.decorative.current?"none":"separator","aria-orientation":this.opts.orientation.current,"aria-hidden":QE(this.opts.decorative.current),"data-orientation":this.opts.orientation.current,[v4]:""}));get props(){return S(this.#t)}set props(e){pe(this.#t,e)}}function x4(r){return new b4(r)}var w4=Fe("<div><!></div>");function T4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"decorative",3,!1),l=ae(e,"orientation",3,"horizontal"),c=hr(e,["$$slots","$$events","$$legacy","id","ref","child","children","decorative","orientation"]);const a=x4({ref:Ke.with(()=>n(),k=>n(k)),id:Ke.with(()=>t()),decorative:Ke.with(()=>s()),orientation:Ke.with(()=>l())}),g=me(()=>Cn(c,a.props));var v=We(),w=ue(v);{var P=k=>{var N=We(),D=ue(N);Ot(D,()=>e.child,()=>({props:S(g)})),Z(k,N)},I=k=>{var N=w4();sn(N,()=>({...S(g)}));var D=Ae(N);Ot(D,()=>e.children??Ht),we(N),Z(k,N)};Ze(w,k=>{e.child?k(P):k(I,!1)})}Z(r,v),St()}function S4(r,e){let t=ae(e,"isStatic",3,!1),n=hr(e,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var s=We(),l=ue(s);{var c=g=>{m4(g,{get content(){return e.content},get onPlaced(){return e.onPlaced}})},a=g=>{g4(g,zr({get content(){return e.content},get onPlaced(){return e.onPlaced}},()=>n))};Ze(l,g=>{t()?g(c):g(a,!1)})}Z(r,s)}var A4=Fe("<!> <!>",1);function kP(r,e){Tt(e,!0);let t=ae(e,"interactOutsideBehavior",3,"close"),n=ae(e,"trapFocus",3,!0),s=ae(e,"isValidEvent",3,()=>!1),l=ae(e,"customAnchor",3,null),c=ae(e,"isStatic",3,!1),a=hr(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);S4(r,{get isStatic(){return c()},get id(){return e.id},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get enabled(){return e.enabled},content:(v,w)=>{let P=()=>w?.().props,I=()=>w?.().wrapperProps;var k=A4(),N=ue(k);{var D=V=>{O_(V,{get preventScroll(){return e.preventScroll}})},B=V=>{var L=We(),$=ue(L);{var te=G=>{O_(G,{get preventScroll(){return e.preventScroll}})};Ze($,G=>{e.forceMount||G(te)},!0)}Z(V,L)};Ze(N,V=>{e.forceMount&&e.enabled?V(D):V(B,!1)})}var U=ve(N,2);{const V=($,te)=>{let G=()=>te?.().props;sP($,{get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get enabled(){return e.enabled},children:(le,se)=>{iP(le,{get id(){return e.id},get onInteractOutside(){return e.onInteractOutside},get onFocusOutside(){return e.onFocusOutside},get interactOutsideBehavior(){return t()},get isValidEvent(){return s()},get enabled(){return e.enabled},children:(be,xe)=>{let _e=()=>xe?.().props;uP(be,{get id(){return e.id},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get enabled(){return e.enabled},children:(Ne,fe)=>{var Le=We(),tt=ue(Le);{let Ye=me(()=>({props:Cn(a,P(),_e(),G(),{style:{pointerEvents:"auto"}}),wrapperProps:I()}));Ot(tt,()=>e.popper??Ht,()=>S(Ye))}Z(Ne,Le)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})};let L=me(()=>e.enabled&&n());cP(U,{get id(){return e.id},get onOpenAutoFocus(){return e.onOpenAutoFocus},get onCloseAutoFocus(){return e.onCloseAutoFocus},get loop(){return e.loop},get trapFocus(){return S(L)},get forceMount(){return e.forceMount},focusScope:V,$$slots:{focusScope:!0}})}Z(v,k)},$$slots:{content:!0}}),St()}function E4(r,e){let t=ae(e,"interactOutsideBehavior",3,"close"),n=ae(e,"trapFocus",3,!0),s=ae(e,"isValidEvent",3,()=>!1),l=ae(e,"customAnchor",3,null),c=ae(e,"isStatic",3,!1),a=hr(e,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);D0(r,zr({get id(){return e.id},get present(){return e.present}},()=>a,{presence:v=>{kP(v,zr({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get isStatic(){return c()},get enabled(){return e.present},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return t()},get loop(){return e.loop},get trapFocus(){return n()},get isValidEvent(){return s()},get onFocusOutside(){return e.onFocusOutside},forceMount:!1},()=>a))},$$slots:{presence:!0}}))}function P4(r,e){let t=ae(e,"interactOutsideBehavior",3,"close"),n=ae(e,"trapFocus",3,!0),s=ae(e,"isValidEvent",3,()=>!1),l=ae(e,"customAnchor",3,null),c=ae(e,"isStatic",3,!1),a=hr(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);kP(r,zr({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get isStatic(){return c()},get enabled(){return e.enabled},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return t()},get loop(){return e.loop},get trapFocus(){return n()},get isValidEvent(){return s()},get onFocusOutside(){return e.onFocusOutside}},()=>a,{forceMount:!0}))}var I4=Fe("<div><div><!></div></div>"),C4=Fe("<div><div><!></div></div>");function DP(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"forceMount",3,!1),l=ae(e,"side",3,"bottom"),c=ae(e,"onInteractOutside",3,In),a=ae(e,"onEscapeKeydown",3,In),g=ae(e,"preventScroll",3,!1),v=hr(e,["$$slots","$$events","$$legacy","id","ref","forceMount","side","onInteractOutside","onEscapeKeydown","children","child","preventScroll"]);const w=i4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),B=>n(B)),onInteractOutside:Ke.with(()=>c()),onEscapeKeydown:Ke.with(()=>a())}),P=me(()=>Cn(v,w.props));var I=We(),k=ue(I);{var N=B=>{P4(B,zr(()=>S(P),()=>w.popperProps,{get side(){return l()},get enabled(){return w.root.opts.open.current},get id(){return t()},get preventScroll(){return g()},forceMount:!0,popper:(V,L)=>{let $=()=>L?.().props,te=()=>L?.().wrapperProps;const G=me(()=>Cn($(),{style:w.props.style}));var le=We(),se=ue(le);{var oe=xe=>{var _e=We(),Ne=ue(_e);{let fe=me(()=>({props:S(G),wrapperProps:te(),...w.snippetProps}));Ot(Ne,()=>e.child,()=>S(fe))}Z(xe,_e)},be=xe=>{var _e=I4();sn(_e,()=>({...te()}));var Ne=Ae(_e);sn(Ne,()=>({...S(G)}));var fe=Ae(Ne);Ot(fe,()=>e.children??Ht),we(Ne),we(_e),Z(xe,_e)};Ze(se,xe=>{e.child?xe(oe):xe(be,!1)})}Z(V,le)},$$slots:{popper:!0}}))},D=B=>{var U=We(),V=ue(U);{var L=$=>{E4($,zr(()=>S(P),()=>w.popperProps,{get side(){return l()},get present(){return w.root.opts.open.current},get id(){return t()},get preventScroll(){return g()},forceMount:!1,popper:(G,le)=>{let se=()=>le?.().props,oe=()=>le?.().wrapperProps;const be=me(()=>Cn(se(),{style:w.props.style}));var xe=We(),_e=ue(xe);{var Ne=Le=>{var tt=We(),Ye=ue(tt);{let rt=me(()=>({props:S(be),wrapperProps:oe(),...w.snippetProps}));Ot(Ye,()=>e.child,()=>S(rt))}Z(Le,tt)},fe=Le=>{var tt=C4();sn(tt,()=>({...oe()}));var Ye=Ae(tt);sn(Ye,()=>({...S(be)}));var rt=Ae(Ye);Ot(rt,()=>e.children??Ht),we(Ye),we(tt),Z(Le,tt)};Ze(_e,Le=>{e.child?Le(Ne):Le(fe,!1)})}Z(G,xe)},$$slots:{popper:!0}}))};Ze(V,$=>{s()||$(L)},!0)}Z(B,U)};Ze(k,B=>{s()?B(N):B(D,!1)})}Z(r,I),St()}function X0(r,e){Tt(e,!0);let t=ae(e,"mounted",15,!1),n=ae(e,"onMountedChange",3,In);P0(()=>(t(!0),n()(!0),()=>{t(!1),n()(!1)})),St()}var R4=Fe("<div><!></div>"),M4=Fe("<!> <!>",1);function OP(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"label",19,()=>e.value),l=ae(e,"disabled",3,!1),c=ae(e,"onHighlight",3,In),a=ae(e,"onUnhighlight",3,In),g=hr(e,["$$slots","$$events","$$legacy","id","ref","value","label","disabled","children","child","onHighlight","onUnhighlight"]);const v=o4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),B=>n(B)),value:Ke.with(()=>e.value),disabled:Ke.with(()=>l()),label:Ke.with(()=>s()),onHighlight:Ke.with(()=>c()),onUnhighlight:Ke.with(()=>a())}),w=me(()=>Cn(g,v.props));var P=M4(),I=ue(P);{var k=B=>{var U=We(),V=ue(U);{let L=me(()=>({props:S(w),...v.snippetProps}));Ot(V,()=>e.child,()=>S(L))}Z(B,U)},N=B=>{var U=R4();sn(U,()=>({...S(w)}));var V=Ae(U);Ot(V,()=>e.children??Ht,()=>v.snippetProps),we(U),Z(B,U)};Ze(I,B=>{e.child?B(k):B(N,!1)})}var D=ve(I,2);X0(D,{get mounted(){return v.mounted},set mounted(B){v.mounted=B}}),Z(r,P),St()}var k4=Fe("<div><!></div>");function D4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=hr(e,["$$slots","$$events","$$legacy","id","ref","children","child"]);const l=a4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=k4();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}var O4=Fe("<div><!></div>"),F4=Fe("<!> <!>",1);function N4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"delay",3,()=>50),l=hr(e,["$$slots","$$events","$$legacy","id","ref","delay","child","children"]);const c=c4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P)),delay:Ke.with(()=>s())}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=P=>{var I=F4(),k=ue(I);X0(k,{get mounted(){return c.scrollButtonState.mounted},set mounted(U){c.scrollButtonState.mounted=U}});var N=ve(k,2);{var D=U=>{var V=We(),L=ue(V);Ot(L,()=>e.child,()=>({props:l})),Z(U,V)},B=U=>{var V=O4();sn(V,()=>({...S(a)}));var L=Ae(V);Ot(L,()=>e.children??Ht),we(V),Z(U,V)};Ze(N,U=>{e.child?U(D):U(B,!1)})}Z(P,I)};Ze(v,P=>{c.canScrollDown&&P(w)})}Z(r,g),St()}var L4=Fe("<div><!></div>"),B4=Fe("<!> <!>",1);function z4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"delay",3,()=>50),l=hr(e,["$$slots","$$events","$$legacy","id","ref","delay","child","children"]);const c=l4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P)),delay:Ke.with(()=>s())}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=P=>{var I=B4(),k=ue(I);X0(k,{get mounted(){return c.scrollButtonState.mounted},set mounted(U){c.scrollButtonState.mounted=U}});var N=ve(k,2);{var D=U=>{var V=We(),L=ue(V);Ot(L,()=>e.child,()=>({props:l})),Z(U,V)},B=U=>{var V=L4();sn(V,()=>({...S(a)}));var L=Ae(V);Ot(L,()=>e.children??Ht),we(V),Z(U,V)};Ze(N,U=>{e.child?U(D):U(B,!1)})}Z(P,I)};Ze(v,P=>{c.canScrollUp&&P(w)})}Z(r,g),St()}function U4(r,e){Tt(e,!0);let t=ae(e,"open",15,!1),n=ae(e,"onOpenChange",3,In);FF({variant:Ke.with(()=>"dialog"),open:Ke.with(()=>t(),c=>{t(c),n()(c)})});var s=We(),l=ue(s);Ot(l,()=>e.children??Ht),Z(r,s),St()}var V4=Fe("<button><!></button>");function j4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"disabled",3,!1),l=hr(e,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const c=UF({variant:Ke.with(()=>"close"),id:Ke.with(()=>t()),ref:Ke.with(()=>n(),I=>n(I)),disabled:Ke.with(()=>!!s())}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=I=>{var k=We(),N=ue(k);Ot(N,()=>e.child,()=>({props:S(a)})),Z(I,k)},P=I=>{var k=V4();sn(k,()=>({...S(a)}));var N=Ae(k);Ot(N,()=>e.children??Ht),we(k),Z(I,k)};Ze(v,I=>{e.child?I(w):I(P,!1)})}Z(r,g),St()}var W4=Fe("<!> <!>",1),$4=Fe("<!> <div><!></div>",1);function H4(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"forceMount",3,!1),l=ae(e,"onCloseAutoFocus",3,In),c=ae(e,"onOpenAutoFocus",3,In),a=ae(e,"onEscapeKeydown",3,In),g=ae(e,"onInteractOutside",3,In),v=ae(e,"trapFocus",3,!0),w=ae(e,"preventScroll",3,!0),P=ae(e,"restoreScrollDelay",3,null),I=hr(e,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onOpenAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const k=LF({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),D=>n(D))}),N=me(()=>Cn(I,k.props));{const D=U=>{{const V=($,te)=>{let G=()=>te?.().props;sP($,zr(()=>S(N),{get enabled(){return k.root.opts.open.current},onEscapeKeydown:le=>{a()(le),!le.defaultPrevented&&k.root.handleClose()},children:(le,se)=>{iP(le,zr(()=>S(N),{get enabled(){return k.root.opts.open.current},onInteractOutside:oe=>{g()(oe),!oe.defaultPrevented&&k.root.handleClose()},children:(oe,be)=>{uP(oe,zr(()=>S(N),{get enabled(){return k.root.opts.open.current},children:(xe,_e)=>{var Ne=We(),fe=ue(Ne);{var Le=Ye=>{var rt=W4(),it=ue(rt);{var Ct=jt=>{O_(jt,{get preventScroll(){return w()},get restoreScrollDelay(){return P()}})};Ze(it,jt=>{k.root.opts.open.current&&jt(Ct)})}var Mt=ve(it,2);{let jt=me(()=>({props:Cn(S(N),G()),...k.snippetProps}));Ot(Mt,()=>e.child,()=>S(jt))}Z(Ye,rt)},tt=Ye=>{var rt=$4(),it=ue(rt);O_(it,{get preventScroll(){return w()}});var Ct=ve(it,2);sn(Ct,jt=>({...jt}),[()=>Cn(S(N),G())]);var Mt=Ae(Ct);Ot(Mt,()=>e.children??Ht),we(Ct),Z(Ye,rt)};Ze(fe,Ye=>{e.child?Ye(Le):Ye(tt,!1)})}Z(xe,Ne)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))};let L=me(()=>kN({forceMount:s(),present:k.root.opts.open.current,trapFocus:v(),open:k.root.opts.open.current}));cP(U,{loop:!0,get trapFocus(){return S(L)},get onOpenAutoFocus(){return c()},get id(){return t()},onCloseAutoFocus:$=>{l()($),!$.defaultPrevented&&k.root.triggerNode?.focus()},focusScope:V,$$slots:{focusScope:!0}})}};let B=me(()=>k.root.opts.open.current||s());D0(r,zr(()=>S(N),{get forceMount(){return s()},get present(){return S(B)},presence:D,$$slots:{presence:!0}}))}St()}const Z4="data-label-root";class X4{opts;constructor(e){this.opts=e,this.onmousedown=this.onmousedown.bind(this),zn(e)}onmousedown(e){e.detail>1&&e.preventDefault()}#t=me(()=>({id:this.opts.id.current,[Z4]:"",onmousedown:this.onmousedown}));get props(){return S(this.#t)}set props(e){pe(this.#t,e)}}function q4(r){return new X4(r)}var G4=Fe("<label><!></label>");function FP(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=hr(e,["$$slots","$$events","$$legacy","children","child","id","ref","for"]);const l=q4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P))}),c=me(()=>Cn(s,l.props,{for:e.for}));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=G4();sn(I,()=>({...S(c),for:e.for}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}const Y4="data-radio-group-root",NP="data-radio-group-item";class K4{opts;rovingFocusGroup;#t=me(()=>this.opts.value.current!=="");get hasValue(){return S(this.#t)}set hasValue(e){pe(this.#t,e)}constructor(e){this.opts=e,this.rovingFocusGroup=eP({rootNodeId:this.opts.id,candidateAttr:NP,loop:this.opts.loop,orientation:this.opts.orientation}),zn({id:this.opts.id,ref:this.opts.ref})}isChecked(e){return this.opts.value.current===e}setValue(e){this.opts.value.current=e}#e=me(()=>({id:this.opts.id.current,role:"radiogroup","aria-required":YE(this.opts.required.current),"data-disabled":Ao(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,[Y4]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class Q4{opts;root;#t=me(()=>this.root.opts.value.current===this.opts.value.current);get checked(){return S(this.#t)}set checked(e){pe(this.#t,e)}#e=me(()=>this.opts.disabled.current||this.root.opts.disabled.current);#r=me(()=>this.root.isChecked(this.opts.value.current));#n=wt(-1);constructor(e,t){this.opts=e,this.root=t,zn(e),this.opts.value.current===this.root.opts.value.current?(this.root.rovingFocusGroup.setCurrentTabStopId(this.opts.id.current),pe(this.#n,0)):this.root.opts.value.current||pe(this.#n,0),kr(()=>{pe(this.#n,this.root.rovingFocusGroup.getTabIndex(this.opts.ref.current),!0)}),Rn([()=>this.opts.value.current,()=>this.root.opts.value.current],()=>{this.opts.value.current===this.root.opts.value.current&&(this.root.rovingFocusGroup.setCurrentTabStopId(this.opts.id.current),pe(this.#n,0))}),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this),this.onfocus=this.onfocus.bind(this)}onclick(e){this.opts.disabled.current||this.root.setValue(this.opts.value.current)}onfocus(e){this.root.hasValue&&this.root.setValue(this.opts.value.current)}onkeydown(e){if(!S(this.#e)){if(e.key===nc){e.preventDefault(),this.root.setValue(this.opts.value.current);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e,!0)}}#i=me(()=>({checked:S(this.#r)}));get snippetProps(){return S(this.#i)}set snippetProps(e){pe(this.#i,e)}#s=me(()=>({id:this.opts.id.current,disabled:S(this.#e)?!0:void 0,"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Ao(S(this.#e)),"data-state":S(this.#r)?"checked":"unchecked","aria-checked":KE(S(this.#r)),[NP]:"",type:"button",role:"radio",tabindex:S(this.#n),onkeydown:this.onkeydown,onfocus:this.onfocus,onclick:this.onclick}));get props(){return S(this.#s)}set props(e){pe(this.#s,e)}}class J4{root;#t=me(()=>this.root.opts.name.current!==void 0);get shouldRender(){return S(this.#t)}set shouldRender(e){pe(this.#t,e)}#e=me(()=>({name:this.root.opts.name.current,value:this.root.opts.value.current,required:this.root.opts.required.current,disabled:this.root.opts.disabled.current}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}constructor(e){this.root=e}}const q0=new Pa("RadioGroup.Root");function eB(r){return q0.set(new K4(r))}function tB(r){return new Q4(r,q0.get())}function rB(){return new J4(q0.get())}function nB(r,e){Tt(e,!1);const t=rB();dy();var n=We(),s=ue(n);{var l=c=>{L0(c,zr(()=>t.props))};Ze(s,c=>{t.shouldRender&&c(l)})}Z(r,n),St()}var iB=Fe("<div><!></div>"),sB=Fe("<!> <!>",1);function oB(r,e){Tt(e,!0);let t=ae(e,"disabled",3,!1),n=ae(e,"value",15,""),s=ae(e,"ref",15,null),l=ae(e,"orientation",3,"vertical"),c=ae(e,"loop",3,!0),a=ae(e,"name",3,void 0),g=ae(e,"required",3,!1),v=ae(e,"id",19,Wn),w=ae(e,"onValueChange",3,In),P=hr(e,["$$slots","$$events","$$legacy","disabled","children","child","value","ref","orientation","loop","name","required","id","onValueChange"]);const I=eB({orientation:Ke.with(()=>l()),disabled:Ke.with(()=>t()),loop:Ke.with(()=>c()),name:Ke.with(()=>a()),required:Ke.with(()=>g()),id:Ke.with(()=>v()),value:Ke.with(()=>n(),L=>{L!==n()&&(n(L),w()?.(L))}),ref:Ke.with(()=>s(),L=>s(L))}),k=me(()=>Cn(P,I.props));var N=sB(),D=ue(N);{var B=L=>{var $=We(),te=ue($);Ot(te,()=>e.child,()=>({props:S(k)})),Z(L,$)},U=L=>{var $=iB();sn($,()=>({...S(k)}));var te=Ae($);Ot(te,()=>e.children??Ht),we($),Z(L,$)};Ze(D,L=>{e.child?L(B):L(U,!1)})}var V=ve(D,2);nB(V,{}),Z(r,N),St()}var aB=Fe("<button><!></button>");function lB(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"disabled",3,!1),s=ae(e,"ref",15,null),l=hr(e,["$$slots","$$events","$$legacy","id","children","child","value","disabled","ref"]);const c=tB({value:Ke.with(()=>e.value),disabled:Ke.with(()=>n()??!1),id:Ke.with(()=>t()),ref:Ke.with(()=>s(),I=>s(I))}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=I=>{var k=We(),N=ue(k);{let D=me(()=>({props:S(a),...c.snippetProps}));Ot(N,()=>e.child,()=>S(D))}Z(I,k)},P=I=>{var k=aB();sn(k,()=>({...S(a)}));var N=Ae(k);Ot(N,()=>e.children??Ht,()=>c.snippetProps),we(k),Z(I,k)};Ze(v,I=>{e.child?I(w):I(P,!1)})}Z(r,g),St()}var cB=Fe("<!> <!>",1);function uB(r,e){Tt(e,!0);let t=ae(e,"value",15),n=ae(e,"onValueChange",3,In),s=ae(e,"name",3,""),l=ae(e,"disabled",3,!1),c=ae(e,"open",15,!1),a=ae(e,"onOpenChange",3,In),g=ae(e,"loop",3,!1),v=ae(e,"scrollAlignment",3,"nearest"),w=ae(e,"required",3,!1),P=ae(e,"items",19,()=>[]),I=ae(e,"allowDeselect",3,!1);function k(){t()===void 0&&t(e.type==="single"?"":[])}k(),Rn.pre(()=>t(),()=>{k()});const N=RP({type:e.type,value:Ke.with(()=>t(),$=>{t($),n()($)}),disabled:Ke.with(()=>l()),required:Ke.with(()=>w()),open:Ke.with(()=>c(),$=>{c($),a()($)}),loop:Ke.with(()=>g()),scrollAlignment:Ke.with(()=>v()),name:Ke.with(()=>s()),isCombobox:!1,items:Ke.with(()=>P()),allowDeselect:Ke.with(()=>I())});var D=cB(),B=ue(D);AP(B,{children:($,te)=>{var G=We(),le=ue(G);Ot(le,()=>e.children??Ht),Z($,G)},$$slots:{default:!0}});var U=ve(B,2);{var V=$=>{var te=We(),G=ue(te);{var le=se=>{var oe=We(),be=ue(oe);xn(be,17,()=>N.opts.value.current,di,(xe,_e)=>{B_(xe,{get value(){return S(_e)}})}),Z(se,oe)};Ze(G,se=>{N.opts.value.current.length&&se(le)})}Z($,te)},L=$=>{B_($,{get value(){return N.opts.value.current},set value(te){N.opts.value.current=te}})};Ze(U,$=>{Array.isArray(N.opts.value.current)?$(V):$(L,!1)})}Z(r,D),St()}var hB=Fe("<button><!></button>");function dB(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"type",3,"button"),l=hr(e,["$$slots","$$events","$$legacy","id","ref","child","children","type"]);const c=s4({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),w=>n(w))}),a=me(()=>Cn(l,c.props,{type:s()}));var g=We(),v=ue(g);ar(v,()=>MP,(w,P)=>{P(w,{get id(){return t()},children:(I,k)=>{var N=We(),D=ue(N);{var B=V=>{var L=We(),$=ue(L);Ot($,()=>e.child,()=>({props:S(a)})),Z(V,L)},U=V=>{var L=hB();sn(L,()=>({...S(a)}));var $=Ae(L);Ot($,()=>e.children??Ht),we(L),Z(V,L)};Ze(D,V=>{e.child?V(B):V(U,!1)})}Z(I,N)},$$slots:{default:!0}})}),Z(r,g),St()}function fB(r,e,t){const n={position:"absolute"};return r==="lr"?(n.left=`${e}%`,n.right=`${t}%`):r==="rl"?(n.right=`${e}%`,n.left=`${t}%`):r==="bt"?(n.bottom=`${e}%`,n.top=`${t}%`):(n.top=`${e}%`,n.bottom=`${t}%`),n}function LP(r,e){const t={position:"absolute"};return r==="lr"?(t.left=`${e}%`,t.translate="-50% 0"):r==="rl"?(t.right=`${e}%`,t.translate="50% 0"):r==="bt"?(t.bottom=`${e}%`,t.translate="0 50%"):(t.top=`${e}%`,t.translate="0 -50%"),t}function BP(r,e,t){const n={position:"absolute"};return r==="lr"?(n.left=`${e}%`,n.translate=`${t}% 0`):r==="rl"?(n.right=`${e}%`,n.translate=`${-t}% 0`):r==="bt"?(n.bottom=`${e}%`,n.translate=`0 ${-t}%`):(n.top=`${e}%`,n.translate=`0 ${t}%`),n}function sd(r,e,t,n){const s=(r-(Number.isNaN(e)?0:e))%n;let l=Math.abs(s)*2>=n?r+Math.sign(s)*(n-Math.abs(s)):r-s;Number.isNaN(e)?!Number.isNaN(t)&&l>t&&(l=Math.floor(t/n)*n):l<e?l=e:!Number.isNaN(t)&&l>t&&(l=e+Math.floor((t-e)/n)*n);const c=n.toString(),a=c.indexOf("."),g=a>=0?c.length-a:0;if(g>0){const v=10**g;l=Math.round(l*v)/v}return l}function G0(r,e,t=!0){const[n,s]=r,[l,c]=e,a=(c-l)/(s-n);return g=>{const v=l+a*(g-n);return t?v>Math.max(l,c)?Math.max(l,c):v<Math.min(l,c)?Math.min(l,c):v:v}}const pB="data-slider-root",z_="data-slider-thumb",gB="data-slider-range",zP="data-slider-tick";class UP{opts;#t=wt(!1);get isActive(){return S(this.#t)}set isActive(e){pe(this.#t,e,!0)}#e=me(()=>this.opts.orientation.current==="horizontal"?this.opts.dir.current==="rtl"?"rl":"lr":this.opts.dir.current==="rtl"?"tb":"bt");get direction(){return S(this.#e)}set direction(e){pe(this.#e,e)}constructor(e){this.opts=e,zn(e)}isThumbActive(e){return this.isActive}#r=me(()=>{if(!this.opts.disabled.current)return this.opts.orientation.current==="horizontal"?"pan-y":"pan-x"});getAllThumbs=()=>{const e=this.opts.ref.current;return e?Array.from(e.querySelectorAll(`[${z_}]`)):[]};getThumbScale=()=>{if(this.opts.thumbPositioning.current==="exact")return[0,100];const e=this.opts.orientation.current==="vertical",t=this.getAllThumbs()[0],n=e?t?.offsetHeight:t?.offsetWidth;if(n===void 0||Number.isNaN(n)||n===0)return[0,100];const s=e?this.opts.ref.current?.offsetHeight:this.opts.ref.current?.offsetWidth;if(s===void 0||Number.isNaN(s)||s===0)return[0,100];const l=n/2/s*100,c=l,a=100-l;return[c,a]};getPositionFromValue=e=>{const t=this.getThumbScale();return G0([this.opts.min.current,this.opts.max.current],t)(e)};#n=me(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,"data-disabled":Ao(this.opts.disabled.current),style:{touchAction:S(this.#r)},[pB]:""}));get props(){return S(this.#n)}set props(e){pe(this.#n,e)}}class mB extends UP{opts;isMulti=!1;constructor(e){super(e),this.opts=e,P0(()=>tl(li(document,"pointerdown",this.handlePointerDown),li(document,"pointerup",this.handlePointerUp),li(document,"pointermove",this.handlePointerMove),li(document,"pointerleave",this.handlePointerUp))),Rn([()=>this.opts.step.current,()=>this.opts.min.current,()=>this.opts.max.current,()=>this.opts.value.current],([t,n,s,l])=>{const c=g=>sd(g,n,s,t)===g,a=g=>sd(g,n,s,t);c(l)||(this.opts.value.current=a(l))})}applyPosition({clientXY:e,start:t,end:n}){const s=this.opts.min.current,l=this.opts.max.current,a=(e-t)/(n-t)*(l-s)+s;if(a<s)this.updateValue(s);else if(a>l)this.updateValue(l);else{const g=this.opts.step.current,v=Math.floor((a-s)/g),w=s+v*g+g/2,P=s+(v+1)*g+g/2,I=a>=w&&a<P?(v+1)*g+s:v*g+s;I<=l&&this.updateValue(I)}}updateValue=e=>{this.opts.value.current=sd(e,this.opts.min.current,this.opts.max.current,this.opts.step.current)};handlePointerMove=e=>{if(!this.isActive||this.opts.disabled.current)return;e.preventDefault(),e.stopPropagation();const t=this.opts.ref.current,n=this.getAllThumbs()[0];if(!t||!n)return;n.focus();const{left:s,right:l,top:c,bottom:a}=t.getBoundingClientRect();this.direction==="lr"?this.applyPosition({clientXY:e.clientX,start:s,end:l}):this.direction==="rl"?this.applyPosition({clientXY:e.clientX,start:l,end:s}):this.direction==="bt"?this.applyPosition({clientXY:e.clientY,start:a,end:c}):this.direction==="tb"&&this.applyPosition({clientXY:e.clientY,start:c,end:a})};handlePointerDown=e=>{if(e.button!==0||this.opts.disabled.current)return;const t=this.opts.ref.current,n=this.getAllThumbs()[0];if(!n||!t)return;const s=e.target;!JE(s)||!t.contains(s)||(e.preventDefault(),n.focus(),this.isActive=!0,this.handlePointerMove(e))};handlePointerUp=()=>{this.opts.disabled.current||(this.isActive&&this.opts.onValueCommit.current(Ms(()=>this.opts.value.current)),this.isActive=!1)};#t=me(()=>{const e=this.opts.value.current;return Array.from({length:1},()=>{const t=e,n=this.getPositionFromValue(t),s=LP(this.direction,n);return{role:"slider","aria-valuemin":this.opts.min.current,"aria-valuemax":this.opts.max.current,"aria-valuenow":t,"aria-disabled":GE(this.opts.disabled.current),"aria-orientation":this.opts.orientation.current,"data-value":t,tabindex:this.opts.disabled.current?-1:0,style:s,[z_]:""}})});get thumbsPropsArr(){return S(this.#t)}set thumbsPropsArr(e){pe(this.#t,e)}#e=me(()=>this.thumbsPropsArr.map((e,t)=>t));get thumbsRenderArr(){return S(this.#e)}set thumbsRenderArr(e){pe(this.#e,e)}#r=me(()=>{const e=this.opts.max.current,t=this.opts.min.current,n=this.opts.step.current,s=e-t;let l=Math.ceil(s/n);s%n==0&&l++;const c=this.opts.value.current;return Array.from({length:l},(a,g)=>{const v=g*n,w=G0([0,(l-1)*n],this.getThumbScale()),P=g===0,I=g===l-1,k=P?0:I?-100:-50,N=BP(this.direction,w(v),k),D=t+g*n,B=D<=c;return{"data-disabled":Ao(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,"data-bounded":B?"":void 0,"data-value":D,style:N,[zP]:""}})});get ticksPropsArr(){return S(this.#r)}set ticksPropsArr(e){pe(this.#r,e)}#n=me(()=>this.ticksPropsArr.map((e,t)=>t));get ticksRenderArr(){return S(this.#n)}set ticksRenderArr(e){pe(this.#n,e)}#i=me(()=>({ticks:this.ticksRenderArr,thumbs:this.thumbsRenderArr}));get snippetProps(){return S(this.#i)}set snippetProps(e){pe(this.#i,e)}}class _B extends UP{opts;isMulti=!0;#t=wt(null);get activeThumb(){return S(this.#t)}set activeThumb(e){pe(this.#t,e,!0)}#e=wt(0);get currentThumbIdx(){return S(this.#e)}set currentThumbIdx(e){pe(this.#e,e,!0)}constructor(e){super(e),this.opts=e,P0(()=>tl(li(document,"pointerdown",this.handlePointerDown),li(document,"pointerup",this.handlePointerUp),li(document,"pointermove",this.handlePointerMove),li(document,"pointerleave",this.handlePointerUp))),Rn([()=>this.opts.step.current,()=>this.opts.min.current,()=>this.opts.max.current,()=>this.opts.value.current],([t,n,s,l])=>{const c=g=>sd(g,n,s,t)===g,a=g=>sd(g,n,s,t);l.some(g=>!c(g))&&(this.opts.value.current=l.map(a))})}isThumbActive(e){return this.isActive&&this.activeThumb?.idx===e}applyPosition({clientXY:e,activeThumbIdx:t,start:n,end:s}){const l=this.opts.min.current,c=this.opts.max.current,g=(e-n)/(s-n)*(c-l)+l;if(g<l)this.updateValue(l,t);else if(g>c)this.updateValue(c,t);else{const v=this.opts.step.current,w=Math.floor((g-l)/v),P=l+w*v+v/2,I=l+(w+1)*v+v/2,k=g>=P&&g<I?(w+1)*v+l:w*v+l;k<=c&&this.updateValue(k,t)}}#r=e=>{const t=this.getAllThumbs();if(!t.length)return;for(const c of t)c.blur();const n=t.map(c=>{if(this.opts.orientation.current==="horizontal"){const{left:a,right:g}=c.getBoundingClientRect();return Math.abs(e.clientX-(a+g)/2)}else{const{top:a,bottom:g}=c.getBoundingClientRect();return Math.abs(e.clientY-(a+g)/2)}}),s=t[n.indexOf(Math.min(...n))],l=t.indexOf(s);return{node:s,idx:l}};handlePointerMove=e=>{if(!this.isActive||this.opts.disabled.current)return;e.preventDefault(),e.stopPropagation();const t=this.opts.ref.current,n=this.activeThumb;if(!t||!n)return;n.node.focus();const{left:s,right:l,top:c,bottom:a}=t.getBoundingClientRect(),g=this.direction;g==="lr"?this.applyPosition({clientXY:e.clientX,activeThumbIdx:n.idx,start:s,end:l}):g==="rl"?this.applyPosition({clientXY:e.clientX,activeThumbIdx:n.idx,start:l,end:s}):g==="bt"?this.applyPosition({clientXY:e.clientY,activeThumbIdx:n.idx,start:a,end:c}):g==="tb"&&this.applyPosition({clientXY:e.clientY,activeThumbIdx:n.idx,start:c,end:a})};handlePointerDown=e=>{if(e.button!==0||this.opts.disabled.current)return;const t=this.opts.ref.current,n=this.#r(e);if(!n||!t)return;const s=e.target;!JE(s)||!t.contains(s)||(e.preventDefault(),this.activeThumb=n,n.node.focus(),this.isActive=!0,this.handlePointerMove(e))};handlePointerUp=()=>{this.opts.disabled.current||(this.isActive&&this.opts.onValueCommit.current(Ms(()=>this.opts.value.current)),this.isActive=!1)};getAllThumbs=()=>{const e=this.opts.ref.current;return e?Array.from(e.querySelectorAll(`[${z_}]`)):[]};updateValue=(e,t)=>{const n=this.opts.value.current;if(!n.length){this.opts.value.current.push(e);return}if(n[t]===e)return;const l=[...n];if(!zN(t,l))return;const c=l[t]>e?-1:1,a=()=>{const P=t+c;l[t]=l[P],l[P]=e;const I=this.getAllThumbs();I.length&&(I[P]?.focus(),this.activeThumb={node:I[P],idx:P})};if(this.opts.autoSort.current&&(c===-1&&e<l[t-1]||c===1&&e>l[t+1])){a(),this.opts.value.current=l;return}const g=this.opts.min.current,v=this.opts.max.current,w=this.opts.step.current;l[t]=sd(e,g,v,w),this.opts.value.current=l};#n=me(()=>{const e=this.opts.value.current;return Array.from({length:e.length||1},(t,n)=>{const s=Ms(()=>this.currentThumbIdx);s<e.length&&Ms(()=>{this.currentThumbIdx=s+1});const l=e[n],c=this.getPositionFromValue(l??0),a=LP(this.direction,c);return{role:"slider","aria-valuemin":this.opts.min.current,"aria-valuemax":this.opts.max.current,"aria-valuenow":l,"aria-disabled":GE(this.opts.disabled.current),"aria-orientation":this.opts.orientation.current,"data-value":l,tabindex:this.opts.disabled.current?-1:0,style:a,[z_]:""}})});get thumbsPropsArr(){return S(this.#n)}set thumbsPropsArr(e){pe(this.#n,e)}#i=me(()=>this.thumbsPropsArr.map((e,t)=>t));get thumbsRenderArr(){return S(this.#i)}set thumbsRenderArr(e){pe(this.#i,e)}#s=me(()=>{const e=this.opts.max.current,t=this.opts.min.current,n=this.opts.step.current,s=e-t;let l=Math.ceil(s/n);s%n==0&&l++;const c=this.opts.value.current;return Array.from({length:l},(a,g)=>{const v=g*n,w=G0([0,(l-1)*n],this.getThumbScale()),P=g===0,I=g===l-1,k=P?0:I?-100:-50,N=BP(this.direction,w(v),k),D=t+g*n,B=c.length===1?D<=c[0]:c[0]<=D&&D<=c[c.length-1];return{"data-disabled":Ao(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,"data-bounded":B?"":void 0,"data-value":D,style:N,[zP]:""}})});get ticksPropsArr(){return S(this.#s)}set ticksPropsArr(e){pe(this.#s,e)}#o=me(()=>this.ticksPropsArr.map((e,t)=>t));get ticksRenderArr(){return S(this.#o)}set ticksRenderArr(e){pe(this.#o,e)}#a=me(()=>({ticks:this.ticksRenderArr,thumbs:this.thumbsRenderArr}));get snippetProps(){return S(this.#a)}set snippetProps(e){pe(this.#a,e)}}const yB=[Pd,Id,Rs,to,Rd,Cd];class vB{opts;root;constructor(e,t){this.opts=e,this.root=t,zn(e)}#t=me(()=>{const e=Array.isArray(this.root.opts.value.current)&&this.root.opts.value.current.length>1?this.root.getPositionFromValue(Math.min(...this.root.opts.value.current)??0):0,t=Array.isArray(this.root.opts.value.current)?100-this.root.getPositionFromValue(Math.max(...this.root.opts.value.current)??0):100-this.root.getPositionFromValue(this.root.opts.value.current);return{position:"absolute",...fB(this.root.direction,e,t)}});get rangeStyles(){return S(this.#t)}set rangeStyles(e){pe(this.#t,e)}#e=me(()=>({id:this.opts.id.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Ao(this.root.opts.disabled.current),style:this.rangeStyles,[gB]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class bB{opts;root;#t=me(()=>this.root.opts.disabled.current||this.opts.disabled.current);constructor(e,t){this.opts=e,this.root=t,zn(e),this.onkeydown=this.onkeydown.bind(this)}#e(e){this.root.isMulti?this.root.updateValue(e,this.opts.index.current):this.root.updateValue(e)}onkeydown(e){if(S(this.#t))return;const t=this.opts.ref.current;if(!t)return;const n=this.root.getAllThumbs();if(!n.length)return;const s=n.indexOf(t);if(this.root.isMulti&&(this.root.currentThumbIdx=s),!yB.includes(e.key))return;e.preventDefault();const l=this.root.opts.min.current,c=this.root.opts.max.current,a=this.root.opts.value.current,g=Array.isArray(a)?a[s]:a,v=this.root.opts.orientation.current,w=this.root.direction,P=this.root.opts.step.current;switch(e.key){case Rd:this.#e(l);break;case Cd:this.#e(c);break;case Pd:if(v!=="horizontal")break;if(e.metaKey){const I=w==="rl"?c:l;this.#e(I)}else w==="rl"&&g<c?this.#e(g+P):w==="lr"&&g>l&&this.#e(g-P);break;case Id:if(v!=="horizontal")break;if(e.metaKey){const I=w==="rl"?l:c;this.#e(I)}else w==="rl"&&g>l?this.#e(g-P):w==="lr"&&g<c&&this.#e(g+P);break;case Rs:if(e.metaKey){const I=w==="tb"?l:c;this.#e(I)}else w==="tb"&&g>l?this.#e(g-P):w!=="tb"&&g<c&&this.#e(g+P);break;case to:if(e.metaKey){const I=w==="tb"?c:l;this.#e(I)}else w==="tb"&&g<c?this.#e(g+P):w!=="tb"&&g>l&&this.#e(g-P);break}this.root.opts.onValueCommit.current(this.root.opts.value.current)}#r=me(()=>({...this.root.thumbsPropsArr[this.opts.index.current],id:this.opts.id.current,onkeydown:this.onkeydown,"data-active":this.root.isThumbActive(this.opts.index.current)?"":void 0}));get props(){return S(this.#r)}set props(e){pe(this.#r,e)}}const Y0=new Pa("Slider.Root");function xB(r){const{type:e,...t}=r,n=e==="single"?new mB(t):new _B(t);return Y0.set(n)}function wB(r){return new vB(r,Y0.get())}function TB(r){return new bB(r,Y0.get())}var SB=Fe("<span><!></span>");function AB(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"value",15),l=ae(e,"onValueChange",3,In),c=ae(e,"onValueCommit",3,In),a=ae(e,"disabled",3,!1),g=ae(e,"min",3,0),v=ae(e,"max",3,100),w=ae(e,"step",3,1),P=ae(e,"dir",3,"ltr"),I=ae(e,"autoSort",3,!0),k=ae(e,"orientation",3,"horizontal"),N=ae(e,"thumbPositioning",3,"contain"),D=hr(e,["$$slots","$$events","$$legacy","children","child","id","ref","value","type","onValueChange","onValueCommit","disabled","min","max","step","dir","autoSort","orientation","thumbPositioning"]);function B(){s()===void 0&&s(e.type==="single"?0:[])}B(),Rn.pre(()=>s(),()=>{B()});const U=xB({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),le=>n(le)),value:Ke.with(()=>s(),le=>{s(le),l()(le)}),onValueCommit:Ke.with(()=>c()),disabled:Ke.with(()=>a()),min:Ke.with(()=>g()),max:Ke.with(()=>v()),step:Ke.with(()=>w()),dir:Ke.with(()=>P()),autoSort:Ke.with(()=>I()),orientation:Ke.with(()=>k()),thumbPositioning:Ke.with(()=>N()),type:e.type}),V=me(()=>Cn(D,U.props));var L=We(),$=ue(L);{var te=le=>{var se=We(),oe=ue(se);{let be=me(()=>({props:S(V),...U.snippetProps}));Ot(oe,()=>e.child,()=>S(be))}Z(le,se)},G=le=>{var se=SB();sn(se,()=>({...S(V)}));var oe=Ae(se);Ot(oe,()=>e.children??Ht,()=>U.snippetProps),we(se),Z(le,se)};Ze($,le=>{e.child?le(te):le(G,!1)})}Z(r,L),St()}var EB=Fe("<span><!></span>");function PB(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"id",19,Wn),s=hr(e,["$$slots","$$events","$$legacy","children","child","ref","id"]);const l=wB({id:Ke.with(()=>n()),ref:Ke.with(()=>t(),P=>t(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=EB();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}var IB=Fe("<span><!></span>");function CB(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"id",19,Wn),s=ae(e,"disabled",3,!1),l=hr(e,["$$slots","$$events","$$legacy","children","child","ref","id","index","disabled"]);const c=TB({id:Ke.with(()=>n()),ref:Ke.with(()=>t(),I=>t(I)),index:Ke.with(()=>e.index),disabled:Ke.with(()=>s())}),a=me(()=>Cn(l,c.props));var g=We(),v=ue(g);{var w=I=>{var k=We(),N=ue(k);{let D=me(()=>({active:c.root.isThumbActive(c.opts.index.current),props:S(a)}));Ot(N,()=>e.child,()=>S(D))}Z(I,k)},P=I=>{var k=IB();sn(k,()=>({...S(a)}));var N=Ae(k);{let D=me(()=>({active:c.root.isThumbActive(c.opts.index.current)}));Ot(N,()=>e.children??Ht,()=>S(D))}we(k),Z(I,k)};Ze(v,I=>{e.child?I(w):I(P,!1)})}Z(r,g),St()}const RB="data-switch-root",MB="data-switch-thumb";class kB{opts;constructor(e){this.opts=e,zn(e),this.onkeydown=this.onkeydown.bind(this),this.onclick=this.onclick.bind(this)}#t(){this.opts.checked.current=!this.opts.checked.current}onkeydown(e){!(e.key===sc||e.key===nc)||this.opts.disabled.current||(e.preventDefault(),this.#t())}onclick(e){this.opts.disabled.current||this.#t()}#e=me(()=>({"data-disabled":Ao(this.opts.disabled.current),"data-state":qO(this.opts.checked.current),"data-required":YO(this.opts.required.current)}));get sharedProps(){return S(this.#e)}set sharedProps(e){pe(this.#e,e)}#r=me(()=>({checked:this.opts.checked.current}));get snippetProps(){return S(this.#r)}set snippetProps(e){pe(this.#r,e)}#n=me(()=>({...this.sharedProps,id:this.opts.id.current,role:"switch",disabled:C0(this.opts.disabled.current),"aria-checked":KE(this.opts.checked.current),"aria-required":YE(this.opts.required.current),[RB]:"",onclick:this.onclick,onkeydown:this.onkeydown}));get props(){return S(this.#n)}set props(e){pe(this.#n,e)}}class DB{root;#t=me(()=>this.root.opts.name.current!==void 0);get shouldRender(){return S(this.#t)}set shouldRender(e){pe(this.#t,e)}constructor(e){this.root=e}#e=me(()=>({type:"checkbox",name:this.root.opts.name.current,value:this.root.opts.value.current,checked:this.root.opts.checked.current,disabled:this.root.opts.disabled.current,required:this.root.opts.required.current}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class OB{opts;root;constructor(e,t){this.opts=e,this.root=t,zn(e)}#t=me(()=>({checked:this.root.opts.checked.current}));get snippetProps(){return S(this.#t)}set snippetProps(e){pe(this.#t,e)}#e=me(()=>({...this.root.sharedProps,id:this.opts.id.current,[MB]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}const K0=new Pa("Switch.Root");function FB(r){return K0.set(new kB(r))}function NB(){return new DB(K0.get())}function LB(r){return new OB(r,K0.get())}function BB(r,e){Tt(e,!1);const t=NB();dy();var n=We(),s=ue(n);{var l=c=>{L0(c,zr(()=>t.props))};Ze(s,c=>{t.shouldRender&&c(l)})}Z(r,n),St()}var zB=Fe("<button><!></button>"),UB=Fe("<!> <!>",1);function VB(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"id",19,Wn),s=ae(e,"disabled",3,!1),l=ae(e,"required",3,!1),c=ae(e,"checked",15,!1),a=ae(e,"value",3,"on"),g=ae(e,"name",3,void 0),v=ae(e,"type",3,"button"),w=ae(e,"onCheckedChange",3,In),P=hr(e,["$$slots","$$events","$$legacy","child","children","ref","id","disabled","required","checked","value","name","type","onCheckedChange"]);const I=FB({checked:Ke.with(()=>c(),L=>{c(L),w()?.(L)}),disabled:Ke.with(()=>s()??!1),required:Ke.with(()=>l()),value:Ke.with(()=>a()),name:Ke.with(()=>g()),id:Ke.with(()=>n()),ref:Ke.with(()=>t(),L=>t(L))}),k=me(()=>Cn(P,I.props,{type:v()}));var N=UB(),D=ue(N);{var B=L=>{var $=We(),te=ue($);{let G=me(()=>({props:S(k),...I.snippetProps}));Ot(te,()=>e.child,()=>S(G))}Z(L,$)},U=L=>{var $=zB();sn($,()=>({...S(k)}));var te=Ae($);Ot(te,()=>e.children??Ht,()=>I.snippetProps),we($),Z(L,$)};Ze(D,L=>{e.child?L(B):L(U,!1)})}var V=ve(D,2);BB(V,{}),Z(r,N),St()}var jB=Fe("<span><!></span>");function WB(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"id",19,Wn),s=hr(e,["$$slots","$$events","$$legacy","child","children","ref","id"]);const l=LB({id:Ke.with(()=>n()),ref:Ke.with(()=>t(),P=>t(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);{let N=me(()=>({props:S(c),...l.snippetProps}));Ot(k,()=>e.child,()=>S(N))}Z(P,I)},w=P=>{var I=jB();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht,()=>l.snippetProps),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}const $B="data-tabs-root",HB="data-tabs-list",VP="data-tabs-trigger",ZB="data-tabs-content";class XB{opts;rovingFocusGroup;#t=wt(tn([]));get triggerIds(){return S(this.#t)}set triggerIds(e){pe(this.#t,e,!0)}valueToTriggerId=new lx;valueToContentId=new lx;constructor(e){this.opts=e,zn(e),this.rovingFocusGroup=eP({candidateAttr:VP,rootNodeId:this.opts.id,loop:this.opts.loop,orientation:this.opts.orientation})}registerTrigger(e,t){return this.triggerIds.push(e),this.valueToTriggerId.set(t,e),()=>{this.triggerIds=this.triggerIds.filter(n=>n!==e),this.valueToTriggerId.delete(t)}}registerContent(e,t){return this.valueToContentId.set(t,e),()=>{this.valueToContentId.delete(t)}}setValue(e){this.opts.value.current=e}#e=me(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,[$B]:""}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class qB{opts;root;#t=me(()=>this.root.opts.disabled.current);constructor(e,t){this.opts=e,this.root=t,zn(e)}#e=me(()=>({id:this.opts.id.current,role:"tablist","aria-orientation":this.root.opts.orientation.current,"data-orientation":this.root.opts.orientation.current,[HB]:"","data-disabled":Ao(S(this.#t))}));get props(){return S(this.#e)}set props(e){pe(this.#e,e)}}class GB{opts;root;#t=me(()=>this.root.opts.value.current===this.opts.value.current);#e=me(()=>this.opts.disabled.current||this.root.opts.disabled.current);#r=wt(0);#n=me(()=>this.root.valueToContentId.get(this.opts.value.current));constructor(e,t){this.opts=e,this.root=t,zn(e),Rn([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerTrigger(n,s)),kr(()=>{this.root.triggerIds.length,S(this.#t)||!this.root.opts.value.current?pe(this.#r,0):pe(this.#r,-1)}),this.onfocus=this.onfocus.bind(this),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}#i(){this.root.opts.value.current!==this.opts.value.current&&this.root.setValue(this.opts.value.current)}onfocus(e){this.root.opts.activationMode.current!=="automatic"||S(this.#e)||this.#i()}onclick(e){S(this.#e)||this.#i()}onkeydown(e){if(!S(this.#e)){if(e.key===nc||e.key===sc){e.preventDefault(),this.#i();return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e)}}#s=me(()=>({id:this.opts.id.current,role:"tab","data-state":jP(S(this.#t)),"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Ao(S(this.#e)),"aria-selected":GO(S(this.#t)),"aria-controls":S(this.#n),[VP]:"",disabled:C0(S(this.#e)),tabindex:S(this.#r),onclick:this.onclick,onfocus:this.onfocus,onkeydown:this.onkeydown}));get props(){return S(this.#s)}set props(e){pe(this.#s,e)}}class YB{opts;root;#t=me(()=>this.root.opts.value.current===this.opts.value.current);#e=me(()=>this.root.valueToTriggerId.get(this.opts.value.current));constructor(e,t){this.opts=e,this.root=t,zn(e),Rn([()=>this.opts.id.current,()=>this.opts.value.current],([n,s])=>this.root.registerContent(n,s))}#r=me(()=>({id:this.opts.id.current,role:"tabpanel",hidden:KO(!S(this.#t)),tabindex:0,"data-value":this.opts.value.current,"data-state":jP(S(this.#t)),"aria-labelledby":S(this.#e),[ZB]:""}));get props(){return S(this.#r)}set props(e){pe(this.#r,e)}}const Ty=new Pa("Tabs.Root");function KB(r){return Ty.set(new XB(r))}function QB(r){return new GB(r,Ty.get())}function JB(r){return new qB(r,Ty.get())}function ez(r){return new YB(r,Ty.get())}function jP(r){return r?"active":"inactive"}var tz=Fe("<div><!></div>");function rz(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=ae(e,"value",15,""),l=ae(e,"onValueChange",3,In),c=ae(e,"orientation",3,"horizontal"),a=ae(e,"loop",3,!0),g=ae(e,"activationMode",3,"automatic"),v=ae(e,"disabled",3,!1),w=hr(e,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","orientation","loop","activationMode","disabled","children","child"]);const P=KB({id:Ke.with(()=>t()),value:Ke.with(()=>s(),U=>{s(U),l()(U)}),orientation:Ke.with(()=>c()),loop:Ke.with(()=>a()),activationMode:Ke.with(()=>g()),disabled:Ke.with(()=>v()),ref:Ke.with(()=>n(),U=>n(U))}),I=me(()=>Cn(w,P.props));var k=We(),N=ue(k);{var D=U=>{var V=We(),L=ue(V);Ot(L,()=>e.child,()=>({props:S(I)})),Z(U,V)},B=U=>{var V=tz();sn(V,()=>({...S(I)}));var L=Ae(V);Ot(L,()=>e.children??Ht),we(V),Z(U,V)};Ze(N,U=>{e.child?U(D):U(B,!1)})}Z(r,k),St()}var nz=Fe("<div><!></div>");function iz(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=hr(e,["$$slots","$$events","$$legacy","children","child","id","ref","value"]);const l=ez({value:Ke.with(()=>e.value),id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=nz();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}var sz=Fe("<div><!></div>");function oz(r,e){Tt(e,!0);let t=ae(e,"id",19,Wn),n=ae(e,"ref",15,null),s=hr(e,["$$slots","$$events","$$legacy","child","children","id","ref"]);const l=JB({id:Ke.with(()=>t()),ref:Ke.with(()=>n(),P=>n(P))}),c=me(()=>Cn(s,l.props));var a=We(),g=ue(a);{var v=P=>{var I=We(),k=ue(I);Ot(k,()=>e.child,()=>({props:S(c)})),Z(P,I)},w=P=>{var I=sz();sn(I,()=>({...S(c)}));var k=Ae(I);Ot(k,()=>e.children??Ht),we(I),Z(P,I)};Ze(g,P=>{e.child?P(v):P(w,!1)})}Z(r,a),St()}var az=Fe("<button><!></button>");function lz(r,e){Tt(e,!0);let t=ae(e,"disabled",3,!1),n=ae(e,"id",19,Wn),s=ae(e,"type",3,"button"),l=ae(e,"ref",15,null),c=hr(e,["$$slots","$$events","$$legacy","child","children","disabled","id","type","value","ref"]);const a=QB({id:Ke.with(()=>n()),disabled:Ke.with(()=>t()??!1),value:Ke.with(()=>e.value),ref:Ke.with(()=>l(),k=>l(k))}),g=me(()=>Cn(c,a.props,{type:s()}));var v=We(),w=ue(v);{var P=k=>{var N=We(),D=ue(N);Ot(D,()=>e.child,()=>({props:S(g)})),Z(k,N)},I=k=>{var N=az();sn(N,()=>({...S(g)}));var D=Ae(N);Ot(D,()=>e.children??Ht),we(N),Z(k,N)};Ze(w,k=>{e.child?k(P):k(I,!1)})}Z(r,v),St()}function Q0(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"class",7),s=ae(e,"value",15),l=hr(e,["$$slots","$$events","$$legacy","ref","class","value"]);var c={get class(){return n()},set class(v){n(v)}},a=We(),g=ue(a);{let v=me(()=>_n("grid gap-1",n()));ar(g,()=>oB,(w,P)=>{P(w,zr({get class(){return S(v)}},()=>l,{get value(){return s()},set value(I){s(I)},get ref(){return t()},set ref(I){t(I)}}))})}return Z(r,a),St(c)}var cz=Fe('<div class="flex items-center justify-center"><!></div>');function jp(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{const c=(g,v)=>{let w=()=>v?.().checked;var P=cz(),I=Ae(P);{var k=N=>{dD(N,{class:"fill-primary size-3.5"})};Ze(I,N=>{w()&&N(k)})}we(P),Z(g,P)};let a=me(()=>_n("border-primary text-primary focus-visible:ring-ring aspect-square size-4 rounded-full border shadow focus:outline-none focus-visible:ring-1 disabled:cursor-not-allowed disabled:opacity-50",e.class));ar(l,()=>lB,(g,v)=>{v(g,zr({get class(){return S(a)}},()=>n,{get ref(){return t()},set ref(w){t(w)},children:c,$$slots:{default:!0}}))})}Z(r,s),St()}var _2=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Ns=r=>!r||typeof r!="object"||Object.keys(r).length===0,uz=(r,e)=>JSON.stringify(r)===JSON.stringify(e);function WP(r,e){r.forEach(function(t){Array.isArray(t)?WP(t,e):e.push(t)})}function $P(r){let e=[];return WP(r,e),e}var HP=(...r)=>$P(r).filter(Boolean),ZP=(r,e)=>{let t={},n=Object.keys(r),s=Object.keys(e);for(let l of n)if(s.includes(l)){let c=r[l],a=e[l];Array.isArray(c)||Array.isArray(a)?t[l]=HP(a,c):typeof c=="object"&&typeof a=="object"?t[l]=ZP(c,a):t[l]=a+" "+c}else t[l]=r[l];for(let l of s)n.includes(l)||(t[l]=e[l]);return t},y2=r=>!r||typeof r!="string"?r:r.replace(/\s+/g," ").trim();const J0="-",hz=r=>{const e=fz(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:c=>{const a=c.split(J0);return a[0]===""&&a.length!==1&&a.shift(),XP(a,e)||dz(c)},getConflictingClassGroupIds:(c,a)=>{const g=t[c]||[];return a&&n[c]?[...g,...n[c]]:g}}},XP=(r,e)=>{if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?XP(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const l=r.join(J0);return e.validators.find(({validator:c})=>c(l))?.classGroupId},v2=/^\[(.+)\]$/,dz=r=>{if(v2.test(r)){const e=v2.exec(r)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},fz=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return gz(Object.entries(r.classGroups),t).forEach(([l,c])=>{yx(c,n,l,e)}),n},yx=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const l=s===""?e:b2(e,s);l.classGroupId=t;return}if(typeof s=="function"){if(pz(s)){yx(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([l,c])=>{yx(c,b2(e,l),t,n)})})},b2=(r,e)=>{let t=r;return e.split(J0).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},pz=r=>r.isThemeGetter,gz=(r,e)=>e?r.map(([t,n])=>{const s=n.map(l=>typeof l=="string"?e+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([c,a])=>[e+c,a])):l);return[t,s]}):r,mz=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(l,c)=>{t.set(l,c),e++,e>r&&(e=0,n=t,t=new Map)};return{get(l){let c=t.get(l);if(c!==void 0)return c;if((c=n.get(l))!==void 0)return s(l,c),c},set(l,c){t.has(l)?t.set(l,c):s(l,c)}}},qP="!",_z=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,s=e[0],l=e.length,c=a=>{const g=[];let v=0,w=0,P;for(let B=0;B<a.length;B++){let U=a[B];if(v===0){if(U===s&&(n||a.slice(B,B+l)===e)){g.push(a.slice(w,B)),w=B+l;continue}if(U==="/"){P=B;continue}}U==="["?v++:U==="]"&&v--}const I=g.length===0?a:a.substring(w),k=I.startsWith(qP),N=k?I.substring(1):I,D=P&&P>w?P-w:void 0;return{modifiers:g,hasImportantModifier:k,baseClassName:N,maybePostfixModifierPosition:D}};return t?a=>t({className:a,parseClassName:c}):c},yz=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},vz=r=>({cache:mz(r.cacheSize),parseClassName:_z(r),...hz(r)}),bz=/\s+/,xz=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s}=e,l=[],c=r.trim().split(bz);let a="";for(let g=c.length-1;g>=0;g-=1){const v=c[g],{modifiers:w,hasImportantModifier:P,baseClassName:I,maybePostfixModifierPosition:k}=t(v);let N=!!k,D=n(N?I.substring(0,k):I);if(!D){if(!N){a=v+(a.length>0?" "+a:a);continue}if(D=n(I),!D){a=v+(a.length>0?" "+a:a);continue}N=!1}const B=yz(w).join(":"),U=P?B+qP:B,V=U+D;if(l.includes(V))continue;l.push(V);const L=s(D,N);for(let $=0;$<L.length;++$){const te=L[$];l.push(U+te)}a=v+(a.length>0?" "+a:a)}return a};function wz(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=GP(e))&&(n&&(n+=" "),n+=t);return n}const GP=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=GP(r[n]))&&(t&&(t+=" "),t+=e);return t};function vx(r,...e){let t,n,s,l=c;function c(g){const v=e.reduce((w,P)=>P(w),r());return t=vz(v),n=t.cache.get,s=t.cache.set,l=a,a(g)}function a(g){const v=n(g);if(v)return v;const w=xz(g,t);return s(g,w),w}return function(){return l(wz.apply(null,arguments))}}const ai=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},YP=/^\[(?:([a-z-]+):)?(.+)\]$/i,Tz=/^\d+\/\d+$/,Sz=new Set(["px","full","screen"]),Az=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ez=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Pz=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Iz=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Cz=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Xa=r=>od(r)||Sz.has(r)||Tz.test(r),Wl=r=>Fd(r,"length",Lz),od=r=>!!r&&!Number.isNaN(Number(r)),tb=r=>Fd(r,"number",od),Yf=r=>!!r&&Number.isInteger(Number(r)),Rz=r=>r.endsWith("%")&&od(r.slice(0,-1)),mn=r=>YP.test(r),$l=r=>Az.test(r),Mz=new Set(["length","size","percentage"]),kz=r=>Fd(r,Mz,KP),Dz=r=>Fd(r,"position",KP),Oz=new Set(["image","url"]),Fz=r=>Fd(r,Oz,zz),Nz=r=>Fd(r,"",Bz),Kf=()=>!0,Fd=(r,e,t)=>{const n=YP.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},Lz=r=>Ez.test(r)&&!Pz.test(r),KP=()=>!1,Bz=r=>Iz.test(r),zz=r=>Cz.test(r),bx=()=>{const r=ai("colors"),e=ai("spacing"),t=ai("blur"),n=ai("brightness"),s=ai("borderColor"),l=ai("borderRadius"),c=ai("borderSpacing"),a=ai("borderWidth"),g=ai("contrast"),v=ai("grayscale"),w=ai("hueRotate"),P=ai("invert"),I=ai("gap"),k=ai("gradientColorStops"),N=ai("gradientColorStopPositions"),D=ai("inset"),B=ai("margin"),U=ai("opacity"),V=ai("padding"),L=ai("saturate"),$=ai("scale"),te=ai("sepia"),G=ai("skew"),le=ai("space"),se=ai("translate"),oe=()=>["auto","contain","none"],be=()=>["auto","hidden","clip","visible","scroll"],xe=()=>["auto",mn,e],_e=()=>[mn,e],Ne=()=>["",Xa,Wl],fe=()=>["auto",od,mn],Le=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],tt=()=>["solid","dashed","dotted","double","none"],Ye=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],rt=()=>["start","end","center","between","around","evenly","stretch"],it=()=>["","0",mn],Ct=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[od,mn];return{cacheSize:500,separator:":",theme:{colors:[Kf],spacing:[Xa,Wl],blur:["none","",$l,mn],brightness:Mt(),borderColor:[r],borderRadius:["none","","full",$l,mn],borderSpacing:_e(),borderWidth:Ne(),contrast:Mt(),grayscale:it(),hueRotate:Mt(),invert:it(),gap:_e(),gradientColorStops:[r],gradientColorStopPositions:[Rz,Wl],inset:xe(),margin:xe(),opacity:Mt(),padding:_e(),saturate:Mt(),scale:Mt(),sepia:it(),skew:Mt(),space:_e(),translate:_e()},classGroups:{aspect:[{aspect:["auto","square","video",mn]}],container:["container"],columns:[{columns:[$l]}],"break-after":[{"break-after":Ct()}],"break-before":[{"break-before":Ct()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Le(),mn]}],overflow:[{overflow:be()}],"overflow-x":[{"overflow-x":be()}],"overflow-y":[{"overflow-y":be()}],overscroll:[{overscroll:oe()}],"overscroll-x":[{"overscroll-x":oe()}],"overscroll-y":[{"overscroll-y":oe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[D]}],"inset-x":[{"inset-x":[D]}],"inset-y":[{"inset-y":[D]}],start:[{start:[D]}],end:[{end:[D]}],top:[{top:[D]}],right:[{right:[D]}],bottom:[{bottom:[D]}],left:[{left:[D]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Yf,mn]}],basis:[{basis:xe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",mn]}],grow:[{grow:it()}],shrink:[{shrink:it()}],order:[{order:["first","last","none",Yf,mn]}],"grid-cols":[{"grid-cols":[Kf]}],"col-start-end":[{col:["auto",{span:["full",Yf,mn]},mn]}],"col-start":[{"col-start":fe()}],"col-end":[{"col-end":fe()}],"grid-rows":[{"grid-rows":[Kf]}],"row-start-end":[{row:["auto",{span:[Yf,mn]},mn]}],"row-start":[{"row-start":fe()}],"row-end":[{"row-end":fe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",mn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",mn]}],gap:[{gap:[I]}],"gap-x":[{"gap-x":[I]}],"gap-y":[{"gap-y":[I]}],"justify-content":[{justify:["normal",...rt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...rt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...rt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",mn,e]}],"min-w":[{"min-w":[mn,e,"min","max","fit"]}],"max-w":[{"max-w":[mn,e,"none","full","min","max","fit","prose",{screen:[$l]},$l]}],h:[{h:[mn,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[mn,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[mn,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[mn,e,"auto","min","max","fit"]}],"font-size":[{text:["base",$l,Wl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",tb]}],"font-family":[{font:[Kf]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",mn]}],"line-clamp":[{"line-clamp":["none",od,tb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Xa,mn]}],"list-image":[{"list-image":["none",mn]}],"list-style-type":[{list:["none","disc","decimal",mn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[U]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[U]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...tt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Xa,Wl]}],"underline-offset":[{"underline-offset":["auto",Xa,mn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_e()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",mn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",mn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[U]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Le(),Dz]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",kz]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Fz]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[N]}],"gradient-via-pos":[{via:[N]}],"gradient-to-pos":[{to:[N]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[U]}],"border-style":[{border:[...tt(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[U]}],"divide-style":[{divide:tt()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...tt()]}],"outline-offset":[{"outline-offset":[Xa,mn]}],"outline-w":[{outline:[Xa,Wl]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Ne()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[U]}],"ring-offset-w":[{"ring-offset":[Xa,Wl]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",$l,Nz]}],"shadow-color":[{shadow:[Kf]}],opacity:[{opacity:[U]}],"mix-blend":[{"mix-blend":[...Ye(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ye()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[g]}],"drop-shadow":[{"drop-shadow":["","none",$l,mn]}],grayscale:[{grayscale:[v]}],"hue-rotate":[{"hue-rotate":[w]}],invert:[{invert:[P]}],saturate:[{saturate:[L]}],sepia:[{sepia:[te]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[g]}],"backdrop-grayscale":[{"backdrop-grayscale":[v]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[w]}],"backdrop-invert":[{"backdrop-invert":[P]}],"backdrop-opacity":[{"backdrop-opacity":[U]}],"backdrop-saturate":[{"backdrop-saturate":[L]}],"backdrop-sepia":[{"backdrop-sepia":[te]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[c]}],"border-spacing-x":[{"border-spacing-x":[c]}],"border-spacing-y":[{"border-spacing-y":[c]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",mn]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",mn]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",mn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[$]}],"scale-x":[{"scale-x":[$]}],"scale-y":[{"scale-y":[$]}],rotate:[{rotate:[Yf,mn]}],"translate-x":[{"translate-x":[se]}],"translate-y":[{"translate-y":[se]}],"skew-x":[{"skew-x":[G]}],"skew-y":[{"skew-y":[G]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",mn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",mn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_e()}],"scroll-mx":[{"scroll-mx":_e()}],"scroll-my":[{"scroll-my":_e()}],"scroll-ms":[{"scroll-ms":_e()}],"scroll-me":[{"scroll-me":_e()}],"scroll-mt":[{"scroll-mt":_e()}],"scroll-mr":[{"scroll-mr":_e()}],"scroll-mb":[{"scroll-mb":_e()}],"scroll-ml":[{"scroll-ml":_e()}],"scroll-p":[{"scroll-p":_e()}],"scroll-px":[{"scroll-px":_e()}],"scroll-py":[{"scroll-py":_e()}],"scroll-ps":[{"scroll-ps":_e()}],"scroll-pe":[{"scroll-pe":_e()}],"scroll-pt":[{"scroll-pt":_e()}],"scroll-pr":[{"scroll-pr":_e()}],"scroll-pb":[{"scroll-pb":_e()}],"scroll-pl":[{"scroll-pl":_e()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",mn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Xa,Wl,tb]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Uz=(r,{cacheSize:e,prefix:t,separator:n,experimentalParseClassName:s,extend:l={},override:c={}})=>{cp(r,"cacheSize",e),cp(r,"prefix",t),cp(r,"separator",n),cp(r,"experimentalParseClassName",s);for(const a in c)Vz(r[a],c[a]);for(const a in l)jz(r[a],l[a]);return r},cp=(r,e,t)=>{t!==void 0&&(r[e]=t)},Vz=(r,e)=>{if(e)for(const t in e)cp(r,t,e[t])},jz=(r,e)=>{if(e)for(const t in e){const n=e[t];n!==void 0&&(r[t]=(r[t]||[]).concat(n))}},Wz=(r,...e)=>typeof r=="function"?vx(bx,r,...e):vx(()=>Uz(bx(),r),...e),$z=vx(bx);var Hz={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},QP=r=>r||void 0,Wp=(...r)=>QP($P(r).filter(Boolean).join(" ")),rb=null,Ya={},xx=!1,Qf=(...r)=>e=>e.twMerge?((!rb||xx)&&(xx=!1,rb=Ns(Ya)?$z:Wz({...Ya,extend:{theme:Ya.theme,classGroups:Ya.classGroups,conflictingClassGroupModifiers:Ya.conflictingClassGroupModifiers,conflictingClassGroups:Ya.conflictingClassGroups,...Ya.extend}})),QP(rb(Wp(r)))):Wp(r),x2=(r,e)=>{for(let t in e)r.hasOwnProperty(t)?r[t]=Wp(r[t],e[t]):r[t]=e[t];return r},Zz=(r,e)=>{let{extend:t=null,slots:n={},variants:s={},compoundVariants:l=[],compoundSlots:c=[],defaultVariants:a={}}=r,g={...Hz,...e},v=t!=null&&t.base?Wp(t.base,r?.base):r?.base,w=t!=null&&t.variants&&!Ns(t.variants)?ZP(s,t.variants):s,P=t!=null&&t.defaultVariants&&!Ns(t.defaultVariants)?{...t.defaultVariants,...a}:a;!Ns(g.twMergeConfig)&&!uz(g.twMergeConfig,Ya)&&(xx=!0,Ya=g.twMergeConfig);let I=Ns(t?.slots),k=Ns(n)?{}:{base:Wp(r?.base,I&&t?.base),...n},N=I?k:x2({...t?.slots},Ns(k)?{base:r?.base}:k),D=Ns(t?.compoundVariants)?l:HP(t?.compoundVariants,l),B=V=>{if(Ns(w)&&Ns(n)&&I)return Qf(v,V?.class,V?.className)(g);if(D&&!Array.isArray(D))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof D}`);if(c&&!Array.isArray(c))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof c}`);let L=(_e,Ne,fe=[],Le)=>{let tt=fe;if(typeof Ne=="string")tt=tt.concat(y2(Ne).split(" ").map(Ye=>`${_e}:${Ye}`));else if(Array.isArray(Ne))tt=tt.concat(Ne.reduce((Ye,rt)=>Ye.concat(`${_e}:${rt}`),[]));else if(typeof Ne=="object"&&typeof Le=="string"){for(let Ye in Ne)if(Ne.hasOwnProperty(Ye)&&Ye===Le){let rt=Ne[Ye];if(rt&&typeof rt=="string"){let it=y2(rt);tt[Le]?tt[Le]=tt[Le].concat(it.split(" ").map(Ct=>`${_e}:${Ct}`)):tt[Le]=it.split(" ").map(Ct=>`${_e}:${Ct}`)}else Array.isArray(rt)&&rt.length>0&&(tt[Le]=rt.reduce((it,Ct)=>it.concat(`${_e}:${Ct}`),[]))}}return tt},$=(_e,Ne=w,fe=null,Le=null)=>{var tt;let Ye=Ne[_e];if(!Ye||Ns(Ye))return null;let rt=(tt=Le?.[_e])!=null?tt:V?.[_e];if(rt===null)return null;let it=_2(rt),Ct=Array.isArray(g.responsiveVariants)&&g.responsiveVariants.length>0||g.responsiveVariants===!0,Mt=P?.[_e],jt=[];if(typeof it=="object"&&Ct)for(let[_r,wr]of Object.entries(it)){let Dr=Ye[wr];if(_r==="initial"){Mt=wr;continue}Array.isArray(g.responsiveVariants)&&!g.responsiveVariants.includes(_r)||(jt=L(_r,Dr,jt,fe))}let Gt=it!=null&&typeof it!="object"?it:_2(Mt),Or=Ye[Gt||"false"];return typeof jt=="object"&&typeof fe=="string"&&jt[fe]?x2(jt,Or):jt.length>0?(jt.push(Or),fe==="base"?jt.join(" "):jt):Or},te=()=>w?Object.keys(w).map(_e=>$(_e,w)):null,G=(_e,Ne)=>{if(!w||typeof w!="object")return null;let fe=new Array;for(let Le in w){let tt=$(Le,w,_e,Ne),Ye=_e==="base"&&typeof tt=="string"?tt:tt&&tt[_e];Ye&&(fe[fe.length]=Ye)}return fe},le={};for(let _e in V)V[_e]!==void 0&&(le[_e]=V[_e]);let se=(_e,Ne)=>{var fe;let Le=typeof V?.[_e]=="object"?{[_e]:(fe=V[_e])==null?void 0:fe.initial}:{};return{...P,...le,...Le,...Ne}},oe=(_e=[],Ne)=>{let fe=[];for(let{class:Le,className:tt,...Ye}of _e){let rt=!0;for(let[it,Ct]of Object.entries(Ye)){let Mt=se(it,Ne)[it];if(Array.isArray(Ct)){if(!Ct.includes(Mt)){rt=!1;break}}else{let jt=Gt=>Gt==null||Gt===!1;if(jt(Ct)&&jt(Mt))continue;if(Mt!==Ct){rt=!1;break}}}rt&&(Le&&fe.push(Le),tt&&fe.push(tt))}return fe},be=_e=>{let Ne=oe(D,_e);if(!Array.isArray(Ne))return Ne;let fe={};for(let Le of Ne)if(typeof Le=="string"&&(fe.base=Qf(fe.base,Le)(g)),typeof Le=="object")for(let[tt,Ye]of Object.entries(Le))fe[tt]=Qf(fe[tt],Ye)(g);return fe},xe=_e=>{if(c.length<1)return null;let Ne={};for(let{slots:fe=[],class:Le,className:tt,...Ye}of c){if(!Ns(Ye)){let rt=!0;for(let it of Object.keys(Ye)){let Ct=se(it,_e)[it];if(Ct===void 0||(Array.isArray(Ye[it])?!Ye[it].includes(Ct):Ye[it]!==Ct)){rt=!1;break}}if(!rt)continue}for(let rt of fe)Ne[rt]=Ne[rt]||[],Ne[rt].push([Le,tt])}return Ne};if(!Ns(n)||!I){let _e={};if(typeof N=="object"&&!Ns(N))for(let Ne of Object.keys(N))_e[Ne]=fe=>{var Le,tt;return Qf(N[Ne],G(Ne,fe),((Le=be(fe))!=null?Le:[])[Ne],((tt=xe(fe))!=null?tt:[])[Ne],fe?.class,fe?.className)(g)};return _e}return Qf(v,te(),oe(D),V?.class,V?.className)(g)},U=()=>{if(!(!w||typeof w!="object"))return Object.keys(w)};return B.variantKeys=U(),B.extend=t,B.base=v,B.slots=N,B.variants=w,B.defaultVariants=P,B.compoundSlots=c,B.compoundVariants=D,B};const wx=Zz({base:"focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",child:""},size:{default:"px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}});var Xz=Fe("<a><!></a>"),qz=Fe("<button><!></button>");function An(r,e){Tt(e,!0);let t=ae(e,"variant",3,"default"),n=ae(e,"size",3,"default"),s=ae(e,"ref",15,null),l=ae(e,"href",3,void 0),c=ae(e,"type",3,"button"),a=hr(e,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);var g=We(),v=ue(g);{var w=I=>{var k=Xz();sn(k,D=>({class:D,href:l(),...a}),[()=>_n(wx({variant:t(),size:n()}),e.class)]);var N=Ae(k);Ot(N,()=>e.children??Ht),we(k),as(k,D=>s(D),()=>s()),Z(I,k)},P=I=>{var k=qz();sn(k,D=>({class:D,type:c(),...a}),[()=>_n(wx({variant:t(),size:n()}),e.class)]);var N=Ae(k);Ot(N,()=>e.children??Ht),we(k),as(k,D=>s(D),()=>s()),Z(I,k)};Ze(v,I=>{l()?I(w):I(P,!1)})}Z(r,g),St()}function $p(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{let c=me(()=>_n("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e.class));ar(l,()=>FP,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)}}))})}Z(r,s),St()}const Gz=/^([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)$/,Yz=/^([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)$/,JP=r=>{if(!r)return;const e=r.match(Gz);if(e)return Ri([Number(e[3]),Number(e[1])],Number(e[5]));const t=r.match(Yz);if(t)return Ri([Number(t[3]),Number(t[1])])};function Ri(r,e){const{lat:t,lng:n}=qn.LngLat.convert(r),s=e==null?`${t},${n}`:`${t},${n},${e}`;return{label:s,match:{lat:t,lon:n,level:e,id:"",areas:[],type:"PLACE",name:s,tokens:[],score:0}}}const Um=(r,e)=>{if(!r||r.trim()==="")return{label:"",match:void 0};const t=JP(r);return t?(e&&(t.label=e,t.match.name=e),t):{label:e||"",match:{lat:0,lon:0,level:0,id:r,areas:[],type:"STOP",name:e||"",tokens:[],score:0}}},lc=r=>{switch(r.mode){case"WALK":return["walk","hsl(var(--foreground) / 1)","hsl(var(--background) / 1)"];case"BIKE":return["bike","hsl(var(--foreground) / 1)","hsl(var(--background) / 1)"];case"RENTAL":switch(r.rental?.formFactor){case"BICYCLE":return["bike","#075985","white"];case"CARGO_BICYCLE":return["cargo_bike","#075985","white"];case"CAR":return["car","#4c4947","white"];case"MOPED":return["moped","#075985","white"];case"SCOOTER_SEATED":return["seated_scooter","#075985","white"];case"SCOOTER_STANDING":return["scooter","#075985","white"];case"OTHER":default:return["other","#075985","white"]}case"CAR":case"CAR_PARKING":return["car","#4c4947","white"];case"FLEX":case"ODM":return["taxi","#fdb813","white"];case"TRANSIT":case"BUS":return["bus","#ff9800","white"];case"COACH":return["bus","#9ccc65","black"];case"TRAM":return["tram","#ebe717","white"];case"SUBURBAN":return["sbahn","#4caf50","white"];case"SUBWAY":return["ubahn","#3f51b5","white"];case"FERRY":return["ship","#00acc1","white"];case"AIRPLANE":return["plane","#90a4ae","white"];case"HIGHSPEED_RAIL":return["train","#9c27b0","white"];case"LONG_DISTANCE":return["train","#e91e63","white"];case"NIGHT_RAIL":return["train","#1a237e","white"];case"REGIONAL_FAST_RAIL":case"REGIONAL_RAIL":case"RAIL":return["train","#f44336","white"];case"FUNICULAR":return["funicular","#795548","white"];case"CABLE_CAR":return["tram","#795548","white"];case"AERIAL_LIFT":return["aerial_lift","#795548","white"]}return["train","#000000","white"]},nl=r=>{const[e,t,n]=lc(r);return!r.routeColor||r.routeColor==="000000"?[t,n]:["#"+r.routeColor,"#"+r.routeTextColor||"000000"]},w2=r=>`border-color: ${nl(r)[0]}`,Sy=r=>{const[e,t]=nl(r);return`background-color: ${e}; color: ${t}; fill: ${t}`},T2=(r,e=Ht)=>{const t=me(()=>lc({mode:e()})[0]),n=me(()=>lc({mode:e()})[1]);var s=Kz(),l=Ae(s),c=Ae(l);we(l),we(s),mt(()=>{wa(s,`background-color: ${S(n)??""}; fill: white;`),fy(c,"xlink:href",`#${S(t)}`)}),Z(r,s)};var Kz=Fe('<div class="rounded-full flex items-center justify-center p-1"><svg class="relative size-4 rounded-full"><use></use></svg></div>'),Qz=Fe('<img class="size-5"/>'),Jz=Fe('<div class="mt-1 ml-4 flex flex-row gap-1.5 items-center"></div>'),e6=Fe('<div class="flex items-center grow"><!> <div class="flex flex-col ml-4"><span class="font-semibold text-nowrap text-ellipsis overflow-hidden"> </span> <span class="text-muted-foreground text-nowrap text-ellipsis overflow-hidden"> </span></div></div> <!>',1),t6=Fe("<!> <!>",1);function Hp(r,e){Tt(e,!0);let t=ae(e,"items",31,()=>tn([])),n=ae(e,"selected",15),s=ae(e,"onChange",3,()=>{}),l=wt(""),c=wt("");const a=D=>{if(D){const B=D.areas.find(te=>te.matched),U=D.areas.find(te=>te.default);B?.name.match(/^[0-9]*$/)&&(B.name+=" "+U?.name);let V=(B??U)?.name;V==D.name&&(V=D.areas[0].name);const L=new Set;D.areas.forEach((te,G)=>{(te.matched||te.unique||te.default)&&L.add(G)});const $=Array.from(L);return $.sort((te,G)=>G-te),$.map(te=>D.areas[te].name).join(", ")}return""},g=D=>{const B=a(D);return B?D.name+", "+B:D.name},v=async()=>{const D=JP(S(l));if(D){n(D),t([]),s()(n());return}const B=e.place?qn.LngLat.convert(e.place):void 0,U=B?{place:`${B.lat},${B.lng}`}:{},{data:V,error:L}=await Ak({query:{...U,text:S(l),language:[eo],mode:e.transitModes,type:e.type}});if(L){console.error("TYPEAHEAD ERROR: ",L);return}t(V.map(te=>({label:g(te),match:te})));const $=new Set;t(t().filter(te=>{const G=te.match?.type+te.label;return $.has(G)?!1:($.add(G),!0)}))},w=D=>{const B=JSON.parse(D);return{match:B,label:g(B)}};kr(()=>{n()&&(pe(c,JSON.stringify(n().match),!0),pe(l,n().label,!0))});let P=wt(null);kr(()=>{S(P)&&S(l)&&(S(P).value=S(l))});let I;kr(()=>{S(l)&&(clearTimeout(I),I=setTimeout(()=>{v()},150))});var k=We(),N=ue(k);ar(N,()=>p4,(D,B)=>{B(D,{type:"single",allowDeselect:!1,get value(){return S(c)},onValueChange:U=>{U&&(n(w(U)),pe(l,n().label,!0),s()(n()))},children:(U,V)=>{var L=t6(),$=ue(L);ar($,()=>y4,(le,se)=>{se(le,{get placeholder(){return e.placeholder},get name(){return e.name},class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",autocomplete:"off",oninput:oe=>pe(l,oe.currentTarget.value,!0),get"aria-label"(){return e.placeholder},get"data-combobox-input"(){return S(l)},get ref(){return S(P)},set ref(oe){pe(P,oe,!0)}})});var te=ve($,2);{var G=le=>{var se=We(),oe=ue(se);ar(oe,()=>O0,(be,xe)=>{xe(be,{children:(_e,Ne)=>{var fe=We(),Le=ue(fe);ar(Le,()=>DP,(tt,Ye)=>{Ye(tt,{align:"start",class:"absolute top-2 w-[var(--bits-combobox-anchor-width)] z-10 overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md outline-none",children:(rt,it)=>{var Ct=We(),Mt=ue(Ct);xn(Mt,17,t,jt=>jt.match,(jt,Gt)=>{var Or=We(),_r=ue(Or);{let wr=me(()=>JSON.stringify(S(Gt).match));ar(_r,()=>OP,(Dr,Et)=>{Et(Dr,{class:"flex w-full cursor-default select-none rounded-sm py-4 pl-4 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:opacity-50",get value(){return S(wr)},get label(){return S(Gt).label},children:(vt,Pr)=>{var yr=e6(),Ar=ue(yr),br=Ae(Ar);{var lr=nr=>{T2(nr,()=>S(Gt).match.modes?.length?S(Gt).match.modes[0]:"BUS")},ut=nr=>{var rr=We(),Nr=ue(rr);{var Cr=ir=>{gD(ir,{class:"size-5"})},qr=ir=>{var or=We(),Re=ue(or);{var Y=ee=>{var ie=We(),Te=ue(ie);{var Ce=Ge=>{mD(Ge,{class:"size-5"})},Be=Ge=>{var Ve=Qz();mt(()=>{Fn(Ve,"src",`icons/${S(Gt).match?.category}.svg`),Fn(Ve,"alt",S(Gt).match?.category)}),Z(Ge,Ve)};Ze(Te,Ge=>{!S(Gt).match?.category||S(Gt).match?.category=="none"?Ge(Ce):Ge(Be,!1)})}Z(ee,ie)};Ze(Re,ee=>{S(Gt).match?.type=="PLACE"&&ee(Y)},!0)}Z(ir,or)};Ze(Nr,ir=>{S(Gt).match?.type=="ADDRESS"?ir(Cr):ir(qr,!1)},!0)}Z(nr,rr)};Ze(br,nr=>{S(Gt).match?.type=="STOP"?nr(lr):nr(ut,!1)})}var Zt=ve(br,2),dr=Ae(Zt),er=Ae(dr,!0);we(dr);var Bt=ve(dr,2),mr=Ae(Bt,!0);we(Bt),we(Zt),we(Ar);var Tr=ve(Ar,2);{var fr=nr=>{var rr=Jz();xn(rr,21,()=>S(Gt).match.modes,di,(Nr,Cr)=>{T2(Nr,()=>S(Cr))}),we(rr),Z(nr,rr)};Ze(Tr,nr=>{S(Gt).match?.type=="STOP"&&nr(fr)})}mt(nr=>{pt(er,S(Gt).match?.name),pt(mr,nr)},[()=>a(S(Gt).match)]),Z(vt,yr)},$$slots:{default:!0}})})}Z(jt,Or)}),Z(rt,Ct)},$$slots:{default:!0}})}),Z(_e,fe)},$$slots:{default:!0}})}),Z(le,se)};Ze(te,le=>{t().length!==0&&le(G)})}Z(U,L)},$$slots:{default:!0}})}),Z(r,k),St()}var r6=Fe('<span class="absolute right-2 flex size-3.5 items-center justify-center"><!></span> <!>',1);function Jc(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","value","label","children"]);var s=We(),l=ue(s);{const c=(g,v)=>{let w=()=>v?.().selected,P=()=>v?.().highlighted;var I=r6(),k=ue(I),N=Ae(k);{var D=L=>{uD(L,{class:"size-4"})};Ze(N,L=>{w()&&L(D)})}we(k);var B=ve(k,2);{var U=L=>{var $=We(),te=ue($);Ot(te,()=>e.children,()=>({selected:w(),highlighted:P()})),Z(L,$)},V=L=>{var $=Br();mt(()=>pt($,e.label||e.value)),Z(L,$)};Ze(B,L=>{e.children?L(U):L(V,!1)})}Z(g,I)};let a=me(()=>_n("data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e.class));ar(l,()=>OP,(g,v)=>{v(g,zr({get value(){return e.value},get class(){return S(a)}},()=>n,{get ref(){return t()},set ref(w){t(w)},children:c,$$slots:{default:!0}}))})}Z(r,s),St()}var n6=Fe("<!> <!> <!>",1);function eu(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"sideOffset",3,4),s=hr(e,["$$slots","$$events","$$legacy","ref","class","sideOffset","portalProps","children"]);var l=We(),c=ue(l);ar(c,()=>O0,(a,g)=>{g(a,zr(()=>e.portalProps,{children:(v,w)=>{var P=We(),I=ue(P);{let k=me(()=>_n("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border shadow-md data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e.class));ar(I,()=>DP,(N,D)=>{D(N,zr({get sideOffset(){return n()},get class(){return S(k)}},()=>s,{get ref(){return t()},set ref(B){t(B)},children:(B,U)=>{var V=n6(),L=ue(V);ar(L,()=>o6,(G,le)=>{le(G,{})});var $=ve(L,2);{let G=me(()=>_n("h-[var(--bits-select-anchor-height)] w-full min-w-[var(--bits-select-anchor-width)] p-1"));ar($,()=>D4,(le,se)=>{se(le,{get class(){return S(G)},children:(oe,be)=>{var xe=We(),_e=ue(xe);Ot(_e,()=>e.children??Ht),Z(oe,xe)},$$slots:{default:!0}})})}var te=ve($,2);ar(te,()=>s6,(G,le)=>{le(G,{})}),Z(B,V)},$$slots:{default:!0}}))})}Z(v,P)},$$slots:{default:!0}}))}),Z(r,l),St()}var i6=Fe("<!> <!>",1);function tu(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=We(),l=ue(s);{let c=me(()=>_n("border-input ring-offset-background data-[placeholder]:text-muted-foreground focus:ring-ring flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e.class));ar(l,()=>dB,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)},children:(v,w)=>{var P=i6(),I=ue(P);Ot(I,()=>e.children??Ht);var k=ve(I,2);py(k,{class:"size-4 opacity-50"}),Z(v,P)},$$slots:{default:!0}}))})}Z(r,s),St()}function Vm(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"orientation",3,"horizontal"),s=hr(e,["$$slots","$$events","$$legacy","ref","class","orientation"]);var l=We(),c=ue(l);{let a=me(()=>_n("bg-border shrink-0",n()==="horizontal"?"h-[1px] w-full":"min-h-full w-[1px]",e.class));ar(c,()=>T4,(g,v)=>{v(g,zr({get class(){return S(a)},get orientation(){return n()}},()=>s,{get ref(){return t()},set ref(w){t(w)}}))})}Z(r,l),St()}function s6(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{let c=me(()=>_n("flex cursor-default items-center justify-center py-1",e.class));ar(l,()=>N4,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)},children:(v,w)=>{py(v,{class:"size-4"})},$$slots:{default:!0}}))})}Z(r,s),St()}function o6(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{let c=me(()=>_n("flex cursor-default items-center justify-center py-1",e.class));ar(l,()=>z4,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)},children:(v,w)=>{FE(v,{class:"size-4"})},$$slots:{default:!0}}))})}Z(r,s),St()}const ru=uB;var a6=Fe('<div class="flex items-center space-x-3 my-2"><!> <!></div>');function up(r,e){Tt(e,!0);let t=ae(e,"checked",15,!1);var n=a6(),s=Ae(n);{let c=me(()=>_n("peer inline-flex h-[21px] min-h-[21px] w-[45px] shrink-0 cursor-pointer items-center rounded-full px-[3px] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-foreground data-[state=unchecked]:bg-border data-[state=unchecked]:shadow-mini-inset dark:data-[state=checked]:bg-foreground",e.class));ar(s,()=>VB,(a,g)=>{g(a,{get id(){return e.id},get disabled(){return e.disabled},get class(){return S(c)},get onCheckedChange(){return e.onCheckedChange},get checked(){return t()},set checked(v){t(v)},children:(v,w)=>{var P=We(),I=ue(P);ar(I,()=>WB,(k,N)=>{N(k,{class:"pointer-events-none block size-[15px] shrink-0 rounded-full bg-background transition-transform data-[state=checked]:translate-x-6 data-[state=unchecked]:translate-x-0 data-[state=unchecked]:shadow-mini dark:border dark:border-background/30 dark:bg-foreground dark:shadow-popover dark:data-[state=unchecked]:border"})}),Z(v,P)},$$slots:{default:!0}})})}var l=ve(s,2);ar(l,()=>FP,(c,a)=>{a(c,{get for(){return e.id},class:"text-sm font-medium",children:(g,v)=>{Yr();var w=Br();mt(()=>pt(w,e.label)),Z(g,w)},$$slots:{default:!0}})}),we(n),Z(r,n),St()}const hi={time:void 0,fromPlace:void 0,toPlace:void 0,via:void 0,viaMinimumStay:void 0,arriveBy:!1,timetableView:!0,withFares:!1,searchWindow:900,pedestrianProfile:"FOOT",transitModes:["TRANSIT"],preTransitModes:["WALK"],postTransitModes:["WALK"],directModes:["WALK"],preTransitRentalFormFactors:[],postTransitRentalFormFactors:[],directRentalFormFactors:[],preTransitRentalProviderGroups:[],postTransitRentalProviderGroups:[],directRentalProviderGroups:[],preTransitRentalPropulsionTypes:[],postTransitRentalPropulsionTypes:[],directRentalPropulsionTypes:[],ignorePreTransitRentalReturnConstraints:!1,ignorePostTransitRentalReturnConstraints:!1,ignoreDirectRentalReturnConstraints:!1,requireBikeTransport:!1,requireCarTransport:!1,elevationCosts:"NONE",useRoutedTransfers:!1,joinInterlinedLegs:!0,maxMatchingDistance:25,maxTransfers:14,maxTravelTime:1800,maxPreTransitTime:900,maxPostTransitTime:900,maxDirectTime:1800,fastestDirectFactor:1,additionalTransferTime:0,transferTimeFactor:1,numItineraries:5,circleResolution:void 0,maxItineraries:void 0,passengers:1,luggage:0,slowDirect:!1,isochronesDisplayLevel:"GEOMETRY_CIRCLES",isochronesColor:"#ffff00",isochronesOpacity:250,algorithm:"PONG"},l6=r=>{const e={...r};return Object.keys(e).forEach(t=>{if(t in hi){const n=e[t],s=hi[t];JSON.stringify(n)===JSON.stringify(s)&&delete e[t]}else console.warn(`Unknown query parameter: ${t}`)}),e},Bs=r=>{let e=Math.floor(r/3600),t=Math.ceil((r-e*3600)/60);return t===60&&(e+=1,t=0),[e!==0?e+" h":"",t!==0||e===0?t+" min":""].join(" ").trim()},c6=r=>{if(!r)return"";const e=Math.floor(r/1e3),t=e>5?0:Math.ceil(r-e*1e3);return[e!==0?e+" km":"",t!==0?t+" m":""].join(" ").trim()},p_=["WALK","BIKE","CAR","FLEX","CAR_DROPOFF","CAR_PARKING","RENTAL_BICYCLE","RENTAL_CARGO_BICYCLE","RENTAL_CAR","RENTAL_MOPED","RENTAL_SCOOTER_STANDING","RENTAL_SCOOTER_SEATED","RENTAL_OTHER"],nb=(r,e)=>r.filter(t=>p_.includes(t)).map(t=>t).concat(e.map(t=>`RENTAL_${t}`)),g_=r=>r.filter(e=>e.startsWith("RENTAL_")).map(e=>e.replace("RENTAL_","")),Jf=r=>{const e=r.some(n=>n.startsWith("RENTAL_"))?["RENTAL"]:[];return[...r.filter(n=>!n.startsWith("RENTAL_")),...e].map(n=>n)},U_=["AIRPLANE","HIGHSPEED_RAIL","LONG_DISTANCE","NIGHT_RAIL","COACH","REGIONAL_FAST_RAIL","REGIONAL_RAIL","SUBURBAN","SUBWAY","TRAM","BUS","FERRY","ODM","FUNICULAR","AERIAL_LIFT","OTHER"];var u6=Fe('<div class="w-full text-right pr-4"> </div>'),h6=Fe('<div class="w-full text-right pr-2"> </div>'),d6=Fe("<!> <!>",1);function Tx(r,e){Tt(e,!0);let t=ae(e,"value",15),n=ae(e,"labelFormatter",3,g=>g.toString());var s=We(),l=ue(s),c=()=>t().toString(),a=g=>t(parseInt(g));ar(l,()=>ru,(g,v)=>{v(g,{type:"single",get value(){return c()},set value(w){a(w)},get items(){return e.possibleValues},children:(w,P)=>{var I=d6(),k=ue(I);ar(k,()=>tu,(D,B)=>{B(D,{class:"flex items-center w-full overflow-hidden","aria-label":"max travel time",children:(U,V)=>{var L=u6(),$=Ae(L,!0);we(L),mt(te=>pt($,te),[()=>n()(t())]),Z(U,L)},$$slots:{default:!0}})});var N=ve(k,2);ar(N,()=>eu,(D,B)=>{B(D,{align:"end",children:(U,V)=>{var L=We(),$=ue(L);xn($,19,()=>e.possibleValues,(te,G)=>G+te.value,(te,G)=>{var le=We(),se=ue(le);ar(se,()=>Jc,(oe,be)=>{be(oe,{get value(){return S(G).value},get label(){return S(G).label},children:(xe,_e)=>{var Ne=h6(),fe=Ae(Ne,!0);we(Ne),mt(()=>pt(fe,S(G).label)),Z(xe,Ne)},$$slots:{default:!0}})}),Z(te,le)}),Z(U,L)},$$slots:{default:!0}})}),Z(w,I)},$$slots:{default:!0}})}),Z(r,s),St()}const S2="BICYCLE",f6=["station","vehicle","cluster"],p6="icons/rental/",$o={BICYCLE:{svg:"bike",station:"bike_station",vehicle:"floating_bike",cluster:"floating_bike_cluster",label:yt.bike},CARGO_BICYCLE:{svg:"cargo_bike",station:"cargo_bike_station",vehicle:"floating_cargo_bike",cluster:"floating_cargo_bike_cluster",label:yt.cargoBike},CAR:{svg:"car",station:"car_station",vehicle:"floating_car",cluster:"floating_car_cluster",label:yt.car},MOPED:{svg:"moped",station:"moped_station",vehicle:"floating_moped",cluster:"floating_moped_cluster",label:yt.moped},SCOOTER_SEATED:{svg:"seated_scooter",station:"seated_scooter_station",vehicle:"floating_seated_scooter",cluster:"floating_seated_scooter_cluster",label:yt.scooterSeated},SCOOTER_STANDING:{svg:"scooter",station:"scooter_station",vehicle:"floating_scooter",cluster:"floating_scooter_cluster",label:yt.scooterStanding},OTHER:{svg:"other",station:"other_station",vehicle:"floating_other",cluster:"floating_other_cluster",label:yt.unknownVehicleType}},eI={ELECTRIC:{component:ZT,title:yt.electric},ELECTRIC_ASSIST:{component:ZT,title:yt.electricAssist},HYBRID:{component:HT,title:yt.hybrid},PLUG_IN_HYBRID:{component:HT,title:yt.plugInHybrid},COMBUSTION:{component:qv,title:yt.combustion},COMBUSTION_DIESEL:{component:qv,title:yt.combustionDiesel},HYDROGEN_FUEL_CELL:{component:qv,title:yt.hydrogenFuelCell},HUMAN:null},tI={ANY_STATION:{component:pD,title:yt.returnOnlyAtStations},ROUNDTRIP_STATION:{component:yD,title:yt.roundtripStationReturnConstraint},NONE:null},rI=(r,e)=>$o[r][e],g6=(r,e)=>`${p6}${rI(r,e)}.svg`,m6={station:{width:43,height:44},vehicle:{width:27,height:27},cluster:{width:35,height:36}},_6=r=>m6[r];async function y6(r,e,t){const n=await fetch(r);if(!n.ok)throw new Error(`Failed to load icon: ${n.status} ${n.statusText}`);const s=await n.text(),c=new DOMParser().parseFromString(s,"image/svg+xml");if(c.getElementsByTagName("parsererror").length>0)throw new Error("Invalid SVG content");const a=c.documentElement;if(!(a instanceof SVGSVGElement))throw new Error("Provided file is not an SVG");const g=a;g.getAttribute("xmlns")||g.setAttribute("xmlns","http://www.w3.org/2000/svg");const v=g.getAttribute("style"),w=`color: ${e}`,P=v?`${v};${w}`:w;g.setAttribute("style",P),g.setAttribute("color",e),g.setAttribute("width",`${t.width}`),g.setAttribute("height",`${t.height}`);const k=new XMLSerializer().serializeToString(c),N=new Blob([k],{type:"image/svg+xml;charset=utf-8"});if(typeof createImageBitmap=="function")try{return await createImageBitmap(N)}catch{}return await new Promise((D,B)=>{const U=URL.createObjectURL(N),V=new Image;V.crossOrigin="anonymous",V.decoding="async",V.onload=()=>{URL.revokeObjectURL(U),t&&(V.width=t.width,V.height=t.height),D(V)},V.onerror=()=>{URL.revokeObjectURL(U),B(new Error("Failed to load generated image"))},V.src=U})}const ew=r=>["interpolate",["linear"],["zoom"],14,r*.6,18,r],ib=ew(1),v6=ew(12),b6=ew(10),x6=r=>["interpolate",["linear"],["zoom"],14,["literal",[r[0]*.8,r[1]*.9]],18,["literal",r]],A2=x6([.8,-1.25]),da="#2563eb";var w6=Fe("<span> </span>"),T6=Fe("<!> <!>",1),S6=Fe("<!> <!>",1),A6=Fe("<span> </span>"),E6=l0('<svg class="h-4 w-4 fill-current" aria-hidden="true" focusable="false"><use></use></svg>'),P6=Fe('<div class="flex items-center gap-1"></div>'),I6=Fe('<div class="flex w-full items-center justify-between gap-2"><span class="truncate"> </span> <!></div>'),C6=Fe("<!> <!>",1),R6=Fe('<div class="grid grid-cols-[1fr_2fr_1fr] items-center gap-2"><div class="text-sm"> </div> <!> <!> <div> </div> <div><!></div> <div><!></div></div>');function sb(r,e){Tt(e,!0);let t=ae(e,"modes",15),n=ae(e,"maxTransitTime",15),s=ae(e,"ignoreRentalReturnConstraints",15),l=ae(e,"providerGroups",15);const c=e.possibleModes.map(fe=>({value:fe,label:yt[fe]})),a=tD(()=>({queryKey:["rentalProviderGroups"],queryFn:async()=>{const{data:fe,error:Le}=await TE({query:{withProviders:!1}});if(Le)throw Le;return fe},staleTime:0})),g=me(()=>(a.data?.providerGroups||[]).map(fe=>({id:fe.id,name:fe.name,color:fe.color??da,formFactors:fe.formFactors})).sort((fe,Le)=>fe.name.localeCompare(Le.name))),v=me(()=>g_(t())),w=me(()=>S(v).length===0?S(g):S(g).filter(fe=>fe.formFactors.some(Le=>S(v).includes(Le)))),P=fe=>fe.some(Le=>Le.startsWith("RENTAL_")),I=me(()=>P(t()));kr(()=>{if(!S(w).length)return;const fe=Array.from(new Set(l()));if(fe.length!==l().length){l(fe);return}const Le=new Set(S(w).map(Ye=>Ye.id)),tt=fe.filter(Ye=>Le.has(Ye));if(tt.length!==fe.length){l(tt);return}tt.length&&tt.length===Le.size&&l([])});const k=me(()=>c.filter(fe=>t()?.includes(fe.value)).map(fe=>fe.label).join(", ")),N=me(()=>{const fe=S(w).filter(Le=>l().includes(Le.id)).map(Le=>Le.name);return fe.length?fe.join(", "):yt.defaultSelectedProviders});var D=R6(),B=Ae(D),U=Ae(B,!0);we(B);var V=ve(B,2);ar(V,()=>ru,(fe,Le)=>{Le(fe,{get disabled(){return e.disabled},type:"multiple",get value(){return t()},set value(tt){t(tt)},children:(tt,Ye)=>{var rt=T6(),it=ue(rt);ar(it,()=>tu,(Mt,jt)=>{jt(Mt,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return e.label},children:(Gt,Or)=>{var _r=w6(),wr=Ae(_r,!0);we(_r),mt(()=>pt(wr,S(k))),Z(Gt,_r)},$$slots:{default:!0}})});var Ct=ve(it,2);ar(Ct,()=>eu,(Mt,jt)=>{jt(Mt,{sideOffset:10,children:(Gt,Or)=>{var _r=We(),wr=ue(_r);xn(wr,19,()=>e.possibleModes,(Dr,Et)=>Et+Dr,(Dr,Et)=>{var vt=We(),Pr=ue(vt);ar(Pr,()=>Jc,(yr,Ar)=>{Ar(yr,{get value(){return S(Et)},get label(){return yt[S(Et)]},children:(br,lr)=>{Yr();var ut=Br();mt(()=>pt(ut,yt[S(Et)])),Z(br,ut)},$$slots:{default:!0}})}),Z(Dr,vt)}),Z(Gt,_r)},$$slots:{default:!0}})}),Z(tt,rt)},$$slots:{default:!0}})});var L=ve(V,2),$=()=>n().toString(),te=fe=>n(parseInt(fe));ar(L,()=>ru,(fe,Le)=>{Le(fe,{get disabled(){return e.disabled},type:"single",get value(){return $()},set value(tt){te(tt)},children:(tt,Ye)=>{var rt=S6(),it=ue(rt);ar(it,()=>tu,(Mt,jt)=>{jt(Mt,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return yt.routingSegments.maxPreTransitTime},children:(Gt,Or)=>{Yr();var _r=Br();mt(wr=>pt(_r,wr),[()=>Bs(n())]),Z(Gt,_r)},$$slots:{default:!0}})});var Ct=ve(it,2);ar(Ct,()=>eu,(Mt,jt)=>{jt(Mt,{sideOffset:10,children:(Gt,Or)=>{var _r=We(),wr=ue(_r);xn(wr,16,()=>e.possibleMaxTransitTime,Dr=>Dr,(Dr,Et)=>{var vt=We(),Pr=ue(vt);{let yr=me(()=>`${Et}`),Ar=me(()=>Bs(Et));ar(Pr,()=>Jc,(br,lr)=>{lr(br,{get value(){return S(yr)},get label(){return S(Ar)},children:(ut,Zt)=>{Yr();var dr=Br();mt(er=>pt(dr,er),[()=>Bs(Et)]),Z(ut,dr)},$$slots:{default:!0}})})}Z(Dr,vt)}),Z(Gt,_r)},$$slots:{default:!0}})}),Z(tt,rt)},$$slots:{default:!0}})});var G=ve(L,2),le=Ae(G,!0);we(G);var se=ve(G,2),oe=Ae(se);ar(oe,()=>ru,(fe,Le)=>{Le(fe,{get disabled(){return e.disabled},type:"multiple",get value(){return l()},set value(tt){l(tt)},children:(tt,Ye)=>{var rt=C6(),it=ue(rt);ar(it,()=>tu,(Mt,jt)=>{jt(Mt,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return yt.sharingProviders},children:(Gt,Or)=>{var _r=A6(),wr=Ae(_r,!0);we(_r),mt(()=>pt(wr,S(N))),Z(Gt,_r)},$$slots:{default:!0}})});var Ct=ve(it,2);ar(Ct,()=>eu,(Mt,jt)=>{jt(Mt,{sideOffset:10,class:"max-w-[100svw]",children:(Gt,Or)=>{var _r=We(),wr=ue(_r);xn(wr,17,()=>S(w),Dr=>Dr.id,(Dr,Et)=>{var vt=We(),Pr=ue(vt);ar(Pr,()=>Jc,(yr,Ar)=>{Ar(yr,{get value(){return S(Et).id},get label(){return S(Et).name},children:(br,lr)=>{var ut=I6(),Zt=Ae(ut),dr=Ae(Zt,!0);we(Zt);var er=ve(Zt,2);{var Bt=mr=>{var Tr=P6();xn(Tr,20,()=>Array.from(new Set(S(Et).formFactors.map(fr=>$o[fr].svg))).sort(),fr=>fr,(fr,nr)=>{var rr=E6(),Nr=Ae(rr);we(rr),mt(()=>Fn(Nr,"href",`#${nr}`)),Z(fr,rr)}),we(Tr),mt(()=>wa(Tr,`color: ${S(Et).color}`)),Z(mr,Tr)};Ze(er,mr=>{S(Et).formFactors.length&&mr(Bt)})}we(ut),mt(()=>pt(dr,S(Et).name)),Z(br,ut)},$$slots:{default:!0}})}),Z(Dr,vt)}),Z(Gt,_r)},$$slots:{default:!0}})}),Z(tt,rt)},$$slots:{default:!0}})}),we(se);var be=ve(se,2),xe=Ae(be),_e=()=>!s(),Ne=fe=>s(!fe);up(xe,{get disabled(){return e.disabled},get checked(){return _e()},set checked(fe){Ne(fe)},get label(){return yt.considerRentalReturnConstraints},id:"ignorePreTransitRentalReturnConstraints"}),we(be),we(D),mt((fe,Le,tt)=>{pt(U,e.label),fi(G,1,fe),pt(le,yt.sharingProviders),fi(se,1,Le),fi(be,1,tt)},[()=>bo(_n("text-sm",S(I)||"hidden")),()=>bo(_n("col-span-2 col-start-2",S(I)||"hidden")),()=>bo(_n("col-span-2 col-start-2",S(I)||"hidden"))]),Z(r,D),St()}var M6=Fe("<!> ",1),k6=Fe("<!> <!>",1);function D6(r,e){Tt(e,!0);let t=ae(e,"transitModes",15);const n=U_.map(a=>({value:a,label:yt[a]})),s=me(()=>t().length==U_.length||t().includes("TRANSIT")?yt.defaultSelectedModes:n.filter(a=>t()?.includes(a.value)).map(a=>a.label).join(", "));var l=We(),c=ue(l);ar(c,()=>ru,(a,g)=>{g(a,{type:"multiple",get value(){return t()},set value(v){t(v)},children:(v,w)=>{var P=k6(),I=ue(P);ar(I,()=>tu,(N,D)=>{D(N,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return yt.selectTransitModes},children:(B,U)=>{var V=M6(),L=ue(V);cD(L,{class:"mr-[9px] size-6 text-muted-foreground shrink-0"});var $=ve(L);mt(()=>pt($,` ${S(s)??""}`)),Z(B,V)},$$slots:{default:!0}})});var k=ve(I,2);ar(k,()=>eu,(N,D)=>{D(N,{sideOffset:10,children:(B,U)=>{var V=We(),L=ue(V);xn(L,19,()=>n,($,te)=>te+$.value,($,te)=>{var G=We(),le=ue(G);ar(le,()=>Jc,(se,oe)=>{oe(se,{get value(){return S(te).value},get label(){return S(te).label},children:(be,xe)=>{Yr();var _e=Br();mt(()=>pt(_e,S(te).label)),Z(be,_e)},$$slots:{default:!0}})}),Z($,G)}),Z(B,V)},$$slots:{default:!0}})}),Z(v,P)},$$slots:{default:!0}})}),Z(r,l),St()}const V_=r=>{const e=[];let t=1;for(;t<=r/60;)e.push(t*60),t<5?t+=4:t<30?t+=5:t<60?t+=10:t<120?t+=30:t+=60;return e[e.length-1]!==r&&e.push(r),e};var O6=Fe('<div class="flex gap-2 items-start"><div class="grow flex flex-col gap-1"><div class="flex gap-2"><div class="grow"><!></div> <div class="w-24"><!></div></div></div> <!></div>'),F6=Fe('<div class="space-y-2"><div class="flex items-center justify-between"><div class="text-sm"> </div> <!></div> <div class="space-y-2"></div></div>');function N6(r,e){Tt(e,!0);let t=ae(e,"via",15),n=ae(e,"viaMinimumStay",15),s=ae(e,"viaLabels",15);const l=me(()=>[0,...V_(7200)]),c=me(()=>S(l).map(B=>({value:B.toString(),label:Bs(B)})));let a=wt(tn(t()?.map((B,U)=>({match:t()[U],stay:n()?.[U]??0}))??[]));const g=()=>{S(a).push({stay:0,match:{label:"",match:void 0}})},v=B=>{pe(a,S(a).filter((U,V)=>V!==B),!0)};kr(()=>{const B=S(a).filter(G=>G.match?.match?.id).map(G=>ps(G)),U=ps(t()),V=B.length>0?B.map(G=>G.match):void 0;JSON.stringify(V)!=JSON.stringify(U)&&t(V);const L=ps(n()),$=B.length>0?B.map(G=>G.stay):void 0;JSON.stringify($)!=JSON.stringify(L)&&n($);const te={};B.forEach((G,le)=>{te[`viaLabel${le}`]=G.match.label}),Object.keys(s()).forEach(G=>{G in te||delete s()[G]}),Object.keys(te).forEach(G=>{s()[G]!==te[G]&&s(s()[G]=te[G],!0)})});var w=F6(),P=Ae(w),I=Ae(P),k=Ae(I,!0);we(I);var N=ve(I,2);{let B=me(()=>S(a).length>=2);An(N,{variant:"outline",onclick:g,get disabled(){return S(B)},children:(U,V)=>{Yr();var L=Br();mt(()=>pt(L,yt.addViaStop)),Z(U,L)},$$slots:{default:!0}})}we(P);var D=ve(P,2);xn(D,21,()=>S(a),di,(B,U,V)=>{var L=O6(),$=Ae(L),te=Ae($),G=Ae(te),le=Ae(G);Hp(le,{get placeholder(){return yt.viaStop},name:`via-${V}`,type:"STOP",get selected(){return S(a)[V].match},set selected(xe){S(a)[V].match=xe}}),we(G);var se=ve(G,2),oe=Ae(se);Tx(oe,{get possibleValues(){return S(c)},get labelFormatter(){return Bs},get value(){return S(a)[V].stay},set value(xe){S(a)[V].stay=xe}}),we(se),we(te),we($);var be=ve($,2);An(be,{variant:"ghost",size:"icon",onclick:()=>v(V),get"aria-label"(){return yt.removeViaStop},children:(xe,_e)=>{Kc(xe,{class:"size-4"})},$$slots:{default:!0}}),we(L),Z(B,L)}),we(D),we(w),mt(()=>pt(k,yt.viaStops)),Z(r,w),St()}var L6=Fe(" <!>",1),B6=Fe('<div class="text-sm"> </div> <!>',1),z6=Fe("<!> <!>",1),U6=Fe('<div class="w-full space-y-4"><!> <div class="space-y-2"><!> <!> <!> <!> <!> <div><div class="text-sm"> </div> <!> <!></div> <!> <!> <!></div> <div class="grid grid-cols-2 items-center"><div class="text-sm"> </div> <!></div> <!></div>'),V6=Fe("<!> <!>",1);function nI(r,e){Tt(e,!0);let t=ae(e,"useRoutedTransfers",15),n=ae(e,"wheelchair",15),s=ae(e,"requireBikeTransport",15),l=ae(e,"requireCarTransport",15),c=ae(e,"transitModes",15),a=ae(e,"maxTransfers",15),g=ae(e,"maxTravelTime",15,void 0),v=ae(e,"possibleMaxTravelTimes",19,()=>[]),w=ae(e,"preTransitModes",15),P=ae(e,"postTransitModes",15),I=ae(e,"directModes",15,void 0),k=ae(e,"maxPreTransitTime",15),N=ae(e,"maxPostTransitTime",15),D=ae(e,"maxDirectTime",15,void 0),B=ae(e,"elevationCosts",15),U=ae(e,"ignorePreTransitRentalReturnConstraints",15),V=ae(e,"ignorePostTransitRentalReturnConstraints",15),L=ae(e,"ignoreDirectRentalReturnConstraints",15),$=ae(e,"preTransitProviderGroups",15),te=ae(e,"postTransitProviderGroups",15),G=ae(e,"directProviderGroups",15),le=ae(e,"via",15),se=ae(e,"viaMinimumStay",15),oe=ae(e,"viaLabels",15);const be=[...Array(hi.maxTransfers+1).keys()].map(Gt=>({value:Gt.toString(),label:Gt.toString()})),xe=me(()=>V_(e.serverConfig?.maxDirectTimeLimit??3600)),_e=me(()=>V_(e.serverConfig?.maxPrePostTransitTimeLimit??3600));function Ne(Gt){return function(Or){Or&&(w([Gt]),P([Gt]),I([Gt]))}}c().includes("TRANSIT")&&c([...U_]),s()&&Ne("BIKE")(!0),l()&&Ne("CAR")(!0);const fe=[{value:"NONE",label:yt.elevationCosts.NONE},{value:"LOW",label:yt.elevationCosts.LOW},{value:"HIGH",label:yt.elevationCosts.HIGH}];let Le=wt(!1),tt=me(()=>e.serverConfig?.hasElevation&&(s()||w().includes("BIKE")||P().includes("BIKE")||I()?.includes("BIKE"))),Ye=me(()=>e.serverConfig?.hasStreetRouting),rt=me(()=>e.serverConfig?.hasRoutedTransfers);var it=V6(),Ct=ue(it);An(Ct,{variant:"ghost",onclick:()=>pe(Le,!S(Le)),children:(Gt,Or)=>{Yr();var _r=L6(),wr=ue(_r),Dr=ve(wr);{var Et=Pr=>{FE(Pr,{class:"size-[18px]"})},vt=Pr=>{py(Pr,{class:"size-[18px]"})};Ze(Dr,Pr=>{S(Le)?Pr(Et):Pr(vt,!1)})}mt(()=>pt(wr,`${yt.advancedSearchOptions??""} `)),Z(Gt,_r)},$$slots:{default:!0}});var Mt=ve(Ct,2);{var jt=Gt=>{var Or=U6(),_r=Ae(Or);D6(_r,{get transitModes(){return c()},set transitModes(ir){c(ir)}});var wr=ve(_r,2),Dr=Ae(wr);{let ir=me(()=>!S(rt));up(Dr,{get disabled(){return S(ir)},get label(){return yt.useRoutedTransfers},id:"useRoutedTransfers",onCheckedChange:or=>{n()&&!or&&n(!1)},get checked(){return t()},set checked(or){t(or)}})}var Et=ve(Dr,2);{let ir=me(()=>!S(rt));up(Et,{get disabled(){return S(ir)},get label(){return yt.wheelchair},id:"wheelchair",onCheckedChange:or=>{or&&!t()&&t(!0)},get checked(){return n()},set checked(or){n(or)}})}var vt=ve(Et,2);{let ir=me(()=>Ne("BIKE"));up(vt,{get label(){return yt.requireBikeTransport},get onCheckedChange(){return S(ir)},id:"requireBikeTransport",get checked(){return s()},set checked(or){s(or)}})}var Pr=ve(vt,2);{let ir=me(()=>!S(rt));up(Pr,{get disabled(){return S(ir)},get label(){return yt.requireCarTransport},id:"requireCarTransport",onCheckedChange:or=>{or&&!t()&&S(rt)&&t(!0),Ne("CAR")(or)},get checked(){return l()},set checked(or){l(or)}})}var yr=ve(Pr,2);N6(yr,{get via(){return le()},set via(ir){le(ir)},get viaMinimumStay(){return se()},set viaMinimumStay(ir){se(ir)},get viaLabels(){return oe()},set viaLabels(ir){oe(ir)}});var Ar=ve(yr,2),br=Ae(Ar),lr=Ae(br,!0);we(br);var ut=ve(br,2);Tx(ut,{get possibleValues(){return be},get value(){return a()},set value(ir){a(ir)}});var Zt=ve(ut,2);{var dr=ir=>{var or=B6(),Re=ue(or),Y=Ae(Re,!0);we(Re);var ee=ve(Re,2);Tx(ee,{get possibleValues(){return v()},get labelFormatter(){return Bs},get value(){return g()},set value(ie){g(ie)}}),mt(()=>pt(Y,yt.routingSegments.maxTravelTime)),Z(ir,or)};Ze(Zt,ir=>{g()!==void 0&&ir(dr)})}we(Ar);var er=ve(Ar,2);{let ir=me(()=>!S(Ye));sb(er,{get label(){return yt.routingSegments.firstMile},get disabled(){return S(ir)},get possibleModes(){return p_},get possibleMaxTransitTime(){return S(_e)},get modes(){return w()},set modes(or){w(or)},get maxTransitTime(){return k()},set maxTransitTime(or){k(or)},get ignoreRentalReturnConstraints(){return U()},set ignoreRentalReturnConstraints(or){U(or)},get providerGroups(){return $()},set providerGroups(or){$(or)}})}var Bt=ve(er,2);{let ir=me(()=>!S(Ye));sb(Bt,{get label(){return yt.routingSegments.lastMile},get disabled(){return S(ir)},get possibleModes(){return p_},get possibleMaxTransitTime(){return S(_e)},get modes(){return P()},set modes(or){P(or)},get maxTransitTime(){return N()},set maxTransitTime(or){N(or)},get ignoreRentalReturnConstraints(){return V()},set ignoreRentalReturnConstraints(or){V(or)},get providerGroups(){return te()},set providerGroups(or){te(or)}})}var mr=ve(Bt,2);{var Tr=ir=>{{let or=me(()=>!S(Ye));sb(ir,{get label(){return yt.routingSegments.direct},get disabled(){return S(or)},get possibleModes(){return p_},get possibleMaxTransitTime(){return S(xe)},get modes(){return I()},set modes(Re){I(Re)},get maxTransitTime(){return D()},set maxTransitTime(Re){D(Re)},get ignoreRentalReturnConstraints(){return L()},set ignoreRentalReturnConstraints(Re){L(Re)},get providerGroups(){return G()},set providerGroups(Re){G(Re)}})}};Ze(mr,ir=>{I()!==void 0&&D()!==void 0&&L()!==void 0&&ir(Tr)})}we(wr);var fr=ve(wr,2),nr=Ae(fr),rr=Ae(nr,!0);we(nr);var Nr=ve(nr,2);{let ir=me(()=>!S(tt)||!S(Ye));ar(Nr,()=>ru,(or,Re)=>{Re(or,{get disabled(){return S(ir)},type:"single",get value(){return B()},set value(Y){B(Y)},children:(Y,ee)=>{var ie=z6(),Te=ue(ie);ar(Te,()=>tu,(Be,Ge)=>{Ge(Be,{get"aria-label"(){return yt.selectElevationCosts},children:(Ve,nt)=>{Yr();var At=Br();mt(()=>pt(At,yt.elevationCosts[B()])),Z(Ve,At)},$$slots:{default:!0}})});var Ce=ve(Te,2);ar(Ce,()=>eu,(Be,Ge)=>{Ge(Be,{sideOffset:10,children:(Ve,nt)=>{var At=We(),bt=ue(At);xn(bt,19,()=>fe,(ur,Xe)=>Xe+ur.value,(ur,Xe)=>{var Xt=We(),xr=ue(Xt);ar(xr,()=>Jc,(Lt,gr)=>{gr(Lt,{get value(){return S(Xe).value},get label(){return S(Xe).label},children:(Lr,je)=>{Yr();var ht=Br();mt(()=>pt(ht,S(Xe).label)),Z(Lr,ht)},$$slots:{default:!0}})}),Z(ur,Xt)}),Z(Ve,At)},$$slots:{default:!0}})}),Z(Y,ie)},$$slots:{default:!0}})})}we(fr);var Cr=ve(fr,2);{var qr=ir=>{var or=We(),Re=ue(or);Ot(Re,()=>e.additionalComponents),Z(ir,or)};Ze(Cr,ir=>{e.additionalComponents&&ir(qr)})}we(Or),mt(()=>{fi(Ar,1,`grid ${g()===void 0?"grid-cols-2":"grid-cols-4"} items-center gap-2`),pt(lr,yt.routingSegments.maxTransfers),pt(rr,yt.selectElevationCosts)}),Z(Gt,Or)};Ze(Mt,Gt=>{S(Le)&&Gt(jt)})}Z(r,it),St()}var j6=Fe('<input type="datetime-local"/>');function j_(r,e){Tt(e,!0);let t=ae(e,"value",15),n;kr(()=>{if(n!==void 0){t().setSeconds(0,0);const l=new Date(t().getTime()-t().getTimezoneOffset()*6e4).toISOString().slice(0,-1);n.value=l}});var s=j6();s.__change=l=>{const c=l.target.value,a=new Date(`${c}Z`);isNaN(a.getTime())||t(new Date(a.getTime()+a.getTimezoneOffset()*6e4))},as(s,l=>n=l,()=>n),mt(l=>fi(s,1,l),[()=>bo(_n("flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e.class))]),Z(r,s),St()}yu(["change"]);var W6=Fe("<!> <span> </span>",1),$6=Fe("<!> <span> </span>",1),H6=Fe("<!> <!>",1),Z6=Fe('<div id="searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!> <!> <!> <!> <div class="flex flex-row gap-2 flex-wrap"><!> <!> <!></div></div>');function X6(r,e){Tt(e,!0);let t=ae(e,"from",15),n=ae(e,"to",15),s=ae(e,"time",15),l=ae(e,"arriveBy",15),c=ae(e,"pedestrianProfile",15),a=ae(e,"useRoutedTransfers",15),g=ae(e,"maxTransfers",15),v=ae(e,"requireCarTransport",15),w=ae(e,"requireBikeTransport",15),P=ae(e,"transitModes",15),I=ae(e,"preTransitModes",15),k=ae(e,"postTransitModes",15),N=ae(e,"directModes",15),D=ae(e,"elevationCosts",15),B=ae(e,"maxPreTransitTime",15),U=ae(e,"maxPostTransitTime",15),V=ae(e,"maxDirectTime",15),L=ae(e,"ignorePreTransitRentalReturnConstraints",15),$=ae(e,"ignorePostTransitRentalReturnConstraints",15),te=ae(e,"ignoreDirectRentalReturnConstraints",15),G=ae(e,"preTransitProviderGroups",15),le=ae(e,"postTransitProviderGroups",15),se=ae(e,"directProviderGroups",15),oe=ae(e,"via",15),be=ae(e,"viaMinimumStay",15),xe=ae(e,"viaLabels",15),_e=wt(tn([])),Ne=wt(tn([]));const fe=()=>{navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(Le,vt=>console.log(vt),{enableHighAccuracy:!0})},Le=vt=>{t(Ri({lat:vt.coords.latitude,lon:vt.coords.longitude},0))};var tt=Z6(),Ye=Ae(tt);Hp(Ye,{get place(){return e.geocodingBiasPlace},name:"from",get placeholder(){return yt.from},get transitModes(){return P()},get selected(){return t()},set selected(vt){t(vt)},get items(){return S(_e)},set items(vt){pe(_e,vt,!0)}});var rt=ve(Ye,2);Hp(rt,{get place(){return e.geocodingBiasPlace},name:"to",get placeholder(){return yt.to},get transitModes(){return P()},get selected(){return n()},set selected(vt){n(vt)},get items(){return S(Ne)},set items(vt){pe(Ne,vt,!0)}});var it=ve(rt,2);An(it,{variant:"ghost",class:"absolute z-10 right-4 top-0",size:"icon",onclick:()=>fe(),children:(vt,Pr)=>{x0(vt,{class:"w-5 h-5"})},$$slots:{default:!0}});var Ct=ve(it,2);An(Ct,{class:"absolute z-10 right-14 top-6",variant:"outline",size:"icon",onclick:()=>{const vt=n();n(t()),t(vt);const Pr=S(Ne);pe(Ne,S(_e),!0),pe(_e,Pr,!0)},children:(vt,Pr)=>{sD(vt,{class:"w-5 h-5"})},$$slots:{default:!0}});var Mt=ve(Ct,2),jt=Ae(Mt);j_(jt,{get value(){return s()},set value(vt){s(vt)}});var Gt=ve(jt,2),Or=()=>l()?"arrival":"departure",_r=vt=>l(vt==="arrival");ar(Gt,()=>Q0,(vt,Pr)=>{Pr(vt,{class:"flex",get value(){return Or()},set value(yr){_r(yr)},children:(yr,Ar)=>{var br=H6(),lr=ue(br);$p(lr,{for:"departure",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(Zt,dr)=>{var er=W6(),Bt=ue(er);ar(Bt,()=>jp,(fr,nr)=>{nr(fr,{value:"departure",id:"departure",class:"sr-only",get"aria-label"(){return yt.departure}})});var mr=ve(Bt,2),Tr=Ae(mr,!0);we(mr),mt(()=>pt(Tr,yt.departure)),Z(Zt,er)},$$slots:{default:!0}});var ut=ve(lr,2);$p(ut,{for:"arrival",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(Zt,dr)=>{var er=$6(),Bt=ue(er);ar(Bt,()=>jp,(fr,nr)=>{nr(fr,{value:"arrival",id:"arrival",class:"sr-only",get"aria-label"(){return yt.arrival}})});var mr=ve(Bt,2),Tr=Ae(mr,!0);we(mr),mt(()=>pt(Tr,yt.arrival)),Z(Zt,er)},$$slots:{default:!0}}),Z(yr,br)},$$slots:{default:!0}})});var wr=ve(Gt,2),Dr=()=>c()==="WHEELCHAIR",Et=vt=>c(vt?"WHEELCHAIR":"FOOT");nI(wr,{get serverConfig(){return e.serverConfig},get wheelchair(){return Dr()},set wheelchair(vt){Et(vt)},maxTravelTime:void 0,get useRoutedTransfers(){return a()},set useRoutedTransfers(vt){a(vt)},get requireCarTransport(){return v()},set requireCarTransport(vt){v(vt)},get maxTransfers(){return g()},set maxTransfers(vt){g(vt)},get requireBikeTransport(){return w()},set requireBikeTransport(vt){w(vt)},get transitModes(){return P()},set transitModes(vt){P(vt)},get preTransitModes(){return I()},set preTransitModes(vt){I(vt)},get postTransitModes(){return k()},set postTransitModes(vt){k(vt)},get directModes(){return N()},set directModes(vt){N(vt)},get maxPreTransitTime(){return B()},set maxPreTransitTime(vt){B(vt)},get maxPostTransitTime(){return U()},set maxPostTransitTime(vt){U(vt)},get maxDirectTime(){return V()},set maxDirectTime(vt){V(vt)},get elevationCosts(){return D()},set elevationCosts(vt){D(vt)},get ignorePreTransitRentalReturnConstraints(){return L()},set ignorePreTransitRentalReturnConstraints(vt){L(vt)},get ignorePostTransitRentalReturnConstraints(){return $()},set ignorePostTransitRentalReturnConstraints(vt){$(vt)},get ignoreDirectRentalReturnConstraints(){return te()},set ignoreDirectRentalReturnConstraints(vt){te(vt)},get preTransitProviderGroups(){return G()},set preTransitProviderGroups(vt){G(vt)},get postTransitProviderGroups(){return le()},set postTransitProviderGroups(vt){le(vt)},get directProviderGroups(){return se()},set directProviderGroups(vt){se(vt)},get via(){return oe()},set via(vt){oe(vt)},get viaMinimumStay(){return be()},set viaMinimumStay(vt){be(vt)},get viaLabels(){return xe()},set viaLabels(vt){xe(vt)}}),we(Mt),we(tt),Z(r,tt),St()}const iI=r=>{const e=()=>{ri.state.scrollY=r.scrollTop,SE("",ri.state)},t=n=>{requestAnimationFrame(()=>{r.scrollTop=n.state?.["sveltekit:states"]?.scrollY??0})};return r.addEventListener("scrollend",e),window.addEventListener("popstate",t),()=>{r.removeEventListener("scrollend",e),window.removeEventListener("popstate",t)}},q6=r=>{ri.state.scrollY==null&&(r.scrollTop=0)};var G6=Fe("<div><!></div>");function pa(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);ag(()=>{if(!(window.innerWidth<768)&&t().classList.contains("scrollable"))return iI(t())});var s=G6();sn(s,c=>({class:c,...n}),[()=>_n("bg-card text-card-foreground rounded-xl border shadow max-w-full",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var Y6=Fe("<div><!></div>");function K6(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=Y6();sn(s,c=>({class:c,...n}),[()=>_n("p-6",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var Q6=Fe('<div class="m-4 text-destructive"><div class="min-w-0"> </div></div>');function nu(r,e){var t=Q6(),n=Ae(t),s=Ae(n,!0);we(n),we(t),mt(()=>pt(s,e.e)),Z(r,t)}const ma=(r,e)=>r.toLocaleTimeString(eo,{hour:"numeric",minute:"numeric",timeZone:e,hour12:!1}),J6=(r,e)=>r.toLocaleDateString(eo,{day:"numeric",month:"numeric",year:"numeric",timeZone:e}),E2=(r,e)=>r.toLocaleDateString(eo,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZone:e}),e5=(r,e)=>{const t=new Intl.DateTimeFormat(eo,{timeZone:e,timeZoneName:"shortOffset"}).formatToParts(r).find(s=>s.type==="timeZoneName").value;return new Intl.DateTimeFormat(eo,{timeZoneName:"shortOffset"}).formatToParts(r).find(s=>s.type==="timeZoneName").value==t?void 0:t};var t5=Fe('<div> </div> <div class="text-xs font-normal"> </div>',1),r5=Fe('<div class="text-xs font-normal"> </div>'),n5=Fe("<span> </span> <!>",1),i5=Fe("<div><!></div>");function fd(r,e){Tt(e,!0);const t=me(()=>new Date(e.timestamp)),n=me(()=>new Date(e.scheduledTimestamp)),s=me(()=>(S(t).getTime()-S(n).getTime())/6e4),l=me(()=>e.isRealtime&&S(s)>3),c=me(()=>e.isRealtime&&S(s)<=3),a=me(()=>e.isRealtime&&S(s)<=-1),g=me(()=>e.arriveBy?S(l):S(l)||S(a)),v=me(()=>e.arriveBy?S(c):S(c)&&!S(a)),w=me(()=>S(n)instanceof Date&&!isNaN(S(n).getTime())),P=me(()=>S(w)?new Intl.DateTimeFormat(eo,{timeZone:e.timeZone,timeZoneName:"shortOffset"}).formatToParts(S(n)).find(V=>V.type==="timeZoneName").value:void 0),I=me(()=>()=>S(w)?new Intl.DateTimeFormat(eo,{timeZoneName:"shortOffset"}).formatToParts(S(n)).find(V=>V.type==="timeZoneName").value==S(P):!1);function k(V){return e.variant==="realtime"?"":e.queriedTime===void 0?V.toLocaleDateString(eo,{timeZone:e.timeZone}):new Date(e.queriedTime).toLocaleDateString()===V.toLocaleDateString()?"":`(${V.toLocaleString(eo,{weekday:"short",timeZone:e.timeZone})})`}var N=i5(),D=Ae(N);{var B=V=>{var L=t5(),$=ue(L),te=Ae($);we($);var G=ve($,2),le=Ae(G,!0);we(G),mt((se,oe,be)=>{pt(te,`${se??""}
			${oe??""}`),pt(le,be)},[()=>ma(S(n),e.timeZone),()=>k(S(n)),()=>S(I)()?"":S(P)]),Z(V,L)},U=V=>{var L=We(),$=ue(L);{var te=G=>{var le=n5(),se=ue(le);let oe;var be=Ae(se);we(se);var xe=ve(se,2);{var _e=Ne=>{var fe=r5(),Le=Ae(fe,!0);we(fe),mt(tt=>pt(Le,tt),[()=>S(I)()?"":S(P)]),Z(Ne,fe)};Ze(xe,Ne=>{e.variant==="realtime-show-always"&&!S(I)()&&Ne(_e)})}mt((Ne,fe)=>{oe=fi(se,1,"",null,oe,{"text-destructive":S(g),"text-green-600":S(v)}),pt(be,`${Ne??""}
			${fe??""}`)},[()=>ma(S(t),e.timeZone),()=>k(S(t))]),Z(G,le)};Ze($,G=>{(e.variant==="realtime-show-always"||e.variant==="realtime"&&e.isRealtime)&&G(te)},!0)}Z(V,L)};Ze(D,V=>{e.variant=="schedule"?V(B):V(U,!1)})}we(N),mt(V=>{fi(N,1,V),Fn(N,"title",S(P))},[()=>bo(_n("text-nowrap flex flex-col",e.class))]),Z(r,N),St()}var s5=l0('<svg class="relative mr-1 w-4 h-4 rounded-full"><use></use></svg>'),o5=Fe('<div class="flex items-center py-1 px-2 rounded-lg font-bold text-sm h-8 text-nowrap"><!> </div>');function a5(r,e){Tt(e,!0);const t=hr(e,["$$slots","$$events","$$legacy","d"]),n=[...new Map(e.d.legs.map(l=>[JSON.stringify(lc(l)),lc(l)])).values()],s=e.d.legs.find(l=>l.mode!=="WALK")??e.d.legs[0];An(r,zr({variant:"child"},()=>t,{children:(l,c)=>{var a=o5(),g=Ae(a);xn(g,17,()=>n,di,(w,P)=>{var I=me(()=>m0(S(P),3));let k=()=>S(I)[0];var N=s5(),D=Ae(N);we(N),mt(()=>fy(D,"xlink:href",`#${k()}`)),Z(w,N)});var v=ve(g);we(a),mt((w,P)=>{wa(a,w),pt(v,` ${P??""}`)},[()=>Sy(s),()=>Bs(e.d.duration)]),Z(l,a)},$$slots:{default:!0}})),St()}const l5=(r,e=Ht)=>{var t=c5(),n=Ae(t),s=Ae(n);we(n);var l=ve(n,2);{var c=g=>{var v=Br();mt(()=>pt(v,e().displayName)),Z(g,v)},a=g=>{var v=Br();mt(w=>pt(v,w),[()=>Bs(e().duration)]),Z(g,v)};Ze(l,g=>{e().displayName?g(c):g(a,!1)})}we(t),mt((g,v)=>{wa(t,g),fy(s,"xlink:href",v)},[()=>Sy(e()),()=>`#${lc(e())[0]}`]),Z(r,t)};var c5=Fe('<div class="flex items-center py-1 px-2 rounded-lg font-bold text-sm h-8 text-nowrap"><svg class="relative mr-1 w-4 h-4 rounded-full"><use></use></svg> <!></div>'),u5=Fe('<div class="my-4 flex flex-wrap gap-x-3 gap-y-3"></div>'),h5=Fe('<div class="w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white font-bold text-sm border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),d5=Fe('<div class="text-base flex justify-around items-start space-x-1 w-full"><div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <!></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <!></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <div class="text-center text-nowrap"> </div></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <div class="text-center text-nowrap"> </div></div></div> <!> <div class="mt-4 flex flex-wrap gap-x-3 gap-y-3"></div>',1),f5=Fe("<button><!></button>"),p5=Fe('<div class="w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white text-sm font-bold border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),g5=Fe("<!> <!> <!>",1),m5=Fe('<div class="flex items-center justify-center w-full"><!></div>'),_5=Fe('<div class="flex flex-col space-y-6 px-4 py-8"></div>'),y5=Fe("<!> <!>",1),v5=Fe('<div class="flex items-center justify-center w-full"><!></div>');function b5(r,e){Tt(e,!0);const t=c=>c.then(a=>{if(console.log(a.error),a.error)throw new Error(String(a.error.error??a.error));return a});var n=We(),s=ue(n);{var l=c=>{var a=We(),g=ue(a);Ja(g,()=>e.baseResponse,v=>{var w=v5(),P=Ae(w);Np(P,{class:"animate-spin w-12 h-12 m-20"}),we(w),Z(v,w)},(v,w)=>{var P=y5(),I=ue(P);{var k=U=>{var V=u5();xn(V,21,()=>S(w).direct,di,(L,$)=>{a5(L,{get d(){return S($)},onclick:()=>{e.selectItinerary(S($))}})}),we(V),Z(U,V)};Ze(I,U=>{S(w).direct.length!==0&&U(k)})}var N=ve(I,2);{var D=U=>{var V=_5();xn(V,21,()=>e.routingResponses,di,(L,$,te,G)=>{var le=We(),se=ue(le);Ja(se,()=>S($),oe=>{var be=m5(),xe=Ae(be);Np(xe,{class:"animate-spin w-12 h-12 m-20"}),we(be),Z(oe,be)},(oe,be)=>{var xe=g5(),_e=ue(xe);{var Ne=Ye=>{var rt=h5(),it=ve(Ae(rt),2);it.__click=()=>{e.routingResponses.splice(0,0,t(rx({query:{...e.baseQuery.query,pageCursor:S(be).previousPageCursor}})).then(e.updateStartDest))};var Ct=Ae(it,!0);we(it),Yr(2),we(rt),mt(()=>pt(Ct,yt.earlier)),Z(Ye,rt)};Ze(_e,Ye=>{te===0&&e.baseQuery&&Ye(Ne)})}var fe=ve(_e,2);xn(fe,17,()=>S(be).itineraries,di,(Ye,rt)=>{var it=f5();it.__click=()=>{e.selectItinerary(S(rt))};var Ct=Ae(it);pa(Ct,{class:"p-4",children:(Mt,jt)=>{var Gt=d5(),Or=ue(Gt),_r=Ae(Or),wr=Ae(_r),Dr=Ae(wr,!0);we(wr);var Et=ve(wr,2);{let ir=me(()=>e.baseQuery?.query.time);fd(Et,{get isRealtime(){return S(rt).legs[0].realTime},get timestamp(){return S(rt).startTime},get scheduledTimestamp(){return S(rt).legs[0].scheduledStartTime},variant:"realtime-show-always",get queriedTime(){return S(ir)},get timeZone(){return S(rt).legs[0].from.tz}})}we(_r);var vt=ve(_r,2);Vm(vt,{orientation:"vertical"});var Pr=ve(vt,2),yr=Ae(Pr),Ar=Ae(yr,!0);we(yr);var br=ve(yr,2);fd(br,{get isRealtime(){return S(rt).legs[S(rt).legs.length-1].realTime},get timestamp(){return S(rt).endTime},get scheduledTimestamp(){return S(rt).legs[S(rt).legs.length-1].scheduledEndTime},variant:"realtime-show-always",get queriedTime(){return S(rt).startTime},get timeZone(){return S(rt).legs[S(rt).legs.length-1].to.tz}}),we(Pr);var lr=ve(Pr,2);Vm(lr,{orientation:"vertical"});var ut=ve(lr,2),Zt=Ae(ut),dr=Ae(Zt,!0);we(Zt);var er=ve(Zt,2),Bt=Ae(er,!0);we(er),we(ut);var mr=ve(ut,2);Vm(mr,{orientation:"vertical"});var Tr=ve(mr,2),fr=Ae(Tr),nr=Ae(fr,!0);we(fr);var rr=ve(fr,2),Nr=Ae(rr,!0);we(rr),we(Tr),we(Or);var Cr=ve(Or,2);Vm(Cr,{class:"my-2"});var qr=ve(Cr,2);xn(qr,21,()=>S(rt).legs.filter((ir,or)=>or==0&&ir.duration>1||or==S(rt).legs.length-1&&ir.duration>1||ir.displayName||ir.mode!="WALK"),di,(ir,or,Re,Y)=>{l5(ir,()=>S(or))}),we(qr),mt(ir=>{pt(Dr,yt.departure),pt(Ar,yt.arrival),pt(dr,yt.transfers),pt(Bt,S(rt).transfers),pt(nr,yt.duration),pt(Nr,ir)},[()=>Bs(S(rt).duration)]),Z(Mt,Gt)},$$slots:{default:!0}}),we(it),Z(Ye,it)});var Le=ve(fe,2);{var tt=Ye=>{var rt=p5(),it=ve(Ae(rt),2);it.__click=()=>{e.routingResponses.push(t(rx({query:{...e.baseQuery.query,pageCursor:S(be).nextPageCursor}})).then(e.updateStartDest))};var Ct=Ae(it,!0);we(it),Yr(2),we(rt),mt(()=>pt(Ct,yt.later)),Z(Ye,rt)};Ze(Le,Ye=>{te===e.routingResponses.length-1&&e.baseQuery&&Ye(tt)})}Z(oe,xe)},(oe,be)=>{nu(oe,{get e(){return S(be)}})}),Z(L,le)}),we(V),Z(U,V)},B=U=>{var V=We(),L=ue(V);{var $=te=>{nu(te,{get e(){return yt.noItinerariesFound}})};Ze(L,te=>{S(w).direct.length===0&&te($)},!0)}Z(U,V)};Ze(N,U=>{S(w).itineraries.length!==0?U(D):U(B,!1)})}Z(v,P)},(v,w)=>{nu(v,{get e(){return S(w)}})}),Z(c,a)};Ze(s,c=>{e.baseResponse&&c(l)})}Z(r,n),St()}yu(["click"]);var x5=Fe('<button><svg class="relative mr-2 min-w-6 min-h-6 max-w-6 max-h-6 rounded-full"><use></use></svg> <div class="text-center"> </div></button>');function Sx(r,e){Tt(e,!0);const t=me(()=>lc(e.l)[0]);var n=x5();n.__click=()=>{e.l.tripId?e.onClickTrip(e.l.tripId):console.log("tripId missing",e.l)};var s=Ae(n),l=Ae(s);we(s);var c=ve(s,2),a=Ae(c,!0);we(c),we(n),mt((g,v)=>{fi(n,1,g),wa(n,v),fy(l,"xlink:href",`#${S(t)}`),pt(a,e.l.displayName)},[()=>bo(_n("flex items-center text-nowrap rounded-full pl-2 pr-1 h-8 font-bold",e.class,e.l.displayName?"pr-3":void 0)),()=>Sy(e.l)]),Z(r,n),St()}yu(["click"]);var w5=Fe("<div><!></div>");function T5(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=w5();sn(s,c=>({class:c,...n}),[()=>_n("flex flex-col space-y-1.5 text-center sm:text-left",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}function S5(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{let c=me(()=>_n("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0  fixed inset-0 z-50 bg-black/80",e.class));ar(l,()=>ON,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)}}))})}Z(r,s),St()}var A5=Fe('<!> <span class="sr-only">Close</span>',1),E5=Fe("<!> <!>",1),P5=Fe("<!> <!>",1);function I5(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var s=We(),l=ue(s);ar(l,()=>k5,(c,a)=>{a(c,zr(()=>e.portalProps,{children:(g,v)=>{var w=P5(),P=ue(w);ar(P,()=>S5,(k,N)=>{N(k,{})});var I=ve(P,2);{let k=me(()=>_n("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",e.class));ar(I,()=>H4,(N,D)=>{D(N,zr({get class(){return S(k)}},()=>n,{get ref(){return t()},set ref(B){t(B)},children:(B,U)=>{var V=E5(),L=ue(V);Ot(L,()=>e.children??Ht);var $=ve(L,2);ar($,()=>j4,(te,G)=>{G(te,{class:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none",children:(le,se)=>{var oe=A5(),be=ue(oe);Kc(be,{class:"size-4"}),Yr(2),Z(le,oe)},$$slots:{default:!0}})}),Z(B,V)},$$slots:{default:!0}}))})}Z(g,w)},$$slots:{default:!0}}))}),Z(r,s),St()}function C5(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class"]);var s=We(),l=ue(s);{let c=me(()=>_n("text-muted-foreground text-sm",e.class));ar(l,()=>BN,(a,g)=>{g(a,zr({get class(){return S(c)}},()=>n,{get ref(){return t()},set ref(v){t(v)}}))})}Z(r,s),St()}const R5=U4,M5=NN,k5=O0;var D5=Fe('<span class="text-muted-foreground font-normal"> </span>'),O5=Fe('<div><div class="flex flex-col gap-1 overflow-hidden"><div class="font-bold flex gap-2 items-center text-blue-700 dark:text-blue-500"><!> <!></div> <span class="font-normal text-muted-foreground overflow-hidden text-ellipsis w-full"> </span></div> <!></div>'),F5=Fe('<p><strong> </strong> <strong> </strong> <span class="text-xs font-normal"> </span></p>'),N5=Fe("<p> </p>"),L5=Fe("<p> </p>"),B5=Fe('<div class="last:mb-0 text-justify"><h3 class="font-bold text-blue-700 dark:text-blue-500 mb-1 flex items-center gap-2"><!> </h3> <!> <!> <!></div>'),z5=Fe("<!> <!>",1);function tw(r,e){Tt(e,!0);const t=ae(e,"alerts",19,()=>[]),n=ae(e,"variant",3,"icon");var s=We(),l=ue(s);{var c=a=>{var g=We(),v=ue(g);ar(v,()=>R5,(w,P)=>{P(w,{children:(I,k)=>{var N=z5(),D=ue(N);{let U=me(()=>n()=="full"?"pt-2":"ml-2");ar(D,()=>M5,(V,L)=>{L(V,{get class(){return`max-w-full pr-4  ${S(U)??""}`},children:($,te)=>{var G=We(),le=ue(G);{var se=be=>{var xe=O5(),_e=Ae(xe),Ne=Ae(_e),fe=Ae(Ne);Gv(fe,{});var Le=ve(fe),tt=ve(Le);{var Ye=Mt=>{var jt=D5(),Gt=Ae(jt);we(jt),mt(()=>pt(Gt,`+${t().length-1}
									${yt.alerts.more??""}`)),Z(Mt,jt)};Ze(tt,Mt=>{t().length>1&&Mt(Ye)})}we(Ne);var rt=ve(Ne,2),it=Ae(rt,!0);we(rt),we(_e);var Ct=ve(_e,2);hD(Ct,{class:"size-4"}),we(xe),mt(Mt=>{fi(xe,1,Mt),pt(Le,` ${yt.alerts.information??""} `),pt(it,t()[0].descriptionText||t()[0].headerText)},[()=>bo(_n(wx({variant:"outline"}),"max-w-full flex items-center bg-blue-50 dark:bg-blue-950 shadow-none"))]),Z(be,xe)},oe=be=>{Gv(be,{})};Ze(le,be=>{n()==="full"?be(se):be(oe,!1)})}Z($,G)},$$slots:{default:!0}})})}var B=ve(D,2);ar(B,()=>I5,(U,V)=>{V(U,{children:(L,$)=>{var te=We(),G=ue(te);ar(G,()=>T5,(le,se)=>{se(le,{children:(oe,be)=>{var xe=We(),_e=ue(xe);ar(_e,()=>C5,(Ne,fe)=>{fe(Ne,{class:"space-y-4",children:(Le,tt)=>{var Ye=We(),rt=ue(Ye);xn(rt,17,t,di,(it,Ct)=>{var Mt=B5(),jt=Ae(Mt),Gt=Ae(jt);Gv(Gt,{class:"size-5"});var Or=ve(Gt,1,!0);we(jt);var _r=ve(jt,2);{var wr=yr=>{var Ar=We(),br=ue(Ar);xn(br,17,()=>S(Ct).impactPeriod,di,(lr,ut)=>{const Zt=me(()=>new Date(S(ut).start??0)),dr=me(()=>new Date(S(ut).end??0));var er=F5(),Bt=Ae(er),mr=Ae(Bt);we(Bt);var Tr=ve(Bt),fr=ve(Tr),nr=Ae(fr,!0);we(fr);var rr=ve(fr),Nr=ve(rr),Cr=Ae(Nr,!0);we(Nr),we(er),mt((qr,ir,or)=>{pt(mr,`${yt.alerts.validFrom??""}:`),pt(Tr,` ${qr??""} `),pt(nr,yt.alerts.until),pt(rr,` ${ir??""} `),pt(Cr,or)},[()=>E2(S(Zt),e.tz),()=>E2(S(dr),e.tz),()=>e5(S(Zt),e.tz)]),Z(lr,er)}),Z(yr,Ar)};Ze(_r,yr=>{S(Ct).impactPeriod&&yr(wr)})}var Dr=ve(_r,2);{var Et=yr=>{var Ar=N5(),br=Ae(Ar,!0);we(Ar),mt(()=>pt(br,S(Ct).causeDetail)),Z(yr,Ar)};Ze(Dr,yr=>{S(Ct).causeDetail&&yr(Et)})}var vt=ve(Dr,2);{var Pr=yr=>{var Ar=L5(),br=Ae(Ar,!0);we(Ar),mt(()=>pt(br,S(Ct).descriptionText)),Z(yr,Ar)};Ze(vt,yr=>{S(Ct).descriptionText&&yr(Pr)})}we(Mt),mt(()=>pt(Or,S(Ct).headerText)),Z(it,Mt)}),Z(Le,Ye)},$$slots:{default:!0}})}),Z(oe,xe)},$$slots:{default:!0}})}),Z(L,te)},$$slots:{default:!0}})}),Z(I,N)},$$slots:{default:!0}})}),Z(a,g)};Ze(l,a=>{t().length>0&&a(c)})}Z(r,s),St()}const U5=r=>{switch(r.mode){case"WALK":return yt.walk;case"BIKE":return yt.bike;case"RENTAL":switch(r.rental?.formFactor){case"BICYCLE":return yt.bike;case"CARGO_BICYCLE":return yt.cargoBike;case"CAR":return yt.car;case"MOPED":return yt.moped;case"SCOOTER_SEATED":return yt.scooterSeated;case"SCOOTER_STANDING":return yt.scooterStanding;case"OTHER":default:return yt.unknownVehicleType}case"CAR":case"CAR_PARKING":return yt.car;case"ODM":return yt.taxi;case"FLEX":return"Flex";default:return`${r.mode}`}},sI=r=>{switch(r){case"BUS":case"FERRY":case"TRAM":case"COACH":case"AIRPLANE":case"AERIAL_LIFT":return"Platform";default:return"Track"}},Nh=(r,e=Ht,t=Ht,n=Ht,s=Ht,l=Ht,c=Ht,a=Ht)=>{const g=me(()=>c()==0||c()==1),v=me(()=>c()==0?"":"font-semibold");var w=X5(),P=Ae(w),I=Ae(P);fd(I,{variant:"schedule",class:"w-14 md:w-16",get queriedTime(){return e()},get timeZone(){return s().tz},get isRealtime(){return n()},get timestamp(){return e()},get scheduledTimestamp(){return t()},get arriveBy(){return S(g)}});var k=ve(I,2);fd(k,{variant:"realtime",class:"w-14 md:w-16",get timeZone(){return s().tz},get isRealtime(){return n()},get timestamp(){return e()},get scheduledTimestamp(){return t()},get arriveBy(){return S(g)}}),we(P);var N=ve(P,2),D=Ae(N);{var B=V=>{const L=me(()=>s().pickupType=="NOT_ALLOWED"&&c()!=1),$=me(()=>s().dropoffType=="NOT_ALLOWED"&&c()!=-1);var te=H5(),G=ue(te),le=Ae(G),se=Ae(le);An(se,{get class(){return`text-[length:inherit] leading-none justify-normal text-wrap p-0 text-left ${S(v)??""}`},variant:"link",onclick:()=>Ad(s().name,s().stopId,new Date(e())),children:(rt,it)=>{Yr();var Ct=Br();mt(()=>pt(Ct,s().name)),Z(rt,Ct)},$$slots:{default:!0}});var oe=ve(se,2);{var be=rt=>{tw(rt,{get alerts(){return s().alerts},get tz(){return s().tz},variant:"icon"})};Ze(oe,rt=>{c()!=0&&rt(be)})}we(le);var xe=ve(le,2);{var _e=rt=>{var it=j5(),Ct=Ae(it);we(it),mt(Mt=>pt(Ct,`${Mt??""}
							${s().track??""}`),[()=>sI(l())=="Track"?yt.trackAbr:yt.platformAbr]),Z(rt,it)};Ze(xe,rt=>{s().track&&!a()&&rt(_e)})}we(G);var Ne=ve(G,2),fe=Ae(Ne);{var Le=rt=>{const it=me(()=>s().switchTo);var Ct=W5(),Mt=Ae(Ct),jt=ve(Mt);v0(jt,{class:"mx-1 size-4"});var Gt=ve(jt);we(Ct),mt(()=>{pt(Mt,`${yt.continuesAs??""}
							${S(it).displayName??""} `),pt(Gt,` ${S(it).headsign??""}`)}),Z(rt,Ct)};Ze(fe,rt=>{s().switchTo&&rt(Le)})}var tt=ve(fe,2);{var Ye=rt=>{var it=$5(),Ct=Ae(it);gy(Ct,{class:"stroke-destructive size-4"});var Mt=ve(Ct,2),jt=Ae(Mt,!0);we(Mt),we(it),mt(()=>pt(jt,S(L)&&S($)?yt.inOutDisallowed:S(L)?yt.inDisallowed:yt.outDisallowed)),Z(rt,it)};Ze(tt,rt=>{(S(L)||S($))&&rt(Ye)})}we(Ne),Z(V,te)},U=V=>{var L=Z5(),$=Ae(L,!0);we(L),mt(()=>pt($,s().name||s().flex)),Z(V,L)};Ze(D,V=>{s().stopId?V(B):V(U,!1)})}we(N),we(w),mt(()=>fi(w,1,`flex items-baseline justify-between w-full ${S(v)??""}`)),Z(r,w)},V5=(r,e=Ht)=>{const t=me(()=>e().steps?.filter($=>$.elevationUp||$.elevationDown)),n=me(()=>e().steps?.filter($=>$.toll)),s=me(()=>e().steps?.filter($=>$.accessRestriction));var l=eU(),c=Ae(l),a=Ae(c);we(c);var g=ve(c,2);{var v=$=>{var te=q5(),G=Ae(te),le=ve(G),se=Ae(le,!0);we(le),we(te),mt(()=>{pt(G,`${yt.sharingProvider??""}: `),Fn(le,"href",e().rental.url),pt(se,e().rental.systemName)}),Z($,te)};Ze(g,$=>{e().rental&&e().rental.systemName&&$(v)})}var w=ve(g,2);{var P=$=>{var te=G5(),G=Ae(te,!0);we(te),mt(()=>pt(G,yt.roundtripStationReturnConstraint)),Z($,te)};Ze(w,$=>{e().rental?.returnConstraint=="ROUNDTRIP_STATION"&&$(P)})}var I=ve(w,2);{var k=$=>{var te=Y5(),G=Ae(te);An(G,{class:"font-bold",variant:"outline",get href(){return e().rental.rentalUriWeb},target:"_blank",children:(le,se)=>{Yr();var oe=Br();mt(()=>pt(oe,yt.rent)),Z(le,oe)},$$slots:{default:!0}}),we(te),Z($,te)};Ze(I,$=>{e().rental?.rentalUriWeb&&$(k)})}var N=ve(I,2);{var D=$=>{var te=K5(),G=Ae(te),le=ve(G),se=Ae(le);oD(se,{class:"size-4"});var oe=ve(se);we(le);var be=ve(le,2),xe=Ae(be);iD(xe,{class:"size-4"});var _e=ve(xe);we(be),we(te),mt((Ne,fe)=>{pt(G,`${yt.incline??""} `),pt(oe,` ${Ne??""} m`),pt(_e,` ${fe??""} m`)},[()=>S(t).reduce((Ne,fe)=>Ne+fe.elevationUp,0),()=>S(t).reduce((Ne,fe)=>Ne+fe.elevationDown,0)]),Z($,te)};Ze(N,$=>{S(t)&&S(t).length>0&&$(D)})}var B=ve(N,2);{var U=$=>{var te=Q5(),G=Ae(te);fD(G,{class:"size-4"});var le=ve(G);we(te),mt(()=>pt(le,` ${yt.toll??""}`)),Z($,te)};Ze(B,$=>{S(n)&&S(n).length>0&&$(U)})}var V=ve(B,2);{var L=$=>{var te=J5(),G=Ae(te);gy(G,{class:"size-4"});var le=ve(G);we(te),mt(se=>pt(le,` ${yt.accessRestriction??""}
				(${se??""})`),[()=>S(s).map(se=>se.accessRestriction).filter((se,oe,be)=>be.indexOf(se)===oe).join(", ")]),Z($,te)};Ze(V,$=>{S(s)&&S(s).length>0&&$(L)})}we(l),mt(($,te,G)=>pt(a,`${$??""}
			${te??""}
			${G??""}`),[()=>Bs(e().duration),()=>U5(e()),()=>c6(e().distance)]),Z(r,l)},P2=(r,e=Ht)=>{Yr();var t=sU(),n=ue(t),s=ve(n);{var l=g=>{var v=nU(),w=ve(ue(v));{var P=k=>{var N=tU();let D;var B=Ae(N,!0);we(N),mt(()=>{D=fi(N,1,"underline",null,D,{italic:e().riderCategory.isDefaultFareCategory}),Fn(N,"href",e().riderCategory.eligibilityUrl),pt(B,e().riderCategory.riderCategoryName)}),Z(k,N)},I=k=>{var N=rU();let D;var B=Ae(N,!0);we(N),mt(()=>{D=fi(N,1,"",null,D,{italic:e().riderCategory.isDefaultFareCategory}),pt(B,e().riderCategory.riderCategoryName)}),Z(k,N)};Ze(w,k=>{e().riderCategory.eligibilityUrl?k(P):k(I,!1)})}Z(g,v)};Ze(s,g=>{e().riderCategory&&g(l)})}var c=ve(s,2);{var a=g=>{var v=iU(),w=ve(ue(v));{var P=k=>{var N=Br();mt(()=>pt(N,e().media.fareMediaName)),Z(k,N)},I=k=>{var N=Br();mt(()=>pt(N,e().media.fareMediaType)),Z(k,N)};Ze(w,k=>{e().media.fareMediaName?k(P):k(I,!1)})}Z(g,v)};Ze(c,g=>{e().media&&g(a)})}mt(g=>pt(n,`${e().name??""}
	${g??""} `),[()=>new Intl.NumberFormat(eo,{style:"currency",currency:e().currency}).format(e().amount)]),Z(r,t)};var j5=Fe('<span class="text-nowrap px-2 border rounded-xl ml-1 mr-4"> </span>'),W5=Fe('<div class="flex items-center text-sm mt-1"> <!> </div>'),$5=Fe('<div class="flex items-center text-destructive text-sm mt-1"><!> <span class="ml-1 leading-none"> </span></div>'),H5=Fe('<div class="flex items-center justify-between"><div class="flex flex-row items-center justify-center"><!> <!></div> <!></div> <div><!> <!></div>',1),Z5=Fe("<span> </span>"),X5=Fe('<div><div class="flex justify-between"><!> <!></div> <div class="w-full"><!></div></div>'),q5=Fe('<span class="ml-6"> <a target="_blank" class="hover:underline"> </a></span>'),G5=Fe('<span class="ml-6"> </span>'),Y5=Fe('<span class="ml-6"><!></span>'),K5=Fe('<div class="ml-6 flex items-center gap-2 text-xs"> <div class="flex items-center"><!> </div> <div class="flex items-center"><!> </div></div>'),Q5=Fe('<div class="ml-6 flex items-center gap-2 text-sm text-orange-500"><!> </div>'),J5=Fe('<div class="ml-6 flex items-center gap-2 text-sm text-orange-500"><!> </div>'),eU=Fe('<div class="py-12 flex flex-col gap-y-4 text-muted-foreground"><span class="ml-6"> </span> <!> <!> <!> <!> <!> <!></div>'),tU=Fe("<a> </a>"),rU=Fe("<span> </span>"),nU=Fe("for <!>",1),iU=Fe("as <!>",1),sU=Fe(" <!> <!>",1),oU=Fe('<div class="mb-1"> </div>'),aU=Fe("<li><!></li>"),lU=Fe("<!> <ul></ul>",1),cU=Fe('<div class="pl-1 md:pl-4 my-8 text-xs font-bold"><!></div>'),uU=Fe('<div class="mb-1"> </div>'),hU=Fe("<li><!></li>"),dU=Fe('<br/> <span class="text-xs font-bold text-foreground text-left"><!> <ul></ul></span>',1),fU=Fe('<div class="border-t h-0 grow shrink"></div> <div class="text-sm text-muted-foreground leading-none px-2 text-center"><!> <!> <!></div>',1),pU=Fe("<br/> ",1),gU=Fe(" <!>",1),mU=Fe('<div class="mt-2 flex items-center text-destructive leading-none"> </div>'),_U=Fe('<div class="mt-2 flex items-center text-destructive leading-none"><!> <span class="ml-1 font-bold"> </span></div>'),yU=Fe('<div class="mt-2 flex items-center text-green-600 leading-none"><span class="ml-1"> </span></div>'),vU=Fe('<div class="py-10 pl-4 md:pl-4 flex items-center text-muted-foreground"> </div> <!>',1),bU=Fe('<!> <details class="[&amp;_.collapsible]:open:-rotate-180 my-2"><summary class="py-10 pl-4 md:pl-4 flex items-center text-muted-foreground"><svg class="collapsible rotate-0 transform transition-all duration-300" fill="none" height="20" width="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg> <span class="ml-2 cursor-pointer"> </span></summary> <div class="grid gap-2 items-start content-start pb-2"></div></details>',1),xU=Fe('<div class="pb-2"></div>'),wU=Fe('<div class="w-full flex justify-between items-center space-x-1"><!> <!> <div class="border-t h-0 grow shrink"></div></div> <div class="pt-4 pb-2 pl-4 sm:pl-6 border-l-4 left-4 relative"><!> <div class="flex items-center"><!> <span class="ml-1"><!></span></div> <!> <!> <!> <!> <!> <!> <!></div>',1),TU=Fe('<div class="mt-2 flex items-center leading-none"><span class="ml-1 text-sm"> </span></div>'),SU=Fe('<!> <div class="pt-2 pb-2 pl-4 sm:pl-6 border-l-4 left-4 relative"><!> <!> <!> <!></div>',1),AU=Fe('<div class="text-lg max-w-full"><!> <div class="relative pl-4 md:pl-6 left-5"><div class="absolute left-[-9px] w-[15px] h-[15px] rounded-full"></div> <div class="relative top-[-6px] mb-[-6px]"><!></div></div></div>');function EU(r,e){Tt(e,!0);const t=(P,I=Ht,k=Ht)=>{var N=We(),D=ue(N);{var B=U=>{const V=me(()=>e.itinerary.fareTransfers[k().fareTransferIndex]),L=me(()=>S(V).rule=="AB"||S(V).rule=="A_AB"&&k().effectiveFareLegIndex!==0);var $=We(),te=ue($);{var G=le=>{var se=cU(),oe=Ae(se);{var be=_e=>{var Ne=Br();mt(()=>pt(Ne,yt.includedInTicket)),Z(_e,Ne)},xe=_e=>{const Ne=me(()=>S(V).effectiveFareLegProducts[k().effectiveFareLegIndex]);var fe=lU(),Le=ue(fe);{var tt=it=>{var Ct=oU(),Mt=Ae(Ct);we(Ct),mt(()=>pt(Mt,`${yt.ticketOptions??""}:`)),Z(it,Ct)};Ze(Le,it=>{S(Ne).length>1&&it(tt)})}var Ye=ve(Le,2);let rt;xn(Ye,21,()=>S(Ne),di,(it,Ct)=>{var Mt=We(),jt=ue(Mt);xn(jt,17,()=>S(Ct),di,(Gt,Or)=>{var _r=aU(),wr=Ae(_r);P2(wr,()=>S(Or)),we(_r),Z(Gt,_r)}),Z(it,Mt)}),we(Ye),mt(()=>rt=fi(Ye,1,"",null,rt,{"list-disc":S(Ne).length>1,"list-outside":S(Ne).length>1})),Z(_e,fe)};Ze(oe,_e=>{S(L)||I()&&I().fareTransferIndex===k().fareTransferIndex&&I().effectiveFareLegIndex===k().effectiveFareLegIndex?_e(be):_e(xe,!1)})}we(se),Z(le,se)};Ze(te,le=>{(S(L)||S(V).effectiveFareLegProducts[k().effectiveFareLegIndex].length>0)&&le(G)})}Z(U,$)};Ze(D,U=>{e.itinerary.fareTransfers!=null&&k().fareTransferIndex!=null&&k().effectiveFareLegIndex!=null&&U(B)})}Z(P,N)},n=P=>P.duration!==0||P.displayName,s=me(()=>e.itinerary.legs.findLast(n));var l=AU(),c=Ae(l);xn(c,17,()=>e.itinerary.legs,di,(P,I,k)=>{const N=me(()=>k==e.itinerary.legs.length-1),D=me(()=>k==e.itinerary.legs.length-2),B=me(()=>k==0?void 0:e.itinerary.legs[k-1]),U=me(()=>S(N)?void 0:e.itinerary.legs[k+1]),V=me(()=>e.itinerary.legs.slice(0,k).find(le=>le.tripId));var L=We(),$=ue(L);{var te=le=>{var se=wU(),oe=ue(se),be=Ae(oe);Sx(be,{get onClickTrip(){return Lp},get l(){return S(I)}});var xe=ve(be,2);{var _e=ut=>{var Zt=fU(),dr=ve(ue(Zt),2),er=Ae(dr);{var Bt=rr=>{var Nr=Br();mt(Cr=>pt(Nr,`${Cr??""} ${yt.walk??""}`),[()=>Bs(S(B).duration)]),Z(rr,Nr)};Ze(er,rr=>{S(B).duration&&rr(Bt)})}var mr=ve(er,2);{var Tr=rr=>{var Nr=Br();mt(Cr=>pt(Nr,`(${Cr??""} m)`),[()=>Math.round(S(B).distance)]),Z(rr,Nr)};Ze(mr,rr=>{S(B).distance&&rr(Tr)})}var fr=ve(mr,2);{var nr=rr=>{const Nr=me(()=>e.itinerary.fareTransfers[S(V).fareTransferIndex].transferProducts);var Cr=We(),qr=ue(Cr);{var ir=or=>{var Re=dU(),Y=ve(ue(Re),2),ee=Ae(Y);{var ie=Be=>{var Ge=uU(),Ve=Ae(Ge);we(Ge),mt(()=>pt(Ve,`${yt.ticketOptions??""}:`)),Z(Be,Ge)};Ze(ee,Be=>{S(Nr).length>1&&Be(ie)})}var Te=ve(ee,2);let Ce;xn(Te,21,()=>S(Nr),di,(Be,Ge)=>{var Ve=hU(),nt=Ae(Ve);P2(nt,()=>S(Ge)),we(Ve),Z(Be,Ve)}),we(Te),we(Y),mt(()=>Ce=fi(Te,1,"",null,Ce,{"list-disc":S(Nr).length>1,"list-outside":S(Nr).length>1})),Z(or,Re)};Ze(qr,or=>{S(V).effectiveFareLegIndex===0&&S(I).effectiveFareLegIndex===1&&or(ir)})}Z(rr,Cr)};Ze(fr,rr=>{S(V)?.fareTransferIndex!=null&&e.itinerary.fareTransfers&&e.itinerary.fareTransfers[S(V).fareTransferIndex].transferProducts&&rr(nr)})}we(dr),Z(ut,Zt)};Ze(xe,ut=>{S(B)&&(S(B).from.track||n(S(B)))&&(k!=1||S(B).displayName)&&ut(_e)})}Yr(2),we(oe);var Ne=ve(oe,2),fe=Ae(Ne);Nh(fe,()=>S(I).startTime,()=>S(I).scheduledStartTime,()=>S(I).realTime,()=>S(I).from,()=>S(I).mode,()=>-1);var Le=ve(fe,2),tt=Ae(Le);v0(tt,{class:"stroke-muted-foreground size-4"});var Ye=ve(tt,2),rt=Ae(Ye);{var it=ut=>{An(ut,{class:"text-[length:inherit] text-muted-foreground leading-none justify-normal text-wrap text-left ",variant:"link",onclick:()=>Ad(S(I).tripTo.name,S(I).tripTo.stopId,new Date(S(I).tripTo.arrival),!0),children:(Zt,dr)=>{Yr();var er=gU(),Bt=ue(er),mr=ve(Bt);{var Tr=fr=>{var nr=pU(),rr=ve(ue(nr));mt(()=>pt(rr,`(${S(I).tripTo.name??""})`)),Z(fr,nr)};Ze(mr,fr=>{(!S(I).headsign||!S(I).tripTo.name.startsWith(S(I).headsign))&&fr(Tr)})}mt(()=>pt(Bt,`${S(I).headsign??""} `)),Z(Zt,er)},$$slots:{default:!0}})},Ct=ut=>{var Zt=Br();mt(()=>pt(Zt,S(I).headsign)),Z(ut,Zt)};Ze(rt,ut=>{S(I).tripTo?ut(it):ut(Ct,!1)})}we(Ye),we(Le);var Mt=ve(Le,2);{let ut=me(()=>S(I).from.tz||S(I).to.tz);tw(Mt,{get alerts(){return S(I).alerts},get tz(){return S(ut)},variant:"full"})}var jt=ve(Mt,2);{var Gt=ut=>{var Zt=mU(),dr=Ae(Zt);we(Zt),mt(er=>pt(dr,`${yt.dataExpiredSince??""}
						${er??""}`),[()=>J6(new Date(S(I).loopedCalendarSince),S(I).from.tz)]),Z(ut,Zt)};Ze(jt,ut=>{S(I).loopedCalendarSince&&ut(Gt)})}var Or=ve(jt,2);{var _r=ut=>{var Zt=_U(),dr=Ae(Zt);gy(dr,{class:"stroke-destructive size-4"});var er=ve(dr,2),Bt=Ae(er,!0);we(er),we(Zt),mt(()=>pt(Bt,yt.tripCancelled)),Z(ut,Zt)};Ze(Or,ut=>{S(I).cancelled&&ut(_r)})}var wr=ve(Or,2);{var Dr=ut=>{var Zt=yU(),dr=Ae(Zt),er=Ae(dr,!0);we(dr),we(Zt),mt(()=>pt(er,yt.unscheduledTrip)),Z(ut,Zt)};Ze(wr,ut=>{S(I).scheduled||ut(Dr)})}var Et=ve(wr,2);{var vt=ut=>{var Zt=vU(),dr=ue(Zt),er=Ae(dr);we(dr);var Bt=ve(dr,2);t(Bt,()=>S(V),()=>S(I)),mt((mr,Tr)=>pt(er,`${mr??""} (${Tr??""})`),[()=>yt.tripIntermediateStops(0),()=>Bs(S(I).duration)]),Z(ut,Zt)},Pr=ut=>{var Zt=bU(),dr=ue(Zt);t(dr,()=>S(V),()=>S(I));var er=ve(dr,2),Bt=Ae(er),mr=ve(Ae(Bt),2),Tr=Ae(mr);we(mr),we(Bt);var fr=ve(Bt,2);xn(fr,21,()=>S(I).intermediateStops,di,(nr,rr,Nr,Cr)=>{Nh(nr,()=>S(rr).arrival,()=>S(rr).scheduledArrival,()=>S(I).realTime,()=>S(rr),()=>S(I).mode,()=>0)}),we(fr),we(er),mt((nr,rr)=>pt(Tr,`${nr??""}
								(${rr??""})`),[()=>yt.tripIntermediateStops(S(I).intermediateStops?.length??0),()=>Bs(S(I).duration)]),Z(ut,Zt)};Ze(Et,ut=>{S(I).intermediateStops?.length===0?ut(vt):ut(Pr,!1)})}var yr=ve(Et,2);{var Ar=ut=>{Nh(ut,()=>S(I).endTime,()=>S(I).scheduledEndTime,()=>S(I).realTime,()=>S(I).to,()=>S(I).mode,()=>1)};Ze(yr,ut=>{!S(N)&&!(S(D)&&!n(S(U)))&&ut(Ar)})}var br=ve(yr,2);{var lr=ut=>{var Zt=xU();Z(ut,Zt)};Ze(br,ut=>{(S(N)||S(D)&&!n(S(U)))&&ut(lr)})}we(Ne),mt(ut=>wa(Ne,ut),[()=>w2(S(I))]),Z(le,se)},G=le=>{var se=We(),oe=ue(se);{var be=xe=>{var _e=SU(),Ne=ue(_e);Sx(Ne,{get onClickTrip(){return Lp},get l(){return S(I)}});var fe=ve(Ne,2),Le=Ae(fe);Nh(Le,()=>S(I).startTime,()=>S(I).scheduledStartTime,()=>S(I).realTime,()=>S(I).from,()=>S(I).mode,()=>-1,()=>!0);var tt=ve(Le,2);{var Ye=Mt=>{var jt=TU(),Gt=Ae(jt),Or=Ae(Gt);we(Gt),we(jt),mt((_r,wr)=>pt(Or,`${_r??""} -
							${wr??""}`),[()=>ma(new Date(S(I).from.flexStartPickupDropOffWindow),S(I).from.tz),()=>ma(new Date(S(I).from.flexEndPickupDropOffWindow),S(I).from.tz)]),Z(Mt,jt)};Ze(tt,Mt=>{S(I).mode=="FLEX"&&Mt(Ye)})}var rt=ve(tt,2);V5(rt,()=>S(I));var it=ve(rt,2);{var Ct=Mt=>{Nh(Mt,()=>S(I).endTime,()=>S(I).scheduledEndTime,()=>S(I).realTime,()=>S(I).to,()=>S(I).mode,()=>1,()=>!0)};Ze(it,Mt=>{S(N)||Mt(Ct)})}we(fe),mt(Mt=>wa(fe,Mt),[()=>w2(S(I))]),Z(xe,_e)};Ze(oe,xe=>{!(S(N)&&!n(S(I)))&&(k==0&&n(S(I))||!S(U)||!S(U).displayName||S(I).mode!="WALK"||S(B)&&(S(B).mode=="BIKE"||S(I).mode=="WALK"&&S(B).mode=="CAR"||S(B).mode=="RENTAL"))&&xe(be)},!0)}Z(le,se)};Ze($,le=>{S(I).displayName?le(te):le(G,!1)})}Z(P,L)});var a=ve(c,2),g=Ae(a),v=ve(g,2),w=Ae(v);Nh(w,()=>S(s).endTime,()=>S(s).scheduledEndTime,()=>S(s).realTime,()=>S(s).to,()=>S(s).mode,()=>1),we(v),we(a),we(l),mt(P=>wa(g,P),[()=>Sy(S(s))]),Z(r,l),St()}function wi(r,e){Tt(e,!0);let t=ae(e,"beforeLayerId",3,"road-ref-shield");const n=new WeakMap,s=se=>{let oe=n.get(se);return oe||(oe={moves:new Map,frame:null},n.set(se,oe)),oe};function l(se){e.onclick&&e.onclick(se,k.map)}function c(se){e.onmousemove&&e.onmousemove(se,k.map)}function a(se){e.onmouseenter&&e.onmouseenter(se,k.map)}function g(se){e.onmouseleave&&e.onmouseleave(se,k.map)}const v=se=>{const oe=n.get(se);if(oe){for(const[be,xe]of Array.from(oe.moves.entries())){if(!se.getLayer(be)){oe.moves.delete(be);continue}se.getLayer(xe)&&(se.moveLayer(be,xe),oe.moves.delete(be))}oe.moves.size===0&&(oe.frame!==null&&cancelAnimationFrame(oe.frame),n.delete(se))}},w=(se,oe,be)=>{if(!be||be===oe)return;const xe=s(se);xe.moves.set(oe,be),xe.frame===null&&(xe.frame=requestAnimationFrame(()=>{xe.frame=null,v(se)}))},P=(se,oe)=>{if(!se)return;const be=n.get(se);be&&(be.moves.delete(oe),be.moves.size===0&&(be.frame!==null&&cancelAnimationFrame(be.frame),n.delete(se)))};let I=tn({id:e.id});hy("layer",I);let k=Sa("map"),N=Sa("source"),D=!1,B=ps(e.filter),U=ps(e.layout),V=ps(e.paint),L=t(),$=()=>{const se=k.map,oe=se?.getLayer(e.id);if(!N.id){oe&&(I.id=null,se?.removeLayer(e.id)),P(se,e.id);return}if(oe&&e.filter==B&&e.layout==U&&e.paint==V){se&&v(se);return}if(!oe){const be=t()&&se?.getLayer(t())?t():void 0;se.addLayer({source:N.id,id:e.id,type:e.type,filter:e.filter,layout:e.layout,paint:e.paint},be),B=ps(e.filter),U=ps(e.layout),V=ps(e.paint),L=t(),I.id=e.id,t()&&!be&&w(se,e.id,t()),v(se);return}B!=e.filter&&(B=ps(e.filter),se.setFilter(e.id,e.filter)),L!==t()&&(L=t(),t()&&se?.getLayer(t())?se.moveLayer(e.id,t()):t()&&w(se,e.id,t())),se&&v(se)};kr(()=>{k.map&&N.id&&(D||(e.onclick&&k.map.on("click",e.id,l),e.onmousemove&&k.map.on("mousemove",e.id,c),e.onmouseenter&&k.map.on("mouseenter",e.id,a),e.onmouseleave&&k.map.on("mouseleave",e.id,g),k.map.on("styledata",$),$(),D=!0),v(k.map))}),hc(()=>{const se=k.map?.getLayer(e.id);k.map?.off("styledata",$),e.onclick&&k.map?.off("click",e.id,l),e.onmousemove&&k.map?.off("mousemove",e.id,c),e.onmouseenter&&k.map?.off("mouseenter",e.id,a),e.onmouseleave&&k.map?.off("mouseleave",e.id,g),se&&k.map?.removeLayer(e.id),P(k.map,e.id)});var te=We(),G=ue(te);{var le=se=>{var oe=We(),be=ue(oe);Ot(be,()=>e.children),Z(se,oe)};Ze(G,se=>{e.children&&se(le)})}Z(r,te),St()}var ob={exports:{}},I2;function PU(){return I2||(I2=1,(function(r){(function(e){e.version="0.5.0",e.defaults={doThrows:{invalidGeometry:!1}};function t(){var D=1<=arguments.length?[].slice.call(arguments,0):[],B=D.shift(),U=D.shift();Error.apply(this,D),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(B)+", params: "+JSON.stringify(U)}t.prototype=Error,e.errors={InvalidGeometryError:t},e.isGeometryValid=function(D){return!D||!Object.keys(D).length?!1:!!D.type&&!!D.coordinates&&Array.isArray(D.coordinates)&&!!D.coordinates.length},e.parse=function(D,B,U){var V,L=l(B,this.defaults),$;if(s.length=0,g(L),$=k(L),Array.isArray(D)?(V={type:"FeatureCollection",features:[]},D.forEach(function(te){V.features.push(w({item:te,params:L,propFunc:$}))}),c(V,L)):(V=w({item:D,params:L,propFunc:$}),c(V,L)),U&&typeof U=="function")U(V);else return V};var n=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],s=[];function l(D,B){var U=D||{};for(var V in B)B.hasOwnProperty(V)&&!U[V]&&(U[V]=B[V]);return U}function c(D,B){if(B.crs&&a(B.crs)&&(B.isPostgres?D.geometry.crs=B.crs:D.crs=B.crs),B.bbox&&(D.bbox=B.bbox),B.extraGlobal){D.properties={};for(var U in B.extraGlobal)D.properties[U]=B.extraGlobal[U]}}function a(D){if(D.type==="name"){if(D.properties&&D.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}else if(D.type==="link"){if(D.properties&&D.properties.href&&D.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}else throw new Error('Invald CRS. Type attribute must be "name" or "link"')}function g(D){D.geom={};for(var B in D)D.hasOwnProperty(B)&&n.indexOf(B)!==-1&&(D.geom[B]=D[B],delete D[B]);v(D.geom)}function v(D){for(var B in D)D.hasOwnProperty(B)&&(typeof D[B]=="string"?s.push(D[B]):typeof D[B]=="object"&&(s.push(D[B][0]),s.push(D[B][1])));if(s.length===0)throw new Error("No geometry attributes specified")}function w(D){var B=D.item,U=D.params,V=D.propFunc,L={type:"Feature"};return L.geometry=I(B,U),L.properties=V.call(B),L}function P(D){return/^.+\..+$/.test(D)}function I(D,B){var U={};for(var V in B.geom){var L=B.geom[V];if(typeof L=="string"&&D.hasOwnProperty(L))V==="GeoJSON"?U=D[L]:(U.type=V,U.coordinates=D[L]);else if(typeof L=="object"&&!Array.isArray(L)){var $=Object.keys(L).map(function(be){var xe=L[be],_e=D[be];return I(_e,{geom:{Point:xe}})});U.type=V,U.coordinates=[].concat($.map(function(be){return be.coordinates}))}else if(Array.isArray(L)&&D.hasOwnProperty(L[0])&&D.hasOwnProperty(L[1]))U.type=V,U.coordinates=[Number(D[L[1]]),Number(D[L[0]])];else if(Array.isArray(L)&&P(L[0])&&P(L[1])){for(var te=[],G=0;G<L.length;G++){for(var le=L[G].split("."),se=D,oe=0;oe<le.length;oe++){if(!se.hasOwnProperty(le[oe]))return!1;se=se[le[oe]]}te[G]=se}U.type=V,U.coordinates=[Number(te[1]),Number(te[0])]}}if(B.doThrows&&B.doThrows.invalidGeometry&&!e.isGeometryValid(U))throw new t(D,B);return U}function k(D){var B;return!D.exclude&&!D.include?B=function(U){for(var V in this)this.hasOwnProperty(V)&&s.indexOf(V)===-1&&(U[V]=this[V])}:D.include?B=function(U){D.include.forEach(function(V){U[V]=this[V]},this)}:D.exclude&&(B=function(U){for(var V in this)this.hasOwnProperty(V)&&s.indexOf(V)===-1&&D.exclude.indexOf(V)===-1&&(U[V]=this[V])}),function(){var U={};return B.call(this,U),D.extra&&N(U,D.extra),U}}function N(D,B){for(var U in B)B.hasOwnProperty(U)&&(D[U]=B[U]);return D}})(r.exports)})(ob)),ob.exports}PU();function _a(r,e){Tt(e,!0);let t=ae(e,"lineMetrics",3,!1),n=Sa("map"),s=tn({id:null});hy("source",s);const l=()=>{if(!n.map||e.data==null)return;const v=n.map.getSource(e.id);v?v.setData(e.data):n.map.addSource(e.id,{type:"geojson",lineMetrics:t(),data:e.data,...e.options??{}}),s.id=e.id};let c=!1;kr(()=>{n.map&&e.id&&e.data&&(l(),c||(n.map.on("styledata",l),s.id=e.id,c=!0))}),hc(()=>{c&&(n.map?.off("styledata",l),s.id=null,n.map.getSource(e.id)&&n.map?.removeSource(e.id))});var a=We(),g=ue(a);Ot(g,()=>e.children),Z(r,a),St()}var IU={grad:.9,turn:360,rad:360/(2*Math.PI)},qa=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},os=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},yo=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},oI=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},C2=function(r){return{r:yo(r.r,0,255),g:yo(r.g,0,255),b:yo(r.b,0,255),a:yo(r.a)}},ab=function(r){return{r:os(r.r),g:os(r.g),b:os(r.b),a:os(r.a,3)}},CU=/^#([0-9a-f]{3,8})$/i,jm=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},aI=function(r){var e=r.r,t=r.g,n=r.b,s=r.a,l=Math.max(e,t,n),c=l-Math.min(e,t,n),a=c?l===e?(t-n)/c:l===t?2+(n-e)/c:4+(e-t)/c:0;return{h:60*(a<0?a+6:a),s:l?c/l*100:0,v:l/255*100,a:s}},lI=function(r){var e=r.h,t=r.s,n=r.v,s=r.a;e=e/360*6,t/=100,n/=100;var l=Math.floor(e),c=n*(1-t),a=n*(1-(e-l)*t),g=n*(1-(1-e+l)*t),v=l%6;return{r:255*[n,a,c,c,g,n][v],g:255*[g,n,n,a,c,c][v],b:255*[c,c,g,n,n,a][v],a:s}},R2=function(r){return{h:oI(r.h),s:yo(r.s,0,100),l:yo(r.l,0,100),a:yo(r.a)}},M2=function(r){return{h:os(r.h),s:os(r.s),l:os(r.l),a:os(r.a,3)}},k2=function(r){return lI((t=(e=r).s,{h:e.h,s:(t*=((n=e.l)<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:e.a}));var e,t,n},Sp=function(r){return{h:(e=aI(r)).h,s:(s=(200-(t=e.s))*(n=e.v)/100)>0&&s<200?t*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,t,n,s},RU=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,MU=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kU=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,DU=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,D2={string:[[function(r){var e=CU.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?os(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?os(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=kU.exec(r)||DU.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:C2({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=RU.exec(r)||MU.exec(r);if(!e)return null;var t,n,s=R2({h:(t=e[1],n=e[2],n===void 0&&(n="deg"),Number(t)*(IU[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return k2(s)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,n=r.b,s=r.a,l=s===void 0?1:s;return qa(e)&&qa(t)&&qa(n)?C2({r:Number(e),g:Number(t),b:Number(n),a:Number(l)}):null},"rgb"],[function(r){var e=r.h,t=r.s,n=r.l,s=r.a,l=s===void 0?1:s;if(!qa(e)||!qa(t)||!qa(n))return null;var c=R2({h:Number(e),s:Number(t),l:Number(n),a:Number(l)});return k2(c)},"hsl"],[function(r){var e=r.h,t=r.s,n=r.v,s=r.a,l=s===void 0?1:s;if(!qa(e)||!qa(t)||!qa(n))return null;var c=(function(a){return{h:oI(a.h),s:yo(a.s,0,100),v:yo(a.v,0,100),a:yo(a.a)}})({h:Number(e),s:Number(t),v:Number(n),a:Number(l)});return lI(c)},"hsv"]]},O2=function(r,e){for(var t=0;t<e.length;t++){var n=e[t][0](r);if(n)return[n,e[t][1]]}return[null,void 0]},OU=function(r){return typeof r=="string"?O2(r.trim(),D2.string):typeof r=="object"&&r!==null?O2(r,D2.object):[null,void 0]},lb=function(r,e){var t=Sp(r);return{h:t.h,s:yo(t.s+100*e,0,100),l:t.l,a:t.a}},cb=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},F2=function(r,e){var t=Sp(r);return{h:t.h,s:t.s,l:yo(t.l+100*e,0,100),a:t.a}},N2=(function(){function r(e){this.parsed=OU(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return os(cb(this.rgba),2)},r.prototype.isDark=function(){return cb(this.rgba)<.5},r.prototype.isLight=function(){return cb(this.rgba)>=.5},r.prototype.toHex=function(){return e=ab(this.rgba),t=e.r,n=e.g,s=e.b,c=(l=e.a)<1?jm(os(255*l)):"","#"+jm(t)+jm(n)+jm(s)+c;var e,t,n,s,l,c},r.prototype.toRgb=function(){return ab(this.rgba)},r.prototype.toRgbString=function(){return e=ab(this.rgba),t=e.r,n=e.g,s=e.b,(l=e.a)<1?"rgba("+t+", "+n+", "+s+", "+l+")":"rgb("+t+", "+n+", "+s+")";var e,t,n,s,l},r.prototype.toHsl=function(){return M2(Sp(this.rgba))},r.prototype.toHslString=function(){return e=M2(Sp(this.rgba)),t=e.h,n=e.s,s=e.l,(l=e.a)<1?"hsla("+t+", "+n+"%, "+s+"%, "+l+")":"hsl("+t+", "+n+"%, "+s+"%)";var e,t,n,s,l},r.prototype.toHsv=function(){return e=aI(this.rgba),{h:os(e.h),s:os(e.s),v:os(e.v),a:os(e.a,3)};var e},r.prototype.invert=function(){return Vo({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),Vo(lb(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),Vo(lb(this.rgba,-e))},r.prototype.grayscale=function(){return Vo(lb(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),Vo(F2(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),Vo(F2(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?Vo({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):os(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=Sp(this.rgba);return typeof e=="number"?Vo({h:e,s:t.s,l:t.l,a:t.a}):os(t.h)},r.prototype.isEqual=function(e){return this.toHex()===Vo(e).toHex()},r})(),Vo=function(r){return r instanceof N2?r:new N2(r)};const Gn=["coalesce",["get","level"],0],vu=["coalesce",["ceil",["to-number",["get","fromLevel"]]],0],bu=["coalesce",["ceil",["to-number",["get","toLevel"]]],0],xu=["coalesce",["floor",["to-number",["get","fromLevel"]]],0],wu=["coalesce",["floor",["to-number",["get","toLevel"]]],0],L2=["any",["all",["==",vu,Gn],["==",bu,Gn]],["all",["==",xu,Gn],["==",wu,Gn]]],FU=["any",["all",["<",vu,Gn],["<",bu,Gn]],["all",["<",xu,Gn],["<",wu,Gn]]],B2=["any",["all",[">",vu,Gn],[">",bu,Gn]],["all",[">",xu,Gn],[">",wu,Gn]]],z2=["all",["any",["==",vu,Gn],["==",xu,Gn]],["any",[">",bu,Gn],[">",wu,Gn]]],U2=["all",["any",[">",vu,Gn],[">",xu,Gn]],["any",["==",bu,Gn],["==",wu,Gn]]],V2=["all",["any",["==",vu,Gn],["==",xu,Gn]],["any",["<",bu,Gn],["<",wu,Gn]]],j2=["all",["any",["<",vu,Gn],["<",xu,Gn]],["any",["==",bu,Gn],["==",wu,Gn]]],ep="#42a5f5",tp="#0077c2",rp="#aaaaaa",Lh="#555555",Wc=7,Bh=Wc+2,W2=[{id:"indoor-routing-path-current-outline",type:"line",filter:L2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":tp,"line-width":Bh}},{id:"indoor-routing-lower-path-down-outline",type:"line",filter:V2,layout:{"line-join":"round"},paint:{"line-width":Bh,"line-gradient":["interpolate",["linear"],["line-progress"],0,tp,1,Lh]}},{id:"indoor-routing-lower-path-down",type:"line",filter:V2,layout:{"line-join":"round"},paint:{"line-width":Wc,"line-gradient":["interpolate",["linear"],["line-progress"],0,ep,1,rp]}},{id:"indoor-routing-lower-path-up-outline",type:"line",filter:j2,layout:{"line-join":"round"},paint:{"line-width":Bh,"line-gradient":["interpolate",["linear"],["line-progress"],0,Lh,1,tp]}},{id:"indoor-routing-lower-path-up",type:"line",filter:j2,layout:{"line-join":"round"},paint:{"line-width":Wc,"line-gradient":["interpolate",["linear"],["line-progress"],0,rp,1,ep]}},{id:"indoor-routing-upper-path-down-outline",type:"line",filter:U2,layout:{"line-join":"round"},paint:{"line-width":Bh,"line-gradient":["interpolate",["linear"],["line-progress"],0,Lh,1,tp]}},{id:"indoor-routing-upper-path-up-outline",type:"line",filter:z2,layout:{"line-join":"round"},paint:{"line-width":Bh,"line-gradient":["interpolate",["linear"],["line-progress"],0,tp,1,Lh]}},{id:"indoor-routing-path-concealed-below-outline",type:"line",filter:FU,layout:{"line-join":"round"},paint:{"line-color":Lh,"line-width":2,"line-gap-width":6,"line-dasharray":["literal",[2,2]]}},{id:"indoor-routing-path-above-outline",type:"line",filter:B2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":Lh,"line-width":Bh}},{id:"indoor-routing-path-current",type:"line",filter:L2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":ep,"line-width":Wc}},{id:"indoor-routing-upper-path-down",type:"line",filter:U2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":Wc,"line-gradient":["interpolate",["linear"],["line-progress"],0,rp,1,ep]}},{id:"indoor-routing-upper-path-up",type:"line",filter:z2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":Wc,"line-gradient":["interpolate",["linear"],["line-progress"],0,ep,1,rp]}},{id:"indoor-routing-path-above",type:"line",filter:B2,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":rp,"line-width":Wc}}];var NU=Fe("<!> <!> <!>",1),LU=Fe("<!> <!>",1);function $2(r,e){Tt(e,!0);const t=6;function n(P){return P=="WALK"||P=="BIKE"||P=="CAR"}function s(P){switch(P){case"CAR":return"#bf75ff";default:return"#42a5f5"}}function l(P){return{type:"FeatureCollection",features:P.legs.flatMap(I=>{if(I.steps){const k=n(I.mode)?s(I.mode):`${nl(I)[0]}`,N=Vo(k).darken(.2).toHex();return I.steps.map(D=>({type:"Feature",properties:{color:k,outlineColor:N,fromLevel:D.fromLevel,toLevel:D.toLevel,level:e.level,way:D.osmWay},geometry:{type:"LineString",coordinates:Qc.decode(D.polyline.points,t).map(([B,U])=>[U,B])}}))}else{const k=`${nl(I)[0]}`;return{type:"Feature",properties:{outlineColor:Vo(k).darken(.2).toHex(),color:k},geometry:{type:"LineString",coordinates:Qc.decode(I.legGeometry.points,t).map(([D,B])=>[B,D])}}}})}}const c=me(()=>l(e.itinerary));var a={PRECISION:t},g=LU(),v=ue(g);_a(v,{get id(){return`route-${e.id??""}`},get data(){return S(c)},children:(P,I)=>{var k=NU(),N=ue(k);xn(N,17,()=>W2,U=>U.id,(U,V)=>{var L=We(),$=ue(L);{var te=G=>{wi(G,{get id(){return S(V).id},get type(){return S(V).type},get layout(){return S(V).layout},get filter(){return S(V).filter},get paint(){return S(V).paint}})};Ze($,G=>{!("line-gradient"in S(V).paint)&&e.selected&&G(te)})}Z(U,L)});var D=ve(N,2);{let U=me(()=>e.selectItinerary?L=>{e.selectItinerary()}:void 0),V=me(()=>({"line-color":e.selected?["get","color"]:e.theme=="dark"?"#777":"#bbb","line-width":7.5,"line-opacity":.8}));wi(D,{get id(){return`path-${e.id??""}`},type:"line",layout:{"line-join":"round","line-cap":"round"},filter:["!",["has","fromLevel"]],get onclick(){return S(U)},get paint(){return S(V)}})}var B=ve(D,2);{let U=me(()=>({"line-color":e.selected?["get","outlineColor"]:e.theme=="dark"?"#444":"#999","line-width":1.5,"line-gap-width":7.5,"line-opacity":.8}));wi(B,{get id(){return`path-outline-${e.id??""}`},type:"line",layout:{"line-join":"round","line-cap":"round"},filter:["!",["has","fromLevel"]],get paint(){return S(U)}})}Z(P,k)},$$slots:{default:!0}});var w=ve(v,2);return _a(w,{get id(){return`route-${e.id??""}-metrics`},get data(){return S(c)},lineMetrics:!0,children:(P,I)=>{var k=We(),N=ue(k);xn(N,17,()=>W2,D=>D.id,(D,B)=>{var U=We(),V=ue(U);{var L=$=>{wi($,{get id(){return`${S(B).id??""}-metrics`},get type(){return S(B).type},get layout(){return S(B).layout},get filter(){return S(B).filter},get paint(){return S(B).paint}})};Ze(V,$=>{"line-gradient"in S(B).paint&&e.selected&&$(L)})}Z(D,U)}),Z(P,k)},$$slots:{default:!0}}),Z(r,g),St(a)}var BU=Fe('<div class="relative w-full overflow-auto"><table><!></table></div>');function Ax(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=BU(),l=Ae(s);sn(l,a=>({class:a,...n}),[()=>_n("w-full caption-bottom text-sm",e.class)]);var c=Ae(l);Ot(c,()=>e.children??Ht),we(l),as(l,a=>t(a),()=>t()),we(s),Z(r,s),St()}var zU=Fe("<tbody><!></tbody>");function Ex(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=zU();sn(s,c=>({class:c,...n}),[()=>_n("[&_tr:last-child]:border-0",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var UU=Fe("<td><!></td>");function mo(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=UU();sn(s,c=>({class:c,...n}),[()=>_n("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var VU=Fe("<th><!></th>");function ca(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=VU();sn(s,c=>({class:c,...n}),[()=>_n("text-muted-foreground h-10 px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var jU=Fe("<thead><!></thead>");function H2(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=jU();sn(s,c=>({class:c,...n}),[()=>_n("[&_tr]:border-b",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}var WU=Fe("<tr><!></tr>");function hp(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=hr(e,["$$slots","$$events","$$legacy","ref","class","children"]);var s=WU();sn(s,c=>({class:c,...n}),[()=>_n("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e.class)]);var l=Ae(s);Ot(l,()=>e.children??Ht),we(s),as(s,c=>t(c),()=>t()),Z(r,s),St()}function Yh(r,e){Tt(e,!0);let t=Sa("map"),n=ae(e,"location",15),s=ae(e,"marker",15),l=!1;kr(()=>{t.map&&n().match&&(l||(s(new qn.Marker({draggable:e.draggable,color:e.color}).setLngLat(n().match).addTo(t.map)),s().on("dragend",()=>{if(s()&&n().match){let c=Ri(s().getLngLat(),e.level??0);n(c),n(n().label=c.label,!0)}}),l=!0))}),kr(()=>{s()&&n()&&n().match&&n().match.lat&&n().match.lon&&s().setLngLat(n().match)}),hc(()=>{s()&&(s().remove(),s(void 0))}),St()}var $U=Fe("<div><!></div>");function Gl(r,e){Tt(e,!0);let t=Sa("map"),n=Sa("layer"),s=wt(void 0),l=wt(void 0),c=wt(void 0),a=wt(void 0);const g=()=>{S(l)&&(S(l).remove(),pe(l,void 0))},v=B=>{t.map&&(S(l)&&S(l).remove(),pe(l,new qn.Popup({anchor:"top-left",closeButton:!1}),!0),S(l).setLngLat(B.lngLat),S(l).addTo(t.map),pe(c,B),pe(a,B.features))},w=()=>{t.map&&(t.map.getCanvas().style.cursor="pointer")},P=()=>{t.map&&(t.map.getCanvas().style.cursor="")};let I=!1;kr(()=>{t.map&&(I||(n?(t.map.on(e.trigger,n.id,v),t.map.on("mouseenter",n.id,w),t.map.on("mouseleave",n.id,P)):t.map.on(e.trigger,v)),I=!0)}),kr(()=>{S(l)&&S(s)&&S(l).setDOMContent(S(s))}),hc(()=>{S(l)&&(S(l).remove(),pe(l,void 0)),t.map&&I&&(n?(t.map.off(e.trigger,n.id,v),t.map.off("mouseenter",n.id,w),t.map.off("mouseleave",n.id,P)):t.map.off(e.trigger,v))});var k=We(),N=ue(k);{var D=B=>{var U=$U(),V=Ae(U);{var L=$=>{var te=We(),G=ue(te);Ot(G,()=>e.children,()=>S(c),()=>g,()=>S(a)),Z($,te)};Ze(V,$=>{e.children&&$(L)})}we(U),as(U,$=>pe(s,$),()=>S(s)),mt(()=>fi(U,1,bo(e.class))),Z(B,U)};Ze(N,B=>{S(l)&&S(c)&&B(D)})}Z(r,k),St()}const Uc=(r,e=Ht,t=Ht,n=Ht)=>{Ax(r,{children:(s,l)=>{Ex(s,{children:(c,a)=>{var g=We(),v=ue(g);xn(v,17,()=>Object.entries(n()[0].properties),di,(w,P)=>{var I=me(()=>m0(S(P),2));let k=()=>S(I)[0],N=()=>S(I)[1];hp(w,{children:(D,B)=>{var U=XU(),V=ue(U);mo(V,{children:($,te)=>{Yr();var G=Br();mt(()=>pt(G,k())),Z($,G)},$$slots:{default:!0}});var L=ve(V,2);mo(L,{children:($,te)=>{var G=We(),le=ue(G);{var se=be=>{var xe=HU(),_e=Ae(xe,!0);we(xe),mt(()=>{Fn(xe,"href",`https://www.openstreetmap.org/node/${N()??""}`),pt(_e,N())}),Z(be,xe)},oe=be=>{var xe=We(),_e=ue(xe);{var Ne=Le=>{var tt=ZU(),Ye=Ae(tt,!0);we(tt),mt(()=>{Fn(tt,"href",`https://www.openstreetmap.org/way/${N()??""}`),pt(Ye,N())}),Z(Le,tt)},fe=Le=>{var tt=Br();mt(()=>pt(tt,N())),Z(Le,tt)};Ze(_e,Le=>{k()==="osm_way_id"?Le(Ne):Le(fe,!1)},!0)}Z(be,xe)};Ze(le,be=>{k()==="osm_node_id"?be(se):be(oe,!1)})}Z($,G)},$$slots:{default:!0}}),Z(D,U)},$$slots:{default:!0}})}),Z(c,g)},$$slots:{default:!0}})},$$slots:{default:!0}})};var HU=Fe('<a class="underline bold text-blue-400" target="_blank"> </a>'),ZU=Fe('<a class="underline bold text-blue-400" target="_blank"> </a>'),XU=Fe("<!> <!>",1),qU=Fe("<!> <!> <!>",1),GU=Fe("<!> <!> <!>",1),YU=Fe("<!> <!>",1),KU=Fe('<!> <div class="flex justify-between gap-4"><!> <!> <!></div>',1),QU=Fe('<div class="w-full flex justify-between bg-muted items-center"><h2 class="text-lg ml-2 font-bold"> <span class="ml-2 text-sm text-muted-foreground"> </span></h2> <!></div> <!>',1),JU=Fe("<!> <!>",1),e8=Fe("<!> <!>",1),t8=Fe("<!> <!> <!> <!> <!>",1),r8=Fe(' <br/> <span class="text-xs text-muted-foreground font-mono"> </span>',1),n8=Fe("<!> <!>",1),i8=Fe("<!> <!>",1),s8=Fe("<!> <!> <!> <!> <!>",1),o8=Fe("<!> <!>",1),a8=Fe('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"> <span class="text-xs text-muted-foreground font-mono"> </span> <span class="text-sm text-muted-foreground"> </span></h2> <!></div> <!>',1),l8=Fe("<!> <!>",1),c8=Fe("<!> <!> <!> <!>",1),u8=Fe("<!> <!>",1),h8=Fe("<!> <!> <!>",1),d8=Fe("<!> <!>",1),f8=Fe("<!> <!> <!> <!> <!> <!> <!> <!>",1),p8=Fe("<!>  <!> <!>",1);function g8(r,e){Tt(e,!0);const t=nx.getConfig().baseUrl,n=async(Ye,rt)=>await(await fetch(`${t}${Ye}`,{method:"POST",mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify(rt)})).json(),s=async Ye=>await(await fetch(`${t}${Ye}`,{method:"GET",mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"}})).json(),l=Ye=>({lat:Ye.match.lat,lng:Ye.match.lon,level:Ye.match.level??0}),c=async Ye=>await n("/api/route",Ye),a=async Ye=>await n("/api/matches",Ye.toArray().flat()),g=async Ye=>{const rt=Ye.getSouthWest(),it=Ye.getNorthEast();return await s(`/api/debug/flex?min=${rt.lat},${rt.lng}&max=${it.lat},${it.lng}`)},v=async Ye=>await n("/api/elevators",Ye.toArray().flat()),w=async Ye=>(console.log(JSON.stringify(Ye)),await n("/api/update_elevator",Ye)),P=async(Ye,rt)=>await n("/api/graph",{level:rt,waypoints:Ye.toArray().flat()});let I=wt(!1),k=wt(void 0),N=me(()=>S(k)&&e.bounds&&S(I)?Ek({query:{id:S(k)}}).then(Ye=>Ye.data):void 0),D=me(()=>e.bounds&&S(I)&&e.zoom>15?a(qn.LngLatBounds.convert(e.bounds)):void 0),B=me(()=>e.bounds&&S(I)?g(qn.LngLatBounds.convert(e.bounds)):void 0);const U=Ye=>({...Ye,outOfService:JSON.parse(Ye.outOfService).map(([rt,it])=>[new Date(rt),new Date(it)])});let V=wt(null),L=wt(null);kr(()=>{S(I)&&e.bounds&&e.zoom>15?(P(qn.LngLatBounds.convert(e.bounds),e.level).then(Ye=>{pe(V,Ye,!0)}),v(qn.LngLatBounds.convert(e.bounds)).then(Ye=>{pe(L,Ye,!0)})):pe(V,null)});let $=wt(void 0),te=wt(void 0),G=wt(void 0),le=me(()=>S(te)?.match?.lat&&S(te)?.match.lon&&S(G)?.match?.lat&&S(G)?.match.lon&&S($)?c({start:l(S(te)),destination:l(S(G)),profile:S($),direction:"forward"}):void 0),se=wt(null),oe=wt(null);var be={getGraph:P},xe=p8(),_e=ue(xe);{let Ye=me(()=>S(I)?"default":"outline");An(_e,{size:"icon",get variant(){return S(Ye)},onclick:()=>{pe(I,!S(I))},children:(rt,it)=>{lD(rt,{size:"icon",class:"h-[1.2rem] w-[1.2rem]"})},$$slots:{default:!0}})}var Ne=ve(_e,2);{var fe=Ye=>{_o(Ye,{position:"bottom-right",children:(rt,it)=>{var Ct=We(),Mt=ue(Ct);ar(Mt,()=>pa,(jt,Gt)=>{Gt(jt,{class:"min-w-[550px] mb-4",children:(Or,_r)=>{var wr=QU(),Dr=ue(wr),Et=Ae(Dr),vt=Ae(Et),Pr=ve(vt),yr=Ae(Pr,!0);we(Pr),we(Et);var Ar=ve(Et,2);An(Ar,{variant:"ghost",onclick:()=>pe(oe,null),children:(lr,ut)=>{Kc(lr,{})},$$slots:{default:!0}}),we(Dr);var br=ve(Dr,2);ar(br,()=>K6,(lr,ut)=>{ut(lr,{class:"flex flex-col gap-6",children:(Zt,dr)=>{var er=KU(),Bt=ue(er);Ax(Bt,{children:(rr,Nr)=>{var Cr=YU(),qr=ue(Cr);H2(qr,{children:(or,Re)=>{hp(or,{children:(Y,ee)=>{var ie=qU(),Te=ue(ie);ca(Te,{class:"font-semibold",children:(Ge,Ve)=>{Yr();var nt=Br("Not available from");Z(Ge,nt)},$$slots:{default:!0}});var Ce=ve(Te,2);ca(Ce,{class:"font-semibold",children:(Ge,Ve)=>{Yr();var nt=Br("to");Z(Ge,nt)},$$slots:{default:!0}});var Be=ve(Ce,2);ca(Be,{}),Z(Y,ie)},$$slots:{default:!0}})},$$slots:{default:!0}});var ir=ve(qr,2);Ex(ir,{children:(or,Re)=>{var Y=We(),ee=ue(Y);{var ie=Te=>{var Ce=We(),Be=ue(Ce);xn(Be,17,()=>S(oe).outOfService,di,(Ge,Ve,nt)=>{hp(Ge,{children:(At,bt)=>{var ur=GU(),Xe=ue(ur);mo(Xe,{children:(Lt,gr)=>{j_(Lt,{get value(){return S(oe).outOfService[nt][0]},set value(Lr){S(oe).outOfService[nt][0]=Lr}})},$$slots:{default:!0}});var Xt=ve(Xe,2);mo(Xt,{children:(Lt,gr)=>{j_(Lt,{get value(){return S(oe).outOfService[nt][1]},set value(Lr){S(oe).outOfService[nt][1]=Lr}})},$$slots:{default:!0}});var xr=ve(Xt,2);mo(xr,{children:(Lt,gr)=>{An(Lt,{variant:"outline",onclick:()=>S(oe).outOfService.splice(nt,1),children:(Lr,je)=>{Kc(Lr,{})},$$slots:{default:!0}})},$$slots:{default:!0}}),Z(At,ur)},$$slots:{default:!0}})}),Z(Te,Ce)};Ze(ee,Te=>{S(oe).outOfService&&Te(ie)})}Z(or,Y)},$$slots:{default:!0}}),Z(rr,Cr)},$$slots:{default:!0}});var mr=ve(Bt,2),Tr=Ae(mr);An(Tr,{variant:"outline",onclick:()=>S(oe).outOfService.push([new Date,new Date]),children:(rr,Nr)=>{Yr();var Cr=Br("Add Maintainance");Z(rr,Cr)},$$slots:{default:!0}});var fr=ve(Tr,2);An(fr,{class:"w-48",variant:"outline",onclick:()=>{pe(se,w(S(oe)),!0)},children:(rr,Nr)=>{var Cr=We(),qr=ue(Cr);{var ir=Re=>{var Y=We(),ee=ue(Y);Ja(ee,()=>S(se),ie=>{Np(ie,{class:"animate-spin w-4 h-4"})},(ie,Te)=>{var Ce=Br("Update");Z(ie,Ce)}),Z(Re,Y)},or=Re=>{var Y=Br("Update");Z(Re,Y)};Ze(qr,Re=>{S(se)!=null?Re(ir):Re(or,!1)})}Z(rr,Cr)},$$slots:{default:!0}});var nr=ve(fr,2);An(nr,{onclick:()=>{pe(se,w({id:S(oe).id,status:S(oe).status==="ACTIVE"?"INACTIVE":"ACTIVE"}),!0)},children:(rr,Nr)=>{var Cr=We(),qr=ue(Cr);{var ir=Re=>{var Y=Br("DEACTIVATE");Z(Re,Y)},or=Re=>{var Y=Br("ACTIVATE");Z(Re,Y)};Ze(qr,Re=>{S(oe).status==="ACTIVE"?Re(ir):Re(or,!1)})}Z(rr,Cr)},$$slots:{default:!0}}),we(mr),Z(Zt,er)},$$slots:{default:!0}})}),mt(()=>{pt(vt,`Fahrstuhl ${S(oe).desc??""} `),pt(yr,S(oe).id)}),Z(Or,wr)},$$slots:{default:!0}})}),Z(rt,Ct)},$$slots:{default:!0}})};Ze(Ne,Ye=>{S(oe)&&Ye(fe)})}var Le=ve(Ne,2);{var tt=Ye=>{var rt=f8(),it=ue(rt);{var Ct=ut=>{var Zt=We(),dr=ue(Zt);Ja(dr,()=>S(N),null,(er,Bt)=>{var mr=We(),Tr=ue(mr);{var fr=nr=>{_o(nr,{position:"bottom-right",children:(rr,Nr)=>{var Cr=We(),qr=ue(Cr);ar(qr,()=>pa,(ir,or)=>{or(ir,{class:"w-[600px] h-[500px] overflow-y-auto bg-background rounded-lg",children:(Re,Y)=>{var ee=a8(),ie=ue(ee),Te=Ae(ie),Ce=Ae(Te),Be=ve(Ce),Ge=Ae(Be,!0);we(Be);var Ve=ve(Be,2),nt=Ae(Ve);we(Ve),we(Te);var At=ve(Te,2);An(At,{variant:"ghost",onclick:()=>{pe(k,void 0)},children:(ur,Xe)=>{Kc(ur,{})},$$slots:{default:!0}}),we(ie);var bt=ve(ie,2);Ax(bt,{children:(ur,Xe)=>{var Xt=o8(),xr=ue(Xt);H2(xr,{children:(gr,Lr)=>{hp(gr,{children:(je,ht)=>{var Rt=t8(),gt=ue(Rt);ca(gt,{class:"text-center",children:(xt,Wt)=>{Yr();var sr=Br("Station");Z(xt,sr)},$$slots:{default:!0}});var Ut=ve(gt,2);ca(Ut,{class:"text-center",children:(xt,Wt)=>{Yr();var sr=Br("Default");Z(xt,sr)},$$slots:{default:!0}});var kt=ve(Ut,2);{var $e=xt=>{var Wt=JU(),sr=ue(Wt);ca(sr,{class:"text-center",children:(Gr,cn)=>{Yr();var Yt=Br("Foot");Z(Gr,Yt)},$$slots:{default:!0}});var Qr=ve(sr,2);ca(Qr,{class:"text-center",children:(Gr,cn)=>{Yr();var Yt=Br("Foot Routed");Z(Gr,Yt)},$$slots:{default:!0}}),Z(xt,Wt)};Ze(kt,xt=>{S(Bt).hasFootTransfers&&xt($e)})}var cr=ve(kt,2);{var Rr=xt=>{var Wt=e8(),sr=ue(Wt);ca(sr,{class:"text-center",children:(Gr,cn)=>{Yr();var Yt=Br("Wheelchair");Z(Gr,Yt)},$$slots:{default:!0}});var Qr=ve(sr,2);ca(Qr,{class:"text-center",children:(Gr,cn)=>{Yr();var Yt=Br("Wheelchair Routed");Z(Gr,Yt)},$$slots:{default:!0}}),Z(xt,Wt)};Ze(cr,xt=>{S(Bt).hasWheelchairTransfers&&xt(Rr)})}var rn=ve(cr,2);{var vn=xt=>{ca(xt,{class:"text-center",children:(Wt,sr)=>{Yr();var Qr=Br("Car");Z(Wt,Qr)},$$slots:{default:!0}})};Ze(rn,xt=>{S(Bt).hasCarTransfers&&xt(vn)})}Z(je,Rt)},$$slots:{default:!0}})},$$slots:{default:!0}});var Lt=ve(xr,2);Ex(Lt,{children:(gr,Lr)=>{var je=We(),ht=ue(je);xn(ht,17,()=>S(Bt).transfers,di,(Rt,gt)=>{hp(Rt,{children:(Ut,kt)=>{var $e=s8(),cr=ue($e);mo(cr,{children:(Gr,cn)=>{Yr();var Yt=r8(),un=ue(Yt),nn=ve(un,3),wn=Ae(nn,!0);we(nn),mt(()=>{pt(un,`${S(gt).to.name??""} `),pt(wn,S(gt).to.stopId)}),Z(Gr,Yt)},$$slots:{default:!0}});var Rr=ve(cr,2);mo(Rr,{children:(Gr,cn)=>{var Yt=We(),un=ue(Yt);{var nn=wn=>{An(wn,{variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"foot")},children:(jr,Tn)=>{Yr();var Pn=Br();mt(()=>pt(Pn,S(gt).default)),Z(jr,Pn)},$$slots:{default:!0}})};Ze(un,wn=>{S(gt).default!==void 0&&wn(nn)})}Z(Gr,Yt)},$$slots:{default:!0}});var rn=ve(Rr,2);{var vn=Gr=>{var cn=n8(),Yt=ue(cn);mo(Yt,{children:(nn,wn)=>{var jr=We(),Tn=ue(jr);{var Pn=dn=>{An(dn,{variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"foot")},children:(It,Hr)=>{Yr();var bn=Br();mt(()=>pt(bn,S(gt).foot)),Z(It,bn)},$$slots:{default:!0}})};Ze(Tn,dn=>{S(gt).foot!==void 0&&dn(Pn)})}Z(nn,jr)},$$slots:{default:!0}});var un=ve(Yt,2);mo(un,{children:(nn,wn)=>{var jr=We(),Tn=ue(jr);{var Pn=dn=>{An(dn,{variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"foot")},children:(It,Hr)=>{Yr();var bn=Br();mt(()=>pt(bn,S(gt).footRouted)),Z(It,bn)},$$slots:{default:!0}})};Ze(Tn,dn=>{S(gt).footRouted!==void 0&&dn(Pn)})}Z(nn,jr)},$$slots:{default:!0}}),Z(Gr,cn)};Ze(rn,Gr=>{S(Bt).hasFootTransfers&&Gr(vn)})}var xt=ve(rn,2);{var Wt=Gr=>{var cn=i8(),Yt=ue(cn);mo(Yt,{children:(nn,wn)=>{var jr=We(),Tn=ue(jr);{var Pn=dn=>{{let It=me(()=>S(gt).wheelchairUsesElevator?"text-red-500":"text-green-500");An(dn,{get class(){return S(It)},variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"wheelchair")},children:(Hr,bn)=>{Yr();var fn=Br();mt(()=>pt(fn,S(gt).wheelchair)),Z(Hr,fn)},$$slots:{default:!0}})}};Ze(Tn,dn=>{S(gt).wheelchair!==void 0&&dn(Pn)})}Z(nn,jr)},$$slots:{default:!0}});var un=ve(Yt,2);mo(un,{children:(nn,wn)=>{var jr=We(),Tn=ue(jr);{var Pn=dn=>{{let It=me(()=>S(gt).wheelchairUsesElevator?"text-red-500":"text-green-500");An(dn,{get class(){return S(It)},variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"wheelchair")},children:(Hr,bn)=>{Yr();var fn=Br();mt(()=>pt(fn,S(gt).wheelchairRouted)),Z(Hr,fn)},$$slots:{default:!0}})}};Ze(Tn,dn=>{S(gt).wheelchairRouted!==void 0&&dn(Pn)})}Z(nn,jr)},$$slots:{default:!0}}),Z(Gr,cn)};Ze(xt,Gr=>{S(Bt).hasWheelchairTransfers&&Gr(Wt)})}var sr=ve(xt,2);{var Qr=Gr=>{mo(Gr,{children:(cn,Yt)=>{var un=We(),nn=ue(un);{var wn=jr=>{An(jr,{variant:"outline",onclick:()=>{pe(te,Ri(S(Bt).place,S(Bt).place.level)),pe(G,Ri(S(gt).to,S(gt).to.level)),pe($,"car")},children:(Tn,Pn)=>{Yr();var dn=Br();mt(()=>pt(dn,S(gt).car)),Z(Tn,dn)},$$slots:{default:!0}})};Ze(nn,jr=>{S(gt).car!==void 0&&jr(wn)})}Z(cn,un)},$$slots:{default:!0}})};Ze(sr,Gr=>{S(Bt).hasCarTransfers&&Gr(Qr)})}Z(Ut,$e)},$$slots:{default:!0}})}),Z(gr,je)},$$slots:{default:!0}}),Z(ur,Xt)},$$slots:{default:!0}}),mt(()=>{pt(Ce,`${S(Bt).place.name??""}
								${S(Bt).place.track??""} `),pt(Ge,S(Bt).place.stopId),pt(nt,`Level: ${S(Bt).place.level??""}`)}),Z(Re,ee)},$$slots:{default:!0}})}),Z(rr,Cr)},$$slots:{default:!0}})};Ze(Tr,nr=>{S(Bt)&&nr(fr)})}Z(er,mr)}),Z(ut,Zt)};Ze(it,ut=>{S(N)&&ut(Ct)})}var Mt=ve(it,2);{var jt=ut=>{var Zt=We(),dr=ue(Zt);Ja(dr,()=>S(D),null,(er,Bt)=>{_a(er,{id:"matches",get data(){return S(Bt)},children:(mr,Tr)=>{var fr=l8(),nr=ue(fr);wi(nr,{onclick:Nr=>{const Cr=Nr.features[0].properties;pe(k,Cr.id,!0)},id:"matches",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","type"],"location","#34ebde","#fa921b"],"circle-radius":5},children:(Nr,Cr)=>{Gl(Nr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}});var rr=ve(nr,2);wi(rr,{id:"match",type:"line",filter:["all",["==","type","match"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ff00","line-width":3},children:(Nr,Cr)=>{Gl(Nr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}}),Z(mr,fr)},$$slots:{default:!0}})}),Z(ut,Zt)};Ze(Mt,ut=>{S(D)&&ut(jt)})}var Gt=ve(Mt,2);{var Or=ut=>{var Zt=We(),dr=ue(Zt);Ja(dr,()=>S(B),null,(er,Bt)=>{_a(er,{id:"flex",get data(){return S(Bt)},children:(mr,Tr)=>{var fr=c8(),nr=ue(fr);wi(nr,{onclick:qr=>{const ir=qr.features[0].properties;pe(k,ir.id,!0)},id:"flex-location-groups",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":"#00ff00","circle-radius":5},children:(qr,ir)=>{Gl(qr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}});var rr=ve(nr,2);wi(rr,{id:"flex-areas",type:"fill",layout:{},filter:["literal",!0],paint:{"fill-color":"#088","fill-opacity":.4,"fill-outline-color":"#000"}});var Nr=ve(rr,2);wi(Nr,{id:"flex-areas-outline",type:"line",layout:{},filter:["literal",!0],paint:{"line-color":"#000","line-width":2}});var Cr=ve(Nr,2);wi(Cr,{id:"flex-areas-labels",type:"symbol",layout:{"symbol-placement":"point","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":16},filter:["literal",!0],paint:{"text-halo-width":12,"text-halo-color":"#fff","text-color":"#f00"}}),Z(mr,fr)},$$slots:{default:!0}})}),Z(ut,Zt)};Ze(Gt,ut=>{S(B)&&ut(Or)})}var _r=ve(Gt,2);{var wr=ut=>{var Zt=We(),dr=ue(Zt);Ja(dr,()=>S(le),null,(er,Bt)=>{var mr=We(),Tr=ue(mr);{var fr=nr=>{_a(nr,{id:"route",get data(){return S(Bt)},children:(rr,Nr)=>{var Cr=u8(),qr=ue(Cr);{let or=me(()=>["any",["!has","level"],["==","level",e.level]]);wi(qr,{id:"path-outline",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return S(or)},paint:{"line-color":"#cfa900","line-width":7.5,"line-opacity":.8}})}var ir=ve(qr,2);{let or=me(()=>["any",["!has","level"],["==","level",e.level]]);wi(ir,{id:"path",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return S(or)},paint:{"line-color":"#fccf03","line-width":5,"line-opacity":.8}})}Z(rr,Cr)},$$slots:{default:!0}})};Ze(Tr,nr=>{S(Bt).type=="FeatureCollection"&&nr(fr)})}Z(er,mr)}),Z(ut,Zt)};Ze(_r,ut=>{S(le)&&ut(wr)})}var Dr=ve(_r,2);{var Et=ut=>{_a(ut,{id:"graph",get data(){return S(V)},children:(Zt,dr)=>{var er=h8(),Bt=ue(er);{let fr=me(()=>["all",["==","type","geometry"],["any",["!has","level"],["==","level",e.level]]]);wi(Bt,{id:"graph-geometry",type:"line",get filter(){return S(fr)},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#e55e5e","line-width":3,"line-opacity":1},children:(nr,rr)=>{Gl(nr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}})}var mr=ve(Bt,2);{let fr=me(()=>["all",["==","type","edge"],["any",["!has","level"],["==","level",e.level]]]);wi(mr,{id:"graph-edge",type:"line",get filter(){return S(fr)},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#a300d9","line-width":3},children:(nr,rr)=>{Gl(nr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}})}var Tr=ve(mr,2);wi(Tr,{id:"graph-node",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","label"],"unreachable","#ff1150","#11ffaf"],"circle-radius":5},children:(fr,nr)=>{Gl(fr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}}),Z(Zt,er)},$$slots:{default:!0}})};Ze(Dr,ut=>{S(V)!=null&&ut(Et)})}var vt=ve(Dr,2);{var Pr=ut=>{_a(ut,{id:"elevators",get data(){return S(L)},children:(Zt,dr)=>{var er=d8(),Bt=ue(er);wi(Bt,{id:"elevators",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","status"],"ACTIVE","#ffff00","#ff00ff"],"circle-radius":8},onclick:Tr=>{pe(oe,U(Tr.features[0].properties),!0)}});var mr=ve(Bt,2);wi(mr,{id:"elevators-match",type:"line",filter:["all",["==","type","match"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ff00","line-width":3},children:(Tr,fr)=>{Gl(Tr,{trigger:"click",get children(){return Uc}})},$$slots:{default:!0}}),Z(Zt,er)},$$slots:{default:!0}})};Ze(vt,ut=>{S(L)&&ut(Pr)})}var yr=ve(vt,2);{var Ar=ut=>{Yh(ut,{color:"magenta",draggable:!1,get location(){return S(te)}})};Ze(yr,ut=>{S(te)&&ut(Ar)})}var br=ve(yr,2);{var lr=ut=>{Yh(ut,{color:"yellow",draggable:!1,get location(){return S(G)}})};Ze(br,ut=>{S(G)&&ut(lr)})}Z(Ye,rt)};Ze(Le,Ye=>{S(I)&&Ye(tt)})}return Z(r,xe),St(be)}function cc(r){const e=qn.LngLat.convert(r);return`${e.lat},${e.lng}`}const m_=17;var m8=Fe("<!> ",1);function _8(r,e){Tt(e,!0);let t=ae(e,"level",15),n=wt("level-0"),s=wt(tn([]));kr(()=>{t(Number(S(n).substring(6)))}),kr(()=>{if(e.bounds&&e.zoom&&e.zoom>m_){const g=qn.LngLatBounds.convert(e.bounds),v=cc(g.getNorthWest()),w=cc(g.getSouthEast());Pk({query:{min:v,max:w}}).then(P=>{pe(s,P.data?.filter(I=>Number.isInteger(I)).map(I=>String(I))??[],!0)})}else pe(s,[],!0),t(0)});var l=We(),c=ue(l);{var a=g=>{_o(g,{position:"top-right",class:"mb-5",children:(v,w)=>{Q0(v,{class:"flex flex-col items-end space-y-1",get value(){return S(n)},set value(P){pe(n,P,!0)},children:(P,I)=>{var k=We(),N=ue(k);xn(N,16,()=>S(s),D=>D,(D,B)=>{{let U=me(()=>`level-${B}`);$p(D,{get for(){return S(U)},class:"inline-flex items-center justify-center font-bold rounded-md border-2 border-muted bg-popover h-9 w-9 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(V,L)=>{var $=m8(),te=ue($);{let le=me(()=>`level-${B}`),se=me(()=>`level-${B}`),oe=me(()=>`level-${B}`);jp(te,{get value(){return S(le)},get id(){return S(se)},class:"sr-only",get"aria-label"(){return S(oe)}})}var G=ve(te);mt(()=>pt(G,` ${B??""}`)),Z(V,$)},$$slots:{default:!0}})}}),Z(P,k)},$$slots:{default:!0}})},$$slots:{default:!0}})};Ze(c,g=>{S(s).length>1&&g(a)})}Z(r,l),St()}var y8=Fe(`<div><div class="mx-auto my-5 relative before:content-[''] before:absolute before:inset-[-20px] before:inset-x-[-50vw] flex items-center justify-center"><div><!></div> <div></div></div> <div><!></div></div>`);function v8(r,e){Tt(e,!0);let t=ae(e,"ref",15,null),n=ae(e,"showMap",15),s=hr(e,["$$slots","$$events","$$legacy","ref","showMap","class","children"]),l=wt(!0);const c=.7,a=0;let g=0,v=0,w=!1,P=!1,I;ag(()=>iI(I)),kr(()=>q6(I));const k=xe=>{for(;xe&&xe!==document.documentElement;){const Ne=window.getComputedStyle(xe).overflowY;if(Ne!=="visible"&&Ne!=="hidden"&&xe.scrollHeight>xe.clientHeight)return xe;xe=xe.parentElement}return null},N=xe=>{const _e=P?null:xe.target,Ne=_e?k(_e):null;g=xe.touches[0].clientY,w=S(l)&&Ne?Ne.scrollTop===0:!0},D=xe=>{if(!w)return;v=xe.touches[0].clientY;const _e=v-g,Ne=S(l)?0:window.innerHeight*c;S(l)&&_e<0||!S(l)&&_e>0||(n(!0),t(t().style.transition="none",!0),t(t().style.transform=`translateY(${Ne+_e}px)`,!0))},B=xe=>{if(!w)return;w=!1,t(t().style.transition="",!0);const _e=xe.changedTouches[0].clientY-g;(70<_e||_e==0&&P)&&S(l)?(t(t().style.transform=`translateY(${window.innerHeight*c}px)`,!0),pe(l,!1)):(_e<-70||_e==0&&P)&&!S(l)?(t(t().style.transform=`translateY(${a}px)`,!0),pe(l,!0)):t(t().style.transform=`translateY(${S(l)?a:window.innerHeight*c}px)`,!0),P=!1};var U=y8();sn(U,xe=>({class:xe,...s,ontouchstart:N,ontouchmove:D,ontouchend:B}),[()=>_n("bg-card text-card-foreground rounded-xl pb-5 h-full border shadow max-w-full transition-transform duration-200 ease-out",e.class)]);var V=Ae(U);V.__touchstart=xe=>{P=!0,n(!0),N(xe)};var L=Ae(V);let $;var te=Ae(L);py(te,{class:"size-12 text-gray-300 scale-x-150",strokeWidth:3.5}),we(L);var G=ve(L,2);let le;we(V);var se=ve(V,2);let oe;var be=Ae(se);Ot(be,()=>e.children??Ht),we(se),as(se,xe=>I=xe,()=>I),we(U),as(U,xe=>t(xe),()=>t()),mt(()=>{$=fi(L,1,"absolute transition-all duration-200",null,$,{"opacity-0":!S(l),"opacity-100":S(l)}),le=fi(G,1,"w-14 h-2 bg-gray-300 rounded-full transition-all duration-200",null,le,{"opacity-0":S(l),"opacity-100":!S(l)}),oe=fi(se,1,"",null,oe,{"overflow-auto":S(l)})}),Z(r,U),St()}yu(["touchstart"]);var b8=Fe('<div class="col-span-full w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white font-bold text-sm border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),x8=Fe('<span class="mt-1 text-nowrap px-1 border text-xs rounded-xl"> </span>'),w8=Fe('<div class="flex items-center text-destructive text-sm"><!> <span class="ml-1 leading-none"> </span></div>'),T8=Fe('<div><div class="flex col justify-between"><!> <div class="mx-4"><!> <!></div></div></div> <div class="w-full"><div class="flex items-start justify-between text-base"><div class="flex items-start gap-1"><!> <!></div> <!> <!></div> <!></div> <div class="border col-span-full"></div>',1),S8=Fe('<div class="col-span-full w-full flex items-center justify-center"><!></div>'),A8=Fe('<div class="col-span-full w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white text-sm font-bold border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),E8=Fe("<!> <!> <!> <!>",1),P8=Fe('<div class="col-span-full w-full flex items-center justify-center"><!></div>'),I8=Fe('<div class="flex items-center justify-center"><!></div>'),C8=Fe('<div class="gap-y-3 mb-1 text-base grid grid-cols-[auto_1fr] items-start content-start"><div class="col-span-full w-full flex items-center justify-center"><!></div> <!></div>');function R8(r,e){Tt(e,!0);let t=ae(e,"stopNameFromResponse",15),n=ae(e,"stop",15),s=me(()=>({stopId:e.stopId,time:e.time.toISOString(),arriveBy:e.arriveBy,n:10,exactRadius:!1,radius:200,language:[eo]})),l=wt(tn([]));kr(()=>{pe(l,[c(Uv({query:S(s)}))],!0)});const c=P=>P.then(I=>{if(I.error)throw console.log(I.error),new Error("HTTP "+I.response?.status);t(I.data?.place?.name||"");let k=I.data?.place;return n(Ri(qn.LngLat.convert([k.lon,k.lat]))),e.stopMarker?.setLngLat(n().match),I.data});var a=C8(),g=Ae(a),v=Ae(g);An(v,{class:"font-bold",variant:"outline",onclick:()=>{Ad(e.stopName,e.stopId,e.time,!e.arriveBy)},children:(P,I)=>{var k=We(),N=ue(k);{var D=U=>{var V=Br();mt(()=>pt(V,yt.switchToDepartures)),Z(U,V)},B=U=>{var V=Br();mt(()=>pt(V,yt.switchToArrivals)),Z(U,V)};Ze(N,U=>{e.arriveBy?U(D):U(B,!1)})}Z(P,k)},$$slots:{default:!0}}),we(g);var w=ve(g,2);xn(w,17,()=>S(l),di,(P,I,k)=>{var N=We(),D=ue(N);Ja(D,()=>S(I),B=>{var U=I8(),V=Ae(U);Np(V,{class:"animate-spin w-12 h-12 m-20"}),we(U),Z(B,U)},(B,U)=>{var V=E8(),L=ue(V);{var $=be=>{var xe=b8(),_e=ve(Ae(xe),2);_e.__click=()=>{S(l).splice(0,0,c(Uv({query:{...S(s),pageCursor:S(U).previousPageCursor}})))};var Ne=Ae(_e,!0);we(_e),Yr(2),we(xe),mt(()=>pt(Ne,yt.earlier)),Z(be,xe)};Ze(L,be=>{k===0&&S(U).previousPageCursor.length&&be($)})}var te=ve(L,2);xn(te,17,()=>S(U).stopTimes,di,(be,xe)=>{const _e=me(()=>e.arriveBy?S(xe).place.arrival:S(xe).place.departure),Ne=me(()=>e.arriveBy?S(xe).place.scheduledArrival:S(xe).place.scheduledDeparture);var fe=T8(),Le=ue(fe),tt=Ae(Le),Ye=Ae(tt);Sx(Ye,{class:"max-w-30 text-ellipsis overflow-hidden",get l(){return S(xe)},get onClickTrip(){return Lp}});var rt=ve(Ye,2),it=Ae(rt);{let br=me(()=>e.time.toISOString());fd(it,{variant:"schedule",get timeZone(){return S(xe).place.tz},get isRealtime(){return S(xe).realTime},get timestamp(){return S(_e)},get scheduledTimestamp(){return S(Ne)},get queriedTime(){return S(br)},get arriveBy(){return e.arriveBy}})}var Ct=ve(it,2);fd(Ct,{variant:"realtime",get timeZone(){return S(xe).place.tz},get isRealtime(){return S(xe).realTime},get timestamp(){return S(_e)},get scheduledTimestamp(){return S(Ne)},get arriveBy(){return e.arriveBy}}),we(rt),we(tt),we(Le);var Mt=ve(Le,2),jt=Ae(Mt),Gt=Ae(jt),Or=Ae(Gt);v0(Or,{class:"mt-1 shrink-0 stroke-muted-foreground h-4 w-4"});var _r=ve(Or),wr=ve(_r);{var Dr=br=>{var lr=Br();mt(()=>pt(lr,`(${S(xe).tripTo.name??""})`)),Z(br,lr)};Ze(wr,br=>{(!S(xe).headsign||!S(xe).tripTo.name.startsWith(S(xe).headsign))&&br(Dr)})}we(Gt);var Et=ve(Gt,2);{var vt=br=>{var lr=x8(),ut=Ae(lr);we(lr),mt(Zt=>pt(ut,`${Zt??""}
								${S(xe).place.track??""}`),[()=>sI(S(xe).mode)=="Track"?yt.trackAbr:yt.platformAbr]),Z(br,lr)};Ze(Et,br=>{S(xe).place.track&&br(vt)})}var Pr=ve(Et,2);tw(Pr,{get tz(){return S(xe).place.tz},get alerts(){return S(xe).place.alerts}}),we(jt);var yr=ve(jt,2);{var Ar=br=>{var lr=w8(),ut=Ae(lr);gy(ut,{class:"stroke-destructive h-4 w-4"});var Zt=ve(ut,2),dr=Ae(Zt,!0);we(Zt),we(lr),mt(()=>pt(dr,S(xe).tripCancelled?yt.tripCancelled:S(xe).cancelled?yt.stopCancelled:e.arriveBy?yt.outDisallowed:yt.inDisallowed)),Z(br,lr)};Ze(yr,br=>{S(xe).pickupDropoffType=="NOT_ALLOWED"&&br(Ar)})}we(Mt),Yr(2),mt(()=>pt(_r,` ${S(xe).headsign??""} `)),Z(be,fe)});var G=ve(te,2);{var le=be=>{var xe=S8(),_e=Ae(xe);nu(_e,{get e(){return yt.noItinerariesFound}}),we(xe),Z(be,xe)};Ze(G,be=>{S(U).stopTimes.length||be(le)})}var se=ve(G,2);{var oe=be=>{var xe=A8(),_e=ve(Ae(xe),2);_e.__click=()=>{S(l).push(c(Uv({query:{...S(s),pageCursor:S(U).nextPageCursor}})))};var Ne=Ae(_e,!0);we(_e),Yr(2),we(xe),mt(()=>pt(Ne,yt.later)),Z(be,xe)};Ze(se,be=>{k===S(l).length-1&&S(U).nextPageCursor.length&&be(oe)})}Z(B,V)},(B,U)=>{var V=P8(),L=Ae(V);nu(L,{get e(){return S(U)}}),we(V),Z(B,V)}),Z(P,N)}),we(a),Z(r,a),St()}yu(["click"]);function W_(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const rw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Z2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Z2&&parseFloat(Z2[1]);const X2=globalThis,q2=globalThis.process||{},M8=globalThis.navigator||{};function cI(r){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Tu(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||cI()}function k8(r){return Tu()?cI()?"Electron":(M8.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const uI="4.1.0";function D8(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class O8{constructor(e,t,n="sessionStorage"){this.storage=D8(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function F8(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function N8(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var $_;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})($_||($_={}));const L8=10;function G2(r){return typeof r!="string"?r:(r=r.toUpperCase(),$_[r]||$_.WHITE)}function B8(r,e,t){return!Tu&&typeof r=="string"&&(e&&(r=`\x1B[${G2(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${G2(t)+L8}m${r}\x1B[49m`)),r}function z8(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),s=r;for(const l of n){const c=s[l];typeof c=="function"&&(e.find(a=>l===a)||(s[l]=c.bind(r)))}}function nw(r,e){if(!r)throw new Error("Assertion failed")}function zh(){let r;if(Tu()&&X2.performance)r=X2?.performance?.now?.();else if("hrtime"in q2){const e=q2?.hrtime?.();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}const Uh={debug:Tu()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},U8={enabled:!0,level:0};function Vh(){}const Y2={},K2={once:!0};class cg{constructor({id:e}={id:""}){this.VERSION=uI,this._startTs=zh(),this._deltaTs=zh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new O8(`__probe-${this.id}__`,U8),this.timeStamp(`${this.id} started`),z8(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((zh()-this._startTs).toPrecision(10))}getDelta(){return Number((zh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Uh.warn,arguments,K2)}error(e){return this._getLogFunction(0,e,Uh.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Uh.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Uh.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Uh.debug||Uh.info,arguments,K2)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Vh,n&&[n],{tag:j8(t)}):Vh}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Vh)}group(e,t,n={collapsed:!1}){const s=Q2({logLevel:e,message:t,opts:n}),{collapsed:l}=n;return s.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Vh)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=hI(e)}_getLogFunction(e,t,n,s,l){if(this._shouldLog(e)){l=Q2({logLevel:e,message:t,args:s,opts:l}),n=n||l.method,nw(n),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=zh();const c=l.tag||l.message;if(l.once&&c)if(!Y2[c])Y2[c]=zh();else return Vh;return t=V8(this.id,l.message,l),n.bind(console,t,...l.args)}return Vh}}cg.VERSION=uI;function hI(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return nw(Number.isFinite(e)&&e>=0),e}function Q2(r){const{logLevel:e,message:t}=r;r.logLevel=hI(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const s=typeof r.message;return nw(s==="string"||s==="object"),Object.assign(r,{args:n},r.opts)}function V8(r,e,t){if(typeof e=="string"){const n=t.time?N8(F8(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=B8(e,t.color,t.background)}return e}function j8(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const ub="4.3.3",W8=ub[0]>="0"&&ub[0]<="9"?`v${ub}`:"";function $8(){const r=new cg({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=W8,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const H8=$8();function Z8(r,e){return dI(r||{},e)}function dI(r,e,t=0){if(t>3)return e;const n={...r};for(const[s,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?n[s]=dI(n[s]||{},e[s],t+1):n[s]=e[s];return n}const X8="latest";function q8(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const G8=q8();function uc(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const iu=typeof process!="object"||String(process)!=="[object process]"||process.browser,Y8=typeof window<"u"&&typeof window.orientation<"u",J2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);J2&&parseFloat(J2[1]);class K8{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){uc(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){uc(this.isRunning),this.isRunning=!1,this._reject(e)}}class hb{terminate(){}}const db=new Map;function Q8(r){uc(r.source&&!r.url||!r.source&&r.url);let e=db.get(r.source||r.url);return e||(r.url&&(e=J8(r.url),db.set(r.url,e)),r.source&&(e=fI(r.source),db.set(r.source,e))),uc(e),e}function J8(r){if(!r.startsWith("http"))return r;const e=eV(r);return fI(e)}function fI(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function eV(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function pI(r,e=!0,t){const n=t||new Set;if(r){if(eS(r))n.add(r);else if(eS(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const s in r)pI(r[s],e,n)}}return t===void 0?Array.from(n):[]}function eS(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const fb=()=>{};class Px{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&iu||typeof hb<"u"&&!iu}constructor(e){const{name:t,source:n,url:s}=e;uc(n||s),this.name=t,this.source=n,this.url=s,this.onMessage=fb,this.onError=l=>console.log(l),this.worker=iu?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=fb,this.onError=fb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||pI(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Q8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new hb(n,{eval:!1})}else if(this.source)e=new hb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class tV{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Px.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,l,c)=>s.done(c),n=(s,l)=>s.error(l)){const s=new Promise(l=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:l}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new K8(t.name,e);e.onMessage=s=>t.onMessage(n,s.type,s.payload),e.onError=s=>t.onError(n,s),t.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!iu||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Px({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Y8?this.maxMobileConcurrency:this.maxConcurrency}}const rV={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Jl{props;workerPools=new Map;static _workerFarm;static isSupported(){return Px.isSupported()}static getWorkerFarm(e={}){return Jl._workerFarm=Jl._workerFarm||new Jl({}),Jl._workerFarm.setProps(e),Jl._workerFarm}constructor(e){this.props={...rV},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:s}=e;let l=this.workerPools.get(t);return l||(l=new tV({name:t,source:n,url:s}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function nV(r,e={}){const t=e[r.id]||{},n=iu?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let s=t.workerUrl;if(!s&&r.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(iu?s=`modules/${r.module}/dist/${n}`:s=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!s){let l=r.version;l==="latest"&&(l=X8);const c=l?`@${l}`:"";s=`https://unpkg.com/@loaders.gl/${r.module}${c}/dist/${n}`}return uc(s),s}function iV(r,e=G8){uc(r,"no worker provided");const t=r.version;return!(!e||!t)}function sV(r,e){return!Jl.isSupported()||!iu&&!e?._nodeWorkers?!1:r.worker&&e?.worker}async function oV(r,e,t,n,s){const l=r.id,c=nV(r,t),g=Jl.getWorkerFarm(t).getWorkerPool({name:l,url:c});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const v=await g.startJob("process-on-worker",aV.bind(null,s));return v.postMessage("process",{input:e,options:t,context:n}),await(await v.result).result}async function aV(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:l,options:c}=n;try{const a=await r(l,c);e.postMessage("done",{id:s,result:a})}catch(a){const g=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:g})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function lV(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),s=new Uint8Array(e);for(let l=0;l<n.length;++l)if(n[l]!==s[l])return!1;return!0}function cV(...r){return uV(r)}function uV(r){const e=r.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),t=e.reduce((l,c)=>l+c.byteLength,0),n=new Uint8Array(t);let s=0;for(const l of e)n.set(l,s),s+=l.byteLength;return n.buffer}async function hV(r){const e=[];for await(const t of r)e.push(t);return cV(...e)}function tS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class rS{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ay{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let s=this.stats[t];return s||(e instanceof rS?s=e:s=new rS(t,n),this.stats[t]=s),s}}let dV="";const nS={};function fV(r){for(const e in nS)if(r.startsWith(e)){const t=nS[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${dV}${r}`),r}function pV(r){return r&&typeof r=="object"&&r.isBuffer}function gI(r){if(pV(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function mI(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function gV(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const mV=r=>typeof r=="boolean",Ap=r=>typeof r=="function",ug=r=>r!==null&&typeof r=="object",iS=r=>ug(r)&&r.constructor==={}.constructor,_V=r=>!!r&&typeof r[Symbol.iterator]=="function",yV=r=>r&&typeof r[Symbol.asyncIterator]=="function",Su=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Au=r=>typeof Blob<"u"&&r instanceof Blob,vV=r=>r&&typeof r=="object"&&r.isBuffer,bV=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||ug(r)&&Ap(r.tee)&&Ap(r.cancel)&&Ap(r.getReader),xV=r=>ug(r)&&Ap(r.read)&&Ap(r.pipe)&&mV(r.readable),_I=r=>bV(r)||xV(r);class wV extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const TV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,SV=/^([-\w.]+\/[-\w.+]+)/;function sS(r,e){return r.toLowerCase()===e.toLowerCase()}function AV(r){const e=SV.exec(r);return e?e[1]:r}function oS(r){const e=TV.exec(r);return e?e[1]:""}const yI=/\?.*/;function EV(r){const e=r.match(yI);return e&&e[0]}function iw(r){return r.replace(yI,"")}function PV(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function Ey(r){return Su(r)?r.url:Au(r)?r.name||"":typeof r=="string"?r:""}function sw(r){if(Su(r)){const e=r,t=e.headers.get("content-type")||"",n=iw(e.url);return AV(t)||oS(n)}return Au(r)?r.type||"":typeof r=="string"?oS(r):""}function IV(r){return Su(r)?r.headers["content-length"]||-1:Au(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function vI(r){if(Su(r))return r;const e={},t=IV(r);t>=0&&(e["content-length"]=String(t));const n=Ey(r),s=sw(r);s&&(e["content-type"]=s);const l=await MV(r);l&&(e["x-first-bytes"]=l),typeof r=="string"&&(r=new TextEncoder().encode(r));const c=new Response(r,{headers:e});return Object.defineProperty(c,"url",{value:n}),c}async function CV(r){if(!r.ok)throw await RV(r)}async function RV(r){const e=PV(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const s=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&s?.includes("application/json")?await r.json():await r.text()}catch{}return new wV(t,n)}async function MV(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=l=>n(l?.target?.result),s.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${kV(t)}`}return null}function kV(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function DV(r){return!OV(r)&&!FV(r)}function OV(r){return r.startsWith("http:")||r.startsWith("https:")}function FV(r){return r.startsWith("data:")}async function aS(r,e){if(typeof r=="string"){const t=fV(r);return DV(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await vI(r)}const lS=new cg({id:"loaders.gl"});class NV{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class LV{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const bI={fetch:null,mimeType:void 0,nothrow:!1,log:new LV,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:rw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},BV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xI(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function wI(){const r=xI();return r.globalOptions=r.globalOptions||{...bI},r.globalOptions}function zV(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],UV(r,t),jV(e,r,n)}function UV(r,e){cS(r,null,bI,BV,e);for(const t of e){const n=r&&r[t.id]||{},s=t.options&&t.options[t.id]||{},l=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};cS(n,t.id,s,l,e)}}function cS(r,e,t,n,s){const l=e||"Top level",c=e?`${e}.`:"";for(const a in r){const g=!e&&ug(r[a]),v=a==="baseUri"&&!e,w=a==="workerUrl"&&e;if(!(a in t)&&!v&&!w){if(a in n)lS.warn(`${l} loader option '${c}${a}' no longer supported, use '${n[a]}'`)();else if(!g){const P=VV(a,s);lS.warn(`${l} loader option '${c}${a}' not recognized. ${P}`)()}}}}function VV(r,e){const t=r.toLowerCase();let n="";for(const s of e)for(const l in s.options){if(r===l)return`Did you mean '${s.id}.${l}'?`;const c=l.toLowerCase();(t.startsWith(c)||c.startsWith(t))&&(n=n||`Did you mean '${s.id}.${l}'?`)}return n}function jV(r,e,t){const s={...r.options||{}};return WV(s,t),s.log===null&&(s.log=new NV),uS(s,wI()),uS(s,e),s}function uS(r,e){for(const t in e)if(t in e){const n=e[t];iS(n)&&iS(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function WV(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function ow(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r?.extensions)):!1}function aw(r){W_(r,"null loader"),W_(ow(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r?.parseTextSync||r?.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const TI=()=>{const r=xI();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function $V(r){const e=TI();r=Array.isArray(r)?r:[r];for(const t of r){const n=aw(t);e.find(s=>n===s)||e.unshift(n)}}function HV(){return TI()}const ZV=/\.([^.]+)$/;async function XV(r,e=[],t,n){if(!SI(r))return null;let s=hS(r,e,{...t,nothrow:!0},n);if(s)return s;if(Au(r)&&(r=await r.slice(0,10).arrayBuffer(),s=hS(r,e,t,n)),!s&&!t?.nothrow)throw new Error(AI(r));return s}function hS(r,e=[],t,n){if(!SI(r))return null;if(e&&!Array.isArray(e))return aw(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...HV()),GV(s);const l=qV(r,s,t,n);if(!l&&!t?.nothrow)throw new Error(AI(r));return l}function qV(r,e,t,n){const s=Ey(r),l=sw(r),c=iw(s)||n?.url;let a=null,g="";return t?.mimeType&&(a=pb(e,t?.mimeType),g=`match forced by supplied MIME type ${t?.mimeType}`),a=a||YV(e,c),g=g||(a?`matched url ${c}`:""),a=a||pb(e,l),g=g||(a?`matched MIME type ${l}`:""),a=a||QV(e,r),g=g||(a?`matched initial data ${EI(r)}`:""),t?.fallbackMimeType&&(a=a||pb(e,t?.fallbackMimeType),g=g||(a?`matched fallback MIME type ${l}`:"")),g&&H8.log(1,`selectLoader selected ${a?.name}: ${g}.`),a}function SI(r){return!(r instanceof Response&&r.status===204)}function AI(r){const e=Ey(r),t=sw(r);let n="No valid loader found (";n+=e?`${mI(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=r?EI(r):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function GV(r){for(const e of r)aw(e)}function YV(r,e){const t=e&&ZV.exec(e),n=t&&t[1];return n?KV(r,n):null}function KV(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function pb(r,e){for(const t of r)if(t.mimeTypes?.some(n=>sS(e,n))||sS(e,`application/x.${t.id}`))return t;return null}function QV(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(JV(e,t))return t}else if(ArrayBuffer.isView(e)){if(dS(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&dS(e,0,t))return t;return null}function JV(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function dS(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>ej(r,e,t,s))}function ej(r,e,t,n){if(n instanceof ArrayBuffer)return lV(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const s=Ix(r,e,n.length);return n===s;default:return!1}}function EI(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Ix(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Ix(r,0,e):""}function Ix(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let s="";for(let l=0;l<t;l++)s+=String.fromCharCode(n.getUint8(e+l));return s}const tj=256*1024;function*rj(r,e){const t=e?.chunkSize||tj;let n=0;const s=new TextEncoder;for(;n<r.length;){const l=Math.min(r.length-n,t),c=r.slice(n,n+l);n+=l,yield s.encode(c)}}const nj=256*1024;function*ij(r,e={}){const{chunkSize:t=nj}=e;let n=0;for(;n<r.byteLength;){const s=Math.min(r.byteLength-n,t),l=new ArrayBuffer(s),c=new Uint8Array(r,n,s);new Uint8Array(l).set(c),n+=s,yield l}}const sj=1024*1024;async function*oj(r,e){const t=e?.chunkSize||sj;let n=0;for(;n<r.size;){const s=n+t,l=await r.slice(n,s).arrayBuffer();n=s,yield l}}function fS(r,e){return rw?aj(r,e):lj(r)}async function*aj(r,e){const t=r.getReader();let n;try{for(;;){const s=n||t.read();e?._streamReadAhead&&(n=t.read());const{done:l,value:c}=await s;if(l)return;yield gI(c)}}catch{t.releaseLock()}}async function*lj(r,e){for await(const t of r)yield gI(t)}function cj(r,e){if(typeof r=="string")return rj(r,e);if(r instanceof ArrayBuffer)return ij(r,e);if(Au(r))return oj(r,e);if(_I(r))return fS(r,e);if(Su(r))return fS(r.body,e);throw new Error("makeIterator")}const PI="Cannot convert supplied data type";function uj(r,e,t){if(e.text&&typeof r=="string")return r;if(vV(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const s=r.byteLength||r.length;return(r.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+s)),n}throw new Error(PI)}async function hj(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return uj(r,e);if(Au(r)&&(r=await vI(r)),Su(r)){const s=r;return await CV(s),e.binary?await s.arrayBuffer():await s.text()}if(_I(r)&&(r=cj(r,t)),_V(r)||yV(r))return hV(r);throw new Error(PI)}function II(r,e){const t=wI(),n=r||t;return typeof n.fetch=="function"?n.fetch:ug(n.fetch)?s=>aS(s,n.fetch):e?.fetch?e?.fetch:aS}function dj(r,e,t){if(t)return t;const n={fetch:II(e,r),...r};if(n.url){const s=iw(n.url);n.baseUrl=s,n.queryString=EV(n.url),n.filename=mI(s),n.baseUrl=gV(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function fj(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function H_(r,e,t,n){e&&!Array.isArray(e)&&!ow(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const s=Ey(r),c=fj(e,n),a=await XV(r,c,t);return a?(t=zV(t,a,c,s),n=dj({url:s,_parse:H_,loaders:c},t,n||null),await pj(a,r,t,n)):null}async function pj(r,e,t,n){if(iV(r),t=Z8(r.options,t),Su(e)){const l=e,{ok:c,redirected:a,status:g,statusText:v,type:w,url:P}=l,I=Object.fromEntries(l.headers.entries());n.response={headers:I,ok:c,redirected:a,status:g,statusText:v,type:w,url:P}}e=await hj(e,r,t);const s=r;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,n);if(sV(r,t))return await oV(r,e,t,n,H_);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,n);if(s.parse)return await s.parse(e,t,n);throw uc(!s.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function Z_(r,e,t,n){let s,l;!Array.isArray(e)&&!ow(e)?(s=[],l=e):(s=e,l=t);const c=II(l);let a=r;return typeof r=="string"&&(a=await c(r)),Au(r)&&(a=await c(r)),Array.isArray(s)?await H_(a,s,l):await H_(a,s,l)}const gj="4.3.3",mj=globalThis.loaders?.parseImageNode,Cx=typeof Image<"u",Rx=typeof ImageBitmap<"u",_j=!!mj,Mx=rw?!0:_j;function yj(r){switch(r){case"auto":return Rx||Cx||Mx;case"imagebitmap":return Rx;case"image":return Cx;case"data":return Mx;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function vj(){if(Rx)return"imagebitmap";if(Cx)return"image";if(Mx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function bj(r){const e=wj(r);if(!e)throw new Error("Not an image");return e}function xj(r){switch(bj(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function wj(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const Tj=/^data:image\/svg\+xml/,Sj=/\.svg((\?|#).*)?$/;function lw(r){return r&&(Tj.test(r)||Sj.test(r))}function Aj(r,e){if(lw(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(l){throw new Error(l.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return CI(r,e)}function CI(r,e){if(lw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function RI(r,e,t){const n=Aj(r,t),s=self.URL||self.webkitURL,l=typeof n!="string"&&s.createObjectURL(n);try{return await Ej(l||n,e)}finally{l&&s.revokeObjectURL(l)}}async function Ej(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,s)=>{try{t.onload=()=>n(t),t.onerror=l=>{const c=l instanceof Error?l.message:"error";s(new Error(c))}}catch(l){s(l)}})}const Pj={};let pS=!0;async function Ij(r,e,t){let n;lw(t)?n=await RI(r,e,t):n=CI(r,t);const s=e&&e.imagebitmap;return await Cj(n,s)}async function Cj(r,e=null){if((Rj(e)||!pS)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),pS=!1}return await createImageBitmap(r)}function Rj(r){for(const e in r||Pj)return!1;return!0}function Mj(r){return!Fj(r,"ftyp",4)||(r[8]&96)===0?null:kj(r)}function kj(r){switch(Dj(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Dj(r,e,t){return String.fromCharCode(...r.slice(e,t))}function Oj(r){return[...r].map(e=>e.charCodeAt(0))}function Fj(r,e,t=0){const n=Oj(e);for(let s=0;s<n.length;++s)if(n[s]!==r[s+t])return!1;return!0}const ya=!1,Ep=!0;function MI(r){const e=hg(r);return Lj(e)||Uj(e)||Bj(e)||zj(e)||Nj(e)}function Nj(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=Mj(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function Lj(r){const e=hg(r);return e.byteLength>=24&&e.getUint32(0,ya)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ya),height:e.getUint32(20,ya)}:null}function Bj(r){const e=hg(r);return e.byteLength>=10&&e.getUint32(0,ya)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ep),height:e.getUint16(8,Ep)}:null}function zj(r){const e=hg(r);return e.byteLength>=14&&e.getUint16(0,ya)===16973&&e.getUint32(2,Ep)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ep),height:e.getUint32(22,Ep)}:null}function Uj(r){const e=hg(r);if(!(e.byteLength>=3&&e.getUint16(0,ya)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=Vj();let l=2;for(;l+9<e.byteLength;){const c=e.getUint16(l,ya);if(s.has(c))return{mimeType:"image/jpeg",height:e.getUint16(l+5,ya),width:e.getUint16(l+7,ya)};if(!n.has(c))return null;l+=2,l+=e.getUint16(l,ya)}return null}function Vj(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function hg(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function jj(r,e){const{mimeType:t}=MI(r)||{},n=globalThis.loaders?.parseImageNode;return W_(n),await n(r,t)}async function Wj(r,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:l}=t||{},c=$j(s);let a;switch(c){case"imagebitmap":a=await Ij(r,e,l);break;case"image":a=await RI(r,e,l);break;case"data":a=await jj(r);break;default:W_(!1)}return s==="data"&&(a=xj(a)),a}function $j(r){switch(r){case"auto":case"data":return vj();default:return yj(r),r}}const Hj=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Zj=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Xj={image:{type:"auto",decode:!0}},qj={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:gj,mimeTypes:Zj,extensions:Hj,parse:Wj,tests:[r=>!!MI(new DataView(r))],options:Xj},Vn=new cg({id:"deck"});let kx={};function Gj(r){kx=r}function Cs(r,e,t,n){Vn.level>0&&kx[r]&&kx[r].call(null,e,t,n)}function Yj(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Kj={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Yj,parseTextSync:JSON.parse};function Qj(){const r="9.2.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(Vn.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Vn,_registerLoggers:Gj},$V([Kj,[qj,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const Jj=Qj();function cw(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const gb={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function eW(r){const e={};for(const[t,n]of Object.entries(r))e[t]=tW(n);return e}function tW(r){let e=gS(r);if(e!=="object")return{value:r,...gb[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...gb[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=gS(r.value),{...r,...gb[e],type:e}):{type:"object",value:null};throw new Error("props")}function gS(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const rW=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,nW=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,iW={vertex:rW,fragment:nW},mS=/void\s+main\s*\([^)]*\)\s*\{\n?/,_S=/}\n?[^{}]*$/,mb=[],__="__LUMA_INJECT_DECLARATIONS__";function sW(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const s=oW(t);typeof n=="string"&&(n={order:0,injection:n}),e[s][t]=n}return e}function oW(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function X_(r,e,t,n=!1){const s=e==="vertex";for(const l in t){const c=t[l];c.sort((g,v)=>g.order-v.order),mb.length=c.length;for(let g=0,v=c.length;g<v;++g)mb[g]=c[g].injection;const a=`${mb.join(`
`)}
`;switch(l){case"vs:#decl":s&&(r=r.replace(__,a));break;case"vs:#main-start":s&&(r=r.replace(mS,g=>g+a));break;case"vs:#main-end":s&&(r=r.replace(_S,g=>a+g));break;case"fs:#decl":s||(r=r.replace(__,a));break;case"fs:#main-start":s||(r=r.replace(mS,g=>g+a));break;case"fs:#main-end":s||(r=r.replace(_S,g=>a+g));break;default:r=r.replace(l,g=>g+a)}}return r=r.replace(__,""),n&&(r=r.replace(/\}\s*$/,l=>l+iW[e])),r}function q_(r){r.map(e=>aW(e))}function aW(r){if(r.instance)return;q_(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=r,s={normalizedInjections:sW(n),parsedDeprecations:lW(t)};e&&(s.propValidators=eW(e)),r.instance=s;let l={};e&&(l=Object.entries(e).reduce((c,[a,g])=>{const v=g?.value;return v&&(c[a]=v),c},{})),r.defaultUniforms={...r.defaultUniforms,...l}}function kI(r,e,t){r.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())})}function lW(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function uw(r){q_(r);const e={},t={};DI({modules:r,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((s,l)=>t[l]-t[s]).map(s=>e[s]);return q_(n),n}function DI(r){const{modules:e,level:t,moduleMap:n,moduleDepth:s}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)n[l.name]=l,(s[l.name]===void 0||s[l.name]<t)&&(s[l.name]=t);for(const l of e)l.dependencies&&DI({modules:l.dependencies,level:t+1,moduleMap:n,moduleDepth:s})}function cW(r){switch(r?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function uW(r,e){if(Number(r.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=yS(r,hW),r;case"fragment":return r=yS(r,dW),r;default:throw new Error(e)}}const OI=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hW=[...OI,[Dx("attribute"),"in $1"],[Dx("varying"),"out $1"]],dW=[...OI,[Dx("varying"),"in $1"]];function yS(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function Dx(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function FI(r,e){let t="";for(const n in r){const s=r[n];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[n]){const l=e[n];l.sort((c,a)=>c.order-a.order);for(const c of l)t+=`  ${c.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function NI(r){const e={vertex:{},fragment:{}};for(const t of r){let n,s;typeof t!="string"?(n=t,s=n.hook):(n={},s=t),s=s.trim();const[l,c]=s.split(":"),a=s.replace(/\(.+/,""),g=Object.assign(n,{signature:c});switch(l){case"vs":e.vertex[a]=g;break;case"fs":e.fragment[a]=g;break;default:throw new Error(l)}}return e}function fW(r,e){return{name:pW(r,e),language:"glsl",version:gW(r)}}function pW(r,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function gW(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const LI=`

${__}
`,mW=`precision highp float;
`;function _W(r){const e=uw(r.modules||[]);return{source:vW(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:BI(e)}}function yW(r){const{vs:e,fs:t}=r,n=uw(r.modules||[]);return{vs:vS(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:vS(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:BI(n)}}function vW(r,e){const{source:t,stage:n,modules:s,hookFunctions:l=[],inject:c={},log:a}=e;cw(typeof t=="string","shader source must be a string");const g=t;let v="";const w=NI(l),P={},I={},k={};for(const D in c){const B=typeof c[D]=="string"?{injection:c[D],order:0}:c[D],U=/^(v|f)s:(#)?([\w-]+)$/.exec(D);if(U){const V=U[2],L=U[3];V?L==="decl"?I[D]=[B]:k[D]=[B]:P[D]=[B]}else k[D]=[B]}const N=s;for(const D of N){a&&kI(D,g,a);const B=zI(D,"wgsl");v+=B;const U=D.injections?.[n]||{};for(const V in U){const L=/^(v|f)s:#([\w-]+)$/.exec(V);if(L){const te=L[2]==="decl"?I:k;te[V]=te[V]||[],te[V].push(U[V])}else P[V]=P[V]||[],P[V].push(U[V])}}return v+=LI,v=X_(v,n,I),v+=FI(w[n],P),v+=g,v=X_(v,n,k),v}function vS(r,e){const{source:t,stage:n,language:s="glsl",modules:l,defines:c={},hookFunctions:a=[],inject:g={},prologue:v=!0,log:w}=e;cw(typeof t=="string","shader source must be a string");const P=s==="glsl"?fW(t).version:-1,I=r.shaderLanguageVersion,k=P===100?"#version 100":"#version 300 es",D=t.split(`
`).slice(1).join(`
`),B={};l.forEach(G=>{Object.assign(B,G.defines)}),Object.assign(B,c);let U="";switch(s){case"wgsl":break;case"glsl":U=v?`${k}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${cW(r)}
${n==="fragment"?mW:""}

// ----- APPLICATION DEFINES -------------------------

${bW(B)}

`:`${k}
`;break}const V=NI(a),L={},$={},te={};for(const G in g){const le=typeof g[G]=="string"?{injection:g[G],order:0}:g[G],se=/^(v|f)s:(#)?([\w-]+)$/.exec(G);if(se){const oe=se[2],be=se[3];oe?be==="decl"?$[G]=[le]:te[G]=[le]:L[G]=[le]}else te[G]=[le]}for(const G of l){w&&kI(G,D,w);const le=zI(G,n);U+=le;const se=G.instance?.normalizedInjections[n]||{};for(const oe in se){const be=/^(v|f)s:#([\w-]+)$/.exec(oe);if(be){const _e=be[2]==="decl"?$:te;_e[oe]=_e[oe]||[],_e[oe].push(se[oe])}else L[oe]=L[oe]||[],L[oe].push(se[oe])}}return U+="// ----- MAIN SHADER SOURCE -------------------------",U+=LI,U=X_(U,n,$),U+=FI(V[n],L),U+=D,U=X_(U,n,te),s==="glsl"&&P!==I&&(U=uW(U,n)),U.trim()}function BI(r){return function(t){const n={};for(const s of r){const l=s.getUniforms?.(t,n);Object.assign(n,l)}return n}}function bW(r={}){let e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function zI(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:cw(!1)}if(!r.name)throw new Error("Shader module must have a name");const n=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${n}
`),s+=`${t}
`,s}const xW=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,wW=/^\s*\#\s*endif\s*$/;function TW(r,e){const t=r.split(`
`),n=[];let s=!0,l=null;for(const c of t){const a=c.match(xW),g=c.match(wW);a?(l=a[1],s=!!e?.defines?.[l]):g?s=!0:s&&n.push(c)}return n.join(`
`)}class Hc{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Hc.defaultShaderAssembler=Hc.defaultShaderAssembler||new Hc,Hc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:l}=_W({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?TW(s):s,getUniforms:l,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...yW({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let l=0,c=this._defaultModules.length;l<c;++l){const a=this._defaultModules[l],g=a.name;t[s++]=a,n[g]=!0}for(let l=0,c=e.length;l<c;++l){const a=e[l],g=a.name;n[g]||(t[s++]=a,n[g]=!0)}return t.length=s,q_(t),t}}const SW=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,AW=`#version 300 es
${SW}`;function EW(r){const{input:e,inputChannels:t,output:n}={};if(!e)return AW;if(!t)throw new Error("inputChannels");const s=PW(t),l=IW(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${n};
void main() {
  ${n} = ${l};
}`}function PW(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function IW(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}class CW{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ay({id:e})),this.stats.get(e)}}const UI=new CW,zt=new cg({id:"luma.gl"}),_b={};function Py(r="id"){_b[r]=_b[r]||1;const e=_b[r]++;return`${r}-${e}`}let Yn=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,n){if(!e)throw new Error("no device");this._device=e,this.props=RW(t,n);const s=this.props.id!=="undefined"?this.props.id:Py(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function RW(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}class ni extends Yn{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const n={...t};(t.usage||0)&ni.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,ni.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,n){const s=ArrayBuffer.isView(e)?e.buffer:e,l=Math.min(e?e.byteLength:n,ni.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(l):t===0&&n===s.byteLength?this.debugData=s.slice(0,l):this.debugData=s.slice(t,t+l)}static defaultProps={...Yn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function VI(r){const[e,t,n]=fw[r],s=r.includes("norm"),l=!s&&!r.startsWith("float"),c=r.startsWith("s");return{signedType:e,primitiveType:t,byteLength:n,normalized:s,integer:l,signed:c}}function MW(r){const e=r;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function kW(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}function hw(r){const e=ArrayBuffer.isView(r)?r.constructor:r;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(fw).find(n=>e===n[4]);if(!t)throw new Error(e.name);return t[0]}function dw(r){const[,,,,e]=fw[r];return e}const fw={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function pw(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),s=t,l=n?parseInt(n):1,c=VI(s),a={type:s,components:l,byteLength:c.byteLength*l,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(a.webglOnly=!0),a}function DW(r,e,t){const n=t?MW(r):r;switch(n){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${n}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${n}x${e}`;default:return e===1?n:`${n}x${e}`}}function OW(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e,s=hw(r);return DW(s,n,t)}function FW(r){let e;switch(r.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return r.components<=2?"float16x2":"float16x4"}return r.components===1?e:`${e}x${r.components}`}const vs="texture-compression-bc",Xn="texture-compression-astc",ua="texture-compression-etc2",NW="texture-compression-etc1-webgl",Wm="texture-compression-pvrtc-webgl",yb="texture-compression-atc-webgl",$m="float32-renderable-webgl",vb="float16-renderable-webgl",LW="rgb9e5ufloat-renderable-webgl",bb="snorm8-renderable-webgl",np="norm16-renderable-webgl",xb="snorm16-renderable-webgl",Hm="float32-filterable",bS="float16-filterable-webgl";function jI(r){const e=UW[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const BW={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:bb},rg8snorm:{render:bb},"rgb8snorm-webgl":{},rgba8snorm:{render:bb},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:np},rg16unorm:{render:np},"rgb16unorm-webgl":{f:np},rgba16unorm:{render:np},r16snorm:{f:xb},rg16snorm:{render:xb},"rgb16snorm-webgl":{f:np},rgba16snorm:{render:xb},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:vb,filter:"float16-filterable-webgl"},rg16float:{render:vb,filter:bS},rgba16float:{render:vb,filter:bS},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:$m,filter:Hm},rg32float:{render:!1,filter:Hm},"rgb32float-webgl":{render:$m,filter:Hm},rgba32float:{render:$m,filter:Hm},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:LW},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:$m},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},zW={"bc1-rgb-unorm-webgl":{f:vs},"bc1-rgb-unorm-srgb-webgl":{f:vs},"bc1-rgba-unorm":{f:vs},"bc1-rgba-unorm-srgb":{f:vs},"bc2-rgba-unorm":{f:vs},"bc2-rgba-unorm-srgb":{f:vs},"bc3-rgba-unorm":{f:vs},"bc3-rgba-unorm-srgb":{f:vs},"bc4-r-unorm":{f:vs},"bc4-r-snorm":{f:vs},"bc5-rg-unorm":{f:vs},"bc5-rg-snorm":{f:vs},"bc6h-rgb-ufloat":{f:vs},"bc6h-rgb-float":{f:vs},"bc7-rgba-unorm":{f:vs},"bc7-rgba-unorm-srgb":{f:vs},"etc2-rgb8unorm":{f:ua},"etc2-rgb8unorm-srgb":{f:ua},"etc2-rgb8a1unorm":{f:ua},"etc2-rgb8a1unorm-srgb":{f:ua},"etc2-rgba8unorm":{f:ua},"etc2-rgba8unorm-srgb":{f:ua},"eac-r11unorm":{f:ua},"eac-r11snorm":{f:ua},"eac-rg11unorm":{f:ua},"eac-rg11snorm":{f:ua},"astc-4x4-unorm":{f:Xn},"astc-4x4-unorm-srgb":{f:Xn},"astc-5x4-unorm":{f:Xn},"astc-5x4-unorm-srgb":{f:Xn},"astc-5x5-unorm":{f:Xn},"astc-5x5-unorm-srgb":{f:Xn},"astc-6x5-unorm":{f:Xn},"astc-6x5-unorm-srgb":{f:Xn},"astc-6x6-unorm":{f:Xn},"astc-6x6-unorm-srgb":{f:Xn},"astc-8x5-unorm":{f:Xn},"astc-8x5-unorm-srgb":{f:Xn},"astc-8x6-unorm":{f:Xn},"astc-8x6-unorm-srgb":{f:Xn},"astc-8x8-unorm":{f:Xn},"astc-8x8-unorm-srgb":{f:Xn},"astc-10x5-unorm":{f:Xn},"astc-10x5-unorm-srgb":{f:Xn},"astc-10x6-unorm":{f:Xn},"astc-10x6-unorm-srgb":{f:Xn},"astc-10x8-unorm":{f:Xn},"astc-10x8-unorm-srgb":{f:Xn},"astc-10x10-unorm":{f:Xn},"astc-10x10-unorm-srgb":{f:Xn},"astc-12x10-unorm":{f:Xn},"astc-12x10-unorm-srgb":{f:Xn},"astc-12x12-unorm":{f:Xn},"astc-12x12-unorm-srgb":{f:Xn},"pvrtc-rgb4unorm-webgl":{f:Wm},"pvrtc-rgba4unorm-webgl":{f:Wm},"pvrtc-rbg2unorm-webgl":{f:Wm},"pvrtc-rgba2unorm-webgl":{f:Wm},"etc1-rbg-unorm-webgl":{f:NW},"atc-rgb-unorm-webgl":{f:yb},"atc-rgba-unorm-webgl":{f:yb},"atc-rgbai-unorm-webgl":{f:yb}},UW={...BW,...zW},VW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],jW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class WW{getInfo(e){return xS(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return VW.some(t=>e.startsWith(t))}getCapabilities(e){const t=jI(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=xS(e),l=e.startsWith("depth")||e.startsWith("stencil"),c=s?.signed,a=s?.integer,g=s?.webgl;return n.render&&=!c,n.filter&&=!l&&!c&&!a&&!g,n}}const ad=new WW;function xS(r){let e=$W(r);if(ad.isCompressed(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=HW(r);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=jW.exec(r);if(t){const[,n,s,l,c,a]=t,g=`${l}${s}`,v=VI(g),w=v.byteLength*8,P=n.length,I=[w,P>=2?w:0,P>=3?w:0,P>=4?w:0];e={format:r,attachment:e.attachment,dataType:v.signedType,components:P,channels:n,integer:v.integer,signed:v.signed,normalized:v.normalized,bitsPerChannel:I,bytesPerPixel:v.byteLength*n.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function $W(r){const e=jI(r),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function HW(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,n,s]=t;return{blockWidth:Number(n),blockHeight:Number(s)}}return null}function ZW(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}function XW(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}class qW{}class GW{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class hu{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,s]=e.getDevicePixelSize();zt.log(1,`${e} resized => ${n}x${s}px`)()},onPositionChange:(e,t)=>{const[n,s]=e.getPosition();zt.log(1,`${e} repositioned => ${n},${s}`)()},onVisibilityChange:e=>zt.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>zt.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:zt.get("debug")||void 0,debugShaders:zt.get("debug-shaders")||void 0,debugFramebuffers:!!zt.get("debug-framebuffers"),debugFactories:!!zt.get("debug-factories"),debugWebGL:!!zt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=UI;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...hu.defaultProps,...e},this.id=this.props.id||Py(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return pw(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return ad.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const s=Math.max(e,t,n);return 1+Math.floor(Math.log2(s))}isExternalImage(e){return ZW(e)}getExternalImageSize(e){return XW(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return ad.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:zt.error(e.message,t,...n)}debug(){if(this.props.debug)debugger;else zt.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=ad.getCapabilities(e),n=l=>(typeof l=="string"?this.features.has(l):l)??!0,s=n(t.create);return{format:e,create:s,render:s&&n(t.render),filter:s&&n(t.filter),blend:s&&n(t.blend),store:s&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&ni.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const YW="set luma.log.level=1 (or higher) to trace rendering",wS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class G_{static defaultProps={...hu.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=UI;log=zt;VERSION="9.2.2";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw zt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),zt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");zt.error("This version of luma.gl has already been initialized")()}zt.log(1,`${this.VERSION} - ${YW}`)(),globalThis.luma=this}async createDevice(e={}){const t={...G_.defaultProps,...e},n=this.selectAdapter(t.type,t.adapters);if(!n)throw new Error(wS);return t.waitForPageLoad&&await n.pageLoaded,await n.create(t)}async attachDevice(e,t){const n=this._getTypeFromHandle(e,t.adapters),s=n&&this.selectAdapter(n,t.adapters);if(!s)throw new Error(wS);return await s?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],n=this._getAdapterMap(e);for(const s of t)if(n.get(s)?.isSupported?.())return s;return null}selectAdapter(e,t=[]){let n=e;e==="best-available"&&(n=this.getBestAvailableAdapterType(t));const s=this._getAdapterMap(t);return n&&s.get(n)||null}enforceWebGL2(e=!0,t=[]){const s=this._getAdapterMap(t).get("webgl");s||zt.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(G_.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?zt.warn("WebGL1 is not supported",e)():zt.warn("Unknown handle type",e)(),null)}}const Ox=new G_;class KW{get pageLoaded(){return e9()}}const QW=Tu()&&typeof document<"u",JW=()=>QW&&document.readyState==="complete";let Zm=null;function e9(){return Zm||(JW()||typeof window>"u"?Zm=Promise.resolve():Zm=new Promise(r=>window.addEventListener("load",()=>r()))),Zm}function t9(){let r,e;return{promise:new Promise((n,s)=>{r=n,e=s}),resolve:r,reject:e}}class Zc{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=t9();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Zc.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Tu()?e.canvas?typeof e.canvas=="string"?this.canvas=n9(e.canvas):this.canvas=e.canvas:this.canvas=i9(e):this.canvas={width:e.width||1,height:e.height||1},Zc.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Zc.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Zc.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[s,l]=this.getDrawingBufferSize();return s9(e,n,s,l,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(s=>s.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(g=>g.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),s=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,l=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[c,a]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,c)),this.devicePixelHeight=Math.max(1,Math.min(l,a)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const s=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function r9(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}return r||document.body}function n9(r){const e=document.getElementById(r);if(!Zc.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function i9(r){const{width:e,height:t}=r,n=document.createElement("canvas");n.id=Py("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",r?.visible||(n.style.visibility="hidden");const s=r9(r?.container||null);return s.insertBefore(n,s.firstChild),n}function s9(r,e,t,n,s){const l=r,c=TS(l[0],e,t);let a=SS(l[1],e,n,s),g=TS(l[0]+1,e,t);const v=g===t-1?g:g-1;g=SS(l[1]+1,e,n,s);let w;return s?(g=g===0?g:g+1,w=a,a=g):w=g===n-1?g:g-1,{x:c,y:a,width:Math.max(v-c+1,1),height:Math.max(w-a+1,1)}}function TS(r,e,t){return Math.min(Math.round(r*e),t-1)}function SS(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}class du extends Yn{static defaultProps={...Yn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=du.normalizeProps(e,t),super(e,t,du.defaultProps)}static normalizeProps(e,t){return t}}const o9={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Qi extends Yn{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=Qi.normalizeProps(e,t),super(e,t,Qi.defaultProps),this.dimension=this.props.dimension,this.baseDimension=o9[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const n=e.getExternalImageSize(t.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&zt.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof du?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:s,height:l}=n;return typeof s=="number"&&(n.width=Math.max(1,Math.ceil(s))),typeof l=="number"&&(n.height=Math.max(1,Math.ceil(l))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:n,depth:s}=this,l={...Qi.defaultCopyDataOptions,width:t,height:n,depth:s,...e},c=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!c.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return l.bytesPerRow=e.bytesPerRow||t*(c.bytesPerPixel||4),l.rowsPerImage=e.rowsPerImage||n,l}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),n={...Qi.defaultCopyExternalImageOptions,...t,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Yn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Qi.TEXTURE|Qi.RENDER_ATTACHMENT|Qi.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class Iy extends Yn{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Iy.defaultProps)}static defaultProps={...Yn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function a9(r,e,t){let n="";const s=e.split(/\r?\n/),l=r.slice().sort((c,a)=>c.lineNum-a.lineNum);switch(t?.showSourceCode||"no"){case"all":let c=0;for(let a=1;a<=s.length;a++)for(n+=WI(s[a-1],a,t);l.length>c&&l[c].lineNum===a;){const g=l[c++];n+=wb(g,s,g.lineNum,{...t,inlineSource:!1})}for(;l.length>c;){const a=l[c++];n+=wb(a,[],0,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const a of r)n+=wb(a,s,a.lineNum,{inlineSource:t?.showSourceCode!=="no"});return n}}function wb(r,e,t,n){if(n?.inlineSource){const l=l9(e,t),c=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${l}${c}${r.type.toUpperCase()}: ${r.message}

`}const s=r.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function l9(r,e,t){let n="";for(let s=e-2;s<=e;s++){const l=r[s-1];l!==void 0&&(n+=WI(l,e,t))}return n}function WI(r,e,t){const n=t?.html?u9(r):r;return`${c9(String(e),4)}: ${n}${t?.html?"<br/>":`
`}`}function c9(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function u9(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Cy extends Yn{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:h9(t),...t},Cy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const n=t,s=`${this.stage} shader "${n}"`;let l=a9(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(l+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${l}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),a.onclick=()=>{const v=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(v)}}static defaultProps={...Yn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function h9(r){return d9(r.source)||r.id||Py(`unnamed ${r.stage}-shader`)}function d9(r,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}class Ry extends Yn{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Ry.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||n!==this.width,this.width=n,this.height=s}t&&(zt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,n)=>{if(typeof t=="string"){const s=this.createColorTexture(t,n);return this.attachResource(s),s.view}return t instanceof Qi?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof Qi?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Qi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Qi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const s=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Yn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class su extends Yn{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,su.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Yn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class $c extends Yn{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=$c.normalizeProps(e,t),super(e,t,$c.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...Yn.defaultProps,framebuffer:null,parameters:void 0,clearColor:$c.defaultClearColor,clearColors:void 0,clearDepth:$c.defaultClearDepth,clearStencil:$c.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Y_ extends Yn{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Y_.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Yn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class gw extends Yn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,gw.defaultProps)}static defaultProps={...Yn.defaultProps,measureExecutionTime:void 0}}class mw extends Yn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,mw.defaultProps)}static defaultProps={...Yn.defaultProps}}function $I(r){return m9[r]}function f9(r){const[e,t]=g9[r],n=e==="i32"||e==="u32",s=e!=="u32",l=p9[e]*t;return{primitiveType:e,components:t,byteLength:l,integer:n,signed:s}}const p9={f32:4,f16:2,i32:4,u32:4},g9={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},m9={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function HI(r,e){const t={};for(const n of r.attributes){const s=y9(r,e,n.name);s&&(t[n.name]=s)}return t}function _9(r,e,t=16){const n=HI(r,e),s=new Array(t).fill(null);for(const l of Object.values(n))s[l.location]=l;return s}function y9(r,e,t){const n=v9(r,t),s=b9(e,t);if(!n)return null;const l=f9(n.type),c=FW(l),a=s?.vertexFormat||c,g=pw(a);return{attributeName:s?.attributeName||n.name,bufferName:s?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:l.primitiveType,shaderComponents:l.components,vertexFormat:a,bufferDataType:g.type,bufferComponents:g.components,normalized:g.normalized,integer:l.integer,stepMode:s?.stepMode||n.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function v9(r,e){const t=r.attributes.find(n=>n.name===e);return t||zt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function b9(r,e){x9(r);let t=w9(r,e);return t||(t=T9(r,e),t)?t:(zt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function x9(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&zt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function w9(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function T9(r,e){for(const t of r){let n=t.byteStride;if(typeof t.byteStride!="number")for(const l of t.attributes||[]){const c=pw(l.format);n+=c.byteLength}const s=t.attributes?.find(l=>l.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:n}}return null}class _w extends Yn{static defaultProps={...Yn.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,_w.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=_9(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class yw extends Yn{static defaultProps={...Yn.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,yw.defaultProps)}}class vw extends Yn{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,vw.defaultProps)}static defaultProps={...Yn.defaultProps,type:void 0,count:void 0}}let Xm;function ZI(r){return(!Xm||Xm.byteLength<r)&&(Xm=new ArrayBuffer(r)),Xm}function S9(r,e){const t=ZI(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function A9(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function K_(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":A9(r)}const E9=1024;class P9{layout={};byteLength;constructor(e,t={}){let n=0;for(const[l,c]of Object.entries(e)){const a=$I(c),{type:g,components:v}=a,w=v*(t?.[l]??1);n=kW(n,w);const P=n;n+=w,this.layout[l]={type:g,size:w,offset:P}}n+=(4-n%4)%4;const s=n*4;this.byteLength=Math.max(s,E9)}getData(e){const t=ZI(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[s,l]of Object.entries(e)){const c=this.layout[s];if(!c){zt.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:a,size:g,offset:v}=c,w=n[a];if(g===1){if(typeof l!="number"&&typeof l!="boolean"){zt.warn(`Supplied value for single component uniform ${s} is not a number: ${l}`)();continue}w[v]=Number(l)}else{if(!K_(l)){zt.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${l}`)();continue}w.set(l,v)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function I9(r,e,t=16){if(r!==e)return!1;const n=r,s=e;if(!K_(n))return!1;if(K_(s)&&n.length===s.length){for(let l=0;l<n.length;++l)if(s[l]!==n[l])return!1}return!0}function C9(r){return K_(r)?r.slice():r}class R9{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const n=t;for(const s of n.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){I9(this.uniforms[e],t)||(this.uniforms[e]=C9(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class M9{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,n]of Object.entries(e)){const s=t,l=new P9(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(s,l);const c=new R9({name:t});c.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(t),l=e.createBuffer({usage:ni.UNIFORM|ni.COPY_DST,byteLength:s}),c=this.getUniformBufferData(t);return l.write(c),l}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:ni.UNIFORM|ni.COPY_DST,byteLength:n});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&zt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),s=!1;if(n&&t?.needsRedraw){s||=t.needsRedraw;const l=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(l);const c=this.uniformBlocks.get(e)?.getAllUniforms();zt.log(4,`Writing to uniform buffer ${String(e)}`,l,c)()}return s}}class xo{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class AS{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ec extends xo{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ic extends xo{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Fx extends xo{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class fu extends xo{constructor(e,t,n,s){super(e,n),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Yl;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(Yl||(Yl={}));class qm{constructor(e,t,n,s,l,c,a){this.name=e,this.type=t,this.group=n,this.binding=s,this.attributes=l,this.resourceType=c,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class k9{constructor(e,t){this.name=e,this.type=t}}class D9{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s,this.interpolation=null}}let ES=class{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s}};class O9{constructor(e,t,n,s){this.name=e,this.type=t,this.attributes=n,this.id=s}}class F9{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class N9{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class L9{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function B9(r){var e=(32768&r)>>15,t=(31744&r)>>10,n=1023&r;return t==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}const XI=new Float32Array(1),z9=new Int32Array(XI.buffer),bs=new Uint16Array(1);function U9(r){XI[0]=r;const e=z9[0],t=e>>31&1;let n=e>>23&255,s=8388607&e;if(n===255)return bs[0]=t<<15|31744|(s!==0?512:0),bs[0];if(n===0){if(s===0)return bs[0]=t<<15,bs[0];s|=8388608;let l=113;for(;!(8388608&s);)s<<=1,l--;return n=127-l,s&=8388607,n>0?(s=(s>>126-n)+(s>>127-n&1),bs[0]=t<<15|n<<10|s>>13,bs[0]):(bs[0]=t<<15,bs[0])}return n=n-127+15,n>=31?(bs[0]=t<<15|31744,bs[0]):n<=0?n<-10?(bs[0]=t<<15,bs[0]):(s=(8388608|s)>>1-n,bs[0]=t<<15|s>>13,bs[0]):(s>>=13,bs[0]=t<<15|n<<10|s,bs[0])}const bw=new Uint32Array(1),qI=new Float32Array(bw.buffer,0,1);function PS(r){const e=112+(r>>6&31)<<23|(63&r)<<17;return bw[0]=e,qI[0]}function V9(r,e,t,n,s,l,c,a,g){const v=n*(c>>=s)*(l>>=s)+t*c+e*a;switch(g){case"r8unorm":return[Dn(r,v,"8unorm",1)[0]];case"r8snorm":return[Dn(r,v,"8snorm",1)[0]];case"r8uint":return[Dn(r,v,"8uint",1)[0]];case"r8sint":return[Dn(r,v,"8sint",1)[0]];case"rg8unorm":{const w=Dn(r,v,"8unorm",2);return[w[0],w[1]]}case"rg8snorm":{const w=Dn(r,v,"8snorm",2);return[w[0],w[1]]}case"rg8uint":{const w=Dn(r,v,"8uint",2);return[w[0],w[1]]}case"rg8sint":{const w=Dn(r,v,"8sint",2);return[w[0],w[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const w=Dn(r,v,"8unorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8snorm":{const w=Dn(r,v,"8snorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8uint":{const w=Dn(r,v,"8uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba8sint":{const w=Dn(r,v,"8sint",4);return[w[0],w[1],w[2],w[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const w=Dn(r,v,"8unorm",4);return[w[2],w[1],w[0],w[3]]}case"r16uint":return[Dn(r,v,"16uint",1)[0]];case"r16sint":return[Dn(r,v,"16sint",1)[0]];case"r16float":return[Dn(r,v,"16float",1)[0]];case"rg16uint":{const w=Dn(r,v,"16uint",2);return[w[0],w[1]]}case"rg16sint":{const w=Dn(r,v,"16sint",2);return[w[0],w[1]]}case"rg16float":{const w=Dn(r,v,"16float",2);return[w[0],w[1]]}case"rgba16uint":{const w=Dn(r,v,"16uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16sint":{const w=Dn(r,v,"16sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16float":{const w=Dn(r,v,"16float",4);return[w[0],w[1],w[2],w[3]]}case"r32uint":return[Dn(r,v,"32uint",1)[0]];case"r32sint":return[Dn(r,v,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Dn(r,v,"32float",1)[0]];case"rg32uint":{const w=Dn(r,v,"32uint",2);return[w[0],w[1]]}case"rg32sint":{const w=Dn(r,v,"32sint",2);return[w[0],w[1]]}case"rg32float":{const w=Dn(r,v,"32float",2);return[w[0],w[1]]}case"rgba32uint":{const w=Dn(r,v,"32uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32sint":{const w=Dn(r,v,"32sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32float":{const w=Dn(r,v,"32float",4);return[w[0],w[1],w[2],w[3]]}case"rg11b10ufloat":{const w=new Uint32Array(r.buffer,v,1)[0],P=(4192256&w)>>11,I=(4290772992&w)>>22;return[PS(2047&w),PS(P),(function(k){const N=112+(k>>5&31)<<23|(31&k)<<18;return bw[0]=N,qI[0]})(I),1]}}return null}function Dn(r,e,t,n){const s=[0,0,0,0];for(let l=0;l<n;++l)switch(t){case"8unorm":s[l]=r[e]/255,e++;break;case"8snorm":s[l]=r[e]/255*2-1,e++;break;case"8uint":s[l]=r[e],e++;break;case"8sint":s[l]=r[e]-127,e++;break;case"16uint":s[l]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":s[l]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":s[l]=B9(r[e]|r[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[l]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":s[l]=new Float32Array(r.buffer,e,1)[0],e+=4}return s}function Bn(r,e,t,n,s){for(let l=0;l<n;++l)switch(t){case"8unorm":r[e]=255*s[l],e++;break;case"8snorm":r[e]=.5*(s[l]+1)*255,e++;break;case"8uint":r[e]=s[l],e++;break;case"8sint":r[e]=s[l]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=s[l],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=s[l],e+=2;break;case"16float":{const c=U9(s[l]);new Uint16Array(r.buffer,e,1)[0]=c,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=s[l],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=s[l],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=s[l],e+=4}return s}const Tb={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Eo{constructor(){this.id=Eo._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Q_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(J_.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Eo._id=0;class Q_ extends Eo{}Q_.instance=new Q_;class J_ extends Eo{}J_.instance=new J_;const GI=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class pi extends Eo{constructor(){super()}}let Zp=class extends pi{constructor(e,t,n,s,l,c){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=s,this.startLine=l,this.endLine=c}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}};class j9 extends pi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class YI extends pi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Nx extends pi{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}let KI=class extends pi{constructor(e,t,n,s){super(),this.init=e,this.condition=t,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var t,n,s;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}};class el extends pi{constructor(e,t,n,s,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=l}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class xw extends pi{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Pp extends pi{constructor(e,t,n,s,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=l}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class y_ extends pi{constructor(e,t,n,s,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=l}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Kh,dp,ct,Je;(r=>{r.increment="++",r.decrement="--"})(Kh||(Kh={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(Kh||(Kh={}));class QI extends pi{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(dp||(dp={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(dp||(dp={}));class JI extends pi{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ww extends pi{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return GI.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class eC extends pi{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class tC extends pi{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class rC extends pi{constructor(e,t,n,s){super(),this.condition=e,this.body=t,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class nC extends pi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class W9 extends pi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class $9 extends pi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class iC extends pi{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Tw extends pi{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class H9 extends pi{constructor(){super()}get astNodeType(){return"discard"}}class sC extends pi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class oC extends pi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Nt extends pi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=Nt._priority.get(t.name);Nt._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?Nt.i32:t}getTypeName(){return this.name}}Nt.x32=new Nt("x32"),Nt.f32=new Nt("f32"),Nt.i32=new Nt("i32"),Nt.u32=new Nt("u32"),Nt.f16=new Nt("f16"),Nt.bool=new Nt("bool"),Nt.void=new Nt("void"),Nt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class IS extends Nt{constructor(e){super(e)}}class Ka extends Nt{constructor(e,t,n,s){super(e),this.members=t,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class st extends Nt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}st.vec2f=new st("vec2",Nt.f32,null),st.vec3f=new st("vec3",Nt.f32,null),st.vec4f=new st("vec4",Nt.f32,null),st.vec2i=new st("vec2",Nt.i32,null),st.vec3i=new st("vec3",Nt.i32,null),st.vec4i=new st("vec4",Nt.i32,null),st.vec2u=new st("vec2",Nt.u32,null),st.vec3u=new st("vec3",Nt.u32,null),st.vec4u=new st("vec4",Nt.u32,null),st.vec2h=new st("vec2",Nt.f16,null),st.vec3h=new st("vec3",Nt.f16,null),st.vec4h=new st("vec4",Nt.f16,null),st.vec2b=new st("vec2",Nt.bool,null),st.vec3b=new st("vec3",Nt.bool,null),st.vec4b=new st("vec4",Nt.bool,null),st.mat2x2f=new st("mat2x2",Nt.f32,null),st.mat2x3f=new st("mat2x3",Nt.f32,null),st.mat2x4f=new st("mat2x4",Nt.f32,null),st.mat3x2f=new st("mat3x2",Nt.f32,null),st.mat3x3f=new st("mat3x3",Nt.f32,null),st.mat3x4f=new st("mat3x4",Nt.f32,null),st.mat4x2f=new st("mat4x2",Nt.f32,null),st.mat4x3f=new st("mat4x3",Nt.f32,null),st.mat4x4f=new st("mat4x4",Nt.f32,null),st.mat2x2h=new st("mat2x2",Nt.f16,null),st.mat2x3h=new st("mat2x3",Nt.f16,null),st.mat2x4h=new st("mat2x4",Nt.f16,null),st.mat3x2h=new st("mat3x2",Nt.f16,null),st.mat3x3h=new st("mat3x3",Nt.f16,null),st.mat3x4h=new st("mat3x4",Nt.f16,null),st.mat4x2h=new st("mat4x2",Nt.f16,null),st.mat4x3h=new st("mat4x3",Nt.f16,null),st.mat4x4h=new st("mat4x4",Nt.f16,null),st.mat2x2i=new st("mat2x2",Nt.i32,null),st.mat2x3i=new st("mat2x3",Nt.i32,null),st.mat2x4i=new st("mat2x4",Nt.i32,null),st.mat3x2i=new st("mat3x2",Nt.i32,null),st.mat3x3i=new st("mat3x3",Nt.i32,null),st.mat3x4i=new st("mat3x4",Nt.i32,null),st.mat4x2i=new st("mat4x2",Nt.i32,null),st.mat4x3i=new st("mat4x3",Nt.i32,null),st.mat4x4i=new st("mat4x4",Nt.i32,null),st.mat2x2u=new st("mat2x2",Nt.u32,null),st.mat2x3u=new st("mat2x3",Nt.u32,null),st.mat2x4u=new st("mat2x4",Nt.u32,null),st.mat3x2u=new st("mat3x2",Nt.u32,null),st.mat3x3u=new st("mat3x3",Nt.u32,null),st.mat3x4u=new st("mat3x4",Nt.u32,null),st.mat4x2u=new st("mat4x2",Nt.u32,null),st.mat4x3u=new st("mat4x3",Nt.u32,null),st.mat4x4u=new st("mat4x4",Nt.u32,null);class v_ extends Nt{constructor(e,t,n,s){super(e),this.storage=t,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class Ip extends Nt{constructor(e,t,n,s){super(e),this.attributes=t,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class fp extends Nt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class qo extends Eo{constructor(){super(),this.postfix=null}}class pu extends qo{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ga extends qo{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Sw extends qo{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return GI.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Js extends qo{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class aC extends qo{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Yi extends qo{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Qe}get isVector(){return this.value instanceof Ie||this.value instanceof Xr}get scalarValue(){return this.value instanceof Qe?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ie||this.value instanceof Xr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class lC extends qo{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class pd extends qo{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class cC extends qo{constructor(){super()}}class ji extends cC{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Uo extends cC{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Nt.f32:e.name==="u32"||t.name==="u32"?Nt.u32:Nt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class uC extends Eo{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class b_ extends qo{constructor(){super()}get astNodeType(){return"default"}}class hC extends uC{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class dC extends uC{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class CS extends Eo{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Z9 extends Eo{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class RS extends Eo{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class fC extends Eo{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class So{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=So._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}So._id=0;class Lx extends So{constructor(){super(new xo("void",null),null)}toString(){return"void"}}Lx.void=new Lx;class jh extends So{constructor(e){super(new Fx("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,s){this.reference.setDataValue(e,t,n,s)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class Qe extends So{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Qe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Qe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Qe(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,s){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Qe))return void console.error("SetDataValue: Invalid value",t);let l=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?l=Math.floor(l):this.typeInfo.name==="bool"&&(l=l?1:0),this.data[0]=l}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function X9(r,e,t){const n=e.length;return n===2?t==="f32"?new Ie(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Ie(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new Ie(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new Ie(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new Ie(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Ie(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new Ie(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new Ie(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new Ie(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Ie(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new Ie(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new Ie(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Ie extends So{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new Ie(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ie(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ie(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,s){n instanceof pu?console.error("TODO: Set vector postfix"):t instanceof Ie?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof fu)s=this.typeInfo.format||s;else{const c=this.typeInfo.name;c==="vec2f"||c==="vec3f"||c==="vec4f"?s=e.getTypeInfo("f32"):c==="vec2i"||c==="vec3i"||c==="vec4i"?s=e.getTypeInfo("i32"):c==="vec2b"||c==="vec3b"||c==="vec4b"?s=e.getTypeInfo("bool"):c==="vec2u"||c==="vec3u"||c==="vec4u"?s=e.getTypeInfo("u32"):c==="vec2h"||c==="vec3h"||c==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${c}`)}let l=this;for(;t!==null&&l!==null;){if(t instanceof pd){const c=t.index;let a=-1;if(c instanceof Yi){if(!(c.value instanceof Qe))return console.error(`GetSubData: Invalid array index ${c.value}`),null;a=c.value.value}else{const g=e.evalExpression(c,n);if(!(g instanceof Qe))return console.error("GetSubData: Unknown index type",c),null;a=g.value}if(a<0||a>=l.data.length)return console.error("GetSubData: Index out of range",a),null;if(l.data instanceof Float32Array){const g=new Float32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Qe(g,s)}if(l.data instanceof Int32Array){const g=new Int32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Qe(g,s)}if(l.data instanceof Uint32Array){const g=new Uint32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Qe(g,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof pu))return console.error("GetSubData: Unknown postfix",t),null;{const c=t.value.toLowerCase();if(c.length===1){let g=0;if(c==="x"||c==="r")g=0;else if(c==="y"||c==="g")g=1;else if(c==="z"||c==="b")g=2;else{if(c!=="w"&&c!=="a")return console.error(`GetSubData: Unknown member ${c}`),null;g=3}if(this.data instanceof Float32Array){let v=new Float32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Qe(v,s,this)}if(this.data instanceof Int32Array){let v=new Int32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Qe(v,s,this)}if(this.data instanceof Uint32Array){let v=new Uint32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Qe(v,s,this)}}const a=[];for(const g of c)g==="x"||g==="r"?a.push(this.data[0]):g==="y"||g==="g"?a.push(this.data[1]):g==="z"||g==="b"?a.push(this.data[2]):g==="w"||g==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${g}`);l=X9(e,a,s.name)}t=t.postfix}return l}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Xr extends So{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Xr(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,s){n instanceof pu?console.error("TODO: Set matrix postfix"):t instanceof Xr?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof fu)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof pd){const l=t.index;let c=-1;if(l instanceof Yi){if(!(l.value instanceof Qe))return console.error(`GetDataValue: Invalid array index ${l.value}`),null;c=l.value.value}else{const v=e.evalExpression(l,n);if(!(v instanceof Qe))return console.error("GetDataValue: Unknown index type",l),null;c=v.value}if(c<0||c>=this.data.length)return console.error("GetDataValue: Index out of range",c),null;const a=s.endsWith("h")?"h":"f";let g;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")g=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+2*c*4,2),e.getTypeInfo(`vec2${a}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")g=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+3*c*4,3),e.getTypeInfo(`vec3${a}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;g=new Ie(new Float32Array(this.data.buffer,this.data.byteOffset+4*c*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?g.getSubData(e,t.postfix,n):g}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ti extends So{constructor(e,t,n=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Ti(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,s){if(t===null)return void console.log("setDataValue: NULL data.");let l=this.offset,c=this.typeInfo;for(;n;){if(n instanceof pd)if(c instanceof ic){const a=n.index;if(a instanceof Yi){if(!(a.value instanceof Qe))return void console.error(`SetDataValue: Invalid index type ${a.value}`);l+=a.value.value*c.stride}else{const g=e.evalExpression(a,s);if(!(g instanceof Qe))return void console.error("SetDataValue: Unknown index type",a);l+=g.value*c.stride}c=c.format}else console.error(`SetDataValue: Type ${c.getTypeName()} is not an array`);else{if(!(n instanceof pu))return void console.error("SetDataValue: Unknown postfix type",n);{const a=n.value;if(c instanceof ec){let g=!1;for(const v of c.members)if(v.name===a){l+=v.offset,c=v.type,g=!0;break}if(!g)return void console.error(`SetDataValue: Member ${a} not found`)}else if(c instanceof xo){const g=c.getTypeName();let v=0;if(a==="x"||a==="r")v=0;else if(a==="y"||a==="g")v=1;else if(a==="z"||a==="b")v=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);v=3}if(!(t instanceof Qe))return void console.error("SetDataValue: Invalid value",t);const w=t.value;return g==="vec2f"?void(new Float32Array(this.buffer,l,2)[v]=w):g==="vec3f"?void(new Float32Array(this.buffer,l,3)[v]=w):g==="vec4f"?void(new Float32Array(this.buffer,l,4)[v]=w):g==="vec2i"?void(new Int32Array(this.buffer,l,2)[v]=w):g==="vec3i"?void(new Int32Array(this.buffer,l,3)[v]=w):g==="vec4i"?void(new Int32Array(this.buffer,l,4)[v]=w):g==="vec2u"?void(new Uint32Array(this.buffer,l,2)[v]=w):g==="vec3u"?void(new Uint32Array(this.buffer,l,3)[v]=w):g==="vec4u"?void(new Uint32Array(this.buffer,l,4)[v]=w):void console.error(`SetDataValue: Type ${g} is not a struct`)}}}n=n.postfix}this.setData(e,t,c,l,s)}setData(e,t,n,s,l){const c=n.getTypeName();if(c!=="f32"&&c!=="f16")if(c!=="i32"&&c!=="atomic<i32>"&&c!=="x32")if(c!=="u32"&&c!=="atomic<u32>")if(c!=="bool"){if(c==="vec2f"||c==="vec2h"){const a=new Float32Array(this.buffer,s,2);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(c==="vec3f"||c==="vec3h"){const a=new Float32Array(this.buffer,s,3);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(c==="vec4f"||c==="vec4h"){const a=new Float32Array(this.buffer,s,4);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(c==="vec2i"){const a=new Int32Array(this.buffer,s,2);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(c==="vec3i"){const a=new Int32Array(this.buffer,s,3);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(c==="vec4i"){const a=new Int32Array(this.buffer,s,4);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(c==="vec2u"){const a=new Uint32Array(this.buffer,s,2);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(c==="vec3u"){const a=new Uint32Array(this.buffer,s,3);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(c==="vec4u"){const a=new Uint32Array(this.buffer,s,4);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(c==="vec2b"){const a=new Uint32Array(this.buffer,s,2);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(c==="vec3b"){const a=new Uint32Array(this.buffer,s,3);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(c==="vec4b"){const a=new Uint32Array(this.buffer,s,4);return void(t instanceof Ie?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(c==="mat2x2f"||c==="mat2x2h"){const a=new Float32Array(this.buffer,s,4);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(c==="mat2x3f"||c==="mat2x3h"){const a=new Float32Array(this.buffer,s,6);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(c==="mat2x4f"||c==="mat2x4h"){const a=new Float32Array(this.buffer,s,8);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(c==="mat3x2f"||c==="mat3x2h"){const a=new Float32Array(this.buffer,s,6);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(c==="mat3x3f"||c==="mat3x3h"){const a=new Float32Array(this.buffer,s,9);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(c==="mat3x4f"||c==="mat3x4h"){const a=new Float32Array(this.buffer,s,12);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(c==="mat4x2f"||c==="mat4x2h"){const a=new Float32Array(this.buffer,s,8);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(c==="mat4x3f"||c==="mat4x3h"){const a=new Float32Array(this.buffer,s,12);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(c==="mat4x4f"||c==="mat4x4h"){const a=new Float32Array(this.buffer,s,16);return void(t instanceof Xr?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof Ti){if(n===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",c,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${c}`)}else t instanceof Qe&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof Qe&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof Qe&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof Qe&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,n){var s,l,c;if(t===null)return this;let a=this.offset,g=this.typeInfo;for(;t;){if(t instanceof pd){const w=t.index,P=w instanceof qo?e.evalExpression(w,n):w;let I=0;if(P instanceof Qe?I=P.value:typeof P=="number"?I=P:console.error("GetDataValue: Invalid index type",w),g instanceof ic)a+=I*g.stride,g=g.format;else{const k=g.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(a+=16*I,g=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${g.getTypeName()} is not an array`)}}else{if(!(t instanceof pu))return console.error("GetDataValue: Unknown postfix type",t),null;{const w=t.value;if(g instanceof ec){let P=!1;for(const I of g.members)if(I.name===w){a+=I.offset,g=I.type,P=!0;break}if(!P)return console.error(`GetDataValue: Member ${w} not found`),null}else if(g instanceof xo){const P=g.getTypeName();if(P==="vec2f"||P==="vec3f"||P==="vec4f"||P==="vec2i"||P==="vec3i"||P==="vec4i"||P==="vec2u"||P==="vec3u"||P==="vec4u"||P==="vec2b"||P==="vec3b"||P==="vec4b"||P==="vec2h"||P==="vec3h"||P==="vec4h"||P==="vec2"||P==="vec3"||P==="vec4"){if(w.length>0&&w.length<5){let I="f";const k=[];for(let N=0;N<w.length;++N){const D=w[N].toLowerCase();let B=0;if(D==="x"||D==="r")B=0;else if(D==="y"||D==="g")B=1;else if(D==="z"||D==="b")B=2;else{if(D!=="w"&&D!=="a")return console.error(`Unknown member ${w}`),null;B=3}if(w.length===1){if(P.endsWith("f"))return this.buffer.byteLength<a+4*B+4?(console.log("Insufficient buffer data"),null):new Qe(new Float32Array(this.buffer,a+4*B,1),e.getTypeInfo("f32"),this);if(P.endsWith("h"))return new Qe(new Float32Array(this.buffer,a+4*B,1),e.getTypeInfo("f16"),this);if(P.endsWith("i"))return new Qe(new Int32Array(this.buffer,a+4*B,1),e.getTypeInfo("i32"),this);if(P.endsWith("b"))return new Qe(new Int32Array(this.buffer,a+4*B,1),e.getTypeInfo("bool"),this);if(P.endsWith("u"))return new Qe(new Uint32Array(this.buffer,a+4*B,1),e.getTypeInfo("i32"),this)}if(P==="vec2f")k.push(new Float32Array(this.buffer,a,2)[B]);else if(P==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const U=new Float32Array(this.buffer,a,3);k.push(U[B])}else if(P==="vec4f")k.push(new Float32Array(this.buffer,a,4)[B]);else if(P==="vec2i")I="i",k.push(new Int32Array(this.buffer,a,2)[B]);else if(P==="vec3i")I="i",k.push(new Int32Array(this.buffer,a,3)[B]);else if(P==="vec4i")I="i",k.push(new Int32Array(this.buffer,a,4)[B]);else if(P==="vec2u"){I="u";const U=new Uint32Array(this.buffer,a,2);k.push(U[B])}else P==="vec3u"?(I="u",k.push(new Uint32Array(this.buffer,a,3)[B])):P==="vec4u"&&(I="u",k.push(new Uint32Array(this.buffer,a,4)[B]))}return k.length===2?g=e.getTypeInfo(`vec2${I}`):k.length===3?g=e.getTypeInfo(`vec3${I}`):k.length===4?g=e.getTypeInfo(`vec4${I}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new Ie(k,g,null)}return console.error(`GetDataValue: Unknown member ${w}`),null}return console.error(`GetDataValue: Type ${P} is not a struct`),null}}}t=t.postfix}const v=g.getTypeName();return v==="f32"?new Qe(new Float32Array(this.buffer,a,1),g,this):v==="i32"?new Qe(new Int32Array(this.buffer,a,1),g,this):v==="u32"?new Qe(new Uint32Array(this.buffer,a,1),g,this):v==="vec2f"?new Ie(new Float32Array(this.buffer,a,2),g,this):v==="vec3f"?new Ie(new Float32Array(this.buffer,a,3),g,this):v==="vec4f"?new Ie(new Float32Array(this.buffer,a,4),g,this):v==="vec2i"?new Ie(new Int32Array(this.buffer,a,2),g,this):v==="vec3i"?new Ie(new Int32Array(this.buffer,a,3),g,this):v==="vec4i"?new Ie(new Int32Array(this.buffer,a,4),g,this):v==="vec2u"?new Ie(new Uint32Array(this.buffer,a,2),g,this):v==="vec3u"?new Ie(new Uint32Array(this.buffer,a,3),g,this):v==="vec4u"?new Ie(new Uint32Array(this.buffer,a,4),g,this):g instanceof fu&&g.name==="atomic"?((s=g.format)===null||s===void 0?void 0:s.name)==="u32"?new Qe(new Uint32Array(this.buffer,a,1)[0],g.format,this):((l=g.format)===null||l===void 0?void 0:l.name)==="i32"?new Qe(new Int32Array(this.buffer,a,1)[0],g.format,this):(console.error(`GetDataValue: Invalid atomic format ${(c=g.format)===null||c===void 0?void 0:c.name}`),null):new Ti(this.buffer,g,a,this)}toString(){let e="";if(this.typeInfo instanceof ic)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof ec?e+="{...}":e="[...]";return e}}class Qa extends So{constructor(e,t,n,s){super(t,null),this.data=e,this.descriptor=n,this.view=s}clone(){return new Qa(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Tb[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Tb[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Tb[e],n=this.width;if(!e||n<=0||!t)return-1;const s=this.height,l=this.depthOrArrayLayers,c=this.dimension;return n/t.blockWidth*(c==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*l}getPixel(e,t,n=0,s=0){const l=this.texelByteSize,c=this.bytesPerRow,a=this.height,g=this.data[s];return V9(new Uint8Array(g),e,t,n,s,a,c,l,this.format)}setPixel(e,t,n,s,l){const c=this.texelByteSize,a=this.bytesPerRow,g=this.height,v=this.data[s];(function(w,P,I,k,N,D,B,U,V,L){const $=k*(B>>=N)*(D>>=N)+I*B+P*U;switch(V){case"r8unorm":return void Bn(w,$,"8unorm",1,L);case"r8snorm":return void Bn(w,$,"8snorm",1,L);case"r8uint":return void Bn(w,$,"8uint",1,L);case"r8sint":return void Bn(w,$,"8sint",1,L);case"rg8unorm":return void Bn(w,$,"8unorm",2,L);case"rg8snorm":return void Bn(w,$,"8snorm",2,L);case"rg8uint":return void Bn(w,$,"8uint",2,L);case"rg8sint":return void Bn(w,$,"8sint",2,L);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Bn(w,$,"8unorm",4,L);case"rgba8snorm":return void Bn(w,$,"8snorm",4,L);case"rgba8uint":return void Bn(w,$,"8uint",4,L);case"rgba8sint":return void Bn(w,$,"8sint",4,L);case"r16uint":return void Bn(w,$,"16uint",1,L);case"r16sint":return void Bn(w,$,"16sint",1,L);case"r16float":return void Bn(w,$,"16float",1,L);case"rg16uint":return void Bn(w,$,"16uint",2,L);case"rg16sint":return void Bn(w,$,"16sint",2,L);case"rg16float":return void Bn(w,$,"16float",2,L);case"rgba16uint":return void Bn(w,$,"16uint",4,L);case"rgba16sint":return void Bn(w,$,"16sint",4,L);case"rgba16float":return void Bn(w,$,"16float",4,L);case"r32uint":return void Bn(w,$,"32uint",1,L);case"r32sint":return void Bn(w,$,"32sint",1,L);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Bn(w,$,"32float",1,L);case"rg32uint":return void Bn(w,$,"32uint",2,L);case"rg32sint":return void Bn(w,$,"32sint",2,L);case"rg32float":return void Bn(w,$,"32float",2,L);case"rgba32uint":return void Bn(w,$,"32uint",4,L);case"rgba32sint":return void Bn(w,$,"32sint",4,L);case"rgba32float":return void Bn(w,$,"32float",4,L);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(v),e,t,n,s,g,a,c,this.format,l)}}(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(Je||(Je={}));class et{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class ye{}ct=ye,ye.none=new et("",Je.reserved,""),ye.eof=new et("EOF",Je.token,""),ye.reserved={asm:new et("asm",Je.reserved,"asm"),bf16:new et("bf16",Je.reserved,"bf16"),do:new et("do",Je.reserved,"do"),enum:new et("enum",Je.reserved,"enum"),f16:new et("f16",Je.reserved,"f16"),f64:new et("f64",Je.reserved,"f64"),handle:new et("handle",Je.reserved,"handle"),i8:new et("i8",Je.reserved,"i8"),i16:new et("i16",Je.reserved,"i16"),i64:new et("i64",Je.reserved,"i64"),mat:new et("mat",Je.reserved,"mat"),premerge:new et("premerge",Je.reserved,"premerge"),regardless:new et("regardless",Je.reserved,"regardless"),typedef:new et("typedef",Je.reserved,"typedef"),u8:new et("u8",Je.reserved,"u8"),u16:new et("u16",Je.reserved,"u16"),u64:new et("u64",Je.reserved,"u64"),unless:new et("unless",Je.reserved,"unless"),using:new et("using",Je.reserved,"using"),vec:new et("vec",Je.reserved,"vec"),void:new et("void",Je.reserved,"void")},ye.keywords={array:new et("array",Je.keyword,"array"),atomic:new et("atomic",Je.keyword,"atomic"),bool:new et("bool",Je.keyword,"bool"),f32:new et("f32",Je.keyword,"f32"),i32:new et("i32",Je.keyword,"i32"),mat2x2:new et("mat2x2",Je.keyword,"mat2x2"),mat2x3:new et("mat2x3",Je.keyword,"mat2x3"),mat2x4:new et("mat2x4",Je.keyword,"mat2x4"),mat3x2:new et("mat3x2",Je.keyword,"mat3x2"),mat3x3:new et("mat3x3",Je.keyword,"mat3x3"),mat3x4:new et("mat3x4",Je.keyword,"mat3x4"),mat4x2:new et("mat4x2",Je.keyword,"mat4x2"),mat4x3:new et("mat4x3",Je.keyword,"mat4x3"),mat4x4:new et("mat4x4",Je.keyword,"mat4x4"),ptr:new et("ptr",Je.keyword,"ptr"),sampler:new et("sampler",Je.keyword,"sampler"),sampler_comparison:new et("sampler_comparison",Je.keyword,"sampler_comparison"),struct:new et("struct",Je.keyword,"struct"),texture_1d:new et("texture_1d",Je.keyword,"texture_1d"),texture_2d:new et("texture_2d",Je.keyword,"texture_2d"),texture_2d_array:new et("texture_2d_array",Je.keyword,"texture_2d_array"),texture_3d:new et("texture_3d",Je.keyword,"texture_3d"),texture_cube:new et("texture_cube",Je.keyword,"texture_cube"),texture_cube_array:new et("texture_cube_array",Je.keyword,"texture_cube_array"),texture_multisampled_2d:new et("texture_multisampled_2d",Je.keyword,"texture_multisampled_2d"),texture_storage_1d:new et("texture_storage_1d",Je.keyword,"texture_storage_1d"),texture_storage_2d:new et("texture_storage_2d",Je.keyword,"texture_storage_2d"),texture_storage_2d_array:new et("texture_storage_2d_array",Je.keyword,"texture_storage_2d_array"),texture_storage_3d:new et("texture_storage_3d",Je.keyword,"texture_storage_3d"),texture_depth_2d:new et("texture_depth_2d",Je.keyword,"texture_depth_2d"),texture_depth_2d_array:new et("texture_depth_2d_array",Je.keyword,"texture_depth_2d_array"),texture_depth_cube:new et("texture_depth_cube",Je.keyword,"texture_depth_cube"),texture_depth_cube_array:new et("texture_depth_cube_array",Je.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new et("texture_depth_multisampled_2d",Je.keyword,"texture_depth_multisampled_2d"),texture_external:new et("texture_external",Je.keyword,"texture_external"),u32:new et("u32",Je.keyword,"u32"),vec2:new et("vec2",Je.keyword,"vec2"),vec3:new et("vec3",Je.keyword,"vec3"),vec4:new et("vec4",Je.keyword,"vec4"),bitcast:new et("bitcast",Je.keyword,"bitcast"),block:new et("block",Je.keyword,"block"),break:new et("break",Je.keyword,"break"),case:new et("case",Je.keyword,"case"),continue:new et("continue",Je.keyword,"continue"),continuing:new et("continuing",Je.keyword,"continuing"),default:new et("default",Je.keyword,"default"),diagnostic:new et("diagnostic",Je.keyword,"diagnostic"),discard:new et("discard",Je.keyword,"discard"),else:new et("else",Je.keyword,"else"),enable:new et("enable",Je.keyword,"enable"),fallthrough:new et("fallthrough",Je.keyword,"fallthrough"),false:new et("false",Je.keyword,"false"),fn:new et("fn",Je.keyword,"fn"),for:new et("for",Je.keyword,"for"),function:new et("function",Je.keyword,"function"),if:new et("if",Je.keyword,"if"),let:new et("let",Je.keyword,"let"),const:new et("const",Je.keyword,"const"),loop:new et("loop",Je.keyword,"loop"),while:new et("while",Je.keyword,"while"),private:new et("private",Je.keyword,"private"),read:new et("read",Je.keyword,"read"),read_write:new et("read_write",Je.keyword,"read_write"),return:new et("return",Je.keyword,"return"),requires:new et("requires",Je.keyword,"requires"),storage:new et("storage",Je.keyword,"storage"),switch:new et("switch",Je.keyword,"switch"),true:new et("true",Je.keyword,"true"),alias:new et("alias",Je.keyword,"alias"),type:new et("type",Je.keyword,"type"),uniform:new et("uniform",Je.keyword,"uniform"),var:new et("var",Je.keyword,"var"),override:new et("override",Je.keyword,"override"),workgroup:new et("workgroup",Je.keyword,"workgroup"),write:new et("write",Je.keyword,"write"),r8unorm:new et("r8unorm",Je.keyword,"r8unorm"),r8snorm:new et("r8snorm",Je.keyword,"r8snorm"),r8uint:new et("r8uint",Je.keyword,"r8uint"),r8sint:new et("r8sint",Je.keyword,"r8sint"),r16uint:new et("r16uint",Je.keyword,"r16uint"),r16sint:new et("r16sint",Je.keyword,"r16sint"),r16float:new et("r16float",Je.keyword,"r16float"),rg8unorm:new et("rg8unorm",Je.keyword,"rg8unorm"),rg8snorm:new et("rg8snorm",Je.keyword,"rg8snorm"),rg8uint:new et("rg8uint",Je.keyword,"rg8uint"),rg8sint:new et("rg8sint",Je.keyword,"rg8sint"),r32uint:new et("r32uint",Je.keyword,"r32uint"),r32sint:new et("r32sint",Je.keyword,"r32sint"),r32float:new et("r32float",Je.keyword,"r32float"),rg16uint:new et("rg16uint",Je.keyword,"rg16uint"),rg16sint:new et("rg16sint",Je.keyword,"rg16sint"),rg16float:new et("rg16float",Je.keyword,"rg16float"),rgba8unorm:new et("rgba8unorm",Je.keyword,"rgba8unorm"),rgba8unorm_srgb:new et("rgba8unorm_srgb",Je.keyword,"rgba8unorm_srgb"),rgba8snorm:new et("rgba8snorm",Je.keyword,"rgba8snorm"),rgba8uint:new et("rgba8uint",Je.keyword,"rgba8uint"),rgba8sint:new et("rgba8sint",Je.keyword,"rgba8sint"),bgra8unorm:new et("bgra8unorm",Je.keyword,"bgra8unorm"),bgra8unorm_srgb:new et("bgra8unorm_srgb",Je.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new et("rgb10a2unorm",Je.keyword,"rgb10a2unorm"),rg11b10float:new et("rg11b10float",Je.keyword,"rg11b10float"),rg32uint:new et("rg32uint",Je.keyword,"rg32uint"),rg32sint:new et("rg32sint",Je.keyword,"rg32sint"),rg32float:new et("rg32float",Je.keyword,"rg32float"),rgba16uint:new et("rgba16uint",Je.keyword,"rgba16uint"),rgba16sint:new et("rgba16sint",Je.keyword,"rgba16sint"),rgba16float:new et("rgba16float",Je.keyword,"rgba16float"),rgba32uint:new et("rgba32uint",Je.keyword,"rgba32uint"),rgba32sint:new et("rgba32sint",Je.keyword,"rgba32sint"),rgba32float:new et("rgba32float",Je.keyword,"rgba32float"),static_assert:new et("static_assert",Je.keyword,"static_assert")},ye.tokens={decimal_float_literal:new et("decimal_float_literal",Je.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new et("hex_float_literal",Je.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new et("int_literal",Je.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new et("uint_literal",Je.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new et("name",Je.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new et("ident",Je.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new et("and",Je.token,"&"),and_and:new et("and_and",Je.token,"&&"),arrow:new et("arrow ",Je.token,"->"),attr:new et("attr",Je.token,"@"),forward_slash:new et("forward_slash",Je.token,"/"),bang:new et("bang",Je.token,"!"),bracket_left:new et("bracket_left",Je.token,"["),bracket_right:new et("bracket_right",Je.token,"]"),brace_left:new et("brace_left",Je.token,"{"),brace_right:new et("brace_right",Je.token,"}"),colon:new et("colon",Je.token,":"),comma:new et("comma",Je.token,","),equal:new et("equal",Je.token,"="),equal_equal:new et("equal_equal",Je.token,"=="),not_equal:new et("not_equal",Je.token,"!="),greater_than:new et("greater_than",Je.token,">"),greater_than_equal:new et("greater_than_equal",Je.token,">="),shift_right:new et("shift_right",Je.token,">>"),less_than:new et("less_than",Je.token,"<"),less_than_equal:new et("less_than_equal",Je.token,"<="),shift_left:new et("shift_left",Je.token,"<<"),modulo:new et("modulo",Je.token,"%"),minus:new et("minus",Je.token,"-"),minus_minus:new et("minus_minus",Je.token,"--"),period:new et("period",Je.token,"."),plus:new et("plus",Je.token,"+"),plus_plus:new et("plus_plus",Je.token,"++"),or:new et("or",Je.token,"|"),or_or:new et("or_or",Je.token,"||"),paren_left:new et("paren_left",Je.token,"("),paren_right:new et("paren_right",Je.token,")"),semicolon:new et("semicolon",Je.token,";"),star:new et("star",Je.token,"*"),tilde:new et("tilde",Je.token,"~"),underscore:new et("underscore",Je.token,"_"),xor:new et("xor",Je.token,"^"),plus_equal:new et("plus_equal",Je.token,"+="),minus_equal:new et("minus_equal",Je.token,"-="),times_equal:new et("times_equal",Je.token,"*="),division_equal:new et("division_equal",Je.token,"/="),modulo_equal:new et("modulo_equal",Je.token,"%="),and_equal:new et("and_equal",Je.token,"&="),or_equal:new et("or_equal",Je.token,"|="),xor_equal:new et("xor_equal",Je.token,"^="),shift_right_equal:new et("shift_right_equal",Je.token,">>="),shift_left_equal:new et("shift_left_equal",Je.token,"<<=")},ye.simpleTokens={"@":ct.tokens.attr,"{":ct.tokens.brace_left,"}":ct.tokens.brace_right,":":ct.tokens.colon,",":ct.tokens.comma,"(":ct.tokens.paren_left,")":ct.tokens.paren_right,";":ct.tokens.semicolon},ye.literalTokens={"&":ct.tokens.and,"&&":ct.tokens.and_and,"->":ct.tokens.arrow,"/":ct.tokens.forward_slash,"!":ct.tokens.bang,"[":ct.tokens.bracket_left,"]":ct.tokens.bracket_right,"=":ct.tokens.equal,"==":ct.tokens.equal_equal,"!=":ct.tokens.not_equal,">":ct.tokens.greater_than,">=":ct.tokens.greater_than_equal,">>":ct.tokens.shift_right,"<":ct.tokens.less_than,"<=":ct.tokens.less_than_equal,"<<":ct.tokens.shift_left,"%":ct.tokens.modulo,"-":ct.tokens.minus,"--":ct.tokens.minus_minus,".":ct.tokens.period,"+":ct.tokens.plus,"++":ct.tokens.plus_plus,"|":ct.tokens.or,"||":ct.tokens.or_or,"*":ct.tokens.star,"~":ct.tokens.tilde,_:ct.tokens.underscore,"^":ct.tokens.xor,"+=":ct.tokens.plus_equal,"-=":ct.tokens.minus_equal,"*=":ct.tokens.times_equal,"/=":ct.tokens.division_equal,"%=":ct.tokens.modulo_equal,"&=":ct.tokens.and_equal,"|=":ct.tokens.or_equal,"^=":ct.tokens.xor_equal,">>=":ct.tokens.shift_right_equal,"<<=":ct.tokens.shift_left_equal},ye.regexTokens={decimal_float_literal:ct.tokens.decimal_float_literal,hex_float_literal:ct.tokens.hex_float_literal,int_literal:ct.tokens.int_literal,uint_literal:ct.tokens.uint_literal,ident:ct.tokens.ident},ye.storage_class=[ct.keywords.function,ct.keywords.private,ct.keywords.workgroup,ct.keywords.uniform,ct.keywords.storage],ye.access_mode=[ct.keywords.read,ct.keywords.write,ct.keywords.read_write],ye.sampler_type=[ct.keywords.sampler,ct.keywords.sampler_comparison],ye.sampled_texture_type=[ct.keywords.texture_1d,ct.keywords.texture_2d,ct.keywords.texture_2d_array,ct.keywords.texture_3d,ct.keywords.texture_cube,ct.keywords.texture_cube_array],ye.multisampled_texture_type=[ct.keywords.texture_multisampled_2d],ye.storage_texture_type=[ct.keywords.texture_storage_1d,ct.keywords.texture_storage_2d,ct.keywords.texture_storage_2d_array,ct.keywords.texture_storage_3d],ye.depth_texture_type=[ct.keywords.texture_depth_2d,ct.keywords.texture_depth_2d_array,ct.keywords.texture_depth_cube,ct.keywords.texture_depth_cube_array,ct.keywords.texture_depth_multisampled_2d],ye.texture_external_type=[ct.keywords.texture_external],ye.any_texture_type=[...ct.sampled_texture_type,...ct.multisampled_texture_type,...ct.storage_texture_type,...ct.depth_texture_type,...ct.texture_external_type],ye.texel_format=[ct.keywords.r8unorm,ct.keywords.r8snorm,ct.keywords.r8uint,ct.keywords.r8sint,ct.keywords.r16uint,ct.keywords.r16sint,ct.keywords.r16float,ct.keywords.rg8unorm,ct.keywords.rg8snorm,ct.keywords.rg8uint,ct.keywords.rg8sint,ct.keywords.r32uint,ct.keywords.r32sint,ct.keywords.r32float,ct.keywords.rg16uint,ct.keywords.rg16sint,ct.keywords.rg16float,ct.keywords.rgba8unorm,ct.keywords.rgba8unorm_srgb,ct.keywords.rgba8snorm,ct.keywords.rgba8uint,ct.keywords.rgba8sint,ct.keywords.bgra8unorm,ct.keywords.bgra8unorm_srgb,ct.keywords.rgb10a2unorm,ct.keywords.rg11b10float,ct.keywords.rg32uint,ct.keywords.rg32sint,ct.keywords.rg32float,ct.keywords.rgba16uint,ct.keywords.rgba16sint,ct.keywords.rgba16float,ct.keywords.rgba32uint,ct.keywords.rgba32sint,ct.keywords.rgba32float],ye.const_literal=[ct.tokens.int_literal,ct.tokens.uint_literal,ct.tokens.decimal_float_literal,ct.tokens.hex_float_literal,ct.keywords.true,ct.keywords.false],ye.literal_or_ident=[ct.tokens.ident,ct.tokens.int_literal,ct.tokens.uint_literal,ct.tokens.decimal_float_literal,ct.tokens.hex_float_literal,ct.tokens.name],ye.element_count_expression=[ct.tokens.int_literal,ct.tokens.uint_literal,ct.tokens.ident],ye.template_types=[ct.keywords.vec2,ct.keywords.vec3,ct.keywords.vec4,ct.keywords.mat2x2,ct.keywords.mat2x3,ct.keywords.mat2x4,ct.keywords.mat3x2,ct.keywords.mat3x3,ct.keywords.mat3x4,ct.keywords.mat4x2,ct.keywords.mat4x3,ct.keywords.mat4x4,ct.keywords.atomic,ct.keywords.bitcast,...ct.any_texture_type],ye.attribute_name=[ct.tokens.ident,ct.keywords.block,ct.keywords.diagnostic],ye.assignment_operators=[ct.tokens.equal,ct.tokens.plus_equal,ct.tokens.minus_equal,ct.tokens.times_equal,ct.tokens.division_equal,ct.tokens.modulo_equal,ct.tokens.and_equal,ct.tokens.or_equal,ct.tokens.xor_equal,ct.tokens.shift_right_equal,ct.tokens.shift_left_equal],ye.increment_operators=[ct.tokens.plus_plus,ct.tokens.minus_minus];class MS{constructor(e,t,n,s,l){this.type=e,this.lexeme=t,this.line=n,this.start=s,this.end=l}toString(){return this.lexeme}isTemplateType(){return ye.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ye.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class q9{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new MS(ye.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const t=ye.simpleTokens[e];if(t)return this._addToken(t),!0;let n=ye.none;const s=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(s){const c=ye.keywords[e];if(c)return this._addToken(c),!0}if(s||l)return this._addToken(ye.tokens.ident),!0;for(;;){let c=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ye.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ye.tokens.minus_minus),!0;const g=this._tokens.length-1;if((ye.literal_or_ident.indexOf(this._tokens[g].type)!=-1||this._tokens[g].type==ye.tokens.paren_right)&&a!=">")return this._addToken(c),!0}if(e==">"&&(a==">"||a=="=")){let g=!1,v=this._tokens.length-1;for(let w=0;w<5&&v>=0&&ye.assignment_operators.indexOf(this._tokens[v].type)===-1;++w,--v)if(this._tokens[v].type===ye.tokens.less_than){v>0&&this._tokens[v-1].isArrayOrTemplateType()&&(g=!0);break}if(g)return this._addToken(c),!0}if(c===ye.none){let g=e,v=0;const w=2;for(let P=0;P<w;++P)if(g+=this._peekAhead(P),c=this._findType(g),c!==ye.none){v=P;break}if(c===ye.none)return n!==ye.none&&(this._current--,this._addToken(n),!0);e=g,this._current+=v+1}if(n=c,this._isAtEnd())break;e+=this._advance()}return n!==ye.none&&(this._addToken(n),!0)}_findType(e){for(const n in ye.regexTokens){const s=ye.regexTokens[n];if(this._match(e,s.rule))return s}return ye.literalTokens[e]||ye.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new MS(e,t,this._line,this._start,this._current))}}function vr(r){return Array.isArray(r)||r?.buffer instanceof ArrayBuffer}const ey=new Float32Array(1),G9=new Uint32Array(ey.buffer),Y9=new Uint32Array(ey.buffer),ty=new Int32Array(1),K9=new Float32Array(ty.buffer),Q9=new Uint32Array(ty.buffer),ry=new Uint32Array(1),J9=new Float32Array(ry.buffer),e$=new Int32Array(ry.buffer);function kS(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return ey[0]=r,G9[0];if(t==="u32")return ey[0]=r,Y9[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return ty[0]=r,K9[0];if(t==="u32")return ty[0]=r,Q9[0]}else if(e==="u32"){if(t==="f32")return ry[0]=r,J9[0];if(t==="i32"||t==="x32")return ry[0]=r,e$[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}class t${constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Gm{constructor(e,t){this.align=e,this.size=t}}class va{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new L9,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Zp&&this._functions.set(t.name,new t$(t));for(const t of e)if(t instanceof Ka){const n=this.getTypeInfo(t,null);n instanceof ec&&this.structs.push(n)}for(const t of e)if(t instanceof Tw)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof xw){const n=t,s=this._getAttributeNum(n.attributes,"id",0),l=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new O9(n.name,l,n.attributes,s));continue}if(this._isUniformVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),a=new qm(n.name,c,s,l,n.attributes,Yl.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(c),g=new qm(n.name,c,s,l,n.attributes,a?Yl.StorageTexture:Yl.Storage,n.access);g.access||(g.access="read"),this.storage.push(g);continue}if(this._isTextureVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(c),g=new qm(n.name,c,s,l,n.attributes,a?Yl.StorageTexture:Yl.Texture,n.access);g.access||(g.access="read"),a?this.storage.push(g):this.textures.push(g);continue}if(this._isSamplerVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),a=new qm(n.name,c,s,l,n.attributes,Yl.Sampler,n.access);this.samplers.push(a);continue}}for(const t of e)if(t instanceof Zp){const n=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),l=this._getAttribute(t,"compute"),c=n||s||l,a=new N9(t.name,c?.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,c&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!c),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[c.name].push(a)),a.arguments=t.args.map(g=>new F9(g.name,this.getTypeInfo(g.type,g.attributes),g.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var s,l,c;if(n instanceof fC){if(n.value)if(vr(n.value))for(const a of n.value)for(const g of this.overrides)a===g.name&&((s=t.info)===null||s===void 0||s.overrides.push(g));else for(const a of this.overrides)n.value===a.name&&((l=t.info)===null||l===void 0||l.overrides.push(a))}else if(n instanceof Js)for(const a of this.overrides)n.name===a.name&&((c=t.info)===null||c===void 0||c.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const s of e.calls){const l=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;l&&t.add(l)}}findResource(e,t,n){if(n){for(const s of this.entry.compute)if(s.name===n){for(const l of s.resources)if(l.group==e&&l.binding==t)return l}for(const s of this.entry.vertex)if(s.name===n){for(const l of s.resources)if(l.group==e&&l.binding==t)return l}for(const s of this.entry.fragment)if(s.name===n){for(const l of s.resources)if(l.group==e&&l.binding==t)return l}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],s=this,l=[];return e.search(c=>{if(c instanceof Q_)l.push({});else if(c instanceof J_)l.pop();else if(c instanceof el){const a=c;t&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(c instanceof ga){const a=c;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(c instanceof Pp){const a=c;t&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(c instanceof Js){const a=c;if(l.length>0&&l[l.length-1][a.name])return;const g=s._findResource(a.name);g&&n.push(g)}else if(c instanceof Sw){const a=c,g=s._functions.get(a.name);g&&(t&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=s._findResources(g.node,t)),n.push(...g.resources))}else if(c instanceof ww){const a=c,g=s._functions.get(a.name);g&&(t&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=s._findResources(g.node,t)),n.push(...g.resources))}}),[...new Map(n.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function t(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Ka)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Ka)this._getStructOutputs(n.type,t);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const l=this.getTypeInfo(n.type,n.type.attributes),c=this._parseInt(s.value),a=new ES(n.name,l,s.name,c);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new ES("",n,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof Ka)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Ka)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),l=this._parseInt(t.value),c=new D9(e.name,s,t.name,l);return n!==null&&(c.interpolation=this._parseString(n.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new k9(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof v_){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,l=new Fx(e.name,s,t);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof Ip){const s=e,l=s.format?this.getTypeInfo(s.format,s.attributes):null,c=new ic(s.name,t);return c.format=l,c.count=s.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Ka){const s=e,l=new ec(s.name,t);l.startLine=s.startLine,l.endLine=s.endLine;for(const c of s.members){const a=this.getTypeInfo(c.type,c.attributes);l.members.push(new AS(c.name,a,c.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof fp){const s=e,l=s.format instanceof Nt,c=s.format?l?this.getTypeInfo(s.format,null):new xo(s.format,null):null,a=new fu(s.name,c,t,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof st){const s=e,l=s.format?this.getTypeInfo(s.format,null):null,c=new fu(s.name,l,t,s.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const n=new xo(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,s;const l=this._getTypeSize(e);if(e.size=(t=l?.size)!==null&&t!==void 0?t:0,e instanceof ic&&e.format){const c=this._getTypeSize(e.format);e.stride=Math.max((n=c?.size)!==null&&n!==void 0?n:0,(s=c?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Fx&&this._updateTypeInfo(e.format),e instanceof ec&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,s=0,l=0,c=0;for(let a=0,g=e.members.length;a<g;++a){const v=e.members[a],w=this._getTypeSize(v);if(!w)continue;(t=this._getAlias(v.type.name))!==null&&t!==void 0||v.type;const P=w.align,I=w.size;n=this._roundUp(P,n+s),s=I,l=n,c=Math.max(c,P),v.offset=n,v.size=I,this._updateTypeInfo(v.type)}e.size=this._roundUp(c,l+s),e.align=c}_getTypeSize(e){var t,n;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof AS&&(e=e.type),e instanceof xo){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=va._typeInfo[e.name];if(c!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Gm(Math.max(l,c.align/a),Math.max(s,c.size/a))}}{const c=va._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const a=e.name[e.name.length-1]==="h"?2:1;return new Gm(Math.max(l,c.align/a),Math.max(s,c.size/a))}}if(e instanceof ic){let c=e,a=8,g=8;const v=this._getTypeSize(c.format);return v!==null&&(g=v.size,a=v.align),g=c.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,g)),s&&(g=s),new Gm(Math.max(l,a),Math.max(s,g))}if(e instanceof ec){let c=0,a=0,g=0,v=0,w=0;for(const P of e.members){const I=this._getTypeSize(P.type);I!==null&&(c=Math.max(I.align,c),g=this._roundUp(I.align,g+v),v=I.size,w=g)}return a=this._roundUp(c,w+v),new Gm(Math.max(l,c),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof el&&e.storage=="uniform"}_isStorageVar(e){return e instanceof el&&e.storage=="storage"}_isTextureVar(e){return e instanceof el&&e.type!==null&&va._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof el&&e.type!==null&&va._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let l of s)if(l.name==t)return l;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let s of e)if(s.name==t){let l=s!==null&&s.value!==null?s.value:n;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}va._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},va._textureTypes=ye.any_texture_type.map(r=>r.name),va._samplerTypes=ye.sampler_type.map(r=>r.name);let Aw=0;class Ew{constructor(e,t,n){this.id=Aw++,this.name=e,this.value=t,this.node=n}clone(){return new Ew(this.name,this.value,this.node)}}class Pw{constructor(e){this.id=Aw++,this.name=e.name,this.node=e}clone(){return new Pw(this.node)}}class Iw{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Aw++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new Ew(e,t,n??null))}setVariable(e,t,n){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n?.value)!==null&&t!==void 0?t:null}clone(){return new Iw(this)}}class r${evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class n${constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let s=!0;if(n instanceof Ie)return n.data.forEach(l=>{l||(s=!1)}),new Qe(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie){const s=n.data.some(l=>l);return new Qe(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Qe))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.evalExpression(n,t);if(s instanceof Ti&&s.typeInfo.size===0){const l=s.typeInfo,c=s.buffer.byteLength/l.stride;return new Qe(c,this.getTypeInfo("u32"))}return new Qe(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.abs(l)),n.typeInfo);const s=n;return new Qe(Math.abs(s.value),s.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.acos(l)),n.typeInfo);const s=n;return new Qe(Math.acos(s.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.acosh(l)),n.typeInfo);const s=n;return new Qe(Math.acosh(s.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.asin(l)),n.typeInfo);const s=n;return new Qe(Math.asin(s.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.asinh(l)),n.typeInfo);const s=n;return new Qe(Math.asinh(s.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.atan(l)),n.typeInfo);const s=n;return new Qe(Math.atan(s.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.atanh(l)),n.typeInfo);const s=n;return new Qe(Math.atanh(s.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((a,g)=>Math.atan2(a,s.data[g])),n.typeInfo);const l=n,c=s;return new Qe(Math.atan2(l.value,c.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.ceil(l)),n.typeInfo);const s=n;return new Qe(Math.ceil(s.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof Ie&&s instanceof Ie&&l instanceof Ie)return new Ie(n.data.map((v,w)=>this._clamp(v,s.data[w],l.data[w])),n.typeInfo);const c=n,a=s,g=l;return new Qe(this._clamp(c.value,a.value,g.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.cos(l)),n.typeInfo);const s=n;return new Qe(Math.cos(s.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.cosh(l)),n.typeInfo);const s=n;return new Qe(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.clz32(l)),n.typeInfo);const s=n;return new Qe(Math.clz32(s.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>this._countOneBits(l)),n.typeInfo);const s=n;return new Qe(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>this._countTrailingZeros(l)),n.typeInfo);const s=n;return new Qe(this._countTrailingZeros(s.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie){if(n.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const l=n.data,c=s.data;return new Ie([l[1]*c[2]-c[1]*l[2],l[2]*c[0]-c[2]*l[0],l[0]*c[1]-c[0]*l[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return n instanceof Ie?new Ie(n.data.map(l=>l*s),n.typeInfo):new Qe(n.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Xr){const s=n.data,l=n.typeInfo.getTypeName(),c=l.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(l==="mat2x2"||l==="mat2x2f"||l==="mat2x2h")return new Qe(s[0]*s[3]-s[1]*s[2],c);if(l==="mat2x3"||l==="mat2x3f"||l==="mat2x3h")return new Qe(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),c);if(l==="mat2x4"||l==="mat2x4f"||l==="mat2x4h")console.error(`TODO: Determinant for ${l}`);else if(l==="mat3x2"||l==="mat3x2f"||l==="mat3x2h")console.error(`TODO: Determinant for ${l}`);else{if(l==="mat3x3"||l==="mat3x3f"||l==="mat3x3h")return new Qe(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),c);l==="mat3x4"||l==="mat3x4f"||l==="mat3x4h"||l==="mat4x2"||l==="mat4x2f"||l==="mat4x2h"||l==="mat4x3"||l==="mat4x3f"||l==="mat4x3h"?console.error(`TODO: Determinant for ${l}`):l!=="mat4x4"&&l!=="mat4x4f"&&l!=="mat4x4h"||console.error(`TODO: Determinant for ${l}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie){let a=0;for(let g=0;g<n.data.length;++g)a+=(n.data[g]-s.data[g])*(n.data[g]-s.data[g]);return new Qe(Math.sqrt(a),this.getTypeInfo("f32"))}const l=n,c=s;return new Qe(Math.abs(l.value-c.value),n.typeInfo)}_dot(e,t){let n=0;for(let s=0;s<e.length;++s)n+=t[s]*e[s];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return n instanceof Ie&&s instanceof Ie?new Qe(this._dot(n.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.exp(l)),n.typeInfo);const s=n;return new Qe(Math.exp(s.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.pow(2,l)),n.typeInfo);const s=n;return new Qe(Math.pow(2,s.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const c=s.value,a=l.value;if(n instanceof Ie)return new Ie(n.data.map(v=>v>>c&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const g=n.value;return new Qe(g>>c&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof Ie&&s instanceof Ie&&l instanceof Ie){const c=this._dot(s.data,l.data);return new Ie(c<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>this._firstLeadingBit(l)),n.typeInfo);const s=n;return new Qe(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>this._firstTrailingBit(l)),n.typeInfo);const s=n;return new Qe(this._firstTrailingBit(s.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.floor(l)),n.typeInfo);const s=n;return new Qe(Math.floor(s.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof Ie&&s instanceof Ie&&l instanceof Ie)return n.data.length!==s.data.length||n.data.length!==l.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ie(n.data.map((v,w)=>v*s.data[w]+l.data[w]),n.typeInfo);const c=n,a=s,g=l;return new Qe(c.value*a.value+g.value,c.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>l-Math.floor(l)),n.typeInfo);const s=n;return new Qe(s.value-Math.floor(s.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t),c=this.exec.evalExpression(e.args[3],t);if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=l.value,g=(1<<c.value)-1<<a,v=~g;if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((I,k)=>I&v|s.data[k]<<a&g),n.typeInfo);const w=n.value,P=s.value;return new Qe(w&v|P<<a&g,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>1/Math.sqrt(l)),n.typeInfo);const s=n;return new Qe(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie){let l=0;return n.data.forEach(c=>{l+=c*c}),new Qe(Math.sqrt(l),this.getTypeInfo("f32"))}const s=n;return new Qe(Math.abs(s.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.log(l)),n.typeInfo);const s=n;return new Qe(Math.log(s.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.log2(l)),n.typeInfo);const s=n;return new Qe(Math.log2(s.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((a,g)=>Math.max(a,s.data[g])),n.typeInfo);const l=n,c=s;return new Qe(Math.max(l.value,c.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((a,g)=>Math.min(a,s.data[g])),n.typeInfo);const l=n,c=s;return new Qe(Math.min(l.value,c.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof Ie&&s instanceof Ie&&l instanceof Ie)return new Ie(n.data.map((g,v)=>n.data[v]*(1-l.data[v])+s.data[v]*l.data[v]),n.typeInfo);const c=s,a=l;return new Qe(n.value*(1-a.value)+c.value*a.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((c,a)=>c%s.data[a]),n.typeInfo);const l=s;return new Qe(n.value%l.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie){const s=this.Length(e,t).value;return new Ie(n.data.map(l=>l/s),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie)return new Ie(n.data.map((a,g)=>Math.pow(a,s.data[g])),n.typeInfo);const l=n,c=s;return new Qe(Math.pow(l.value,c.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ie?new Ie(n.data.map(s=>s),n.typeInfo):new Qe(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ie?new Ie(n.data.map(s=>s*Math.PI/180),n.typeInfo):new Qe(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof Ie&&s instanceof Ie){const l=this._dot(n.data,s.data);return new Ie(n.data.map((c,a)=>c-2*l*s.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof Ie&&s instanceof Ie&&l instanceof Qe){const c=this._dot(s.data,n.data);return new Ie(n.data.map((a,g)=>{const v=1-l.value*l.value*(1-c*c);if(v<0)return 0;const w=Math.sqrt(v);return l.value*a-(l.value*c+w)*s.data[g]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.round(l)),n.typeInfo);const s=n;return new Qe(Math.round(s.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.min(Math.max(l,0),1)),n.typeInfo);const s=n;return new Qe(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sign(l)),n.typeInfo);const s=n;return new Qe(Math.sign(s.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sin(l)),n.typeInfo);const s=n;return new Qe(Math.sin(s.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sinh(l)),n.typeInfo);const s=n;return new Qe(Math.sinh(s.value),n.typeInfo)}_smoothstep(e,t,n){const s=Math.min(Math.max((n-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(l instanceof Ie&&n instanceof Ie&&s instanceof Ie)return new Ie(l.data.map((v,w)=>this._smoothstep(n.data[w],s.data[w],v)),l.typeInfo);const c=n,a=s,g=l;return new Qe(this._smoothstep(c.value,a.value,g.value),l.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.sqrt(l)),n.typeInfo);const s=n;return new Qe(Math.sqrt(s.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof Ie&&n instanceof Ie)return new Ie(s.data.map((c,a)=>c<n.data[a]?0:1),s.typeInfo);const l=n;return new Qe(s.value<l.value?0:1,l.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.tan(l)),n.typeInfo);const s=n;return new Qe(Math.tan(s.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.tanh(l)),n.typeInfo);const s=n;return new Qe(Math.tanh(s.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof Xr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const l=n.data;return new Xr([l[0],l[2],l[1],l[3]],s)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const l=n.data;return new Xr([l[0],l[3],l[6],l[1],l[4],l[7]],s)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const l=n.data;return new Xr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13]],s)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const l=n.data;return new Xr([l[0],l[3],l[1],l[4],l[2],l[5]],s)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const l=n.data;return new Xr([l[0],l[3],l[6],l[1],l[4],l[7],l[2],l[5],l[8]],s)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const l=n.data;return new Xr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14]],s)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const l=n.data;return new Xr([l[0],l[4],l[1],l[5],l[2],l[6]],s)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const l=n.data;return new Xr([l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]],s)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const l=n.data;return new Xr([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14],l[3],l[7],l[11],l[15]],s)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ie)return new Ie(n.data.map(l=>Math.trunc(l)),n.typeInfo);const s=n;return new Qe(Math.trunc(s.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Js){const l=n.name,c=t.getVariableValue(l);if(c instanceof Qa){if(s<0||s>=c.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=c.getMipLevelSize(s),g=c.dimension;return g==="1d"?new Qe(a[0],this.getTypeInfo("u32")):g==="3d"?new Ie(a,this.getTypeInfo("vec3u")):g==="2d"?new Ie(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${g} not found. Line ${e.line}`),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),l=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof Ie)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Js){const c=n.name,a=t.getVariableValue(c);if(a instanceof Qa){const g=Math.floor(s.data[0]),v=Math.floor(s.data[1]);if(g<0||g>=a.width||v<0||v>=a.height)return console.error(`Texture ${c} out of bounds. Line ${e.line}`),null;const w=a.getPixel(g,v,0,l);return w===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ie(w,this.getTypeInfo("vec4f"))}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Js){const s=n.name,l=t.getVariableValue(s);return l instanceof Qa?new Qe(l.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Js){const s=n.name,l=t.getVariableValue(s);return l instanceof Qa?new Qe(l.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Js){const s=n.name,l=t.getVariableValue(s);return l instanceof Qa?new Qe(l.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),l=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,c=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(c.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof Ie)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Js){const a=n.name,g=t.getVariableValue(a);if(g instanceof Qa){const v=g.getMipLevelSize(0),w=Math.floor(s.data[0]),P=Math.floor(s.data[1]);return w<0||w>=v[0]||P<0||P>=v[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(g.setPixel(w,P,0,l,Array.from(c)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t);return t.getVariable(s).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t);return g instanceof Qe&&a instanceof Qe&&(g.value=a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value+=a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicSub(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value-=a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicMax(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=Math.max(g.value,a.value)),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicMin(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=Math.min(g.value,a.value)),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicAnd(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=g.value&a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicOr(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=g.value|a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicXor(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=g.value^a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicExchange(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const s=this.exec.getVariableName(n,t),l=t.getVariable(s);let c=e.args[1];const a=this.exec.evalExpression(c,t),g=l.value.getSubData(this.exec,n.postfix,t),v=new Qe(g.value,g.typeInfo);return g instanceof Qe&&a instanceof Qe&&(g.value=a.value),l.value instanceof Ti&&l.value.setDataValue(this.exec,g,n.postfix,t),v}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Sb={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Ps={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class ws extends r${constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new va,this.reflection.updateAST(this.ast),this.context=(n=t?.clone())!==null&&n!==void 0?n:new Iw,this.builtins=new n$(this),this.typeInfo={bool:this.getTypeInfo(Nt.bool),i32:this.getTypeInfo(Nt.i32),u32:this.getTypeInfo(Nt.u32),f32:this.getTypeInfo(Nt.f32),f16:this.getTypeInfo(Nt.f16),vec2f:this.getTypeInfo(st.vec2f),vec2u:this.getTypeInfo(st.vec2u),vec2i:this.getTypeInfo(st.vec2i),vec2h:this.getTypeInfo(st.vec2h),vec3f:this.getTypeInfo(st.vec3f),vec3u:this.getTypeInfo(st.vec3u),vec3i:this.getTypeInfo(st.vec3i),vec3h:this.getTypeInfo(st.vec3h),vec4f:this.getTypeInfo(st.vec4f),vec4u:this.getTypeInfo(st.vec4u),vec4i:this.getTypeInfo(st.vec4i),vec4h:this.getTypeInfo(st.vec4h),mat2x2f:this.getTypeInfo(st.mat2x2f),mat2x3f:this.getTypeInfo(st.mat2x3f),mat2x4f:this.getTypeInfo(st.mat2x4f),mat3x2f:this.getTypeInfo(st.mat3x2f),mat3x3f:this.getTypeInfo(st.mat3x3f),mat3x4f:this.getTypeInfo(st.mat3x4f),mat4x2f:this.getTypeInfo(st.mat4x2f),mat4x3f:this.getTypeInfo(st.mat4x3f),mat4x4f:this.getTypeInfo(st.mat4x4f)}}getVariableValue(e){var t,n;const s=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(s===null)return null;if(s instanceof Qe)return s.value;if(s instanceof Ie||s instanceof Xr)return Array.from(s.data);if(s instanceof Ti&&s.typeInfo instanceof ic){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,s){const l=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,l),this._execStatements(this.ast,l);const c=l.getFunction(e);if(!c)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],g=t[1],v=t[2],w=this.getTypeInfo("vec3u");l.setVariable("@num_workgroups",new Ie(t,w));const P=this.reflection.getFunctionInfo(e);P===null&&console.error(`Function ${e} not found in reflection data`);for(const I in n)for(const k in n[I]){const N=n[I][k];l.variables.forEach(D=>{var B;const U=D.node;if(U?.attributes){let V=null,L=null;for(const $ of U.attributes)$.name==="binding"?V=$.value:$.name==="group"&&(L=$.value);if(k==V&&I==L){let $=!1;for(const te of P.resources)if(te.name===D.name&&te.group===parseInt(I)&&te.binding===parseInt(k)){$=!0;break}if($)if(N.texture!==void 0&&N.descriptor!==void 0){const te=new Qa(N.texture,this.getTypeInfo(U.type),N.descriptor,(B=N.texture.view)!==null&&B!==void 0?B:null);D.value=te}else N.uniform!==void 0?D.value=new Ti(N.uniform,this.getTypeInfo(U.type)):D.value=new Ti(N,this.getTypeInfo(U.type))}}})}for(let I=0;I<v;++I)for(let k=0;k<g;++k)for(let N=0;N<a;++N)l.setVariable("@workgroup_id",new Ie([N,k,I],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(c,[N,k,I],l)}execStatement(e,t){if(e instanceof nC)return this.evalExpression(e.value,t);if(e instanceof sC){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Qe))throw new Error("Invalid break-if condition");if(!n.value)return null}return ws._breakObj}if(e instanceof oC)return ws._continueObj;if(e instanceof Pp)this._let(e,t);else if(e instanceof el)this._var(e,t);else if(e instanceof y_)this._const(e,t);else if(e instanceof Zp)this._function(e,t);else{if(e instanceof rC)return this._if(e,t);if(e instanceof tC)return this._switch(e,t);if(e instanceof KI)return this._for(e,t);if(e instanceof YI)return this._while(e,t);if(e instanceof eC)return this._loop(e,t);if(e instanceof Nx){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof JI)this._assign(e,t);else if(e instanceof QI)this._increment(e,t);else{if(e instanceof Ka)return null;if(e instanceof xw){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new Qe(0,this.getTypeInfo("u32")))}else if(e instanceof ww)this._call(e,t);else{if(e instanceof iC||e instanceof Tw)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Uo?this._evalBinaryOp(e,t):e instanceof Yi?this._evalLiteral(e,t):e instanceof Js?this._evalVariable(e,t):e instanceof Sw?this._evalCall(e,t):e instanceof ga?this._evalCreate(e,t):e instanceof aC?this._evalConst(e,t):e instanceof lC?this._evalBitcast(e,t):e instanceof ji?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Nt){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const s=e[n],l=this.reflection.getOverrideInfo(n);l!==null?(l.type===null&&(l.type=this.getTypeInfo("u32")),l.type.name==="u32"||l.type.name==="i32"||l.type.name==="f32"||l.type.name==="f16"?t.setVariable(n,new Qe(s,l.type)):l.type.name==="bool"?t.setVariable(n,new Qe(s?1:0,l.type)):l.type.name==="vec2"||l.type.name==="vec3"||l.type.name==="vec4"||l.type.name==="vec2f"||l.type.name==="vec3f"||l.type.name==="vec4f"||l.type.name==="vec2i"||l.type.name==="vec3i"||l.type.name==="vec4i"||l.type.name==="vec2u"||l.type.name==="vec3u"||l.type.name==="vec4u"||l.type.name==="vec2h"||l.type.name==="vec3h"||l.type.name==="vec4h"?t.setVariable(n,new Ie(s,l.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const s=[1,1,1];for(const w of e.node.attributes)if(w.name==="workgroup_size"){if(w.value.length>0){const P=n.getVariableValue(w.value[0]);s[0]=P instanceof Qe?P.value:parseInt(w.value[0])}if(w.value.length>1){const P=n.getVariableValue(w.value[1]);s[1]=P instanceof Qe?P.value:parseInt(w.value[1])}if(w.value.length>2){const P=n.getVariableValue(w.value[2]);s[2]=P instanceof Qe?P.value:parseInt(w.value[2])}}const l=this.getTypeInfo("vec3u"),c=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ie(s,l));const a=s[0],g=s[1],v=s[2];for(let w=0,P=0;w<v;++w)for(let I=0;I<g;++I)for(let k=0;k<a;++k,++P){const N=[k,I,w],D=[k+t[0]*s[0],I+t[1]*s[1],w+t[2]*s[2]];n.setVariable("@local_invocation_id",new Ie(N,l)),n.setVariable("@global_invocation_id",new Ie(D,l)),n.setVariable("@local_invocation_index",new Qe(P,c)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const s of n.attributes)if(s.name==="builtin"){const l=`@${s.value}`,c=t.getVariable(l);c!==void 0&&t.variables.set(n.name,c)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ji;)e=e.right;return e instanceof Js?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const l=t.clone(),c=this._execStatements(n,l);if(c)return c;continue}const s=this.execStatement(n,t);if(s)return s}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let l=0;l<s.node.args.length;++l){const c=s.node.args[l],a=this.evalExpression(e.args[l],n);n.setVariable(c.name,a,c)}this._execStatements(s.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),s=t.getVariable(n);s?e.operator==="++"?s.value instanceof Qe?s.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof Qe?s.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Js){const n=this.getVariableName(e,t),s=t.getVariable(n);return s===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof ji){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof jh?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new jh(n)}}return null}_assign(e,t){let n=null,s="<var>",l=null;if(e.variable instanceof ji){const g=this._getVariableData(e.variable,t),v=this.evalExpression(e.value,t),w=e.operator;if(w==="="){if(g instanceof Qe||g instanceof Ie||g instanceof Xr){if(v instanceof Qe||v instanceof Ie||v instanceof Xr&&g.data.length===v.data.length)return void g.data.set(v.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(g instanceof Ti&&v instanceof Ti&&g.buffer.byteLength-g.offset>=v.buffer.byteLength-v.offset)return void(g.buffer.byteLength%4==0?new Uint32Array(g.buffer,g.offset,g.typeInfo.size/4).set(new Uint32Array(v.buffer,v.offset,v.typeInfo.size/4)):new Uint8Array(g.buffer,g.offset,g.typeInfo.size).set(new Uint8Array(v.buffer,v.offset,v.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(w==="+=")return g instanceof Qe||g instanceof Ie||g instanceof Xr?v instanceof Qe||v instanceof Ie||v instanceof Xr?void g.data.set(v.data.map((P,I)=>g.data[I]+P)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(w==="-=")return(g instanceof Qe||g instanceof Ie||g instanceof Xr)&&(v instanceof Qe||v instanceof Ie||v instanceof Xr)?void g.data.set(v.data.map((P,I)=>g.data[I]-P)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ji){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const g=t.getVariable(s);if(!(g&&g.value instanceof jh))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);n=g.value.reference;let v=e.variable.postfix;if(!v){let w=e.variable.right;for(;w instanceof ji;){if(w.postfix){v=w.postfix;break}w=w.right}}v&&(n=n.getSubData(this,v,t))}}else{l=e.variable.postfix,s=this.getVariableName(e.variable,t);const g=t.getVariable(s);if(g===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);n=g.value}if(n instanceof jh&&(n=n.reference),n===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const c=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){const g=n.getSubData(this,l,t);if(g instanceof Ie&&c instanceof Qe){const v=g.data,w=c.value;if(a==="+=")for(let P=0;P<v.length;++P)v[P]+=w;else if(a==="-=")for(let P=0;P<v.length;++P)v[P]-=w;else if(a==="*=")for(let P=0;P<v.length;++P)v[P]*=w;else if(a==="/=")for(let P=0;P<v.length;++P)v[P]/=w;else if(a==="%=")for(let P=0;P<v.length;++P)v[P]%=w;else if(a==="&=")for(let P=0;P<v.length;++P)v[P]&=w;else if(a==="|=")for(let P=0;P<v.length;++P)v[P]|=w;else if(a==="^=")for(let P=0;P<v.length;++P)v[P]^=w;else if(a==="<<=")for(let P=0;P<v.length;++P)v[P]<<=w;else if(a===">>=")for(let P=0;P<v.length;++P)v[P]>>=w;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(g instanceof Ie&&c instanceof Ie){const v=g.data,w=c.data;if(v.length!==w.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let P=0;P<v.length;++P)v[P]+=w[P];else if(a==="-=")for(let P=0;P<v.length;++P)v[P]-=w[P];else if(a==="*=")for(let P=0;P<v.length;++P)v[P]*=w[P];else if(a==="/=")for(let P=0;P<v.length;++P)v[P]/=w[P];else if(a==="%=")for(let P=0;P<v.length;++P)v[P]%=w[P];else if(a==="&=")for(let P=0;P<v.length;++P)v[P]&=w[P];else if(a==="|=")for(let P=0;P<v.length;++P)v[P]|=w[P];else if(a==="^=")for(let P=0;P<v.length;++P)v[P]^=w[P];else if(a==="<<=")for(let P=0;P<v.length;++P)v[P]<<=w[P];else if(a===">>=")for(let P=0;P<v.length;++P)v[P]>>=w[P];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(g instanceof Qe&&c instanceof Qe))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?g.value+=c.value:a==="-="?g.value-=c.value:a==="*="?g.value*=c.value:a==="/="?g.value/=c.value:a==="%="?g.value%=c.value:a==="&="?g.value&=c.value:a==="|="?g.value|=c.value:a==="^="?g.value^=c.value:a==="<<="?g.value<<=c.value:a===">>="?g.value>>=c.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(n instanceof Ti&&n.setDataValue(this,g,l,t))}if(n instanceof Ti)n.setDataValue(this,c,l,t);else if(l){if(!(n instanceof Ie||n instanceof Xr))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(l instanceof pd){const g=this.evalExpression(l.index,t).value;if(n instanceof Ie){if(!(c instanceof Qe))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[g]=c.value}else{if(!(n instanceof Xr))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const v=this.evalExpression(l.index,t).value;if(v<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(c instanceof Ie))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const w=n.typeInfo.getTypeName();if(w==="mat2x2"||w==="mat2x2f"||w==="mat2x2h"){if(!(v<2&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat2x3"||w==="mat2x3f"||w==="mat2x3h"){if(!(v<2&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else if(w==="mat2x4"||w==="mat2x4f"||w==="mat2x4h"){if(!(v<2&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}else if(w==="mat3x2"||w==="mat3x2f"||w==="mat3x2h"){if(!(v<3&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat3x3"||w==="mat3x3f"||w==="mat3x3h"){if(!(v<3&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else if(w==="mat3x4"||w==="mat3x4f"||w==="mat3x4h"){if(!(v<3&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}else if(w==="mat4x2"||w==="mat4x2f"||w==="mat4x2h"){if(!(v<4&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat4x3"||w==="mat4x3f"||w==="mat4x3h"){if(!(v<4&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else{if(w!=="mat4x4"&&w!=="mat4x4f"&&w!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(v<4&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}}}}}else if(l instanceof pu){const g=l.value;if(!(n instanceof Ie))return void console.error(`Invalid assignment to ${g}. Variable ${s} is not a vector. Line ${e.line}`);if(c instanceof Qe){if(g.length>1)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);if(g==="x")n.data[0]=c.value;else if(g==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);n.data[1]=c.value}else if(g==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);n.data[2]=c.value}else if(g==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);n.data[3]=c.value}}else{if(!(c instanceof Ie))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(g.length!==c.data.length)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);for(let v=0;v<g.length;++v){const w=g[v];if(w==="x"||w==="r")n.data[0]=c.data[v];else if(w==="y"||w==="g"){if(c.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[1]=c.data[v]}else if(w==="z"||w==="b"){if(c.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[2]=c.data[v]}else{if(w!=="w"&&w!=="a")return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);if(c.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[3]=c.data[v]}}}}}else n instanceof Qe&&c instanceof Qe?n.value=c.value:n instanceof Ie&&c instanceof Ie||n instanceof Xr&&c instanceof Xr?n.data.set(c.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const n=new Pw(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ji||(n=n.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const l=new ga(e.type,[]);n=this._evalCreate(l,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ji||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Ip||e.type instanceof Ka||e.type instanceof st){const l=new ga(e.type,[]);n=this._evalCreate(l,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Qe))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const l of e.cases)if(l instanceof hC)for(const c of l.selectors){if(c instanceof b_){s=l;continue}const a=this.evalExpression(c,t);if(!(a instanceof Qe))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===n.value)return this._execStatements(l.body,t)}else l instanceof dC&&(s=l);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Qe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const s of e.elseif){const l=this.evalExpression(s.condition,t);if(!(l instanceof Qe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(l.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Qe?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ws._breakObj)break;if(n!==null&&n!==ws._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===ws._breakObj)break;if(n===ws._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===ws._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ws._breakObj)break;if(n!==ws._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),s=e.type;if(n instanceof Qe){const l=kS(n.value,n.typeInfo.name,s.name);return new Qe(l,this.getTypeInfo(s))}if(n instanceof Ie){const l=n.typeInfo.getTypeName();let c="";if(l.endsWith("f"))c="f32";else if(l.endsWith("i"))c="i32";else if(l.endsWith("u"))c="u32";else if(l.endsWith("b"))c="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;c="f16"}const a=s.getTypeName();let g="";if(a.endsWith("f"))g="f32";else if(a.endsWith("i"))g="i32";else if(a.endsWith("u"))g="u32";else if(a.endsWith("b"))g="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${g}. Line ${e.line}`),null;g="f16"}const v=(function(w,P,I){if(P===I)return w;const k=new Array(w.length);for(let N=0;N<w.length;N++)k[N]=kS(w[N],P,I);return k})(Array.from(n.data),c,g);return new Ie(v,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof ga){if(e.type===null)return Lx.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof ga?e.type.name:e.name,l=e instanceof ga?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(l===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(l.size===0)return null;const c=new Ti(new ArrayBuffer(l.size),l,0);if(l instanceof ec){if(e.args)for(let a=0;a<e.args.length;++a){const g=l.members[a],v=e.args[a],w=this.evalExpression(v,t);c.setData(this,w,g.type,g.offset,t)}}else if(l instanceof ic){let a=0;if(e.args)for(let g=0;g<e.args.length;++g){const v=e.args[g],w=this.evalExpression(v,t);l.format===null&&(((n=w.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?l.format=this.getTypeInfo("i32"):l.format=w.typeInfo),c.setData(this,w,l.format,a,t),a+=l.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof ga?c.getSubData(this,e.postfix,t):c}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),s=n.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new Qe(e.scalarValue,n):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=ws._priority.get(t.name);ws._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new jh(n);if(e.operator==="*")return n instanceof jh?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=n instanceof Qe?n.value:n instanceof Ie?Array.from(n.data):null;switch(e.operator){case"+":{if(vr(s)){const a=s.map((g,v)=>+g);return new Ie(a,n.typeInfo)}const l=s,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Qe(+l,c)}case"-":{if(vr(s)){const a=s.map((g,v)=>-g);return new Ie(a,n.typeInfo)}const l=s,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Qe(-l,c)}case"!":{if(vr(s)){const a=s.map((g,v)=>g?0:1);return new Ie(a,n.typeInfo)}const l=s,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Qe(l?0:1,c)}case"~":{if(vr(s)){const a=s.map((g,v)=>~g);return new Ie(a,n.typeInfo)}const l=s,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Qe(~l,c)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),l=n instanceof Qe?n.value:n instanceof Ie||n instanceof Xr?Array.from(n.data):null,c=s instanceof Qe?s.value:s instanceof Ie||s instanceof Xr?Array.from(s.data):null;switch(e.operator){case"+":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k+P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I+w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w+I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a+g,v)}case"-":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k-P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I-w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w-I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a-g,v)}case"*":{if(vr(l)&&vr(c)){const w=l,P=c;if(n instanceof Xr&&s instanceof Xr){const I=(function(B,U,V,L){if(Ps[U.name]===void 0||Ps[L.name]===void 0)return null;const $=Ps[U.name][0],te=Ps[U.name][1],G=Ps[L.name][0];if($!==Ps[L.name][1])return null;const le=new Array(G*te);for(let se=0;se<te;se++)for(let oe=0;oe<G;oe++){let be=0;for(let xe=0;xe<$;xe++)be+=B[xe*te+se]*V[oe*$+xe];le[se*G+oe]=be}return le})(w,n.typeInfo,P,s.typeInfo);if(I===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const k=Ps[s.typeInfo.name][0],N=Ps[n.typeInfo.name][1],D=this.getTypeInfo(`mat${k}x${N}f`);return new Xr(I,D)}if(n instanceof Xr&&s instanceof Ie){const I=(function(k,N,D,B){if(Ps[N.name]===void 0||Sb[B.name]===void 0)return null;const U=Ps[N.name][0],V=Ps[N.name][1];if(U!==D.length)return null;const L=new Array(V);for(let $=0;$<V;$++){let te=0;for(let G=0;G<U;G++)te+=k[G*V+$]*D[G];L[$]=te}return L})(w,n.typeInfo,P,s.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ie(I,s.typeInfo)}if(n instanceof Ie&&s instanceof Xr){const I=(function(k,N,D,B){if(Sb[N.name]===void 0||Ps[B.name]===void 0)return null;const U=Ps[B.name][0],V=Ps[B.name][1];if(V!==k.length)return null;const L=[];for(let $=0;$<U;$++){let te=0;for(let G=0;G<V;G++)te+=k[G]*D[G*U+$];L[$]=te}return L})(w,n.typeInfo,P,s.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ie(I,n.typeInfo)}{if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k*P[N]);return new Ie(I,n.typeInfo)}}if(vr(l)){const w=c,P=l.map((I,k)=>I*w);return n instanceof Xr?new Xr(P,n.typeInfo):new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w*I);return s instanceof Xr?new Xr(P,s.typeInfo):new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a*g,v)}case"%":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k%P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I%w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w%I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a%g,v)}case"/":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k/P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I/w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w/I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a/g,v)}case"&":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k&P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I&w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w&I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a&g,v)}case"|":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k|P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I|w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w|I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a|g,v)}case"^":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k^P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I^w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w^I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a^g,v)}case"<<":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k<<P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I<<w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w<<I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a<<g,v)}case">>":{if(vr(l)&&vr(c)){const w=l,P=c;if(w.length!==P.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,N)=>k>>P[N]);return new Ie(I,n.typeInfo)}if(vr(l)){const w=c,P=l.map((I,k)=>I>>w);return new Ie(P,n.typeInfo)}if(vr(c)){const w=l,P=c.map((I,k)=>w>>I);return new Ie(P,s.typeInfo)}const a=l,g=c,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Qe(a>>g,v)}case">":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w>g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v>a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a>v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l>c?1:0,this.getTypeInfo("bool"));case"<":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w<g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v<a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a<v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l<c?1:0,this.getTypeInfo("bool"));case"==":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w===g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v==a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a==v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l===c?1:0,this.getTypeInfo("bool"));case"!=":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w!==g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v!==a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a!==v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l!==c?1:0,this.getTypeInfo("bool"));case">=":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w>=g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v>=a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a>=v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l>=c?1:0,this.getTypeInfo("bool"));case"<=":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w<=g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v<=a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a<=v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l<=c?1:0,this.getTypeInfo("bool"));case"&&":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w&&g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v&&a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a&&v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l&&c?1:0,this.getTypeInfo("bool"));case"||":if(vr(l)&&vr(c)){const a=l,g=c;if(a.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=a.map((w,P)=>w||g[P]?1:0);return new Ie(v,n.typeInfo)}if(vr(l)){const a=c,g=l.map((v,w)=>v||a?1:0);return new Ie(g,n.typeInfo)}if(vr(c)){const a=l,g=c.map((v,w)=>a||v?1:0);return new Ie(g,s.typeInfo)}return new Qe(l||c?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let l=0;l<s.node.args.length;++l){const c=s.node.args[l],a=this.evalExpression(e.args[l],n);n.createVariable(c.name,a,c)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const s=t.clone();for(let l=0;l<n.node.args.length;++l){const c=n.node.args[l],a=this.evalExpression(e.args[l],s);s.setVariable(c.name,a,c)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Qe(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),l=Sb[s];if(l===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const c=[];if(e instanceof Yi)if(e.isVector){const a=e.vectorValue;for(const g of a)c.push(g)}else c.push(e.scalarValue);else if(e.args)for(const a of e.args){const g=this.evalExpression(a,t);if(g instanceof Ie){const v=g.data;for(let w=0;w<v.length;++w){let P=v[w];c.push(P)}}else if(g instanceof Qe){let v=g.value;c.push(v)}}if(e.type instanceof st&&e.type.format===null&&(e.type.format=st.f32),c.length===0){const a=new Array(l).fill(0);return new Ie(a,n).getSubData(this,e.postfix,t)}if(c.length===1)for(;c.length<l;)c.push(c[0]);return c.length<l?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ie(c.length>l?c.slice(0,l):c,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),l=Ps[s];if(l===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const c=[];if(e instanceof Yi)if(e.isVector){const a=e.vectorValue;for(const g of a)c.push(g)}else c.push(e.scalarValue);else if(e.args)for(const a of e.args){const g=this.evalExpression(a,t);g instanceof Ie?c.push(...g.data):g instanceof Qe?c.push(g.value):g instanceof Xr&&c.push(...g.data)}if(n instanceof fu&&n.format===null&&(n.format=this.getTypeInfo("f32")),c.length===0){const a=new Array(l[2]).fill(0);return new Xr(a,n).getSubData(this,e.postfix,t)}return c.length!==l[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Xr(c,n).getSubData(this,e.postfix,t)}}ws._breakObj=new So(new xo("BREAK",null),null),ws._continueObj=new So(new xo("CONTINUE",null),null),ws._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class i${constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class s${constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new i$,this._exec=new ws,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const s=n.arrayType,l=n.countNode;if(l instanceof Js){const c=l.name,a=this._context.constants.get(c);if(a)try{const g=a.constEvaluate(this._exec);s.count=g}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(s=>{s instanceof RS||s instanceof v_?s.type=this._forwardType(s.type):s instanceof Ip?s.format=this._forwardType(s.format):s instanceof el||s instanceof Pp||s instanceof y_?s.type=this._forwardType(s.type):s instanceof Zp?s.returnType=this._forwardType(s.returnType):s instanceof CS&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof IS){const t=this._getType(e.name);if(t)return t}else e instanceof v_?e.type=this._forwardType(e.type):e instanceof Ip&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new q9(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ye.eof}_match(e){if(e instanceof et)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let s=!1;for(const l of e){if(n===l)return!0;l===ye.tokens.name&&(s=!0)}if(s){const l=ye.tokens.name.rule.exec(t.lexeme);if(l&&l.index==0&&l[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===ye.tokens.name){const n=ye.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ye.keywords.alias)){const t=this._type_alias();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ye.keywords.diagnostic)){const t=this._diagnostic();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ye.keywords.requires)){const t=this._requires_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ye.keywords.enable)){const t=this._enable_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(ye.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ye.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ye.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ye.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ye.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(ye.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(ye.keywords.fn))return null;const e=this._currentLine,t=this._consume(ye.tokens.ident,"Expected function name.").toString();this._consume(ye.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ye.tokens.paren_right))do{if(this._check(ye.tokens.paren_right))break;const a=this._attribute(),g=this._consume(ye.tokens.name,"Expected argument name.").toString();this._consume(ye.tokens.colon,"Expected ':' for argument type.");const v=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=v,n.push(this._updateNode(new CS(g,w,a))))}while(this._match(ye.tokens.comma));this._consume(ye.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(ye.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const l=this._compound_statement(),c=this._currentLine;return this._updateNode(new Zp(t,n,s,l,e,c),e)}_compound_statement(){const e=[];for(this._consume(ye.tokens.brace_left,"Expected '{' for block.");!this._check(ye.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(ye.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ye.tokens.attr)&&this._attribute(),this._check(ye.keywords.if))return this._if_statement();if(this._check(ye.keywords.switch))return this._switch_statement();if(this._check(ye.keywords.loop))return this._loop_statement();if(this._check(ye.keywords.for))return this._for_statement();if(this._check(ye.keywords.while))return this._while_statement();if(this._check(ye.keywords.continuing))return this._continuing_statement();if(this._check(ye.keywords.static_assert))return this._static_assert_statement();if(this._check(ye.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ye.keywords.return))e=this._return_statement();else if(this._check([ye.keywords.var,ye.keywords.let,ye.keywords.const]))e=this._variable_statement();else if(this._match(ye.keywords.discard))e=this._updateNode(new H9);else if(this._match(ye.keywords.break)){const t=this._updateNode(new sC);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(ye.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(ye.keywords.continue)){const t=this._updateNode(new oC);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ye.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ye.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new j9(t),e)}_while_statement(){if(!this._match(ye.keywords.while))return null;const e=this._updateNode(new YI(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ye.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ye.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Nx(n,e),t)}_for_statement(){if(!this._match(ye.keywords.for))return null;this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._updateNode(new KI(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ye.tokens.semicolon)?null:this._for_init(),this._consume(ye.tokens.semicolon,"Expected ';'."),e.condition=this._check(ye.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ye.tokens.semicolon,"Expected ';'."),e.increment=this._check(ye.tokens.paren_right)?null:this._for_increment(),this._consume(ye.tokens.paren_right,"Expected ')'."),this._check(ye.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ye.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ye.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new el(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(ye.keywords.let)){const e=this._currentLine,t=this._consume(ye.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ye.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(ye.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Pp(t,n,null,null,s),e)}if(this._match(ye.keywords.const)){const e=this._currentLine,t=this._consume(ye.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ye.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(ye.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return n===null&&s instanceof Yi&&(n=s.type),this._updateNode(new y_(t,n,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(ye.increment_operators))return this._current=e,null;const n=this._consume(ye.increment_operators,"Expected increment operator");return this._updateNode(new QI(n.type===ye.tokens.plus_plus?Kh.increment:Kh.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(ye.tokens.brace_right))return null;let n=this._match(ye.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const s=this._consume(ye.assignment_operators,"Expected assignment operator."),l=this._short_circuit_or_expression();return this._updateNode(new JI(dp.parse(s.lexeme),e,l),t)}_func_call_statement(){if(!this._check(ye.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(ye.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new ww(n.lexeme,s),e)}_loop_statement(){if(!this._match(ye.keywords.loop))return null;this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new eC([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Nx){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(ye.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ye.keywords.switch))return null;const e=this._updateNode(new tC(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ye.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([ye.keywords.default,ye.keywords.case]);){if(this._match(ye.keywords.case)){const n=this._case_selectors();for(const l of n)if(l instanceof b_){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new hC(n,s)))}if(this._match(ye.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new dC(n)))}}return e}_case_selectors(){const e=[];for(this._match(ye.keywords.default)?e.push(this._updateNode(new b_)):e.push(this._shift_expression());this._match(ye.tokens.comma);)this._match(ye.keywords.default)?e.push(this._updateNode(new b_)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ye.keywords.fallthrough))return this._consume(ye.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(ye.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(ye.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let l=null;return this._match(ye.keywords.else)&&(this._check(ye.tokens.attr)&&this._attribute(),l=this._compound_statement()),this._updateNode(new rC(t,n,s,l),e)}_match_elseif(){return this._tokens[this._current].type===ye.keywords.else&&this._tokens[this._current+1].type===ye.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Z9(t,n))),this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ye.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new nC(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ye.tokens.or_or);)e=this._updateNode(new Uo(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ye.tokens.and_and);)e=this._updateNode(new Uo(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ye.tokens.or);)e=this._updateNode(new Uo(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ye.tokens.xor);)e=this._updateNode(new Uo(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ye.tokens.and);)e=this._updateNode(new Uo(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ye.tokens.equal_equal,ye.tokens.not_equal])?this._updateNode(new Uo(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ye.tokens.less_than,ye.tokens.greater_than,ye.tokens.less_than_equal,ye.tokens.greater_than_equal]);)e=this._updateNode(new Uo(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ye.tokens.shift_left,ye.tokens.shift_right]);)e=this._updateNode(new Uo(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ye.tokens.plus,ye.tokens.minus]);)e=this._updateNode(new Uo(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ye.tokens.star,ye.tokens.forward_slash,ye.tokens.modulo]);)e=this._updateNode(new Uo(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ye.tokens.minus,ye.tokens.bang,ye.tokens.tilde,ye.tokens.star,ye.tokens.and])?this._updateNode(new ji(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ye.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ye.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new pd(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(ye.tokens.period)){const e=this._consume(ye.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new pu(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Nt.void;case"bool":return Nt.bool;case"i32":return Nt.i32;case"u32":return Nt.u32;case"f32":return Nt.f32;case"f16":return Nt.f16;case"vec2f":return st.vec2f;case"vec3f":return st.vec3f;case"vec4f":return st.vec4f;case"vec2i":return st.vec2i;case"vec3i":return st.vec3i;case"vec4i":return st.vec4i;case"vec2u":return st.vec2u;case"vec3u":return st.vec3u;case"vec4u":return st.vec4u;case"vec2h":return st.vec2h;case"vec3h":return st.vec3h;case"vec4h":return st.vec4h;case"mat2x2f":return st.mat2x2f;case"mat2x3f":return st.mat2x3f;case"mat2x4f":return st.mat2x4f;case"mat3x2f":return st.mat3x2f;case"mat3x3f":return st.mat3x3f;case"mat3x4f":return st.mat3x4f;case"mat4x2f":return st.mat4x2f;case"mat4x3f":return st.mat4x3f;case"mat4x4f":return st.mat4x4f;case"mat2x2h":return st.mat2x2h;case"mat2x3h":return st.mat2x3h;case"mat2x4h":return st.mat2x4h;case"mat3x2h":return st.mat3x2h;case"mat3x3h":return st.mat3x3h;case"mat3x4h":return st.mat3x4h;case"mat4x2h":return st.mat4x2h;case"mat4x3h":return st.mat4x3h;case"mat4x4h":return st.mat4x4h;case"mat2x2i":return st.mat2x2i;case"mat2x3i":return st.mat2x3i;case"mat2x4i":return st.mat2x4i;case"mat3x2i":return st.mat3x2i;case"mat3x3i":return st.mat3x3i;case"mat3x4i":return st.mat3x4i;case"mat4x2i":return st.mat4x2i;case"mat4x3i":return st.mat4x3i;case"mat4x4i":return st.mat4x4i;case"mat2x2u":return st.mat2x2u;case"mat2x3u":return st.mat2x3u;case"mat2x4u":return st.mat2x4u;case"mat3x2u":return st.mat3x2u;case"mat3x3u":return st.mat3x3u;case"mat3x4u":return st.mat3x4u;case"mat4x2u":return st.mat4x2u;case"mat4x3u":return st.mat4x3u;case"mat4x4u":return st.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ye.tokens.ident)){const n=this._previous().toString();if(this._check(ye.tokens.paren_left)){const s=this._argument_expression_list(),l=this._getType(n);return l!==null?this._updateNode(new ga(l,s)):this._updateNode(new Sw(n,s))}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return this._updateNode(new aC(n,s.value))}return this._updateNode(new Js(n))}if(this._match(ye.tokens.int_literal)){const n=this._previous().toString();let s=n.endsWith("i")||n.endsWith("i")?Nt.i32:n.endsWith("u")||n.endsWith("U")?Nt.u32:Nt.x32;const l=parseInt(n);return this._validateTypeRange(l,s),this._updateNode(new Yi(new Qe(l,this._exec.getTypeInfo(s)),s))}if(this._match(ye.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Nt.u32),this._updateNode(new Yi(new Qe(n,this._exec.getTypeInfo(Nt.u32)),Nt.u32))}if(this._match([ye.tokens.decimal_float_literal,ye.tokens.hex_float_literal])){let n=this._previous().toString(),s=n.endsWith("h");s&&(n=n.substring(0,n.length-1));const l=parseFloat(n);this._validateTypeRange(l,s?Nt.f16:Nt.f32);const c=s?Nt.f16:Nt.f32;return this._updateNode(new Yi(new Qe(l,this._exec.getTypeInfo(c)),c))}if(this._match([ye.keywords.true,ye.keywords.false])){let n=this._previous().toString()===ye.keywords.true.rule;return this._updateNode(new Yi(new Qe(n?1:0,this._exec.getTypeInfo(Nt.bool)),Nt.bool))}if(this._check(ye.tokens.paren_left))return this._paren_expression();if(this._match(ye.keywords.bitcast)){this._consume(ye.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ye.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new lC(n,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ga(e,t))}_argument_expression_list(){if(!this._match(ye.tokens.paren_left))return null;const e=[];do{if(this._check(ye.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ye.tokens.comma));return this._consume(ye.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ye.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ye.tokens.paren_right),e}_paren_expression(){this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ye.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ye.keywords.struct))return null;const e=this._currentLine,t=this._consume(ye.tokens.ident,"Expected name for struct.").toString();this._consume(ye.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ye.tokens.brace_right);){const c=this._attribute(),a=this._consume(ye.tokens.name,"Expected variable name.").toString();this._consume(ye.tokens.colon,"Expected ':' for struct member type.");const g=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=g),this._check(ye.tokens.brace_right)?this._match(ye.tokens.comma):this._consume(ye.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new RS(a,v,c)))}this._consume(ye.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,l=this._updateNode(new Ka(t,n,e,s),e);return this._context.structs.set(t,l),l}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ye.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Yi){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Yi&&(e.type=e.value.type.name==="x32"?Nt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ye.keywords.const))return null;const t=this._consume(ye.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(ye.tokens.colon)){const g=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=g)}let l=null;this._consume(ye.tokens.equal,"const declarations require an assignment");const c=this._short_circuit_or_expression();try{let g=[Nt.f32],v=c.constEvaluate(this._exec,g);v instanceof Qe&&this._validateTypeRange(v.value,g[0]),g[0]instanceof st&&g[0].format===null&&v.typeInfo instanceof fu&&v.typeInfo.format!==null&&(v.typeInfo.format.name==="f16"?g[0].format=Nt.f16:v.typeInfo.format.name==="f32"?g[0].format=Nt.f32:v.typeInfo.format.name==="i32"?g[0].format=Nt.i32:v.typeInfo.format.name==="u32"?g[0].format=Nt.u32:v.typeInfo.format.name==="bool"?g[0].format=Nt.bool:console.error(`TODO: impelement template format type ${v.typeInfo.format.name}`)),l=this._updateNode(new Yi(v,g[0])),this._exec.context.setVariable(t.toString(),v)}catch{l=c}if(s!==null&&l instanceof Yi){if(l.type.name!=="x32"&&s.getTypeName()!==l.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${l.type.name} to ${s.name}. Line:${this._currentLine}`);l.type=s,l.isScalar&&this._validateTypeRange(l.scalarValue,l.type)}else s===null&&l instanceof Yi&&(s=(e=l?.type)!==null&&e!==void 0?e:Nt.f32,s===Nt.x32&&(s=Nt.i32));const a=this._updateNode(new y_(t.toString(),s,"","",l),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ye.keywords.let))return null;const e=this._currentLine,t=this._consume(ye.tokens.name,"Expected variable name");let n=null;if(this._match(ye.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}let s=null;if(this._match(ye.tokens.equal)&&(s=this._const_expression()),n!==null&&s instanceof Yi){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else n===null&&s instanceof Yi&&(n=s.type.name==="x32"?Nt.i32:s.type);return s instanceof Yi&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new Pp(t.toString(),n,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ye.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(ye.tokens.less_than)&&(t=this._consume(ye.storage_class,"Expected storage_class.").toString(),this._match(ye.tokens.comma)&&(n=this._consume(ye.access_mode,"Expected access_mode.").toString()),this._consume(ye.tokens.greater_than,"Expected '>'."));const s=this._consume(ye.tokens.name,"Expected variable name");let l=null;if(this._match(ye.tokens.colon)){const c=this._attribute();l=this._type_decl(),l!=null&&(l.attributes=c)}return this._updateNode(new el(s.toString(),l,t,n,null),e)}_override_decl(){if(!this._match(ye.keywords.override))return null;const e=this._consume(ye.tokens.name,"Expected variable name");let t=null;if(this._match(ye.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new xw(e.toString(),t,null))}_diagnostic(){this._consume(ye.tokens.paren_left,"Expected '('");const e=this._consume(ye.tokens.ident,"Expected severity control name.");this._consume(ye.tokens.comma,"Expected ','");let t=this._consume(ye.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ye.tokens.period)&&(t+=`.${this._consume(ye.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ye.tokens.paren_right,"Expected ')'"),this._updateNode(new iC(e.toString(),t))}_enable_directive(){const e=this._consume(ye.tokens.ident,"identity expected.");return this._updateNode(new W9(e.toString()))}_requires_directive(){const e=[this._consume(ye.tokens.ident,"identity expected.").toString()];for(;this._match(ye.tokens.comma);){const t=this._consume(ye.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new $9(e))}_type_alias(){const e=this._consume(ye.tokens.ident,"identity expected.");this._consume(ye.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Tw(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ye.tokens.ident,...ye.texel_format,ye.keywords.bool,ye.keywords.f32,ye.keywords.i32,ye.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const s=this._updateNode(new IS(n));return this._forwardTypeCount++,s}return this._updateNode(new Nt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ye.template_types)){let n=this._advance().toString(),s=null,l=null;return this._match(ye.tokens.less_than)&&(s=this._type_decl(),l=null,this._match(ye.tokens.comma)&&(l=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new st(n,s,l))}if(this._match(ye.keywords.ptr)){let n=this._previous().toString();this._consume(ye.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(ye.storage_class,"Expected storage_class for pointer");this._consume(ye.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let c=null;return this._match(ye.tokens.comma)&&(c=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new v_(n,s.toString(),l,c))}const t=this._attribute();if(this._match(ye.keywords.array)){let n=null,s=-1;const l=this._previous();let c=null;if(this._match(ye.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let g="";if(this._match(ye.tokens.comma)){c=this._shift_expression();try{g=c.constEvaluate(this._exec).toString(),c=null}catch{g="1"}}this._consume(ye.tokens.greater_than,"Expected '>' for array."),s=g?parseInt(g):0}const a=this._updateNode(new Ip(l.toString(),t,n,s));return c&&this._deferArrayCountEval.push({arrayType:a,countNode:c}),a}return null}_texture_sampler_types(){if(this._match(ye.sampler_type))return this._updateNode(new fp(this._previous().toString(),null,null));if(this._match(ye.depth_texture_type))return this._updateNode(new fp(this._previous().toString(),null,null));if(this._match(ye.sampled_texture_type)||this._match(ye.multisampled_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new fp(e.toString(),t,null))}if(this._match(ye.storage_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ye.texel_format,"Invalid texel format.").toString();this._consume(ye.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ye.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new fp(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(ye.tokens.attr);){const t=this._consume(ye.attribute_name,"Expected attribute name"),n=this._updateNode(new fC(t.toString(),null));if(this._match(ye.tokens.paren_left)){if(n.value=this._consume(ye.literal_or_ident,"Expected attribute value").toString(),this._check(ye.tokens.comma)){this._advance();do{const s=this._consume(ye.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(ye.tokens.comma))}this._consume(ye.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class o$ extends va{constructor(e){super(),e&&this.update(e)}update(e){const t=new s$().parse(e);this.updateAST(t)}}function a$(r){const e={attributes:[],bindings:[]};let t;try{t=l$(r)}catch(l){return zt.error(l.message)(),e}for(const l of t.uniforms){const c=[];for(const a of l.type?.members||[])c.push({name:a.name,type:DS(a.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:c})}for(const l of t.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of t.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const n=t.entry.vertex[0],s=n?.inputs.length||0;for(let l=0;l<s;l++){const c=n.inputs[l];if(c.locationType==="location"){const a=DS(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:a})}}return e}function DS(r){return r?.format?`${r.name}<${r.format.name}>`:r.name}function l$(r){try{return new o$(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const c$={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...c$}};const wo=globalThis.mathgl.config;function u$(r,{precision:e=wo.precision}={}){return r=h$(r),`${parseFloat(r.toPrecision(e))}`}function gd(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function ba(r,e,t){return f$(r,n=>Math.max(e,Math.min(t,n)))}function ny(r,e,t){return gd(r)?r.map((n,s)=>ny(n,e[s],t)):t*e+(1-t)*r}function Xp(r,e,t){const n=wo.EPSILON;try{if(r===e)return!0;if(gd(r)&&gd(e)){if(r.length!==e.length)return!1;for(let s=0;s<r.length;++s)if(!Xp(r[s],e[s]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=wo.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{wo.EPSILON=n}}function h$(r){return Math.round(r/wo.EPSILON)*wo.EPSILON}function d$(r){return r.clone?r.clone():new Array(r.length)}function f$(r,e,t){if(gd(r)){const n=r;t=t||d$(n);for(let s=0;s<t.length&&s<n.length;++s){const l=typeof r=="number"?r:r[s];t[s]=e(l,s,t)}return t}return e(r)}class pC extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:gd(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(wo)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+u$(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Xp(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const l=e[s],c=typeof t=="number"?t:t[s];this[s]=l+n*(c-l)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(wo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function p$(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Ks(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Ab(r,e,t=""){if(wo.debug&&!p$(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function OS(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class g$ extends pC{get x(){return this[0]}set x(e){this[0]=Ks(e)}get y(){return this[1]}set y(e){this[1]=Ks(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];t+=s*s}return Ks(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Ks(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return OS(e>=0&&e<this.ELEMENTS,"index is out of range"),Ks(this[e])}setComponent(e,t){return OS(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const x_=1e-6;let md=typeof Float32Array<"u"?Float32Array:Array;function m$(){const r=new md(2);return md!=Float32Array&&(r[0]=0,r[1]=0),r}function FS(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function _$(r,e){return r[0]=-e[0],r[1]=-e[1],r}function gC(r,e,t,n){const s=e[0],l=e[1];return r[0]=s+n*(t[0]-s),r[1]=l+n*(t[1]-l),r}function y$(r,e,t){const n=e[0],s=e[1];return r[0]=t[0]*n+t[4]*s+t[12],r[1]=t[1]*n+t[5]*s+t[13],r}(function(){const r=m$();return function(e,t,n,s,l,c){let a,g;for(t||(t=2),n||(n=0),s?g=Math.min(s*t+n,e.length):g=e.length,a=n;a<g;a+=t)r[0]=e[a],r[1]=e[a+1],l(r,r,c),e[a]=r[0],e[a+1]=r[1];return e}})();function v$(r,e,t){const n=e[0],s=e[1],l=t[3]*n+t[7]*s||1;return r[0]=(t[0]*n+t[4]*s)/l,r[1]=(t[1]*n+t[5]*s)/l,r}function mC(r,e,t){const n=e[0],s=e[1],l=e[2],c=t[3]*n+t[7]*s+t[11]*l||1;return r[0]=(t[0]*n+t[4]*s+t[8]*l)/c,r[1]=(t[1]*n+t[5]*s+t[9]*l)/c,r[2]=(t[2]*n+t[6]*s+t[10]*l)/c,r}function b$(r,e,t){const n=e[0],s=e[1];return r[0]=t[0]*n+t[2]*s,r[1]=t[1]*n+t[3]*s,r[2]=e[2],r}function x$(){const r=new md(3);return md!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function w$(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function T$(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function S$(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function A$(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function E$(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function P$(r,e,t){const n=e[0],s=e[1],l=e[2],c=t[0],a=t[1],g=t[2];return r[0]=s*g-l*a,r[1]=l*c-n*g,r[2]=n*a-s*c,r}function I$(r,e,t,n){const s=e[0],l=e[1],c=e[2];return r[0]=s+n*(t[0]-s),r[1]=l+n*(t[1]-l),r[2]=c+n*(t[2]-c),r}function _C(r,e,t){const n=e[0],s=e[1],l=e[2];let c=t[3]*n+t[7]*s+t[11]*l+t[15];return c=c||1,r[0]=(t[0]*n+t[4]*s+t[8]*l+t[12])/c,r[1]=(t[1]*n+t[5]*s+t[9]*l+t[13])/c,r[2]=(t[2]*n+t[6]*s+t[10]*l+t[14])/c,r}function C$(r,e,t){const n=e[0],s=e[1],l=e[2];return r[0]=n*t[0]+s*t[3]+l*t[6],r[1]=n*t[1]+s*t[4]+l*t[7],r[2]=n*t[2]+s*t[5]+l*t[8],r}function R$(r,e,t){const n=t[0],s=t[1],l=t[2],c=t[3],a=e[0],g=e[1],v=e[2];let w=s*v-l*g,P=l*a-n*v,I=n*g-s*a,k=s*I-l*P,N=l*w-n*I,D=n*P-s*w;const B=c*2;return w*=B,P*=B,I*=B,k*=2,N*=2,D*=2,r[0]=a+w+k,r[1]=g+P+N,r[2]=v+I+D,r}function M$(r,e,t,n){const s=[],l=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],l[0]=s[0],l[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),l[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function k$(r,e,t,n){const s=[],l=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],l[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),l[1]=s[1],l[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function D$(r,e,t,n){const s=[],l=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],l[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),l[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),l[2]=s[2],r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function O$(r,e){const t=r[0],n=r[1],s=r[2],l=e[0],c=e[1],a=e[2],g=Math.sqrt((t*t+n*n+s*s)*(l*l+c*c+a*a)),v=g&&E$(r,e)/g;return Math.acos(Math.min(Math.max(v,-1),1))}const yC=T$,F$=w$,Eb=S$;(function(){const r=x$();return function(e,t,n,s,l,c){let a,g;for(t||(t=3),n||(n=0),s?g=Math.min(s*t+n,e.length):g=e.length,a=n;a<g;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],l(r,r,c),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();const Pb=[0,0,0];let Ym;class Ea extends g${static get ZERO(){return Ym||(Ym=new Ea(0,0,0),Object.freeze(Ym)),Ym}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&gd(e)?this.copy(e):(wo.debug&&(Ks(e),Ks(t),Ks(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return wo.debug&&(Ks(e.x),Ks(e.y),Ks(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ks(e)}angle(e){return O$(this,e)}cross(e){return P$(this,this,e),this.check()}rotateX({radians:e,origin:t=Pb}){return M$(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Pb}){return k$(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Pb}){return D$(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return _C(this,this,e),this.check()}transformAsVector(e){return mC(this,this,e),this.check()}transformByMatrix3(e){return C$(this,this,e),this.check()}transformByMatrix2(e){return b$(this,this,e),this.check()}transformByQuaternion(e){return R$(this,this,e),this.check()}}class N$ extends pC{toString(){let e="[";if(wo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Ks(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[n+s];return t}setColumn(e,t){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=t[s];return this}}function L$(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function B$(r,e){if(r===e){const t=e[1],n=e[2],s=e[3],l=e[6],c=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=l,r[11]=e[14],r[12]=s,r[13]=c,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Bx(r,e){const t=e[0],n=e[1],s=e[2],l=e[3],c=e[4],a=e[5],g=e[6],v=e[7],w=e[8],P=e[9],I=e[10],k=e[11],N=e[12],D=e[13],B=e[14],U=e[15],V=t*a-n*c,L=t*g-s*c,$=t*v-l*c,te=n*g-s*a,G=n*v-l*a,le=s*v-l*g,se=w*D-P*N,oe=w*B-I*N,be=w*U-k*N,xe=P*B-I*D,_e=P*U-k*D,Ne=I*U-k*B;let fe=V*Ne-L*_e+$*xe+te*be-G*oe+le*se;return fe?(fe=1/fe,r[0]=(a*Ne-g*_e+v*xe)*fe,r[1]=(s*_e-n*Ne-l*xe)*fe,r[2]=(D*le-B*G+U*te)*fe,r[3]=(I*G-P*le-k*te)*fe,r[4]=(g*be-c*Ne-v*oe)*fe,r[5]=(t*Ne-s*be+l*oe)*fe,r[6]=(B*$-N*le-U*L)*fe,r[7]=(w*le-I*$+k*L)*fe,r[8]=(c*_e-a*be+v*se)*fe,r[9]=(n*be-t*_e-l*se)*fe,r[10]=(N*G-D*$+U*V)*fe,r[11]=(P*$-w*G-k*V)*fe,r[12]=(a*oe-c*xe-g*se)*fe,r[13]=(t*xe-n*oe+s*se)*fe,r[14]=(D*L-N*te-B*V)*fe,r[15]=(w*te-P*L+I*V)*fe,r):null}function z$(r){const e=r[0],t=r[1],n=r[2],s=r[3],l=r[4],c=r[5],a=r[6],g=r[7],v=r[8],w=r[9],P=r[10],I=r[11],k=r[12],N=r[13],D=r[14],B=r[15],U=e*c-t*l,V=e*a-n*l,L=t*a-n*c,$=v*N-w*k,te=v*D-P*k,G=w*D-P*N,le=e*G-t*te+n*$,se=l*G-c*te+a*$,oe=v*L-w*V+P*U,be=k*L-N*V+D*U;return g*le-s*se+B*oe-I*be}function ou(r,e,t){const n=e[0],s=e[1],l=e[2],c=e[3],a=e[4],g=e[5],v=e[6],w=e[7],P=e[8],I=e[9],k=e[10],N=e[11],D=e[12],B=e[13],U=e[14],V=e[15];let L=t[0],$=t[1],te=t[2],G=t[3];return r[0]=L*n+$*a+te*P+G*D,r[1]=L*s+$*g+te*I+G*B,r[2]=L*l+$*v+te*k+G*U,r[3]=L*c+$*w+te*N+G*V,L=t[4],$=t[5],te=t[6],G=t[7],r[4]=L*n+$*a+te*P+G*D,r[5]=L*s+$*g+te*I+G*B,r[6]=L*l+$*v+te*k+G*U,r[7]=L*c+$*w+te*N+G*V,L=t[8],$=t[9],te=t[10],G=t[11],r[8]=L*n+$*a+te*P+G*D,r[9]=L*s+$*g+te*I+G*B,r[10]=L*l+$*v+te*k+G*U,r[11]=L*c+$*w+te*N+G*V,L=t[12],$=t[13],te=t[14],G=t[15],r[12]=L*n+$*a+te*P+G*D,r[13]=L*s+$*g+te*I+G*B,r[14]=L*l+$*v+te*k+G*U,r[15]=L*c+$*w+te*N+G*V,r}function iy(r,e,t){const n=t[0],s=t[1],l=t[2];let c,a,g,v,w,P,I,k,N,D,B,U;return e===r?(r[12]=e[0]*n+e[4]*s+e[8]*l+e[12],r[13]=e[1]*n+e[5]*s+e[9]*l+e[13],r[14]=e[2]*n+e[6]*s+e[10]*l+e[14],r[15]=e[3]*n+e[7]*s+e[11]*l+e[15]):(c=e[0],a=e[1],g=e[2],v=e[3],w=e[4],P=e[5],I=e[6],k=e[7],N=e[8],D=e[9],B=e[10],U=e[11],r[0]=c,r[1]=a,r[2]=g,r[3]=v,r[4]=w,r[5]=P,r[6]=I,r[7]=k,r[8]=N,r[9]=D,r[10]=B,r[11]=U,r[12]=c*n+w*s+N*l+e[12],r[13]=a*n+P*s+D*l+e[13],r[14]=g*n+I*s+B*l+e[14],r[15]=v*n+k*s+U*l+e[15]),r}function Cw(r,e,t){const n=t[0],s=t[1],l=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*s,r[5]=e[5]*s,r[6]=e[6]*s,r[7]=e[7]*s,r[8]=e[8]*l,r[9]=e[9]*l,r[10]=e[10]*l,r[11]=e[11]*l,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function U$(r,e,t,n){let s=n[0],l=n[1],c=n[2],a=Math.sqrt(s*s+l*l+c*c),g,v,w,P,I,k,N,D,B,U,V,L,$,te,G,le,se,oe,be,xe,_e,Ne,fe,Le;return a<x_?null:(a=1/a,s*=a,l*=a,c*=a,v=Math.sin(t),g=Math.cos(t),w=1-g,P=e[0],I=e[1],k=e[2],N=e[3],D=e[4],B=e[5],U=e[6],V=e[7],L=e[8],$=e[9],te=e[10],G=e[11],le=s*s*w+g,se=l*s*w+c*v,oe=c*s*w-l*v,be=s*l*w-c*v,xe=l*l*w+g,_e=c*l*w+s*v,Ne=s*c*w+l*v,fe=l*c*w-s*v,Le=c*c*w+g,r[0]=P*le+D*se+L*oe,r[1]=I*le+B*se+$*oe,r[2]=k*le+U*se+te*oe,r[3]=N*le+V*se+G*oe,r[4]=P*be+D*xe+L*_e,r[5]=I*be+B*xe+$*_e,r[6]=k*be+U*xe+te*_e,r[7]=N*be+V*xe+G*_e,r[8]=P*Ne+D*fe+L*Le,r[9]=I*Ne+B*fe+$*Le,r[10]=k*Ne+U*fe+te*Le,r[11]=N*Ne+V*fe+G*Le,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function vC(r,e,t){const n=Math.sin(t),s=Math.cos(t),l=e[4],c=e[5],a=e[6],g=e[7],v=e[8],w=e[9],P=e[10],I=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=l*s+v*n,r[5]=c*s+w*n,r[6]=a*s+P*n,r[7]=g*s+I*n,r[8]=v*s-l*n,r[9]=w*s-c*n,r[10]=P*s-a*n,r[11]=I*s-g*n,r}function V$(r,e,t){const n=Math.sin(t),s=Math.cos(t),l=e[0],c=e[1],a=e[2],g=e[3],v=e[8],w=e[9],P=e[10],I=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*s-v*n,r[1]=c*s-w*n,r[2]=a*s-P*n,r[3]=g*s-I*n,r[8]=l*n+v*s,r[9]=c*n+w*s,r[10]=a*n+P*s,r[11]=g*n+I*s,r}function bC(r,e,t){const n=Math.sin(t),s=Math.cos(t),l=e[0],c=e[1],a=e[2],g=e[3],v=e[4],w=e[5],P=e[6],I=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*s+v*n,r[1]=c*s+w*n,r[2]=a*s+P*n,r[3]=g*s+I*n,r[4]=v*s-l*n,r[5]=w*s-c*n,r[6]=P*s-a*n,r[7]=I*s-g*n,r}function j$(r,e){const t=e[0],n=e[1],s=e[2],l=e[3],c=t+t,a=n+n,g=s+s,v=t*c,w=n*c,P=n*a,I=s*c,k=s*a,N=s*g,D=l*c,B=l*a,U=l*g;return r[0]=1-P-N,r[1]=w+U,r[2]=I-B,r[3]=0,r[4]=w-U,r[5]=1-v-N,r[6]=k+D,r[7]=0,r[8]=I+B,r[9]=k-D,r[10]=1-v-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function W$(r,e,t,n,s,l,c){const a=1/(t-e),g=1/(s-n),v=1/(l-c);return r[0]=l*2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l*2*g,r[6]=0,r[7]=0,r[8]=(t+e)*a,r[9]=(s+n)*g,r[10]=(c+l)*v,r[11]=-1,r[12]=0,r[13]=0,r[14]=c*l*2*v,r[15]=0,r}function $$(r,e,t,n,s){const l=1/Math.tan(e/2);if(r[0]=l/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0){const c=1/(n-s);r[10]=(s+n)*c,r[14]=2*s*n*c}else r[10]=-1,r[14]=-2*n;return r}const H$=$$;function Z$(r,e,t,n,s,l,c){const a=1/(e-t),g=1/(n-s),v=1/(l-c);return r[0]=-2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*v,r[11]=0,r[12]=(e+t)*a,r[13]=(s+n)*g,r[14]=(c+l)*v,r[15]=1,r}const X$=Z$;function q$(r,e,t,n){let s,l,c,a,g,v,w,P,I,k;const N=e[0],D=e[1],B=e[2],U=n[0],V=n[1],L=n[2],$=t[0],te=t[1],G=t[2];return Math.abs(N-$)<x_&&Math.abs(D-te)<x_&&Math.abs(B-G)<x_?L$(r):(P=N-$,I=D-te,k=B-G,s=1/Math.sqrt(P*P+I*I+k*k),P*=s,I*=s,k*=s,l=V*k-L*I,c=L*P-U*k,a=U*I-V*P,s=Math.sqrt(l*l+c*c+a*a),s?(s=1/s,l*=s,c*=s,a*=s):(l=0,c=0,a=0),g=I*a-k*c,v=k*l-P*a,w=P*c-I*l,s=Math.sqrt(g*g+v*v+w*w),s?(s=1/s,g*=s,v*=s,w*=s):(g=0,v=0,w=0),r[0]=l,r[1]=g,r[2]=P,r[3]=0,r[4]=c,r[5]=v,r[6]=I,r[7]=0,r[8]=a,r[9]=w,r[10]=k,r[11]=0,r[12]=-(l*N+c*D+a*B),r[13]=-(g*N+v*D+w*B),r[14]=-(P*N+I*D+k*B),r[15]=1,r)}function G$(){const r=new md(4);return md!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function xC(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Nd(r,e,t){const n=e[0],s=e[1],l=e[2],c=e[3];return r[0]=t[0]*n+t[4]*s+t[8]*l+t[12]*c,r[1]=t[1]*n+t[5]*s+t[9]*l+t[13]*c,r[2]=t[2]*n+t[6]*s+t[10]*l+t[14]*c,r[3]=t[3]*n+t[7]*s+t[11]*l+t[15]*c,r}(function(){const r=G$();return function(e,t,n,s,l,c){let a,g;for(t||(t=4),n||(n=0),s?g=Math.min(s*t+n,e.length):g=e.length,a=n;a<g;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],r[3]=e[a+3],l(r,r,c),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2],e[a+3]=r[3];return e}})();var zx;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(zx||(zx={}));const Y$=45*Math.PI/180,K$=1,Ib=.1,Cb=500,Q$=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Xo extends N${static get IDENTITY(){return e7()}static get ZERO(){return J$()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return zx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,s,l,c,a,g,v,w,P,I,k,N,D,B){return this[0]=e,this[1]=t,this[2]=n,this[3]=s,this[4]=l,this[5]=c,this[6]=a,this[7]=g,this[8]=v,this[9]=w,this[10]=P,this[11]=I,this[12]=k,this[13]=N,this[14]=D,this[15]=B,this.check()}setRowMajor(e,t,n,s,l,c,a,g,v,w,P,I,k,N,D,B){return this[0]=e,this[1]=l,this[2]=v,this[3]=k,this[4]=t,this[5]=c,this[6]=w,this[7]=N,this[8]=n,this[9]=a,this[10]=P,this[11]=D,this[12]=s,this[13]=g,this[14]=I,this[15]=B,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Q$)}fromObject(e){return this.check()}fromQuaternion(e){return j$(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:s,top:l,near:c=Ib,far:a=Cb}=e;return a===1/0?t7(this,t,n,s,l,c):W$(this,t,n,s,l,c,a),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:s=[0,1,0]}=e;return q$(this,t,n,s),this.check()}ortho(e){const{left:t,right:n,bottom:s,top:l,near:c=Ib,far:a=Cb}=e;return X$(this,t,n,s,l,c,a),this.check()}orthographic(e){const{fovy:t=Y$,aspect:n=K$,focalDistance:s=1,near:l=Ib,far:c=Cb}=e;NS(t);const a=t/2,g=s*Math.tan(a),v=g*n;return this.ortho({left:-v,right:v,bottom:-g,top:g,near:l,far:c})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:s=.1,far:l=500}=e;return NS(t),H$(this,t,n,s,l),this.check()}determinant(){return z$(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],l=1/n[1],c=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*l,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*l,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),s=1/n[0],l=1/n[1],c=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*l,e[2]=this[2]*c,e[3]=this[4]*s,e[4]=this[5]*l,e[5]=this[6]*c,e[6]=this[8]*s,e[7]=this[9]*l,e[8]=this[10]*c,e}transpose(){return B$(this,this),this.check()}invert(){return Bx(this,this),this.check()}multiplyLeft(e){return ou(this,e,this),this.check()}multiplyRight(e){return ou(this,this,e),this.check()}rotateX(e){return vC(this,this,e),this.check()}rotateY(e){return V$(this,this,e),this.check()}rotateZ(e){return bC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return U$(this,this,e,t),this.check()}scale(e){return Cw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return iy(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Nd(t||[-0,-0,-0,-0],e,this),Ab(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let s;switch(n){case 2:s=y$(t||[-0,-0],e,this);break;case 3:s=_C(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ab(s,e.length),s}transformAsVector(e,t){let n;switch(e.length){case 2:n=v$(t||[-0,-0],e,this);break;case 3:n=mC(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ab(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Km,Qm;function J$(){return Km||(Km=new Xo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Km)),Km}function e7(){return Qm||(Qm=new Xo,Object.freeze(Qm)),Qm}function NS(r){if(r>Math.PI*2)throw Error("expected radians")}function t7(r,e,t,n,s,l){const c=2*l/(t-e),a=2*l/(s-n),g=(t+e)/(t-e),v=(s+n)/(s-n),w=-1,P=-1,I=-2*l;return r[0]=c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=g,r[9]=v,r[10]=w,r[11]=P,r[12]=0,r[13]=0,r[14]=I,r[15]=0,r}function wC(r,e=[],t=0){const n=Math.fround(r),s=r-n;return e[t]=n,e[t+1]=s,e}function r7(r){return r-Math.fround(r)}function n7(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const s=t*4+n;wC(r[n*4+t],e,s*2)}return e}const i7=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,s7={name:"fp32",vs:i7},o7=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,a7={ONE:1},l7={name:"fp64arithmetic",vs:o7,defaultUniforms:a7,uniformTypes:{ONE:"f32"},fp64ify:wC,fp64LowPart:r7,fp64ifyMatrix4:n7},c7=[0,1,1,1],u7=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,h7=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,LS={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:c7},vs:u7,fs:h7,getUniforms:d7};function d7(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(r.highlightColor){const n=Array.from(r.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}const BS=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,f7={name:"layer",vs:BS,fs:BS,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},p7=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,TC="#define SMOOTH_EDGE_RADIUS 0.5",g7=`${TC}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,m7=`${TC}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,SC={name:"geometry",source:p7,vs:g7,fs:m7},_7=25;var Wi;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(Wi||(Wi={}));var Ki;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(Ki||(Ki={}));var ln;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(ln||(ln={}));const y7="compute",v7="auto",Ux="manipulation",w_="none",Vx="pan-x",jx="pan-y";function b7(r){if(r.includes(w_))return w_;const e=r.includes(Vx),t=r.includes(jx);return e&&t?w_:e||t?e?Vx:jx:r.includes(Ux)?Ux:v7}class x7{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===y7&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return b7(e.join(" "))}}function sy(r){return r.trim().split(/\s+/g)}function Rb(r,e,t){if(r)for(const n of sy(e))r.addEventListener(n,t,!1)}function Mb(r,e,t){if(r)for(const n of sy(e))r.removeEventListener(n,t,!1)}function zS(r){return(r.ownerDocument||r).defaultView}function w7(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function AC(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,n=0,s=0;for(;s<e;)t+=r[s].clientX,n+=r[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(n/e)}}function US(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:AC(e),deltaX:r.deltaX,deltaY:r.deltaY}}function EC(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)}function VS(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.sqrt(t*t+n*n)}function T7(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)*180/Math.PI}function jS(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.atan2(n,t)*180/Math.PI}function PC(r,e){return r===e?Ki.None:Math.abs(r)>=Math.abs(e)?r<0?Ki.Left:Ki.Right:e<0?Ki.Up:Ki.Down}function S7(r,e){const t=e.center;let n=r.offsetDelta,s=r.prevDelta;const l=r.prevInput;return(e.eventType===Wi.Start||l?.eventType===Wi.End)&&(s=r.prevDelta={x:l?.deltaX||0,y:l?.deltaY||0},n=r.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-n.x),deltaY:s.y+(t.y-n.y)}}function IC(r,e,t){return{x:e/r||0,y:t/r||0}}function A7(r,e){return VS(e[0],e[1])/VS(r[0],r[1])}function E7(r,e){return jS(e[1],e[0])-jS(r[1],r[0])}function P7(r,e){const t=r.lastInterval||e,n=e.timeStamp-t.timeStamp;let s,l,c,a;if(e.eventType!==Wi.Cancel&&(n>_7||t.velocity===void 0)){const g=e.deltaX-t.deltaX,v=e.deltaY-t.deltaY,w=IC(n,g,v);l=w.x,c=w.y,s=Math.abs(w.x)>Math.abs(w.y)?w.x:w.y,a=PC(g,v),r.lastInterval=e}else s=t.velocity,l=t.velocityX,c=t.velocityY,a=t.direction;e.velocity=s,e.velocityX=l,e.velocityY=c,e.direction=a}function I7(r,e){const{session:t}=r,{pointers:n}=e,{length:s}=n;t.firstInput||(t.firstInput=US(e)),s>1&&!t.firstMultiple?t.firstMultiple=US(e):s===1&&(t.firstMultiple=!1);const{firstInput:l,firstMultiple:c}=t,a=c?c.center:l.center,g=e.center=AC(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-l.timeStamp,e.angle=T7(a,g),e.distance=EC(a,g);const{deltaX:v,deltaY:w}=S7(t,e);e.deltaX=v,e.deltaY=w,e.offsetDirection=PC(e.deltaX,e.deltaY);const P=IC(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=P.x,e.overallVelocityY=P.y,e.overallVelocity=Math.abs(P.x)>Math.abs(P.y)?P.x:P.y,e.scale=c?A7(c.pointers,n):1,e.rotation=c?E7(c.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let I=r.element;return w7(e.srcEvent.target,I)&&(I=e.srcEvent.target),e.target=I,P7(t,e),e}function C7(r,e,t){const n=t.pointers.length,s=t.changedPointers.length,l=e&Wi.Start&&n-s===0,c=e&(Wi.End|Wi.Cancel)&&n-s===0;t.isFirst=!!l,t.isFinal=!!c,l&&(r.session={}),t.eventType=e;const a=I7(r,t);r.emit("hammer.input",a),r.recognize(a),r.session.prevInput=a}let R7=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){C7(this.manager,e,t)}init(){Rb(this.element,this.evEl,this.domHandler),Rb(this.target,this.evTarget,this.domHandler),Rb(zS(this.element),this.evWin,this.domHandler)}destroy(){Mb(this.element,this.evEl,this.domHandler),Mb(this.target,this.evTarget,this.domHandler),Mb(zS(this.element),this.evWin,this.domHandler)}};const M7={pointerdown:Wi.Start,pointermove:Wi.Move,pointerup:Wi.End,pointercancel:Wi.Cancel,pointerout:Wi.Cancel},k7="pointerdown",D7="pointermove pointerup pointercancel";class O7 extends R7{constructor(e){super(e),this.evEl=k7,this.evWin=D7,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const s=M7[e.type],l=e.pointerType,c=l==="touch";let a=t.findIndex(g=>g.pointerId===e.pointerId);s&Wi.Start&&(e.buttons||c)?a<0&&(t.push(e),a=t.length-1):s&(Wi.End|Wi.Cancel)&&(n=!0),!(a<0)&&(t[a]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:l,srcEvent:e}),n&&t.splice(a,1))}}const F7=["","webkit","Moz","MS","ms","o"];function N7(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of F7){const s=n?n+t:e;if(s in r)return s}}const L7=1,WS=2,$S={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class B7{constructor(e,t){this.options={...$S,...t,cssProps:{...$S.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new O7(this),this.touchAction=new x7(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?WS:L7}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:s}=this;let{curRecognizer:l}=t;(!l||l&&l.state&ln.Recognized)&&(l=t.curRecognizer=null);let c=0;for(;c<s.length;)n=s[c],t.stopped!==WS&&(!l||n===l||n.canRecognizeWith(l))?n.recognize(e):n.reset(),!l&&n.state&(ln.Began|ln.Changed|ln.Ended)&&(l=t.curRecognizer=n),c++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,s=n.indexOf(t);s!==-1&&(n.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const s of sy(e))n[s]=n[s]||[],n[s].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const s of sy(e))t?n[s]&&n[s].splice(n[s].indexOf(t),1):delete n[s]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let l=0;for(;l<n.length;)n[l](s),l++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,s]of Object.entries(this.options.cssProps)){const l=N7(t.style,n);e?(this.oldCssProps[l]=t.style[l],t.style[l]=s):t.style[l]=this.oldCssProps[l]||""}e||(this.oldCssProps={})}}}let z7=1;function U7(){return z7++}function HS(r){return r&ln.Cancelled?"cancel":r&ln.Ended?"end":r&ln.Changed?"move":r&ln.Began?"start":""}class CC{constructor(e){this.options=e,this.id=U7(),this.state=ln.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<ln.Ended&&this.manager.emit(this.options.event+HS(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=ln.Ended&&this.manager.emit(this.options.event+HS(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=ln.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ln.Failed|ln.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=ln.Failed;return}this.state&(ln.Recognized|ln.Cancelled|ln.Failed)&&(this.state=ln.Possible),this.state=this.process(t),this.state&(ln.Began|ln.Changed|ln.Ended|ln.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class RC extends CC{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,s=t&(ln.Began|ln.Changed),l=this.attrTest(e);return s&&(n&Wi.Cancel||!l)?t|ln.Cancelled:s||l?n&Wi.End?t|ln.Ended:t&ln.Began?t|ln.Changed:ln.Began:ln.Failed}}class ZS extends CC{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Ux]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,s=e.distance<t.threshold,l=e.deltaTime<t.time;if(this.reset(),e.eventType&Wi.Start&&this.count===0)return this.failTimeout();if(s&&l&&n){if(e.eventType!==Wi.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||EC(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!c?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=ln.Recognized,this.tryEmit(this._input)},t.interval),ln.Began):ln.Recognized}return ln.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=ln.Failed},this.options.interval),ln.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===ln.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const V7=["","start","move","end","cancel","up","down","left","right"];class XS extends RC{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Ki.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Ki.Horizontal&&t.push(jx),e&Ki.Vertical&&t.push(Vx),t}getEventNames(){return V7.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:s}=e,{direction:l}=e;const c=e.deltaX,a=e.deltaY;return l&t.direction||(t.direction&Ki.Horizontal?(l=c===0?Ki.None:c<0?Ki.Left:Ki.Right,n=c!==this.pX,s=Math.abs(e.deltaX)):(l=a===0?Ki.None:a<0?Ki.Up:Ki.Down,n=a!==this.pY,s=Math.abs(e.deltaY))),e.direction=l,n&&s>t.threshold&&!!(l&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&ln.Began)||!(this.state&ln.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Ki[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const j7=["","start","move","end","cancel","in","out"];class W7 extends RC{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[w_]}getEventNames(){return j7.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&ln.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class My{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const $7=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",H7=$7.indexOf("firefox")!==-1,qS=4.000244140625,Z7=40,X7=.25;class q7 extends My{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=s=>{if(!this.options.enable)return;let l=s.deltaY;globalThis.WheelEvent&&(H7&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(l/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(l*=Z7)),l!==0&&l%qS===0&&(l=Math.floor(l/qS)),s.shiftKey&&l&&(l=l*X7),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-l,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const GS=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class G7 extends My{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,GS.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){GS.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const YS=["keydown","keyup"];class Y7 extends My{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=s=>{const l=s.target||s.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",YS.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){YS.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class K7 extends My{constructor(e,t,n){super(e,t,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const KS=1,Wx=2,QS=4,Q7={pointerdown:KS,pointermove:Wx,pointerup:QS,mousedown:KS,mousemove:Wx,mouseup:QS},J7=0,eH=1,tH=2,rH=1,nH=2,iH=4;function sH(r){const e=Q7[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let s=!1,l=!1,c=!1;return e===Wx?(s=!!(t&rH),l=!!(t&iH),c=!!(t&nH)):(s=n===J7,l=n===eH,c=n===tH),{leftButton:s,middleButton:l,rightButton:c}}function oH(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),s=n.width/e.offsetWidth||1,l=n.height/e.offsetHeight||1,c={x:(t.x-n.left-e.clientLeft)/s,y:(t.y-n.top-e.clientTop)/l};return{center:t,offsetCenter:c}}const aH={srcElement:"root",priority:0};class lH{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const s=this._normalizeEvent(n);let l=n.srcEvent.target;for(;l&&l!==s.rootElement;){if(this._emit(s,l),s.handled)return;l=l.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,s=!1,l=!1){const{handlers:c,handlersByElement:a}=this,g={...aH,...n};let v=a.get(g.srcElement);v||(v=[],a.set(g.srcElement,v));const w={type:e,handler:t,srcElement:g.srcElement,priority:g.priority};s&&(w.once=!0),l&&(w.passive=!0),c.push(w),this._active=this._active||!w.passive;let P=v.length-1;for(;P>=0&&!(v[P].priority>=w.priority);)P--;v.splice(P+1,0,w)}remove(e,t){const{handlers:n,handlersByElement:s}=this;for(let l=n.length-1;l>=0;l--){const c=n[l];if(c.type===e&&c.handler===t){n.splice(l,1);const a=s.get(c.srcElement);a.splice(a.indexOf(c),1),a.length===0&&s.delete(c.srcElement)}}this._active=n.some(l=>!l.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let s=!1;const l=()=>{e.handled=!0},c=()=>{e.handled=!0,s=!0},a=[];for(let g=0;g<n.length;g++){const{type:v,handler:w,once:P}=n[g];if(w({...e,type:v,stopPropagation:l,stopImmediatePropagation:c}),P&&a.push(n[g]),s)break}for(let g=0;g<a.length;g++){const{type:v,handler:w}=a[g];this.remove(v,w)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...sH(e),...oH(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function cH(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const n=t.shift(),s=t.shift()||{};e=new n(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class uH{constructor(e=null,t={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new B7(e,this.options);for(const n of this.options.recognizers){const{recognizer:s,recognizeWith:l,requireFailure:c}=cH(n);this.manager.add(s),l&&s.recognizeWith(l),c&&s.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new q7(e,this._onOtherEvent,{enable:!1}),this.moveInput=new G7(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Y7(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new K7(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const s=n.get(e);s&&(s.set({enable:t}),n.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,n,s,l){if(typeof e!="string"){n=t;for(const[v,w]of Object.entries(e))this._addEventHandler(v,w,n,s,l);return}const{manager:c,events:a}=this;if(!c)return;let g=a.get(e);if(!g){const v=this._getRecognizerName(e)||e;g=new lH(this,v),a.set(e,g),c&&c.on(e,g.handleEvent)}g.add(e,t,n,s,l),g.isEmpty()||this._toggleRecognizer(g.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[l,c]of Object.entries(e))this._removeEventHandler(l,c);return}const{events:n}=this,s=n.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:l}=s;let c=!1;for(const a of n.values())if(a.recognizerName===l&&!a.isEmpty()){c=!0;break}c||this._toggleRecognizer(l,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Nn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Nn,"IDENTITY",{get:()=>(Vn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ro={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},qp={common:0,meters:1,pixels:2},$x={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},JS={multipan:[XS,{threshold:10,direction:Ki.Vertical,pointers:2}],pinch:[W7,{},null,["multipan"]],pan:[XS,{threshold:1},["pinch"],["multipan"]],dblclick:[ZS,{event:"dblclick",taps:2}],click:[ZS,{event:"click"},null,["dblclick"]]};function hH(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function dg(r){let e={},t;return n=>{for(const s in n)if(!hH(n[s],e[s])){t=r(n),e=n;break}return t}}const eA=[0,0,0,0],dH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],MC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fH=[0,0,0],kC=[0,0,0],pH=dg(_H);function DC(r,e,t=kC){t.length<3&&(t=[t[0],t[1],0]);let n=t,s,l=!0;switch(e===Nn.LNGLAT_OFFSETS||e===Nn.METER_OFFSETS?s=t:s=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case ro.WEB_MERCATOR:(e===Nn.LNGLAT||e===Nn.CARTESIAN)&&(s=[0,0,0],l=!1);break;case ro.WEB_MERCATOR_AUTO_OFFSET:e===Nn.LNGLAT?n=s:e===Nn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],s=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case ro.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case ro.GLOBE:l=!1,s=null;break;default:l=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:l}}function gH(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:s}=r;let{viewMatrix:l,viewProjectionMatrix:c}=r,a=eA,g=eA,v=r.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:P,offsetMode:I}=DC(r,e,t);return I&&(g=r.projectPosition(w||P),v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],g[3]=1,a=Nd([],g,c),l=n||l,c=ou([],s,l),c=ou([],c,dH)),{viewMatrix:l,viewProjectionMatrix:c,projectionCenter:a,originCommon:g,cameraPosCommon:v,shaderCoordinateOrigin:P,geospatialOrigin:w}}function mH({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=Nn.DEFAULT,coordinateOrigin:s=kC,autoWrapLongitude:l=!1}){n===Nn.DEFAULT&&(n=r.isGeospatial?Nn.LNGLAT:Nn.CARTESIAN);const c=pH({viewport:r,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s});return c.wrapLongitude=l,c.modelMatrix=t||MC,c}function _H({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:l,originCommon:c,cameraPosCommon:a,shaderCoordinateOrigin:g,geospatialOrigin:v}=gH(r,t,n),w=r.getDistanceScales(),P=[r.width*e,r.height*e],I=Nd([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,k={coordinateSystem:t,projectionMode:r.projectionMode,coordinateOrigin:g,commonOrigin:c.slice(0,3),center:s,pseudoMeters:!!r._pseudoMeters,viewportSize:P,devicePixelRatio:e,focalDistance:I,commonUnitsPerMeter:w.unitsPerMeter,commonUnitsPerWorldUnit:w.unitsPerMeter,commonUnitsPerWorldUnit2:fH,scale:r.scale,wrapLongitude:!1,viewProjectionMatrix:l,modelMatrix:MC,cameraPosition:a};if(v){const N=r.getDistanceScales(v);switch(t){case Nn.METER_OFFSETS:k.commonUnitsPerWorldUnit=N.unitsPerMeter,k.commonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case Nn.LNGLAT:case Nn.LNGLAT_OFFSETS:r._pseudoMeters||(k.commonUnitsPerMeter=N.unitsPerMeter),k.commonUnitsPerWorldUnit=N.unitsPerDegree,k.commonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case Nn.CARTESIAN:k.commonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],k.commonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return k}const yH=Object.keys(Nn).map(r=>`const COORDINATE_SYSTEM_${r}: i32 = ${Nn[r]};`).join(""),vH=Object.keys(ro).map(r=>`const PROJECTION_MODE_${r}: i32 = ${ro[r]};`).join(""),bH=Object.keys(qp).map(r=>`const UNIT_${r.toUpperCase()}: i32 = ${qp[r]};`).join(""),xH=`${yH}
${vH}
${bH}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,wH=`${xH}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zâaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,TH=Object.keys(Nn).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Nn[r]};`).join(""),SH=Object.keys(ro).map(r=>`const int PROJECTION_MODE_${r} = ${ro[r]};`).join(""),AH=Object.keys(qp).map(r=>`const int UNIT_${r.toUpperCase()} = ${qp[r]};`).join(""),EH=`${TH}
${SH}
${AH}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,PH={};function IH(r=PH){return"viewport"in r?mH(r):{}}const Rw={name:"project",dependencies:[s7,SC],source:wH,vs:EH,getUniforms:IH,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},CH=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,RH=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,MH={name:"project32",dependencies:[Rw],source:CH,vs:RH};function kH(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ld(r,e){const t=Nd([],e,r);return xC(t,t,1/t[3]),t}function tA(r,e){const t=r%e;return t<0?e+t:t}function Hx(r,e,t){return r<e?e:r>t?t:r}function DH(r){return Math.log(r)*Math.LOG2E}const Mw=Math.log2||DH;function al(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Wo=Math.PI,OC=Wo/4,To=Wo/180,Zx=180/Wo,_d=512,oy=4003e4,tc=85.051129,OH=1.5;function FH(r){return Mw(r)}function Gp(r){const[e,t]=r;al(Number.isFinite(e)),al(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*To,s=t*To,l=_d*(n+Wo)/(2*Wo),c=_d*(Wo+Math.log(Math.tan(OC+s*.5)))/(2*Wo);return[l,c]}function yd(r){const[e,t]=r,n=e/_d*(2*Wo)-Wo,s=2*(Math.atan(Math.exp(t/_d*(2*Wo)-Wo))-OC);return[n*Zx,s*Zx]}function NH(r){const{latitude:e}=r;al(Number.isFinite(e));const t=Math.cos(e*To);return FH(oy*t)-9}function T_(r){const e=Math.cos(r*To);return _d/oy/e}function Xx(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;al(Number.isFinite(e)&&Number.isFinite(t));const s=_d,l=Math.cos(e*To),c=s/360,a=c/l,g=s/oy/l,v={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[c,a,g],degreesPerUnit:[1/c,1/a,1/g]};if(n){const w=To*Math.tan(e*To)/l,P=c*w/2,I=s/oy*w,k=I/a*g;v.unitsPerDegree2=[0,P,I],v.unitsPerMeter2=[k,0,k]}return v}function FC(r,e){const[t,n,s]=r,[l,c,a]=e,{unitsPerMeter:g,unitsPerMeter2:v}=Xx({longitude:t,latitude:n,highPrecision:!0}),w=Gp(r);w[0]+=l*(g[0]+v[0]*c),w[1]+=c*(g[1]+v[1]*c);const P=yd(w),I=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[P[0],P[1],I]:P}function LH(r){const{height:e,pitch:t,bearing:n,altitude:s,scale:l,center:c}=r,a=kH();iy(a,a,[0,0,-s]),vC(a,a,-t*To),bC(a,a,n*To);const g=l/e;return Cw(a,a,[g,g,g]),c&&iy(a,a,A$([],c)),a}function BH(r){const{width:e,height:t,altitude:n,pitch:s=0,offset:l,center:c,scale:a,nearZMultiplier:g=1,farZMultiplier:v=1}=r;let{fovy:w=Yp(OH)}=r;n!==void 0&&(w=Yp(n));const P=w*To,I=s*To,k=kw(w);let N=k;c&&(N+=c[2]*a/Math.cos(I)/t);const D=P*(.5+(l?l[1]:0)/t),B=Math.sin(D)*N/Math.sin(Hx(Math.PI/2-I-D,.01,Math.PI-.01)),U=Math.sin(I)*B+N,V=N*10,L=Math.min(U*v,V);return{fov:P,aspect:e/t,focalDistance:k,near:g,far:L}}function Yp(r){return 2*Math.atan(.5/r)*Zx}function kw(r){return .5/Math.tan(.5*r*To)}function NC(r,e){const[t,n,s=0]=r;return al(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(s)),ld(e,[t,n,s,1])}function Dw(r,e,t=0){const[n,s,l]=r;if(al(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(l))return ld(e,[n,s,l,1]);const c=ld(e,[n,s,0,1]),a=ld(e,[n,s,1,1]),g=c[2],v=a[2],w=g===v?0:((t||0)-g)/(v-g);return gC([],c,a,w)}function zH(r){const{width:e,height:t,bounds:n,minExtent:s=0,maxZoom:l=24,offset:c=[0,0]}=r,[[a,g],[v,w]]=n,P=UH(r.padding),I=Gp([a,Hx(w,-tc,tc)]),k=Gp([v,Hx(g,-tc,tc)]),N=[Math.max(Math.abs(k[0]-I[0]),s),Math.max(Math.abs(k[1]-I[1]),s)],D=[e-P.left-P.right-Math.abs(c[0])*2,t-P.top-P.bottom-Math.abs(c[1])*2];al(D[0]>0&&D[1]>0);const B=D[0]/N[0],U=D[1]/N[1],V=(P.right-P.left)/2/B,L=(P.top-P.bottom)/2/U,$=[(k[0]+I[0])/2+V,(k[1]+I[1])/2+L],te=yd($),G=Math.min(l,Mw(Math.abs(Math.min(B,U))));return al(Number.isFinite(G)),{longitude:te[0],latitude:te[1],zoom:G}}function UH(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(al(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const rA=Math.PI/180;function VH(r,e=0){const{width:t,height:n,unproject:s}=r,l={targetZ:e},c=s([0,n],l),a=s([t,n],l);let g,v;const w=r.fovy?.5*r.fovy*rA:Math.atan(.5/r.altitude),P=(90-r.pitch)*rA;return w>P-.01?(g=nA(r,0,e),v=nA(r,t,e)):(g=s([0,0],l),v=s([t,0],l)),[c,a,v,g]}function nA(r,e,t){const{pixelUnprojectionMatrix:n}=r,s=ld(n,[e,0,1,1]),l=ld(n,[e,r.height,1,1]),a=(t*r.distanceScales.unitsPerMeter[2]-s[2])/(l[2]-s[2]),g=gC([],s,l,a),v=yd(g);return v.push(t),v}const iA=512;function jH(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:s,latitude:l,zoom:c,bearing:a=0}=r;(s<-180||s>180)&&(s=tA(s+180,360)-180),(a<-180||a>180)&&(a=tA(a+180,360)-180);const g=Mw(t/iA);if(c<=g)c=g,l=0;else{const v=t/2/Math.pow(2,c),w=yd([0,v])[1];if(l<w)l=w;else{const P=yd([0,iA-v])[1];l>P&&(l=P)}}return{width:e,height:t,longitude:s,latitude:l,zoom:c,pitch:n,bearing:a}}const LC=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,WH=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,$H=`
${LC}
${WH}
`,HH=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,ZH=`
${LC}
${HH}
`,XH=dg(QH),qH=dg(JH),GH=[0,0,0,1],YH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function KH(r,e){const[t,n,s]=r,l=Dw([t,n,s],e);return Number.isFinite(s)?l:[l[0],l[1],0]}function QH({viewport:r,center:e}){return new Xo(r.viewProjectionMatrix).invert().transform(e)}function JH({viewport:r,shadowMatrices:e}){const t=[],n=r.pixelUnprojectionMatrix,s=r.isGeospatial?void 0:1,l=[[0,0,s],[r.width,0,s],[0,r.height,s],[r.width,r.height,s],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(c=>KH(c,n));for(const c of e){const a=c.clone().translate(new Ea(r.center).negate()),g=l.map(w=>a.transform(w)),v=new Xo().ortho({left:Math.min(...g.map(w=>w[0])),right:Math.max(...g.map(w=>w[0])),bottom:Math.min(...g.map(w=>w[1])),top:Math.max(...g.map(w=>w[1])),near:Math.min(...g.map(w=>-w[2])),far:Math.max(...g.map(w=>-w[2]))});t.push(v.multiplyRight(c))}return t}function eZ(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n=Rw.getUniforms(t),s=XH({viewport:t.viewport,center:n.center}),l=[],c=qH({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let g=0;g<r.shadowMatrices.length;g++){const v=c[g],w=v.clone().translate(new Ea(t.viewport.center).negate());n.coordinateSystem===Nn.LNGLAT&&n.projectionMode===ro.WEB_MERCATOR?(c[g]=w,l[g]=s):(c[g]=v.clone().multiplyRight(YH),l[g]=w.transform(s))}const a={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||GH,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let g=0;g<c.length;g++)a[`viewProjectionMatrix${g}`]=c[g],a[`projectCenter${g}`]=l[g];for(let g=0;g<2;g++)a[`shadow_uShadowMap${g}`]=r.shadowMaps&&r.shadowMaps[g]||r.dummyShadowMap;return a}const sA={name:"shadow",dependencies:[Rw],vs:$H,fs:ZH,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:eZ,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},tZ={...LS,defaultUniforms:{...LS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},rZ=[SC],nZ=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],iZ=[];function sZ(r){const e=Hc.getDefaultShaderAssembler();for(const n of rZ)e.addDefaultModule(n);e._hookFunctions.length=0;const t=r==="glsl"?nZ:iZ;for(const n of t)e.addShaderHook(n);return e}const oZ=[255,255,255],aZ=1;let lZ=0;class cZ{constructor(e={}){this.type="ambient";const{color:t=oZ}=e,{intensity:n=aZ}=e;this.id=e.id||`ambient-${lZ++}`,this.color=t,this.intensity=n}}const uZ=[255,255,255],hZ=1,dZ=[0,0,-1];let fZ=0;class oA{constructor(e={}){this.type="directional";const{color:t=uZ}=e,{intensity:n=hZ}=e,{direction:s=dZ}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${fZ++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new Ea(s).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class pZ{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Ow extends pZ{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,l=e.clearColor??(s?[0,0,0,0]:!1),c=s?1:!1,a=s?0:!1,g=e.colorMask??15,v={viewport:[0,0,t,n]};e.colorMask&&(v.colorMask=g),e.scissorRect&&(v.scissorRect=e.scissorRect);const w=this.device.beginRenderPass({framebuffer:e.target,parameters:v,clearColor:l,clearDepth:c,clearStencil:a});try{return this._drawLayers(w,e)}finally{w.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:s,viewports:l,views:c,onViewportActive:a,clearStack:g=!0}=t;t.pass=t.pass||"unknown",g&&(this._lastRenderIndex=-1);const v=[];for(const w of l){const P=c&&c[w.id];a?.(w);const I=this._getDrawLayerParams(w,t),k=w.subViewports||[w];for(const N of k){const D=this._drawLayersInViewport(e,{target:n,shaderModuleProps:s,viewport:N,view:P,pass:t.pass,layers:t.layers},I);v.push(D)}}return v}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:s=!1,layerFilter:l,cullRect:c,effects:a,shaderModuleProps:g},v=!1){const w=[],P=BC(this._lastRenderIndex+1),I={layer:t[0],viewport:e,isPicking:s,renderPass:n,cullRect:c},k={};for(let N=0;N<t.length;N++){const D=t[N],B=this._shouldDrawLayer(D,I,l,k),U={shouldDrawLayer:B};B&&!v&&(U.shouldDrawLayer=!0,U.layerRenderIndex=P(D,B),U.shaderModuleProps=this._getShaderModuleProps(D,a,n,g),U.layerParameters={...D.context.deck?.props.parameters,...this.getLayerParameters(D,N,e)}),w[N]=U}return w}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:s,target:l,viewport:c,view:a},g){const v=gZ(this.device,{shaderModuleProps:n,target:l,viewport:c});if(a){const{clear:P,clearColor:I,clearDepth:k,clearStencil:N}=a.props;if(P){let D=[0,0,0,0],B=1,U=0;Array.isArray(I)?D=[...I.slice(0,3),I[3]||255].map(L=>L/255):I===!1&&(D=!1),k!==void 0&&(B=k),N!==void 0&&(U=N),this.device.beginRenderPass({framebuffer:l,parameters:{viewport:v,scissorRect:v},clearColor:D,clearDepth:B,clearStencil:U}).end()}}const w={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:v});for(let P=0;P<t.length;P++){const I=t[P],k=g[P],{shouldDrawLayer:N}=k;if(N&&I.props.pickable&&w.pickableCount++,I.isComposite&&w.compositeCount++,I.isDrawable&&k.shouldDrawLayer){const{layerRenderIndex:D,shaderModuleProps:B,layerParameters:U}=k;w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,D),B.project&&(B.project.viewport=c),I.context.renderPass=e;try{I._drawLayer({renderPass:e,shaderModuleProps:B,uniforms:{layerIndex:D},parameters:U})}catch(V){I.raiseError(V,`drawing ${I} to ${s}`)}}}return w}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(t))return!1;t.layer=c,c=c.parent}if(n){const a=t.layer.id;if(a in s||(s[a]=n(t)),!s[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,s){const l=this.device.canvasContext.cssToDeviceRatio(),c=e.internalState?.propsInTransition||e.props,a={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:l,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const g of t)aA(a,g.getShaderModuleProps?.(e,a));return aA(a,this.getShaderModuleProps(e,t,a),s)}}function BC(r=0,e={}){const t={},n=(s,l)=>{const c=s.props._offset,a=s.id,g=s.parent&&s.parent.id;let v;if(g&&!(g in e)&&n(s.parent,!1),g in t){const w=t[g]=t[g]||BC(e[g],e);v=w(s,l),t[a]=w}else Number.isFinite(c)?(v=c+(e[g]||0),t[a]=null):v=r;return l&&v>=r&&(r=v+1),e[a]=v,v};return n}function gZ(r,{shaderModuleProps:e,target:t,viewport:n}){const s=e?.project?.devicePixelRatio??r.canvasContext.cssToDeviceRatio(),[,l]=r.canvasContext.getDrawingBufferSize(),c=t?t.height:l,a=n;return[a.x*s,c-(a.y+a.height)*s,a.width*s,a.height*s]}function aA(r,...e){for(const t of e)if(t)for(const n in t)r[n]?Object.assign(r[n],t[n]):r[n]=t[n];return r}class mZ extends Ow{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],l=s.width*n,c=s.height*n,a=[1,1,1,1];(l!==t.width||c!==t.height)&&t.resize({width:l,height:c}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const _Z={color:[255,255,255],intensity:1},lA=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],yZ=[0,0,0,200/255];class zC{constructor(e={}){this.id="lighting-effect",this.shadowColor=yZ,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(sA),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:t,viewports:n,onViewportActive:s,views:l,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},l=e.props.material;return{shadow:n,lighting:s,phongMaterial:l,gouraudMaterial:l}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(sA))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new Xo().lookAt({eye:new Ea(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new mZ(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new cZ(_Z),this.directionalLights.push(new oA(lA[0]),new oA(lA[1])))}}class vZ{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:s,padding:l=0,copy:c=!1,initialize:a=!1,maxCount:g}){const v=s||e&&e.constructor||Float32Array,w=t*n+l;if(ArrayBuffer.isView(e)){if(w<=e.length)return e;if(w*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,w)}let P=1/0;g&&(P=g*n+l);const I=this._allocate(v,w,a,P);return e&&c?I.set(e):a||I.fill(0,0,4),this._release(e),I}release(e){this._release(e)}_allocate(e,t,n,s){let l=Math.max(Math.ceil(t*this.opts.overAlloc),1);l>s&&(l=s);const c=this._pool,a=e.BYTES_PER_ELEMENT*l,g=c.findIndex(v=>v.byteLength>=a);if(g>=0){const v=new e(c.splice(g,1)[0],0,l);return n&&v.fill(0),v}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:s}=n,l=t.findIndex(c=>c.byteLength>=s);l<0?t.push(n):(l>0||t.length<this.opts.poolSize)&&t.splice(l,0,n),t.length>this.opts.poolSize&&t.shift()}}const Kp=new vZ;function pp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bZ(r,e){const t=r%e;return t<0?e+t:t}function xZ(r){return[r[12],r[13],r[14]]}function wZ(r){return{left:Wh(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:Wh(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:Wh(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:Wh(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:Wh(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:Wh(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const cA=new Ea;function Wh(r,e,t,n){cA.set(r,e,t);const s=cA.len();return{distance:n/s,normal:new Ea(-r/s,-e/s,-t/s)}}function TZ(r){return r-Math.fround(r)}let ip;function kb(r,e){const{size:t=1,startIndex:n=0}=e,s=e.endIndex!==void 0?e.endIndex:r.length,l=(s-n)/t;ip=Kp.allocate(ip,l,{type:Float32Array,size:t*2});let c=n,a=0;for(;c<s;){for(let g=0;g<t;g++){const v=r[c++];ip[a+g]=v,ip[a+g+t]=TZ(v)}a+=t*2}return ip.subarray(0,l*t*2)}function SZ(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const AZ=Math.PI/180,EZ=pp(),uA=[0,0,0],PZ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function IZ({width:r,height:e,orthographic:t,fovyRadians:n,focalDistance:s,padding:l,near:c,far:a}){const g=r/e,v=t?new Xo().orthographic({fovy:n,aspect:g,focalDistance:s,near:c,far:a}):new Xo().perspective({fovy:n,aspect:g,near:c,far:a});if(l){const{left:w=0,right:P=0,top:I=0,bottom:k=0}=l,N=ba((w+r-P)/2,0,r)-r/2,D=ba((I+e-k)/2,0,e)-e/2;v[8]-=N*2/r,v[9]+=D*2/e}return v}class Ld{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||PZ,this.focalDistance=e.focalDistance||1,this.position=e.position||uA,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ro.WEB_MERCATOR:ro.WEB_MERCATOR_AUTO_OFFSET:ro.IDENTITY}equals(e){return e instanceof Ld?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Xp(e.projectionMatrix,this.projectionMatrix)&&Xp(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),s=NC(n,this.pixelProjectionMatrix),[l,c]=s,a=t?c:this.height-c;return e.length===2?[l,a]:[l,a,s[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,l,c]=e,a=t?l:this.height-l,g=n&&n*this.distanceScales.unitsPerMeter[2],v=Dw([s,a,c],this.pixelUnprojectionMatrix,g),[w,P,I]=this.unprojectPosition(v);return Number.isFinite(c)?[w,P,I]:Number.isFinite(n)?[w,P,n]:[w,P]}projectPosition(e){const[t,n]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,s]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,s]}projectFlat(e){if(this.isGeospatial){const t=Gp(e);return t[1]=ba(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?yd(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),s=this.unproject([this.width,0],t),l=this.unproject([0,this.height],t),c=this.unproject([this.width,this.height],t);return[Math.min(n[0],s[0],l[0],c[0]),Math.min(n[1],s[1],l[1],c[1]),Math.max(n[0],s[0],l[0],c[0]),Math.max(n[1],s[1],l[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?Xx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,wZ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=NH({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Xx({latitude:n,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:l,modelMatrix:c}=e;let a=uA;if(l&&(a=c?new Xo(c).transformAsVector(l,[]):l),this.isGeospatial){const g=this.projectPosition([t,n,0]);this.center=new Ea(a).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=EZ,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:l,fovy:c=75,near:a=.1,far:g=1e3,padding:v=null,focalDistance:w=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Xo().multiplyRight(t).translate(new Ea(this.center).negate()),this.projectionMatrix=n||IZ({width:this.width,height:this.height,orthographic:s,fovyRadians:l||c*AZ,focalDistance:w,padding:v,near:a,far:g});const P=pp();ou(P,P,this.projectionMatrix),ou(P,P,this.viewMatrix),this.viewProjectionMatrix=P,this.viewMatrixInverse=Bx([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=xZ(this.viewMatrixInverse);const I=pp(),k=pp();Cw(I,I,[this.width/2,-this.height/2,1]),iy(I,I,[1,-1,0]),ou(k,I,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=Bx(pp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Vn.warn("Pixel project matrix not invertible")()}}Ld.displayName="Viewport";class gu extends Ld{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:s=0,pitch:l=0,bearing:c=0,nearZMultiplier:a=.1,farZMultiplier:g=1.01,nearZ:v,farZ:w,orthographic:P=!1,projectionMatrix:I,repeat:k=!1,worldOffset:N=0,position:D,padding:B,legacyMeterSizes:U=!1}=e;let{width:V,height:L,altitude:$=1.5}=e;const te=Math.pow(2,s);V=V||1,L=L||1;let G,le=null;if(I)$=I[5]/2,G=Yp($);else{e.fovy?(G=e.fovy,$=kw(G)):G=Yp($);let oe;if(B){const{top:be=0,bottom:xe=0}=B;oe=[0,ba((be+L-xe)/2,0,L)-L/2]}le=BH({width:V,height:L,scale:te,center:D&&[0,0,D[2]*T_(t)],offset:oe,pitch:l,fovy:G,nearZMultiplier:a,farZMultiplier:g}),Number.isFinite(v)&&(le.near=v),Number.isFinite(w)&&(le.far=w)}let se=LH({height:L,pitch:l,bearing:c,scale:te,altitude:$});N&&(se=new Xo().translate([512*N,0,0]).multiplyLeft(se)),super({...e,width:V,height:L,viewMatrix:se,longitude:n,latitude:t,zoom:s,...le,fovy:G,focalDistance:$}),this.latitude=t,this.longitude=n,this.zoom=s,this.pitch=l,this.bearing=c,this.altitude=$,this.fovy=G,this.orthographic=P,this._subViewports=k?[]:null,this._pseudoMeters=U,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=t;s<=n;s++){const l=s?new gu({...this,worldOffset:s}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),s=(e[2]||0)*T_(e[1]);return[t,n,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),s=(e[2]||0)/T_(n);return[t,n,s]}addMetersToLngLat(e,t){return FC(e,t)}panByPosition(e,t){const n=Dw(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),l=FS([],s,_$([],n)),c=FS([],this.center,l),[a,g]=this.unprojectFlat(c);return{longitude:a,latitude:g}}getBounds(e={}){const t=VH(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:s}=this,{longitude:l,latitude:c,zoom:a}=zH({width:n,height:s,bounds:e,...t});return new gu({width:n,height:s,longitude:l,latitude:c,zoom:a})}}gu.displayName="WebMercatorViewport";const hA=[0,0,0];function Db(r,e,t=!1){const n=e.projectPosition(r);if(t&&e instanceof gu){const[s,l,c=0]=r,a=e.getDistanceScales([s,l]);n[2]=c*a.unitsPerMeter[2]}return n}function CZ(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:s,fromCoordinateSystem:l,fromCoordinateOrigin:c}=r;return s===Nn.DEFAULT&&(s=e.isGeospatial?Nn.LNGLAT:Nn.CARTESIAN),l===void 0&&(l=s),c===void 0&&(c=n),{viewport:e,coordinateSystem:s,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:l,fromCoordinateOrigin:c}}function UC(r,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:s,offsetMode:l}){let[c,a,g=0]=r;switch(t&&([c,a,g]=Nd([],[c,a,g,1],t)),n){case Nn.LNGLAT:return Db([c,a,g],e,l);case Nn.LNGLAT_OFFSETS:return Db([c+s[0],a+s[1],g+(s[2]||0)],e,l);case Nn.METER_OFFSETS:return Db(FC(s,[c,a,g]),e,l);case Nn.CARTESIAN:default:return e.isGeospatial?[c+s[0],a+s[1],g+s[2]]:e.projectPosition([c,a,g])}}function RZ(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:s,modelMatrix:l,fromCoordinateSystem:c,fromCoordinateOrigin:a}=CZ(e),{autoOffset:g=!0}=e,{geospatialOrigin:v=hA,shaderCoordinateOrigin:w=hA,offsetMode:P=!1}=g?DC(t,n,s):{},I=UC(r,{viewport:t,modelMatrix:l,coordinateSystem:c,coordinateOrigin:a,offsetMode:P});if(P){const k=t.projectPosition(v||w);yC(I,I,k)}return I}let MZ=1,kZ=1;class VC{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:l=1}=e,c=MZ++,a={time:0,delay:t,duration:n,rate:s,repeat:l};return this._setChannelTime(a,this.time),this.channels.set(c,a),c}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:l,channel:c}=s;l.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=kZ++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,s=e.duration*e.repeat;n>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function DZ(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function OZ(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}let FZ=0;class Fw{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Ox.stats.get(`animation-loop-${FZ++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Fw.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new Ay({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=DZ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(OZ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,n=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Ob={};function fg(r="id"){Ob[r]=Ob[r]||1;const e=Ob[r]++;return`${r}-${e}`}class dA{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||fg("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ni.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function NZ(r,e){if(e instanceof dA)return e;const t=LZ(r,e),{attributes:n,bufferLayout:s}=BZ(r,e);return new dA({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:n})}function LZ(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:ni.INDEX,data:t})}function BZ(r,e){const t=[],n={};for(const[l,c]of Object.entries(e.attributes)){let a=l;switch(l){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(c){n[a]=r.createBuffer({data:c.value,id:`${l}-buffer`});const{value:g,size:v,normalized:w}=c;t.push({name:a,format:OW(g,v,w)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:s}}class Nw{static defaultProps={...su.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Nw(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...su.defaultProps,...e},n=this._renderPipelineCache,s=this._hashRenderPipeline(t);let l=n[s]?.pipeline;return l?(n[s].useCount++,this.debug&&zt.warn(`${this}: ${n[s].pipeline} reused, count=${n[s].useCount}, (id=${e.id})`)()):(l=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:fg("unnamed-cached")}),l.hash=s,n[s]={pipeline:l,useCount:1},this.debug&&zt.warn(`${this}: ${l} created, count=${n[s].useCount}`)()),l}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...Y_.defaultProps,...e},n=this._computePipelineCache,s=this._hashComputePipeline(t);let l=n[s]?.pipeline;return l?(n[s].useCount++,this.debug&&zt.warn(`${this}: ${n[s].pipeline} reused, count=${n[s].useCount}, (id=${e.id})`)()):(l=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),l.hash=s,n[s]={pipeline:l,useCount:1},this.debug&&zt.warn(`${this}: ${l} created, count=${n[s].useCount}`)()),l}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),n=e.hash;t[n].useCount--,t[n].useCount===0?(this._destroyPipeline(e),this.debug&&zt.warn(`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(zt.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&zt.warn(`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Y_&&(t=this._computePipelineCache),e instanceof su&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,n=this._getHash(e.shader.source);return`${t}/C/${n}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,s="-",l=this._getHash(JSON.stringify(e.bufferLayout)),{type:c}=this.device;switch(c){case"webgl":return`${c}/R/${t}/${n}V${s}BL${l}`;case"webgpu":default:const a=this._getHash(JSON.stringify(e.parameters));return`${c}/R/${t}/${n}V${s}T${e.topology}P${a}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Lw{static defaultProps={...Cy.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Lw(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&zt.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:s,useCount:1},this.debug&&zt.warn(`${this}: Created new shader ${s.id}`)()}return n.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy(),this.debug&&zt.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&zt.warn(`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function zZ(r,e){const t={},n="Values";if(r.attributes.length===0&&!r.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const s of r.attributes)if(s){const l=`${s.location} ${s.name}: ${s.type}`;t[`in ${l}`]={[n]:s.stepMode||"vertex"}}for(const s of r.varyings||[]){const l=`${s.location} ${s.name}`;t[`out ${l}`]={[n]:JSON.stringify(s)}}return t}let ss=null,Fb=null;function UZ(r,{id:e,minimap:t,opaque:n,top:s="0",left:l="0",rgbaScale:c=1}){ss||(ss=document.createElement("canvas"),ss.id=e,ss.title=e,ss.style.zIndex="100",ss.style.position="absolute",ss.style.top=s,ss.style.left=l,ss.style.border="blue 5px solid",ss.style.transform="scaleY(-1)",document.body.appendChild(ss),Fb=ss.getContext("2d")),(ss.width!==r.width||ss.height!==r.height)&&(ss.width=r.width/2,ss.height=r.height/2,ss.style.width="400px",ss.style.height="400px");const a=r.device.readPixelsToArrayWebGL(r),g=Fb?.createImageData(r.width,r.height);if(g){for(let w=0;w<a.length;w+=4)g.data[0+w+0]=a[w+0]*c,g.data[0+w+1]=a[w+1]*c,g.data[0+w+2]=a[w+2]*c,g.data[0+w+3]=n?255:a[w+3]*c;Fb?.putImageData(g,0,0)}}function qx(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!qx(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!qx(r[l],e[l],t-1))return!1;return!0}return!1}class Nb{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const s of t){const l=n.findIndex(c=>c.name===s.name);l<0?n.push(s):n[l]=s}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(n=>n.name===e);return t===-1&&zt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function VZ(r,e){const t=Object.fromEntries(r.attributes.map(s=>[s.name,s.location])),n=e.slice();return n.sort((s,l)=>{const c=s.attributes?s.attributes.map(w=>w.attribute):[s.name],a=l.attributes?l.attributes.map(w=>w.attribute):[l.name],g=Math.min(...c.map(w=>t[w])),v=Math.min(...a.map(w=>t[w]));return g-v}),n}function jZ(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function WZ(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function $Z(r){return jZ(r)||WZ(r)}function HZ(r){return $Z(r)||typeof r=="number"||typeof r=="boolean"}function ZZ(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];HZ(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class XZ{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const n=uw(Object.values(e).filter(s=>s.dependencies));for(const s of n)e[s.name]=s;zt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,l]of Object.entries(e))this._addModule(l),l.name&&s!==l.name&&!this.options.disableWarnings&&zt.warn(`Module name: ${s} vs ${l.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,s=e[n]||{},l=this.modules[n];if(!l){this.options.disableWarnings||zt.warn(`Module ${t} not found`)();continue}const c=this.moduleUniforms[n],a=this.moduleBindings[n],g=l.getUniforms?.(s,c)||s,{uniforms:v,bindings:w}=ZZ(g);this.moduleUniforms[n]={...c,...v},this.moduleBindings[n]={...a,...w}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[s,l]of Object.entries(n))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(l)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let qZ="";async function GZ(r,e){const t=new Image;return t.crossOrigin="anonymous",t.src=r.startsWith("http")?r:qZ+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const YZ=["+X","-X","+Y","-Y","+Z","-Z"],KZ=["+X","-X","+Y","-Y","+Z","-Z"];class Cp{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const n=fg("async-texture");this.props={...Cp.defaultProps,id:n,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=GZ(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((s,l)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=l}),this.initAsync(t)}async initAsync(e){const t=e.data,n=await jC(t).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!s)throw new Error("Texture size could not be determined");const l={...s,...e,data:void 0,mipLevels:1},c=this.device.getMipLevelCount(l.width,l.height);if(l.mipLevels=this.props.mipLevels==="auto"?c:Math.min(c,this.props.mipLevels),this.texture=this.device.createTexture(l),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),zt.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof du?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const n=Object.values(e)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&this.props.mipmaps!==!1&&zt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<n.length;s++){const l=n[s];this.device.isExternalImage(l)?this.texture.copyExternalImage({image:l,depth:t,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:l.data,mipLevel:s})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,s]of Object.entries(t)){const l=KZ.indexOf(n);this._setTexture2DData(s,l)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&zt.warn(`${this.id} has mipmap and multiple LODs.`)();const l=YZ.indexOf(n);this._setTexture2DData(t,l)}_normalizeTextureData(e){const t=this.texture;let n;return ArrayBuffer.isView(e)?n=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?n=e:n=[e],n}static defaultProps={...Qi.defaultProps,data:null,mipmaps:!1}}async function jC(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(jC));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),n=Object.keys(e),s={};for(let l=0;l<n.length;l++)s[n[l]]=t[l];return s}return r}const Vc=2,QZ=1e4;class Qp{static defaultProps={...su.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Hc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Qp.defaultProps,...t},t=this.props,this.id=t.id||fg("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map(g=>[g.name,g])||[]),s=t.shaderInputs||new XZ(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const l=eX(e),c=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:g,getUniforms:v}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:l,...this.props,modules:c});this.source=g,this._getModuleUniforms=v,this.props.shaderLayout||=a$(this.source)}else{const{vs:g,fs:v,getUniforms:w}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:l,...this.props,modules:c});this.vs=g,this.fs=v,this._getModuleUniforms=w}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Nw.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Lw.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return zt.info(Vc,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:l}=this.vertexArray,c=l?l.byteLength/(l.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&NZ(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const n=new Nb(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Nb(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){qx(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new M9(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(JZ(n)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=t?.disableWarnings??this.props.disableWarnings;e.indices&&zt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=VZ(this.pipeline.shaderLayout,this.bufferLayout);const s=new Nb(this.bufferLayout);for(const[l,c]of Object.entries(e)){const a=s.getBufferLayout(l);if(!a){n||zt.warn(`Model(${this.id}): Missing layout for buffer "${l}".`)();continue}const g=s.getAttributeNamesForBuffer(a);let v=!1;for(const w of g){const P=this._attributeInfos[w];if(P){const I=this.device.type==="webgpu"?s.getBufferIndex(P.bufferName):P.location;this.vertexArray.setBuffer(I,c),v=!0}}!v&&!n&&zt.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${l}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,s]of Object.entries(e)){const l=this._attributeInfos[n];l?this.vertexArray.setConstantWebGL(l.location,s):(t?.disableWarnings??this.props.disableWarnings)||zt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Cp&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Cp?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Iy?e=Math.max(e,t.texture.updateTimestamp):t instanceof ni||t instanceof Qi?e=Math.max(e,t.updateTimestamp):t instanceof Cp?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof du||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(zt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=HI(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=zt.level>3?0:QZ;zt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,zt.group(Vc,`>>> DRAWING MODEL ${this.id}`,{collapsed:zt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=zZ(this.pipeline.shaderLayout,this.id);zt.table(Vc,e)();const t=this.shaderInputs.getDebugTable();zt.table(Vc,t)();const n=this._getAttributeDebugTable();zt.table(Vc,this._attributeInfos)(),zt.table(Vc,n)(),zt.groupEnd(Vc)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&UZ(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=dw(t);return(e instanceof ni?new n(e.debugData):e).toString()}}function JZ(r){return!!(r.uniformTypes&&!tX(r.uniformTypes))}function eX(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function tX(r){for(const e in r)return!1;return!0}class vd{device;model;transformFeedback;static defaultProps={...Qp.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=vd.defaultProps){if(!vd.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Qp(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||EW(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof ni)return t.readAsync();const{buffer:n,byteOffset:s=0,byteLength:l=n.byteLength}=t;return n.readAsync(s,l)}}class rX{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:n=null,vertexCount:s=null}=e;this.id=e.id||fg("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[l,c]of Object.entries(t)){const a=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(l)}: must be typed array or object with value as typed array`);if((l==="POSITION"||l==="positions")&&!a.size&&(a.size=3),l==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[l]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const s of Object.values(e)){const{value:l,size:c,constant:a}=s;!a&&l&&c!==void 0&&c>=1&&(n=Math.min(n,l.length/c))}return n}}const nX={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class WC extends Ow{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:l,pickingFBO:c,deviceRect:{x:a,y:g,width:v,height:w},cullRect:P,effects:I,pass:k="picking",pickZ:N,shaderModuleProps:D}){this.pickZ=N;const B=this._resetColorEncoder(N),U=[a,g,v,w],V=super.render({target:c,layers:e,layerFilter:t,views:n,viewports:s,onViewportActive:l,cullRect:P,effects:I?.filter($=>$.useInPicking),pass:k,isPicking:!0,shaderModuleProps:D,clearColor:[0,0,0,0],colorMask:15,scissorRect:U});return this._colorEncoderState=null,{decodePickingColor:B&&sX.bind(null,B),stats:V}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const s={...e.props.parameters},{pickable:l,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?s.blend=!1:l&&c.includes("draw")&&(Object.assign(s,nX),s.blend=!0,s.blendColor=iX(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function iX(r,e,t){const{byLayer:n,byAlpha:s}=r;let l,c=n.get(e);return c?(c.viewports.push(t),l=c.a):(l=n.size+1,l<=255?(c={a:l,layer:e,viewports:[t]},n.set(e,c),s[l]=c):(Vn.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function sX(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const qh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},ay=Symbol.for("component"),au=Symbol.for("propTypes"),Lb=Symbol.for("deprecatedProps"),cd=Symbol.for("asyncPropDefaults"),mu=Symbol.for("asyncPropOriginal"),rc=Symbol.for("asyncPropResolved");function bd(r,e=()=>!0){return Array.isArray(r)?$C(r,e,[]):e(r)?[r]:[]}function $C(r,e,t){let n=-1;for(;++n<r.length;){const s=r[n];Array.isArray(s)?$C(s,e,t):e(s)&&t.push(s)}return t}function oX({target:r,source:e,start:t=0,count:n=1}){const s=e.length,l=n*s;let c=0;for(let a=t;c<s;c++)r[a++]=e[c];for(;c<l;)c<l-c?(r.copyWithin(t+c,t,t+c),c*=2):(r.copyWithin(t+c,t,t+l-c),c=l);return r}class aX{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let s=e;typeof e=="string"&&(s=Z_(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class lX{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:s=!0}){let l=this._resources[e];l?l.setData(t,n):(l=new aX(e,t,this._context),this._resources[e]=l),l.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const s=t[n],l=this._resources[s.resourceId];l&&l.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:s="default"}){const{_resources:l,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=l[e];if(this._track(n,s,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,s){const l=this._consumers,c=l[e]=l[e]||{};let a=c[t];const g=a&&a.resourceId&&this._resources[a.resourceId];g&&(g.unsubscribe(a),this.prune()),n&&(a?(a.onChange=s,a.resourceId=n.id):a={onChange:s,resourceId:n.id},c[t]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const cX="layerManager.setLayers",uX="layerManager.activateViewport";class hX{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Cs(uX,this,a),a&&(this.context.viewport=a)};const{deck:n,stats:s,viewport:l,timeline:c}=t||{};this.layers=[],this.resourceManager=new lX({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:sZ(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[f7],renderPass:void 0,stats:s||new Ay({id:"deck.gl"}),viewport:l||new Ld({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new VC,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Cs(cX,this,t,e),this._lastRenderedLayers=e;const n=bd(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(s=>s.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const c of e)n[c.id]?Vn.warn(`Multiple old layers with same id ${c.id}`)():n[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,n,s),this._finalizeOldLayers(n);let l=!1;for(const c of s)if(c.hasUniformTransition()){l=`Uniform transition in ${c}`;break}this._needsUpdate=l,this.layers=s}_updateSublayersRecursively(e,t,n){for(const s of e){s.context=this.context;const l=t[s.id];l===null&&Vn.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let c=null;try{this._debug&&l!==s&&s.validateProps(),l?(this._transferLayerState(l,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),c=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}c&&this._updateSublayersRecursively(c,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=qh.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=qh.MATCHED,t!==e&&(e.lifecycle=qh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=qh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=qh.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function vo(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!vo(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!vo(r[l],e[l],t-1))return!1;return!0}return!1}class dX{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let l=n.length-1;l>=0;--l){const c=n[l];if(c.containsPixel(s)){const a=e.slice();return a[0]-=c.x,a[1]-=c.y,c.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=bd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!vo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Vn.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>this.getView(e.id)?.makeViewport({viewState:l,width:this.width,height:this.height})})}_updateController(e,t,n,s){const l=e.controller;if(l&&n){const c={...t,...l,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==l.type)&&(s=this._createController(e,c)),s&&s.setProps(c),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const l=e[s],c=this.getViewState(l),a=l.makeViewport({viewState:c,width:this.width,height:this.height});let g=t[l.id];const v=!!l.controller;v&&!g&&(n=!0),(n||!v)&&g&&(g.finalize(),g=null),this.controllers[l.id]=this._updateController(l,c,a,g),a&&this._viewports.unshift(a)}for(const s in t){const l=t[s];l&&!this.controllers[s]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,s)=>!e[s].equals(t[s]))}}const fX=/([0-9]+\.?[0-9]*)(%|px)/;function Hl(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=fX.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function Zl(r,e){return r.relative?Math.round(r.position*e):r.position}class HC{constructor(e){const{id:t,x:n=0,y:s=0,width:l="100%",height:c="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Hl(n),this._y=Hl(s),this._width=Hl(l),this._height=Hl(c),this._padding=a&&{left:Hl(a.left||0),right:Hl(a.right||0),top:Hl(a.top||0),bottom:Hl(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&vo(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const l=this.getViewportType(n);return new l({...n,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:Zl(this._x,e),y:Zl(this._y,t),width:Zl(this._width,e),height:Zl(this._height,t)};return this._padding&&(n.padding={left:Zl(this._padding.left,e),top:Zl(this._padding.top,t),right:Zl(this._padding.right,e),bottom:Zl(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ky{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fA=()=>{},Gx={BREAK:1,SNAP_TO_END:2,IGNORE:3},pX=r=>r,gX=Gx.BREAK;class mX{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:s,startProps:l,endProps:c,duration:a,easing:g}}=t,v=g(n/a),w=s.interpolateProps(l,c,v);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ky(e.timeline),this.onViewStateChange=e.onViewStateChange||fA,this.onStateChange=e.onStateChange||fA}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:l,endProps:c}=this.transition.settings;s={...n,...l===Gx.SNAP_TO_END?c:this.propsInTransition||n}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Gx.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(n),l=t.transitionInterpolator,c=l.getDuration?l.getDuration(e,t):t.transitionDuration;if(c===0)return;const a=l.initializeProps(e,s);this.propsInTransition={};const g={duration:c,easing:t.transitionEasing||pX,interpolator:l,interruption:t.transitionInterruption||gX,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Ji(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class _X{constructor(e){const{compare:t,extract:n,required:s}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=s}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Xp(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},s={};for(const l of this._propsToExtract)(l in e||l in t)&&(n[l]=e[l],s[l]=t[l]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Ji(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const yX=["longitude","latitude","zoom","bearing","pitch"],vX=["longitude","latitude","zoom"];class Bw extends _X{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:yX,required:vX},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:s,around:l}=this.opts;if(s&&l){const c=s(e),a=s(t),g=c.unproject(l);n.start.around=l,Object.assign(n.end,{around:a.project(g),aroundPosition:g,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const s={};for(const l of this._propsToExtract)s[l]=ny(e[l]||0,t[l]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...t,...s});Object.assign(s,l.panByPosition(t.aroundPosition,ny(e.around,t.around,n)))}return s}}const Ga={transitionDuration:0},bX=300,Jm=r=>1-(1-r)*(1-r),$h={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},jc={};class ZC{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new mX({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-n]}isPointInBounds(e,t){const{width:n,height:s}=this.props;if(t&&t.handled)return!1;const l=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return l&&t&&t.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?bX:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:l=!0,doubleClickZoom:c=!0,touchZoom:a=!0,touchRotate:g=!1,keyboard:v=!0}=e,w=!!this.onViewStateChange;this.toggleEvents($h.WHEEL,w&&n),this.toggleEvents($h.PAN,w),this.toggleEvents($h.PINCH,w&&(a||g)),this.toggleEvents($h.MULTI_PAN,w&&g),this.toggleEvents($h.DOUBLE_CLICK,w&&c),this.toggleEvents($h.KEYBOARD,w&&v),this.scrollZoom=n,this.dragPan=s,this.dragRotate=l,this.doubleClickZoom=c,this.touchZoom=a,this.touchRotate=g,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const s={...e.getViewportProps(),...t},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),l){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(s,Ga,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Ga,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],l=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Jm},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Ga,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],l=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Jm},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let c=2/(1+Math.exp(-Math.abs(l*n)));l<0&&c!==0&&(c=1/c);const a=s?{...this._getTransitionProps({around:t}),transitionDuration:250}:Ga,g=this.controllerState.zoom({pos:t,scale:c});return this.updateViewport(g,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Ga,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Ga,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*t/2],l=this.controllerState.rotate({pos:s});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Jm},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return jc._startPinchRotation=e.rotation,jc._lastPinchEvent=e,this.updateViewport(n,Ga,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:jc._startPinchRotation-n})}return this.updateViewport(t,Ga,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),jc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=jc;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const s=this.getCenter(e);let l=this.controllerState.rotateEnd();const c=Math.log2(e.scale),a=(c-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),g=Math.pow(2,c+a*t/2);l=l.zoom({pos:s,scale:g}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:Jm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return jc._startPinchRotation=null,jc._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:l,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let g;const v={};switch(e.srcEvent.code){case"Minus":g=t?a.zoomOut(n).zoomOut(n):a.zoomOut(n),v.isZooming=!0;break;case"Equal":g=t?a.zoomIn(n).zoomIn(n):a.zoomIn(n),v.isZooming=!0;break;case"ArrowLeft":t?(g=a.rotateLeft(l),v.isRotating=!0):(g=a.moveLeft(s),v.isPanning=!0);break;case"ArrowRight":t?(g=a.rotateRight(l),v.isRotating=!0):(g=a.moveRight(s),v.isPanning=!0);break;case"ArrowUp":t?(g=a.rotateUp(c),v.isRotating=!0):(g=a.moveUp(s),v.isPanning=!0);break;case"ArrowDown":t?(g=a.rotateDown(c),v.isRotating=!0):(g=a.moveDown(s),v.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Ga:e?{...t,transitionInterpolator:new Bw({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class xX{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const pA=5,wX=1.2;class XC extends xX{constructor(e){const{width:t,height:n,latitude:s,longitude:l,zoom:c,bearing:a=0,pitch:g=0,altitude:v=1.5,position:w=[0,0,0],maxZoom:P=20,minZoom:I=0,maxPitch:k=60,minPitch:N=0,startPanLngLat:D,startZoomLngLat:B,startRotatePos:U,startBearing:V,startPitch:L,startZoom:$,normalize:te=!0}=e;Ji(Number.isFinite(l)),Ji(Number.isFinite(s)),Ji(Number.isFinite(c)),super({width:t,height:n,latitude:s,longitude:l,zoom:c,bearing:a,pitch:g,altitude:v,maxZoom:P,minZoom:I,maxPitch:k,minPitch:N,normalize:te,position:w},{startPanLngLat:D,startZoomLngLat:B,startRotatePos:U,startBearing:V,startPitch:L,startZoom:$}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:l,startPitch:c}=this.getState();if(!s||l===void 0||c===void 0)return this;let a;return e?a=this._getNewRotation(e,s,c,l):a={bearing:l+t,pitch:c+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:s,startZoomLngLat:l}=this.getState();if(l||(s=this.getViewportProps().zoom,l=this._unproject(t)||this._unproject(e)),!l)return this;const{maxZoom:c,minZoom:a}=this.getViewportProps();let g=s+Math.log2(n);g=ba(g,a,c);const v=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,...v.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:l}=n;return Math.abs(s-t.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(l-t.longitude)>180&&(n.longitude=l<0?l+360:l-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=ba(s,n,t);const{maxPitch:l,minPitch:c,pitch:a}=e;e.pitch=ba(a,c,l);const{normalize:g=!0}=e;return g&&Object.assign(e,jH(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,s){const l=e[0]-t[0],c=e[1]-t[1],a=e[1],g=t[1],{width:v,height:w}=this.getViewportProps(),P=l/v;let I=0;c>0?Math.abs(w-g)>pA&&(I=c/(g-w)*wX):c<0&&g>pA&&(I=1-a/g),I=ba(I,-1,1);const{minPitch:k,maxPitch:N}=this.getViewportProps(),D=s+180*P;let B=n;return I>0?B=n+I*(N-n):I<0&&(B=n-I*(k-n)),{pitch:B,bearing:D}}}class TX extends ZC{constructor(){super(...arguments),this.ControllerState=XC,this.transition={transitionDuration:300,transitionInterpolator:new Bw({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class zw extends HC{constructor(e={}){super(e)}getViewportType(){return gu}get ControllerType(){return TX}}zw.displayName="MapView";const SX=new zC;function AX(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class EX{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(s=>AX(s,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(vo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const n=[];for(const s of e){const l=t[s.id];let c=s;l&&l!==s?l.setProps?(l.setProps(s.props),c=l):l.cleanup(this._context):l||s.setup(this._context),n.push(c),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(s=>s instanceof zC)||this._resolvedEffects.push(SX),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class PX extends Ow{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const IX="deckRenderer.renderLayers";class CX{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new PX(e),this.pickLayersPass=new WC(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const l=t.render({...n,target:s});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Cs(IX,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,s]=t;e.length===0&&[0,1].map(l=>{const c=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:s});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${l}`,colorAttachments:[c]}))});for(const l of e)l.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,s={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const l of e)if(l.postRender){s.target=l.id===this.lastPostProcessEffect?t.target:void 0;const c=l.postRender(s);s.inputBuffer=c,s.swapBuffer=c===n[0]?n[1]:n[0]}}}const RX={pickedColor:null,pickedObjectIndex:-1};function gA({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:s,deviceRect:l}){const{x:c,y:a,width:g,height:v}=l;let w=s*s,P=-1,I=0;for(let k=0;k<v;k++){const N=k+a-n,D=N*N;if(D>w)I+=4*g;else for(let B=0;B<g;B++){if(r[I+3]-1>=0){const V=B+c-t,L=V*V+D;L<=w&&(w=L,P=I)}I+=4}}if(P>=0){const k=r.slice(P,P+4),N=e(k);if(N){const D=Math.floor(P/4/g),B=P/4-D*g;return{...N,pickedColor:k,pickedX:c+B,pickedY:a+D}}Vn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return RX}function mA({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let n=0;n<r.length;n+=4)if(r[n+3]-1>=0){const l=r.slice(n,n+4),c=l.join(",");if(!t.has(c)){const a=e(l);a?t.set(c,{...a,color:l}):Vn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Yx({pickInfo:r,viewports:e,pixelRatio:t,x:n,y:s,z:l}){let c=e[0];e.length>1&&(c=MX(r?.pickedViewports||e,{x:n,y:s}));let a;if(c){const g=[n-c.x,s-c.y];l!==void 0&&(g[2]=l),a=c.unproject(g)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:a,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function _A(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:s}=r,{pickedColor:l,pickedLayer:c,pickedObjectIndex:a}=e,g=c?[c]:[];if(n==="hover"){const P=t.index,I=t.layerId,k=c?c.props.id:null;if(k!==I||a!==P){if(k!==I){const N=s.find(D=>D.props.id===I);N&&g.unshift(N)}t.layerId=k,t.index=a,t.info=null}}const v=Yx(r),w=new Map;return w.set(null,v),g.forEach(P=>{let I={...v};P===c&&(I.color=l,I.index=a,I.picked=!0),I=Kx({layer:P,info:I,mode:n});const k=I.layer;P===c&&n==="hover"&&(t.info=I),w.set(k.id,I),n==="hover"&&k.updateAutoHighlight(I)}),w}function Kx({layer:r,info:e,mode:t}){for(;r&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:n}),r=r.parent}return e}function MX(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class kX{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new WC(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:s},l=this.lastPickedInfo.info){const c=l&&l.layer&&l.layer.id,a=l&&l.viewport&&l.viewport.id,g=c?n.find(I=>I.id===c):null,v=a&&s.find(I=>I.id===a)||s[0],w=v&&v.unproject([e-v.x,t-v.y]);return{...l,...{x:e,y:t,viewport:v,coordinate:w,layer:g}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:s,y:l,radius:c=0,depth:a=1,mode:g="query",unproject3D:v,onViewportActive:w,effects:P}){const I=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||n.length===0)return{result:[],emptyInfo:Yx({viewports:n,x:s,y:l,pixelRatio:I})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([s,l],!0),D=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],B=Math.round(c*I),{width:U,height:V}=this.pickingFBO,L=this._getPickingRect({deviceX:D[0],deviceY:D[1],deviceRadius:B,deviceWidth:U,deviceHeight:V}),$={x:s-c,y:l-c,width:c*2+1,height:c*2+1};let te;const G=[],le=new Set;for(let se=0;se<a;se++){let oe;if(L){const xe=this._drawAndSample({layers:k,views:t,viewports:n,onViewportActive:w,deviceRect:L,cullRect:$,effects:P,pass:`picking:${g}`});oe=gA({...xe,deviceX:D[0],deviceY:D[1],deviceRadius:B,deviceRect:L})}else oe={pickedColor:null,pickedObjectIndex:-1};let be;if(oe.pickedLayer&&v&&this.depthFBO){const{pickedColors:xe}=this._drawAndSample({layers:[oe.pickedLayer],views:t,viewports:n,onViewportActive:w,deviceRect:{x:oe.pickedX,y:oe.pickedY,width:1,height:1},cullRect:$,effects:P,pass:`picking:${g}:z`},!0);xe[3]&&(be=xe[0])}oe.pickedLayer&&se+1<a&&(le.add(oe.pickedLayer),oe.pickedLayer.disablePickingIndex(oe.pickedObjectIndex)),te=_A({pickInfo:oe,lastPickedInfo:this.lastPickedInfo,mode:g,layers:k,viewports:n,x:s,y:l,z:be,pixelRatio:I});for(const xe of te.values())xe.layer&&G.push(xe);if(!oe.pickedColor)break}for(const se of le)se.restorePickingColors();return{result:G,emptyInfo:te.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:s,y:l,radius:c=0,depth:a=1,mode:g="query",unproject3D:v,onViewportActive:w,effects:P}){const I=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||n.length===0)return{result:[],emptyInfo:Yx({viewports:n,x:s,y:l,pixelRatio:I})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([s,l],!0),D=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],B=Math.round(c*I),{width:U,height:V}=this.pickingFBO,L=this._getPickingRect({deviceX:D[0],deviceY:D[1],deviceRadius:B,deviceWidth:U,deviceHeight:V}),$={x:s-c,y:l-c,width:c*2+1,height:c*2+1};let te;const G=[],le=new Set;for(let se=0;se<a;se++){let oe;if(L){const xe=this._drawAndSample({layers:k,views:t,viewports:n,onViewportActive:w,deviceRect:L,cullRect:$,effects:P,pass:`picking:${g}`});oe=gA({...xe,deviceX:D[0],deviceY:D[1],deviceRadius:B,deviceRect:L})}else oe={pickedColor:null,pickedObjectIndex:-1};let be;if(oe.pickedLayer&&v&&this.depthFBO){const{pickedColors:xe}=this._drawAndSample({layers:[oe.pickedLayer],views:t,viewports:n,onViewportActive:w,deviceRect:{x:oe.pickedX,y:oe.pickedY,width:1,height:1},cullRect:$,effects:P,pass:`picking:${g}:z`},!0);xe[3]&&(be=xe[0])}oe.pickedLayer&&se+1<a&&(le.add(oe.pickedLayer),oe.pickedLayer.disablePickingIndex(oe.pickedObjectIndex)),te=_A({pickInfo:oe,lastPickedInfo:this.lastPickedInfo,mode:g,layers:k,viewports:n,x:s,y:l,z:be,pixelRatio:I});for(const xe of te.values())xe.layer&&G.push(xe);if(!oe.pickedColor)break}for(const se of le)se.restorePickingColors();return{result:G,emptyInfo:te.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:s,y:l,width:c=1,height:a=1,mode:g="query",maxObjects:v=null,onViewportActive:w,effects:P}){const I=this._getPickable(e);if(!I||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([s,l],!0),D=N.x,B=N.y+N.height,U=this.device.canvasContext.cssToDevicePixels([s+c,l+a],!0),V=U.x+U.width,L=U.y,$={x:D,y:L,width:V-D,height:B-L},te=this._drawAndSample({layers:I,views:t,viewports:n,onViewportActive:w,deviceRect:$,cullRect:{x:s,y:l,width:c,height:a},effects:P,pass:`picking:${g}`}),G=mA(te),le=new Map,se=[],oe=Number.isFinite(v);for(let be=0;be<G.length&&!(oe&&se.length>=v);be++){const xe=G[be];let _e={color:xe.pickedColor,layer:null,index:xe.pickedObjectIndex,picked:!0,x:s,y:l,pixelRatio:k};_e=Kx({layer:xe.pickedLayer,info:_e,mode:g});const Ne=_e.layer.id;le.has(Ne)||le.set(Ne,new Set);const fe=le.get(Ne),Le=_e.object??_e.index;fe.has(Le)||(fe.add(Le),se.push(_e))}return se}_pickVisibleObjects({layers:e,views:t,viewports:n,x:s,y:l,width:c=1,height:a=1,mode:g="query",maxObjects:v=null,onViewportActive:w,effects:P}){const I=this._getPickable(e);if(!I||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([s,l],!0),D=N.x,B=N.y+N.height,U=this.device.canvasContext.cssToDevicePixels([s+c,l+a],!0),V=U.x+U.width,L=U.y,$={x:D,y:L,width:V-D,height:B-L},te=this._drawAndSample({layers:I,views:t,viewports:n,onViewportActive:w,deviceRect:$,cullRect:{x:s,y:l,width:c,height:a},effects:P,pass:`picking:${g}`}),G=mA(te),le=new Map,se=[],oe=Number.isFinite(v);for(let be=0;be<G.length&&!(oe&&se.length>=v);be++){const xe=G[be];let _e={color:xe.pickedColor,layer:null,index:xe.pickedObjectIndex,picked:!0,x:s,y:l,pixelRatio:k};_e=Kx({layer:xe.pickedLayer,info:_e,mode:g});const Ne=_e.layer.id;le.has(Ne)||le.set(Ne,new Set);const fe=le.get(Ne),Le=_e.object??_e.index;fe.has(Le)||(fe.add(Le),se.push(_e))}return se}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:s,deviceRect:l,cullRect:c,effects:a,pass:g},v=!1){const w=v?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:s,pickingFBO:w,deviceRect:l,cullRect:c,effects:a,pass:g,pickZ:v,preRenderStats:{},isPicking:!0};for(const V of a)V.useInPicking&&(P.preRenderStats[V.id]=V.preRender(P));const{decodePickingColor:I}=this.pickLayersPass.render(P),{x:k,y:N,width:D,height:B}=l,U=new(v?Float32Array:Uint8Array)(D*B*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:k,sourceY:N,sourceWidth:D,sourceHeight:B,target:U}),{pickedColors:U,decodePickingColor:I}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:s,deviceRect:l,cullRect:c,effects:a,pass:g},v=!1){const w=v?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:s,pickingFBO:w,deviceRect:l,cullRect:c,effects:a,pass:g,pickZ:v,preRenderStats:{},isPicking:!0};for(const V of a)V.useInPicking&&(P.preRenderStats[V.id]=V.preRender(P));const{decodePickingColor:I}=this.pickLayersPass.render(P),{x:k,y:N,width:D,height:B}=l,U=new(v?Float32Array:Uint8Array)(D*B*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:k,sourceY:N,sourceWidth:D,sourceHeight:B,target:U}),{pickedColors:U,decodePickingColor:I}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:s,deviceHeight:l}){const c=Math.max(0,e-n),a=Math.max(0,t-n),g=Math.min(s,e+n+1)-c,v=Math.min(l,t+n+1)-a;return g<=0||v<=0?null:{x:c,y:a,width:g,height:v}}}const DX={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},OX="top-left",yA="__root";class FX{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!vo(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const n=e.reduce((s,l)=>(s[l.id]=l,s),{});for(const s of this.getWidgets()){const{viewId:l}=s;if(l){const c=n[l];c&&(s.onViewportChange&&s.onViewportChange(c),s.onRedraw?.({viewports:[c],layers:t}))}else{if(s.onViewportChange)for(const c of e)s.onViewportChange(c);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){const{viewId:s}=n;(!s||s===e.viewport?.id)&&n.onHover?.(e,t)}}onEvent(e,t){const n=$x[t.type];if(n)for(const s of this.getWidgets()){const{viewId:l}=s;(!l||l===e.viewport?.id)&&s[n]?.(e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const s=t[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._removeWidget(s),this._addWidget(n)):n!==s&&(s.setProps(n.props),n=s):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const s=t[n];s&&this._removeWidget(s)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=OX}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){const n=e||yA;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[n]=s);let l=s.querySelector(`.${t}`);return l||(l=globalThis.document.createElement("div"),l.className=t,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,DX[t]),s.append(l)),l}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,l=n===yA||s,c=this.containers[n];l?(c.style.display="block",c.style.left=`${s?s.x:0}px`,c.style.top=`${s?s.y:0}px`,c.style.width=`${s?s.width:e}px`,c.style.height=`${s?s.height:t}px`):c.style.display="none"}}}function vA(r,e){e&&Object.entries(e).map(([t,n])=>{t.startsWith("--")?r.style.setProperty(t,n):r.style[t]=n})}function NX(r,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?r.style.removeProperty(t):r.style[t]=""})}class Uw{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!vo(t.style,e.style,1)&&(NX(n,t.style),vA(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>t.classList.add(n)),vA(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Uw.defaultProps={id:"widget",style:{},className:""};const LX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class qC extends Uw{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,LX),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const s=n(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,n){const s=this.rootElement;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}qC.defaultProps={...Uw.defaultProps};var Qh;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Qh||(Qh={}));const BX={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},zX=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),UX=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),VX=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return r.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return r.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return r.vertexAttribDivisor(...e)}});function jX(r=!0){const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",n);return s instanceof HTMLElement&&WX(s),s}return this.originalGetContext(t,n)}}function WX(r){r.getExtension("EXT_color_buffer_float");const e={...BX,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:zX(r),OES_vertex_array_object:UX(r),ANGLE_instanced_arrays:VX(r)},t=r.getExtension;r.getExtension=function(s){const l=t.call(r,s);return l||(s in e?e[s]:null)};const n=r.getSupportedExtensions;r.getSupportedExtensions=function(){return(n.apply(r)||[])?.concat(Object.keys(e))}}async function GC(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((s,l)=>{n.onload=s,n.onerror=c=>l(new Error(`Unable to load script '${r}': ${c}`)),t.appendChild(n)})}const $X=1;let Gs=null,bA=!1;const Vw={debugSpectorJS:zt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function HX(r){if(!globalThis.SPECTOR)try{await GC(r.debugSpectorJSUrl||Vw.debugSpectorJSUrl)}catch(e){zt.warn(String(e))}}function ZX(r){if(r={...Vw,...r},!r.debugSpectorJS)return null;if(!Gs&&globalThis.SPECTOR&&!globalThis.luma?.spector){zt.probe($X,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Gs=new e,globalThis.luma&&(globalThis.luma.spector=Gs)}if(!Gs)return null;if(bA||(bA=!0,Gs.spyCanvases(),Gs?.onCaptureStarted.add(e=>zt.info("Spector capture started:",e)()),Gs?.onCapture.add(e=>{zt.info("Spector capture complete:",e)(),Gs?.getResultUI(),Gs?.resultView.display(),Gs?.resultView.addCapture(e)})),r.gl){const e=r.gl,t=e.device;Gs?.startCapture(r.gl,500),e.device=t,new Promise(n=>setTimeout(n,2e3)).then(n=>{zt.info("Spector capture stopped after 2 seconds")(),Gs?.stopCapture()})}return Gs}const XX="https://unpkg.com/webgl-debug@2.0.1/index.js";function YC(r){return r.luma=r.luma||{},r.luma}async function qX(){Tu()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await GC(XX))}function GX(r,e={}){return e.debugWebGL||e.traceWebGL?KX(r,e):YX(r)}function YX(r){const e=YC(r);return e.realContext?e.realContext:r}function KX(r,e){if(!globalThis.WebGLDebugUtils)return zt.warn("webgl-debug not loaded")(),r;const t=YC(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Qh,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,QX.bind(null,e),JX.bind(null,e));for(const c in Qh)!(c in n)&&typeof Qh[c]=="number"&&(n[c]=Qh[c]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(s,n);const l=Object.create(s);return t.realContext=r,t.debugContext=l,l.debug=!0,l}function xA(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function QX(r,e,t,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),c=`${s} in gl.${t}(${l})`;zt.error(c)();debugger}function JX(r,e,t){let n="";zt.level>=1&&(n=xA(e,t),r.traceWebGL&&zt.log(1,n)());for(const s of t)if(s===void 0){n=n||xA(e,t);debugger}}const e_=1;class eq extends KW{type="webgl";constructor(){super(),hu.defaultProps={...hu.defaultProps,...Vw}}enforceWebGL2(e){jX(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&zt.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await kT(async()=>{const{WebGLDevice:l}=await Promise.resolve().then(()=>LA);return{WebGLDevice:l}},void 0,import.meta.url);if(e instanceof n)return e;if(e?.device instanceof n)return e.device;if(!tq(e))throw new Error("Invalid WebGL2RenderingContext");const s=t.createCanvasContext===!0?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...s}})}async create(e={}){const{WebGLDevice:t}=await kT(async()=>{const{WebGLDevice:n}=await Promise.resolve().then(()=>LA);return{WebGLDevice:n}},void 0,import.meta.url);zt.groupCollapsed(e_,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(qX()),e.debugSpectorJS&&n.push(HX(e));const s=await Promise.allSettled(n);for(const a of s)a.status==="rejected"&&zt.error(`Failed to initialize debug libraries ${a.reason}`)();const l=new t(e),c=`${l._reused?"Reusing":"Created"} device with WebGL2 ${l.props.debug?"debug ":""}context: ${l.info.vendor}, ${l.info.renderer} for canvas: ${l.canvasContext.id}`;return zt.probe(e_,c)(),zt.table(e_,l.info)(),l}finally{zt.groupEnd(e_)()}}}function tq(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const Bb=new eq,jw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vi=(r,e,t)=>e?r.enable(t):r.disable(t),wA=(r,e,t)=>r.hint(t,e),Ys=(r,e,t)=>r.pixelStorei(t,e),TA=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},sp=(r,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(s,e)};function zb(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const rq={3042:Vi,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:Vi,2885:(r,e)=>r.cullFace(e),2929:Vi,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:Vi,35723:wA,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>r.bindTransformFeedback?.(36386,e),34229:(r,e)=>r.bindVertexArray(e),36006:TA,36010:TA,34964:sp,36662:sp,36663:sp,35053:sp,35055:sp,2886:(r,e)=>r.frontFace(e),33170:wA,2849:(r,e)=>r.lineWidth(e),32823:Vi,32824:"polygonOffset",10752:"polygonOffset",35977:Vi,32926:Vi,32928:Vi,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vi,3088:(r,e)=>r.scissor(...e),2960:Vi,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:Vi,10754:Vi,12288:Vi,12289:Vi,12290:Vi,12291:Vi,12292:Vi,12293:Vi,12294:Vi,12295:Vi,3333:Ys,3317:Ys,37440:Ys,37441:Ys,37443:Ys,3330:Ys,3332:Ys,3331:Ys,3314:Ys,32878:Ys,3316:Ys,3315:Ys,32877:Ys,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=e?.length===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=zb(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=zb(e)&&e.length===3?[...e,...e]:e;const[t,n,s,l,c,a]=e;r.stencilFuncSeparate(1028,t,n,s),r.stencilFuncSeparate(1029,l,c,a)},stencilOp:(r,e)=>{e=zb(e)&&e.length===3?[...e,...e]:e;const[t,n,s,l,c,a]=e;r.stencilOpSeparate(1028,t,n,s),r.stencilOpSeparate(1029,l,c,a)},viewport:(r,e)=>r.viewport(...e)};function xi(r,e,t){return e[r]!==void 0?e[r]:t[r]}const nq={blendEquation:(r,e,t)=>r.blendEquationSeparate(xi(32777,e,t),xi(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(xi(32969,e,t),xi(32968,e,t),xi(32971,e,t),xi(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(xi(32824,e,t),xi(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(xi(32938,e,t),xi(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,xi(2962,e,t),xi(2967,e,t),xi(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,xi(34816,e,t),xi(36003,e,t),xi(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,xi(2964,e,t),xi(2965,e,t),xi(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,xi(34817,e,t),xi(34818,e,t),xi(34819,e,t))},SA={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,s)=>r({32773:new Float32Array([e,t,n,s])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,s)=>r({32969:e,32968:t,32971:n,32970:s}),clearColor:(r,e,t,n,s)=>r({3106:new Float32Array([e,t,n,s])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,s)=>r({3107:[e,t,n,s]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,s)=>r({3088:new Int32Array([e,t,n,s])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,s)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:s}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,s)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:s}),viewport:(r,e,t,n,s)=>r({2978:[e,t,n,s]})},ha=(r,e)=>r.isEnabled(e),AA={3042:ha,2884:ha,2929:ha,3024:ha,32823:ha,32926:ha,32928:ha,3089:ha,2960:ha,35977:ha},iq=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Bd(r,e){if(oq(e))return;const t={};for(const s in e){const l=Number(s),c=rq[s];c&&(typeof c=="string"?t[c]=!0:c(r,e[s],l))}const n=r.state&&r.state.cache;if(n)for(const s in t){const l=nq[s];l(r,e,n)}}function KC(r,e=jw){if(typeof e=="number"){const s=e,l=AA[s];return l?l(r,s):r.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const s of t){const l=AA[s];n[s]=l?l(r,Number(s)):r.getParameter(Number(s))}return n}function sq(r){Bd(r,jw)}function oq(r){for(const e in r)return!1;return!0}function aq(r,e){if(r===e)return!0;if(EA(r)&&EA(e)&&r.length===e.length){for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}return!1}function EA(r){return Array.isArray(r)||ArrayBuffer.isView(r)}class lu{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Bd(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?KC(e):Object.assign({},jw),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,cq(e);for(const n in SA){const s=SA[n];lq(e,n,s)}PA(e,"getParameter"),PA(e,"isEnabled")}_updateCache(e){let t=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){const c=e[l],a=this.cache[l];aq(c,a)||(t=!0,n=a,s&&!(l in s)&&(s[l]=a),this.cache[l]=c)}return{valueChanged:t,oldValue:n}}}function PA(r,e){const t=r[e].bind(r);r[e]=function(s){if(s===void 0||iq.has(s))return t(s);const l=lu.get(r);return s in l.cache||(l.cache[s]=t(s)),l.enable?l.cache[s]:t(s)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function lq(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(...l){const c=lu.get(r),{valueChanged:a,oldValue:g}=t(c._updateCache,...l);return a&&n(...l),g},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function cq(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const s=lu.get(r);s.program!==n&&(e(n),s.program=n)}}function uq(r,e,t){let n="";const s={preserveDrawingBuffer:!0,...t};let l=null;if(l||=r.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!l&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,l=r.getContext("webgl2",s),l.luma||={},l.luma.softwareRenderer=!0),l||(l=r.getContext("webgl",{}),l&&(l=null,n||="Your browser only supports WebGL1")),!l)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:c,onContextRestored:a}=e;return r.addEventListener("webglcontextlost",g=>c(g),!1),r.addEventListener("webglcontextrestored",g=>a(g),!1),l.luma||={},l}function xd(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function hq(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);xd(r,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,l=r.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),c=r.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=l||t,g=c||n,v=r.getParameter(7938),w=QC(a,g),P=dq(a,g),I=fq(a,g);return{type:"webgl",gpu:w,gpuType:I,gpuBackend:P,vendor:a,renderer:g,version:v,shadingLanguage:"glsl",shadingLanguageVersion:300}}function QC(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function dq(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function fq(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(QC(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function JC(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const gp="WEBGL_compressed_texture_s3tc",mp="WEBGL_compressed_texture_s3tc_srgb",Jh="EXT_texture_compression_rgtc",ed="EXT_texture_compression_bptc",pq="WEBGL_compressed_texture_etc",gq="WEBGL_compressed_texture_astc",mq="WEBGL_compressed_texture_etc1",_q="WEBGL_compressed_texture_pvrtc",yq="WEBGL_compressed_texture_atc",IA="EXT_texture_norm16",CA="EXT_render_snorm",vq="EXT_color_buffer_float",Ww={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[CA],"norm16-renderable-webgl":[IA],"snorm16-renderable-webgl":[IA,CA],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[gp,mp,Jh,ed],"texture-compression-bc5-webgl":[Jh],"texture-compression-bc7-webgl":[ed],"texture-compression-etc2":[pq],"texture-compression-astc":[gq],"texture-compression-etc1-webgl":[mq],"texture-compression-pvrtc-webgl":[_q],"texture-compression-atc-webgl":[yq]};function bq(r){return r in Ww}function xq(r,e,t){return(Ww[e]||[]).every(s=>xd(r,s,t))}const $w={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:vq,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:gp},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:mp},"bc1-rgba-unorm":{gl:33777,x:gp},"bc1-rgba-unorm-srgb":{gl:35916,x:mp},"bc2-rgba-unorm":{gl:33778,x:gp},"bc2-rgba-unorm-srgb":{gl:35918,x:mp},"bc3-rgba-unorm":{gl:33779,x:gp},"bc3-rgba-unorm-srgb":{gl:35919,x:mp},"bc4-r-unorm":{gl:36283,x:Jh},"bc4-r-snorm":{gl:36284,x:Jh},"bc5-rg-unorm":{gl:36285,x:Jh},"bc5-rg-snorm":{gl:36286,x:Jh},"bc6h-rgb-ufloat":{gl:36495,x:ed},"bc6h-rgb-float":{gl:36494,x:ed},"bc7-rgba-unorm":{gl:36492,x:ed},"bc7-rgba-unorm-srgb":{gl:36493,x:ed},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function wq(r,e,t){let n=e.create;const s=$w[e.format];return s?.gl===void 0&&(n=!1),s?.x&&(n=n&&!!xd(r,s.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function eR(r){const e=$w[r],t=Aq(r),n=ad.getInfo(r);return n.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||Sq(n.channels,n.integer,n.normalized,t),type:n.dataType?JC(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function Tq(r){switch(ad.getInfo(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function Sq(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Aq(r){const t=$w[r]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const RA={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Eq extends GW{gl;extensions;testedFeatures=new Set;constructor(e,t,n){super([],n),this.gl=e,this.extensions=t,xd(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),bq(e)&&xq(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(RA),...Object.keys(Ww)]}getWebGLFeature(e){const t=RA[e];return typeof t=="string"?!!xd(this.gl,t,this.extensions):!!t}}class Pq extends qW{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Rp extends Ry{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const n=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const n=this.colorAttachments[t];if(n){const s=36064+t;this._attachTextureView(s,n)}}if(this.depthStencilAttachment){const t=Tq(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${Cq(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:s}=t,l=t.props.baseMipLevel,c=t.props.baseArrayLayer;switch(n.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,s.handle,l,c);break;case 34067:const a=Iq(c);n.framebufferTexture2D(36160,e,a,s.handle,l);break;case 3553:n.framebufferTexture2D(36160,e,3553,s.handle,l);break;default:throw new Error("Illegal texture type")}n.bindTexture(s.glTarget,null)}}function Iq(r){return r<34069?r+34069:r}function Cq(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class Rq extends Zc{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Rp(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Ub={};function Mq(r="id"){Ub[r]=Ub[r]||1;const e=Ub[r]++;return`${r}-${e}`}class Mp extends ni{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const n=typeof t=="object"?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=kq(this.props.usage),this.glUsage=Dq(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,t,n),this.gl.bindBuffer(s,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const s=new ArrayBuffer(n);await e(s,"copied"),this.write(s,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const s=await this.readAsync(t,n);return await e(s.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function kq(r){return r&ni.INDEX?34963:r&ni.VERTEX?34962:r&ni.UNIFORM?35345:34962}function Dq(r){return r&ni.INDEX||r&ni.VERTEX?35044:r&ni.UNIFORM?35048:35044}function Oq(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[P,I]=s;t.push({message:I.trim(),type:MA(P),lineNum:0,linePos:0});continue}const[l,c,a,...g]=s;let v=parseInt(a,10);isNaN(v)&&(v=0);let w=parseInt(c,10);isNaN(w)&&(w=0),t.push({message:g.join(":").trim(),type:MA(l),lineNum:v,linePos:w})}return t}function MA(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class Fq extends Cy{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Oq(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}zt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),zt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Nq(r,e,t,n){if(Uq(e))return n(r);const s=r;s.pushState();try{return Lq(r,e),Bd(s.gl,t),n(r)}finally{s.popState()}}function Lq(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(cu("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const l=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=cu("provokingVertex",e.provokingVertex,{first:36429,last:36430});l?.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const l=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=cu("polygonMode",e.polygonMode,{fill:6914,line:6913});l?.polygonModeWEBGL(1028,c),l?.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(zq("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Qx("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&zt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,l=Qx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,l,0,s),n.stencilFuncSeparate(1029,l,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Vb("stencilPassOperation",e.stencilPassOperation),l=Vb("stencilFailOperation",e.stencilFailOperation),c=Vb("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,l,c,s),n.stencilOpSeparate(1029,l,c,s)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=kA("blendColorOperation",e.blendColorOperation||"add"),l=kA("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(s,l);const c=t_("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=t_("blendColorDstFactor",e.blendColorDstFactor||"zero"),g=t_("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),v=t_("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(c,a,g,v)}}function Qx(r,e){return cu(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Vb(r,e){return cu(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function kA(r,e){return cu(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function t_(r,e,t="color"){return cu(r,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Bq(r,e){return`Illegal parameter ${e} for ${r}`}function cu(r,e,t){if(!(e in t))throw new Error(Bq(r,e));return t[e]}function zq(r,e){return e}function Uq(r){let e=!0;for(const t in r){e=!1;break}return e}function tR(r){const e={};return r.addressModeU&&(e[10242]=jb(r.addressModeU)),r.addressModeV&&(e[10243]=jb(r.addressModeV)),r.addressModeW&&(e[32882]=jb(r.addressModeW)),r.magFilter&&(e[10240]=Jx(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=Vq(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=Qx("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function jb(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Jx(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function Vq(r,e="none"){if(!e)return Jx(r);switch(e){case"none":return Jx(r);case"nearest":switch(r){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(r){case"nearest":return 9986;case"linear":return 9987}}}class jq extends du{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=tR(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,n);break;default:this.device.gl.samplerParameteri(this.handle,s,n);break}}}}function Jp(r,e,t){if(Wq(e))return t(r);const{nocatch:n=!0}=e,s=lu.get(r);s.push(),Bd(r,e);let l;if(n)l=t(r),s.pop();else try{l=t(r)}finally{s.pop()}return l}function Wq(r){for(const e in r)return!1;return!0}class td extends Iy{device;gl;handle;texture;constructor(e,t){super(e,{...Qi.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class kp extends Qi{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const n=eR(this.props.format);this.glTarget=$q(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:l,height:c,depth:a,mipLevels:g,glTarget:v,glInternalFormat:w}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(v,g,w,l,c);break;case"2d-array":case"3d":this.gl.texStorage3D(v,g,w,l,c,a);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new td(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new td(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=tR(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:s,height:l,depth:c}=this,{mipLevel:a=0,byteOffset:g=0,x:v=0,y:w=0,z:P=0}=t,{glFormat:I,glType:k,compressed:N}=this,D=DA(this.glTarget,this.dimension,c),B=this.compressed?{}:{3314:t.bytesPerRow,32878:t.rowsPerImage};this.gl.bindTexture(D,this.handle),Jp(this.gl,B,()=>{switch(this.dimension){case"2d":case"cube":N?this.gl.compressedTexSubImage2D(D,a,v,w,s,l,I,n,g):this.gl.texSubImage2D(D,a,v,w,s,l,I,k,n,g);break;case"2d-array":case"3d":N?this.gl.compressedTexSubImage3D(D,a,v,w,P,s,l,c,I,n,g):this.gl.texSubImage3D(D,a,v,w,P,s,l,c,I,k,n,g);break;default:}}),this.gl.bindTexture(D,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:s}=this,{image:l,depth:c,mipLevel:a,x:g,y:v,z:w,width:P,height:I}=t,k=DA(this.glTarget,this.dimension,c),N=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Jp(this.gl,N,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(k,a,g,v,P,I,n,s,l);break;case"2d-array":case"3d":this.gl.texSubImage3D(k,a,g,v,w,P,I,c,n,s,l);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(zt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){zt.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){zt.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const s=Number(t),l=n;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,l);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,l);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,l);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,l);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function $q(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function DA(r,e,t){return e==="cube"?34069+t:r}function Hq(r){return Gq[r]}function Hw(r){return qq[r]}function Zq(r){return!!rR[r]}function Xq(r){return rR[r]}const qq={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},rR={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Gq={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function Yq(r,e){const t={attributes:[],bindings:[]};t.attributes=Kq(r,e);const n=eG(r,e);for(const a of n){const g=a.uniforms.map(v=>({name:v.name,format:v.format,byteOffset:v.byteOffset,byteStride:v.byteStride,arrayLength:v.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:g})}const s=Jq(r,e);let l=0;for(const a of s)if(Zq(a.type)){const{viewDimension:g,sampleType:v}=Xq(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:l,viewDimension:g,sampleType:v}),a.textureUnit=l,l+=1}s.length&&(t.uniforms=s);const c=Qq(r,e);return c?.length&&(t.varyings=c),t}function Kq(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let s=0;s<n;s++){const l=r.getActiveAttrib(e,s);if(!l)throw new Error("activeInfo");const{name:c,type:a}=l,g=r.getAttribLocation(e,c);if(g>=0){const v=Hw(a),w=/instance/i.test(c)?"instance":"vertex";t.push({name:c,location:g,stepMode:w,type:v})}}return t.sort((s,l)=>s.location-l.location),t}function Qq(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let s=0;s<n;s++){const l=r.getTransformFeedbackVarying(e,s);if(!l)throw new Error("activeInfo");const{name:c,type:a,size:g}=l,v=Hw(a),{type:w,components:P}=$I(v);t.push({location:s,name:c,type:w,size:g*P})}return t.sort((s,l)=>s.location-l.location),t}function Jq(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let s=0;s<n;s++){const l=r.getActiveUniform(e,s);if(!l)throw new Error("activeInfo");const{name:c,size:a,type:g}=l,{name:v,isArray:w}=tG(c);let P=r.getUniformLocation(e,v);const I={location:P,name:v,size:a,type:g,isArray:w};if(t.push(I),I.size>1)for(let k=0;k<I.size;k++){const N=`${v}[${k}]`;P=r.getUniformLocation(e,N);const D={...I,name:N,location:P};t.push(D)}}return t}function eG(r,e){const t=(l,c)=>r.getActiveUniformBlockParameter(e,l,c),n=[],s=r.getProgramParameter(e,35382);for(let l=0;l<s;l++){const c={name:r.getActiveUniformBlockName(e,l)||"",location:t(l,35391),byteLength:t(l,35392),vertex:t(l,35396),fragment:t(l,35398),uniformCount:t(l,35394),uniforms:[]},a=t(l,35395)||[],g=r.getActiveUniforms(e,a,35383),v=r.getActiveUniforms(e,a,35384),w=r.getActiveUniforms(e,a,35387),P=r.getActiveUniforms(e,a,35388);for(let I=0;I<c.uniformCount;++I){const k=r.getActiveUniform(e,a[I]);if(!k)throw new Error("activeInfo");const N=Hw(g[I]);c.uniforms.push({name:k.name,format:N,type:g[I],arrayLength:v[I],byteOffset:w[I],byteStride:P[I]})}n.push(c)}return n.sort((l,c)=>l.location-c.location),n}function tG(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function rG(r,e,t,n){const s=r;let l=n;l===!0&&(l=1),l===!1&&(l=0);const c=typeof l=="number"?[l]:l;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,c);case 35664:return r.uniform2fv(e,c);case 35665:return r.uniform3fv(e,c);case 35666:return r.uniform4fv(e,c);case 5124:return r.uniform1iv(e,c);case 35667:return r.uniform2iv(e,c);case 35668:return r.uniform3iv(e,c);case 35669:return r.uniform4iv(e,c);case 35670:return r.uniform1iv(e,c);case 35671:return r.uniform2iv(e,c);case 35672:return r.uniform3iv(e,c);case 35673:return r.uniform4iv(e,c);case 5125:return s.uniform1uiv(e,c,1);case 36294:return s.uniform2uiv(e,c,2);case 36295:return s.uniform3uiv(e,c,3);case 36296:return s.uniform4uiv(e,c,4);case 35674:return r.uniformMatrix2fv(e,!1,c);case 35675:return r.uniformMatrix3fv(e,!1,c);case 35676:return r.uniformMatrix4fv(e,!1,c);case 35685:return s.uniformMatrix2x3fv(e,!1,c);case 35686:return s.uniformMatrix2x4fv(e,!1,c);case 35687:return s.uniformMatrix3x2fv(e,!1,c);case 35688:return s.uniformMatrix3x4fv(e,!1,c);case 35689:return s.uniformMatrix4x2fv(e,!1,c);case 35690:return s.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function nG(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function iG(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const OA=4;class sG extends su{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:s=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,s)),this._linkShaders(),zt.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Yq(this.device.gl,this.handle),zt.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?oG(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,s]of Object.entries(e)){const l=this.shaderLayout.bindings.find(c=>c.name===n)||this.shaderLayout.bindings.find(c=>c.name===`${n}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");t?.disableWarnings||zt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${c}`,s)();continue}switch(s||zt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(s instanceof Mp)&&!(s.buffer instanceof Mp))throw new Error("buffer value");break;case"texture":if(!(s instanceof td||s instanceof kp||s instanceof Rp))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":zt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(l.type)}this.bindings[n]=s}}draw(e){const{renderPass:t,parameters:n=this.props.parameters,topology:s=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:a,isInstanced:g=!1,firstVertex:v=0,transformFeedback:w}=e,P=nG(s),I=!!l.indexBuffer,k=l.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return zt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return zt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(t),w&&w.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const N=t;return Nq(this.device,n,N.glParameters,()=>{I&&g?this.device.gl.drawElementsInstanced(P,c||0,k,v,a||0):I?this.device.gl.drawElements(P,c||0,k,v):g?this.device.gl.drawArraysInstanced(P,v,c||0,a||0):this.device.gl.drawArrays(P,v,c||0),w&&w.end()}),l.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),zt.time(OA,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),zt.timeEnd(OA,`linkProgram for ${this.id}`)(),zt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}zt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),zt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(zt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const s of this.shaderLayout.bindings){const l=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:c}=s,a=e.getUniformBlockIndex(this.handle,c);if(a===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,n,a),l instanceof Mp?e.bindBufferBase(35345,n,l.handle):e.bindBufferRange(35345,n,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),n+=1;break;case"texture":if(!(l instanceof td||l instanceof kp||l instanceof Rp))throw new Error("texture");let g;if(l instanceof td)g=l.texture;else if(l instanceof kp)g=l;else if(l instanceof Rp&&l.colorAttachments[0]instanceof td)zt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),g=l.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(g.glTarget,g.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:s,textureUnit:l}=e,c=this.uniforms[t]??l;c!==void 0&&rG(this.device.gl,n,s,c)}}}function oG(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const s=t.attributes.find(l=>l.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):zt.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class aG extends mw{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":lG(this.device,t.options);break;case"copy-buffer-to-texture":cG(this.device,t.options);break;case"copy-texture-to-buffer":uG(this.device,t.options);break;case"copy-texture-to-texture":hG(this.device,t.options);break;default:throw new Error(t.name)}}}function lG(r,e){const t=e.sourceBuffer,n=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function cG(r,e){throw new Error("Not implemented")}function uG(r,e){const{sourceTexture:t,mipLevel:n=0,aspect:s="all",width:l=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:g=[0,0],destinationBuffer:v,byteOffset:w=0,bytesPerRow:P,rowsPerImage:I}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||a!==0||P||I)throw new Error("not implemented");const{framebuffer:k,destroyFramebuffer:N}=nR(t);let D;try{const B=v,U=l||k.width,V=c||k.height,L=eR(k.colorAttachments[0].texture.props.format),$=L.format,te=L.type;r.gl.bindBuffer(35051,B.handle),D=r.gl.bindFramebuffer(36160,k.handle),r.gl.readPixels(g[0],g[1],U,V,$,te,w)}finally{r.gl.bindBuffer(35051,null),D!==void 0&&r.gl.bindFramebuffer(36160,D),N&&k.destroy()}}function hG(r,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:l=[0,0],destinationTexture:c}=e;let{width:a=e.destinationTexture.width,height:g=e.destinationTexture.height}=e;const{framebuffer:v,destroyFramebuffer:w}=nR(t),[P,I]=s,[k,N,D]=l,B=r.gl.bindFramebuffer(36160,v.handle);let U,V;if(c instanceof kp)U=c,a=Number.isFinite(a)?a:U.width,g=Number.isFinite(g)?g:U.height,U._bind(0),V=U.glTarget;else throw new Error("invalid destination");switch(V){case 3553:case 34067:r.gl.copyTexSubImage2D(V,n,k,N,P,I,a,g);break;case 35866:case 32879:r.gl.copyTexSubImage3D(V,n,k,N,D,P,I,a,g);break}U&&U._unbind(),r.gl.bindFramebuffer(36160,B),w&&v.destroy()}function nR(r){if(r instanceof Qi){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}const dG=[1,2,4,8];class fG extends $c{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let n;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:l,height:c}=t.framebuffer;n=[0,0,l,c]}else{const[l,c]=e.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,l,c]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const l=this.props.framebuffer.colorAttachments.map((c,a)=>36064+a);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=dG.map(n=>!!(n&e.colorMask))),this.glParameters=t,Bd(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((n,s)=>{n&&this.clearColorBuffer(s,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&Jp(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Jp(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class FA extends gw{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new aG(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new fG(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}function pG(r){const{target:e,source:t,start:n=0,count:s=1}=r,l=t.length,c=s*l;let a=0;for(let g=n;a<l;a++)e[g++]=t[a];for(;a<c;)a<c-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+c-a),a=c);return r.target}class Zw extends _w{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return k8()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:l,stride:c,offset:a,normalized:g,integer:v,divisor:w}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),v?this.device.gl.vertexAttribIPointer(e,s,l,c,a):this.device.gl.vertexAttribPointer(e,s,l,g,c,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,w||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=JC(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=Zw.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=gG(t),s=n.byteLength*e,l=n.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),c||=!mG(n,this.bufferValue),c){const a=S9(t.constructor,l);pG({target:a,source:n,start:0,count:l}),this.buffer.write(a),this.bufferValue=t}return this.buffer}}function gG(r){return Array.isArray(r)?new Float32Array(r):r}function mG(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class _G extends yw{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(iG(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:s,byteLength:l,byteOffset:c}=this._getBufferRange(t);if(n<0){this.unusedBuffers[e]=s,zt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:s,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(n,s,c,l)}getBuffer(e){if(NA(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Mp)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:s}}_getVaryingIndex(e){if(NA(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,s){const l=t&&t.handle;!l||s===void 0?this.gl.bindBufferBase(35982,e,l):this.gl.bindBufferRange(35982,e,l,n,s)}}function NA(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class yG extends vw{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,s)=>{const l=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}function iR(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function vG(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function bG(r){return xG[r]}const xG={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function wG(r,e){const{sourceX:t=0,sourceY:n=0,sourceAttachment:s=0}=e||{};let{target:l=null,sourceWidth:c,sourceHeight:a,sourceDepth:g,sourceFormat:v,sourceType:w}=e||{};const{framebuffer:P,deleteFramebuffer:I}=sR(r),{gl:k,handle:N}=P;c||=P.width,a||=P.height;const D=P.colorAttachments[s]?.texture;if(!D)throw new Error(`Invalid framebuffer attachment ${s}`);g=D?.depth||1,v||=D?.glFormat||6408,w||=D?.glType||5121,l=AG(l,w,v,c,a);const B=hw(l);w=w||Hq(B);const U=k.bindFramebuffer(36160,N);return k.readBuffer(36064+s),k.readPixels(t,n,c,a,v,w,l),k.readBuffer(36064),k.bindFramebuffer(36160,U||null),I&&P.destroy(),l}function TG(r,e){const{target:t,sourceX:n=0,sourceY:s=0,sourceFormat:l=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:a,sourceHeight:g,sourceType:v}=e||{};const{framebuffer:w,deleteFramebuffer:P}=sR(r);a=a||w.width,g=g||w.height;const I=w;v=v||5121;let k=t;if(!k){const D=iR(l),B=vG(v),U=c+a*g*D*B;k=I.device.createBuffer({byteLength:U})}const N=r.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:r,width:a,height:g,origin:[n,s],destinationBuffer:k,byteOffset:c}),N.destroy(),P&&w.destroy(),k}function sR(r){return r instanceof Ry?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:SG(r),deleteFramebuffer:!0}}function SG(r,e){const{device:t,width:n,height:s,id:l}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:n,height:s,colorAttachments:[r]})}function AG(r,e,t,n,s,l){if(r)return r;e||=5121;const c=bG(e),a=dw(c),g=iR(t);return new a(n*s*g)}class e0 extends hu{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){switch(e){case"unorm8x4-bgra":return!1;default:return!0}}constructor(e){super({...e,id:e.id||Mq("webgl-device")});const t=hu._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=t.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new Rq(this,t),this.lost=new Promise(w=>{this._resolveContextLost=w});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const c=this.props._handle||uq(this.canvasContext.canvas,{onContextLost:w=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:w=>console.log("WebGL context restored")},s);if(!c)throw new Error("WebGL context creation failed");if(n=c.device,n){if(e._reuseDevices)return zt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=c,this.gl=c,this.spectorJS=ZX({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=hq(this.gl,this._extensions),this.limits=new Pq(this.gl),this.features=new Eq(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new lu(this.gl,{log:(...w)=>zt.log(1,...w)()}).trackState(this.gl,{copyState:!1});const g=e.debugWebGL||e.debug,v=e.debugWebGL;g&&(this.gl=GX(this.gl,{debugWebGL:g,traceWebGL:v}),zt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(zt.level=Math.max(zt.level,1))),this.commandEncoder=new FA(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Mp(this,t)}createTexture(e){return new kp(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new jq(this,e)}createShader(e){return new Fq(this,e)}createFramebuffer(e){return new Rp(this,e)}createVertexArray(e){return new Zw(this,e)}createTransformFeedback(e){return new _G(this,e)}createQuerySet(e){return new yG(this,e)}createRenderPipeline(e){return new sG(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new FA(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return wG(e,t)}readPixelsToBufferWebGL(e,t){return TG(e,t)}setParametersWebGL(e){Bd(this.gl,e)}getParametersWebGL(e){return KC(this.gl,e)}withParametersWebGL(e,t){return Jp(this.gl,e,t)}resetWebGL(){zt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),sq(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return wq(this.gl,e,this._extensions)}loseDevice(){let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){lu.get(this.gl).push()}popState(){lu.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const s in this.gl)if(this.gl[s]===n)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[s,l])=>(n[`${s}:${this.getGLKey(s,t)}`]=`${l}:${this.getGLKey(l,t)}`,n),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const s=this._constants[e];switch(s&&CG(s,t)&&zt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:EG(this,e,t);break;case Int32Array:PG(this,e,t);break;case Uint32Array:IG(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return xd(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const s={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=s}}function EG(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function PG(r,e,t){r.gl.vertexAttribI4iv(e,t)}function IG(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function CG(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const LA=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:e0},Symbol.toStringTag,{value:"Module"}));function Xl(){}const RG=({isDragging:r})=>r?"grabbing":"grab",oR={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Xl,onWebGLInitialized:Xl,onResize:Xl,onViewStateChange:Xl,onInteractionStateChange:Xl,onBeforeRender:Xl,onAfterRender:Xl,onLoad:Xl,onError:r=>Vn.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:RG,getTooltip:null,debug:!1,drawPickingColors:!1};class eg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ay({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const l=n.offsetCenter;if(!l)return;s.x=l.x,s.y=l.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=$x[n.type],l=n.offsetCenter;if(!s||!l||!this.layerManager)return;const c=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:c,viewports:this.getViewports(l)},this._lastPointerDownInfo),{layer:g}=a,v=g&&(g[s]||g.props[s]),w=this.props[s];let P=!1;v&&(P=v.call(g,a,n)),P||(w?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const s=n.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...oR,...e},e=this.props,e.viewState&&e.initialViewState&&Vn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Vn.error("WebGL1 context not supported.")(),t=Bb.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Kp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Vn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Vn.removed("onLayerClick","onClick")(),e.initialViewState&&!vo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Vn.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const n=this.device.canvasContext.canvas,s={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([s])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return t=t||n||s||l||c,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Ji(this.viewManager),this.viewManager.views}getViewports(e){return Ji(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,n){Ji(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(t).timeEnd(),l}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Ji(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,this.viewManager?.setProps({width:t,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:s}=t;return new Fw({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,n=typeof t=="object"?t:void 0,s={adapters:[],...e.deviceProps};s.adapters.includes(Bb)||s.adapters.push(Bb);const l={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return Ox.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...l,...n,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new zw({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let s=n,l=!1;for(const c of t)s=c,l=c.layer?.onHover(c,e.event)||l;l||(this.props.onHover?.(s,e.event),this.widgetManager.onHover(s,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new VC;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new uH(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(JS).map(s=>{const[l,c,a,g]=JS[s],v=this.props.eventRecognizerOptions?.[s],w={...c,...v,event:s};return{recognizer:new l(w),recognizeWith:a,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in $x)this.eventManager.on(s,this._onEvent);this.viewManager=new dX({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new hX(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new EX({deck:this,device:this.device}),this.deckRenderer=new CX(this.device),this.deckPicker=new kX(this.device),this.widgetManager=new FX({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new qC),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Vn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Ox.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}eg.defaultProps=oR;eg.VERSION=Jj;function MG(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return dw(r)}}const kG=hw;function r_(r,e,t){const n=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:r,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Xc(r){return r.stride||r.size*r.bytesPerElement}function DG(r,e){return r.type===e.type&&r.size===e.size&&Xc(r)===Xc(e)&&(r.offset||0)===(e.offset||0)}function t0(r,e){e.offset&&Vn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Xc(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,s=e.elementOffset||0,l=n*t+s*r.bytesPerElement+(r.offset||0);return{...e,offset:l,stride:t}}function OG(r,e){const t=t0(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class FG{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,l=s==="float64";let{defaultValue:c}=t;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let a;l?a="float32":!s&&t.isIndexed?a="uint32":a=s||"float32";let g=MG(s||a);this.doublePrecision=l,l&&t.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...t,defaultType:g,defaultValue:c,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Xc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Kp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const s=this.value;if(t){const l=t0(this.getAccessor(),t),c=l.offset/s.BYTES_PER_ELEMENT,a=l.size||this.size;n[e]=s.subarray(c,c+a)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),s=[],l={name:this.id,byteStride:Xc(n),attributes:s};if(this.doublePrecision){const c=OG(n,t||{});s.push(r_(e,{...n,...c.high},this.device.type),r_(`${e}64Low`,{...n,...c.low},this.device.type))}else if(t){const c=t0(n,t);s.push(r_(e,{...n,...c},this.device.type))}else s.push(r_(e,n,this.device.type));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:s}=this,l=n*s;if(t&&l&&t.length>=l){const c=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let g=0;g<l;)for(let v=0;v<s;v++){const w=t[g++];w<c[v]&&(c[v]=w),w>a[v]&&(a[v]=w)}e=[c,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof ni?n={buffer:e}:n=e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const c=kG(n.value);s.type=s.normalized?c.replace("int","norm"):c}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=Xc(s)}if(t.bounds=null,n.constant){let l=n.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!t.constant||!this._areValuesEqual(l,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(n.buffer){const l=n.buffer;t.externalBuffer=l,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let l=n.value;t.externalBuffer=null,t.constant=!1,this.value=l;let{buffer:c}=this;const a=Xc(s),g=(s.vertexOffset||0)*a;if(this.doublePrecision&&l instanceof Float64Array&&(l=kb(l,s)),this.settings.isIndexed){const w=this.settings.defaultType;l.constructor!==w&&(l=new w(l))}const v=l.byteLength+g+a*2;(!c||c.byteLength<v)&&(c=this._createBuffer(v)),c.write(l,g)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?kb(t,{size:this.size,startIndex:n,endIndex:s}):t.subarray(n,s),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,s=n.allocatedValue,l=Kp.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=l;const{byteOffset:c}=this;let{buffer:a}=this;return(!a||a.byteLength<l.byteLength+c)&&(a=this._createBuffer(l.byteLength+c),t&&s&&a.write(s instanceof Float64Array?kb(s,this):s,c)),n.allocatedValue=l,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Vn.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:s,size:l}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let c=l;for(;--c>=0;)t[n+c]=s[c];return t}switch(l){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let c=l;for(;--c>=0;)t[n+c]=Number.isFinite(e[c])?e[c]:s[c]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?ni.INDEX:ni.VERTEX)|ni.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const BA=[],zA=[];function aR(r,e=0,t=1/0){let n=BA;const s={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(zA.length=r.length,n=zA):n=BA,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),s.index=e-1),{iterable:n,objectInfo:s}}function lR(r){return r&&r[Symbol.asyncIterator]}function NG(r,e){const{size:t,stride:n,offset:s,startIndices:l,nested:c}=e,a=r.BYTES_PER_ELEMENT,g=n?n/a:t,v=s?s/a:0,w=Math.floor((r.length-v)/g);return(P,{index:I,target:k})=>{if(!l){const U=I*g+v;for(let V=0;V<t;V++)k[V]=r[U+V];return k}const N=l[I],D=l[I+1]||w;let B;if(c){B=new Array(D-N);for(let U=N;U<D;U++){const V=U*g+v;k=new Array(t);for(let L=0;L<t;L++)k[L]=r[V+L];B[U-N]=k}}else if(g===t)B=r.subarray(N*t+v,D*t+v);else{B=new r.constructor((D-N)*t);let U=0;for(let V=N;V<D;V++){const L=V*g+v;for(let $=0;$<t;$++)B[U++]=r[L+$]}}return B}}const LG=[],S_=[[0,1/0]];function BG(r,e){if(r===S_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let s=0;for(let l=0;l<n;l++){const c=r[l];c[1]<e[0]?(t.push(c),s=l+1):c[0]>e[1]?t.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return t.splice(s,0,e),t}const zG={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function cR(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...zG[t],...e,...r,type:t}}class uR extends FG{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:S_}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!DG(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,s=Array.isArray(t)?e[t.find(l=>e[l])]:e[t];return cR(s,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:s=1/0}=t;this.state.updateRanges=BG(this.state.updateRanges,[n,s])}else this.state.updateRanges=S_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=LG}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==S_),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:c,noAlloc:a}}=this;let g=!0;if(c){for(const[v,w]of l)c.call(s,this,{data:t,startRow:v,endRow:w,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,w]of l){const P=Number.isFinite(v)?this.getVertexOffset(v):0,I=Number.isFinite(w)?this.getVertexOffset(w):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:P,endOffset:I})}this._checkAttributeArray()}else g=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),g}setConstantValue(e,t){const n=this.device.type==="webgpu";if(n||t===void 0||typeof t=="function"){if(n&&typeof t!="function"){const c=this._normalizeValue(t,[],0);this._areValuesEqual(c,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;Ji(ArrayBuffer.isView(c.value),`invalid ${s.accessor}`);const a=!!c.size&&c.size!==this.size;return n.binaryAccessor=NG(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=s??"vertex",!t)return n;for(const l in t){const c=super._getBufferLayout(l,t[l]);n.attributes.push(...c.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:s,props:l,numInstances:c}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:g,value:v,size:w,startIndices:P}=e,{accessor:I,transform:k}=a;let N=g.binaryAccessor||(typeof I=="function"?I:l[I]);typeof N!="function"&&typeof I=="string"&&(N=()=>l[I]),Ji(typeof N=="function",`accessor "${I}" is not a function`);let D=e.getVertexOffset(n);const{iterable:B,objectInfo:U}=aR(t,n,s);for(const V of B){U.index++;let L=N(V,U);if(k&&(L=k.call(this,L)),P){const $=(U.index<P.length-1?P[U.index+1]:c)-P[U.index];if(L&&Array.isArray(L[0])){let te=D;for(const G of L)e._normalizeValue(G,v,te),te+=w}else L&&L.length>w?v.set(L,D):(e._normalizeValue(L,U.target,0),oX({target:v,source:U.target,start:D,count:$}));D+=$*w}else e._normalizeValue(L,v,D),D+=w}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Wb(r){const{source:e,target:t,start:n=0,size:s,getData:l}=r,c=r.end||t.length,a=e.length,g=c-n;if(a>g){t.set(e.subarray(0,g),n);return}if(t.set(e,n),!l)return;let v=a;for(;v<g;){const w=l(v,e);for(let P=0;P<s;P++)t[n+v]=w[P]||0,v++}}function UG({source:r,target:e,size:t,getData:n,sourceStartIndices:s,targetStartIndices:l}){if(!s||!l)return Wb({source:r,target:e,size:t,getData:n}),e;let c=0,a=0;const g=n&&((w,P)=>n(w+a,P)),v=Math.min(s.length,l.length);for(let w=1;w<v;w++){const P=s[w]*t,I=l[w]*t;Wb({source:r.subarray(c,P),target:e,start:a,end:I,size:t,getData:g}),c=P,a=I}return a<e.length&&Wb({source:[],target:e,start:a,size:t,getData:g}),e}function VG(r){const{device:e,settings:t,value:n}=r,s=new uR(e,t);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function hR(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function dR(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function fR(r){r.push(r.shift())}function jG(r,e){const{doublePrecision:t,settings:n,value:s,size:l}=r,c=t&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:g}=r.settings;if(g)for(const v of Object.values(g))a=Math.max(a,v.vertexOffset??0);return(n.noAlloc?s.length:(e+a)*l)*c}function pR({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function gR({device:r,buffer:e,attribute:t,fromLength:n,toLength:s,fromStartIndices:l,getData:c=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,g=t.size*a,v=t.byteOffset,w=t.settings.bytesPerElement<4?v/t.settings.bytesPerElement*4:v,P=t.startIndices,I=l&&P,k=t.isConstant;if(!I&&e&&n>=s)return e;const N=t.value instanceof Float64Array?Float32Array:t.value.constructor,D=k?t.value:new N(t.getBuffer().readSyncWebGL(v,s*N.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!k){const L=c;c=($,te)=>t.normalizeConstant(L($,te))}const B=k?(L,$)=>c(D,$):(L,$)=>c(D.subarray(L+v,L+v+g),$),U=e?new Float32Array(e.readSyncWebGL(w,n*4).buffer):new Float32Array(0),V=new Float32Array(s);return UG({source:U,target:V,sourceStartIndices:l,targetStartIndices:P,size:g,getData:B}),(!e||e.byteLength<V.byteLength+w)&&(e?.destroy(),e=r.createBuffer({byteLength:V.byteLength+w,usage:35050})),e.write(V,w),e}class mR{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new ky(n),this.attribute=t,this.attributeInTransition=VG(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=jG(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class WG extends mR{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=XG(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:c}=this;fR(l),l[0]=gR({device:this.device,buffer:l[0],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),l[1]=pR({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:a}=this,g=a.model;let v=Math.floor(this.currentLength/c.size);_R(c)&&(v/=2),g.setVertexCount(v),c.isConstant?(g.setAttributes({aFrom:l[0]}),g.setConstantAttributes({aTo:c.value})):g.setAttributes({aFrom:l[0],aTo:c.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let s=n/e;t&&(s=t(s));const{model:l}=this.transform,c={time:s};l.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const $G=`uniform interpolationUniforms {
  float time;
} interpolation;
`,UA={name:"interpolation",vs:$G,uniformTypes:{time:"f32"}},HG=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,ZG=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function _R(r){return r.doublePrecision&&r.value instanceof Float64Array}function XG(r,e){const t=e.size,n=hR(t),s=dR(t),l=e.getBufferLayout();return _R(e)?new vd(r,{vs:ZG,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[l7,UA],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new vd(r,{vs:HG,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:l.attributes[0].format}],modules:[UA],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class qG extends mR{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=eY(e),this.framebuffer=tY(e,this.texture),this.transform=JG(e,t)}start(e,t){const n=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:l,attribute:c}=this;for(let g=0;g<2;g++)l[g]=gR({device:this.device,buffer:l[g],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});l[2]=pR({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?a.setConstantAttributes({aTo:c.value}):a.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:s}=this,l=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:l.stiffness,damping:l.damping};t.model.shaderInputs.setProps({spring:c}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),fR(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const GG=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,YG={name:"spring",vs:GG,uniformTypes:{damping:"f32",stiffness:"f32"}},KG=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,QG=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function JG(r,e){const t=hR(e.size),n=dR(e.size);return new vd(r,{vs:KG,fs:QG,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[YG],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function eY(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function tY(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const rY={interpolation:WG,spring:qG};class nY{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const s in e){const l=e[s],c=l.getTransitionSetting(t);c&&this._updateAttribute(s,l,c)}for(const s in this.transitions){const l=e[s];(!l||!l.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const s=this.transitions[e];let l=!s||s.type!==n.type;if(l){s&&this._removeTransition(e);const c=rY[n.type];c?this.transitions[e]=new c({attribute:t,timeline:this.timeline,device:this.device}):(Vn.error(`unsupported transition type '${n.type}'`)(),l=!1)}(l||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const VA="attributeManager.invalidate",iY="attributeManager.updateStart",sY="attributeManager.updateEnd",oY="attribute.updateStart",aY="attribute.allocate",lY="attribute.updateEnd";class cY{constructor(e,{id:t="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=dg(SZ),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new nY(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Cs(VA,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Cs(VA,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:s,props:l={},buffers:c={},context:a={}}){let g=!1;Cs(iY,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const w=this.attributes[v],P=w.settings.accessor;w.startIndices=n,w.numInstances=t,l[v]&&Vn.removed(`props.${v}`,`data.attributes.${v}`)(),w.setExternalBuffer(c[v])||w.setBinaryValue(typeof P=="string"?c[P]:void 0,e.startIndices)||typeof P=="string"&&!c[P]&&w.setConstantValue(a,l[P])||w.needsUpdate()&&(g=!0,this._updateAttribute({attribute:w,numInstances:t,data:e,props:l,context:a})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}g&&Cs(sY,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const l in t){const c=t[l];c.needsRedraw(e)&&!n.hasAttribute(l)&&(s[l]=c)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const s=e[n],l={...s,id:n,size:s.isIndexed&&1||s.size||1,...t};this.attributes[n]=new uR(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:s}=this,l=s[e];return l&&l.forEach(c=>{const a=n[c];a&&a.setNeedsUpdate(a.id,t)}),l}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Cs(oY,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(n)&&Cs(aY,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,Cs(lY,t,n))}}class uY extends ky{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:s,easing:l}}=this,c=l(e/s);this._value=ny(t,n,c)}}const jA=1e-5;function WA(r,e,t,n,s){const l=e-r,a=(t-e)*s,g=-l*n;return a+g+l+e}function hY(r,e,t,n,s){if(Array.isArray(t)){const l=[];for(let c=0;c<t.length;c++)l[c]=WA(r[c],e[c],t[c],n,s);return l}return WA(r,e,t,n,s)}function $A(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const s=r[n]-e[n];t+=s*s}return Math.sqrt(t)}return Math.abs(r-e)}class dY extends ky{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:s}=this.settings,{_prevValue:l=e,_currValue:c=e}=this;let a=hY(l,c,t,n,s);const g=$A(a,t),v=$A(a,c);g<jA&&v<jA&&(a=t,this.end()),this._prevValue=c,this._currValue=a}}const fY={interpolation:uY,spring:dY};class pY{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,s){const{transitions:l}=this;if(l.has(e)){const g=l.get(e),{value:v=g.settings.fromValue}=g;t=v,this.remove(e)}if(s=cR(s),!s)return;const c=fY[s.type];if(!c){Vn.error(`unsupported transition type '${s.type}'`)();return}const a=new c(this.timeline);a.start({...s,fromValue:t,toValue:n}),l.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function gY(r){const e=r[au];for(const t in e){const n=e[t],{validate:s}=n;if(s&&!s(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function mY(r,e){const t=yR({newProps:r,oldProps:e,propTypes:r[au],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=yY(r,e);let s=!1;return n||(s=vY(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:s,extensionsChanged:bY(r,e),transitionsChanged:_Y(r,e)}}function _Y(r,e){if(!r.transitions)return!1;const t={},n=r[au];let s=!1;for(const l in r.transitions){const c=n[l],a=c&&c.type;(a==="number"||a==="color"||a==="array")&&r0(r[l],e[l],c)&&(t[l]=!0,s=!0)}return s?t:!1}function yR({newProps:r,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:s="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const l of Object.keys(r))if(!(l in t)){if(!(l in e))return`${s}.${l} added`;const c=r0(r[l],e[l],n[l]);if(c)return`${s}.${l} ${c}`}for(const l of Object.keys(e))if(!(l in t)){if(!(l in r))return`${s}.${l} dropped`;if(!Object.hasOwnProperty.call(r,l)){const c=r0(r[l],e[l],n[l]);if(c)return`${s}.${l} ${c}`}}return!1}function r0(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function yY(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:s}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(r.data,e.data)||t),t}function vY(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&HA(r,e,"all"))return{all:!0};const t={};let n=!1;for(const s in r.updateTriggers)s!=="all"&&HA(r,e,s)&&(t[s]=!0,n=!0);return n?t:!1}function bY(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(t[s]))return!0;return!1}function HA(r,e,t){let n=r.updateTriggers[t];n=n??{};let s=e.updateTriggers[t];return s=s??{},yR({oldProps:s,newProps:n,triggerName:t})}const xY="count(): argument not an object",wY="count(): argument not a container";function TY(r){if(!AY(r))throw new Error(xY);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(SY(r))return Object.keys(r).length;throw new Error(wY)}function SY(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function AY(r){return r!==null&&typeof r=="object"}function ZA(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(s=>s.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const s in e.inject)n[s]=(n[s]||"")+e.inject[s];t.inject=n}return t}const EY={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},n0={};function PY(r,e,t,n){if(t instanceof Qi)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:l,height:c}=t.data,a=e.createTexture({...t,sampler:{...EY,...s,...n},mipLevels:e.getMipLevelCount(l,c)});return a.generateMipmapsWebGL(),n0[a.id]=r,a}function IY(r,e){!e||!(e instanceof Qi)||n0[e.id]===r&&(e.delete(),delete n0[e.id])}const CY={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||i0(r)&&(r.length===3||r.length===4)},equal(r,e,t){return vo(r,e,1)}},accessor:{validate(r,e){const t=ly(r);return t==="function"||t===ly(e.value)},equal(r,e,t){return typeof e=="function"?!0:vo(r,e,1)}},array:{validate(r,e){return e.optional&&!r||i0(r)},equal(r,e,t){const{compare:n}=t,s=Number.isInteger(n)?n:n?1:0;return n?vo(r,e,s):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,s=Number.isInteger(n)?n:n?1:0;return n?vo(r,e,s):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:PY(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{IY(t.id,r)}}};function RY(r){const e={},t={},n={};for(const[s,l]of Object.entries(r)){const c=l?.deprecatedFor;if(c)n[s]=Array.isArray(c)?c:[c];else{const a=MY(s,l);e[s]=a,t[s]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function MY(r,e){switch(ly(e)){case"object":return op(r,e);case"array":return op(r,{type:"array",value:e,compare:!1});case"boolean":return op(r,{type:"boolean",value:e});case"number":return op(r,{type:"number",value:e});case"function":return op(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function op(r,e){return"type"in e?{name:r,...CY[e.type],...e}:"value"in e?{name:r,type:ly(e.value),...e}:{name:r,type:"object",value:e}}function i0(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function ly(r){return i0(r)?"array":r===null?"null":typeof r}function kY(r,e){let t;for(let l=e.length-1;l>=0;l--){const c=e[l];"extensions"in c&&(t=c.extensions)}const n=s0(r.constructor,t),s=Object.create(n);s[ay]=r,s[mu]={},s[rc]={};for(let l=0;l<e.length;++l){const c=e[l];for(const a in c)s[a]=c[a]}return Object.freeze(s),s}const DY="_mergedDefaultProps";function s0(r,e){if(!(r instanceof Dy.constructor))return{};let t=DY;if(e)for(const s of e){const l=s.constructor;l&&(t+=`:${l.extensionName||l.name}`)}const n=vR(r,t);return n||(r[t]=OY(r,e||[]))}function OY(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),s=s0(n),l=vR(r,"defaultProps")||{},c=RY(l),a=Object.assign(Object.create(null),s,c.defaultProps),g=Object.assign(Object.create(null),s?.[au],c.propTypes),v=Object.assign(Object.create(null),s?.[Lb],c.deprecatedProps);for(const w of e){const P=s0(w.constructor);P&&(Object.assign(a,P),Object.assign(g,P[au]),Object.assign(v,P[Lb]))}return FY(a,r),LY(a,g),NY(a,v),a[au]=g,a[Lb]=v,e.length===0&&!Xw(r,"_propTypes")&&(r._propTypes=g),a}function FY(r,e){const t=zY(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function NY(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const s=`${this.id}: ${t}`;for(const l of e[t])Xw(this,l)||(this[l]=n);Vn.deprecated(s,e[t].join("/"))()}})}function LY(r,e){const t={},n={};for(const s in e){const l=e[s],{name:c,value:a}=l;l.async&&(t[c]=a,n[c]=BY(c))}r[cd]=t,r[mu]={},Object.defineProperties(r,n)}function BY(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||lR(e)?this[mu][r]=e:this[rc][r]=e},get(){if(this[rc]){if(r in this[rc])return this[rc][r]||this[cd][r];if(r in this[mu]){const e=this[ay]&&this[ay].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[cd][r]}}return this[cd][r]}}}function Xw(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function vR(r,e){return Xw(r,e)&&r[e]}function zY(r){const e=r.componentName;return e||Vn.warn(`${r.name}.componentName not specified`)(),e||r.name}let UY=0;class Dy{constructor(...e){this.props=kY(this,e),this.id=this.props.id,this.count=UY++}clone(e){const{props:t}=this,n={};for(const s in t[cd])s in t[rc]?n[s]=t[rc][s]:s in t[mu]&&(n[s]=t[mu][s]);return new this.constructor({...t,...n,...e})}}Dy.componentName="Component";Dy.defaultProps={};const VY=Object.freeze({});class jY{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||VY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[ay]||this.component;const t=e[rc]||{},n=e[mu]||e,s=e[cd]||{};for(const l in t){const c=t[l];this._createAsyncPropData(l,s[l]),this._updateAsyncProp(l,c),t[l]=this.getAsyncProp(l)}for(const l in n){const c=n[l];this._createAsyncPropData(l,s[l]),this._updateAsyncProp(l,c)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(lR(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;t.then(l=>{this.component&&(l=this._postProcessValue(n,l),this._setAsyncPropValue(e,l,s),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let l=[],c=0;for await(const a of t){if(!this.component)return;const{dataTransform:g}=this.component.props;g?l=g(a,l):l=l.concat(a),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:c,endRow:l.length}]}),c=l.length,this._setAsyncPropValue(e,l,s)}this._onResolve(e,l)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[au];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class WY extends jY{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,s=n?.props.fetch;return s?s(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const s=n.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const $Y="layer.changeFlag",HY="layer.initialize",ZY="layer.update",XY="layer.finalize",qY="layer.matched",XA=2**24-1,GY=Object.freeze([]),YY=dg(({oldViewport:r,viewport:e})=>r.equals(e));let zo=new Uint8ClampedArray(0);const KY={data:{type:"data",value:GY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:n,loadOptions:s,signal:l})=>{const{resourceManager:c}=t.context;s=s||t.getLoadOptions(),n=n||t.props.loaders,l&&(s={...s,fetch:{...s?.fetch,signal:l}});let a=c.contains(r);return!a&&!s&&(c.add({resourceId:r,data:Z_(r,n),persistent:!1}),a=!0),a?c.subscribe({resourceId:r,onChange:g=>t.internalState?.reloadAsyncProp(e,g),consumerId:t.id,requestId:e}):Z_(r,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Nn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class qw extends Dy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=qh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ji(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=UC(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,l,c]=NC(n,t.pixelProjectionMatrix);return e.length===2?[s,l]:[s,l,c]}unproject(e){return Ji(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ji(this.internalState);const n=this.internalState.viewport||this.context.viewport;return RZ(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Nn.DEFAULT||e===Nn.LNGLAT||e===Nn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ji(e instanceof Uint8Array);const[t,n,s]=e;return t+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:TY(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=ZA(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=ZA(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const s of n)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,l=this.internalState.hasPickingBuffer,c=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(l!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:a,instancePickingColors:g}=t.attributes,v=a||g;v&&(c&&v.constant&&(v.constant=!1,t.invalidate(v.id)),!v.value&&!c&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!YY({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const s in t)Object.defineProperty(n,s,{value:t[s]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(zo.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>XA&&Vn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zo=Kp.allocate(zo,t,{size:4,copy:!0,maxCount:Math.max(t,XA)});const s=Math.floor(zo.length/4),l=[0,0,0];for(let c=n;c<s;c++)this.encodePickingColor(c,l),zo[c*4+0]=l[0],zo[c*4+1]=l[1],zo[c*4+2]=l[2],zo[c*4+3]=0}e.value=zo.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){if(!Object.keys(t).length)return;if(n){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),t=a.getAttributes()}const s=e.userData?.excludeAttributes||{},l={},c={};for(const a in t){if(s[a])continue;const g=t[a].getValue();for(const v in g){const w=g[v];w instanceof ni?t[a].settings.isIndexed?e.setIndexBuffer(w):l[v]=w:w&&(c[v]=w)}}e.setAttributes(l),e.setConstantAttributes(c)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,l=n||s,c=l&&t.attributes&&t.attributes[l.id];if(c&&c.value){const a=c.value,g=this.encodePickingColor(e);for(let v=0;v<t.length;v++){const w=l.getVertexOffset(v);a[w]===g[0]&&a[w+1]===g[1]&&a[w+2]===g[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,s=t||n;if(!s)return;const l=s.getVertexOffset(e),c=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(c-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==zo.buffer&&(n.value=zo.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ji(!this.internalState),Ji(Number.isFinite(this.props.coordinateSystem)),Cs(HY,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new WY({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Vn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new pY(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Cs(qY,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Cs(ZY,this,e),!e)return;const t=this.props,n=this.context,s=this.internalState,l=n.viewport,c=this._updateUniformTransition();s.propsInTransition=c,n.viewport=s.viewport||l,this.props=c;try{const a=this._getUpdateParams(),g=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const w of this.props.extensions)w.updateState.call(this,a,w);this.setNeedsRedraw(),this._updateAttributes();const v=this.getModels()[0]!==g[0];this._postUpdate(a,v)}finally{n.viewport=l,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Cs(XY,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const l=this.props,c=this.context;this.props=this.internalState.propsInTransition||l;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,g=a&&a(n)||[0,0];c.device instanceof e0&&c.device.setParametersWebGL({polygonOffset:g});for(const v of this.getModels())v.device.type==="webgpu"?v.setParameters({...v.parameters,...s}):v.setParameters(s);if(c.device instanceof e0)c.device.withParametersWebGL(s,()=>{const v={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:c};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)});else{const v={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:s,context:c};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)}}finally{this.props=l}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let l=!1;switch(s){case"dataChanged":const c=e[s],a=t[s];c&&Array.isArray(a)&&(t.dataChanged=Array.isArray(c)?a.concat(c):c,l=!0);default:t[s]||(t[s]=e[s],l=!0)}l&&Cs($Y,this,s,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=mY(e,t);if(n.updateTriggersChanged)for(const s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(const s in n.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(n)}validateProps(){gY(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new cY(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:s}=e,l=this.state.model;l?.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:a,highlightColor:g}=n;if(t||s.autoHighlight!==c||s.highlightedObjectIndex!==a||s.highlightColor!==g){const v={};Array.isArray(g)&&(v.highlightColor=g),(t||s.autoHighlight!==c||a!==s.highlightedObjectIndex)&&(v.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:v})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(e):!1;if(t=t||s,t)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}qw.defaultProps=KY;qw.layerName="Layer";const n_=Math.PI/180,qA=180/Math.PI,A_=6370972,rd=256;function QY(){const r=rd/A_,e=Math.PI/180*rd;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class JY extends Ld{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:l=1,resolution:c=10}=e;let{latitude:a=0,height:g,altitude:v=1.5,fovy:w}=e;a=Math.max(Math.min(a,tc),-tc),g=g||1,w?v=kw(w):w=Yp(v);const P=1/Math.PI/Math.cos(a*Math.PI/180),I=Math.pow(2,n)*P,k=e.nearZ??s,N=e.farZ??(v+rd*2*I/g)*l,D=new Xo().lookAt({eye:[0,-v,0],up:[0,0,1]});D.rotateX(a*n_),D.rotateZ(-t*n_),D.scale(I/g),super({...e,height:g,viewMatrix:D,longitude:t,latitude:a,zoom:n,distanceScales:QY(),fovy:w,focalDistance:v,near:k,far:N}),this.scale=I,this.latitude=a,this.longitude=t,this.resolution=c}get projectionMode(){return ro.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),l=this.unproject([this.width,this.height/2],t),c=this.unproject([this.width/2,this.height],t);return l[0]<this.longitude&&(l[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],l[0],s[0],c[0]),Math.min(n[1],l[1],s[1],c[1]),Math.max(n[0],l[0],s[0],c[0]),Math.max(n[1],l[1],s[1],c[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[s,l,c]=e,a=t?l:this.height-l,{pixelUnprojectionMatrix:g}=this;let v;if(Number.isFinite(c))v=$b(g,[s,a,c,1]);else{const k=$b(g,[s,a,-1,1]),N=$b(g,[s,a,1,1]),D=((n||0)/A_+1)*rd,B=Eb(yC([],k,N)),U=Eb(k),V=Eb(N),$=4*((4*U*V-(B-U-V)**2)/16)/B,te=Math.sqrt(U-$),G=Math.sqrt(Math.max(0,D*D-$)),le=(te-G)/Math.sqrt(B);v=I$([],k,N,le)}const[w,P,I]=this.unprojectPosition(v);return Number.isFinite(c)?[w,P,I]:Number.isFinite(n)?[w,P,n]:[w,P]}projectPosition(e){const[t,n,s=0]=e,l=t*n_,c=n*n_,a=Math.cos(c),g=(s/A_+1)*rd;return[Math.sin(l)*a*g,-Math.cos(l)*a*g,Math.sin(c)*g]}unprojectPosition(e){const[t,n,s]=e,l=F$(e),c=Math.asin(s/l),g=Math.atan2(t,-n)*qA,v=c*qA,w=(l/rd-1)*A_;return[g,v,w]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function $b(r,e){const t=Nd([],e,r);return xC(t,t,1/t[3]),t}class eK extends XC{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:s}=e;e.zoom=ba(s,n,t);const{longitude:l,latitude:c}=e;return(l<-180||l>180)&&(e.longitude=bZ(l+180,360)-180),e.latitude=ba(c,-tc,tc),e}}class tK extends ZC{constructor(){super(...arguments),this.ControllerState=eK,this.transition={transitionDuration:300,transitionInterpolator:new Bw(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class bR extends HC{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?gu:JY}get ControllerType(){return tK}}bR.displayName="GlobeView";const tg="mapbox",Hb=512,rK=Math.PI/180;function xR({map:r,gl:e,deck:t}){if(r.__deck)return r.__deck;const n=t?.props._customRender,s=t?.props.onLoad,l={...t?.props,_customRender:()=>{r.triggerRepaint(),n?.("")}};l.parameters={...E_(r,!0),...l.parameters},l.views||(l.views=Dp(r));let c;return(!t||t.props.gl===e)&&(Object.assign(l,{gl:e,width:null,height:null,touchAction:"unset",viewState:rg(r)}),t?.isInitialized?GA(t,r):l.onLoad=()=>{s?.(),GA(c,r)}),t?(c=t,t.setProps(l),t.userData.isExternal=!0):(c=new eg(l),r.on("remove",()=>{wR(r)})),c.userData.mapboxLayers=new Set,r.__deck=c,r.on("render",()=>{c.isInitialized&&lK(c,r)}),c}function GA(r,e){const t=()=>{r.isInitialized?cK(r,e):e.off("move",t)};e.on("move",t)}function wR(r){r.__deck?.finalize(),r.__deck=null}function E_(r,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return Gw(r)==="globe"&&(t.cullMode="back"),t}function nK(r,e){r.userData.mapboxLayers.add(e),Yw(r)}function iK(r,e){r.userData.mapboxLayers.delete(e),Yw(r)}function sK(r,e){Yw(r)}function oK(r,e,t,n){let{currentViewport:s}=r.userData,l=!1;s||(s=TR(r,e,n),r.userData.currentViewport=s,l=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:c=>(!r.props.layerFilter||r.props.layerFilter(c))&&(t.id===c.layer.id||c.layer.props.operation.includes("terrain")),clearStack:l,clearCanvas:!1})}function Gw(r){const e=r.getProjection?.(),t=e?.type||e?.name;if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function Dp(r){return Gw(r)==="globe"?new bR({id:tg}):new zw({id:tg})}function rg(r){const{lng:e,lat:t}=r.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return r.getTerrain?.()&&aK(r,n),n}function aK(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=r.transform.height,{longitude:s,latitude:l,pitch:c}=e,a=t.x*Hb,g=(1-t.y)*Hb,v=t.z*Hb,w=Gp([s,l]),P=a-w[0],I=g-w[1],k=Math.sqrt(P*P+I*I),N=c*rK,D=1.5*n,B=N<.001?D*Math.cos(N)/v:D*Math.sin(N)/k;e.zoom=Math.log2(B);const U=D*Math.cos(N)/B,V=v-U;e.position=[0,0,V/T_(l)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function TR(r,e,t){const n=rg(e),{views:s}=r.props,l=s&&bd(s).find(g=>g.id===tg)||Dp(e);t&&(l.props.nearZMultiplier=.2);const c=t?.nearZ??e.transform._nearZ,a=t?.farZ??e.transform._farZ;return Number.isFinite(c)&&(n.nearZ=c/e.transform.height,n.farZ=a/e.transform.height),l.makeViewport({width:r.width,height:r.height,viewState:n})}function lK(r,e){const{mapboxLayers:t,isExternal:n}=r.userData;if(n){const s=Array.from(t,w=>w.id),c=bd(r.props.layers,Boolean).some(w=>w&&!s.includes(w.id));let a=r.getViewports();const g=a.findIndex(w=>w.id===tg),v=a.length>1||g<0;(c||v)&&(g>=0&&(a=a.slice(),a[g]=TR(r,e)),r._drawLayers("mapbox-repaint",{viewports:a,layerFilter:w=>(!r.props.layerFilter||r.props.layerFilter(w))&&(w.viewport.id!==tg||!s.includes(w.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function cK(r,e){r.setProps({viewState:rg(e)}),r.needsRedraw({clearRedrawFlags:!0})}function Yw(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const n=t.props.type,s=new n(t.props);e.push(s)}),r.setProps({layers:e})}class uK{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=xR({map:e,gl:t,deck:this.props.deck}),nK(this.deck,this)}onRemove(){this.deck&&iK(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&sK(this.deck)}render(e,t){oK(this.deck,this.map,this,t)}}const Zb="__UNDEFINED__";function i_(r,e,t,n){if(!r||!e||!r.style||!r.style._loaded)return;const s=bd(n,Boolean);if(t!==n){const a=bd(t,Boolean),g=new Set(a.map(v=>v.id));for(const v of s)g.delete(v.id);for(const v of g)r.getLayer(v)&&r.removeLayer(v)}for(const a of s){const g=r.getLayer(a.id);g?(g.implementation||g).setProps(a.props):r.addLayer(new uK({id:a.id,deck:e,slot:a.props.slot}),a.props.beforeId)}const l=r.style._order,c={};for(const a of s){let{beforeId:g}=a.props;(!g||!l.includes(g))&&(g=Zb),c[g]=c[g]||[],c[g].push(a.id)}for(const a in c){const g=c[a];let v=a===Zb?l.length:l.indexOf(a),w=a===Zb?void 0:a;for(let P=g.length-1;P>=0;P--){const I=g[P],k=l.indexOf(I);k!==v-1&&(r.moveLayer(I,w),k>v&&v++),v--,w=I}}}class hK{constructor(e){this._handleStyleChange=()=>{if(i_(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;Gw(this._map)&&!this._props.views&&this._deck?.setProps({views:Dp(this._map)})},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:n,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${s}px`})}},this._updateViewState=()=>{const n=this._deck,s=this._map;n&&s&&(n.setProps({views:this._props.views||Dp(s),viewState:rg(s)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{const s=this._deck;if(!s||!s.isInitialized)return;const l={type:n.type,offsetCenter:n.point,srcEvent:n},c=this._lastMouseDownPoint;switch(!n.point&&c&&(l.deltaX=n.originalEvent.clientX-c.clientX,l.deltaY=n.originalEvent.clientY-c.clientY,l.offsetCenter={x:c.x+l.deltaX,y:c.y+l.deltaY}),l.type){case"mousedown":s._onPointerDown(l),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":l.type="panstart",s._onEvent(l);break;case"drag":l.type="panmove",s._onEvent(l);break;case"dragend":l.type="panend",s._onEvent(l);break;case"click":l.tapCount=1,s._onEvent(l);break;case"dblclick":l.type="click",l.tapCount=2,s._onEvent(l);break;case"mousemove":l.type="pointermove",s._onPointerMove(l);break;case"mouseout":l.type="pointerleave",s._onPointerMove(l);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:n,...s}=e;return!t&&n!==void 0&&(s.useDevicePixels=n),s}setProps(e){this._interleaved&&e.layers&&i_(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...E_(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new eg({...this._props,parent:t,parameters:{...E_(e,!1),...this._props.parameters},views:this._props.views||Dp(e),viewState:rg(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Vn.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=xR({map:e,gl:t,deck:new eg({...this._props,gl:t,parameters:{...E_(e,!1),...this._props.parameters},deviceProps:{createCanvasContext:{autoResize:!0}}})}),e.on("styledata",this._handleStyleChange),i_(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),i_(e,this._deck,this._props.layers,[]),wR(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Ji(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ji(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ji(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const YA=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,dK={name:"icon",vs:YA,fs:YA,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},fK=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,pK=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gK=1024,mK=4,KA=()=>{},QA={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},_K={x:0,y:0,width:0,height:0};function yK(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function vK(r,e,t,n){const s=Math.min(t/e.width,n/e.height),l=Math.floor(e.width*s),c=Math.floor(e.height*s);return s===1?{image:e,width:l,height:c}:(r.canvas.height=c,r.canvas.width=l,r.clearRect(0,0,l,c),r.drawImage(e,0,0,e.width,e.height,0,0,l,c),{image:r.canvas,width:l,height:c})}function ng(r){return r&&(r.id||r.url)}function bK(r,e,t,n){const{width:s,height:l,device:c}=r,a=c.createTexture({format:"rgba8unorm",width:e,height:t,sampler:n,mipLevels:c.getMipLevelCount(e,t)}),g=c.createCommandEncoder();return g.copyTextureToTexture({sourceTexture:r,destinationTexture:a,width:s,height:l}),g.finish(),a.generateMipmapsWebGL(),r.destroy(),a}function JA(r,e,t){for(let n=0;n<e.length;n++){const{icon:s,xOffset:l}=e[n],c=ng(s);r[c]={...s,x:l,y:t}}}function xK({icons:r,buffer:e,mapping:t={},xOffset:n=0,yOffset:s=0,rowHeight:l=0,canvasWidth:c}){let a=[];for(let g=0;g<r.length;g++){const v=r[g],w=ng(v);if(!t[w]){const{height:P,width:I}=v;n+I+e>c&&(JA(t,a,s),n=0,s=l+s+e,l=0,a=[]),a.push({icon:v,xOffset:n}),n=n+I+e,l=Math.max(l,P)}}return a.length>0&&JA(t,a,s),{mapping:t,rowHeight:l,xOffset:n,yOffset:s,canvasWidth:c,canvasHeight:yK(l+s+e)}}function wK(r,e,t){if(!r||!e)return null;t=t||{};const n={},{iterable:s,objectInfo:l}=aR(r);for(const c of s){l.index++;const a=e(c,l),g=ng(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[g]&&(!t[g]||a.url!==t[g].url)&&(n[g]={...a,source:c,sourceIndex:l.index})}return n}class TK{constructor(e,{onUpdate:t=KA,onError:n=KA}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=mK,this._canvasWidth=gK,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?ng(e):e;return this._mapping[t]||_K}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:s,textureParameters:l}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),l&&(this._samplerParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(wK(e,t,this._mapping)||{});if(n.length>0){const{mapping:s,xOffset:l,yOffset:c,rowHeight:a,canvasHeight:g}=xK({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=l,this._yOffset=c,this._canvasHeight=g,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||QA,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=bK(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||QA)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n),this._texture?.generateMipmapsWebGL()}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Z_(n.url,this._loadOptions).then(s=>{const l=ng(n),c=this._mapping[l],{x:a,y:g,width:v,height:w}=c,{image:P,width:I,height:k}=vK(t,s,v,w);this._texture?.copyExternalImage({image:P,x:a+(v-I)/2,y:g+(w-k)/2,width:I,height:k}),c.width=I,c.height=k,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(s=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const SR=[0,0,0,255],SK={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:SR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Kw extends qw{getShaders(){return super.getShaders({vs:fK,fs:pK,modules:[MH,tZ,dK]})}initializeState(){this.state={iconManager:new TK(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:SR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:s}=e,l=this.getAttributeManager(),{iconAtlas:c,iconMapping:a,data:g,getIcon:v,textureParameters:w}=t,{iconManager:P}=this.state;if(typeof c=="string")return;const I=c||this.internalState.isAsyncPropLoading("iconAtlas");P.setProps({loadOptions:t.loadOptions,autoPacking:!I,iconAtlas:c,iconMapping:I?a:null,textureParameters:w}),I?n.iconMapping!==t.iconMapping&&l.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&P.packIcons(g,v),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),l.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeBasis:n,sizeMinPixels:s,sizeMaxPixels:l,sizeUnits:c,billboard:a,alphaCutoff:g}=this.props,{iconManager:v}=this.state,w=v.getTexture();if(w){const P=this.state.model,I={iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:qp[c],sizeScale:t,sizeBasis:n==="height"?1:0,sizeMinPixels:s,sizeMaxPixels:l,billboard:a,alphaCutoff:g};P.shaderInputs.setProps({icon:I}),P.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Qp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new rX({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):Vn.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:s=t/2,anchorY:l=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,n/2-l]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:s,height:l}=this.state.iconManager.getIconMapping(e);return[t,n,s,l]}}Kw.defaultProps=SK;Kw.layerName="IconLayer";function AK(r){const e=.03125*r,t=(r-r/2)/2+e,n=r-2*t,s=r/2,l=n/3.5,c=document.createElement("canvas");c.width=r,c.height=r;const a=c.getContext("2d",{alpha:!0});return a&&(a.beginPath(),a.arc(t+l,s,l,1/2*Math.PI,3/2*Math.PI,!1),a.bezierCurveTo(t+l+l,s-l,r-t,s,r-t,s),a.bezierCurveTo(r-t,s,t+l+l,s+l,t+l,s+l),a.closePath(),a.fillStyle="rgba(255, 0, 0, 0.7)",a.fill(),a.lineWidth=e,a.strokeStyle="rgba(120, 120, 120, 1.0)",a.stroke()),c}var Ls=63710088e-1,AR={centimeters:Ls*100,centimetres:Ls*100,degrees:360/(2*Math.PI),feet:Ls*3.28084,inches:Ls*39.37,kilometers:Ls/1e3,kilometres:Ls/1e3,meters:Ls,metres:Ls,miles:Ls/1609.344,millimeters:Ls*1e3,millimetres:Ls*1e3,nauticalmiles:Ls/1852,radians:1,yards:Ls*1.0936};function EK(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties={},n.geometry=r,n}function PK(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!eE(r[0])||!eE(r[1]))throw new Error("coordinates must contain numbers");return EK({type:"Point",coordinates:r},e,t)}function IK(r,e="kilometers"){const t=AR[e];if(!t)throw new Error(e+" units is invalid");return r*t}function CK(r,e="kilometers"){const t=AR[e];if(!t)throw new Error(e+" units is invalid");return r/t}function RK(r){return r%(2*Math.PI)*180/Math.PI}function Xb(r){return r%360*Math.PI/180}function MK(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return IK(CK(r,e),t)}function eE(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function qc(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kK(r){return r.type==="Feature"?r.geometry:r}function DK(r,e,t={}){const n=qc(r),s=qc(e);s[0]+=s[0]-n[0]>180?-360:n[0]-s[0]>180?360:0;const l=OK(n,s);return MK(l,"meters",t.units)}function OK(r,e,t){t=t===void 0?Ls:Number(t);const n=t,s=r[1]*Math.PI/180,l=e[1]*Math.PI/180,c=l-s;let a=Math.abs(e[0]-r[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);const g=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),v=Math.abs(g)>1e-11?c/g:Math.cos(s);return Math.sqrt(c*c+v*v*a*a)*n}var tE=DK;function FK(r,e,t={}){let n;return t.final?n=rE(qc(e),qc(r)):n=rE(qc(r),qc(e)),n>180?-(360-n):n}function rE(r,e){const t=Xb(r[1]),n=Xb(e[1]);let s=Xb(e[0]-r[0]);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);const l=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),c=Math.atan2(s,l);return(RK(c)+360)%360}var NK=FK;function LK(r,e){Tt(e,!0);let t=wt(void 0);function n(L){var $=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(L);if(!$)throw`${L} is not a hex color #RRGGBB`;return[parseInt($[1],16),parseInt($[2],16),parseInt($[3],16),255]}function s(L){return"#"+(1<<24|L[0]<<16|L[1]<<8|L[2]).toString(16).slice(1)}const l=(L,$)=>(L=L/6e4,$?L<=-30?[255,0,255,255]:L<=-6?[138,82,254,255]:L<=3?[69,194,74,255]:L<=5?[255,237,0,255]:L<=10?[255,102,0,255]:L<=15?[255,48,71,255]:[163,0,10,255]:[100,100,100,255]),c=L=>{let $=[];const te=new Date(L.departure).getTime(),G=new Date(L.arrival).getTime(),le=new Date(L.scheduledArrival).getTime(),se=new Date(L.scheduledDeparture).getTime(),oe=G-le,be=te-se,xe=Qc.decode(L.polyline).map(([Le,tt])=>[tt,Le]),_e=G-te;let Ne=0,fe=0;for(let Le=0;Le<xe.length-1;Le++){let tt=xe[Le],Ye=xe[Le+1];fe+=tE(tt,Ye,{units:"meters"})}for(let Le=0;Le<xe.length-1;Le++){let tt=xe[Le],Ye=xe[Le+1];const rt=tE(tt,Ye,{units:"meters"}),it=NK(tt,Ye),Ct=Ne/fe;$.push({point:tt,heading:it,time:te+Ct*_e}),Ne+=rt}return Math.abs(fe-Ne)>1&&console.debug(fe,Ne),$.push({point:xe[xe.length-1],time:G,heading:0}),{keyFrames:$,arrival:G,departure:te,arrivalDelay:oe,departureDelay:be}},a=(L,$)=>{const te=L.findIndex(oe=>oe.time>=$);if(te===-1||te===0){console.debug("not found, timestamp=",new Date($)," #keyframes=",L.length," first=",new Date(L[0].time),", last=",new Date(L[L.length-1].time));return}const G=L[te-1],le=L[te],se=($-G.time)/(le.time-G.time);return{point:[G.point[0]*(1-se)+le.point[0]*se,G.point[1]*(1-se)+le.point[1]*se],heading:G.heading}},g=L=>{const $=new Date().getTime(),te=L.filter(G=>$>=G.departure&&$<=G.arrival).map(G=>({...G,...a(G.keyFrames,$)})).filter(G=>G.point);return new Kw({id:"trips",data:te,beforeId:"road-name-text",getColor:G=>{switch(e.colorMode){case"rt":return l(G.departureDelay,G.realTime);case"mode":return n(lc(G)[1]);case"route":return n(nl(G)[0]);case"none":return n(nl(G)[0])}},getAngle:G=>-G.heading+90,getPosition:G=>G.point,getSize:G=>48,getIcon:G=>"marker",pickable:!0,iconAtlas:AK(128),iconMapping:{marker:{x:0,y:0,width:128,height:128,anchorY:64,anchorX:64,mask:!0}}})},v=()=>{const L=qn.LngLatBounds.convert(e.bounds),$=cc(L.getNorthWest()),te=cc(L.getSouthEast()),G=new Date,le=new Date(G.getTime()+18e4);return Ik({query:{min:$,max:te,startTime:G.toISOString(),endTime:le.toISOString(),zoom:e.zoom}})};let w=null;const P=async()=>{try{if(e.colorMode=="none"){w&&cancelAnimationFrame(w),S(k).setProps({layers:[]}),clearTimeout(I);return}const{data:L,error:$,response:te}=await v();if(w&&cancelAnimationFrame(w),$){pe(t,`map trips error status ${te.status}`);return}pe(t,void 0);const G=L.map(se=>({...se,...c(se)})),le=()=>{S(k).setProps({layers:[g(G)]}),w=requestAnimationFrame(le)};le()}catch(L){pe(t,L,!0)}};let I,k=wt(void 0);const N=async()=>{await P(),clearTimeout(I),I=setTimeout(()=>{console.debug("updateRailviz: timer"),N()},6e4)},D=new qn.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});kr(()=>{e.map&&!S(k)&&(pe(k,new hK({interleaved:!0,layers:[],onClick:({object:L})=>{L&&Lp(L.trips[0].tripId)},getCursor:()=>e.map.getCanvas().style.cursor,onHover:({object:L,coordinate:$})=>{if(L&&$){const te=D.setLngLat($);L.realTime?te.setHTML(`<strong>${L.trips[0].displayName}</strong><br>

							<span style="color: ${s(l(L.departureDelay,!0))}">${ma(new Date(L.departure),L.from.tz)}</span>
							<span ${L.departureDelay!=0?'class="line-through"':""}>${ma(new Date(L.scheduledDeparture),L.from.tz)}</span>  ${L.from.name}<br>

							<span style="color: ${s(l(L.arrivalDelay,!0))}">${ma(new Date(L.arrival),L.to.tz)}</span>
							<span ${L.arrivalDelay!=0?'class="line-through"':""}>${ma(new Date(L.scheduledArrival),L.to.tz)}</span> ${L.to.name}`):te.setHTML(`<strong>${L.trips[0].displayName}</strong><br>
							${ma(new Date(L.departure),L.from.tz)} ${L.from.name}<br>
							${ma(new Date(L.arrival),L.to.tz)} ${L.to.name}`),te.addTo(e.map)}else D.remove()}})),e.map.addControl(S(k)),console.debug("updateRailviz: init"),Ms(()=>N()))}),kr(()=>{S(k)&&e.bounds&&e.zoom&&e.colorMode&&Ms(()=>{console.debug(`updateRailviz: effect ${S(k)} ${e.bounds} ${e.zoom} ${e.colorMode}`),N()})}),hc(()=>{w&&cancelAnimationFrame(w),clearTimeout(I),e.map&&S(k)&&e.map.removeControl(S(k))});var B=We(),U=ue(B);{var V=L=>{_o(L,{position:"bottom-left",children:($,te)=>{Yr();var G=Br();mt(()=>pt(G,S(t))),Z($,G)},$$slots:{default:!0}})};Ze(U,L=>{S(t)&&L(V)})}Z(r,B),St()}function qb(r,e){const t=C_(e,["children","$$slots","$$events","$$legacy"]),n=C_(t,["class","value"]);Tt(e,!1);let s=ae(e,"class",8,void 0),l=ae(e,"value",8);dy();{let c=d0(()=>(I_(_n),I_(s()),Ms(()=>_n("ring-offset-background focus-visible:ring-ring mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",s()))));iz(r,zr({get class(){return S(c)},get value(){return l()}},()=>n,{children:(a,g)=>{var v=We(),w=ue(v);EE(w,e,"default",{}),Z(a,v)},$$slots:{default:!0}}))}St()}function BK(r,e){const t=C_(e,["children","$$slots","$$events","$$legacy"]),n=C_(t,["class"]);Tt(e,!1);let s=ae(e,"class",8,void 0);dy();{let l=d0(()=>(I_(_n),I_(s()),Ms(()=>_n("bg-muted text-muted-foreground inline-flex h-10 items-center justify-center rounded-md p-1",s()))));oz(r,zr({get class(){return S(l)}},()=>n,{children:(c,a)=>{var g=We(),v=ue(g);EE(v,e,"default",{}),Z(c,g)},$$slots:{default:!0}}))}St()}function Gb(r,e){Tt(e,!0),ae(e,"ref",11,null);let t=ae(e,"class",7),n=hr(e,["$$slots","$$events","$$legacy","ref","class","value"]);var s={get class(){return t()},set class(a){t(a)}},l=We(),c=ue(l);{let a=me(()=>_n("ring-offset-background focus-visible:ring-ring data-[state=active]:bg-background data-[state=active]:text-foreground inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm",t()));ar(c,()=>lz,(g,v)=>{v(g,zr({get class(){return S(a)},get value(){return e.value}},()=>n))})}return Z(r,l),St(s)}const zK=rz;var UK=Fe('<div id="searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!></div>');function VK(r,e){Tt(e,!0);let t=wt(void 0),n=wt(tn([]));var s=UK(),l=Ae(s);Hp(l,{name:"from",get placeholder(){return yt.from},type:"STOP",onChange:c=>{c.match&&Ad(c.label,c.match.id,e.time)},get selected(){return S(t)},set selected(c){pe(t,c,!0)},get items(){return S(n)},set items(c){pe(n,c,!0)}}),we(s),Z(r,s),St()}const nE=["NONE","OVERLAY_RECTS","OVERLAY_CIRCLES","GEOMETRY_CIRCLES"],ER=(r,e)=>nE.indexOf(r)<nE.indexOf(e),jK=(r,e)=>ER(r,e)?r:e,iE=r=>r=="OVERLAY_RECTS"||r=="OVERLAY_CIRCLES";function WK(r){return new Worker(""+new URL("../workers/IsochronesWorker-BKvCiwLF.js",import.meta.url).href,{name:r?.name})}function $K(r,e){Tt(e,!0);let t=ae(e,"options",15);const n={type:"LineString",coordinates:[]};let s=wt(void 0),l=wt("NONE");const c=me(()=>e.streetModes.includes("BIKE")?.0038:e.wheelchair?8e-4:.0012),a=me(()=>qn.LngLatBounds.convert(e.bounds??[[0,0],[1,1]])),g=me(()=>[[S(a)._sw.lng,S(a)._ne.lat],[S(a)._ne.lng,S(a)._ne.lat],[S(a)._ne.lng,S(a)._sw.lat],[S(a)._sw.lng,S(a)._sw.lat]]);let v=[],w=0,P=0,I=0;ag(()=>{w=e.maxAllTime,P=S(c)}),kr(()=>{if(!e.map||!e.active||S(s)!==void 0)return;const N="isochrones-canvas",D="isochrones-circles";let B=document.createElement("canvas");if(B===void 0){console.log("Canvas not supported");return}let U=B.transferControlToOffscreen();e.map.addSource(N,{type:"canvas",canvas:B,coordinates:S(g)}),e.map.addLayer({id:N,type:"raster",source:N,paint:{"raster-opacity":t().opacity/1e3}});const V=e.map.getSource(N);e.map.addSource(D,{type:"geojson",data:n}),e.map.addLayer({id:D,type:"fill",source:D,paint:{"fill-color":t().color,"fill-opacity":t().opacity/1e3}});const L=e.map.getSource(D),$=new WK;$.onmessage=te=>{const G=te.data.method;switch(G){case"update-display-level":{const le=te.data.index;if(le<I){console.log(`Got stale index from worker (Got ${le}, expected ${I})`);return}const se=te.data.level;se=="GEOMETRY_CIRCLES"&&S(s)&&S(s).circlesSource.setData(te.data.geometry??n),ER(S(l),se)&&pe(l,se,!0)}break;default:console.log(`Unknown method '${G}'`)}},$.postMessage({method:"set-canvas",canvas:U},[U]),pe(s,{worker:$,canvasLayer:N,circlesLayer:D,canvasSource:V,circlesSource:L},!0)}),kr(()=>{!e.active||t().status=="FAILED"||S(s)===void 0||(((v.length!=0||e.isochronesData.length!=0)&&v!=e.isochronesData||w!=e.maxAllTime||P!=S(c))&&(S(s).worker.postMessage({method:"update-data",index:++I,data:ps(e.isochronesData),kilometersPerSecond:ps(S(c)),maxSeconds:ps(e.maxAllTime),circleResolution:e.circleResolution}),v=e.isochronesData,w=e.maxAllTime,P=S(c),pe(l,"NONE"),S(s).circlesSource.setData(n)),S(s).worker.postMessage({method:"set-max-display-level",displayLevel:t().displayLevel}))}),kr(()=>{!e.map||S(s)===void 0||(e.map.setLayoutProperty(S(s).canvasLayer,"visibility",e.active&&iE(S(k))?"visible":"none"),e.map.setLayoutProperty(S(s).circlesLayer,"visibility",e.active&&S(k)=="GEOMETRY_CIRCLES"?"visible":"none"))}),kr(()=>{!e.map||S(s)===void 0||(e.map.setPaintProperty(S(s).canvasLayer,"raster-opacity",t().opacity/1e3),e.map.setPaintProperty(S(s).circlesLayer,"fill-opacity",t().opacity/1e3))}),kr(()=>{!e.map||S(s)===void 0||e.map.setPaintProperty(S(s).circlesLayer,"fill-color",t().color)});let k=me(()=>{if(!e.map||!e.active||S(s)===void 0)return"NONE";const N=jK(t().displayLevel,S(l));if(iE(N)){S(s).canvasSource.setCoordinates(S(g));const D=e.map._containerDimensions();S(s).worker.postMessage({method:"render-canvas",level:N,boundingBox:ps(S(a)),dimensions:D,color:t().color})}return N});kr(()=>{t(t().status=e.isochronesData.length==0?"EMPTY":S(k)=="NONE"||S(k)==t().displayLevel?"DONE":"WORKING",!0)}),St()}var HK=Fe('<div class="flex items-center justify-center w-full"><!></div>'),ZK=Fe("<div><!> <!> <!></div>");function XK(r,e){Tt(e,!0);var t=ZK(),n=Ae(t);{var s=v=>{var w=HK(),P=Ae(w);Np(P,{class:"animate-spin w-12 h-12 m-4"}),we(w),Z(v,w)};Ze(n,v=>{e.options.status=="WORKING"&&v(s)})}var l=ve(n,2);{var c=v=>{nu(v,{get e(){return yt.isochrones.noData}})};Ze(l,v=>{e.options.status=="EMPTY"&&v(c)})}var a=ve(l,2);{var g=v=>{{let w=me(()=>`${yt.isochrones.requestFailed}`+(e.options.error?`: ${e.options.error}`:""));nu(v,{get e(){return S(w)}})}};Ze(a,v=>{e.options.status=="FAILED"&&v(g)})}we(t),Z(r,t),St()}var qK=Fe("<!> <!>",1),GK=Fe('<span class="bg-dark-10 relative h-2 w-full grow cursor-pointer overflow-hidden rounded-full"><!></span> <!>',1),YK=Fe('<div class="grid grid-cols-[2fr_2fr_1fr] items-center gap-2"><!> <!> <input class="flex right-0 align-right" type="color"/></div>'),KK=Fe("<!> <span> </span>",1),QK=Fe("<!> <span> </span>",1),JK=Fe("<!> <!>",1),eQ=Fe('<div id="isochrones-searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!> <!> <div class="flex flex-row gap-2 flex-wrap"><!> <!> <!></div></div>');function tQ(r,e){Tt(e,!0);const t=Et=>{var vt=YK(),Pr=Ae(vt);ar(Pr,()=>ru,(br,lr)=>{lr(br,{type:"single",get value(){return $().displayLevel},set value(ut){$($().displayLevel=ut,!0)},children:(ut,Zt)=>{var dr=qK(),er=ue(dr);ar(er,()=>tu,(mr,Tr)=>{Tr(mr,{class:"overflow-hidden",get"aria-label"(){return yt.isochrones.displayLevel},children:(fr,nr)=>{Yr();var rr=Br();mt(Nr=>pt(rr,Nr),[()=>be.get($().displayLevel)]),Z(fr,rr)},$$slots:{default:!0}})});var Bt=ve(er,2);ar(Bt,()=>eu,(mr,Tr)=>{Tr(mr,{sideOffset:10,children:(fr,nr)=>{var rr=We(),Nr=ue(rr);xn(Nr,19,()=>xe,(Cr,qr)=>qr+Cr.value,(Cr,qr)=>{var ir=We(),or=ue(ir);ar(or,()=>Jc,(Re,Y)=>{Y(Re,{get value(){return S(qr).value},get label(){return S(qr).label},children:(ee,ie)=>{Yr();var Te=Br();mt(()=>pt(Te,S(qr).label)),Z(ee,Te)},$$slots:{default:!0}})}),Z(Cr,ir)}),Z(fr,rr)},$$slots:{default:!0}})}),Z(ut,dr)},$$slots:{default:!0}})});var yr=ve(Pr,2);ar(yr,()=>AB,(br,lr)=>{lr(br,{type:"single",min:0,max:1e3,class:"relative flex w-full touch-none select-none items-center",get value(){return $().opacity},set value(ut){$($().opacity=ut,!0)},children:(ut,Zt)=>{var dr=GK(),er=ue(dr),Bt=Ae(er);ar(Bt,()=>PB,(Tr,fr)=>{fr(Tr,{class:"bg-foreground absolute h-full"})}),we(er);var mr=ve(er,2);ar(mr,()=>CB,(Tr,fr)=>{fr(Tr,{index:0,class:"border-border-input bg-background hover:border-dark-40 focus-visible:ring-foreground dark:bg-foreground dark:shadow-card focus-visible:outline-hidden block size-[25px] cursor-pointer rounded-full border shadow-sm transition-colors focus-visible:ring-2 focus-visible:ring-offset-2 active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50"})}),Z(ut,dr)},$$slots:{default:!0}})});var Ar=ve(yr,2);RE(Ar),we(vt),DE(Ar,()=>$().color,br=>$($().color=br,!0)),Z(Et,vt)};let n=ae(e,"one",15),s=ae(e,"maxTravelTime",15),l=ae(e,"time",15),c=ae(e,"useRoutedTransfers",15),a=ae(e,"pedestrianProfile",15),g=ae(e,"requireBikeTransport",15),v=ae(e,"requireCarTransport",15),w=ae(e,"transitModes",15),P=ae(e,"maxTransfers",15),I=ae(e,"preTransitModes",15),k=ae(e,"postTransitModes",15),N=ae(e,"maxPreTransitTime",15),D=ae(e,"maxPostTransitTime",15),B=ae(e,"arriveBy",15),U=ae(e,"elevationCosts",15),V=ae(e,"ignorePreTransitRentalReturnConstraints",15),L=ae(e,"ignorePostTransitRentalReturnConstraints",15),$=ae(e,"options",15),te=ae(e,"preTransitProviderGroups",15),G=ae(e,"postTransitProviderGroups",15),le=ae(e,"directProviderGroups",15);const se=Et=>Et*60,oe=me(()=>V_(se(Math.min(e.serverConfig?.maxOneToAllTravelTimeLimit??240,360))).map(Et=>({value:Et.toString(),label:Bs(Et)}))),be=new Map([["OVERLAY_RECTS",yt.isochrones.canvasRects],["OVERLAY_CIRCLES",yt.isochrones.canvasCircles],["GEOMETRY_CIRCLES",yt.isochrones.geojsonCircles]]),xe=[...[...be.entries()].map(([Et,vt])=>({value:Et,label:vt}))];let _e=wt(tn([])),Ne=B()?"arrival":"departure";const fe=()=>{navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(tt,Et=>console.log(Et),{enableHighAccuracy:!0})},Le=Et=>{if(Et!=Ne){const vt=I();I(k()),k(vt);const Pr=N();N(D()),D(Pr);const yr=te();te(G()),G(yr),Ne=Et}},tt=Et=>{n(Ri({lat:Et.coords.latitude,lon:Et.coords.longitude},0))};var Ye=eQ(),rt=Ae(Ye);Hp(rt,{get place(){return e.geocodingBiasPlace},name:"one",get placeholder(){return yt.position},get selected(){return n()},set selected(Et){n(Et)},get items(){return S(_e)},set items(Et){pe(_e,Et,!0)}});var it=ve(rt,2);An(it,{variant:"ghost",class:"absolute z-10 right-4 top-0",size:"icon",onclick:()=>fe(),children:(Et,vt)=>{x0(Et,{class:"w-5 h-5"})},$$slots:{default:!0}});var Ct=ve(it,2),Mt=Ae(Ct);j_(Mt,{get value(){return l()},set value(Et){l(Et)}});var jt=ve(Mt,2),Gt=()=>B()?"arrival":"departure",Or=Et=>B(Et==="arrival");ar(jt,()=>Q0,(Et,vt)=>{vt(Et,{class:"flex",get value(){return Gt()},set value(Pr){Or(Pr)},onValueChange:Le,children:(Pr,yr)=>{var Ar=JK(),br=ue(Ar);$p(br,{for:"isochrones-departure",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(ut,Zt)=>{var dr=KK(),er=ue(dr);ar(er,()=>jp,(Tr,fr)=>{fr(Tr,{value:"departure",id:"isochrones-departure",class:"sr-only",get"aria-label"(){return yt.departure}})});var Bt=ve(er,2),mr=Ae(Bt,!0);we(Bt),mt(()=>pt(mr,yt.departure)),Z(ut,dr)},$$slots:{default:!0}});var lr=ve(br,2);$p(lr,{for:"isochrones-arrival",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(ut,Zt)=>{var dr=QK(),er=ue(dr);ar(er,()=>jp,(Tr,fr)=>{fr(Tr,{value:"arrival",id:"isochrones-arrival",class:"sr-only",get"aria-label"(){return yt.arrival}})});var Bt=ve(er,2),mr=Ae(Bt,!0);we(Bt),mt(()=>pt(mr,yt.arrival)),Z(ut,dr)},$$slots:{default:!0}}),Z(Pr,Ar)},$$slots:{default:!0}})});var _r=ve(jt,2),wr=()=>a()==="WHEELCHAIR",Dr=Et=>a(Et?"WHEELCHAIR":"FOOT");nI(_r,{get serverConfig(){return e.serverConfig},get wheelchair(){return wr()},set wheelchair(Et){Dr(Et)},get possibleMaxTravelTimes(){return S(oe)},directModes:void 0,maxDirectTime:void 0,ignoreDirectRentalReturnConstraints:void 0,get additionalComponents(){return t},via:void 0,viaMinimumStay:void 0,viaLabels:{},get useRoutedTransfers(){return c()},set useRoutedTransfers(Et){c(Et)},get requireCarTransport(){return v()},set requireCarTransport(Et){v(Et)},get requireBikeTransport(){return g()},set requireBikeTransport(Et){g(Et)},get transitModes(){return w()},set transitModes(Et){w(Et)},get maxTransfers(){return P()},set maxTransfers(Et){P(Et)},get maxTravelTime(){return s()},set maxTravelTime(Et){s(Et)},get preTransitModes(){return I()},set preTransitModes(Et){I(Et)},get postTransitModes(){return k()},set postTransitModes(Et){k(Et)},get maxPreTransitTime(){return N()},set maxPreTransitTime(Et){N(Et)},get maxPostTransitTime(){return D()},set maxPostTransitTime(Et){D(Et)},get elevationCosts(){return U()},set elevationCosts(Et){U(Et)},get ignorePreTransitRentalReturnConstraints(){return V()},set ignorePreTransitRentalReturnConstraints(Et){V(Et)},get ignorePostTransitRentalReturnConstraints(){return L()},set ignorePostTransitRentalReturnConstraints(Et){L(Et)},get preTransitProviderGroups(){return te()},set preTransitProviderGroups(Et){te(Et)},get postTransitProviderGroups(){return G()},set postTransitProviderGroups(Et){G(Et)},get directProviderGroups(){return le()},set directProviderGroups(Et){le(Et)}}),we(Ct),we(Ye),Z(r,Ye),St()}function PR(r,e,t=0,n=r.length-1,s=rQ){for(;n>t;){if(n-t>600){const g=n-t+1,v=e-t+1,w=Math.log(g),P=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*P*(g-P)/g)*(v-g/2<0?-1:1),k=Math.max(t,Math.floor(e-v*P/g+I)),N=Math.min(n,Math.floor(e+(g-v)*P/g+I));PR(r,e,k,N,s)}const l=r[e];let c=t,a=n;for(ap(r,t,e),s(r[n],l)>0&&ap(r,t,n);c<a;){for(ap(r,c,a),c++,a--;s(r[c],l)<0;)c++;for(;s(r[a],l)>0;)a--}s(r[t],l)===0?ap(r,t,a):(a++,ap(r,a,n)),a<=e&&(t=a+1),e<=a&&(n=a-1)}}function ap(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function rQ(r,e){return r<e?-1:r>e?1:0}class nQ{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!o_(e,t))return n;const s=this.toBBox,l=[];for(;t;){for(let c=0;c<t.children.length;c++){const a=t.children[c],g=t.leaf?s(a):a;o_(e,g)&&(t.leaf?n.push(a):Kb(e,g)?this._all(a,n):l.push(a))}t=l.pop()}return n}collides(e){let t=this.data;if(!o_(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const l=t.children[s],c=t.leaf?this.toBBox(l):l;if(o_(e,c)){if(t.leaf||Kb(e,c))return!0;n.push(l)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Gh([]),this}remove(e,t){if(!e)return this;let n=this.data;const s=this.toBBox(e),l=[],c=[];let a,g,v;for(;n||l.length;){if(n||(n=l.pop(),g=l[l.length-1],a=c.pop(),v=!0),n.leaf){const w=iQ(e,n.children,t);if(w!==-1)return n.children.splice(w,1),l.push(n),this._condense(l),this}!v&&!n.leaf&&Kb(n,s)?(l.push(n),c.push(a),a=0,g=n,n=n.children[0]):g?(a++,n=g.children[a],v=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const l=n-t+1;let c=this._maxEntries,a;if(l<=c)return a=Gh(e.slice(t,n+1)),Hh(a,this.toBBox),a;s||(s=Math.ceil(Math.log(l)/Math.log(c)),c=Math.ceil(l/Math.pow(c,s-1))),a=Gh([]),a.leaf=!1,a.height=s;const g=Math.ceil(l/c),v=g*Math.ceil(Math.sqrt(c));sE(e,t,n,v,this.compareMinX);for(let w=t;w<=n;w+=v){const P=Math.min(w+v-1,n);sE(e,w,P,g,this.compareMinY);for(let I=w;I<=P;I+=g){const k=Math.min(I+g-1,P);a.children.push(this._build(e,I,k,s-1))}}return Hh(a,this.toBBox),a}_chooseSubtree(e,t,n,s){for(;s.push(t),!(t.leaf||s.length-1===n);){let l=1/0,c=1/0,a;for(let g=0;g<t.children.length;g++){const v=t.children[g],w=Yb(v),P=aQ(e,v)-w;P<c?(c=P,l=w<l?w:l,a=v):P===c&&w<l&&(l=w,a=v)}t=a||t.children[0]}return t}_insert(e,t,n){const s=n?e:this.toBBox(e),l=[],c=this._chooseSubtree(s,this.data,t,l);for(c.children.push(e),yp(c,s);t>=0&&l[t].children.length>this._maxEntries;)this._split(l,t),t--;this._adjustParentBBoxes(s,l,t)}_split(e,t){const n=e[t],s=n.children.length,l=this._minEntries;this._chooseSplitAxis(n,l,s);const c=this._chooseSplitIndex(n,l,s),a=Gh(n.children.splice(c,n.children.length-c));a.height=n.height,a.leaf=n.leaf,Hh(n,this.toBBox),Hh(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this.data=Gh([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Hh(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let s,l=1/0,c=1/0;for(let a=t;a<=n-t;a++){const g=_p(e,0,a,this.toBBox),v=_p(e,a,n,this.toBBox),w=lQ(g,v),P=Yb(g)+Yb(v);w<l?(l=w,s=a,c=P<c?P:c):w===l&&P<c&&(c=P,s=a)}return s||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:sQ,l=e.leaf?this.compareMinY:oQ,c=this._allDistMargin(e,t,n,s),a=this._allDistMargin(e,t,n,l);c<a&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const l=this.toBBox,c=_p(e,0,t,l),a=_p(e,n-t,n,l);let g=s_(c)+s_(a);for(let v=t;v<n-t;v++){const w=e.children[v];yp(c,e.leaf?l(w):w),g+=s_(c)}for(let v=n-t-1;v>=t;v--){const w=e.children[v];yp(a,e.leaf?l(w):w),g+=s_(a)}return g}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)yp(t[s],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():Hh(e[t],this.toBBox)}}function iQ(r,e,t){if(!t)return e.indexOf(r);for(let n=0;n<e.length;n++)if(t(r,e[n]))return n;return-1}function Hh(r,e){_p(r,0,r.children.length,e,r)}function _p(r,e,t,n,s){s||(s=Gh(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let l=e;l<t;l++){const c=r.children[l];yp(s,r.leaf?n(c):c)}return s}function yp(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function sQ(r,e){return r.minX-e.minX}function oQ(r,e){return r.minY-e.minY}function Yb(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function s_(r){return r.maxX-r.minX+(r.maxY-r.minY)}function aQ(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function lQ(r,e){const t=Math.max(r.minX,e.minX),n=Math.max(r.minY,e.minY),s=Math.min(r.maxX,e.maxX),l=Math.min(r.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,l-n)}function Kb(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function o_(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function Gh(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function sE(r,e,t,n,s){const l=[e,t];for(;l.length;){if(t=l.pop(),e=l.pop(),t-e<=n)continue;const c=e+Math.ceil((t-e)/n/2)*n;PR(r,c,e,t,s),l.push(e,c,c,t)}}const il=11102230246251565e-32,xs=134217729,cQ=(3+8*il)*il;function Qb(r,e,t,n,s){let l,c,a,g,v=e[0],w=n[0],P=0,I=0;w>v==w>-v?(l=v,v=e[++P]):(l=w,w=n[++I]);let k=0;if(P<r&&I<t)for(w>v==w>-v?(c=v+l,a=l-(c-v),v=e[++P]):(c=w+l,a=l-(c-w),w=n[++I]),l=c,a!==0&&(s[k++]=a);P<r&&I<t;)w>v==w>-v?(c=l+v,g=c-l,a=l-(c-g)+(v-g),v=e[++P]):(c=l+w,g=c-l,a=l-(c-g)+(w-g),w=n[++I]),l=c,a!==0&&(s[k++]=a);for(;P<r;)c=l+v,g=c-l,a=l-(c-g)+(v-g),v=e[++P],l=c,a!==0&&(s[k++]=a);for(;I<t;)c=l+w,g=c-l,a=l-(c-g)+(w-g),w=n[++I],l=c,a!==0&&(s[k++]=a);return(l!==0||k===0)&&(s[k++]=l),k}function uQ(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function pg(r){return new Float64Array(r)}const hQ=(3+16*il)*il,dQ=(2+12*il)*il,fQ=(9+64*il)*il*il,Zh=pg(4),oE=pg(8),aE=pg(12),lE=pg(16),Is=pg(4);function pQ(r,e,t,n,s,l,c){let a,g,v,w,P,I,k,N,D,B,U,V,L,$,te,G,le,se;const oe=r-s,be=t-s,xe=e-l,_e=n-l;$=oe*_e,I=xs*oe,k=I-(I-oe),N=oe-k,I=xs*_e,D=I-(I-_e),B=_e-D,te=N*B-($-k*D-N*D-k*B),G=xe*be,I=xs*xe,k=I-(I-xe),N=xe-k,I=xs*be,D=I-(I-be),B=be-D,le=N*B-(G-k*D-N*D-k*B),U=te-le,P=te-U,Zh[0]=te-(U+P)+(P-le),V=$+U,P=V-$,L=$-(V-P)+(U-P),U=L-G,P=L-U,Zh[1]=L-(U+P)+(P-G),se=V+U,P=se-V,Zh[2]=V-(se-P)+(U-P),Zh[3]=se;let Ne=uQ(4,Zh),fe=dQ*c;if(Ne>=fe||-Ne>=fe||(P=r-oe,a=r-(oe+P)+(P-s),P=t-be,v=t-(be+P)+(P-s),P=e-xe,g=e-(xe+P)+(P-l),P=n-_e,w=n-(_e+P)+(P-l),a===0&&g===0&&v===0&&w===0)||(fe=fQ*c+cQ*Math.abs(Ne),Ne+=oe*w+_e*a-(xe*v+be*g),Ne>=fe||-Ne>=fe))return Ne;$=a*_e,I=xs*a,k=I-(I-a),N=a-k,I=xs*_e,D=I-(I-_e),B=_e-D,te=N*B-($-k*D-N*D-k*B),G=g*be,I=xs*g,k=I-(I-g),N=g-k,I=xs*be,D=I-(I-be),B=be-D,le=N*B-(G-k*D-N*D-k*B),U=te-le,P=te-U,Is[0]=te-(U+P)+(P-le),V=$+U,P=V-$,L=$-(V-P)+(U-P),U=L-G,P=L-U,Is[1]=L-(U+P)+(P-G),se=V+U,P=se-V,Is[2]=V-(se-P)+(U-P),Is[3]=se;const Le=Qb(4,Zh,4,Is,oE);$=oe*w,I=xs*oe,k=I-(I-oe),N=oe-k,I=xs*w,D=I-(I-w),B=w-D,te=N*B-($-k*D-N*D-k*B),G=xe*v,I=xs*xe,k=I-(I-xe),N=xe-k,I=xs*v,D=I-(I-v),B=v-D,le=N*B-(G-k*D-N*D-k*B),U=te-le,P=te-U,Is[0]=te-(U+P)+(P-le),V=$+U,P=V-$,L=$-(V-P)+(U-P),U=L-G,P=L-U,Is[1]=L-(U+P)+(P-G),se=V+U,P=se-V,Is[2]=V-(se-P)+(U-P),Is[3]=se;const tt=Qb(Le,oE,4,Is,aE);$=a*w,I=xs*a,k=I-(I-a),N=a-k,I=xs*w,D=I-(I-w),B=w-D,te=N*B-($-k*D-N*D-k*B),G=g*v,I=xs*g,k=I-(I-g),N=g-k,I=xs*v,D=I-(I-v),B=v-D,le=N*B-(G-k*D-N*D-k*B),U=te-le,P=te-U,Is[0]=te-(U+P)+(P-le),V=$+U,P=V-$,L=$-(V-P)+(U-P),U=L-G,P=L-U,Is[1]=L-(U+P)+(P-G),se=V+U,P=se-V,Is[2]=V-(se-P)+(U-P),Is[3]=se;const Ye=Qb(tt,aE,4,Is,lE);return lE[Ye-1]}function gQ(r,e,t,n,s,l){const c=(e-l)*(t-s),a=(r-s)*(n-l),g=c-a,v=Math.abs(c+a);return Math.abs(g)>=hQ*v?g:-pQ(r,e,t,n,s,l,v)}function mQ(r,e){var t,n,s=0,l,c,a,g,v,w,P,I=r[0],k=r[1],N=e.length;for(t=0;t<N;t++){n=0;var D=e[t],B=D.length-1;if(w=D[0],w[0]!==D[B][0]&&w[1]!==D[B][1])throw new Error("First and last coordinates in a ring must be the same");for(c=w[0]-I,a=w[1]-k,n;n<B;n++){if(P=D[n+1],g=P[0]-I,v=P[1]-k,a===0&&v===0){if(g<=0&&c>=0||c<=0&&g>=0)return 0}else if(v>=0&&a<=0||v<=0&&a>=0){if(l=gQ(c,g,a,v,0,0),l===0)return 0;(l>0&&v>0&&a<=0||l<0&&v<=0&&a>0)&&s++}w=P,a=v,c=g}}return s%2!==0}function _Q(r,e,t={}){if(!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");const n=qc(r),s=kK(e),l=s.type,c=e.bbox;let a=s.coordinates;if(c&&yQ(n,c)===!1)return!1;l==="Polygon"&&(a=[a]);let g=!1;for(var v=0;v<a.length;++v){const w=mQ(n,a[v]);if(w===0)return!t.ignoreBoundary;w&&(g=!0)}return g}function yQ(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}var vQ=Fe("<div> </div>"),bQ=Fe('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),xQ=Fe('<span class="inline-flex h-4 w-4 items-center justify-center text-muted-foreground" role="img"><!></span>'),wQ=Fe('<span class="inline-flex h-4 w-4 items-center justify-center text-muted-foreground" role="img"><!></span>'),TQ=Fe('<tr class="border-b border-border last:border-0"><td class="w-8 pr-2 align-middle"> </td><td class="w-6 pr-2 align-middle"><svg class="h-4 w-4 fill-current" aria-hidden="true" focusable="false"><title> </title><use></use></svg></td><td class="w-6 pr-2 align-middle"><!></td><td class="truncate align-middle max-w-64"> </td><td class="w-8 pl-2 align-middle text-right"><!></td></tr>'),SQ=Fe('<table class="w-full text-xs"><tbody></tbody></table>'),AQ=Fe('<div class="pt-2 border-t border-border text-xs text-muted-foreground space-y-1 max-h-96 max-w-96 overflow-auto pr-2 relative"><!> <pre class="whitespace-pre-wrap pr-8"> </pre></div>'),EQ=Fe('<div class="space-y-3 text-sm leading-tight text-foreground max-w-96 w-fit"><div class="space-y-1"><div class="font-semibold"> </div> <!> <div> <!></div></div> <!> <!> <!></div>');function PQ(r,e){Tt(e,!0);let t=ae(e,"showActions",3,!1),n=ae(e,"debug",3,!1),s=me(()=>({station:e.station,provider:{...e.provider,vehicleTypes:e.provider.vehicleTypes.filter(se=>Object.hasOwn(e.station.vehicleTypesAvailable,se.id)||Object.hasOwn(e.station.vehicleDocksAvailable,se.id)),totalVehicleTypes:e.provider.vehicleTypes.length}}));async function l(){await navigator.clipboard.writeText(JSON.stringify(S(s),null,2))}const c=me(()=>Object.entries(e.station.vehicleTypesAvailable).map(([se,oe])=>{const be=e.provider.vehicleTypes.find(_e=>_e.id===se),xe=be.name||$o[be.formFactor].label;return{id:se,available:oe,formFactor:be.formFactor,name:xe,propulsionIcon:eI[be.propulsionType],returnIcon:tI[be.returnConstraint]}}).sort((se,oe)=>oe.available!==se.available?oe.available-se.available:se.name.localeCompare(oe.name)));var a=EQ(),g=Ae(a),v=Ae(g),w=Ae(v,!0);we(v);var P=ve(v,2);{var I=se=>{var oe=vQ(),be=Ae(oe,!0);we(oe),mt(()=>pt(be,e.station.address)),Z(se,oe)};Ze(P,se=>{e.station.address&&se(I)})}var k=ve(P,2),N=Ae(k),D=ve(N);{var B=se=>{var oe=bQ(),be=Ae(oe,!0);we(oe),mt(()=>{Fn(oe,"href",e.provider.url),pt(be,e.provider.name)}),Z(se,oe)},U=se=>{var oe=Br();mt(()=>pt(oe,e.provider.name)),Z(se,oe)};Ze(D,se=>{e.provider.url?se(B):se(U,!1)})}we(k),we(g);var V=ve(g,2);{var L=se=>{var oe=SQ(),be=Ae(oe);xn(be,21,()=>S(c),xe=>xe.id,(xe,_e)=>{var Ne=TQ(),fe=Ae(Ne),Le=Ae(fe);we(fe);var tt=ve(fe),Ye=Ae(tt),rt=Ae(Ye),it=Ae(rt,!0);we(rt);var Ct=ve(rt);we(Ye),we(tt);var Mt=ve(tt),jt=Ae(Mt);{var Gt=vt=>{const Pr=me(()=>S(_e).propulsionIcon.component);var yr=xQ(),Ar=Ae(yr);ar(Ar,()=>S(Pr),(br,lr)=>{lr(br,{class:"h-4 w-4","aria-hidden":"true"})}),we(yr),mt(()=>{Fn(yr,"title",S(_e).propulsionIcon.title),Fn(yr,"aria-label",S(_e).propulsionIcon.title)}),Z(vt,yr)};Ze(jt,vt=>{S(_e).propulsionIcon&&vt(Gt)})}we(Mt);var Or=ve(Mt),_r=Ae(Or,!0);we(Or);var wr=ve(Or),Dr=Ae(wr);{var Et=vt=>{const Pr=me(()=>S(_e).returnIcon.component);var yr=wQ(),Ar=Ae(yr);ar(Ar,()=>S(Pr),(br,lr)=>{lr(br,{class:"h-4 w-4","aria-hidden":"true"})}),we(yr),mt(()=>{Fn(yr,"title",S(_e).returnIcon.title),Fn(yr,"aria-label",S(_e).returnIcon.title)}),Z(vt,yr)};Ze(Dr,vt=>{S(_e).returnIcon&&vt(Et)})}we(wr),we(Ne),mt(()=>{pt(Le,`${S(_e).available??""}x`),pt(it,$o[S(_e).formFactor].label),Fn(Ct,"href",`#${$o[S(_e).formFactor].svg}`),Fn(Or,"title",S(_e).name),Fn(Or,"aria-label",S(_e).name),pt(_r,S(_e).name)}),Z(xe,Ne)}),we(be),we(oe),Z(se,oe)};Ze(V,se=>{S(c).length&&se(L)})}var $=ve(V,2);{var te=se=>{An(se,{class:"font-bold",variant:"outline",get href(){return e.station.rentalUriWeb},target:"_blank",children:(oe,be)=>{Yr();var xe=Br();mt(()=>pt(xe,yt.rent)),Z(oe,xe)},$$slots:{default:!0}})};Ze($,se=>{t()&&e.station.rentalUriWeb&&se(te)})}var G=ve($,2);{var le=se=>{var oe=AQ(),be=Ae(oe);An(be,{class:"absolute top-2 right-2 z-10",variant:"ghost",size:"icon",onclick:l,type:"button",get title(){return yt.copyToClipboard},get"aria-label"(){return yt.copyToClipboard},children:(Ne,fe)=>{b0(Ne,{})},$$slots:{default:!0}});var xe=ve(be,2),_e=Ae(xe,!0);we(xe),we(oe),mt(Ne=>pt(_e,Ne),[()=>JSON.stringify(S(s),null,2)]),Z(se,oe)};Ze(G,se=>{n()&&se(le)})}we(a),mt(()=>{pt(w,e.station.name),pt(N,`${yt.sharingProvider??""}: `)}),Z(r,a),St()}var IQ=Fe('<span class="inline-flex h-4 w-4 items-center justify-center text-muted-foreground" role="img"><!></span>'),CQ=Fe('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),RQ=Fe('<div class="flex gap-2"><span class="inline-flex h-4 w-4 items-center justify-center text-muted-foreground flex-none" role="img"><!></span> <span> </span></div>'),MQ=Fe('<div class="pt-2 border-t border-border text-xs text-muted-foreground space-y-1 max-h-96 max-w-96 overflow-auto pr-2 relative"><!> <pre class="whitespace-pre-wrap pr-8"> </pre></div>'),kQ=Fe('<div class="space-y-3 text-sm leading-tight text-foreground max-w-80"><div class="flex gap-2"><svg class="h-4 w-4 fill-current flex-none" aria-hidden="true" focusable="false"><title> </title><use></use></svg> <!> <span> </span></div> <div> <!></div> <!> <!> <!></div>');function DQ(r,e){Tt(e,!0);let t=ae(e,"showActions",3,!1),n=ae(e,"debug",3,!1),s=me(()=>e.provider.vehicleTypes.find(fe=>fe.id==e.vehicle.typeId)),l=me(()=>eI[e.vehicle.propulsionType]),c=me(()=>tI[e.vehicle.returnConstraint]),a=me(()=>({vehicle:e.vehicle,provider:{...e.provider,vehicleTypes:e.provider.vehicleTypes.filter(fe=>fe.id==e.vehicle.typeId),totalVehicleTypes:e.provider.vehicleTypes.length}}));async function g(){await navigator.clipboard.writeText(JSON.stringify(S(a),null,2))}var v=kQ(),w=Ae(v),P=Ae(w),I=Ae(P),k=Ae(I,!0);we(I);var N=ve(I);we(P);var D=ve(P,2);{var B=fe=>{var Le=IQ(),tt=Ae(Le);ar(tt,()=>S(l).component,(Ye,rt)=>{rt(Ye,{class:"h-4 w-4","aria-hidden":"true"})}),we(Le),mt(()=>{Fn(Le,"title",S(l).title),Fn(Le,"aria-label",S(l).title)}),Z(fe,Le)};Ze(D,fe=>{S(l)&&fe(B)})}var U=ve(D,2),V=Ae(U,!0);we(U),we(w);var L=ve(w,2),$=Ae(L),te=ve($);{var G=fe=>{var Le=CQ(),tt=Ae(Le,!0);we(Le),mt(()=>{Fn(Le,"href",e.provider.url),pt(tt,e.provider.name)}),Z(fe,Le)},le=fe=>{var Le=Br();mt(()=>pt(Le,e.provider.name)),Z(fe,Le)};Ze(te,fe=>{e.provider.url?fe(G):fe(le,!1)})}we(L);var se=ve(L,2);{var oe=fe=>{var Le=RQ(),tt=Ae(Le),Ye=Ae(tt);ar(Ye,()=>S(c).component,(Ct,Mt)=>{Mt(Ct,{class:"h-4 w-4","aria-hidden":"true"})}),we(tt);var rt=ve(tt,2),it=Ae(rt,!0);we(rt),we(Le),mt(()=>{Fn(tt,"title",S(c).title),Fn(tt,"aria-label",S(c).title),pt(it,S(c).title)}),Z(fe,Le)};Ze(se,fe=>{S(c)&&fe(oe)})}var be=ve(se,2);{var xe=fe=>{An(fe,{class:"font-bold",variant:"outline",get href(){return e.vehicle.rentalUriWeb},target:"_blank",children:(Le,tt)=>{Yr();var Ye=Br();mt(()=>pt(Ye,yt.rent)),Z(Le,Ye)},$$slots:{default:!0}})};Ze(be,fe=>{t()&&e.vehicle.rentalUriWeb&&fe(xe)})}var _e=ve(be,2);{var Ne=fe=>{var Le=MQ(),tt=Ae(Le);An(tt,{class:"absolute top-2 right-2 z-10",variant:"ghost",size:"icon",onclick:g,type:"button",get title(){return yt.copyToClipboard},get"aria-label"(){return yt.copyToClipboard},children:(it,Ct)=>{b0(it,{})},$$slots:{default:!0}});var Ye=ve(tt,2),rt=Ae(Ye,!0);we(Ye),we(Le),mt(it=>pt(rt,it),[()=>JSON.stringify(S(a),null,2)]),Z(fe,Le)};Ze(_e,fe=>{n()&&fe(Ne)})}we(v),mt(()=>{pt(k,$o[e.vehicle.formFactor].label),Fn(N,"href",`#${$o[e.vehicle.formFactor].svg}`),pt(V,S(s)?.name||$o[e.vehicle.formFactor].label),pt($,`${yt.sharingProvider??""}: `)}),Z(r,v),St()}var OQ=Fe('<div class="font-semibold"> </div>'),FQ=Fe('<div class="font-semibold"> </div>'),NQ=Fe('<div class="font-semibold"> </div>'),LQ=Fe('<div class="font-semibold"> </div>'),BQ=Fe('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),zQ=Fe("<div> </div>"),UQ=Fe('<div class="pt-2 border-t border-border text-xs text-muted-foreground space-y-1 max-h-96 max-w-96 overflow-auto pr-2 relative"><!> <pre class="whitespace-pre-wrap pr-8"> </pre></div>'),VQ=Fe('<div class="space-y-3 text-sm leading-tight text-foreground"><div class="space-y-1"><!> <div> <!></div></div> <div class="space-y-1"><div> </div> <!></div> <!></div>');function jQ(r,e){Tt(e,!0);let t=ae(e,"allZonesAtPoint",19,()=>[]),n=ae(e,"zoneData",19,()=>[]),s=ae(e,"stationData",19,()=>[]),l=ae(e,"debug",3,!1),c=me(()=>({...e.zone?{zone:{...e.zone,area:"..."}}:{},...e.station?{station:{...e.station,stationArea:"..."}}:{},provider:e.provider,allZonesAtPoint:t().map(oe=>({z:oe.properties.z,zoneIndex:oe.properties.zoneIndex,stationIndex:oe.properties.stationIndex,rideThroughAllowed:oe.properties.rideThroughAllowed,rideEndAllowed:oe.properties.rideEndAllowed,stationArea:oe.properties.stationArea,zone:(()=>{if(oe.properties.zoneIndex===void 0)return null;const be=n()[oe.properties.zoneIndex];return be?{...be,area:"..."}:null})(),station:(()=>{if(oe.properties.stationIndex===void 0)return null;const be=s()[oe.properties.stationIndex];return be?{...be,stationArea:"..."}:null})()}))}));async function a(){await navigator.clipboard.writeText(JSON.stringify(S(c),null,2))}var g=VQ(),v=Ae(g),w=Ae(v);{var P=oe=>{var be=We(),xe=ue(be);{var _e=fe=>{var Le=OQ(),tt=Ae(Le);we(Le),mt(()=>pt(tt,`${yt.rentalGeofencingZone??""}: ${e.zone.name??""}`)),Z(fe,Le)},Ne=fe=>{var Le=FQ(),tt=Ae(Le,!0);we(Le),mt(()=>pt(tt,yt.rentalGeofencingZone)),Z(fe,Le)};Ze(xe,fe=>{e.zone.name?fe(_e):fe(Ne,!1)})}Z(oe,be)},I=oe=>{var be=We(),xe=ue(be);{var _e=Ne=>{var fe=We(),Le=ue(fe);{var tt=rt=>{var it=NQ(),Ct=Ae(it);we(it),mt(()=>pt(Ct,`${yt.rentalStation??""}: ${e.station.name??""}`)),Z(rt,it)},Ye=rt=>{var it=LQ(),Ct=Ae(it,!0);we(it),mt(()=>pt(Ct,yt.rentalStation)),Z(rt,it)};Ze(Le,rt=>{e.station.name?rt(tt):rt(Ye,!1)})}Z(Ne,fe)};Ze(xe,Ne=>{e.station&&Ne(_e)},!0)}Z(oe,be)};Ze(w,oe=>{e.zone?oe(P):oe(I,!1)})}var k=ve(w,2),N=Ae(k),D=ve(N);{var B=oe=>{var be=BQ(),xe=Ae(be,!0);we(be),mt(()=>{Fn(be,"href",e.provider.url),pt(xe,e.provider.name)}),Z(oe,be)},U=oe=>{var be=Br();mt(()=>pt(be,e.provider.name)),Z(oe,be)};Ze(D,oe=>{e.provider.url?oe(B):oe(U,!1)})}we(k),we(v);var V=ve(v,2),L=Ae(V),$=Ae(L,!0);we(L);var te=ve(L,2);{var G=oe=>{var be=zQ(),xe=Ae(be,!0);we(be),mt(()=>pt(xe,e.rideEndAllowed?yt.rideEndAllowed:yt.rideEndNotAllowed)),Z(oe,be)};Ze(te,oe=>{e.rideThroughAllowed&&oe(G)})}we(V);var le=ve(V,2);{var se=oe=>{var be=UQ(),xe=Ae(be);An(xe,{class:"absolute top-2 right-2 z-10",variant:"ghost",size:"icon",onclick:a,type:"button",get title(){return yt.copyToClipboard},get"aria-label"(){return yt.copyToClipboard},children:(fe,Le)=>{b0(fe,{})},$$slots:{default:!0}});var _e=ve(xe,2),Ne=Ae(_e,!0);we(_e),we(be),mt(fe=>pt(Ne,fe),[()=>JSON.stringify(S(c),null,2)]),Z(oe,be)};Ze(le,oe=>{l()&&oe(se)})}we(g),mt(()=>{pt(N,`${yt.sharingProvider??""}: `),pt($,e.rideThroughAllowed?yt.rideThroughAllowed:yt.rideThroughNotAllowed)}),Z(r,g),St()}function WQ(r,e,t=2){const n=e&&e.length,s=n?e[0]*t:r.length;let l=IR(r,0,s,t,!0);const c=[];if(!l||l.next===l.prev)return c;let a,g,v;if(n&&(l=qQ(r,e,l,t)),r.length>80*t){a=r[0],g=r[1];let w=a,P=g;for(let I=t;I<s;I+=t){const k=r[I],N=r[I+1];k<a&&(a=k),N<g&&(g=N),k>w&&(w=k),N>P&&(P=N)}v=Math.max(w-a,P-g),v=v!==0?32767/v:0}return ig(l,c,t,a,g,v,0),c}function IR(r,e,t,n,s){let l;if(s===sJ(r,e,t,n)>0)for(let c=e;c<t;c+=n)l=cE(c/n|0,r[c],r[c+1],l);else for(let c=t-n;c>=e;c-=n)l=cE(c/n|0,r[c],r[c+1],l);return l&&wd(l,l.next)&&(og(l),l=l.next),l}function _u(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(wd(t,t.next)||yi(t.prev,t,t.next)===0)){if(og(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function ig(r,e,t,n,s,l,c){if(!r)return;!c&&l&&JQ(r,n,s,l);let a=r;for(;r.prev!==r.next;){const g=r.prev,v=r.next;if(l?HQ(r,n,s,l):$Q(r)){e.push(g.i,r.i,v.i),og(r),r=v.next,a=v.next;continue}if(r=v,r===a){c?c===1?(r=ZQ(_u(r),e),ig(r,e,t,n,s,l,2)):c===2&&XQ(r,e,t,n,s,l):ig(_u(r),e,t,n,s,l,1);break}}}function $Q(r){const e=r.prev,t=r,n=r.next;if(yi(e,t,n)>=0)return!1;const s=e.x,l=t.x,c=n.x,a=e.y,g=t.y,v=n.y,w=Math.min(s,l,c),P=Math.min(a,g,v),I=Math.max(s,l,c),k=Math.max(a,g,v);let N=n.next;for(;N!==e;){if(N.x>=w&&N.x<=I&&N.y>=P&&N.y<=k&&vp(s,a,l,g,c,v,N.x,N.y)&&yi(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function HQ(r,e,t,n){const s=r.prev,l=r,c=r.next;if(yi(s,l,c)>=0)return!1;const a=s.x,g=l.x,v=c.x,w=s.y,P=l.y,I=c.y,k=Math.min(a,g,v),N=Math.min(w,P,I),D=Math.max(a,g,v),B=Math.max(w,P,I),U=o0(k,N,e,t,n),V=o0(D,B,e,t,n);let L=r.prevZ,$=r.nextZ;for(;L&&L.z>=U&&$&&$.z<=V;){if(L.x>=k&&L.x<=D&&L.y>=N&&L.y<=B&&L!==s&&L!==c&&vp(a,w,g,P,v,I,L.x,L.y)&&yi(L.prev,L,L.next)>=0||(L=L.prevZ,$.x>=k&&$.x<=D&&$.y>=N&&$.y<=B&&$!==s&&$!==c&&vp(a,w,g,P,v,I,$.x,$.y)&&yi($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;L&&L.z>=U;){if(L.x>=k&&L.x<=D&&L.y>=N&&L.y<=B&&L!==s&&L!==c&&vp(a,w,g,P,v,I,L.x,L.y)&&yi(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;$&&$.z<=V;){if($.x>=k&&$.x<=D&&$.y>=N&&$.y<=B&&$!==s&&$!==c&&vp(a,w,g,P,v,I,$.x,$.y)&&yi($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function ZQ(r,e){let t=r;do{const n=t.prev,s=t.next.next;!wd(n,s)&&RR(n,t,t.next,s)&&sg(n,s)&&sg(s,n)&&(e.push(n.i,t.i,s.i),og(t),og(t.next),t=r=s),t=t.next}while(t!==r);return _u(t)}function XQ(r,e,t,n,s,l){let c=r;do{let a=c.next.next;for(;a!==c.prev;){if(c.i!==a.i&&rJ(c,a)){let g=MR(c,a);c=_u(c,c.next),g=_u(g,g.next),ig(c,e,t,n,s,l,0),ig(g,e,t,n,s,l,0);return}a=a.next}c=c.next}while(c!==r)}function qQ(r,e,t,n){const s=[];for(let l=0,c=e.length;l<c;l++){const a=e[l]*n,g=l<c-1?e[l+1]*n:r.length,v=IR(r,a,g,n,!1);v===v.next&&(v.steiner=!0),s.push(tJ(v))}s.sort(GQ);for(let l=0;l<s.length;l++)t=YQ(s[l],t);return t}function GQ(r,e){let t=r.x-e.x;if(t===0&&(t=r.y-e.y,t===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),s=(e.next.y-e.y)/(e.next.x-e.x);t=n-s}return t}function YQ(r,e){const t=KQ(r,e);if(!t)return e;const n=MR(t,r);return _u(n,n.next),_u(t,t.next)}function KQ(r,e){let t=e;const n=r.x,s=r.y;let l=-1/0,c;if(wd(r,t))return t;do{if(wd(r,t.next))return t.next;if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const P=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(P<=n&&P>l&&(l=P,c=t.x<t.next.x?t:t.next,P===n))return c}t=t.next}while(t!==e);if(!c)return null;const a=c,g=c.x,v=c.y;let w=1/0;t=c;do{if(n>=t.x&&t.x>=g&&n!==t.x&&CR(s<v?n:l,s,g,v,s<v?l:n,s,t.x,t.y)){const P=Math.abs(s-t.y)/(n-t.x);sg(t,r)&&(P<w||P===w&&(t.x>c.x||t.x===c.x&&QQ(c,t)))&&(c=t,w=P)}t=t.next}while(t!==a);return c}function QQ(r,e){return yi(r.prev,r,e.prev)<0&&yi(e.next,r,r.next)<0}function JQ(r,e,t,n){let s=r;do s.z===0&&(s.z=o0(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,eJ(s)}function eJ(r){let e,t=1;do{let n=r,s;r=null;let l=null;for(e=0;n;){e++;let c=n,a=0;for(let v=0;v<t&&(a++,c=c.nextZ,!!c);v++);let g=t;for(;a>0||g>0&&c;)a!==0&&(g===0||!c||n.z<=c.z)?(s=n,n=n.nextZ,a--):(s=c,c=c.nextZ,g--),l?l.nextZ=s:r=s,s.prevZ=l,l=s;n=c}l.nextZ=null,t*=2}while(e>1);return r}function o0(r,e,t,n,s){return r=(r-t)*s|0,e=(e-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function tJ(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function CR(r,e,t,n,s,l,c,a){return(s-c)*(e-a)>=(r-c)*(l-a)&&(r-c)*(n-a)>=(t-c)*(e-a)&&(t-c)*(l-a)>=(s-c)*(n-a)}function vp(r,e,t,n,s,l,c,a){return!(r===c&&e===a)&&CR(r,e,t,n,s,l,c,a)}function rJ(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!nJ(r,e)&&(sg(r,e)&&sg(e,r)&&iJ(r,e)&&(yi(r.prev,r,e.prev)||yi(r,e.prev,e))||wd(r,e)&&yi(r.prev,r,r.next)>0&&yi(e.prev,e,e.next)>0)}function yi(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function wd(r,e){return r.x===e.x&&r.y===e.y}function RR(r,e,t,n){const s=l_(yi(r,e,t)),l=l_(yi(r,e,n)),c=l_(yi(t,n,r)),a=l_(yi(t,n,e));return!!(s!==l&&c!==a||s===0&&a_(r,t,e)||l===0&&a_(r,n,e)||c===0&&a_(t,r,n)||a===0&&a_(t,e,n))}function a_(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function l_(r){return r>0?1:r<0?-1:0}function nJ(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&RR(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function sg(r,e){return yi(r.prev,r,r.next)<0?yi(r,e,r.next)>=0&&yi(r,r.prev,e)>=0:yi(r,e,r.prev)<0||yi(r,r.next,e)<0}function iJ(r,e){let t=r,n=!1;const s=(r.x+e.x)/2,l=(r.y+e.y)/2;do t.y>l!=t.next.y>l&&t.next.y!==t.y&&s<(t.next.x-t.x)*(l-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function MR(r,e){const t=a0(r.i,r.x,r.y),n=a0(e.i,e.x,e.y),s=r.next,l=e.prev;return r.next=e,e.prev=r,t.next=s,s.prev=t,n.next=t,t.prev=n,l.next=n,n.prev=l,n}function cE(r,e,t,n){const s=a0(r,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function og(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function a0(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sJ(r,e,t,n){let s=0;for(let l=e,c=t-n;l<t;l+=n)s+=(r[c]-r[l])*(r[l+1]+r[c+1]),c=l;return s}function oJ(r){const e=[],t=[],n=r[0][0].length;let s=0,l=0;for(const c of r){for(const a of c)for(let g=0;g<n;g++)e.push(a[g]);l&&(s+=l,t.push(s)),l=c.length}return{vertices:e,holes:t,dimensions:n}}const aJ=.4,lJ=6,uE=.1,bp=2,cJ=bp*Float32Array.BYTES_PER_ELEMENT,kR=4,uJ=kR*Float32Array.BYTES_PER_ELEMENT,hJ=`#version 300 es
precision highp float;
in vec2 a_pos;
in vec4 a_color;
out vec4 v_color;
uniform vec4 u_zone_base;
uniform vec4 u_zone_scale_x;
uniform vec4 u_zone_scale_y;
void main() {
	v_color = a_color;
	gl_Position = u_zone_base + a_pos.x * u_zone_scale_x + a_pos.y * u_zone_scale_y;
}
`,dJ=`#version 300 es
precision mediump float;
in vec4 v_color;
out vec4 fragColor;
void main() {
	fragColor = v_color;
}
`,fJ=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),pJ=`
attribute vec2 a_pos;
attribute vec2 a_tex_coord;
varying vec2 v_tex_coord;
void main() {
	v_tex_coord = a_tex_coord;
	gl_Position = vec4(a_pos, 0.0, 1.0);
}
`,gJ=`
precision highp float;
uniform sampler2D u_texture;
uniform float u_opacity_primary;
uniform float u_opacity_secondary;
uniform float u_stripe_width;
varying vec2 v_tex_coord;
void main() {
	vec4 color = texture2D(u_texture, v_tex_coord);
	if (color.a == 0.0) {
		discard;
	}
	float diagonal = gl_FragCoord.x + gl_FragCoord.y;
	float stripeIndex = mod(floor(diagonal / u_stripe_width), 2.0);
	float opacity = mix(u_opacity_primary, u_opacity_secondary, stripeIndex);
	gl_FragColor = vec4(color.rgb, color.a * opacity);
}
`,mJ=new Float32Array([.13333333,.77254902,.36862745,1]),_J=new Float32Array([.9372549,.26666667,.26666667,1]),yJ=new Float32Array([1,.84313725,0,1]),vJ=new Float32Array([.25882354,.52156866,.95686275,1]),bJ=r=>r.stationArea?vJ:r.rideEndAllowed?mJ:r.rideThroughAllowed?yJ:_J,xJ=r=>new Float32Array([(r>>16&255)/255,(r>>8&255)/255,(r&255)/255,1]),wJ=r=>r[0]<<16|r[1]<<8|r[2],hE=(r,e,t,n,s,l)=>{const c=r.project(l),a=c.x*n,g=c.y*s,v=a/e*2-1,w=1-g/t*2;return new Float32Array([v,w,0,1])},TJ=(r,e,t,n,s,l,c)=>{const a=new qn.MercatorCoordinate(l[0],l[1]).toLngLat(),g=new qn.MercatorCoordinate(l[0]+c[0],l[1]+c[1]).toLngLat(),v=hE(r,e,t,n,s,a),w=hE(r,e,t,n,s,g),P=new Float32Array([w[0]-v[0],0,0,0]),I=new Float32Array([0,w[1]-v[1],0,0]);return{base:v,scaleX:P,scaleY:I}},SJ=r=>Array.isArray(r)?new qn.Point(r[0],r[1]):r;class AJ{id;type="custom";renderingMode="2d";opacity;gl=null;map=null;screenProgram=null;framebuffer=null;texture=null;pickingFramebuffer=null;pickingTexture=null;quadBuffer=null;features=[];geometryDirty=!0;width=0;height=0;pickingWidth=0;pickingHeight=0;fillProgram=null;pickingLookup=new Map;pickingPixel=new Uint8Array(4);positionBuffer=null;colorBuffer=null;pickingColorBuffer=null;vertexCount=0;globalOrigin=new Float32Array([0,0]);globalExtent=new Float32Array([1,1]);screenPositionLocation=-1;screenTexCoordLocation=-1;screenTextureLocation=null;screenOpacityPrimaryLocation=null;screenOpacitySecondaryLocation=null;screenStripeWidthLocation=null;constructor(e){this.id=e.id,this.opacity=e.opacity??aJ}setOpacity(e){this.opacity!==e&&(this.opacity=e,this.map?.triggerRepaint())}setFeatures(e){this.features=e,this.geometryDirty=!0,this.updateGeometry(),this.map?.triggerRepaint()}onAdd(e,t){this.map=e,this.gl=t,this.initialize(t),this.updateGeometry()}onRemove(e,t){this.cleanup(t)}cleanup(e){!e&&this.gl&&(e=this.gl),e&&(this.deleteGeometryBuffers(e),this.framebuffer&&(e.deleteFramebuffer(this.framebuffer),this.framebuffer=null),this.texture&&(e.deleteTexture(this.texture),this.texture=null),this.pickingFramebuffer&&(e.deleteFramebuffer(this.pickingFramebuffer),this.pickingFramebuffer=null),this.pickingTexture&&(e.deleteTexture(this.pickingTexture),this.pickingTexture=null),this.quadBuffer&&(e.deleteBuffer(this.quadBuffer),this.quadBuffer=null),this.fillProgram&&(e.deleteProgram(this.fillProgram.program),this.fillProgram=null),this.pickingLookup.clear(),this.screenProgram&&(e.deleteProgram(this.screenProgram),this.screenProgram=null),this.geometryDirty=!0,this.width=0,this.height=0,this.pickingWidth=0,this.pickingHeight=0,this.gl=null,this.map=null)}prerender(e,t){if(!this.map||this.vertexCount===0||!this.positionBuffer||!this.colorBuffer||!this.pickingColorBuffer)return;const n=this.map,s=e.drawingBufferWidth,l=e.drawingBufferHeight;if(s===0||l===0)return;const c=this.ensureFillProgram(e);if(!c||c.positionLocation<0||c.colorLocation<0)return;const g=n.getCanvas().getBoundingClientRect(),v=g.width,w=g.height;if(v===0||w===0)return;const P=s/v,I=l/w,k=TJ(n,s,l,P,I,this.globalOrigin,this.globalExtent);if(this.ensureFramebuffer(e,s,l),this.ensurePickingFramebuffer(e,s,l),!this.framebuffer||!this.texture||!this.pickingFramebuffer||!this.pickingTexture)return;const N=e.getParameter(e.FRAMEBUFFER_BINDING),D=e.getParameter(e.VIEWPORT),B=e.isEnabled(e.BLEND),U=e.isEnabled(e.DEPTH_TEST),V=e.isEnabled(e.STENCIL_TEST),L=e.isEnabled(e.CULL_FACE);e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.CULL_FACE);const $=(te,G)=>{e.bindFramebuffer(e.FRAMEBUFFER,te),e.viewport(0,0,s,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(c.program),e.uniform4fv(c.baseLocation,k.base),e.uniform4fv(c.scaleXLocation,k.scaleX),e.uniform4fv(c.scaleYLocation,k.scaleY),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.enableVertexAttribArray(c.positionLocation),e.vertexAttribPointer(c.positionLocation,bp,e.FLOAT,!1,cJ,0),e.bindBuffer(e.ARRAY_BUFFER,G),e.enableVertexAttribArray(c.colorLocation),e.vertexAttribPointer(c.colorLocation,kR,e.FLOAT,!1,uJ,0),e.drawArrays(e.TRIANGLES,0,this.vertexCount),e.disableVertexAttribArray(c.positionLocation),e.disableVertexAttribArray(c.colorLocation),e.bindBuffer(e.ARRAY_BUFFER,null)};$(this.framebuffer,this.colorBuffer),$(this.pickingFramebuffer,this.pickingColorBuffer),e.bindFramebuffer(e.FRAMEBUFFER,N),e.viewport(D[0],D[1],D[2],D[3]),B&&e.enable(e.BLEND),U&&e.enable(e.DEPTH_TEST),V&&e.enable(e.STENCIL_TEST),L&&e.enable(e.CULL_FACE)}render(e,t){if(!this.screenProgram||!this.texture||!this.quadBuffer||this.vertexCount===0)return;e.useProgram(this.screenProgram);const n=e.getParameter(e.BLEND_SRC_RGB),s=e.getParameter(e.BLEND_DST_RGB),l=e.getParameter(e.BLEND_SRC_ALPHA),c=e.getParameter(e.BLEND_DST_ALPHA),a=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enableVertexAttribArray(this.screenPositionLocation),e.enableVertexAttribArray(this.screenTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.vertexAttribPointer(this.screenPositionLocation,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(this.screenTexCoordLocation,2,e.FLOAT,!1,16,8),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(this.screenTextureLocation,0);const v=Math.max(this.opacity-uE,0),w=Math.min(this.opacity+uE,1);e.uniform1f(this.screenOpacityPrimaryLocation,v),e.uniform1f(this.screenOpacitySecondaryLocation,w),e.uniform1f(this.screenStripeWidthLocation,lJ),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.disableVertexAttribArray(this.screenPositionLocation),e.disableVertexAttribArray(this.screenTexCoordLocation),e.blendFuncSeparate(n,s,l,c),e.blendEquationSeparate(a,g)}initialize(e){if(this.screenProgram=this.createProgram(e,pJ,gJ),!this.screenProgram)throw new Error("Failed to initialize zone fill shaders");if(this.screenPositionLocation=e.getAttribLocation(this.screenProgram,"a_pos"),this.screenTexCoordLocation=e.getAttribLocation(this.screenProgram,"a_tex_coord"),this.screenTextureLocation=e.getUniformLocation(this.screenProgram,"u_texture"),this.screenOpacityPrimaryLocation=e.getUniformLocation(this.screenProgram,"u_opacity_primary"),this.screenOpacitySecondaryLocation=e.getUniformLocation(this.screenProgram,"u_opacity_secondary"),this.screenStripeWidthLocation=e.getUniformLocation(this.screenProgram,"u_stripe_width"),this.quadBuffer=e.createBuffer(),!this.quadBuffer)throw new Error("Failed to allocate quad buffer");e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.bufferData(e.ARRAY_BUFFER,fJ,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)}ensureFramebuffer(e,t,n){if(this.framebuffer&&this.texture&&this.width===t&&this.height===n||(this.width=t,this.height=n,this.framebuffer||(this.framebuffer=e.createFramebuffer()),this.texture||(this.texture=e.createTexture()),!this.framebuffer||!this.texture))return;e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER);s!==e.FRAMEBUFFER_COMPLETE&&console.error("[ZoneFillLayer] Incomplete framebuffer:",s),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}ensurePickingFramebuffer(e,t,n){if(this.pickingFramebuffer&&this.pickingTexture&&this.pickingWidth===t&&this.pickingHeight===n||(this.pickingFramebuffer||(this.pickingFramebuffer=e.createFramebuffer()),this.pickingTexture||(this.pickingTexture=e.createTexture()),!this.pickingFramebuffer||!this.pickingTexture))return;e.bindTexture(e.TEXTURE_2D,this.pickingTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,this.pickingFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.pickingTexture,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER);s!==e.FRAMEBUFFER_COMPLETE&&console.error("[ZoneFillLayer] Incomplete picking framebuffer:",s),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),this.pickingWidth=t,this.pickingHeight=n}ensureFillProgram(e){if(this.fillProgram)return this.fillProgram;const t=this.createProgram(e,hJ,dJ);if(!t)return null;const n={program:t,positionLocation:e.getAttribLocation(t,"a_pos"),colorLocation:e.getAttribLocation(t,"a_color"),baseLocation:e.getUniformLocation(t,"u_zone_base"),scaleXLocation:e.getUniformLocation(t,"u_zone_scale_x"),scaleYLocation:e.getUniformLocation(t,"u_zone_scale_y")};return this.fillProgram=n,n}createProgram(e,t,n){const s=this.compileShader(e,e.VERTEX_SHADER,t),l=this.compileShader(e,e.FRAGMENT_SHADER,n);if(!s||!l)return null;const c=e.createProgram();return c?(e.attachShader(c,s),e.attachShader(c,l),e.linkProgram(c),e.getProgramParameter(c,e.LINK_STATUS)?(e.deleteShader(s),e.deleteShader(l),c):(console.error("Failed to link shader program",e.getProgramInfoLog(c)),e.deleteProgram(c),null)):null}compileShader(e,t,n){const s=e.createShader(t);return s?(e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(console.error("Failed to compile shader",e.getShaderInfoLog(s)),e.deleteShader(s),null)):null}updateGeometry(){const e=this.gl;if(!e||!this.geometryDirty)return;this.deleteGeometryBuffers(e),this.pickingLookup.clear();const t=[...this.features].sort((V,L)=>V.properties.z-L.properties.z),n=[],s=[],l=[];let c=0,a=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,w=Number.NEGATIVE_INFINITY,P=0;for(const V of t){const L=this.buildZoneGeometry(V);if(!L)continue;const $=L.vertices.length/bp;if($===0)continue;n.push(L),c+=$,a=Math.min(a,L.minX),g=Math.min(g,L.minY),v=Math.max(v,L.maxX),w=Math.max(w,L.maxY);const te=P+1;P+=1;const G=bJ(V.properties),le=xJ(te);this.pickingLookup.set(te,V);for(let se=0;se<$;++se)s.push(G[0],G[1],G[2],G[3]),l.push(le[0],le[1],le[2],le[3])}const I=v-a,k=w-g;if(c===0||a===Number.POSITIVE_INFINITY||g===Number.POSITIVE_INFINITY||v===Number.NEGATIVE_INFINITY||w===Number.NEGATIVE_INFINITY||I===0||k===0){this.vertexCount=0,this.geometryDirty=!1;return}this.globalOrigin=new Float32Array([a,g]),this.globalExtent=new Float32Array([I,k]);const N=new Float32Array(c*bp);let D=0;for(const V of n)for(let L=0;L<V.vertices.length;L+=bp){const $=V.vertices[L],te=V.vertices[L+1];N[D++]=($-a)/I,N[D++]=(te-g)/k}const B=new Float32Array(s),U=new Float32Array(l);if(this.positionBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.pickingColorBuffer=e.createBuffer(),!this.positionBuffer||!this.colorBuffer||!this.pickingColorBuffer){console.error("[ZoneFillLayer] Failed to allocate geometry buffers"),this.deleteGeometryBuffers(e),this.geometryDirty=!1;return}e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,N,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,B,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.pickingColorBuffer),e.bufferData(e.ARRAY_BUFFER,U,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.vertexCount=c,this.geometryDirty=!1}deleteGeometryBuffers(e){this.positionBuffer&&(e.deleteBuffer(this.positionBuffer),this.positionBuffer=null),this.colorBuffer&&(e.deleteBuffer(this.colorBuffer),this.colorBuffer=null),this.pickingColorBuffer&&(e.deleteBuffer(this.pickingColorBuffer),this.pickingColorBuffer=null),this.vertexCount=0,this.globalOrigin=new Float32Array([0,0]),this.globalExtent=new Float32Array([1,1])}pickFeatureAt(e){if(!this.map||!this.gl||!this.pickingFramebuffer||!this.pickingTexture)return null;const t=SJ(e),n=this.map.getCanvas(),s=n.getBoundingClientRect();if(s.width===0||s.height===0)return null;const l=n.width/s.width,c=n.height/s.height,a=Math.floor(t.x*l),g=Math.floor(n.height-t.y*c-1),v=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.pickingFramebuffer),this.gl.readPixels(a,g,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pickingPixel),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,v);const w=wJ(this.pickingPixel);return w===0?null:this.pickingLookup.get(w)??null}buildZoneGeometry(e){const t=[];let n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;const a=g=>{if(!g.length)return;const v=g.map(k=>k.map(([N,D])=>{const B=qn.MercatorCoordinate.fromLngLat([N,D]);return n=Math.min(n,B.x),s=Math.min(s,B.y),l=Math.max(l,B.x),c=Math.max(c,B.y),[B.x,B.y]})),w=oJ(v),P=WQ(w.vertices,w.holes,w.dimensions),I=w.dimensions;for(const k of P){const N=k*I;t.push(w.vertices[N],w.vertices[N+1])}};for(const g of e.geometry.coordinates)a(g);return t.length===0?null:{vertices:t,minX:n,minY:s,maxX:l,maxY:c}}}function EJ(r,e){Tt(e,!0);let n=ae(e,"opacity",3,.4);const s=Sa("map");let l=wt(null),c=null,a=null,g=n();const v=()=>(S(l)||pe(l,new AJ({id:e.id,opacity:n()}),!0),S(l)),w=()=>{S(l)&&(S(l).cleanup(),pe(l,null),a=null)},P=(B,U)=>(B.getStyle()?.layers??[]).findIndex($=>$.id===U),I=B=>{!B||!c||(B.off("styledata",c),B.off("idle",c),c=null)},k=B=>{const U=S(l);if(U){if(B&&B.getLayer(e.id))try{B.removeLayer(e.id)}catch(V){console.error("[ZoneLayer] failed to remove layer",V)}U.setFeatures([]),w()}};kr(()=>{const B=s.map;if(!B||e.features.length===0){I(B),k(B),a=null;return}const U=v();g!==n()&&(U.setOpacity(n()),g=n()),e.features!==a&&(a=e.features,U.setFeatures(e.features));const V=()=>{if(!e.beforeLayerId||e.beforeLayerId===e.id||!B.getLayer(e.id)||!B.getLayer(e.beforeLayerId))return;const G=P(B,e.id),le=P(B,e.beforeLayerId);G===-1||le===-1||G>=le&&B.moveLayer(e.id,e.beforeLayerId)},L=()=>{if(!B.getLayer(e.id))try{const G=e.beforeLayerId&&B.getLayer(e.beforeLayerId)?e.beforeLayerId:void 0;G?B.addLayer(U,G):B.addLayer(U)}catch(G){console.error("[ZoneLayer] failed to add layer",G)}V()},$=()=>{if(!B.isStyleLoaded()){if(!c){const G=()=>{c&&(B.off("styledata",G),B.off("idle",G),c=null,$())};c=G,B.on("styledata",G),B.on("idle",G)}return}L()},te=()=>{$(),V()};return $(),B.on("styledata",te),()=>{B.off("styledata",te),I(B)}}),hc(()=>{const B=s.map;I(B),k(B),w(),g=n()});function N(B){return S(l)?.pickFeatureAt(B)??null}var D={pick:N};return St(D)}var PJ=Fe("<!> <!>",1),IJ=Fe('<button type="button"><span class="truncate"> </span> <span class="flex items-center gap-1 text-xs font-medium"><svg class="h-4 w-4 fill-current" aria-hidden="true" focusable="false"><use></use></svg></span></button>'),CJ=Fe('<div class="flex flex-col items-end space-y-2"></div>'),RJ=Fe("<!> <!> <!> <!>",1);function MJ(r,e){Tt(e,!0);let t=wt(null),n=ae(e,"debug",3,!1);const s=11,l=.5,c="rentals-stations",a="rentals-stations-icons",g="rentals-vehicles",v=50,w="rentals-zones",P=Object.keys($o),I=(je,ht,Rt)=>`${rI(je,ht)}-${Rt}`;let k=wt(null),N=wt(null),D=0,B=wt(null),U=wt(!1),V=0,L=new Yc;const $=P.map(je=>{const ht=je.toLowerCase();return{formFactor:je,sourceId:`${g}-${ht}`,clusterLayerId:`${g}-${ht}-cluster`,pointLayerId:`${g}-${ht}-point`}}),te=je=>je.flatMap(ht=>ht.formFactors.map(Rt=>({providerGroupId:ht.id,providerGroupName:ht.name,formFactor:Rt,color:ht.color||da}))).sort((ht,Rt)=>ht.providerGroupName.localeCompare(Rt.providerGroupName,void 0,{sensitivity:"base"})||ht.formFactor.localeCompare(Rt.formFactor,void 0,{sensitivity:"base"}));let G=me(()=>S(k)?te(S(k).providerGroups):[]),le=me(()=>new Map((S(k)?.providerGroups??[]).map(je=>[je.id,je.color||da]))),se=me(()=>new Map((S(k)?.providers??[]).map(je=>[je.id,je.color||S(le).get(je.groupId)||da]))),oe=me(()=>S(k)?Object.fromEntries(S(k).providers.map(je=>[je.id,Object.fromEntries(je.vehicleTypes.map(ht=>[ht.id,ht.formFactor]))])):{});const be=(je,ht)=>je?.providerGroupId===ht?.providerGroupId&&je?.formFactor===ht?.formFactor,xe=je=>{pe(B,be(S(B),je)?null:je,!0)},_e=(je,ht,Rt)=>Math.min(Rt,Math.max(ht,je)),Ne=je=>{const ht=je.getSouthWest(),Rt=je.getNorthEast(),gt=(Rt.lng-ht.lng)*l,Ut=(Rt.lat-ht.lat)*l;return new qn.LngLatBounds([_e(ht.lng-gt,-180,180),_e(ht.lat-Ut,-90,90)],[_e(Rt.lng+gt,-180,180),_e(Rt.lat+Ut,-90,90)])},fe=(je,ht)=>!!je&&je.contains(ht.getSouthWest())&&je.contains(ht.getNorthEast()),Le=async je=>{const ht=Ne(je),Rt=cc(ht.getNorthWest()),gt=cc(ht.getSouthEast()),Ut=++D;console.debug("[Rentals] requesting rentals",{min:gt,max:Rt});const{data:kt,error:$e}=await TE({query:{max:Rt,min:gt}});if(Ut!==D)return;if($e){console.error("[Rentals] rentals request failed",$e);return}pe(k,kt,!0),pe(N,ht,!0);const cr=kt;console.debug("[Rentals] received rentals",{providers:cr.providers.length,stations:cr.stations.length,vehicles:cr.vehicles.length,zones:cr.zones.length})},tt=je=>{const ht=new Map,Rt=new Map,gt=new Map(je.providerGroups.map(kt=>[kt.id,kt.color||da])),Ut=(kt,$e)=>{let cr=ht.get(kt);cr||(cr=new Set,ht.set(kt,cr)),cr.add($e)};for(const kt of je.providers){const $e=kt.color||gt.get(kt.groupId)||da;Rt.set(kt.id,$e);for(const cr of kt.formFactors)Ut($e,cr)}for(const kt of je.stations){const $e=Rt.get(kt.providerId)||gt.get(kt.providerGroupId)||da;kt.formFactors.length===0&&Ut($e,S2);for(const cr of kt.formFactors)Ut($e,cr)}for(const kt of je.vehicles){const $e=Rt.get(kt.providerId)||gt.get(kt.providerGroupId)||da;Ut($e,kt.formFactor)}return ht},Ye=(je,ht,Rt)=>{if(!Rt)return je.numVehiclesAvailable;const gt=ht[je.providerId];return gt?Object.entries(je.vehicleTypesAvailable).reduce((Ut,[kt,$e])=>gt[kt]===Rt.formFactor?Ut+$e:Ut,0):je.numVehiclesAvailable};let rt=me(()=>{if(!S(k)||!S(U))return{type:"FeatureCollection",features:[]};const je=S(B);return{type:"FeatureCollection",features:(je?S(k).stations.filter(Rt=>Rt.providerGroupId===je.providerGroupId&&Rt.formFactors.includes(je.formFactor)):[]).map(Rt=>{const gt=S(se).get(Rt.providerId)||S(le).get(Rt.providerGroupId)||da,Ut=je?je.formFactor:Rt.formFactors[0]??S2;return{type:"Feature",geometry:{type:"Point",coordinates:[Rt.lon,Rt.lat]},properties:{icon:I(Ut,"station",gt),available:Ye(Rt,S(oe),je),providerId:Rt.providerId,stationId:Rt.id,color:gt}}})}}),it=me(()=>{const je=P.reduce((gt,Ut)=>(gt[Ut]={type:"FeatureCollection",features:[]},gt),{});if(!S(k)||!S(U))return je;const ht=S(B);return(ht?S(k).vehicles.filter(gt=>gt.providerGroupId===ht.providerGroupId&&gt.formFactor===ht.formFactor):[]).filter(gt=>!gt.stationId).forEach(gt=>{const Ut=je[gt.formFactor],kt=S(se).get(gt.providerId)||S(le).get(gt.providerGroupId)||da;Ut.features.push({type:"Feature",geometry:{type:"Point",coordinates:[gt.lon,gt.lat]},properties:{icon:I(gt.formFactor,"vehicle",kt),clusterIcon:I(gt.formFactor,"cluster",kt),providerId:gt.providerId,vehicleId:gt.id,color:kt}})}),je});const Ct=je=>({type:"MultiPolygon",coordinates:je.map(ht=>ht.map(Rt=>Qc.decode(Rt.points,Rt.precision).map(([gt,Ut])=>[Ut,gt])))}),Mt=(je,ht,Rt)=>je.rules.find(gt=>gt.vehicleTypeIdxs.length?gt.vehicleTypeIdxs.some(Ut=>ht.vehicleTypes[Ut]?.formFactor===Rt):!0);let jt=me(()=>{const je=S(k),ht=S(B);if(!je||!ht)return{type:"FeatureCollection",features:[]};const Rt=[];let gt=0;je.zones.forEach((kt,$e)=>{if(kt.providerGroupId!==ht.providerGroupId)return;const cr=je.providers.find(rn=>rn.id===kt.providerId);if(!cr)return;const Rr=Mt(kt,cr,ht.formFactor);Rr&&(Rt.push({type:"Feature",geometry:Ct(kt.area),properties:{zoneIndex:$e,providerId:kt.providerId,z:kt.z,rideEndAllowed:Rr.rideEndAllowed&&!Rr.stationParking,rideThroughAllowed:Rr.rideThroughAllowed,stationArea:!1}}),kt.z>gt&&(gt=kt.z))});const Ut=gt+1;return je.stations.forEach((kt,$e)=>{!kt.stationArea||kt.providerGroupId!==ht.providerGroupId||!kt.formFactors.includes(ht.formFactor)||Rt.push({type:"Feature",geometry:Ct(kt.stationArea),properties:{stationIndex:$e,providerId:kt.providerId,z:Ut,rideEndAllowed:!0,rideThroughAllowed:!0,stationArea:!0}})}),Rt.sort((kt,$e)=>$e.properties.z-kt.properties.z),{type:"FeatureCollection",features:Rt}}),Gt=me(()=>{const je=S(k),ht=new nQ;return je&&n()&&ht.load(S(jt).features.map(Rt=>{const gt=Rt.properties.zoneIndex!==void 0?je.zones[Rt.properties.zoneIndex].bbox:je.stations[Rt.properties.stationIndex].bbox;return{minX:gt[0],minY:gt[1],maxX:gt[2],maxY:gt[3],feature:Rt}})),ht});const Or=(je,ht)=>`${je}::${ht}`;let _r=me(()=>new Map(S(k)?.providers.map(je=>[je.id,je])??[])),wr=me(()=>new Map(S(k)?.stations.map(je=>[Or(je.providerId,je.id),je])??[])),Dr=me(()=>new Map(S(k)?.vehicles.map(je=>[Or(je.providerId,je.id),je])??[]));const Et=je=>{const ht=Or(je.providerId,je.stationId);return{key:ht,provider:S(_r).get(je.providerId),station:S(wr).get(ht)}},vt=je=>{const ht=Or(je.providerId,je.vehicleId);return{key:ht,provider:S(_r).get(je.providerId),vehicle:S(Dr).get(ht)}},Pr=je=>{const ht=je.zoneIndex!==void 0?S(k)?.zones[je.zoneIndex]:void 0,Rt=je.stationIndex!==void 0?S(k)?.stations[je.stationIndex]:void 0;return{key:je.zoneIndex!==void 0?`zone-${je.zoneIndex}`:`station-${je.stationIndex}`,provider:S(_r).get(je.providerId),zone:ht,station:Rt,rideThroughAllowed:je.rideThroughAllowed,rideEndAllowed:je.rideEndAllowed,stationArea:je.stationArea}},yr=(je,ht,Rt)=>{const gt=document.createElement("div"),Ut=c_(PQ,{target:gt,props:{provider:je,station:ht,showActions:Rt,debug:n()}});return{element:gt,destroy:()=>{u_(Ut)}}},Ar=(je,ht,Rt)=>{const gt=document.createElement("div"),Ut=c_(DQ,{target:gt,props:{provider:je,vehicle:ht,showActions:Rt,debug:n()}});return{element:gt,destroy:()=>{u_(Ut)}}},br=(je,ht,Rt,gt,Ut,kt)=>{const $e=document.createElement("div"),cr=c_(jQ,{target:$e,props:{provider:je,zone:ht,station:Rt,rideThroughAllowed:gt,rideEndAllowed:Ut,debug:n(),allZonesAtPoint:kt,zoneData:S(k)?.zones??[],stationData:S(k)?.stations??[]}});return{element:$e,destroy:()=>{u_(cr)}}};let lr=null,ut=null,Zt=null,dr=null,er=null,Bt=null,mr=null;const Tr=()=>(lr||(lr=new qn.Popup({closeButton:!1,closeOnClick:!1,offset:12,maxWidth:"none"}),lr.on("close",()=>{Bt?.(),Bt=null,Zt=null})),lr),fr=()=>(ut||(ut=new qn.Popup({closeButton:!0,closeOnClick:!0,offset:12,maxWidth:"none"}),ut.on("close",()=>{mr?.(),mr=null,dr=null})),ut),nr=()=>{Bt?.(),Bt=null,lr&&lr.remove(),Zt=null},rr=()=>{mr?.(),mr=null,ut&&ut.remove(),dr=null},Nr=()=>{er&&(er.style.cursor="",er=null)},Cr=(je,ht,Rt,gt)=>{const Ut=Tr();if(Zt!==Rt){Bt?.();const{element:kt,destroy:$e}=gt();Bt=$e,Ut.setDOMContent(kt),Zt=Rt}Ut.setLngLat(ht),Ut.isOpen()||Ut.addTo(je)},qr=(je,ht,Rt,gt)=>{const Ut=fr();mr?.();const{element:kt,destroy:$e}=gt();mr=$e,Ut.setDOMContent(kt),Ut.setLngLat(ht),Ut.isOpen()||Ut.addTo(je),dr=Rt},ir=(je,ht)=>(Rt,gt)=>{const Ut=Rt.features?.[0];if(!gt||!Ut){nr(),Nr();return}const kt=je(Ut.properties),$e=kt.station||kt.vehicle;if(!$e||!kt.provider){nr(),Nr();return}if(er=gt.getCanvas(),er.style.cursor="pointer",dr===kt.key){nr();return}Cr(gt,Rt.lngLat,kt.key,()=>ht(kt.provider,$e))},or=()=>(je,ht)=>{Nr(),nr()},Re=(je,ht)=>(Rt,gt)=>{const Ut=Rt.features?.[0];if(!gt||!Ut){rr();return}const kt=je(Ut.properties),$e=kt.station||kt.vehicle;if(!$e||!kt.provider){rr();return}nr(),rr(),qr(gt,Rt.lngLat,kt.key,()=>ht(kt.provider,$e))},Y=ir(Et,(je,ht)=>yr(je,ht,!0)),ee=or(),ie=Re(Et,(je,ht)=>yr(je,ht,!0)),Te=async(je,ht)=>{const Rt=je.features?.[0],gt=Rt?.properties?.cluster_id,Ut=Rt?.source;if(!ht||!Rt||typeof gt!="number"||!Ut)return;const kt=ht.getSource(Ut);if(!kt)return;nr(),rr(),ht.getCanvas().style.cursor="";const $e=await kt.getClusterExpansionZoom(gt);ht.easeTo({center:Rt.geometry.coordinates,zoom:$e})},Ce=(je,ht)=>{ht.getCanvas().style.cursor="pointer"},Be=(je,ht)=>{ht.getCanvas().style.cursor=""},Ge=ir(vt,(je,ht)=>Ar(je,ht,!0)),Ve=or(),nt=Re(vt,(je,ht)=>Ar(je,ht,!0)),At=(je,ht,Rt)=>{if(!ht)return;const gt=[a,...$.map(Rr=>Rr.pointLayerId),...$.map(Rr=>Rr.clusterLayerId)];if(ht.queryRenderedFeatures(je.point,{layers:gt}).length>0)return;const kt=Rt.pick(je.point);if(!kt){rr();return}const $e=Pr(kt.properties);if(!$e.zone&&!$e.station||!$e.provider){rr();return}const cr=S(Gt).search({minX:je.lngLat.lng,minY:je.lngLat.lat,maxX:je.lngLat.lng,maxY:je.lngLat.lat}).map(Rr=>Rr.feature).filter(Rr=>_Q(PK([je.lngLat.lng,je.lngLat.lat]),Rr)).sort((Rr,rn)=>rn.properties.z-Rr.properties.z);nr(),rr(),qr(ht,je.lngLat,$e.key,()=>br($e.provider,$e.zone,$e.station,$e.rideThroughAllowed,$e.rideEndAllowed,cr))};kr(()=>{if(!e.map||!e.bounds||e.zoom<=s){e.zoom<=s&&(pe(k,null),pe(N,null),D+=1);return}const je=qn.LngLatBounds.convert(e.bounds);fe(S(N),je)||Le(je)}),kr(()=>{S(B)&&!S(G).some(je=>be(je,S(B)))&&pe(B,null)});const bt=je=>{if(!(!je||L.size===0)){for(const ht of L)je.hasImage(ht)&&je.removeImage(ht);L=new Yc}};kr(()=>{const je=e.map,ht=S(k);if(!je){pe(U,!1),V+=1,bt(je);return}if(!ht){pe(U,!1),V+=1,bt(je);return}const gt=tt(ht);if(gt.size===0){V+=1,bt(je),pe(U,!0);return}const Ut=++V;pe(U,!1);const kt=new Set,$e=[];gt.forEach((cr,Rr)=>{cr.forEach(rn=>{f6.forEach(vn=>{const xt=_6(vn),Wt=I(rn,vn,Rr);kt.add(Wt),je.hasImage(Wt)||$e.push((async()=>{try{const sr=await y6(g6(rn,vn),Rr,xt);if(Ut!==V||!je)return;if(!je.hasImage(Wt))try{je.addImage(Wt,sr)}catch(Qr){console.error(`[Rentals] failed to register icon ${Wt}`,Qr)}}catch(sr){console.error(`[Rentals] failed to prepare icon ${Wt}`,sr)}})())})})}),(async()=>{if(await Promise.allSettled($e),Ut!==V||!je)return;const cr=Array.from(L);for(const rn of cr)!kt.has(rn)&&je.hasImage(rn)&&je.removeImage(rn);const Rr=new Yc;kt.forEach(rn=>{je.hasImage(rn)&&Rr.add(rn)}),L=Rr,pe(U,kt.size===Rr.size)})()}),kr(()=>{const je=e.map,ht=S(t),Rt=S(jt).features.length>0;if(!je||!ht||!Rt)return;const gt=Ut=>{At(Ut,je,ht)};return je.on("click",gt),()=>{je.off("click",gt)}}),kr(()=>{if(!S(k)){nr(),rr(),Nr();return}Zt&&!S(wr).has(Zt)&&!S(Dr).has(Zt)&&nr(),dr&&!S(wr).has(dr)&&!S(Dr).has(dr)&&rr()}),hc(()=>{D+=1,nr(),rr(),Nr(),bt(e.map),lr=null,ut=null});var ur=RJ(),Xe=ue(ur);{var Xt=je=>{const ht=me(()=>$[0]?.pointLayerId??a);{let Rt=me(()=>e.theme==="dark"?.3:.4);as(EJ(je,{id:w,get features(){return S(jt).features},get beforeLayerId(){return S(ht)},get opacity(){return S(Rt)}}),gt=>pe(t,gt,!0),()=>S(t))}};Ze(Xe,je=>{S(jt).features.length>0&&je(Xt)})}var xr=ve(Xe,2);_a(xr,{id:c,get data(){return S(rt)},children:(je,ht)=>{{let Rt=me(()=>({"icon-image":["get","icon"],"icon-size":ib,"icon-allow-overlap":!1,"icon-ignore-placement":!0,"text-field":["to-string",["get","available"]],"text-allow-overlap":!1,"text-ignore-placement":!0,"text-anchor":"center","text-offset":A2,"text-size":v6,"text-font":["Noto Sans Display Regular"]}));wi(je,{id:a,beforeLayerId:"",type:"symbol",filter:!0,get layout(){return S(Rt)},get onmousemove(){return Y},get onmouseleave(){return ee},get onclick(){return ie},paint:{"text-color":"#000"}})}},$$slots:{default:!0}});var Lt=ve(xr,2);xn(Lt,17,()=>$,je=>je.sourceId,(je,ht)=>{_a(je,{get id(){return S(ht).sourceId},get data(){return S(it)[S(ht).formFactor]},options:{cluster:!0,clusterRadius:v,clusterProperties:{color:["coalesce",["get","color"]],icon:["coalesce",["get","icon"]],clusterIcon:["coalesce",["get","clusterIcon"]]}},children:(Rt,gt)=>{var Ut=PJ(),kt=ue(Ut);{let cr=me(()=>({"icon-image":["get","clusterIcon"],"icon-size":ib,"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["to-string",["get","point_count"]],"text-allow-overlap":!0,"text-ignore-placement":!0,"text-anchor":"center","text-offset":A2,"text-size":b6,"text-font":["Noto Sans Display Regular"]}));wi(kt,{get id(){return S(ht).clusterLayerId},beforeLayerId:a,type:"symbol",filter:["has","point_count"],get layout(){return S(cr)},paint:{"text-color":"#000"},onclick:Te,onmouseenter:Ce,onmouseleave:Be})}var $e=ve(kt,2);{let cr=me(()=>({"icon-image":["get","icon"],"icon-size":ib,"icon-allow-overlap":!0,"icon-ignore-placement":!0}));wi($e,{get id(){return S(ht).pointLayerId},get beforeLayerId(){return S(ht).clusterLayerId},type:"symbol",filter:["!",["has","point_count"]],get layout(){return S(cr)},paint:{},get onmousemove(){return Ge},get onmouseleave(){return Ve},get onclick(){return nt}})}Z(Rt,Ut)},$$slots:{default:!0}})});var gr=ve(Lt,2);{var Lr=je=>{_o(je,{position:"top-right",class:"mb-5",children:(ht,Rt)=>{var gt=CJ();xn(gt,21,()=>S(G),Ut=>`${Ut.providerGroupId}::${Ut.formFactor}`,(Ut,kt)=>{const $e=me(()=>be(S(B),S(kt)));var cr=IJ();cr.__click=()=>xe(S(kt));var Rr=Ae(cr),rn=Ae(Rr,!0);we(Rr);var vn=ve(Rr,2),xt=Ae(vn),Wt=Ae(xt);we(xt),we(vn),we(cr),mt(sr=>{Fn(cr,"title",`${S(kt).providerGroupName} (${$o[S(kt).formFactor].label})`),fi(cr,1,sr),Fn(cr,"aria-pressed",S($e)),pt(rn,S(kt).providerGroupName),wa(xt,`color: ${S(kt).color}`),Fn(Wt,"href",`#${$o[S(kt).formFactor].svg}`)},[()=>bo(_n("inline-flex max-w-72 items-center gap-2 rounded-md border-2 px-3 py-1.5 text-sm font-semibold transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500",S($e)?"border-blue-600 bg-accent text-accent-foreground":"border-muted bg-popover text-foreground hover:bg-accent hover:text-accent-foreground"))]),Z(Ut,cr)}),we(gt),Z(ht,gt)},$$slots:{default:!0}})};Ze(gr,je=>{S(G).length>0&&je(Lr)})}Z(r,ur),St()}yu(["click"]);var kJ=Fe("<!> <!>",1);function DJ(r,e){Tt(e,!0);function t(s){return{type:"FeatureCollection",features:s.filter(l=>l.mode!=="WALK"&&l.mode!=="BIKE"&&l.mode!=="CAR").flatMap(l=>{const c=[{type:"Feature",geometry:{type:"Point",coordinates:[l.from.lon,l.from.lat]},properties:{stopId:l.from.stopId,name:l.from.name,time:l.from.arrival??l.from.departure,color:nl(l)[0]}},{type:"Feature",geometry:{type:"Point",coordinates:[l.to.lon,l.to.lat]},properties:{stopId:l.to.stopId,name:l.to.name,time:l.to.arrival,color:nl(l)[0]}}],a=l.intermediateStops?l.intermediateStops.map(g=>({type:"Feature",geometry:{type:"Point",coordinates:[g.lon,g.lat]},properties:{stopId:g.stopId,name:g.name,time:g.arrival,color:nl(l)[0]}})):[];return[...c,...a]})}}const n=me(()=>t(e.itinerary.legs));_a(r,{id:"stops",get data(){return S(n)},children:(s,l)=>{var c=kJ(),a=ue(c);wi(a,{id:"stops",type:"circle",layout:{},filter:["all"],paint:{"circle-radius":5,"circle-color":"white","circle-stroke-width":4,"circle-stroke-color":["get","color"]},onclick:v=>{const w=v.features?.[0];w?.properties?.stopId&&(console.log("Clicked Stop:",w.properties.name),Ad(w.properties.name,w.properties.stopId,new Date(w.properties.time)))},onmousemove:(v,w)=>w.getCanvas().style.cursor="pointer",onmouseleave:(v,w)=>w.getCanvas().style.cursor=""});var g=ve(a,2);{let v=me(()=>({"text-halo-width":2,"text-halo-color":["interpolate-hcl",["linear"],.6,0,["get","color"],1,e.theme=="dark"?"#000":"#fff"],"text-color":e.theme=="dark"?"#fff":"#000"}));wi(g,{id:"intermediate-stops-name",type:"symbol",layout:{"text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12,"text-offset":[0,1],"text-anchor":"top"},filter:!0,get paint(){return S(v)}})}Z(s,c)},$$slots:{default:!0}}),St()}var OJ=Fe("<!> <!>",1),FJ=Fe("<!> <!> <!>",1),NJ=Fe("<!> <!> <!> <!>",1),LJ=Fe("<!> <!>",1),BJ=Fe('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"> </h2> <!></div> <div><!></div>',1),zJ=Fe("<!> <!>",1),UJ=Fe("<!> <!>",1),VJ=Fe('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"><!> </h2> <!></div> <div class="p-2 md:p-4 overflow-y-auto overflow-x-hidden min-h-0 md:max-h-[60vh]"><!></div>',1),jJ=Fe("<!> <!> <!> <!> <!>",1),WJ=Fe('<div class="maplibregl-ctrl-top-left"><!></div>'),$J=Fe('| <a target="_blank"> </a>',1),HJ=Fe("<!> <!>",1),ZJ=Fe("<!> <!>",1),XJ=Fe("<!> <!> <!> <!> <!> <!> <!> <!>",1),qJ=Fe('<!> <!> <!> <div><div class="maplibregl-ctrl maplibregl-ctrl-attrib"><div class="maplibregl-ctrl-attrib-inner">&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> <!></div></div></div> <!>',1);function lee(r,e){Tt(e,!0);const t=(Xt,xr=Ht,Lt=Ht)=>{var gr=We(),Lr=ue(gr);{var je=Rt=>{var gt=OJ(),Ut=ue(gt);An(Ut,{variant:"outline",onclick:()=>{pe(fe,Ri(xr().lngLat,S(L)>m_?S(V):void 0),!0),S(be)?.setLngLat(S(fe).match),Lt()()},children:($e,cr)=>{Yr();var Rr=Br("From");Z($e,Rr)},$$slots:{default:!0}});var kt=ve(Ut,2);An(kt,{variant:"outline",onclick:()=>{pe(Le,Ri(xr().lngLat,S(L)>m_?S(V):void 0),!0),S(xe)?.setLngLat(S(Le).match),Lt()()},children:($e,cr)=>{Yr();var Rr=Br("To");Z($e,Rr)},$$slots:{default:!0}}),Z(Rt,gt)},ht=Rt=>{var gt=We(),Ut=ue(gt);{var kt=$e=>{An($e,{variant:"outline",onclick:()=>{pe(tt,Ri(xr().lngLat,S(L)>m_?S(V):void 0),!0),S(_e)?.setLngLat(S(tt).match),Lt()()},children:(cr,Rr)=>{Yr();var rn=Br();mt(()=>pt(rn,yt.position)),Z(cr,rn)},$$slots:{default:!0}})};Ze(Ut,$e=>{S(v)=="isochrones"&&$e(kt)},!0)}Z(Rt,gt)};Ze(Lr,Rt=>{S(v)=="connections"?Rt(je):Rt(ht,!1)})}Z(Xt,gr)},n=Xt=>{var xr=jJ(),Lt=ue(xr);_o(Lt,{children:($e,cr)=>{var Rr=We(),rn=ue(Rr);ar(rn,()=>zK,(vn,xt)=>{xt(vn,{class:"max-w-full w-[520px] overflow-y-auto",get value(){return S(v)},set value(Wt){pe(v,Wt,!0)},children:(Wt,sr)=>{var Qr=NJ(),Gr=ue(Qr);ar(Gr,()=>BK,(nn,wn)=>{wn(nn,{class:"grid grid-cols-3",children:(jr,Tn)=>{var Pn=FJ(),dn=ue(Pn);ar(dn,()=>Gb,(bn,fn)=>{fn(bn,{value:"connections",children:(Mi,ls)=>{Yr();var gi=Br();mt(()=>pt(gi,yt.connections)),Z(Mi,gi)},$$slots:{default:!0}})});var It=ve(dn,2);ar(It,()=>Gb,(bn,fn)=>{fn(bn,{value:"departures",children:(Mi,ls)=>{Yr();var gi=Br();mt(()=>pt(gi,yt.departures)),Z(Mi,gi)},$$slots:{default:!0}})});var Hr=ve(It,2);ar(Hr,()=>Gb,(bn,fn)=>{fn(bn,{value:"isochrones",children:(Mi,ls)=>{Yr();var gi=Br();mt(()=>pt(gi,yt.isochrones.title)),Z(Mi,gi)},$$slots:{default:!0}})}),Z(jr,Pn)},$$slots:{default:!0}})});var cn=ve(Gr,2);ar(cn,()=>qb,(nn,wn)=>{wn(nn,{value:"connections",children:(jr,Tn)=>{pa(jr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Pn,dn)=>{X6(Pn,{get geocodingBiasPlace(){return S(U)},get serverConfig(){return S(D)},get from(){return S(fe)},set from(It){pe(fe,It,!0)},get to(){return S(Le)},set to(It){pe(Le,It,!0)},get time(){return S(jt)},set time(It){pe(jt,It,!0)},get arriveBy(){return S(Dr)},set arriveBy(It){pe(Dr,It,!0)},get useRoutedTransfers(){return S(vt)},set useRoutedTransfers(It){pe(vt,It,!0)},get maxTransfers(){return S(Tr)},set maxTransfers(It){pe(Tr,It,!0)},get pedestrianProfile(){return S(Pr)},set pedestrianProfile(It){pe(Pr,It,!0)},get requireCarTransport(){return S(Ar)},set requireCarTransport(It){pe(Ar,It,!0)},get requireBikeTransport(){return S(yr)},set requireBikeTransport(It){pe(yr,It,!0)},get transitModes(){return S(br)},set transitModes(It){pe(br,It,!0)},get preTransitModes(){return S(lr)},set preTransitModes(It){pe(lr,It,!0)},get postTransitModes(){return S(ut)},set postTransitModes(It){pe(ut,It,!0)},get directModes(){return S(Zt)},set directModes(It){pe(Zt,It,!0)},get elevationCosts(){return S(mr)},set elevationCosts(It){pe(mr,It,!0)},get maxPreTransitTime(){return S(nr)},set maxPreTransitTime(It){pe(nr,It)},get maxPostTransitTime(){return S(rr)},set maxPostTransitTime(It){pe(rr,It)},get maxDirectTime(){return S(Nr)},set maxDirectTime(It){pe(Nr,It)},get ignorePreTransitRentalReturnConstraints(){return S(Cr)},set ignorePreTransitRentalReturnConstraints(It){pe(Cr,It,!0)},get ignorePostTransitRentalReturnConstraints(){return S(qr)},set ignorePostTransitRentalReturnConstraints(It){pe(qr,It,!0)},get ignoreDirectRentalReturnConstraints(){return S(ir)},set ignoreDirectRentalReturnConstraints(It){pe(ir,It,!0)},get preTransitProviderGroups(){return S(dr)},set preTransitProviderGroups(It){pe(dr,It,!0)},get postTransitProviderGroups(){return S(er)},set postTransitProviderGroups(It){pe(er,It,!0)},get directProviderGroups(){return S(Bt)},set directProviderGroups(It){pe(Bt,It,!0)},get via(){return S(Ct)},set via(It){pe(Ct,It,!0)},get viaMinimumStay(){return S(Mt)},set viaMinimumStay(It){pe(Mt,It,!0)},get viaLabels(){return S(it)},set viaLabels(It){pe(it,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})});var Yt=ve(cn,2);ar(Yt,()=>qb,(nn,wn)=>{wn(nn,{value:"departures",children:(jr,Tn)=>{pa(jr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Pn,dn)=>{VK(Pn,{get time(){return S(jt)},set time(It){pe(jt,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})});var un=ve(Yt,2);ar(un,()=>qb,(nn,wn)=>{wn(nn,{value:"isochrones",children:(jr,Tn)=>{pa(jr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Pn,dn)=>{tQ(Pn,{get serverConfig(){return S(D)},get geocodingBiasPlace(){return S(U)},get one(){return S(tt)},set one(It){pe(tt,It,!0)},get maxTravelTime(){return S(fr)},set maxTravelTime(It){pe(fr,It)},get time(){return S(jt)},set time(It){pe(jt,It,!0)},get useRoutedTransfers(){return S(vt)},set useRoutedTransfers(It){pe(vt,It,!0)},get pedestrianProfile(){return S(Pr)},set pedestrianProfile(It){pe(Pr,It,!0)},get requireCarTransport(){return S(Ar)},set requireCarTransport(It){pe(Ar,It,!0)},get requireBikeTransport(){return S(yr)},set requireBikeTransport(It){pe(yr,It,!0)},get transitModes(){return S(br)},set transitModes(It){pe(br,It,!0)},get maxTransfers(){return S(Tr)},set maxTransfers(It){pe(Tr,It,!0)},get preTransitModes(){return S(lr)},set preTransitModes(It){pe(lr,It,!0)},get postTransitModes(){return S(ut)},set postTransitModes(It){pe(ut,It,!0)},get maxPreTransitTime(){return S(nr)},set maxPreTransitTime(It){pe(nr,It)},get maxPostTransitTime(){return S(rr)},set maxPostTransitTime(It){pe(rr,It)},get arriveBy(){return S(Dr)},set arriveBy(It){pe(Dr,It,!0)},get elevationCosts(){return S(mr)},set elevationCosts(It){pe(mr,It,!0)},get ignorePreTransitRentalReturnConstraints(){return S(Cr)},set ignorePreTransitRentalReturnConstraints(It){pe(Cr,It,!0)},get ignorePostTransitRentalReturnConstraints(){return S(qr)},set ignorePostTransitRentalReturnConstraints(It){pe(qr,It,!0)},get options(){return S(Y)},set options(It){pe(Y,It,!0)},get preTransitProviderGroups(){return S(dr)},set preTransitProviderGroups(It){pe(dr,It,!0)},get postTransitProviderGroups(){return S(er)},set postTransitProviderGroups(It){pe(er,It,!0)},get directProviderGroups(){return S(Bt)},set directProviderGroups(It){pe(Bt,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),Z(Wt,Qr)},$$slots:{default:!0}})}),Z($e,Rr)},$$slots:{default:!0}});var gr=ve(Lt,2);{var Lr=$e=>{var cr=LJ(),Rr=ue(cr);{let xt=me(()=>ri.state.selectedItinerary?"hide":"");_o(Rr,{get class(){return`min-h-0 md:mb-2 ${S(xt)??""}`},children:(Wt,sr)=>{{let Qr=me(()=>g?"border-0 shadow-none":"");pa(Wt,{get class(){return`scrollable w-[520px] h-full md:max-h-[60vh] ${S(Qr)??""} overflow-x-hidden bg-background rounded-lg mb-2`},children:(Gr,cn)=>{{let Yt=me(()=>QT(S(fe),S(Le)));b5(Gr,{get baseResponse(){return S(Ve)},get routingResponses(){return S(nt)},get baseQuery(){return S(Ce)},selectItinerary:un=>{ix("",{selectedItinerary:un,scrollY:void 0})},get updateStartDest(){return S(Yt)}})}},$$slots:{default:!0}})}},$$slots:{default:!0}})}var rn=ve(Rr,2);{var vn=xt=>{var Wt=We(),sr=ue(Wt);xn(sr,17,()=>S(nt),di,(Qr,Gr,cn)=>{var Yt=We(),un=ue(Yt);Ja(un,()=>S(Gr),null,(nn,wn)=>{var jr=We(),Tn=ue(jr);xn(Tn,17,()=>S(wn).itineraries,di,(Pn,dn,It)=>{$2(Pn,{get itinerary(){return S(dn)},id:`${cn}-${It}`,selected:!1,selectItinerary:()=>{ix("",{selectedItinerary:S(dn)})},get level(){return S(V)},get theme(){return B}})}),Z(nn,jr)}),Z(Qr,Yt)}),Z(xt,Wt)};Ze(rn,xt=>{S(I)&&!ri.state.selectedItinerary&&xt(vn)})}Z($e,cr)};Ze(gr,$e=>{S(v)=="connections"&&S(nt).length!==0&&!ri.state.showDepartures&&$e(Lr)})}var je=ve(gr,2);{var ht=$e=>{var cr=UJ(),Rr=ue(cr);_o(Rr,{class:"min-h-0 md:mb-2",children:(xt,Wt)=>{pa(xt,{class:"w-[520px] md:max-h-[60vh] h-full bg-background rounded-lg flex flex-col mb-2",children:(sr,Qr)=>{var Gr=BJ(),cn=ue(Gr),Yt=Ae(cn),un=Ae(Yt,!0);we(Yt);var nn=ve(Yt,2);An(nn,{variant:"ghost",onclick:()=>{history.back()},children:(Tn,Pn)=>{Kc(Tn,{})},$$slots:{default:!0}}),we(cn);var wn=ve(cn,2),jr=Ae(wn);EU(jr,{get itinerary(){return ri.state.selectedItinerary}}),we(wn),mt(()=>{pt(un,yt.journeyDetails),fi(wn,1,"p-2 md:p-4 overflow-y-auto overflow-x-hidden min-h-0 "+(S(I)?"md:max-h-[60vh]":""))}),Z(sr,Gr)},$$slots:{default:!0}})},$$slots:{default:!0}});var rn=ve(Rr,2);{var vn=xt=>{var Wt=zJ(),sr=ue(Wt);$2(sr,{get itinerary(){return ri.state.selectedItinerary},selected:!0,get level(){return S(V)},get theme(){return B}});var Qr=ve(sr,2);DJ(Qr,{get itinerary(){return ri.state.selectedItinerary},get theme(){return B}}),Z(xt,Wt)};Ze(rn,xt=>{S(I)&&xt(vn)})}Z($e,cr)};Ze(je,$e=>{S(v)!="isochrones"&&ri.state.selectedItinerary&&!ri.state.showDepartures&&$e(ht)})}var Rt=ve(je,2);{var gt=$e=>{_o($e,{class:"min-h-0 md:mb-2",children:(cr,Rr)=>{pa(cr,{class:"w-[520px] md:max-h-[60vh] h-full bg-background rounded-lg flex flex-col mb-2",children:(rn,vn)=>{var xt=VJ(),Wt=ue(xt),sr=Ae(Wt),Qr=Ae(sr);{var Gr=jr=>{var Tn=Br();mt(()=>pt(Tn,yt.arrivals)),Z(jr,Tn)},cn=jr=>{var Tn=Br();mt(()=>pt(Tn,yt.departures)),Z(jr,Tn)};Ze(Qr,jr=>{ri.state.stopArriveBy?jr(Gr):jr(cn,!1)})}var Yt=ve(Qr);we(sr);var un=ve(sr,2);An(un,{variant:"ghost",onclick:()=>{history.back()},children:(jr,Tn)=>{Kc(jr,{})},$$slots:{default:!0}}),we(Wt);var nn=ve(Wt,2),wn=Ae(nn);R8(wn,{get stopId(){return ri.state.selectedStop.stopId},get stopName(){return ri.state.selectedStop.name},get time(){return ri.state.selectedStop.time},get arriveBy(){return ri.state.stopArriveBy},get stop(){return S(Ye)},set stop(jr){pe(Ye,jr,!0)},get stopMarker(){return S(Ne)},set stopMarker(jr){pe(Ne,jr,!0)},get stopNameFromResponse(){return S(At)},set stopNameFromResponse(jr){pe(At,jr,!0)}}),we(nn),mt(()=>pt(Yt,` in
						${S(At)??""}`)),Z(rn,xt)},$$slots:{default:!0}})},$$slots:{default:!0}})};Ze(Rt,$e=>{S(v)!="isochrones"&&ri.state.selectedStop&&ri.state.showDepartures&&$e(gt)})}var Ut=ve(Rt,2);{var kt=$e=>{{let cr=me(()=>S(Y).status=="DONE"?"hide":"");_o($e,{get class(){return`min-h-0 md:mb-2 ${S(cr)??""}`},children:(Rr,rn)=>{pa(Rr,{class:"w-[520px] overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(vn,xt)=>{XK(vn,{get options(){return S(Y)}})},$$slots:{default:!0}})},$$slots:{default:!0}})}};Ze(Ut,$e=>{S(v)=="isochrones"&&S(tt).match&&$e(kt)})}Z(Xt,xr)},s=new URLSearchParams(window.location.search),l=!!s?.has("debug"),c=!!s?.has("dark"),a=!!s?.has("light"),g=window.innerWidth<768;let v=wt("connections"),w=wt(void 0),P=wt("none"),I=wt(!g),k,N,D=wt(void 0);kr(()=>{S(v)=="isochrones"&&pe(P,"none")});let B=(c?"dark":a?"light":void 0)??(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");B==="dark"&&document.documentElement.classList.add("dark");let U=wt([2.258882912876089,48.72559118651327]),V=wt(0),L=wt(15),$=wt(void 0),te=wt(void 0);const G=new qn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showAccuracyCircle:!1}),le=()=>{G.trigger()};ag(async()=>{Rk().then(Xt=>{Xt.response.headers.has("Link")&&pe(w,Xt.response.headers.get("Link").replace(/^<(.*)>; rel="license"$/,"$1"),!0);const xr=Xt.data;xr&&(pe(U,[xr.lon,xr.lat]),pe(L,xr.zoom,!0),pe(D,xr.serverConfig,!0))}),await p0(),se()});const se=()=>{if(s){const Xt=s.get("tripId");Xt!==null&&Lp(Xt,!0);const xr=s.get("stopId");if(xr!==null){const Lt=s.has("time")?new Date(s.get("time")):new Date;Ad("",xr,Lt,s.get("stopArriveBy")=="true",!0)}}};function oe(Xt,xr){if(Xt){const Lt=parseInt(Xt);return isNaN(Lt)?xr:Lt}else return xr}let be=wt(void 0),xe=wt(void 0),_e=wt(void 0),Ne=wt(void 0),fe=wt(tn(Um(s?.get("fromPlace"),s?.get("fromName")))),Le=wt(tn(Um(s?.get("toPlace"),s?.get("toName")))),tt=wt(tn(Um(s?.get("one"),s?.get("oneName")))),Ye=wt(void 0),rt=go("via"),it=wt(tn(s?.has("viaLabel0")?Array.from({length:rt.length}).reduce((Xt,xr,Lt)=>(Xt[`viaLabel${Lt}`]=s?.get(`viaLabel${Lt}`)??"",Xt),{}):{})),Ct=wt(tn(s?.has("via")?rt.map((Xt,xr)=>Um(Xt,S(it)[`viaLabel${xr}`])):void 0)),Mt=wt(tn(s?.has("via")?go("viaMinimumStay").map(Xt=>oe(Xt,0)):void 0)),jt=wt(tn(new Date(s?.get("time")||Date.now()))),Gt=s?.get("timetableView")!="false",Or=tn(s?.get("searchWindow")?parseInt(s.get("searchWindow")):hi.searchWindow),_r=tn(s?.get("numItineraries")?oe(s.get("numItineraries"),hi.numItineraries):hi.numItineraries),wr=tn(s?.get("maxItineraries")?oe(s.get("maxItineraries"),void 0):void 0),Dr=wt(s?.get("arriveBy")=="true"),Et=tn(s?.get("algorithm")??hi.algorithm),vt=wt(tn(s?.get("useRoutedTransfers")=="true"||hi.useRoutedTransfers)),Pr=wt(tn(s?.has("pedestrianProfile")?s.get("pedestrianProfile"):hi.pedestrianProfile)),yr=wt(s?.get("requireBikeTransport")=="true"),Ar=wt(s?.get("requireCarTransport")=="true"),br=wt(tn(go("transitModes",hi.transitModes))),lr=wt(tn(nb(go("preTransitModes",hi.preTransitModes),go("preTransitRentalFormFactors")))),ut=wt(tn(nb(go("postTransitModes",hi.postTransitModes),go("postTransitRentalFormFactors")))),Zt=wt(tn(nb(go("directModes",hi.directModes),go("directRentalFormFactors")))),dr=wt(tn(go("preTransitRentalProviderGroups"))),er=wt(tn(go("postTransitRentalProviderGroups"))),Bt=wt(tn(go("directRentalProviderGroups"))),mr=wt(tn(s?.get("elevationCosts")??"NONE")),Tr=wt(tn(oe(s?.get("maxTransfers"),hi.maxTransfers))),fr=me(()=>oe(s?.get("maxTravelTime"),Math.min(hi.maxTravelTime,60*(S(D)?.maxOneToAllTravelTimeLimit??1/0)))),nr=me(()=>oe(s?.get("maxPreTransitTime"),Math.min(hi.maxPreTransitTime,S(D)?.maxPrePostTransitTimeLimit??1/0))),rr=me(()=>oe(s?.get("maxPostTransitTime"),Math.min(hi.maxPostTransitTime,S(D)?.maxPrePostTransitTimeLimit??1/0))),Nr=me(()=>oe(s?.get("maxDirectTime"),Math.min(hi.maxDirectTime,S(D)?.maxDirectTimeLimit??1/0))),Cr=wt(s?.get("ignorePreTransitRentalReturnConstraints")=="true"),qr=wt(s?.get("ignorePostTransitRentalReturnConstraints")=="true"),ir=wt(s?.get("ignoreDirectRentalReturnConstraints")=="true"),or=s?.get("slowDirect")=="true",Re=wt(tn([])),Y=wt(tn({displayLevel:s?.get("isochronesDisplayLevel")??hi.isochronesDisplayLevel,color:s?.get("isochronesColor")??hi.isochronesColor,opacity:oe(s?.get("isochronesOpacity"),hi.isochronesOpacity),status:"DONE",error:void 0}));const ee=s?.get("isochronesCircleResolution")?oe(s.get("isochronesCircleResolution"),hi.circleResolution):hi.circleResolution,ie=Xt=>Xt.match?.type==="STOP"?Xt.match.id:Xt.match?.level?`${cc(Xt.match)},${Xt.match.level}`:`${cc(Xt.match)}`,Te=(Xt,xr)=>Xt.some(Lt=>Lt.startsWith("RENTAL_"))?Array.from(new Set(xr)):[];let Ce=me(()=>S(fe).match&&S(Le).match?{query:l6({time:S(jt).toISOString(),fromPlace:ie(S(fe)),toPlace:ie(S(Le)),arriveBy:S(Dr),timetableView:Gt,searchWindow:Or,numItineraries:_r,maxItineraries:wr,withFares:!0,slowDirect:or,fastestDirectFactor:1.5,pedestrianProfile:S(Pr),joinInterlinedLegs:!1,transitModes:S(br).length==U_.length?hi.transitModes:S(br),preTransitModes:Jf(S(lr)),postTransitModes:Jf(S(ut)),directModes:Jf(S(Zt)),preTransitRentalFormFactors:g_(S(lr)),postTransitRentalFormFactors:g_(S(ut)),directRentalFormFactors:g_(S(Zt)),preTransitRentalProviderGroups:Te(S(lr),S(dr)),postTransitRentalProviderGroups:Te(S(ut),S(er)),directRentalProviderGroups:Te(S(Zt),S(Bt)),requireBikeTransport:S(yr),requireCarTransport:S(Ar),elevationCosts:S(mr),useRoutedTransfers:S(vt),maxTransfers:S(Tr),maxMatchingDistance:S(Pr)=="WHEELCHAIR"?8:250,maxPreTransitTime:S(nr),maxPostTransitTime:S(rr),maxDirectTime:S(Nr),ignorePreTransitRentalReturnConstraints:S(Cr),ignorePostTransitRentalReturnConstraints:S(qr),ignoreDirectRentalReturnConstraints:S(ir),algorithm:Et,via:S(Ct)?S(Ct).map(Xt=>Xt.match?.id):void 0,viaMinimumStay:S(Mt)})}:void 0),Be=me(()=>S(tt)?.match?{query:{one:ie(S(tt)),maxTravelTime:Math.ceil(S(fr)/60),time:S(jt).toISOString(),transitModes:S(br),maxTransfers:S(Tr),arriveBy:S(Dr),useRoutedTransfers:S(vt),pedestrianProfile:S(Pr),requireBikeTransport:S(yr),requireCarTransport:S(Ar),preTransitModes:Jf(S(lr)),postTransitModes:Jf(S(ut)),maxPreTransitTime:S(nr),maxPostTransitTime:S(rr),elevationCosts:S(mr),maxMatchingDistance:S(Pr)=="WHEELCHAIR"?8:250,ignorePreTransitRentalReturnConstraints:S(Cr),ignorePostTransitRentalReturnConstraints:S(qr)}}:void 0),Ge,Ve=wt(void 0),nt=wt(tn([])),At=wt("");kr(()=>{S(Ce)&&S(v)=="connections"&&(clearTimeout(Ge),Ge=setTimeout(()=>{const Xt=rx(S(Ce)).then(QT(S(fe),S(Le))),xr=S(Ce).query;pe(Ve,Xt,!0),pe(nt,[Xt],!0),M_({...xr,...xr.fromPlace==S(fe).label?{}:{fromName:S(fe).label},...xr.toPlace==S(Le).label?{}:{toName:S(Le).label},...S(it)},{},!0)},400))});let bt;kr(()=>{if(S(Be)&&S(v)=="isochrones"){const[Xt,xr,Lt]=[S(Y).color,S(Y).opacity,S(Y).displayLevel];N!=S(Be)&&(N=S(Be),clearTimeout(bt),S(Y).status="WORKING",S(Y).error=void 0,bt=setTimeout(()=>{Ck(S(Be)).then(gr=>{if(gr.error){const je=gr.error.error;throw new Error(String(je))}const Lr=gr.data.all.map(je=>({lat:je.place?.lat,lng:je.place?.lon,seconds:S(fr)-60*(je.duration??0),name:je.place?.name}));pe(Re,[...Lr],!0),S(Y).status=S(Re).length==0?"EMPTY":"WORKING"}).catch(gr=>{S(Y).status="FAILED",S(Y).error=gr.message})},60)),Ms(()=>{const gr=S(Be).query;M_({...gr,...gr.one==S(tt).label?{}:{oneName:S(tt).label},maxTravelTime:gr.maxTravelTime*60,isochronesColor:Xt,isochronesOpacity:xr,isochronesDisplayLevel:Lt,...ee&&ee>2?{isochronesCircleResolution:ee}:{}},{},!0)})}}),addEventListener("paste",Xt=>{const xr=Xt.clipboardData.getData("text"),Lt=JSON.parse(xr);console.log("paste: ",Lt);const gr=new Promise((Lr,je)=>{Lr(Lt)});pe(Ve,gr,!0),pe(nt,[gr],!0)});const ur=(Xt,xr)=>{const Lt=qn.LngLat.convert(Xt[0].legs[0].from),gr=new qn.LngLatBounds(Lt,Lt);Xt.forEach(je=>{je.legs.forEach(ht=>{gr.extend(ht.from),gr.extend(ht.to),ht.intermediateStops?.forEach(Rt=>{gr.extend(Rt)})})});const Lr={top:96,right:96,bottom:g?window.innerHeight*.3:96,left:g?96:640};xr.flyTo({...xr.cameraForBounds(gr,{padding:Lr})})},Xe=()=>{k!==ri.state.selectedItinerary&&(ri.state.selectedItinerary&&S(te)&&ur([ri.state.selectedItinerary],S(te)),k=ri.state.selectedItinerary)};kr(()=>{S(te)&&S(te).addControl(G)}),kr(Xe),kr(()=>{Promise.all(S(nt)).then(Xt=>{S(te)&&ur(Xt.flatMap(xr=>xr.itineraries),S(te))})});{let Xt=me(()=>_n("h-dvh overflow-clip",B)),xr=me(()=>S(I)&&wE?TD(B,S(V),window.location.origin+window.location.pathname,nx.getConfig().baseUrl?nx.getConfig().baseUrl+"/":window.location.origin+window.location.pathname):void 0);ID(r,{get class(){return S(Xt)},get style(){return S(xr)},attribution:!1,get map(){return S(te)},set map(Lt){pe(te,Lt,!0)},get bounds(){return S($)},set bounds(Lt){pe($,Lt,!0)},get zoom(){return S(L)},set zoom(Lt){pe(L,Lt,!0)},get center(){return S(U)},set center(Lt){pe(U,Lt)},children:(Lt,gr)=>{var Lr=qJ(),je=ue(Lr);{var ht=Wt=>{_o(Wt,{position:"top-right",class:"text-right",children:(sr,Qr)=>{g8(sr,{get bounds(){return S($)},get level(){return S(V)},get zoom(){return S(L)}})},$$slots:{default:!0}})};Ze(je,Wt=>{l&&Wt(ht)})}var Rt=ve(je,2);_8(Rt,{get bounds(){return S($)},get zoom(){return S(L)},get level(){return S(V)},set level(Wt){pe(V,Wt,!0)}});var gt=ve(Rt,2);{var Ut=Wt=>{var sr=We(),Qr=ue(sr);{var Gr=Yt=>{v8(Yt,{class:"relative z-10 h-full mt-5 flex flex-col",get showMap(){return S(I)},set showMap(un){pe(I,un,!0)},children:(un,nn)=>{n(un)},$$slots:{default:!0}})},cn=Yt=>{var un=WJ(),nn=Ae(un);n(nn),we(un),Z(Yt,un)};Ze(Qr,Yt=>{g?Yt(Gr):Yt(cn,!1)})}Z(Wt,sr)};Ze(gt,Wt=>{Wt(Ut)})}var kt=ve(gt,2),$e=Ae(kt),cr=Ae($e),Rr=ve(Ae(cr),3);{var rn=Wt=>{var sr=$J(),Qr=ve(ue(sr)),Gr=Ae(Qr,!0);we(Qr),mt(()=>{Fn(Qr,"href",S(w)),pt(Gr,yt.timetableSources)}),Z(Wt,sr)};Ze(Rr,Wt=>{S(w)&&Wt(rn)})}we(cr),we($e),we(kt);var vn=ve(kt,2);{var xt=Wt=>{var sr=XJ(),Qr=ue(sr);{var Gr=bn=>{var fn=ZJ(),Mi=ue(fn);_o(Mi,{position:"top-right",class:"pb-4 text-right",children:(gi,zd)=>{var ll=HJ(),dc=ue(ll);An(dc,{size:"icon",onclick:()=>{pe(P,(function(){switch(S(P)){case"rt":return"route";case"route":return"mode";case"mode":return"none";case"none":return"rt"}})(),!0)},children:(cl,Ud)=>{var Eu=We(),Vd=ue(Eu);{var Pu=io=>{vD(io,{class:"h-[1.2rem] w-[1.2rem]"})},Iu=io=>{var Ca=We(),Go=ue(Ca);{var fc=ks=>{bD(ks,{class:"h-[1.2rem] w-[1.2rem]"})},pc=ks=>{var Yo=We(),ul=ue(Yo);{var Cu=so=>{aD(so,{class:"h-[1.2rem] w-[1.2rem]"})},Io=so=>{_D(so,{class:"h-[1.2rem] w-[1.2rem]"})};Ze(ul,so=>{S(P)=="none"?so(Cu):so(Io,!1)},!0)}Z(ks,Yo)};Ze(Go,ks=>{S(P)=="mode"?ks(fc):ks(pc,!1)},!0)}Z(io,Ca)};Ze(Vd,io=>{S(P)=="rt"?io(Pu):io(Iu,!1)})}Z(cl,Eu)},$$slots:{default:!0}});var Po=ve(dc,2);An(Po,{size:"icon",onclick:()=>le(),children:(cl,Ud)=>{x0(cl,{class:"w-5 h-5"})},$$slots:{default:!0}}),Z(gi,ll)},$$slots:{default:!0}});var ls=ve(Mi,2);MJ(ls,{get map(){return S(te)},get bounds(){return S($)},get zoom(){return S(L)},get theme(){return B},get debug(){return l}}),Z(bn,fn)};Ze(Qr,bn=>{S(v)!="isochrones"&&bn(Gr)})}var cn=ve(Qr,2);LK(cn,{get map(){return S(te)},get bounds(){return S($)},get zoom(){return S(L)},get colorMode(){return S(P)}});var Yt=ve(cn,2);{let bn=me(()=>S(Dr)?S(lr):S(ut)),fn=me(()=>S(Pr)==="WHEELCHAIR"),Mi=me(()=>S(Dr)?S(nr):S(rr)),ls=me(()=>S(v)=="isochrones");$K(Yt,{get map(){return S(te)},get bounds(){return S($)},get isochronesData(){return S(Re)},get streetModes(){return S(bn)},get wheelchair(){return S(fn)},get maxAllTime(){return S(Mi)},get circleResolution(){return ee},get active(){return S(ls)},get options(){return S(Y)},set options(gi){pe(Y,gi,!0)}})}var un=ve(Yt,2);Gl(un,{trigger:"contextmenu",get children(){return t}});var nn=ve(un,2);{var wn=bn=>{Yh(bn,{color:"green",draggable:!0,get level(){return S(V)},get location(){return S(fe)},set location(fn){pe(fe,fn,!0)},get marker(){return S(be)},set marker(fn){pe(be,fn,!0)}})};Ze(nn,bn=>{S(fe)&&S(v)=="connections"&&bn(wn)})}var jr=ve(nn,2);{var Tn=bn=>{Yh(bn,{color:"black",draggable:!1,get level(){return S(V)},get location(){return S(Ye)},set location(fn){pe(Ye,fn,!0)},get marker(){return S(Ne)},set marker(fn){pe(Ne,fn,!0)}})};Ze(jr,bn=>{S(Ye)&&ri.state.showDepartures&&S(v)!="isochrones"&&bn(Tn)})}var Pn=ve(jr,2);{var dn=bn=>{Yh(bn,{color:"red",draggable:!0,get level(){return S(V)},get location(){return S(Le)},set location(fn){pe(Le,fn,!0)},get marker(){return S(xe)},set marker(fn){pe(xe,fn,!0)}})};Ze(Pn,bn=>{S(Le)&&S(v)=="connections"&&bn(dn)})}var It=ve(Pn,2);{var Hr=bn=>{Yh(bn,{color:"yellow",draggable:!0,get level(){return S(V)},get location(){return S(tt)},set location(fn){pe(tt,fn,!0)},get marker(){return S(_e)},set marker(fn){pe(_e,fn,!0)}})};Ze(It,bn=>{S(tt)&&S(v)=="isochrones"&&bn(Hr)})}Z(Wt,sr)};Ze(vn,Wt=>{S(I)&&Wt(xt)})}mt(()=>fi(kt,1,`maplibregl-ctrl-${g?"top-left":"bottom-right"}`)),Z(Lt,Lr)},$$slots:{default:!0}})}St()}export{lee as component};
