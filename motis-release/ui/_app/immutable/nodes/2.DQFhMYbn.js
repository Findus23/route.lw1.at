var qk=Object.defineProperty;var Xk=Object.getPrototypeOf;var Zk=Reflect.get;var N2=r=>{throw TypeError(r)};var Yk=(r,e,t)=>e in r?qk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Z=(r,e,t)=>Yk(r,typeof e!="symbol"?e+"":e,t),Tx=(r,e,t)=>e.has(r)||N2("Cannot "+t);var se=(r,e,t)=>(Tx(r,e,"read from private field"),t?t.call(r):e.get(r)),ut=(r,e,t)=>e.has(r)?N2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Yi=(r,e,t,n)=>(Tx(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Nn=(r,e,t)=>(Tx(r,e,"access private method"),t);var F2=(r,e,t)=>Zk(Xk(r),t,e);import{b as Kk,d as VE,a as K,c as it,f as Ve,t as jr}from"../chunks/BtcFtqN6.js";import{a as oc,o as Dm}from"../chunks/CFM_wEQR.js";import{ab as jE,ap as HE,aq as Gk,h as Vn,i as dp,ar as Mw,C as hd,as as B2,F as WE,G as S0,B as Eh,I as Ya,U as A0,at as Qf,Y as zo,V as E0,K as da,O as $E,A as Uo,a8 as L2,a7 as z2,au as U2,b as Jk,J as Ih,L as Ch,al as Qk,av as eM,aw as tM,w as qE,v as XE,n as A,a2 as Gs,D as rM,af as nM,ax as ZE,ay as Sx,aj as YE,y as I0,az as Ow,aA as iM,aB as Dw,aC as sM,ai as oM,aD as aM,aE as $v,aF as lM,ad as cM,E as KE,aG as Cr,aH as uM,M as GE,e as fo,aI as hM,aJ as dM,aK as fM,aL as pM,aM as gM,N as JE,R as ve,aN as mM,an as Nw,p as zt,c as Be,s as we,r as ke,t as ct,a as Ut,f as xe,Q as yn,aO as qv,u as Xr,aP as Ja,am as Pt,ao as Re,j as QE,aQ as _M,aR as yM,aS as vM,aT as sn}from"../chunks/CAZyC0ep.js";import{i as bM,a as xM,c as wM,d as pc,b as TM,n as SM,e as AM,f as EM,l as IM,o as ui,m as hy,u as dy,s as vt}from"../chunks/BVVj_ZVU.js";import{l as ni,p as fe,s as cn,i as et,b as Cs,r as an,c as Tr}from"../chunks/B_TFzQrb.js";import{r as eI,a as tI}from"../chunks/C3fWOZva.js";import{i as Nm,p as ti}from"../chunks/DDNbffzy.js";import{s as fi,t as CM,g as PM,p as Fw,c as rI,a as RM,l as kM,b as Bw,d as MM,r as OM,i as DM,o as NM}from"../chunks/BfvJYAi7.js";import"../chunks/Scvt0bU2.js";function FM(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const l=Object.getOwnPropertyDescriptor(n,i);l&&Object.defineProperty(r,i,l.get?l:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}const BM=!0,LM=[];function Ks(r,e=!1){return fy(r,new Map,"",LM)}function fy(r,e,t,n,i=null){if(typeof r=="object"&&r!==null){var l=e.get(r);if(l!==void 0)return l;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(jE(r)){var u=Array(r.length);e.set(r,u),i!==null&&e.set(i,u);for(var a=0;a<r.length;a+=1){var p=r[a];a in r&&(u[a]=fy(p,e,t,n))}return u}if(HE(r)===Gk){u={},e.set(r,u),i!==null&&e.set(i,u);for(var y in r)u[y]=fy(r[y],e,t,n);return u}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function")return fy(r.toJSON(),e,t,n,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}const Ax=0,$_=1,Ex=2;function Xl(r,e,t,n,i){Vn&&dp();var l=r,u=Mw(),a=Jk,p=A0,y,x,T,E=(u?zo:E0)(void 0),k=(u?zo:E0)(void 0),F=!1;function D(B,V){F=!0,V&&(L2(N),z2(N),U2(a));try{B===Ax&&t&&(y?Ih(y):y=da(()=>t(l))),B===$_&&n&&(x?Ih(x):x=da(()=>n(l,E))),B===Ex&&i&&(T?Ih(T):T=da(()=>i(l,k))),B!==Ax&&y&&Ch(y,()=>y=null),B!==$_&&x&&Ch(x,()=>x=null),B!==Ex&&T&&Ch(T,()=>T=null)}finally{V&&(U2(null),z2(null),L2(null),Qk())}}var N=hd(()=>{if(p===(p=e()))return;let B=Vn&&B2(p)===(l.data===WE);if(B&&(l=S0(),Eh(l),Ya(!1),B=!0),B2(p)){var V=p;F=!1,V.then(U=>{V===p&&(Qf(E,U),D($_,!0))},U=>{if(V===p&&(Qf(k,U),D(Ex,!0),!i))throw k.v}),Vn?t&&(y=da(()=>t(l))):$E(()=>{F||D(Ax,!0)})}else Qf(E,p),D($_,!1);return B&&Ya(!0),()=>p=A0});Vn&&(l=Uo)}function zM(r,e,t){Vn&&dp();var n=r,i=A0,l,u=Mw()?eM:tM;hd(()=>{u(i,i=e())&&(l&&Ch(l),l=da(()=>t(n)))}),Vn&&(n=Uo)}function Hi(r,e){return e}function UM(r,e,t,n){for(var i=[],l=e.length,u=0;u<l;u++)sM(e[u].e,i,!0);var a=l>0&&i.length===0&&t!==null;if(a){var p=t.parentNode;oM(p),p.append(t),n.clear(),Wl(r,e[0].prev,e[l-1].next)}aM(i,()=>{for(var y=0;y<l;y++){var x=e[y];a||(n.delete(x.k),Wl(r,x.prev,x.next)),$v(x.e,!a)}})}function jn(r,e,t,n,i,l=null){var u=r,a={flags:e,items:new Map,first:null},p=(e&ZE)!==0;if(p){var y=r;u=Vn?Eh(qE(y)):y.appendChild(XE())}Vn&&dp();var x=null,T=!1,E=Gs(()=>{var k=t();return jE(k)?k:k==null?[]:YE(k)});hd(()=>{var k=A(E),F=k.length;if(T&&F===0)return;T=F===0;let D=!1;if(Vn){var N=rM(u)===WE;N!==(F===0)&&(u=S0(),Eh(u),Ya(!1),D=!0)}if(Vn){for(var B=null,V,U=0;U<F;U++){if(Uo.nodeType===8&&Uo.data===nM){u=Uo,D=!0,Ya(!1);break}var j=k[U],J=n(j,U);V=nI(Uo,a,B,null,j,J,U,i,e,t),a.items.set(J,V),B=V}F>0&&Eh(S0())}Vn||VM(k,a,u,i,e,n,t),l!==null&&(F===0?x?Ih(x):x=da(()=>l(u)):x!==null&&Ch(x,()=>{x=null})),D&&Ya(!0),A(E)}),Vn&&(u=Uo)}function VM(r,e,t,n,i,l,u){var Ne,ot,At,Qe;var a=(i&iM)!==0,p=(i&(Dw|Ow))!==0,y=r.length,x=e.items,T=e.first,E=T,k,F=null,D,N=[],B=[],V,U,j,J;if(a)for(J=0;J<y;J+=1)V=r[J],U=l(V,J),j=x.get(U),j!==void 0&&((Ne=j.a)==null||Ne.measure(),(D??(D=new Set)).add(j));for(J=0;J<y;J+=1){if(V=r[J],U=l(V,J),j=x.get(U),j===void 0){var oe=E?E.e.nodes_start:t;F=nI(oe,e,F,F===null?e.first:F.next,V,U,J,n,i,u),x.set(U,F),N=[],B=[],E=F.next;continue}if(p&&jM(j,V,J,i),j.e.f&Sx&&(Ih(j.e),a&&((ot=j.a)==null||ot.unfix(),(D??(D=new Set)).delete(j))),j!==E){if(k!==void 0&&k.has(j)){if(N.length<B.length){var le=B[0],Ce;F=le.prev;var Ie=N[0],Ue=N[N.length-1];for(Ce=0;Ce<N.length;Ce+=1)V2(N[Ce],le,t);for(Ce=0;Ce<B.length;Ce+=1)k.delete(B[Ce]);Wl(e,Ie.prev,Ue.next),Wl(e,F,Ie),Wl(e,Ue,le),E=le,F=Ue,J-=1,N=[],B=[]}else k.delete(j),V2(j,E,t),Wl(e,j.prev,j.next),Wl(e,j,F===null?e.first:F.next),Wl(e,F,j),F=j;continue}for(N=[],B=[];E!==null&&E.k!==U;)E.e.f&Sx||(k??(k=new Set)).add(E),B.push(E),E=E.next;if(E===null)continue;j=E}N.push(j),F=j,E=j.next}if(E!==null||k!==void 0){for(var De=k===void 0?[]:YE(k);E!==null;)E.e.f&Sx||De.push(E),E=E.next;var pe=De.length;if(pe>0){var ze=i&ZE&&y===0?t:null;if(a){for(J=0;J<pe;J+=1)(At=De[J].a)==null||At.measure();for(J=0;J<pe;J+=1)(Qe=De[J].a)==null||Qe.fix()}UM(e,De,ze,x)}}a&&$E(()=>{var pt;if(D!==void 0)for(j of D)(pt=j.a)==null||pt.apply()}),I0.first=e.first&&e.first.e,I0.last=F&&F.e}function jM(r,e,t,n){n&Dw&&Qf(r.v,e),n&Ow?Qf(r.i,t):r.i=t}function nI(r,e,t,n,i,l,u,a,p,y){var x=(p&Dw)!==0,T=(p&lM)===0,E=x?T?E0(i):zo(i):i,k=p&Ow?zo(u):u,F={i:k,v:E,k:l,a:null,e:null,prev:t,next:n};try{return F.e=da(()=>a(r,E,k,y),Vn),F.e.prev=t&&t.e,F.e.next=n&&n.e,t===null?e.first=F:(t.next=F,t.e.next=F.e),n!==null&&(n.prev=F,n.e.prev=F.e),F}finally{}}function V2(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==n;){var u=cM(l);i.before(l),l=u}}function Wl(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function fr(r,e,...t){var n=r,i=Cr,l;hd(()=>{i!==(i=e())&&(l&&($v(l),l=null),l=da(()=>i(n,...t)))},KE),Vn&&(n=Uo)}function HM(r,e,t,n,i,l){let u=Vn;Vn&&dp();var a,p,y=null;Vn&&Uo.nodeType===1&&(y=Uo,dp());var x=Vn?Uo:r,T;hd(()=>{const E=e()||null;var k=uM;E!==a&&(T&&(E===null?Ch(T,()=>{T=null,p=null}):E===p?Ih(T):$v(T)),E&&E!==p&&(T=da(()=>{if(y=Vn?y:document.createElementNS(k,E),Kk(y,y),n){Vn&&bM(E)&&y.append(document.createComment(""));var F=Vn?qE(y):y.appendChild(XE());Vn&&(F===null?Ya(!1):Eh(F)),n(y,F)}I0.nodes_end=y,x.before(y)})),a=E,a&&(p=a))},KE),u&&(Ya(!0),Eh(x))}function WM(r,e,t){GE(()=>{var n=fo(()=>e(r,t==null?void 0:t())||{});if(n!=null&&n.destroy)return()=>n.destroy()})}function $M(r,e){var t=void 0,n;hd(()=>{t!==(t=e())&&(n&&($v(n),n=null),t&&(n=da(()=>{GE(()=>t(r))})))})}function iI(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var i=r.length;for(e=0;e<i;e++)r[e]&&(t=iI(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function ep(){for(var r,e,t=0,n="",i=arguments.length;t<i;t++)(r=arguments[t])&&(e=iI(r))&&(n&&(n+=" "),n+=e);return n}function rl(r){return typeof r=="object"?ep(r):r??""}const j2=[...` 	
\r\fÂ \v\uFEFF`];function qM(r,e,t){var n=r==null?"":""+r;if(e&&(n=n?n+" "+e:e),t){for(var i in t)if(t[i])n=n?n+" "+i:i;else if(n.length)for(var l=i.length,u=0;(u=n.indexOf(i,u))>=0;){var a=u+l;(u===0||j2.includes(n[u-1]))&&(a===n.length||j2.includes(n[a]))?n=(u===0?"":n.substring(0,u))+n.substring(a+1):u=a}}return n===""?null:n}function H2(r,e=!1){var t=e?" !important;":";",n="";for(var i in r){var l=r[i];l!=null&&l!==""&&(n+=" "+i+": "+l+t)}return n}function Ix(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function XM(r,e){if(e){var t="",n,i;if(Array.isArray(e)?(n=e[0],i=e[1]):n=e,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var l=!1,u=0,a=!1,p=[];n&&p.push(...Object.keys(n).map(Ix)),i&&p.push(...Object.keys(i).map(Ix));var y=0,x=-1;const D=r.length;for(var T=0;T<D;T++){var E=r[T];if(a?E==="/"&&r[T-1]==="*"&&(a=!1):l?l===E&&(l=!1):E==="/"&&r[T+1]==="*"?a=!0:E==='"'||E==="'"?l=E:E==="("?u++:E===")"&&u--,!a&&l===!1&&u===0){if(E===":"&&x===-1)x=T;else if(E===";"||T===D-1){if(x!==-1){var k=Ix(r.substring(y,x).trim());if(!p.includes(k)){E!==";"&&T++;var F=r.substring(y,T).trim();t+=" "+F+";"}}y=T+1,x=-1}}}}return n&&(t+=H2(n)),i&&(t+=H2(i,!0)),t=t.trim(),t===""?null:t}return r==null?null:String(r)}function Di(r,e,t,n,i,l){var u=r.__className;if(Vn||u!==t||u===void 0){var a=qM(t,n,l);(!Vn||a!==r.getAttribute("class"))&&(a==null?r.removeAttribute("class"):e?r.className=a:r.setAttribute("class",a)),r.__className=t}else if(l&&i!==l)for(var p in l){var y=!!l[p];(i==null||y!==!!i[p])&&r.classList.toggle(p,y)}return l}function Cx(r,e={},t,n){for(var i in t){var l=t[i];e[i]!==l&&(t[i]==null?r.style.removeProperty(i):r.style.setProperty(i,l,n))}}function rc(r,e,t,n){var i=r.__style;if(Vn||i!==e){var l=XM(e,n);(!Vn||l!==r.getAttribute("style"))&&(l==null?r.removeAttribute("style"):r.style.cssText=l),r.__style=e}else n&&(Array.isArray(n)?(Cx(r,t==null?void 0:t[0],n[0]),Cx(r,t==null?void 0:t[1],n[1],"important")):Cx(r,t,n));return n}const Cf=Symbol("class"),Pf=Symbol("style"),sI=Symbol("is custom element"),oI=Symbol("is html");function Ay(r){if(Vn){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var n=r.value;ls(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var i=r.checked;ls(r,"checked",null),r.checked=i}}};r.__on_r=t,pM(t),AM()}}function ZM(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function ls(r,e,t,n){var i=aI(r);Vn&&(i[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="loading"&&(r[dM]=t),t==null?r.removeAttribute(e):typeof t!="string"&&lI(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Xv(r,e,t){r.setAttributeNS("http://www.w3.org/1999/xlink",e,t)}function Tn(r,e,t,n,i=!1){var l=aI(r),u=l[sI],a=!l[oI];let p=Vn&&u;p&&Ya(!1);var y=e||{},x=r.tagName==="OPTION";for(var T in e)T in t||(t[T]=null);t.class?t.class=rl(t.class):t[Cf]&&(t.class=null),t[Pf]&&(t.style??(t.style=null));var E=lI(r);for(const U in t){let j=t[U];if(x&&U==="value"&&j==null){r.value=r.__value="",y[U]=j;continue}if(U==="class"){var k=r.namespaceURI==="http://www.w3.org/1999/xhtml";Di(r,k,j,n,e==null?void 0:e[Cf],t[Cf]),y[U]=j,y[Cf]=t[Cf];continue}if(U==="style"){rc(r,j,e==null?void 0:e[Pf],t[Pf]),y[U]=j,y[Pf]=t[Pf];continue}var F=y[U];if(j!==F){y[U]=j;var D=U[0]+U[1];if(D!=="$$")if(D==="on"){const J={},oe="$$"+U;let le=U.slice(2);var N=EM(le);if(xM(le)&&(le=le.slice(0,-7),J.capture=!0),!N&&F){if(j!=null)continue;r.removeEventListener(le,y[oe],J),y[oe]=null}if(j!=null)if(N)r[`__${le}`]=j,pc([le]);else{let Ce=function(Ie){y[U].call(this,Ie)};y[oe]=wM(le,r,Ce,J)}else N&&(r[`__${le}`]=void 0)}else if(U==="style")ls(r,U,j);else if(U==="autofocus")TM(r,!!j);else if(!u&&(U==="__value"||U==="value"&&j!=null))r.value=r.__value=j;else if(U==="selected"&&x)ZM(r,j);else{var B=U;a||(B=SM(B));var V=B==="defaultValue"||B==="defaultChecked";if(j==null&&!u&&!V)if(l[U]=null,B==="value"||B==="checked"){let J=r;const oe=e===void 0;if(B==="value"){let le=J.defaultValue;J.removeAttribute(B),J.defaultValue=le,J.value=J.__value=oe?le:null}else{let le=J.defaultChecked;J.removeAttribute(B),J.defaultChecked=le,J.checked=oe?le:!1}}else r.removeAttribute(U);else V||E.includes(B)&&(u||typeof j!="string")?r[B]=j:typeof j!="function"&&ls(r,B,j)}}}p&&Ya(!0);for(let U of Object.getOwnPropertySymbols(t))U.description===hM&&$M(r,()=>t[U]);return y}function aI(r){return r.__attributes??(r.__attributes={[sI]:r.nodeName.includes("-"),[oI]:r.namespaceURI===fM})}var W2=new Map;function lI(r){var e=W2.get(r.nodeName);if(e)return e;W2.set(r.nodeName,e=[]);for(var t,n=r,i=Element.prototype;i!==n;){t=gM(n);for(var l in t)t[l].set&&e.push(l);n=HE(n)}return e}function cI(r,e,t=e){var n=Mw();IM(r,"input",i=>{var l=i?r.defaultValue:r.value;if(l=Px(r)?Rx(l):l,t(l),n&&l!==(l=e())){var u=r.selectionStart,a=r.selectionEnd;r.value=l??"",a!==null&&(r.selectionStart=u,r.selectionEnd=Math.min(a,r.value.length))}}),(Vn&&r.defaultValue!==r.value||fo(e)==null&&r.value)&&t(Px(r)?Rx(r.value):r.value),JE(()=>{var i=e();Px(r)&&i===Rx(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function Px(r){var e=r.type;return e==="number"||e==="range"}function Rx(r){return r===""?null:+r}function ph(r){ve(r,r.v+1)}function YM(r){let e=0,t=zo(0),n;return()=>{mM()&&(A(t),JE(()=>(e===0&&(n=fo(()=>r(()=>ph(t)))),e+=1,()=>{Nw().then(()=>{e-=1,e===0&&(n==null||n(),n=void 0)})})))}}const KM=BM;/**
 * @license lucide-svelte v0.460.1 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var JM=VE("<svg><!><!></svg>");function Ri(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]),n=ni(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);zt(e,!1);let i=fe(e,"name",8,void 0),l=fe(e,"color",8,"currentColor"),u=fe(e,"size",8,24),a=fe(e,"strokeWidth",8,2),p=fe(e,"absoluteStrokeWidth",8,!1),y=fe(e,"iconNode",24,()=>[]);const x=(...D)=>D.filter((N,B,V)=>!!N&&V.indexOf(N)===B).join(" ");Nm();var T=JM();let E;var k=Be(T);jn(k,1,y,Hi,(D,N)=>{let B=()=>A(N)[0],V=()=>A(N)[1];var U=it(),j=xe(U);HM(j,B,!0,(J,oe)=>{let le;ct(()=>le=Tn(J,le,{...V()}))}),K(D,U)});var F=we(k);fi(F,e,"default",{}),ke(T),ct((D,N)=>E=Tn(T,E,{...GM,...n,width:u(),height:u(),stroke:l(),"stroke-width":D,class:N}),[()=>p()?Number(a())*24/Number(u()):a(),()=>x("lucide-icon","lucide",i()?`lucide-${i()}`:"",t.class)],Gs),K(r,T),Ut()}function tp(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"x"},()=>t,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function QM(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"palette"},()=>t,{iconNode:[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function eO(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"rss"},()=>t,{iconNode:[["path",{d:"M4 11a9 9 0 0 1 9 9"}],["path",{d:"M4 4a16 16 0 0 1 16 16"}],["circle",{cx:"5",cy:"19",r:"1"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function tO(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"ban"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m4.9 4.9 14.2 14.2"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function Lw(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"locate-fixed"},()=>t,{iconNode:[["line",{x1:"2",x2:"5",y1:"12",y2:"12"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}],["circle",{cx:"12",cy:"12",r:"7"}],["circle",{cx:"12",cy:"12",r:"3"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}const rO={light:{background:"#f8f4f0",water:"#99ddff",rail:"#a8a8a8",pedestrian:"#e8e7eb",sport:"#d0f4be",sportOutline:"#b3e998",building:"#ded7d3",buildingOutline:"#cfc8c4",landuseComplex:"#f0e6d1",landuseCommercial:"hsla(0, 60%, 87%, 0.23)",landuseIndustrial:"#e0e2eb",landuseResidential:"#ece7e4",landuseRetail:"hsla(0, 60%, 87%, 0.23)",landuseConstruction:"#aaa69d",landusePark:"#b8ebad",landuseNatureLight:"#ddecd7",landuseNatureHeavy:"#a3e39c",landuseCemetery:"#e0e4dd",landuseBeach:"#fffcd3",indoorCorridor:"#fdfcfa",indoor:"#d4edff",indoorOutline:"#808080",indoorText:"#333333",publicTransport:"rgba(218,140,140,0.3)",footway:"#fff",steps:"#ff4524",elevatorOutline:"#808080",elevator:"#bcf1ba",roadBackResidential:"#ffffff",roadBackNonResidential:"#ffffff",motorway:"#ffb366",motorwayLink:"#f7e06e",primarySecondary:"#fffbf8",linkTertiary:"#ffffff",residential:"#ffffff",road:"#ffffff",townText:"#333333",townTextHalo:"white",text:"#333333",textHalo:"white",citiesText:"#111111",citiesTextHalo:"white",shield:"shield"},dark:{background:"#292929",water:"#1f2830",rail:"#808080",pedestrian:"#292929",sport:"#272525",sportOutline:"#272525",building:"#1F1F1F",buildingOutline:"#1A1A1A",landuseComplex:"#292929",landuseCommercial:"#292929",landuseIndustrial:"#353538",landuseResidential:"#292929",landuseRetail:"#292929",landuseConstruction:"red",landusePark:"#18221f",landuseNatureLight:"#1e2322",landuseNatureHeavy:"#1a2020",landuseCemetery:"#202423",landuseBeach:"#4c4b3e",indoorCorridor:"#494949",indoor:"#1a1a1a",indoorOutline:"#0d0d0d",indoorText:"#eeeeee",publicTransport:"rgba(89, 45, 45, 0.405)",footway:"#3D3D3D",steps:"#70504b",elevatorOutline:"#808080",elevator:"#3b423b",roadBackResidential:"#414141",roadBackNonResidential:"#414141",motorway:"#414141",motorwayLink:"#414141",primarySecondary:"#414141",linkTertiary:"#414141",residential:"#414141",road:"#414141",text:"#9a9a9a",textHalo:"#151515",townText:"#bebebe",townTextHalo:"#1A1A1A",citiesText:"#bebebe",citiesTextHalo:"#1A1A1A",shield:"shield-dark"}},nO=(r,e)=>{const t=rO[r];return{version:8,sources:{osm:{type:"vector",tiles:["/{z}/{x}/{y}.mvt"],maxzoom:20,attribution:""}},glyphs:"/glyphs/{fontstack}/{range}.pbf",sprite:"/sprite",layers:[{id:"background",type:"background",paint:{"background-color":t.background}},{id:"coastline",type:"fill",source:"osm","source-layer":"coastline",paint:{"fill-color":t.water}},{id:"landuse_park",type:"fill",source:"osm","source-layer":"landuse",filter:["==",["get","landuse"],"park"],paint:{"fill-color":t.landusePark}},{id:"landuse",type:"fill",source:"osm","source-layer":"landuse",filter:["!in","landuse","park","public_transport"],paint:{"fill-color":["match",["get","landuse"],"complex",t.landuseComplex,"commercial",t.landuseCommercial,"industrial",t.landuseIndustrial,"residential",t.landuseResidential,"retail",t.landuseRetail,"construction",t.landuseConstruction,"nature_light",t.landuseNatureLight,"nature_heavy",t.landuseNatureHeavy,"cemetery",t.landuseCemetery,"beach",t.landuseBeach,"magenta"]}},{id:"water",type:"fill",source:"osm","source-layer":"water",paint:{"fill-color":t.water}},{id:"sport",type:"fill",source:"osm","source-layer":"sport",paint:{"fill-color":t.sport,"fill-outline-color":t.sportOutline}},{id:"pedestrian",type:"fill",source:"osm","source-layer":"pedestrian",paint:{"fill-color":t.pedestrian}},{id:"waterway",type:"line",source:"osm","source-layer":"waterway",paint:{"line-color":t.water}},{id:"building",type:"fill",source:"osm","source-layer":"building",paint:{"fill-color":t.building,"fill-outline-color":t.buildingOutline,"fill-opacity":["interpolate",["linear"],["zoom"],14,0,16,.8]}},{id:"indoor-corridor",type:"fill",source:"osm","source-layer":"indoor",filter:["all",["==","indoor","corridor"],["==","level",e]],paint:{"fill-color":t.indoorCorridor,"fill-opacity":.8}},{id:"indoor",type:"fill",source:"osm","source-layer":"indoor",filter:["all",["!in","indoor","corridor","wall","elevator"],["==","level",e]],paint:{"fill-color":t.indoor,"fill-opacity":.8}},{id:"indoor-outline",type:"line",source:"osm","source-layer":"indoor",filter:["all",["!in","indoor","corridor","wall","elevator"],["==","level",e]],minzoom:18,paint:{"line-color":t.indoorOutline,"line-width":2}},{id:"indoor-names",type:"symbol",source:"osm","source-layer":"indoor",minzoom:18,filter:["any",["!has","level"],["==","level",e]],layout:{"symbol-placement":"point","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12},paint:{"text-color":t.indoorText}},{id:"landuse-public-transport",type:"fill",source:"osm","source-layer":"landuse",filter:["all",["==","landuse","public_transport"],["any",["!has","level"],["==","level",e]]],paint:{"fill-color":t.publicTransport}},{id:"footway",type:"line",source:"osm","source-layer":"road",filter:["all",["in","highway","footway","track","cycleway","path","unclassified","service"],e===0?["any",["!has","level"],["==","level",e]]:["==","level",e]],layout:{"line-cap":"round"},minzoom:14,paint:{"line-dasharray":[.75,1.5],"line-color":t.footway,"line-opacity":.5,"line-width":["let","base",.4,["interpolate",["linear"],["zoom"],5,["+",["*",["var","base"],.1],1],9,["+",["*",["var","base"],.4],1],12,["+",["*",["var","base"],1],1],16,["+",["*",["var","base"],4],1],20,["+",["*",["var","base"],8],1]]]}},{id:"steps",type:"line",source:"osm","source-layer":"road",minzoom:18,filter:["all",["==","highway","steps"],e===0?["any",["!has","from_level"],["any",["==","from_level",e],["==","to_level",e]]]:["any",["==","from_level",e],["==","to_level",e]]],paint:{"line-dasharray":[.5,.5],"line-color":t.steps,"line-opacity":1,"line-width":["let","base",.4,["interpolate",["linear"],["zoom"],5,["+",["*",["var","base"],.1],1],9,["+",["*",["var","base"],.4],1],12,["+",["*",["var","base"],1],1],16,["+",["*",["var","base"],4],1],20,["+",["*",["var","base"],8],1]]]}},{id:"indoor-elevator-outline",type:"circle",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],paint:{"circle-color":t.elevatorOutline,"circle-radius":16}},{id:"indoor-elevator",type:"circle",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],paint:{"circle-color":t.elevator,"circle-radius":14}},{id:"indoor-elevator-icon",type:"symbol",source:"osm","source-layer":"indoor",minzoom:18,filter:["all",["==","indoor","elevator"],["<=","from_level",e],[">=","to_level",e]],layout:{"icon-image":"elevator","icon-size":.9}},{id:"road_back_residential",type:"line",source:"osm","source-layer":"road",filter:["==","highway","residential"],layout:{"line-cap":"round"},paint:{"line-color":t.roadBackResidential,"line-width":["interpolate",["linear"],["zoom"],5,0,9,.5,12,1,16,4,20,20],"line-opacity":["interpolate",["linear"],["zoom"],12,.4,15,1]}},{id:"road_back_non_residential",type:"line",source:"osm","source-layer":"road",filter:["!in","highway","footway","track","steps","cycleway","path","unclassified","residential","service"],layout:{"line-cap":"round"},paint:{"line-color":t.roadBackNonResidential,"line-width":["let","base",["match",["get","highway"],"motorway",4,["trunk","motorway_link"],3.5,["primary","secondary","aeroway","trunk_link"],3,["primary_link","secondary_link","tertiary","tertiary_link"],1.75,0],["interpolate",["linear"],["zoom"],5,["+",["*",["var","base"],.1],1],9,["+",["*",["var","base"],.4],1],12,["+",["*",["var","base"],1],1],16,["+",["*",["var","base"],4],1],20,["+",["*",["var","base"],8],1]]]}},{id:"road",type:"line",source:"osm","source-layer":"road",layout:{"line-cap":"round"},filter:["all",["has","ref"],["any",["==",["get","highway"],"motorway"],["==",["get","highway"],"trunk"],["==",["get","highway"],"secondary"],[">",["zoom"],11]]],paint:{"line-color":["match",["get","highway"],"motorway",t.motorway,["trunk","motorway_link"],t.motorwayLink,["primary","secondary","aeroway","trunk_link"],t.primarySecondary,["primary_link","secondary_link","tertiary","tertiary_link"],t.linkTertiary,"residential",t.residential,t.road],"line-width":["let","base",["match",["get","highway"],"motorway",3.5,["trunk","motorway_link"],3,["primary","secondary","aeroway","trunk_link"],2.5,["primary_link","secondary_link","tertiary","tertiary_link"],1.75,"residential",1.5,.75],["interpolate",["linear"],["zoom"],5,["*",["var","base"],.5],9,["*",["var","base"],1],12,["*",["var","base"],2],16,["*",["var","base"],2.5],20,["*",["var","base"],3]]]}},{id:"rail_detail",type:"line",source:"osm","source-layer":"rail",filter:["==","rail","detail"],paint:{"line-color":t.rail}},{id:"rail_secondary",type:"line",source:"osm","source-layer":"rail",filter:["all",["==","rail","secondary"],["any",["!has","level"],["==","level",e]]],paint:{"line-color":t.rail,"line-width":1.15}},{id:"rail_primary",type:"line",source:"osm","source-layer":"rail",filter:["all",["==","rail","primary"],["any",["!has","level"],["==","level",e]]],paint:{"line-color":t.rail,"line-width":1.3}},{id:"road-ref-shield",type:"symbol",source:"osm","source-layer":"road",minzoom:6,filter:["all",["has","ref"],["any",["==",["get","highway"],"motorway"],["==",["get","highway"],"trunk"],["==",["get","highway"],"secondary"],[">",["zoom"],11]]],layout:{"symbol-placement":"line","text-field":["get","ref"],"text-font":["Noto Sans Display Regular"],"text-size":["case",["==",["get","highway"],"motorway"],11,10],"text-justify":"center","text-rotation-alignment":"viewport","text-pitch-alignment":"viewport","icon-image":t.shield,"icon-text-fit":"both","icon-text-fit-padding":[.5,4,.5,4],"icon-rotation-alignment":"viewport","icon-pitch-alignment":"viewport"},paint:{"text-color":t.text}},{id:"road-name-text",type:"symbol",source:"osm","source-layer":"road",minzoom:14,layout:{"symbol-placement":"line","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":9},paint:{"text-halo-width":11,"text-halo-color":t.textHalo,"text-color":t.text}},{id:"towns",type:"symbol",source:"osm","source-layer":"cities",filter:["!=",["get","place"],"city"],layout:{"text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12},paint:{"text-halo-width":1,"text-halo-color":t.textHalo,"text-color":t.text}},{id:"cities",type:"symbol",source:"osm","source-layer":"cities",filter:["==",["get","place"],"city"],layout:{"symbol-sort-key":["-",["coalesce",["get","population"],0]],"text-field":["get","name"],"text-font":["Noto Sans Display Bold"],"text-size":["interpolate",["linear"],["zoom"],6,12,9,16]},paint:{"text-halo-width":2,"text-halo-color":"white","text-color":"hsl(0, 0%, 20%)"}}]}};var C0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var uI={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(C0,function(){var t={},n={};function i(u,a,p){if(n[u]=p,u==="index"){var y="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",x={};return n.shared(x),n.index(t,x),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function a(c,o,h,f){return new(h||(h=Promise))(function(_,w){function S(O){try{P(f.next(O))}catch(L){w(L)}}function I(O){try{P(f.throw(O))}catch(L){w(L)}}function P(O){var L;O.done?_(O.value):(L=O.value,L instanceof h?L:new h(function(H){H(L)})).then(S,I)}P((f=f.apply(c,o||[])).next())})}function p(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var y=x;function x(c,o){this.x=c,this.y=o}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,o){return this.clone()._rotateAround(c,o)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var o=c.x-this.x,h=c.y-this.y;return o*o+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,o){return Math.atan2(this.x*o-this.y*c,this.x*c+this.y*o)},_matMult:function(c){var o=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=o,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var o=Math.cos(c),h=Math.sin(c),f=h*this.x+o*this.y;return this.x=o*this.x-h*this.y,this.y=f,this},_rotateAround:function(c,o){var h=Math.cos(c),f=Math.sin(c),_=o.y+f*(this.x-o.x)+h*(this.y-o.y);return this.x=o.x+h*(this.x-o.x)-f*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(c){return c instanceof x?c:Array.isArray(c)?new x(c[0],c[1]):c};var T=p(y),E=k;function k(c,o,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=h,this.p2y=f}k.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(o===void 0&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var _=this.sampleCurveX(h)-c;if(Math.abs(_)<o)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=_/w}var S=0,I=1;for(h=c,f=0;f<20&&(_=this.sampleCurveX(h),!(Math.abs(_-c)<o));f++)c>_?S=h:I=h,h=.5*(I-S)+S;return h},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};var F=p(E);let D,N;function B(){return D==null&&(D=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),D}function V(){if(N==null&&(N=!1,B())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let f=0;f<5*5;f++){const _=4*f;o.fillStyle=`rgb(${_},${_+1},${_+2})`,o.fillRect(f%5,Math.floor(f/5),1,1)}const h=o.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&h[f]!==f){N=!0;break}}}return N||!1}function U(c,o,h,f){const _=new F(c,o,h,f);return w=>_.solve(w)}const j=U(.25,.1,.25,1);function J(c,o,h){return Math.min(h,Math.max(o,c))}function oe(c,o,h){const f=h-o,_=((c-o)%f+f)%f+o;return _===o?h:_}function le(c,...o){for(const h of o)for(const f in h)c[f]=h[f];return c}let Ce=1;function Ie(c,o,h){const f={};for(const _ in c)f[_]=o.call(this,c[_],_,c);return f}function Ue(c,o,h){const f={};for(const _ in c)o.call(this,c[_],_,c)&&(f[_]=c[_]);return f}function De(c){return Array.isArray(c)?c.map(De):typeof c=="object"&&c?Ie(c,De):c}const pe={};function ze(c){pe[c]||(typeof console<"u"&&console.warn(c),pe[c]=!0)}function Ne(c,o,h){return(h.y-c.y)*(o.x-c.x)>(o.y-c.y)*(h.x-c.x)}function ot(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let At=null;function Qe(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function _t(c,o,h,f,_){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(c,{timestamp:0});try{const S=w==null?void 0:w.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const I=S.startsWith("BGR"),P=new Uint8ClampedArray(f*_*4);if(yield w.copyTo(P,function(O,L,H,q,G){const ee=4*Math.max(-L,0),ne=(Math.max(0,H)-H)*q*4+ee,ge=4*q,Ae=Math.max(0,L),tt=Math.max(0,H);return{rect:{x:Ae,y:tt,width:Math.min(O.width,L+q)-Ae,height:Math.min(O.height,H+G)-tt},layout:[{offset:ne,stride:ge}]}}(c,o,h,f,_)),I)for(let O=0;O<P.length;O+=4){const L=P[O];P[O]=P[O+2],P[O+2]=L}return P}finally{w.close()}})}let Lt,Ht;const ar="AbortError";function Tt(){return new Error(ar)}const Sr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Et(c){return Sr.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Or="global-dispatcher";class ir extends Error{constructor(o,h,f,_){super(`AJAXError: ${h} (${o}): ${f}`),this.status=o,this.statusText=h,this.url=f,this.body=_}}const vr=()=>ot(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ur=function(c,o){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=Et(c.url);if(f)return f(c,o);if(ot(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Or},o)}if(!(/^file:/.test(h=c.url)||/^file:/.test(vr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:vr(),signal:_.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const S=yield fetch(w);if(!S.ok){const O=yield S.blob();throw new ir(S.status,S.statusText,f.url,O)}let I;I=f.type==="arrayBuffer"||f.type==="image"?S.arrayBuffer():f.type==="json"?S.json():S.text();const P=yield I;if(_.signal.aborted)throw Tt();return{data:P,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(c,o);if(ot(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Or},o)}var h;return function(f,_){return new Promise((w,S)=>{var I;const P=new XMLHttpRequest;P.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(P.responseType="arraybuffer");for(const O in f.headers)P.setRequestHeader(O,f.headers[O]);f.type==="json"&&(P.responseType="text",!((I=f.headers)===null||I===void 0)&&I.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=f.credentials==="include",P.onerror=()=>{S(new Error(P.statusText))},P.onload=()=>{if(!_.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let O=P.response;if(f.type==="json")try{O=JSON.parse(P.response)}catch(L){return void S(L)}w({data:O,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const O=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});S(new ir(P.status,P.statusText,f.url,O))}},_.signal.addEventListener("abort",()=>{P.abort(),S(Tt())}),P.send(f.body)})}(c,o)};function kr(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const o=new URL(c),h=window.location;return o.protocol===h.protocol&&o.host===h.host}function nn(c,o,h){h[c]&&h[c].indexOf(o)!==-1||(h[c]=h[c]||[],h[c].push(o))}function pr(c,o,h){if(h&&h[c]){const f=h[c].indexOf(o);f!==-1&&h[c].splice(f,1)}}class Hr{constructor(o,h={}){le(this,h),this.type=o}}class Nr extends Hr{constructor(o,h={}){super("error",le({error:o},h))}}class mt{on(o,h){return this._listeners=this._listeners||{},nn(o,h,this._listeners),this}off(o,h){return pr(o,h,this._listeners),pr(o,h,this._oneTimeListeners),this}once(o,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},nn(o,h,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,h){typeof o=="string"&&(o=new Hr(o,h||{}));const f=o.type;if(this.listens(f)){o.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const I of _)I.call(this,o);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const I of w)pr(f,I,this._oneTimeListeners),I.call(this,o);const S=this._eventedParent;S&&(le(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(o))}else o instanceof Nr&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,h){return this._eventedParent=o,this._eventedParentData=h,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Qt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ct(c,o){const h={};for(const f in c)f!=="ref"&&(h[f]=c[f]);return Qt.forEach(f=>{f in o&&(h[f]=o[f])}),h}function yt(c,o){if(Array.isArray(c)){if(!Array.isArray(o)||c.length!==o.length)return!1;for(let h=0;h<c.length;h++)if(!yt(c[h],o[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&o!==null){if(typeof o!="object"||Object.keys(c).length!==Object.keys(o).length)return!1;for(const h in c)if(!yt(c[h],o[h]))return!1;return!0}return c===o}function sr(c,o){c.push(o)}function Br(c,o,h){sr(h,{command:"addSource",args:[c,o[c]]})}function $r(c,o,h){sr(o,{command:"removeSource",args:[c]}),h[c]=!0}function Jt(c,o,h,f){$r(c,h,f),Br(c,o,h)}function Zt(c,o,h){let f;for(f in c[h])if(Object.prototype.hasOwnProperty.call(c[h],f)&&f!=="data"&&!yt(c[h][f],o[h][f]))return!1;for(f in o[h])if(Object.prototype.hasOwnProperty.call(o[h],f)&&f!=="data"&&!yt(c[h][f],o[h][f]))return!1;return!0}function Ar(c,o,h,f,_,w){c=c||{},o=o||{};for(const S in c)Object.prototype.hasOwnProperty.call(c,S)&&(yt(c[S],o[S])||h.push({command:w,args:[f,S,o[S],_]}));for(const S in o)Object.prototype.hasOwnProperty.call(o,S)&&!Object.prototype.hasOwnProperty.call(c,S)&&(yt(c[S],o[S])||h.push({command:w,args:[f,S,o[S],_]}))}function Fr(c){return c.id}function Jr(c,o){return c[o.id]=o,c}class bt{constructor(o,h,f,_){this.message=(o?`${o}: `:"")+f,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function zr(c,...o){for(const h of o)for(const f in h)c[f]=h[f];return c}class Mr extends Error{constructor(o,h){super(h),this.message=h,this.key=o}}class Zr{constructor(o,h=[]){this.parent=o,this.bindings={};for(const[f,_]of h)this.bindings[f]=_}concat(o){return new Zr(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const xn={kind:"null"},Ot={kind:"number"},qe={kind:"string"},$e={kind:"boolean"},dt={kind:"color"},xt={kind:"object"},at={kind:"value"},Dt={kind:"collator"},br={kind:"formatted"},tn={kind:"padding"},pn={kind:"resolvedImage"},de={kind:"variableAnchorOffsetCollection"};function X(c,o){return{kind:"array",itemType:c,N:o}}function Y(c){if(c.kind==="array"){const o=Y(c.itemType);return typeof c.N=="number"?`array<${o}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${o}>`}return c.kind}const te=[xn,Ot,qe,$e,dt,br,xt,X(at),tn,pn,de];function he(c,o){if(o.kind==="error")return null;if(c.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!he(c.itemType,o.itemType))&&(typeof c.N!="number"||c.N===o.N))return null}else{if(c.kind===o.kind)return null;if(c.kind==="value"){for(const h of te)if(!he(h,o))return null}}return`Expected ${Y(c)} but found ${Y(o)} instead.`}function Se(c,o){return o.some(h=>h.kind===c.kind)}function Oe(c,o){return o.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function He(c,o){return c.kind==="array"&&o.kind==="array"?c.itemType.kind===o.itemType.kind&&typeof c.N=="number":c.kind===o.kind}const ye=.96422,We=.82521,ft=4/29,Je=6/29,kt=3*Je*Je,Vt=Je*Je*Je,Kt=Math.PI/180,Wr=180/Math.PI;function Er(c){return(c%=360)<0&&(c+=360),c}function wr([c,o,h,f]){let _,w;const S=Yr((.2225045*(c=gr(c))+.7168786*(o=gr(o))+.0606169*(h=gr(h)))/1);c===o&&o===h?_=w=S:(_=Yr((.4360747*c+.3850649*o+.1430804*h)/ye),w=Yr((.0139322*c+.0971045*o+.7141733*h)/We));const I=116*S-16;return[I<0?0:I,500*(_-S),200*(S-w),f]}function gr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Yr(c){return c>Vt?Math.pow(c,1/3):c/kt+ft}function Pr([c,o,h,f]){let _=(c+16)/116,w=isNaN(o)?_:_+o/500,S=isNaN(h)?_:_-h/200;return _=1*Rr(_),w=ye*Rr(w),S=We*Rr(S),[Wt(3.1338561*w-1.6168667*_-.4906146*S),Wt(-.9787684*w+1.9161415*_+.033454*S),Wt(.0719453*w-.2289914*_+1.4052427*S),f]}function Wt(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Rr(c){return c>Je?c*c*c:kt*(c-ft)}function Dr(c){return parseInt(c.padEnd(2,c),16)/255}function It(c,o){return hn(o?c/100:c,0,1)}function hn(c,o,h){return Math.min(Math.max(o,c),h)}function Ur(c){return!c.some(Number.isNaN)}const Qr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qr{constructor(o,h,f,_=1,w=!0){this.r=o,this.g=h,this.b=f,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[o,h,f,_]))}static parse(o){if(o instanceof qr)return o;if(typeof o!="string")return;const h=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Qr[f];if(_){const[S,I,P]=_;return[S/255,I/255,P/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const S=f.length<6?1:2;let I=1;return[Dr(f.slice(I,I+=S)),Dr(f.slice(I,I+=S)),Dr(f.slice(I,I+=S)),Dr(f.slice(I,I+S)||"ff")]}if(f.startsWith("rgb")){const S=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[I,P,O,L,H,q,G,ee,ne,ge,Ae,tt]=S,Le=[L||" ",G||" ",ge].join("");if(Le==="  "||Le==="  /"||Le===",,"||Le===",,,"){const Ye=[O,q,ne].join(""),gt=Ye==="%%%"?100:Ye===""?255:0;if(gt){const Nt=[hn(+P/gt,0,1),hn(+H/gt,0,1),hn(+ee/gt,0,1),Ae?It(+Ae,tt):1];if(Ur(Nt))return Nt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[S,I,P,O,L,H,q,G,ee]=w,ne=[P||" ",L||" ",q].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ge=[+I,hn(+O,0,100),hn(+H,0,100),G?It(+G,ee):1];if(Ur(ge))return function([Ae,tt,Le,Ye]){function gt(Nt){const rr=(Nt+Ae/30)%12,Lr=tt*Math.min(Le,1-Le);return Le-Lr*Math.max(-1,Math.min(rr-3,9-rr,1))}return Ae=Er(Ae),tt/=100,Le/=100,[gt(0),gt(8),gt(4),Ye]}(ge)}}}(o);return h?new qr(...h,!1):void 0}get rgb(){const{r:o,g:h,b:f,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[o/w,h/w,f/w,_])}get hcl(){return this.overwriteGetter("hcl",function(o){const[h,f,_,w]=wr(o),S=Math.sqrt(f*f+_*_);return[Math.round(1e4*S)?Er(Math.atan2(_,f)*Wr):NaN,S,h,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wr(this.rgb))}overwriteGetter(o,h){return Object.defineProperty(this,o,{value:h}),h}toString(){const[o,h,f,_]=this.rgb;return`rgba(${[o,h,f].map(w=>Math.round(255*w)).join(",")},${_})`}}qr.black=new qr(0,0,0,1),qr.white=new qr(1,1,1,1),qr.transparent=new qr(0,0,0,0),qr.red=new qr(1,0,0,1);class In{constructor(o,h,f){this.sensitivity=o?h?"variant":"case":h?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,h){return this.collator.compare(o,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dn{constructor(o,h,f,_,w){this.text=o,this.image=h,this.scale=f,this.fontStack=_,this.textColor=w}}class wn{constructor(o){this.sections=o}static fromString(o){return new wn([new dn(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof wn?o:wn.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class Cn{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Cn)return o;if(typeof o=="number")return new Cn([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const h of o)if(typeof h!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new Cn(o)}}toString(){return JSON.stringify(this.values)}}const vi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Sn{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Sn)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let h=0;h<o.length;h+=2){const f=o[h],_=o[h+1];if(typeof f!="string"||!vi.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Sn(o)}}toString(){return JSON.stringify(this.values)}}class si{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new si({name:o,available:!1}):null}}function Ps(c,o,h,f){return typeof c=="number"&&c>=0&&c<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof h=="number"&&h>=0&&h<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,o,h,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,o,h,f]:[c,o,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zs(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof qr||c instanceof In||c instanceof wn||c instanceof Cn||c instanceof Sn||c instanceof si)return!0;if(Array.isArray(c)){for(const o of c)if(!zs(o))return!1;return!0}if(typeof c=="object"){for(const o in c)if(!zs(c[o]))return!1;return!0}return!1}function Ln(c){if(c===null)return xn;if(typeof c=="string")return qe;if(typeof c=="boolean")return $e;if(typeof c=="number")return Ot;if(c instanceof qr)return dt;if(c instanceof In)return Dt;if(c instanceof wn)return br;if(c instanceof Cn)return tn;if(c instanceof Sn)return de;if(c instanceof si)return pn;if(Array.isArray(c)){const o=c.length;let h;for(const f of c){const _=Ln(f);if(h){if(h===_)continue;h=at;break}h=_}return X(h||at,o)}return xt}function ki(c){const o=typeof c;return c===null?"":o==="string"||o==="number"||o==="boolean"?String(c):c instanceof qr||c instanceof wn||c instanceof Cn||c instanceof Sn||c instanceof si?c.toString():JSON.stringify(c)}class Ni{constructor(o,h){this.type=o,this.value=h}static parse(o,h){if(o.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!zs(o[1]))return h.error("invalid value");const f=o[1];let _=Ln(f);const w=h.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new Ni(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Hn{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const cs={string:qe,number:Ot,boolean:$e,object:xt};class Wi{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");let f,_=1;const w=o[0];if(w==="array"){let I,P;if(o.length>2){const O=o[1];if(typeof O!="string"||!(O in cs)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);I=cs[O],_++}else I=at;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return h.error('The length argument to "array" must be a positive integer literal',2);P=o[2],_++}f=X(I,P)}else{if(!cs[w])throw new Error(`Types doesn't contain name = ${w}`);f=cs[w]}const S=[];for(;_<o.length;_++){const I=h.parse(o[_],_,at);if(!I)return null;S.push(I)}return new Wi(f,S)}evaluate(o){for(let h=0;h<this.args.length;h++){const f=this.args[h].evaluate(o);if(!he(this.type,Ln(f)))return f;if(h===this.args.length-1)throw new Hn(`Expected value to be of type ${Y(this.type)}, but found ${Y(Ln(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const ko={"to-boolean":$e,"to-color":dt,"to-number":Ot,"to-string":qe};class Fi{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const f=o[0];if(!ko[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return h.error("Expected one argument.");const _=ko[f],w=[];for(let S=1;S<o.length;S++){const I=h.parse(o[S],S,at);if(!I)return null;w.push(I)}return new Fi(_,w)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let h,f;for(const _ of this.args){if(h=_.evaluate(o),f=null,h instanceof qr)return h;if(typeof h=="string"){const w=o.parseColor(h);if(w)return w}else if(Array.isArray(h)&&(f=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Ps(h[0],h[1],h[2],h[3]),!f))return new qr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Hn(f||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const f of this.args){h=f.evaluate(o);const _=Cn.parse(h);if(_)return _}throw new Hn(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const f of this.args){h=f.evaluate(o);const _=Sn.parse(h);if(_)return _}throw new Hn(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const f of this.args){if(h=f.evaluate(o),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new Hn(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return wn.fromString(ki(this.args[0].evaluate(o)));case"resolvedImage":return si.fromString(ki(this.args[0].evaluate(o)));default:return ki(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const $i=["Unknown","Point","LineString","Polygon"];class Xo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$i[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let h=this._parseColorCache[o];return h||(h=this._parseColorCache[o]=qr.parse(o)),h}}class Us{constructor(o,h,f=[],_,w=new Zr,S=[]){this.registry=o,this.path=f,this.key=f.map(I=>`[${I}]`).join(""),this.scope=w,this.errors=S,this.expectedType=_,this._isConstant=h}parse(o,h,f,_,w={}){return h?this.concat(h,f,_)._parse(o,w):this._parse(o,w)}_parse(o,h){function f(_,w,S){return S==="assert"?new Wi(w,[_]):S==="coerce"?new Fi(w,[_]):_}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=o[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let S=w.parse(o,this);if(!S)return null;if(this.expectedType){const I=this.expectedType,P=S.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||P.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(I.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(I,P))return null}else S=f(S,I,h.typeAnnotation||"coerce");else S=f(S,I,h.typeAnnotation||"coerce");else S=f(S,I,h.typeAnnotation||"coerce");else S=f(S,I,h.typeAnnotation||"assert")}if(!(S instanceof Ni)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const I=new Xo;try{S=new Ni(S.type,S.evaluate(I))}catch(P){return this.error(P.message),null}}return S}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,h,f){const _=typeof o=="number"?this.path.concat(o):this.path,w=f?this.scope.concat(f):this.scope;return new Us(this.registry,this._isConstant,_,h||null,w,this.errors)}error(o,...h){const f=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new Mr(f,o))}checkSubtype(o,h){const f=he(o,h);return f&&this.error(f),f}}class ms{constructor(o,h){this.type=h.type,this.bindings=[].concat(o),this.result=h}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const h of this.bindings)o(h[1]);o(this.result)}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let w=1;w<o.length-1;w+=2){const S=o[w];if(typeof S!="string")return h.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return h.error("Variable names must contain only alphanumeric characters or '_'.",w);const I=h.parse(o[w+1],w+1);if(!I)return null;f.push([S,I])}const _=h.parse(o[o.length-1],o.length-1,h.expectedType,f);return _?new ms(f,_):null}outputDefined(){return this.result.outputDefined()}}class ln{constructor(o,h){this.type=h.type,this.name=o,this.boundExpression=h}static parse(o,h){if(o.length!==2||typeof o[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const f=o[1];return h.scope.has(f)?new ln(f,h.scope.get(f)):h.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class mc{constructor(o,h,f){this.type=o,this.index=h,this.input=f}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,Ot),_=h.parse(o[2],2,X(h.expectedType||at));return f&&_?new mc(_.type.itemType,f,_):null}evaluate(o){const h=this.index.evaluate(o),f=this.input.evaluate(o);if(h<0)throw new Hn(`Array index out of bounds: ${h} < 0.`);if(h>=f.length)throw new Hn(`Array index out of bounds: ${h} > ${f.length-1}.`);if(h!==Math.floor(h))throw new Hn(`Array index must be an integer, but found ${h} instead.`);return f[h]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class _c{constructor(o,h){this.type=$e,this.needle=o,this.haystack=h}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,at),_=h.parse(o[2],2,at);return f&&_?Se(f.type,[$e,qe,Ot,xn,at])?new _c(f,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(f.type)} instead`):null}evaluate(o){const h=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!Oe(h,["boolean","string","number","null"]))throw new Hn(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Ln(h))} instead.`);if(!Oe(f,["string","array"]))throw new Hn(`Expected second argument to be of type array or string, but found ${Y(Ln(f))} instead.`);return f.indexOf(h)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class re{constructor(o,h,f){this.type=Ot,this.needle=o,this.haystack=h,this.fromIndex=f}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,at),_=h.parse(o[2],2,at);if(!f||!_)return null;if(!Se(f.type,[$e,qe,Ot,xn,at]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(f.type)} instead`);if(o.length===4){const w=h.parse(o[3],3,Ot);return w?new re(f,_,w):null}return new re(f,_)}evaluate(o){const h=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Oe(h,["boolean","string","number","null"]))throw new Hn(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Ln(h))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(o)),Oe(f,["string"])){const w=f.indexOf(h,_);return w===-1?-1:[...f.slice(0,w)].length}if(Oe(f,["array"]))return f.indexOf(h,_);throw new Hn(`Expected second argument to be of type array or string, but found ${Y(Ln(f))} instead.`)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class ae{constructor(o,h,f,_,w,S){this.inputType=o,this.type=h,this.input=f,this.cases=_,this.outputs=w,this.otherwise=S}static parse(o,h){if(o.length<5)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return h.error("Expected an even number of arguments.");let f,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const w={},S=[];for(let O=2;O<o.length-1;O+=2){let L=o[O];const H=o[O+1];Array.isArray(L)||(L=[L]);const q=h.concat(O);if(L.length===0)return q.error("Expected at least one branch label.");for(const ee of L){if(typeof ee!="number"&&typeof ee!="string")return q.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return q.error("Numeric branch labels must be integer values.");if(f){if(q.checkSubtype(f,Ln(ee)))return null}else f=Ln(ee);if(w[String(ee)]!==void 0)return q.error("Branch labels must be unique.");w[String(ee)]=S.length}const G=h.parse(H,O,_);if(!G)return null;_=_||G.type,S.push(G)}const I=h.parse(o[1],1,at);if(!I)return null;const P=h.parse(o[o.length-1],o.length-1,_);return P?I.type.kind!=="value"&&h.concat(1).checkSubtype(f,I.type)?null:new ae(f,_,I,w,S,P):null}evaluate(o){const h=this.input.evaluate(o);return(Ln(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Me{constructor(o,h,f){this.type=o,this.branches=h,this.otherwise=f}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return h.error("Expected an odd number of arguments.");let f;h.expectedType&&h.expectedType.kind!=="value"&&(f=h.expectedType);const _=[];for(let S=1;S<o.length-1;S+=2){const I=h.parse(o[S],S,$e);if(!I)return null;const P=h.parse(o[S+1],S+1,f);if(!P)return null;_.push([I,P]),f=f||P.type}const w=h.parse(o[o.length-1],o.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new Me(f,_,w)}evaluate(o){for(const[h,f]of this.branches)if(h.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[h,f]of this.branches)o(h),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class ht{constructor(o,h,f,_){this.type=o,this.input=h,this.beginIndex=f,this.endIndex=_}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,at),_=h.parse(o[2],2,Ot);if(!f||!_)return null;if(!Se(f.type,[X(at),qe,at]))return h.error(`Expected first argument to be of type array or string, but found ${Y(f.type)} instead`);if(o.length===4){const w=h.parse(o[3],3,Ot);return w?new ht(f.type,f,_,w):null}return new ht(f.type,f,_)}evaluate(o){const h=this.input.evaluate(o),f=this.beginIndex.evaluate(o);let _;if(this.endIndex&&(_=this.endIndex.evaluate(o)),Oe(h,["string"]))return[...h].slice(f,_).join("");if(Oe(h,["array"]))return h.slice(f,_);throw new Hn(`Expected first argument to be of type array or string, but found ${Y(Ln(h))} instead.`)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Ft(c,o){const h=c.length-1;let f,_,w=0,S=h,I=0;for(;w<=S;)if(I=Math.floor((w+S)/2),f=c[I],_=c[I+1],f<=o){if(I===h||o<_)return I;w=I+1}else{if(!(f>o))throw new Hn("Input is not a number.");S=I-1}return 0}class hr{constructor(o,h,f){this.type=o,this.input=h,this.labels=[],this.outputs=[];for(const[_,w]of f)this.labels.push(_),this.outputs.push(w)}static parse(o,h){if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");const f=h.parse(o[1],1,Ot);if(!f)return null;const _=[];let w=null;h.expectedType&&h.expectedType.kind!=="value"&&(w=h.expectedType);for(let S=1;S<o.length;S+=2){const I=S===1?-1/0:o[S],P=o[S+1],O=S,L=S+1;if(typeof I!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=I)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const H=h.parse(P,L,w);if(!H)return null;w=w||H.type,_.push([I,H])}return new hr(w,f,_)}evaluate(o){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=h[0])return f[0].evaluate(o);const w=h.length;return _>=h[w-1]?f[w-1].evaluate(o):f[Ft(h,_)].evaluate(o)}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function fn(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Si=Ai;function Ai(c,o,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=h,this.p2y=f}Ai.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(o===void 0&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var _=this.sampleCurveX(h)-c;if(Math.abs(_)<o)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=_/w}var S=0,I=1;for(h=c,f=0;f<20&&(_=this.sampleCurveX(h),!(Math.abs(_-c)<o));f++)c>_?S=h:I=h,h=.5*(I-S)+S;return h},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};var qi=fn(Si);function Bi(c,o,h){return c+h*(o-c)}function yc(c,o,h){return c.map((f,_)=>Bi(f,o[_],h))}const _s={number:Bi,color:function(c,o,h,f="rgb"){switch(f){case"rgb":{const[_,w,S,I]=yc(c.rgb,o.rgb,h);return new qr(_,w,S,I,!1)}case"hcl":{const[_,w,S,I]=c.hcl,[P,O,L,H]=o.hcl;let q,G;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?q=NaN:(q=P,S!==1&&S!==0||(G=O)):(q=_,L!==1&&L!==0||(G=w));else{let tt=P-_;P>_&&tt>180?tt-=360:P<_&&_-P>180&&(tt+=360),q=_+h*tt}const[ee,ne,ge,Ae]=function([tt,Le,Ye,gt]){return tt=isNaN(tt)?0:tt*Kt,Pr([Ye,Math.cos(tt)*Le,Math.sin(tt)*Le,gt])}([q,G??Bi(w,O,h),Bi(S,L,h),Bi(I,H,h)]);return new qr(ee,ne,ge,Ae,!1)}case"lab":{const[_,w,S,I]=Pr(yc(c.lab,o.lab,h));return new qr(_,w,S,I,!1)}}},array:yc,padding:function(c,o,h){return new Cn(yc(c.values,o.values,h))},variableAnchorOffsetCollection:function(c,o,h){const f=c.values,_=o.values;if(f.length!==_.length)throw new Hn(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${o.toString()}`);const w=[];for(let S=0;S<f.length;S+=2){if(f[S]!==_[S])throw new Hn(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${f[S]}, to[${S}]: ${_[S]}`);w.push(f[S]);const[I,P]=f[S+1],[O,L]=_[S+1];w.push([Bi(I,O,h),Bi(P,L,h)])}return new Sn(w)}};class ys{constructor(o,h,f,_,w){this.type=o,this.operator=h,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[S,I]of w)this.labels.push(S),this.outputs.push(I)}static interpolationFactor(o,h,f,_){let w=0;if(o.name==="exponential")w=mu(h,o.base,f,_);else if(o.name==="linear")w=mu(h,1,f,_);else if(o.name==="cubic-bezier"){const S=o.controlPoints;w=new qi(S[0],S[1],S[2],S[3]).solve(mu(h,1,f,_))}return w}static parse(o,h){let[f,_,w,...S]=o;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const O=_[1];if(typeof O!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:O}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const O=_.slice(1);if(O.length!==4||O.some(L=>typeof L!="number"||L<0||L>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:O}}}if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(w=h.parse(w,2,Ot),!w)return null;const I=[];let P=null;f==="interpolate-hcl"||f==="interpolate-lab"?P=dt:h.expectedType&&h.expectedType.kind!=="value"&&(P=h.expectedType);for(let O=0;O<S.length;O+=2){const L=S[O],H=S[O+1],q=O+3,G=O+4;if(typeof L!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(I.length&&I[I.length-1][0]>=L)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const ee=h.parse(H,G,P);if(!ee)return null;P=P||ee.type,I.push([L,ee])}return He(P,Ot)||He(P,dt)||He(P,tn)||He(P,de)||He(P,X(Ot))?new ys(P,f,_,w,I):h.error(`Type ${Y(P)} is not interpolatable.`)}evaluate(o){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=h[0])return f[0].evaluate(o);const w=h.length;if(_>=h[w-1])return f[w-1].evaluate(o);const S=Ft(h,_),I=ys.interpolationFactor(this.interpolation,_,h[S],h[S+1]),P=f[S].evaluate(o),O=f[S+1].evaluate(o);switch(this.operator){case"interpolate":return _s[this.type.kind](P,O,I);case"interpolate-hcl":return _s.color(P,O,I,"hcl");case"interpolate-lab":return _s.color(P,O,I,"lab")}}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function mu(c,o,h,f){const _=f-h,w=c-h;return _===0?0:o===1?w/_:(Math.pow(o,w)-1)/(Math.pow(o,_)-1)}class _u{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expectected at least one argument.");let f=null;const _=h.expectedType;_&&_.kind!=="value"&&(f=_);const w=[];for(const I of o.slice(1)){const P=h.parse(I,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,w.push(P)}if(!f)throw new Error("No output type");const S=_&&w.some(I=>he(_,I.type));return new _u(S?at:f,w)}evaluate(o){let h,f=null,_=0;for(const w of this.args)if(_++,f=w.evaluate(o),f&&f instanceof si&&!f.available&&(h||(h=f.name),f=null,_===this.args.length&&(f=h)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}function yu(c,o){return c==="=="||c==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function $m(c,o,h,f){return f.compare(o,h)===0}function il(c,o,h){const f=c!=="=="&&c!=="!=";return class hI{constructor(w,S,I){this.type=$e,this.lhs=w,this.rhs=S,this.collator=I,this.hasUntypedArgument=w.type.kind==="value"||S.type.kind==="value"}static parse(w,S){if(w.length!==3&&w.length!==4)return S.error("Expected two or three arguments.");const I=w[0];let P=S.parse(w[1],1,at);if(!P)return null;if(!yu(I,P.type))return S.concat(1).error(`"${I}" comparisons are not supported for type '${Y(P.type)}'.`);let O=S.parse(w[2],2,at);if(!O)return null;if(!yu(I,O.type))return S.concat(2).error(`"${I}" comparisons are not supported for type '${Y(O.type)}'.`);if(P.type.kind!==O.type.kind&&P.type.kind!=="value"&&O.type.kind!=="value")return S.error(`Cannot compare types '${Y(P.type)}' and '${Y(O.type)}'.`);f&&(P.type.kind==="value"&&O.type.kind!=="value"?P=new Wi(O.type,[P]):P.type.kind!=="value"&&O.type.kind==="value"&&(O=new Wi(P.type,[O])));let L=null;if(w.length===4){if(P.type.kind!=="string"&&O.type.kind!=="string"&&P.type.kind!=="value"&&O.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(L=S.parse(w[3],3,Dt),!L)return null}return new hI(P,O,L)}evaluate(w){const S=this.lhs.evaluate(w),I=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const P=Ln(S),O=Ln(I);if(P.kind!==O.kind||P.kind!=="string"&&P.kind!=="number")throw new Hn(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${P.kind}, ${O.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=Ln(S),O=Ln(I);if(P.kind!=="string"||O.kind!=="string")return o(w,S,I)}return this.collator?h(w,S,I,this.collator.evaluate(w)):o(w,S,I)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const db=il("==",function(c,o,h){return o===h},$m),qm=il("!=",function(c,o,h){return o!==h},function(c,o,h,f){return!$m(0,o,h,f)}),Xm=il("<",function(c,o,h){return o<h},function(c,o,h,f){return f.compare(o,h)<0}),fb=il(">",function(c,o,h){return o>h},function(c,o,h,f){return f.compare(o,h)>0}),pb=il("<=",function(c,o,h){return o<=h},function(c,o,h,f){return f.compare(o,h)<=0}),Zm=il(">=",function(c,o,h){return o>=h},function(c,o,h,f){return f.compare(o,h)>=0});class vc{constructor(o,h,f){this.type=Dt,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=h}static parse(o,h){if(o.length!==2)return h.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return h.error("Collator options argument must be an object.");const _=h.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,$e);if(!_)return null;const w=h.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,$e);if(!w)return null;let S=null;return f.locale&&(S=h.parse(f.locale,1,qe),!S)?null:new vc(_,w,S)}evaluate(o){return new In(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class Sd{constructor(o,h,f,_,w){this.type=qe,this.number=o,this.locale=h,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(o,h){if(o.length!==3)return h.error("Expected two arguments.");const f=h.parse(o[1],1,Ot);if(!f)return null;const _=o[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=h.parse(_.locale,1,qe),!w))return null;let S=null;if(_.currency&&(S=h.parse(_.currency,1,qe),!S))return null;let I=null;if(_["min-fraction-digits"]&&(I=h.parse(_["min-fraction-digits"],1,Ot),!I))return null;let P=null;return _["max-fraction-digits"]&&(P=h.parse(_["max-fraction-digits"],1,Ot),!P)?null:new Sd(f,w,S,I,P)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class vu{constructor(o){this.type=br,this.sections=o}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return h.error("First argument must be an image or text section.");const _=[];let w=!1;for(let S=1;S<=o.length-1;++S){const I=o[S];if(w&&typeof I=="object"&&!Array.isArray(I)){w=!1;let P=null;if(I["font-scale"]&&(P=h.parse(I["font-scale"],1,Ot),!P))return null;let O=null;if(I["text-font"]&&(O=h.parse(I["text-font"],1,X(qe)),!O))return null;let L=null;if(I["text-color"]&&(L=h.parse(I["text-color"],1,dt),!L))return null;const H=_[_.length-1];H.scale=P,H.font=O,H.textColor=L}else{const P=h.parse(o[S],1,at);if(!P)return null;const O=P.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:P,scale:null,font:null,textColor:null})}}return new vu(_)}evaluate(o){return new wn(this.sections.map(h=>{const f=h.content.evaluate(o);return Ln(f)===pn?new dn("",f,null,null,null):new dn(ki(f),null,h.scale?h.scale.evaluate(o):null,h.font?h.font.evaluate(o).join(","):null,h.textColor?h.textColor.evaluate(o):null)}))}eachChild(o){for(const h of this.sections)o(h.content),h.scale&&o(h.scale),h.font&&o(h.font),h.textColor&&o(h.textColor)}outputDefined(){return!1}}class Ad{constructor(o){this.type=pn,this.input=o}static parse(o,h){if(o.length!==2)return h.error("Expected two arguments.");const f=h.parse(o[1],1,qe);return f?new Ad(f):h.error("No image name provided.")}evaluate(o){const h=this.input.evaluate(o),f=si.fromString(h);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(h)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class Ed{constructor(o){this.type=Ot,this.input=o}static parse(o,h){if(o.length!==2)return h.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=h.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Y(f.type)} instead.`):new Ed(f):null}evaluate(o){const h=this.input.evaluate(o);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new Hn(`Expected value to be of type string or array, but found ${Y(Ln(h))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const go=8192;function gb(c,o){const h=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(h*_*go),Math.round(f*_*go)]}function Id(c,o){const h=Math.pow(2,o.z);return[(_=(c[0]/go+o.x)/h,360*_-180),(f=(c[1]/go+o.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function Ta(c,o){c[0]=Math.min(c[0],o[0]),c[1]=Math.min(c[1],o[1]),c[2]=Math.max(c[2],o[0]),c[3]=Math.max(c[3],o[1])}function Zo(c,o){return!(c[0]<=o[0]||c[2]>=o[2]||c[1]<=o[1]||c[3]>=o[3])}function Pn(c,o,h){const f=c[0]-o[0],_=c[1]-o[1],w=c[0]-h[0],S=c[1]-h[1];return f*S-w*_==0&&f*w<=0&&_*S<=0}function bu(c,o,h,f){return(_=[f[0]-h[0],f[1]-h[1]])[0]*(w=[o[0]-c[0],o[1]-c[1]])[1]-_[1]*w[0]!=0&&!(!Km(c,o,h,f)||!Km(h,f,c,o));var _,w}function mb(c,o,h){for(const f of h)for(let _=0;_<f.length-1;++_)if(bu(c,o,f[_],f[_+1]))return!0;return!1}function sl(c,o,h=!1){let f=!1;for(const I of o)for(let P=0;P<I.length-1;P++){if(Pn(c,I[P],I[P+1]))return h;(w=I[P])[1]>(_=c)[1]!=(S=I[P+1])[1]>_[1]&&_[0]<(S[0]-w[0])*(_[1]-w[1])/(S[1]-w[1])+w[0]&&(f=!f)}var _,w,S;return f}function _b(c,o){for(const h of o)if(sl(c,h))return!0;return!1}function Ym(c,o){for(const h of c)if(!sl(h,o))return!1;for(let h=0;h<c.length-1;++h)if(mb(c[h],c[h+1],o))return!1;return!0}function yb(c,o){for(const h of o)if(Ym(c,h))return!0;return!1}function Km(c,o,h,f){const _=f[0]-h[0],w=f[1]-h[1],S=(c[0]-h[0])*w-_*(c[1]-h[1]),I=(o[0]-h[0])*w-_*(o[1]-h[1]);return S>0&&I<0||S<0&&I>0}function Cd(c,o,h){const f=[];for(let _=0;_<c.length;_++){const w=[];for(let S=0;S<c[_].length;S++){const I=gb(c[_][S],h);Ta(o,I),w.push(I)}f.push(w)}return f}function Gm(c,o,h){const f=[];for(let _=0;_<c.length;_++){const w=Cd(c[_],o,h);f.push(w)}return f}function Jm(c,o,h,f){if(c[0]<h[0]||c[0]>h[2]){const _=.5*f;let w=c[0]-h[0]>_?-f:h[0]-c[0]>_?f:0;w===0&&(w=c[0]-h[2]>_?-f:h[2]-c[0]>_?f:0),c[0]+=w}Ta(o,c)}function Qm(c,o,h,f){const _=Math.pow(2,f.z)*go,w=[f.x*go,f.y*go],S=[];for(const I of c)for(const P of I){const O=[P.x+w[0],P.y+w[1]];Jm(O,o,h,_),S.push(O)}return S}function e_(c,o,h,f){const _=Math.pow(2,f.z)*go,w=[f.x*go,f.y*go],S=[];for(const P of c){const O=[];for(const L of P){const H=[L.x+w[0],L.y+w[1]];Ta(o,H),O.push(H)}S.push(O)}if(o[2]-o[0]<=_/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const P of S)for(const O of P)Jm(O,o,h,_)}var I;return S}class Sa{constructor(o,h){this.type=$e,this.geojson=o,this.geometries=h}static parse(o,h){if(o.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(zs(o[1])){const f=o[1];if(f.type==="FeatureCollection"){const _=[];for(const w of f.features){const{type:S,coordinates:I}=w.geometry;S==="Polygon"&&_.push(I),S==="MultiPolygon"&&_.push(...I)}if(_.length)return new Sa(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Sa(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Sa(f,f)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(h,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(f.type==="Polygon"){const I=Cd(f.coordinates,w,S),P=Qm(h.geometry(),_,w,S);if(!Zo(_,w))return!1;for(const O of P)if(!sl(O,I))return!1}if(f.type==="MultiPolygon"){const I=Gm(f.coordinates,w,S),P=Qm(h.geometry(),_,w,S);if(!Zo(_,w))return!1;for(const O of P)if(!_b(O,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(h,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(f.type==="Polygon"){const I=Cd(f.coordinates,w,S),P=e_(h.geometry(),_,w,S);if(!Zo(_,w))return!1;for(const O of P)if(!Ym(O,I))return!1}if(f.type==="MultiPolygon"){const I=Gm(f.coordinates,w,S),P=e_(h.geometry(),_,w,S);if(!Zo(_,w))return!1;for(const O of P)if(!yb(O,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let t_=class{constructor(c=[],o=(h,f)=>h<f?-1:h>f?1:0){if(this.data=c,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:o,compare:h}=this,f=o[c];for(;c>0;){const _=c-1>>1,w=o[_];if(h(f,w)>=0)break;o[c]=w,c=_}o[c]=f}_down(c){const{data:o,compare:h}=this,f=this.length>>1,_=o[c];for(;c<f;){let w=1+(c<<1);const S=w+1;if(S<this.length&&h(o[S],o[w])<0&&(w=S),h(o[w],_)>=0)break;o[c]=o[w],c=w}o[c]=_}};function vb(c,o,h,f,_){r_(c,o,h,f||c.length-1,_||bb)}function r_(c,o,h,f,_){for(;f>h;){if(f-h>600){var w=f-h+1,S=o-h+1,I=Math.log(w),P=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*P*(w-P)/w)*(S-w/2<0?-1:1);r_(c,o,Math.max(h,Math.floor(o-S*P/w+O)),Math.min(f,Math.floor(o+(w-S)*P/w+O)),_)}var L=c[o],H=h,q=f;for(bc(c,h,o),_(c[f],L)>0&&bc(c,h,f);H<q;){for(bc(c,H,q),H++,q--;_(c[H],L)<0;)H++;for(;_(c[q],L)>0;)q--}_(c[h],L)===0?bc(c,h,q):bc(c,++q,f),q<=o&&(h=q+1),o<=q&&(f=q-1)}}function bc(c,o,h){var f=c[o];c[o]=c[h],c[h]=f}function bb(c,o){return c<o?-1:c>o?1:0}function xu(c,o){if(c.length<=1)return[c];const h=[];let f,_;for(const w of c){const S=wb(w);S!==0&&(w.area=Math.abs(S),_===void 0&&(_=S<0),_===S<0?(f&&h.push(f),f=[w]):f.push(w))}if(f&&h.push(f),o>1)for(let w=0;w<h.length;w++)h[w].length<=o||(vb(h[w],o,1,h[w].length-1,xb),h[w]=h[w].slice(0,o));return h}function xb(c,o){return o.area-c.area}function wb(c){let o=0;for(let h,f,_=0,w=c.length,S=w-1;_<w;S=_++)h=c[_],f=c[S],o+=(f.x-h.x)*(h.y+f.y);return o}const n_=1/298.257223563,i_=n_*(2-n_),s_=Math.PI/180;class Pd{constructor(o){const h=6378.137*s_*1e3,f=Math.cos(o*s_),_=1/(1-i_*(1-f*f)),w=Math.sqrt(_);this.kx=h*w*f,this.ky=h*w*_*(1-i_)}distance(o,h){const f=this.wrap(o[0]-h[0])*this.kx,_=(o[1]-h[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(o,h){let f,_,w,S,I=1/0;for(let P=0;P<o.length-1;P++){let O=o[P][0],L=o[P][1],H=this.wrap(o[P+1][0]-O)*this.kx,q=(o[P+1][1]-L)*this.ky,G=0;H===0&&q===0||(G=(this.wrap(h[0]-O)*this.kx*H+(h[1]-L)*this.ky*q)/(H*H+q*q),G>1?(O=o[P+1][0],L=o[P+1][1]):G>0&&(O+=H/this.kx*G,L+=q/this.ky*G)),H=this.wrap(h[0]-O)*this.kx,q=(h[1]-L)*this.ky;const ee=H*H+q*q;ee<I&&(I=ee,f=O,_=L,w=P,S=G)}return{point:[f,_],index:w,t:Math.max(0,Math.min(1,S))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function o_(c,o){return o[0]-c[0]}function wu(c){return c[1]-c[0]+1}function Mo(c,o){return c[1]>=c[0]&&c[1]<o}function Rd(c,o){if(c[0]>c[1])return[null,null];const h=wu(c);if(o){if(h===2)return[c,null];const _=Math.floor(h/2);return[[c[0],c[0]+_],[c[0]+_,c[1]]]}if(h===1)return[c,null];const f=Math.floor(h/2)-1;return[[c[0],c[0]+f],[c[0]+f+1,c[1]]]}function kd(c,o){if(!Mo(o,c.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let f=o[0];f<=o[1];++f)Ta(h,c[f]);return h}function Md(c){const o=[1/0,1/0,-1/0,-1/0];for(const h of c)for(const f of h)Ta(o,f);return o}function Tu(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Od(c,o,h){if(!Tu(c)||!Tu(o))return NaN;let f=0,_=0;return c[2]<o[0]&&(f=o[0]-c[2]),c[0]>o[2]&&(f=c[0]-o[2]),c[1]>o[3]&&(_=c[1]-o[3]),c[3]<o[1]&&(_=o[1]-c[3]),h.distance([0,0],[f,_])}function Aa(c,o,h){const f=h.pointOnLine(o,c);return h.distance(c,f.point)}function Dd(c,o,h,f,_){const w=Math.min(Aa(c,[h,f],_),Aa(o,[h,f],_)),S=Math.min(Aa(h,[c,o],_),Aa(f,[c,o],_));return Math.min(w,S)}function Tb(c,o,h,f,_){if(!Mo(o,c.length)||!Mo(f,h.length))return 1/0;let w=1/0;for(let S=o[0];S<o[1];++S){const I=c[S],P=c[S+1];for(let O=f[0];O<f[1];++O){const L=h[O],H=h[O+1];if(bu(I,P,L,H))return 0;w=Math.min(w,Dd(I,P,L,H,_))}}return w}function pi(c,o,h,f,_){if(!Mo(o,c.length)||!Mo(f,h.length))return NaN;let w=1/0;for(let S=o[0];S<=o[1];++S)for(let I=f[0];I<=f[1];++I)if(w=Math.min(w,_.distance(c[S],h[I])),w===0)return w;return w}function Sb(c,o,h){if(sl(c,o,!0))return 0;let f=1/0;for(const _ of o){const w=_[0],S=_[_.length-1];if(w!==S&&(f=Math.min(f,Aa(c,[S,w],h)),f===0))return f;const I=h.pointOnLine(_,c);if(f=Math.min(f,h.distance(c,I.point)),f===0)return f}return f}function un(c,o,h,f){if(!Mo(o,c.length))return NaN;for(let w=o[0];w<=o[1];++w)if(sl(c[w],h,!0))return 0;let _=1/0;for(let w=o[0];w<o[1];++w){const S=c[w],I=c[w+1];for(const P of h)for(let O=0,L=P.length,H=L-1;O<L;H=O++){const q=P[H],G=P[O];if(bu(S,I,q,G))return 0;_=Math.min(_,Dd(S,I,q,G,f))}}return _}function Su(c,o){for(const h of c)for(const f of h)if(sl(f,o,!0))return!0;return!1}function Wn(c,o,h,f=1/0){const _=Md(c),w=Md(o);if(f!==1/0&&Od(_,w,h)>=f)return f;if(Zo(_,w)){if(Su(c,o))return 0}else if(Su(o,c))return 0;let S=1/0;for(const I of c)for(let P=0,O=I.length,L=O-1;P<O;L=P++){const H=I[L],q=I[P];for(const G of o)for(let ee=0,ne=G.length,ge=ne-1;ee<ne;ge=ee++){const Ae=G[ge],tt=G[ee];if(bu(H,q,Ae,tt))return 0;S=Math.min(S,Dd(H,q,Ae,tt,h))}}return S}function Mn(c,o,h,f,_,w){if(!w)return;const S=Od(kd(f,w),_,h);S<o&&c.push([S,w,[0,0]])}function Ea(c,o,h,f,_,w,S){if(!w||!S)return;const I=Od(kd(f,w),kd(_,S),h);I<o&&c.push([I,w,S])}function xc(c,o,h,f,_=1/0){let w=Math.min(f.distance(c[0],h[0][0]),_);if(w===0)return w;const S=new t_([[0,[0,c.length-1],[0,0]]],o_),I=Md(h);for(;S.length>0;){const P=S.pop();if(P[0]>=w)continue;const O=P[1],L=o?50:100;if(wu(O)<=L){if(!Mo(O,c.length))return NaN;if(o){const H=un(c,O,h,f);if(isNaN(H)||H===0)return H;w=Math.min(w,H)}else for(let H=O[0];H<=O[1];++H){const q=Sb(c[H],h,f);if(w=Math.min(w,q),w===0)return 0}}else{const H=Rd(O,o);Mn(S,w,f,c,I,H[0]),Mn(S,w,f,c,I,H[1])}}return w}function wc(c,o,h,f,_,w=1/0){let S=Math.min(w,_.distance(c[0],h[0]));if(S===0)return S;const I=new t_([[0,[0,c.length-1],[0,h.length-1]]],o_);for(;I.length>0;){const P=I.pop();if(P[0]>=S)continue;const O=P[1],L=P[2],H=o?50:100,q=f?50:100;if(wu(O)<=H&&wu(L)<=q){if(!Mo(O,c.length)&&Mo(L,h.length))return NaN;let G;if(o&&f)G=Tb(c,O,h,L,_),S=Math.min(S,G);else if(o&&!f){const ee=c.slice(O[0],O[1]+1);for(let ne=L[0];ne<=L[1];++ne)if(G=Aa(h[ne],ee,_),S=Math.min(S,G),S===0)return S}else if(!o&&f){const ee=h.slice(L[0],L[1]+1);for(let ne=O[0];ne<=O[1];++ne)if(G=Aa(c[ne],ee,_),S=Math.min(S,G),S===0)return S}else G=pi(c,O,h,L,_),S=Math.min(S,G)}else{const G=Rd(O,o),ee=Rd(L,f);Ea(I,S,_,c,h,G[0],ee[0]),Ea(I,S,_,c,h,G[0],ee[1]),Ea(I,S,_,c,h,G[1],ee[0]),Ea(I,S,_,c,h,G[1],ee[1])}}return S}function Nd(c){return c.type==="MultiPolygon"?c.coordinates.map(o=>({type:"Polygon",coordinates:o})):c.type==="MultiLineString"?c.coordinates.map(o=>({type:"LineString",coordinates:o})):c.type==="MultiPoint"?c.coordinates.map(o=>({type:"Point",coordinates:o})):[c]}class Ia{constructor(o,h){this.type=Ot,this.geojson=o,this.geometries=h}static parse(o,h){if(o.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(zs(o[1])){const f=o[1];if(f.type==="FeatureCollection")return new Ia(f,f.features.map(_=>Nd(_.geometry)).flat());if(f.type==="Feature")return new Ia(f,Nd(f.geometry));if("type"in f&&"coordinates"in f)return new Ia(f,Nd(f))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(h,f){const _=h.geometry(),w=_.flat().map(P=>Id([P.x,P.y],h.canonical));if(_.length===0)return NaN;const S=new Pd(w[0][1]);let I=1/0;for(const P of f){switch(P.type){case"Point":I=Math.min(I,wc(w,!1,[P.coordinates],!1,S,I));break;case"LineString":I=Math.min(I,wc(w,!1,P.coordinates,!0,S,I));break;case"Polygon":I=Math.min(I,xc(w,!1,P.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries);if(o.geometryType()==="LineString")return function(h,f){const _=h.geometry(),w=_.flat().map(P=>Id([P.x,P.y],h.canonical));if(_.length===0)return NaN;const S=new Pd(w[0][1]);let I=1/0;for(const P of f){switch(P.type){case"Point":I=Math.min(I,wc(w,!0,[P.coordinates],!1,S,I));break;case"LineString":I=Math.min(I,wc(w,!0,P.coordinates,!0,S,I));break;case"Polygon":I=Math.min(I,xc(w,!0,P.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries);if(o.geometryType()==="Polygon")return function(h,f){const _=h.geometry();if(_.length===0||_[0].length===0)return NaN;const w=xu(_,0).map(P=>P.map(O=>O.map(L=>Id([L.x,L.y],h.canonical)))),S=new Pd(w[0][0][0][1]);let I=1/0;for(const P of f)for(const O of w){switch(P.type){case"Point":I=Math.min(I,xc([P.coordinates],!1,O,S,I));break;case"LineString":I=Math.min(I,xc(P.coordinates,!0,O,S,I));break;case"Polygon":I=Math.min(I,Wn(O,P.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ol={"==":db,"!=":qm,">":fb,"<":Xm,">=":Zm,"<=":pb,array:Wi,at:mc,boolean:Wi,case:Me,coalesce:_u,collator:vc,format:vu,image:Ad,in:_c,"index-of":re,interpolate:ys,"interpolate-hcl":ys,"interpolate-lab":ys,length:Ed,let:ms,literal:Ni,match:ae,number:Wi,"number-format":Sd,object:Wi,slice:ht,step:hr,string:Wi,"to-boolean":Fi,"to-color":Fi,"to-number":Fi,"to-string":Fi,var:ln,within:Sa,distance:Ia};class Vs{constructor(o,h,f,_){this.name=o,this.type=h,this._evaluate=f,this.args=_}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,h){const f=o[0],_=Vs.definitions[f];if(!_)return h.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,S=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,I=S.filter(([O])=>!Array.isArray(O)||O.length===o.length-1);let P=null;for(const[O,L]of I){P=new Us(h.registry,Tc,h.path,null,h.scope);const H=[];let q=!1;for(let G=1;G<o.length;G++){const ee=o[G],ne=Array.isArray(O)?O[G-1]:O.type,ge=P.parse(ee,1+H.length,ne);if(!ge){q=!0;break}H.push(ge)}if(!q)if(Array.isArray(O)&&O.length!==H.length)P.error(`Expected ${O.length} arguments, but found ${H.length} instead.`);else{for(let G=0;G<H.length;G++){const ee=Array.isArray(O)?O[G]:O.type,ne=H[G];P.concat(G+1).checkSubtype(ee,ne.type)}if(P.errors.length===0)return new Vs(f,w,L,H)}}if(I.length===1)h.errors.push(...P.errors);else{const O=(I.length?I:S).map(([H])=>{return q=H,Array.isArray(q)?`(${q.map(Y).join(", ")})`:`(${Y(q.type)}...)`;var q}).join(" | "),L=[];for(let H=1;H<o.length;H++){const q=h.parse(o[H],1+L.length);if(!q)return null;L.push(Y(q.type))}h.error(`Expected arguments of type ${O}, but found (${L.join(", ")}) instead.`)}return null}static register(o,h){Vs.definitions=h;for(const f in h)o[f]=Vs}}function Fd(c,[o,h,f,_]){o=o.evaluate(c),h=h.evaluate(c),f=f.evaluate(c);const w=_?_.evaluate(c):1,S=Ps(o,h,f,w);if(S)throw new Hn(S);return new qr(o/255,h/255,f/255,w,!1)}function Bd(c,o){return c in o}function Ld(c,o){const h=o[c];return h===void 0?null:h}function Ca(c){return{type:c}}function Tc(c){if(c instanceof ln)return Tc(c.boundExpression);if(c instanceof Vs&&c.name==="error"||c instanceof vc||c instanceof Sa||c instanceof Ia)return!1;const o=c instanceof Fi||c instanceof Wi;let h=!0;return c.eachChild(f=>{h=o?h&&Tc(f):h&&f instanceof Ni}),!!h&&Sc(c)&&Ac(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sc(c){if(c instanceof Vs&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Sa||c instanceof Ia)return!1;let o=!0;return c.eachChild(h=>{o&&!Sc(h)&&(o=!1)}),o}function al(c){if(c instanceof Vs&&c.name==="feature-state")return!1;let o=!0;return c.eachChild(h=>{o&&!al(h)&&(o=!1)}),o}function Ac(c,o){if(c instanceof Vs&&o.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(f=>{h&&!Ac(f,o)&&(h=!1)}),h}function Au(c){return{result:"success",value:c}}function ll(c){return{result:"error",value:c}}function cl(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function a_(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function zd(c){return!!c.expression&&c.expression.interpolated}function An(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Eu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Ab(c){return c}function l_(c,o){const h=o.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",_=f||!(f||c.property!==void 0),w=c.type||(zd(o)?"exponential":"interval");if(h||o.type==="padding"){const L=h?qr.parse:Cn.parse;(c=zr({},c)).stops&&(c.stops=c.stops.map(H=>[H[0],L(H[1])])),c.default=L(c.default?c.default:o.default)}if(c.colorSpace&&(S=c.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var S;let I,P,O;if(w==="exponential")I=u_;else if(w==="interval")I=Iu;else if(w==="categorical"){I=c_,P=Object.create(null);for(const L of c.stops)P[L[0]]=L[1];O=typeof c.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=h_}if(f){const L={},H=[];for(let ee=0;ee<c.stops.length;ee++){const ne=c.stops[ee],ge=ne[0].zoom;L[ge]===void 0&&(L[ge]={zoom:ge,type:c.type,property:c.property,default:c.default,stops:[]},H.push(ge)),L[ge].stops.push([ne[0].value,ne[1]])}const q=[];for(const ee of H)q.push([L[ee].zoom,l_(L[ee],o)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:ys.interpolationFactor.bind(void 0,G),zoomStops:q.map(ee=>ee[0]),evaluate:({zoom:ee},ne)=>u_({stops:q,base:c.base},o,ee).evaluate(ee,ne)}}if(_){const L=w==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:ys.interpolationFactor.bind(void 0,L),zoomStops:c.stops.map(H=>H[0]),evaluate:({zoom:H})=>I(c,o,H,P,O)}}return{kind:"source",evaluate(L,H){const q=H&&H.properties?H.properties[c.property]:void 0;return q===void 0?ul(c.default,o.default):I(c,o,q,P,O)}}}function ul(c,o,h){return c!==void 0?c:o!==void 0?o:h!==void 0?h:void 0}function c_(c,o,h,f,_){return ul(typeof h===_?f[h]:void 0,c.default,o.default)}function Iu(c,o,h){if(An(h)!=="number")return ul(c.default,o.default);const f=c.stops.length;if(f===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[f-1][0])return c.stops[f-1][1];const _=Ft(c.stops.map(w=>w[0]),h);return c.stops[_][1]}function u_(c,o,h){const f=c.base!==void 0?c.base:1;if(An(h)!=="number")return ul(c.default,o.default);const _=c.stops.length;if(_===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[_-1][0])return c.stops[_-1][1];const w=Ft(c.stops.map(L=>L[0]),h),S=function(L,H,q,G){const ee=G-q,ne=L-q;return ee===0?0:H===1?ne/ee:(Math.pow(H,ne)-1)/(Math.pow(H,ee)-1)}(h,f,c.stops[w][0],c.stops[w+1][0]),I=c.stops[w][1],P=c.stops[w+1][1],O=_s[o.type]||Ab;return typeof I.evaluate=="function"?{evaluate(...L){const H=I.evaluate.apply(void 0,L),q=P.evaluate.apply(void 0,L);if(H!==void 0&&q!==void 0)return O(H,q,S,c.colorSpace)}}:O(I,P,S,c.colorSpace)}function h_(c,o,h){switch(o.type){case"color":h=qr.parse(h);break;case"formatted":h=wn.fromString(h.toString());break;case"resolvedImage":h=si.fromString(h.toString());break;case"padding":h=Cn.parse(h);break;default:An(h)===o.type||o.type==="enum"&&o.values[h]||(h=void 0)}return ul(h,c.default,o.default)}Vs.register(ol,{error:[{kind:"error"},[qe],(c,[o])=>{throw new Hn(o.evaluate(c))}],typeof:[qe,[at],(c,[o])=>Y(Ln(o.evaluate(c)))],"to-rgba":[X(Ot,4),[dt],(c,[o])=>{const[h,f,_,w]=o.evaluate(c).rgb;return[255*h,255*f,255*_,w]}],rgb:[dt,[Ot,Ot,Ot],Fd],rgba:[dt,[Ot,Ot,Ot,Ot],Fd],has:{type:$e,overloads:[[[qe],(c,[o])=>Bd(o.evaluate(c),c.properties())],[[qe,xt],(c,[o,h])=>Bd(o.evaluate(c),h.evaluate(c))]]},get:{type:at,overloads:[[[qe],(c,[o])=>Ld(o.evaluate(c),c.properties())],[[qe,xt],(c,[o,h])=>Ld(o.evaluate(c),h.evaluate(c))]]},"feature-state":[at,[qe],(c,[o])=>Ld(o.evaluate(c),c.featureState||{})],properties:[xt,[],c=>c.properties()],"geometry-type":[qe,[],c=>c.geometryType()],id:[at,[],c=>c.id()],zoom:[Ot,[],c=>c.globals.zoom],"heatmap-density":[Ot,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ot,[],c=>c.globals.lineProgress||0],accumulated:[at,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ot,Ca(Ot),(c,o)=>{let h=0;for(const f of o)h+=f.evaluate(c);return h}],"*":[Ot,Ca(Ot),(c,o)=>{let h=1;for(const f of o)h*=f.evaluate(c);return h}],"-":{type:Ot,overloads:[[[Ot,Ot],(c,[o,h])=>o.evaluate(c)-h.evaluate(c)],[[Ot],(c,[o])=>-o.evaluate(c)]]},"/":[Ot,[Ot,Ot],(c,[o,h])=>o.evaluate(c)/h.evaluate(c)],"%":[Ot,[Ot,Ot],(c,[o,h])=>o.evaluate(c)%h.evaluate(c)],ln2:[Ot,[],()=>Math.LN2],pi:[Ot,[],()=>Math.PI],e:[Ot,[],()=>Math.E],"^":[Ot,[Ot,Ot],(c,[o,h])=>Math.pow(o.evaluate(c),h.evaluate(c))],sqrt:[Ot,[Ot],(c,[o])=>Math.sqrt(o.evaluate(c))],log10:[Ot,[Ot],(c,[o])=>Math.log(o.evaluate(c))/Math.LN10],ln:[Ot,[Ot],(c,[o])=>Math.log(o.evaluate(c))],log2:[Ot,[Ot],(c,[o])=>Math.log(o.evaluate(c))/Math.LN2],sin:[Ot,[Ot],(c,[o])=>Math.sin(o.evaluate(c))],cos:[Ot,[Ot],(c,[o])=>Math.cos(o.evaluate(c))],tan:[Ot,[Ot],(c,[o])=>Math.tan(o.evaluate(c))],asin:[Ot,[Ot],(c,[o])=>Math.asin(o.evaluate(c))],acos:[Ot,[Ot],(c,[o])=>Math.acos(o.evaluate(c))],atan:[Ot,[Ot],(c,[o])=>Math.atan(o.evaluate(c))],min:[Ot,Ca(Ot),(c,o)=>Math.min(...o.map(h=>h.evaluate(c)))],max:[Ot,Ca(Ot),(c,o)=>Math.max(...o.map(h=>h.evaluate(c)))],abs:[Ot,[Ot],(c,[o])=>Math.abs(o.evaluate(c))],round:[Ot,[Ot],(c,[o])=>{const h=o.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[Ot,[Ot],(c,[o])=>Math.floor(o.evaluate(c))],ceil:[Ot,[Ot],(c,[o])=>Math.ceil(o.evaluate(c))],"filter-==":[$e,[qe,at],(c,[o,h])=>c.properties()[o.value]===h.value],"filter-id-==":[$e,[at],(c,[o])=>c.id()===o.value],"filter-type-==":[$e,[qe],(c,[o])=>c.geometryType()===o.value],"filter-<":[$e,[qe,at],(c,[o,h])=>{const f=c.properties()[o.value],_=h.value;return typeof f==typeof _&&f<_}],"filter-id-<":[$e,[at],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h<f}],"filter->":[$e,[qe,at],(c,[o,h])=>{const f=c.properties()[o.value],_=h.value;return typeof f==typeof _&&f>_}],"filter-id->":[$e,[at],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h>f}],"filter-<=":[$e,[qe,at],(c,[o,h])=>{const f=c.properties()[o.value],_=h.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[$e,[at],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h<=f}],"filter->=":[$e,[qe,at],(c,[o,h])=>{const f=c.properties()[o.value],_=h.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[$e,[at],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h>=f}],"filter-has":[$e,[at],(c,[o])=>o.value in c.properties()],"filter-has-id":[$e,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[$e,[X(qe)],(c,[o])=>o.value.indexOf(c.geometryType())>=0],"filter-id-in":[$e,[X(at)],(c,[o])=>o.value.indexOf(c.id())>=0],"filter-in-small":[$e,[qe,X(at)],(c,[o,h])=>h.value.indexOf(c.properties()[o.value])>=0],"filter-in-large":[$e,[qe,X(at)],(c,[o,h])=>function(f,_,w,S){for(;w<=S;){const I=w+S>>1;if(_[I]===f)return!0;_[I]>f?S=I-1:w=I+1}return!1}(c.properties()[o.value],h.value,0,h.value.length-1)],all:{type:$e,overloads:[[[$e,$e],(c,[o,h])=>o.evaluate(c)&&h.evaluate(c)],[Ca($e),(c,o)=>{for(const h of o)if(!h.evaluate(c))return!1;return!0}]]},any:{type:$e,overloads:[[[$e,$e],(c,[o,h])=>o.evaluate(c)||h.evaluate(c)],[Ca($e),(c,o)=>{for(const h of o)if(h.evaluate(c))return!0;return!1}]]},"!":[$e,[$e],(c,[o])=>!o.evaluate(c)],"is-supported-script":[$e,[qe],(c,[o])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(o.evaluate(c))}],upcase:[qe,[qe],(c,[o])=>o.evaluate(c).toUpperCase()],downcase:[qe,[qe],(c,[o])=>o.evaluate(c).toLowerCase()],concat:[qe,Ca(at),(c,o)=>o.map(h=>ki(h.evaluate(c))).join("")],"resolved-locale":[qe,[Dt],(c,[o])=>o.evaluate(c).resolvedLocale()]});class Cu{constructor(o,h){var f;this.expression=o,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=h?(f=h).type==="color"&&Eu(f.default)?new qr(0,0,0,0):f.type==="color"?qr.parse(f.default)||null:f.type==="padding"?Cn.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Sn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(o,h,f,_,w,S){return this._evaluator.globals=o,this._evaluator.feature=h,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(o,h,f,_,w,S){this._evaluator.globals=o,this._evaluator.feature=h||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Hn(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Pu(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ol}function hl(c,o){const h=new Us(ol,Tc,[],o?function(_){const w={color:dt,string:qe,number:Ot,enum:qe,boolean:$e,formatted:br,padding:tn,resolvedImage:pn,variableAnchorOffsetCollection:de};return _.type==="array"?X(w[_.value]||at,_.length):w[_.type]}(o):void 0),f=h.parse(c,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Au(new Cu(f,o)):ll(h.errors)}class dl{constructor(o,h){this.kind=o,this._styleExpression=h,this.isStateDependent=o!=="constant"&&!al(h.expression)}evaluateWithoutErrorHandling(o,h,f,_,w,S){return this._styleExpression.evaluateWithoutErrorHandling(o,h,f,_,w,S)}evaluate(o,h,f,_,w,S){return this._styleExpression.evaluate(o,h,f,_,w,S)}}class fl{constructor(o,h,f,_){this.kind=o,this.zoomStops=f,this._styleExpression=h,this.isStateDependent=o!=="camera"&&!al(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,h,f,_,w,S){return this._styleExpression.evaluateWithoutErrorHandling(o,h,f,_,w,S)}evaluate(o,h,f,_,w,S){return this._styleExpression.evaluate(o,h,f,_,w,S)}interpolationFactor(o,h,f){return this.interpolationType?ys.interpolationFactor(this.interpolationType,o,h,f):0}}function Ud(c,o){const h=hl(c,o);if(h.result==="error")return h;const f=h.value.expression,_=Sc(f);if(!_&&!cl(o))return ll([new Mr("","data expressions not supported")]);const w=Ac(f,["zoom"]);if(!w&&!a_(o))return ll([new Mr("","zoom expressions not supported")]);const S=Ec(f);return S||w?S instanceof Mr?ll([S]):S instanceof ys&&!zd(o)?ll([new Mr("",'"interpolate" expressions cannot be used with this property')]):Au(S?new fl(_?"camera":"composite",h.value,S.labels,S instanceof ys?S.interpolation:void 0):new dl(_?"constant":"source",h.value)):ll([new Mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pl{constructor(o,h){this._parameters=o,this._specification=h,zr(this,l_(this._parameters,this._specification))}static deserialize(o){return new pl(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Ec(c){let o=null;if(c instanceof ms)o=Ec(c.result);else if(c instanceof _u){for(const h of c.args)if(o=Ec(h),o)break}else(c instanceof hr||c instanceof ys)&&c.input instanceof Vs&&c.input.name==="zoom"&&(o=c);return o instanceof Mr||c.eachChild(h=>{const f=Ec(h);f instanceof Mr?o=f:!o&&f?o=new Mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new Mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Ru(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const o of c.slice(1))if(!Ru(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const ku={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vd(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Ru(c)||(c=Mu(c));const o=hl(c,ku);if(o.result==="error")throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,f,_)=>o.value.evaluate(h,f,{},_),needGeometry:d_(c)}}function Eb(c,o){return c<o?-1:c>o?1:0}function d_(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let o=1;o<c.length;o++)if(d_(c[o]))return!0;return!1}function Mu(c){if(!c)return!0;const o=c[0];return c.length<=1?o!=="any":o==="=="?jd(c[1],c[2],"=="):o==="!="?Ji(jd(c[1],c[2],"==")):o==="<"||o===">"||o==="<="||o===">="?jd(c[1],c[2],o):o==="any"?(h=c.slice(1),["any"].concat(h.map(Mu))):o==="all"?["all"].concat(c.slice(1).map(Mu)):o==="none"?["all"].concat(c.slice(1).map(Mu).map(Ji)):o==="in"?Ic(c[1],c.slice(2)):o==="!in"?Ji(Ic(c[1],c.slice(2))):o==="has"?Cc(c[1]):o!=="!has"||Ji(Cc(c[1]));var h}function jd(c,o,h){switch(c){case"$type":return[`filter-type-${h}`,o];case"$id":return[`filter-id-${h}`,o];default:return[`filter-${h}`,c,o]}}function Ic(c,o){if(o.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(h=>typeof h!=typeof o[0])?["filter-in-large",c,["literal",o.sort(Eb)]]:["filter-in-small",c,["literal",o]]}}function Cc(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ji(c){return["!",c]}function Pa(c){const o=typeof c;if(o==="number"||o==="boolean"||o==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const w of c)_+=`${Pa(w)},`;return`${_}]`}const h=Object.keys(c).sort();let f="{";for(let _=0;_<h.length;_++)f+=`${JSON.stringify(h[_])}:${Pa(c[h[_]])},`;return`${f}}`}function f_(c){let o="";for(const h of Qt)o+=`/${Pa(c[h])}`;return o}function p_(c){const o=c.value;return o?[new bt(c.key,o,"constants have been deprecated as of v8")]:[]}function gi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Js(c){if(Array.isArray(c))return c.map(Js);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const o={};for(const h in c)o[h]=Js(c[h]);return o}return gi(c)}function Rs(c){const o=c.key,h=c.value,f=c.valueSpec||{},_=c.objectElementValidators||{},w=c.style,S=c.styleSpec,I=c.validateSpec;let P=[];const O=An(h);if(O!=="object")return[new bt(o,h,`object expected, ${O} found`)];for(const L in h){const H=L.split(".")[0],q=f[H]||f["*"];let G;if(_[H])G=_[H];else if(f[H])G=I;else if(_["*"])G=_["*"];else{if(!f["*"]){P.push(new bt(o,h[L],`unknown property "${L}"`));continue}G=I}P=P.concat(G({key:(o&&`${o}.`)+L,value:h[L],valueSpec:q,style:w,styleSpec:S,object:h,objectKey:L,validateSpec:I},h))}for(const L in f)_[L]||f[L].required&&f[L].default===void 0&&h[L]===void 0&&P.push(new bt(o,h,`missing required property "${L}"`));return P}function Pc(c){const o=c.value,h=c.valueSpec,f=c.style,_=c.styleSpec,w=c.key,S=c.arrayElementValidator||c.validateSpec;if(An(o)!=="array")return[new bt(w,o,`array expected, ${An(o)} found`)];if(h.length&&o.length!==h.length)return[new bt(w,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new bt(w,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let I={type:h.value,values:h.values};_.$version<7&&(I.function=h.function),An(h.value)==="object"&&(I=h.value);let P=[];for(let O=0;O<o.length;O++)P=P.concat(S({array:o,arrayIndex:O,value:o[O],valueSpec:I,validateSpec:c.validateSpec,style:f,styleSpec:_,key:`${w}[${O}]`}));return P}function Hd(c){const o=c.key,h=c.value,f=c.valueSpec;let _=An(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new bt(o,h,`number expected, ${_} found`)]:"minimum"in f&&h<f.minimum?[new bt(o,h,`${h} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&h>f.maximum?[new bt(o,h,`${h} is greater than the maximum value ${f.maximum}`)]:[]}function Ou(c){const o=c.valueSpec,h=gi(c.value.type);let f,_,w,S={};const I=h!=="categorical"&&c.value.property===void 0,P=!I,O=An(c.value.stops)==="array"&&An(c.value.stops[0])==="array"&&An(c.value.stops[0][0])==="object",L=Rs({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(G){if(h==="identity")return[new bt(G.key,G.value,'identity function may not have a "stops" property')];let ee=[];const ne=G.value;return ee=ee.concat(Pc({key:G.key,value:ne,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:H})),An(ne)==="array"&&ne.length===0&&ee.push(new bt(G.key,ne,"array must have at least one stop")),ee},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:o,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return h==="identity"&&I&&L.push(new bt(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||L.push(new bt(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!zd(c.valueSpec)&&L.push(new bt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(P&&!cl(c.valueSpec)?L.push(new bt(c.key,c.value,"property functions not supported")):I&&!a_(c.valueSpec)&&L.push(new bt(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!O||c.value.property!==void 0||L.push(new bt(c.key,c.value,'"property" property is required')),L;function H(G){let ee=[];const ne=G.value,ge=G.key;if(An(ne)!=="array")return[new bt(ge,ne,`array expected, ${An(ne)} found`)];if(ne.length!==2)return[new bt(ge,ne,`array length 2 expected, length ${ne.length} found`)];if(O){if(An(ne[0])!=="object")return[new bt(ge,ne,`object expected, ${An(ne[0])} found`)];if(ne[0].zoom===void 0)return[new bt(ge,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new bt(ge,ne,"object stop key must have value")];if(w&&w>gi(ne[0].zoom))return[new bt(ge,ne[0].zoom,"stop zoom values must appear in ascending order")];gi(ne[0].zoom)!==w&&(w=gi(ne[0].zoom),_=void 0,S={}),ee=ee.concat(Rs({key:`${ge}[0]`,value:ne[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Hd,value:q}}))}else ee=ee.concat(q({key:`${ge}[0]`,value:ne[0],validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},ne));return Pu(Js(ne[1]))?ee.concat([new bt(`${ge}[1]`,ne[1],"expressions are not allowed in function stops.")]):ee.concat(G.validateSpec({key:`${ge}[1]`,value:ne[1],valueSpec:o,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function q(G,ee){const ne=An(G.value),ge=gi(G.value),Ae=G.value!==null?G.value:ee;if(f){if(ne!==f)return[new bt(G.key,Ae,`${ne} stop domain type must match previous stop domain type ${f}`)]}else f=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new bt(G.key,Ae,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&h!=="categorical"){let tt=`number expected, ${ne} found`;return cl(o)&&h===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(G.key,Ae,tt)]}return h!=="categorical"||ne!=="number"||isFinite(ge)&&Math.floor(ge)===ge?h!=="categorical"&&ne==="number"&&_!==void 0&&ge<_?[new bt(G.key,Ae,"stop domain values must appear in ascending order")]:(_=ge,h==="categorical"&&ge in S?[new bt(G.key,Ae,"stop domain values must be unique")]:(S[ge]=!0,[])):[new bt(G.key,Ae,`integer expected, found ${ge}`)]}}function gl(c){const o=(c.expressionContext==="property"?Ud:hl)(Js(c.value),c.valueSpec);if(o.result==="error")return o.value.map(f=>new bt(`${c.key}${f.key}`,c.value,f.message));const h=o.value.expression||o.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new bt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!al(h))return[new bt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!al(h))return[new bt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Ac(h,["zoom","feature-state"]))return[new bt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Sc(h))return[new bt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Oo(c){const o=c.key,h=c.value,f=c.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(gi(h))===-1&&_.push(new bt(o,h,`expected one of [${f.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(f.values).indexOf(gi(h))===-1&&_.push(new bt(o,h,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function Wd(c){return Ru(Js(c.value))?gl(zr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Du(c)}function Du(c){const o=c.value,h=c.key;if(An(o)!=="array")return[new bt(h,o,`array expected, ${An(o)} found`)];const f=c.styleSpec;let _,w=[];if(o.length<1)return[new bt(h,o,"filter array must have at least 1 element")];switch(w=w.concat(Oo({key:`${h}[0]`,value:o[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),gi(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&gi(o[1])==="$type"&&w.push(new bt(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&w.push(new bt(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=An(o[1]),_!=="string"&&w.push(new bt(`${h}[1]`,o[1],`string expected, ${_} found`)));for(let S=2;S<o.length;S++)_=An(o[S]),gi(o[1])==="$type"?w=w.concat(Oo({key:`${h}[${S}]`,value:o[S],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new bt(`${h}[${S}]`,o[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)w=w.concat(Du({key:`${h}[${S}]`,value:o[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=An(o[1]),o.length!==2?w.push(new bt(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new bt(`${h}[1]`,o[1],`string expected, ${_} found`))}return w}function $d(c,o){const h=c.key,f=c.validateSpec,_=c.style,w=c.styleSpec,S=c.value,I=c.objectKey,P=w[`${o}_${c.layerType}`];if(!P)return[];const O=I.match(/^(.*)-transition$/);if(o==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return f({key:h,value:S,valueSpec:w.transition,style:_,styleSpec:w});const L=c.valueSpec||P[I];if(!L)return[new bt(h,S,`unknown property "${I}"`)];let H;if(An(S)==="string"&&cl(L)&&!L.tokens&&(H=/^{([^}]+)}$/.exec(S)))return[new bt(h,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const q=[];return c.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&q.push(new bt(h,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Eu(Js(S))&&gi(S.type)==="identity"&&q.push(new bt(h,S,'"text-font" does not support identity functions'))),q.concat(f({key:c.key,value:S,valueSpec:L,style:_,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:I}))}function Nu(c){return $d(c,"paint")}function qd(c){return $d(c,"layout")}function Xd(c){let o=[];const h=c.value,f=c.key,_=c.style,w=c.styleSpec;h.type||h.ref||o.push(new bt(f,h,'either "type" or "ref" is required'));let S=gi(h.type);const I=gi(h.ref);if(h.id){const P=gi(h.id);for(let O=0;O<c.arrayIndex;O++){const L=_.layers[O];gi(L.id)===P&&o.push(new bt(f,h.id,`duplicate layer id "${h.id}", previously used at line ${L.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&o.push(new bt(f,h[O],`"${O}" is prohibited for ref layers`))}),_.layers.forEach(O=>{gi(O.id)===I&&(P=O)}),P?P.ref?o.push(new bt(f,h.ref,"ref cannot reference another ref layer")):S=gi(P.type):o.push(new bt(f,h.ref,`ref layer "${I}" not found`))}else if(S!=="background")if(h.source){const P=_.sources&&_.sources[h.source],O=P&&gi(P.type);P?O==="vector"&&S==="raster"?o.push(new bt(f,h.source,`layer "${h.id}" requires a raster source`)):O!=="raster-dem"&&S==="hillshade"?o.push(new bt(f,h.source,`layer "${h.id}" requires a raster-dem source`)):O==="raster"&&S!=="raster"?o.push(new bt(f,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&S!=="hillshade"?o.push(new bt(f,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!h.paint||!h.paint["line-gradient"]||O==="geojson"&&P.lineMetrics||o.push(new bt(f,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new bt(f,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new bt(f,h.source,`source "${h.source}" not found`))}else o.push(new bt(f,h,'missing required property "source"'));return o=o.concat(Rs({key:f,value:h,valueSpec:w.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:h.type,valueSpec:w.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:Wd,layout:P=>Rs({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>qd(zr({layerType:S},O))}}),paint:P=>Rs({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>Nu(zr({layerType:S},O))}})}})),o}function Ra(c){const o=c.value,h=c.key,f=An(o);return f!=="string"?[new bt(h,o,`string expected, ${f} found`)]:[]}const Fu={promoteId:function({key:c,value:o}){if(An(o)==="string")return Ra({key:c,value:o});{const h=[];for(const f in o)h.push(...Ra({key:`${c}.${f}`,value:o[f]}));return h}}};function Rc(c){const o=c.value,h=c.key,f=c.styleSpec,_=c.style,w=c.validateSpec;if(!o.type)return[new bt(h,o,'"type" is required')];const S=gi(o.type);let I;switch(S){case"vector":case"raster":return I=Rs({key:h,value:o,valueSpec:f[`source_${S.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:Fu,validateSpec:w}),I;case"raster-dem":return I=function(P){var O;const L=(O=P.sourceName)!==null&&O!==void 0?O:"",H=P.value,q=P.styleSpec,G=q.source_raster_dem,ee=P.style;let ne=[];const ge=An(H);if(H===void 0)return ne;if(ge!=="object")return ne.push(new bt("source_raster_dem",H,`object expected, ${ge} found`)),ne;const Ae=gi(H.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],Le=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Ye in H)!Ae&&tt.includes(Ye)?ne.push(new bt(Ye,H[Ye],`In "${L}": "${Ye}" is only valid when "encoding" is set to "custom". ${Le} encoding found`)):G[Ye]?ne=ne.concat(P.validateSpec({key:Ye,value:H[Ye],valueSpec:G[Ye],validateSpec:P.validateSpec,style:ee,styleSpec:q})):ne.push(new bt(Ye,H[Ye],`unknown property "${Ye}"`));return ne}({sourceName:h,value:o,style:c.style,styleSpec:f,validateSpec:w}),I;case"geojson":if(I=Rs({key:h,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:w,objectElementValidators:Fu}),o.cluster)for(const P in o.clusterProperties){const[O,L]=o.clusterProperties[P],H=typeof O=="string"?[O,["accumulated"],["get",P]]:O;I.push(...gl({key:`${h}.${P}.map`,value:L,expressionContext:"cluster-map"})),I.push(...gl({key:`${h}.${P}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return I;case"video":return Rs({key:h,value:o,valueSpec:f.source_video,style:_,validateSpec:w,styleSpec:f});case"image":return Rs({key:h,value:o,valueSpec:f.source_image,style:_,validateSpec:w,styleSpec:f});case"canvas":return[new bt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oo({key:`${h}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Zd(c){const o=c.value,h=c.styleSpec,f=h.light,_=c.style;let w=[];const S=An(o);if(o===void 0)return w;if(S!=="object")return w=w.concat([new bt("light",o,`object expected, ${S} found`)]),w;for(const I in o){const P=I.match(/^(.*)-transition$/);w=w.concat(P&&f[P[1]]&&f[P[1]].transition?c.validateSpec({key:I,value:o[I],valueSpec:h.transition,validateSpec:c.validateSpec,style:_,styleSpec:h}):f[I]?c.validateSpec({key:I,value:o[I],valueSpec:f[I],validateSpec:c.validateSpec,style:_,styleSpec:h}):[new bt(I,o[I],`unknown property "${I}"`)])}return w}function Yd(c){const o=c.value,h=c.styleSpec,f=h.sky,_=c.style,w=An(o);if(o===void 0)return[];if(w!=="object")return[new bt("sky",o,`object expected, ${w} found`)];let S=[];for(const I in o)S=S.concat(f[I]?c.validateSpec({key:I,value:o[I],valueSpec:f[I],style:_,styleSpec:h}):[new bt(I,o[I],`unknown property "${I}"`)]);return S}function Kd(c){const o=c.value,h=c.styleSpec,f=h.terrain,_=c.style;let w=[];const S=An(o);if(o===void 0)return w;if(S!=="object")return w=w.concat([new bt("terrain",o,`object expected, ${S} found`)]),w;for(const I in o)w=w.concat(f[I]?c.validateSpec({key:I,value:o[I],valueSpec:f[I],validateSpec:c.validateSpec,style:_,styleSpec:h}):[new bt(I,o[I],`unknown property "${I}"`)]);return w}function Gd(c){let o=[];const h=c.value,f=c.key;if(Array.isArray(h)){const _=[],w=[];for(const S in h)h[S].id&&_.includes(h[S].id)&&o.push(new bt(f,h,`all the sprites' ids must be unique, but ${h[S].id} is duplicated`)),_.push(h[S].id),h[S].url&&w.includes(h[S].url)&&o.push(new bt(f,h,`all the sprites' URLs must be unique, but ${h[S].url} is duplicated`)),w.push(h[S].url),o=o.concat(Rs({key:`${f}[${S}]`,value:h[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return o}return Ra({key:f,value:h})}const Bu={"*":()=>[],array:Pc,boolean:function(c){const o=c.value,h=c.key,f=An(o);return f!=="boolean"?[new bt(h,o,`boolean expected, ${f} found`)]:[]},number:Hd,color:function(c){const o=c.key,h=c.value,f=An(h);return f!=="string"?[new bt(o,h,`color expected, ${f} found`)]:qr.parse(String(h))?[]:[new bt(o,h,`color expected, "${h}" found`)]},constants:p_,enum:Oo,filter:Wd,function:Ou,layer:Xd,object:Rs,source:Rc,light:Zd,sky:Yd,terrain:Kd,projection:function(c){const o=c.value,h=c.styleSpec,f=h.projection,_=c.style,w=An(o);if(o===void 0)return[];if(w!=="object")return[new bt("projection",o,`object expected, ${w} found`)];let S=[];for(const I in o)S=S.concat(f[I]?c.validateSpec({key:I,value:o[I],valueSpec:f[I],style:_,styleSpec:h}):[new bt(I,o[I],`unknown property "${I}"`)]);return S},string:Ra,formatted:function(c){return Ra(c).length===0?[]:gl(c)},resolvedImage:function(c){return Ra(c).length===0?[]:gl(c)},padding:function(c){const o=c.key,h=c.value;if(An(h)==="array"){if(h.length<1||h.length>4)return[new bt(o,h,`padding requires 1 to 4 values; ${h.length} values found`)];const f={type:"number"};let _=[];for(let w=0;w<h.length;w++)_=_.concat(c.validateSpec({key:`${o}[${w}]`,value:h[w],validateSpec:c.validateSpec,valueSpec:f}));return _}return Hd({key:o,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const o=c.key,h=c.value,f=An(h),_=c.styleSpec;if(f!=="array"||h.length<1||h.length%2!=0)return[new bt(o,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let S=0;S<h.length;S+=2)w=w.concat(Oo({key:`${o}[${S}]`,value:h[S],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Pc({key:`${o}[${S+1}]`,value:h[S+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return w},sprite:Gd};function kc(c){const o=c.value,h=c.valueSpec,f=c.styleSpec;return c.validateSpec=kc,h.expression&&Eu(gi(o))?Ou(c):h.expression&&Pu(Js(o))?gl(c):h.type&&Bu[h.type]?Bu[h.type](c):Rs(zr({},c,{valueSpec:h.type?f[h.type]:h}))}function g_(c){const o=c.value,h=c.key,f=Ra(c);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new bt(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new bt(h,o,'"glyphs" url must include a "{range}" token'))),f}function js(c,o=Te){let h=[];return h=h.concat(kc({key:"",value:c,valueSpec:o.$root,styleSpec:o,style:c,validateSpec:kc,objectElementValidators:{glyphs:g_,"*":()=>[]}})),c.constants&&(h=h.concat(p_({key:"constants",value:c.constants}))),Jd(h)}function mo(c){return function(o){return c({...o,validateSpec:kc})}}function Jd(c){return[].concat(c).sort((o,h)=>o.line-h.line)}function Qs(c){return function(...o){return Jd(c.apply(this,o))}}js.source=Qs(mo(Rc)),js.sprite=Qs(mo(Gd)),js.glyphs=Qs(mo(g_)),js.light=Qs(mo(Zd)),js.sky=Qs(mo(Yd)),js.terrain=Qs(mo(Kd)),js.layer=Qs(mo(Xd)),js.filter=Qs(mo(Wd)),js.paintProperty=Qs(mo(Nu)),js.layoutProperty=Qs(mo(qd));const ka=js,Ib=ka.light,Cb=ka.sky,m_=ka.paintProperty,__=ka.layoutProperty;function Qd(c,o){let h=!1;if(o&&o.length)for(const f of o)c.fire(new Nr(new Error(f.message))),h=!0;return h}class ml{constructor(o,h,f){const _=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const S=new Int32Array(this.arrayBuffer);o=S[0],this.d=(h=S[1])+2*(f=S[2]);for(let P=0;P<this.d*this.d;P++){const O=S[3+P],L=S[3+P+1];_.push(O===L?null:S.subarray(O,L))}const I=S[3+_.length+1];this.keys=S.subarray(S[3+_.length],I),this.bboxes=S.subarray(I),this.insert=this._insertReadonly}else{this.d=h+2*f;for(let S=0;S<this.d*this.d;S++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=o,this.padding=f,this.scale=h/o,this.uid=0;const w=f/h*o;this.min=-w,this.max=o+w}insert(o,h,f,_,w){this._forEachCell(h,f,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,h,f,_,w,S){this.cells[w].push(S)}query(o,h,f,_,w){const S=this.min,I=this.max;if(o<=S&&h<=S&&I<=f&&I<=_&&!w)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(o,h,f,_,this._queryCell,P,{},w),P}}_queryCell(o,h,f,_,w,S,I,P){const O=this.cells[w];if(O!==null){const L=this.keys,H=this.bboxes;for(let q=0;q<O.length;q++){const G=O[q];if(I[G]===void 0){const ee=4*G;(P?P(H[ee+0],H[ee+1],H[ee+2],H[ee+3]):o<=H[ee+2]&&h<=H[ee+3]&&f>=H[ee+0]&&_>=H[ee+1])?(I[G]=!0,S.push(L[G])):I[G]=!1}}}}_forEachCell(o,h,f,_,w,S,I,P){const O=this._convertToCellCoord(o),L=this._convertToCellCoord(h),H=this._convertToCellCoord(f),q=this._convertToCellCoord(_);for(let G=O;G<=H;G++)for(let ee=L;ee<=q;ee++){const ne=this.d*ee+G;if((!P||P(this._convertFromCellCoord(G),this._convertFromCellCoord(ee),this._convertFromCellCoord(G+1),this._convertFromCellCoord(ee+1)))&&w.call(this,o,h,f,_,ne,S,I,P))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,h=3+this.cells.length+1+1;let f=0;for(let S=0;S<this.cells.length;S++)f+=this.cells[S].length;const _=new Int32Array(h+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=h;for(let S=0;S<o.length;S++){const I=o[S];_[3+S]=w,_.set(I,w),w+=I.length}return _[3+o.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+o.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(o,h){const f=o.toArrayBuffer();return h&&h.push(f),{buffer:f}}static deserialize(o){return new ml(o.buffer)}}const Hs={};function lr(c,o,h={}){if(Hs[c])throw new Error(`${c} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:c,writeable:!1}),Hs[c]={klass:o,omit:h.omit||[],shallow:h.shallow||[]}}lr("Object",Object),lr("TransferableGridIndex",ml),lr("Color",qr),lr("Error",Error),lr("AJAXError",ir),lr("ResolvedImage",si),lr("StylePropertyFunction",pl),lr("StyleExpression",Cu,{omit:["_evaluator"]}),lr("ZoomDependentExpression",fl),lr("ZoomConstantExpression",dl),lr("CompoundExpression",Vs,{omit:["_evaluate"]});for(const c in ol)ol[c]._classRegistryKey||lr(`Expression_${c}`,ol[c]);function Lu(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ef(c){return c.$name||c.constructor._classRegistryKey}function y_(c){return!function(o){if(o===null||typeof o!="object")return!1;const h=ef(o);return!(!h||h==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Lu(c)||Qe(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function _l(c,o){if(y_(c))return(Lu(c)||Qe(c))&&o&&o.push(c),ArrayBuffer.isView(c)&&o&&o.push(c.buffer),c instanceof ImageData&&o&&o.push(c.data.buffer),c;if(Array.isArray(c)){const w=[];for(const S of c)w.push(_l(S,o));return w}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const h=ef(c);if(!h)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!Hs[h])throw new Error(`${h} is not registered.`);const{klass:f}=Hs[h],_=f.serialize?f.serialize(c,o):{};if(f.serialize){if(o&&_===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in c){if(!c.hasOwnProperty(w)||Hs[h].omit.indexOf(w)>=0)continue;const S=c[w];_[w]=Hs[h].shallow.indexOf(w)>=0?S:_l(S,o)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(_.$name=h),_}function yl(c){if(y_(c))return c;if(Array.isArray(c))return c.map(yl);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const o=ef(c)||"Object";if(!Hs[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:h}=Hs[o];if(!h)throw new Error(`can't deserialize unregistered class ${o}`);if(h.deserialize)return h.deserialize(c);const f=Object.create(h.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const w=c[_];f[_]=Hs[o].shallow.indexOf(_)>=0?w:yl(w)}return f}class tf{constructor(){this.first=!0}update(o,h){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=h),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const vn={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function rf(c){for(const o of c)if(sf(o.charCodeAt(0)))return!0;return!1}function Pb(c){for(const o of c)if(!vl(o.charCodeAt(0)))return!1;return!0}function nf(c){const o=c.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(o.join("|"),"u")}const Rb=nf(["Arab","Dupl","Mong","Ougr","Syrc"]);function vl(c){return!Rb.test(String.fromCodePoint(c))}const v_=nf(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function sf(c){return!(c!==746&&c!==747&&(c<4352||!(vn["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||vn["CJK Compatibility"](c)||vn["CJK Strokes"](c)||!(!vn["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||vn["Enclosed CJK Letters and Months"](c)||vn["Ideographic Description Characters"](c)||vn.Kanbun(c)||vn.Katakana(c)&&c!==12540||!(!vn["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!vn["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||vn["Vertical Forms"](c)||vn["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||v_.test(String.fromCodePoint(c)))))}function b_(c){return!(sf(c)||function(o){return!!(vn["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||vn["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||vn["Letterlike Symbols"](o)||vn["Number Forms"](o)||vn["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||vn["Control Pictures"](o)&&o!==9251||vn["Optical Character Recognition"](o)||vn["Enclosed Alphanumerics"](o)||vn["Geometric Shapes"](o)||vn["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||vn["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||vn["CJK Symbols and Punctuation"](o)||vn.Katakana(o)||vn["Private Use Area"](o)||vn["CJK Compatibility Forms"](o)||vn["Small Form Variants"](o)||vn["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(c))}const kb=nf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function of(c){return kb.test(String.fromCodePoint(c))}function Mb(c,o){return!(!o&&of(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||vn.Khmer(c))}function Ob(c){for(const o of c)if(of(o.charCodeAt(0)))return!0;return!1}const ks=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Zn{constructor(o,h){this.zoom=o,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new tf,this.transition={})}isSupportedScript(o){return function(h,f){for(const _ of h)if(!Mb(_.charCodeAt(0),f))return!1;return!0}(o,ks.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,h=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*h}}}class bl{constructor(o,h){this.property=o,this.value=h,this.expression=function(f,_){if(Eu(f))return new pl(f,_);if(Pu(f)){const w=Ud(f,_);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=f;return _.type==="color"&&typeof f=="string"?w=qr.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Sn.parse(f)):w=Cn.parse(f),{kind:"constant",evaluate:()=>w}}}(h===void 0?o.specification.default:h,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,h,f){return this.property.possiblyEvaluate(this,o,h,f)}}class zu{constructor(o){this.property=o,this.value=new bl(o,void 0)}transitioned(o,h){return new x_(this.property,this.value,h,le({},o.transition,this.transition),o.now)}untransitioned(){return new x_(this.property,this.value,null,{},0)}}class Uu{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return De(this._values[o].value.value)}setValue(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new zu(this._values[o].property)),this._values[o].value=new bl(this._values[o].property,h===null?void 0:De(h))}getTransition(o){return De(this._values[o].transition)}setTransition(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new zu(this._values[o].property)),this._values[o].transition=De(h)||void 0}serialize(){const o={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(o[h]=f);const _=this.getTransition(h);_!==void 0&&(o[`${h}-transition`]=_)}return o}transitioned(o,h){const f=new Mc(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(o,h._values[_]);return f}untransitioned(){const o=new Mc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].untransitioned();return o}}class x_{constructor(o,h,f,_,w){this.property=o,this.value=h,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,o.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(o,h,f){const _=o.now||0,w=this.value.possiblyEvaluate(o,h,f),S=this.prior;if(S){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return S.possiblyEvaluate(o,h,f);{const I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(o,h,f),w,function(P){if(P<=0)return 0;if(P>=1)return 1;const O=P*P,L=O*P;return 4*(P<.5?L:3*(P-O)+L-.75)}(I))}}return w}}class Mc{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,h,f){const _=new Dc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(o,h,f);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Oc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return De(this._values[o].value)}setValue(o,h){this._values[o]=new bl(this._values[o].property,h===null?void 0:De(h))}serialize(){const o={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(o[h]=f)}return o}possiblyEvaluate(o,h,f){const _=new Dc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(o,h,f);return _}}class _o{constructor(o,h,f){this.property=o,this.value=h,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,h,f,_){return this.property.evaluate(this.value,this.parameters,o,h,f,_)}}class Dc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class mr{constructor(o){this.specification=o}possiblyEvaluate(o,h){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(h)}interpolate(o,h,f){const _=_s[this.specification.type];return _?_(o,h,f):o}}class Vr{constructor(o,h){this.specification=o,this.overrides=h}possiblyEvaluate(o,h,f,_){return new _o(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(h,null,{},f,_)}:o.expression,h)}interpolate(o,h,f){if(o.value.kind!=="constant"||h.value.kind!=="constant")return o;if(o.value.value===void 0||h.value.value===void 0)return new _o(this,{kind:"constant",value:void 0},o.parameters);const _=_s[this.specification.type];if(_){const w=_(o.value.value,h.value.value,f);return new _o(this,{kind:"constant",value:w},o.parameters)}return o}evaluate(o,h,f,_,w,S){return o.kind==="constant"?o.value:o.evaluate(h,f,_,w,S)}}class Vu extends Vr{possiblyEvaluate(o,h,f,_){if(o.value===void 0)return new _o(this,{kind:"constant",value:void 0},h);if(o.expression.kind==="constant"){const w=o.expression.evaluate(h,null,{},f,_),S=o.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(S,S,S,h);return new _o(this,{kind:"constant",value:I},h)}if(o.expression.kind==="camera"){const w=this._calculate(o.expression.evaluate({zoom:h.zoom-1}),o.expression.evaluate({zoom:h.zoom}),o.expression.evaluate({zoom:h.zoom+1}),h);return new _o(this,{kind:"constant",value:w},h)}return new _o(this,o.expression,h)}evaluate(o,h,f,_,w,S){if(o.kind==="source"){const I=o.evaluate(h,f,_,w,S);return this._calculate(I,I,I,h)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(h.zoom)-1},f,_),o.evaluate({zoom:Math.floor(h.zoom)},f,_),o.evaluate({zoom:Math.floor(h.zoom)+1},f,_),h):o.value}_calculate(o,h,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:f,to:h}}interpolate(o){return o}}class ju{constructor(o){this.specification=o}possiblyEvaluate(o,h,f,_){if(o.value!==void 0){if(o.expression.kind==="constant"){const w=o.expression.evaluate(h,null,{},f,_);return this._calculate(w,w,w,h)}return this._calculate(o.expression.evaluate(new Zn(Math.floor(h.zoom-1),h)),o.expression.evaluate(new Zn(Math.floor(h.zoom),h)),o.expression.evaluate(new Zn(Math.floor(h.zoom+1),h)),h)}}_calculate(o,h,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:f,to:h}}interpolate(o){return o}}class af{constructor(o){this.specification=o}possiblyEvaluate(o,h,f,_){return!!o.expression.evaluate(h,null,{},f,_)}interpolate(){return!1}}class b{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in o){const f=o[h];f.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new bl(f,void 0),w=this.defaultTransitionablePropertyValues[h]=new zu(f);this.defaultTransitioningPropertyValues[h]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}lr("DataDrivenProperty",Vr),lr("DataConstantProperty",mr),lr("CrossFadedDataDrivenProperty",Vu),lr("CrossFadedProperty",ju),lr("ColorRampProperty",af);const s="-transition";class d extends mt{constructor(o,h){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),h.layout&&(this._unevaluatedLayout=new Oc(h.layout)),h.paint)){this._transitionablePaint=new Uu(h.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dc(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,h,f={}){h!=null&&this._validate(__,`layers.${this.id}.layout.${o}`,o,h,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,h):this.visibility=h)}getPaintProperty(o){return o.endsWith(s)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,h,f={}){if(h!=null&&this._validate(m_,`layers.${this.id}.paint.${o}`,o,h,f))return!1;if(o.endsWith(s))return this._transitionablePaint.setTransition(o.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[o],w=_.property.specification["property-type"]==="cross-faded-data-driven",S=_.value.isDataDriven(),I=_.value;this._transitionablePaint.setValue(o,h),this._handleSpecialPaintPropertyUpdate(o);const P=this._transitionablePaint._values[o].value;return P.isDataDriven()||S||w||this._handleOverridablePaintPropertyUpdate(o,I,P)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,h,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,h){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,h)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Ue(o,(h,f)=>!(h===void 0||f==="layout"&&!Object.keys(h).length||f==="paint"&&!Object.keys(h).length))}_validate(o,h,f,_,w={}){return(!w||w.validate!==!1)&&Qd(this,o.call(ka,{key:h,layerType:this.type,objectKey:f,value:_,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const h=this.paint.get(o);if(h instanceof _o&&cl(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const g={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(o,h){this._structArray=o,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class v{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,h){return o._trim(),h&&(o.isTransferred=!0,h.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const h=Object.create(this.prototype);return h.arrayBuffer=o.arrayBuffer,h.length=o.length,h.capacity=o.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function C(c,o=1){let h=0,f=0;return{members:c.map(_=>{const w=g[_.type].BYTES_PER_ELEMENT,S=h=R(h,Math.max(o,w)),I=_.components||1;return f=Math.max(f,w),h+=w*I,{name:_.name,type:_.type,components:I,offset:S}}),size:R(h,Math.max(f,o)),alignment:o}}function R(c,o){return Math.ceil(c/o)*o}class M extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const _=2*o;return this.int16[_+0]=h,this.int16[_+1]=f,o}}M.prototype.bytesPerElement=4,lr("StructArrayLayout2i4",M);class z extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,h,f)}emplace(o,h,f,_){const w=3*o;return this.int16[w+0]=h,this.int16[w+1]=f,this.int16[w+2]=_,o}}z.prototype.bytesPerElement=6,lr("StructArrayLayout3i6",z);class W extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,o,h,f,_)}emplace(o,h,f,_,w){const S=4*o;return this.int16[S+0]=h,this.int16[S+1]=f,this.int16[S+2]=_,this.int16[S+3]=w,o}}W.prototype.bytesPerElement=8,lr("StructArrayLayout4i8",W);class $ extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,f,_,w,S)}emplace(o,h,f,_,w,S,I){const P=6*o;return this.int16[P+0]=h,this.int16[P+1]=f,this.int16[P+2]=_,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=I,o}}$.prototype.bytesPerElement=12,lr("StructArrayLayout2i4i12",$);class Q extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,f,_,w,S)}emplace(o,h,f,_,w,S,I){const P=4*o,O=8*o;return this.int16[P+0]=h,this.int16[P+1]=f,this.uint8[O+4]=_,this.uint8[O+5]=w,this.uint8[O+6]=S,this.uint8[O+7]=I,o}}Q.prototype.bytesPerElement=8,lr("StructArrayLayout2i4ub8",Q);class ie extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const _=2*o;return this.float32[_+0]=h,this.float32[_+1]=f,o}}ie.prototype.bytesPerElement=8,lr("StructArrayLayout2f8",ie);class ce extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S,I,P,O,L){const H=this.length;return this.resize(H+1),this.emplace(H,o,h,f,_,w,S,I,P,O,L)}emplace(o,h,f,_,w,S,I,P,O,L,H){const q=10*o;return this.uint16[q+0]=h,this.uint16[q+1]=f,this.uint16[q+2]=_,this.uint16[q+3]=w,this.uint16[q+4]=S,this.uint16[q+5]=I,this.uint16[q+6]=P,this.uint16[q+7]=O,this.uint16[q+8]=L,this.uint16[q+9]=H,o}}ce.prototype.bytesPerElement=20,lr("StructArrayLayout10ui20",ce);class be extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S,I,P,O,L,H,q){const G=this.length;return this.resize(G+1),this.emplace(G,o,h,f,_,w,S,I,P,O,L,H,q)}emplace(o,h,f,_,w,S,I,P,O,L,H,q,G){const ee=12*o;return this.int16[ee+0]=h,this.int16[ee+1]=f,this.int16[ee+2]=_,this.int16[ee+3]=w,this.uint16[ee+4]=S,this.uint16[ee+5]=I,this.uint16[ee+6]=P,this.uint16[ee+7]=O,this.int16[ee+8]=L,this.int16[ee+9]=H,this.int16[ee+10]=q,this.int16[ee+11]=G,o}}be.prototype.bytesPerElement=24,lr("StructArrayLayout4i4ui4i24",be);class Ee extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,h,f)}emplace(o,h,f,_){const w=3*o;return this.float32[w+0]=h,this.float32[w+1]=f,this.float32[w+2]=_,o}}Ee.prototype.bytesPerElement=12,lr("StructArrayLayout3f12",Ee);class Pe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint32[1*o+0]=h,o}}Pe.prototype.bytesPerElement=4,lr("StructArrayLayout1ul4",Pe);class Fe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S,I,P,O){const L=this.length;return this.resize(L+1),this.emplace(L,o,h,f,_,w,S,I,P,O)}emplace(o,h,f,_,w,S,I,P,O,L){const H=10*o,q=5*o;return this.int16[H+0]=h,this.int16[H+1]=f,this.int16[H+2]=_,this.int16[H+3]=w,this.int16[H+4]=S,this.int16[H+5]=I,this.uint32[q+3]=P,this.uint16[H+8]=O,this.uint16[H+9]=L,o}}Fe.prototype.bytesPerElement=20,lr("StructArrayLayout6i1ul2ui20",Fe);class _e extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,f,_,w,S)}emplace(o,h,f,_,w,S,I){const P=6*o;return this.int16[P+0]=h,this.int16[P+1]=f,this.int16[P+2]=_,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=I,o}}_e.prototype.bytesPerElement=12,lr("StructArrayLayout2i2i2i12",_e);class je extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,o,h,f,_,w)}emplace(o,h,f,_,w,S){const I=4*o,P=8*o;return this.float32[I+0]=h,this.float32[I+1]=f,this.float32[I+2]=_,this.int16[P+6]=w,this.int16[P+7]=S,o}}je.prototype.bytesPerElement=16,lr("StructArrayLayout2f1f2i16",je);class Xe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,h,f,_,w,S)}emplace(o,h,f,_,w,S,I){const P=16*o,O=4*o,L=8*o;return this.uint8[P+0]=h,this.uint8[P+1]=f,this.float32[O+1]=_,this.float32[O+2]=w,this.int16[L+6]=S,this.int16[L+7]=I,o}}Xe.prototype.bytesPerElement=16,lr("StructArrayLayout2ub2f2i16",Xe);class st extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,h,f)}emplace(o,h,f,_){const w=3*o;return this.uint16[w+0]=h,this.uint16[w+1]=f,this.uint16[w+2]=_,o}}st.prototype.bytesPerElement=6,lr("StructArrayLayout3ui6",st);class St extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae){const tt=this.length;return this.resize(tt+1),this.emplace(tt,o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae)}emplace(o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae,tt){const Le=24*o,Ye=12*o,gt=48*o;return this.int16[Le+0]=h,this.int16[Le+1]=f,this.uint16[Le+2]=_,this.uint16[Le+3]=w,this.uint32[Ye+2]=S,this.uint32[Ye+3]=I,this.uint32[Ye+4]=P,this.uint16[Le+10]=O,this.uint16[Le+11]=L,this.uint16[Le+12]=H,this.float32[Ye+7]=q,this.float32[Ye+8]=G,this.uint8[gt+36]=ee,this.uint8[gt+37]=ne,this.uint8[gt+38]=ge,this.uint32[Ye+10]=Ae,this.int16[Le+22]=tt,o}}St.prototype.bytesPerElement=48,lr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",St);class Bt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae,tt,Le,Ye,gt,Nt,rr,Lr,er,Yt,xr,dr){const or=this.length;return this.resize(or+1),this.emplace(or,o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae,tt,Le,Ye,gt,Nt,rr,Lr,er,Yt,xr,dr)}emplace(o,h,f,_,w,S,I,P,O,L,H,q,G,ee,ne,ge,Ae,tt,Le,Ye,gt,Nt,rr,Lr,er,Yt,xr,dr,or){const wt=32*o,Ir=16*o;return this.int16[wt+0]=h,this.int16[wt+1]=f,this.int16[wt+2]=_,this.int16[wt+3]=w,this.int16[wt+4]=S,this.int16[wt+5]=I,this.int16[wt+6]=P,this.int16[wt+7]=O,this.uint16[wt+8]=L,this.uint16[wt+9]=H,this.uint16[wt+10]=q,this.uint16[wt+11]=G,this.uint16[wt+12]=ee,this.uint16[wt+13]=ne,this.uint16[wt+14]=ge,this.uint16[wt+15]=Ae,this.uint16[wt+16]=tt,this.uint16[wt+17]=Le,this.uint16[wt+18]=Ye,this.uint16[wt+19]=gt,this.uint16[wt+20]=Nt,this.uint16[wt+21]=rr,this.uint16[wt+22]=Lr,this.uint32[Ir+12]=er,this.float32[Ir+13]=Yt,this.float32[Ir+14]=xr,this.uint16[wt+30]=dr,this.uint16[wt+31]=or,o}}Bt.prototype.bytesPerElement=64,lr("StructArrayLayout8i15ui1ul2f2ui64",Bt);class Gt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.float32[1*o+0]=h,o}}Gt.prototype.bytesPerElement=4,lr("StructArrayLayout1f4",Gt);class nr extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,h,f)}emplace(o,h,f,_){const w=3*o;return this.uint16[6*o+0]=h,this.float32[w+1]=f,this.float32[w+2]=_,o}}nr.prototype.bytesPerElement=12,lr("StructArrayLayout1ui2f12",nr);class $t extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,h,f)}emplace(o,h,f,_){const w=4*o;return this.uint32[2*o+0]=h,this.uint16[w+2]=f,this.uint16[w+3]=_,o}}$t.prototype.bytesPerElement=8,lr("StructArrayLayout1ul2ui8",$t);class jt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const _=2*o;return this.uint16[_+0]=h,this.uint16[_+1]=f,o}}jt.prototype.bytesPerElement=4,lr("StructArrayLayout2ui4",jt);class _r extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint16[1*o+0]=h,o}}_r.prototype.bytesPerElement=2,lr("StructArrayLayout1ui2",_r);class en extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,o,h,f,_)}emplace(o,h,f,_,w){const S=4*o;return this.float32[S+0]=h,this.float32[S+1]=f,this.float32[S+2]=_,this.float32[S+3]=w,o}}en.prototype.bytesPerElement=16,lr("StructArrayLayout4f16",en);class qt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}qt.prototype.size=20;class tr extends Fe{get(o){return new qt(this,o)}}lr("CollisionBoxArray",tr);class Kr extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Kr.prototype.size=48;class Yn extends St{get(o){return new Kr(this,o)}}lr("PlacedSymbolArray",Yn);class on extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}on.prototype.size=64;class gn extends Bt{get(o){return new on(this,o)}}lr("SymbolInstanceArray",gn);class Kn extends Gt{getoffsetX(o){return this.float32[1*o+0]}}lr("GlyphOffsetArray",Kn);class Qi extends z{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}lr("SymbolLineVertexArray",Qi);class eo extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}eo.prototype.size=12;class Gn extends nr{get(o){return new eo(this,o)}}lr("TextAnchorOffsetArray",Gn);class vs extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}vs.prototype.size=8;class us extends $t{get(o){return new vs(this,o)}}lr("FeatureIndexArray",us);class es extends M{}class hs extends M{}class yo extends M{}class xl extends ${}class Hu extends Q{}class wl extends ie{}class Ws extends ce{}class Wu extends be{}class lf extends Ee{}class $s extends Pe{}class qs extends _e{}class Yo extends Xe{}class to extends st{}class Xi extends jt{}const ts=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ms}=ts;class bn{constructor(o=[]){this.segments=o}prepareSegment(o,h,f,_){let w=this.segments[this.segments.length-1];return o>bn.MAX_VERTEX_ARRAY_LENGTH&&ze(`Max vertices per segment is ${bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!w||w.vertexLength+o>bn.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_)&&(w={vertexOffset:h.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(w.sortKey=_),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const o of this.segments)for(const h in o.vaos)o.vaos[h].destroy()}static simpleSegment(o,h,f,_){return new bn([{vertexOffset:o,primitiveOffset:h,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function Ma(c,o){return 256*(c=J(Math.floor(c),0,255))+J(Math.floor(o),0,255)}bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lr("SegmentVector",bn);const Tl=C([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Sl={exports:{}},w_={exports:{}};w_.exports=function(c,o){var h,f,_,w,S,I,P,O;for(f=c.length-(h=3&c.length),_=o,S=3432918353,I=461845907,O=0;O<f;)P=255&c.charCodeAt(O)|(255&c.charCodeAt(++O))<<8|(255&c.charCodeAt(++O))<<16|(255&c.charCodeAt(++O))<<24,++O,_=27492+(65535&(w=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&c.charCodeAt(O+2))<<16;case 2:P^=(255&c.charCodeAt(O+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&c.charCodeAt(O)))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return _^=c.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Db=w_.exports,T_={exports:{}};T_.exports=function(c,o){for(var h,f=c.length,_=o^f,w=0;f>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(w)|(255&c.charCodeAt(++w))<<8|(255&c.charCodeAt(++w))<<16|(255&c.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:_^=(255&c.charCodeAt(w+2))<<16;case 2:_^=(255&c.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&c.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Ko=Db,S_=T_.exports;Sl.exports=Ko,Sl.exports.murmur3=Ko,Sl.exports.murmur2=S_;var $u=p(Sl.exports);class Nc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,h,f,_){this.ids.push(qu(o)),this.positions.push(h,f,_)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=qu(o);let f=0,_=this.ids.length-1;for(;f<_;){const S=f+_>>1;this.ids[S]>=h?_=S:f=S+1}const w=[];for(;this.ids[f]===h;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(o,h){const f=new Float64Array(o.ids),_=new Uint32Array(o.positions);return Xu(f,_,0,f.length-1),h&&h.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(o){const h=new Nc;return h.ids=o.ids,h.positions=o.positions,h.indexed=!0,h}}function qu(c){const o=+c;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:$u(String(c))}function Xu(c,o,h,f){for(;h<f;){const _=c[h+f>>1];let w=h-1,S=f+1;for(;;){do w++;while(c[w]<_);do S--;while(c[S]>_);if(w>=S)break;Al(c,w,S),Al(o,3*w,3*S),Al(o,3*w+1,3*S+1),Al(o,3*w+2,3*S+2)}S-h<f-S?(Xu(c,o,h,S),h=S+1):(Xu(c,o,S+1,f),f=S)}}function Al(c,o,h){const f=c[o];c[o]=c[h],c[h]=f}lr("FeaturePositionMap",Nc);class Fc{constructor(o,h){this.gl=o.gl,this.location=h}}class A_ extends Fc{constructor(o,h){super(o,h),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Q1 extends Fc{constructor(o,h){super(o,h),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class eT extends Fc{constructor(o,h){super(o,h),this.current=qr.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const QP=new Float32Array(16);function Nb(c){return[Ma(255*c.r,255*c.g),Ma(255*c.b,255*c.a)]}class cf{constructor(o,h,f){this.value=o,this.uniformNames=h.map(_=>`u_${_}`),this.type=f}setUniform(o,h,f){o.set(f.constantOr(this.value))}getBinding(o,h,f){return this.type==="color"?new eT(o,h):new A_(o,h)}}class Zu{constructor(o,h){this.uniformNames=h.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=o.tlbr}setUniform(o,h,f,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&o.set(w)}getBinding(o,h,f){return f.substr(0,9)==="u_pattern"?new Q1(o,h):new A_(o,h)}}class Oa{constructor(o,h,f,_){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=h.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,h,f,_,w){const S=this.paintVertexArray.length,I=this.expression.evaluate(new Zn(0),h,{},_,[],w);this.paintVertexArray.resize(o),this._setPaintValue(S,o,I)}updatePaintArray(o,h,f,_){const w=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(o,h,w)}_setPaintValue(o,h,f){if(this.type==="color"){const _=Nb(f);for(let w=o;w<h;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=o;_<h;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Do{constructor(o,h,f,_,w,S){this.expression=o,this.uniformNames=h.map(I=>`u_${I}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=h.map(I=>({name:`a_${I}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(o,h,f,_,w){const S=this.expression.evaluate(new Zn(this.zoom),h,{},_,[],w),I=this.expression.evaluate(new Zn(this.zoom+1),h,{},_,[],w),P=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(P,o,S,I)}updatePaintArray(o,h,f,_){const w=this.expression.evaluate({zoom:this.zoom},f,_),S=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(o,h,w,S)}_setPaintValue(o,h,f,_){if(this.type==="color"){const w=Nb(f),S=Nb(_);for(let I=o;I<h;I++)this.paintVertexArray.emplace(I,w[0],w[1],S[0],S[1])}else{for(let w=o;w<h;w++)this.paintVertexArray.emplace(w,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,h){const f=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=J(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(_)}getBinding(o,h,f){return new A_(o,h)}}class El{constructor(o,h,f,_,w,S){this.expression=o,this.type=h,this.useIntegerZoom=f,this.zoom=_,this.layerId=S,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(o,h,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(_,o,h.patterns&&h.patterns[this.layerId],f)}updatePaintArray(o,h,f,_,w){this._setPaintValues(o,h,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(o,h,f,_){if(!_||!f)return;const{min:w,mid:S,max:I}=f,P=_[w],O=_[S],L=_[I];if(P&&O&&L)for(let H=o;H<h;H++)this.zoomInPaintVertexArray.emplace(H,O.tl[0],O.tl[1],O.br[0],O.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],O.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,O.tl[0],O.tl[1],O.br[0],O.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],O.pixelRatio,L.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Tl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Tl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tT{constructor(o,h,f){this.binders={},this._buffers=[];const _=[];for(const w in o.paint._values){if(!f(w))continue;const S=o.paint.get(w);if(!(S instanceof _o&&cl(S.property.specification)))continue;const I=eR(w,o.type),P=S.value,O=S.property.specification.type,L=S.property.useIntegerZoom,H=S.property.specification["property-type"],q=H==="cross-faded"||H==="cross-faded-data-driven";if(P.kind==="constant")this.binders[w]=q?new Zu(P.value,I):new cf(P.value,I,O),_.push(`/u_${w}`);else if(P.kind==="source"||q){const G=rT(w,O,"source");this.binders[w]=q?new El(P,O,L,h,G,o.id):new Oa(P,I,O,G),_.push(`/a_${w}`)}else{const G=rT(w,O,"composite");this.binders[w]=new Do(P,I,O,L,h,G),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(o){const h=this.binders[o];return h instanceof Oa||h instanceof Do?h.maxValue:0}populatePaintArrays(o,h,f,_,w){for(const S in this.binders){const I=this.binders[S];(I instanceof Oa||I instanceof Do||I instanceof El)&&I.populatePaintArray(o,h,f,_,w)}}setConstantPatternPositions(o,h){for(const f in this.binders){const _=this.binders[f];_ instanceof Zu&&_.setConstantPatternPositions(o,h)}}updatePaintArrays(o,h,f,_,w){let S=!1;for(const I in o){const P=h.getPositions(I);for(const O of P){const L=f.feature(O.index);for(const H in this.binders){const q=this.binders[H];if((q instanceof Oa||q instanceof Do||q instanceof El)&&q.expression.isStateDependent===!0){const G=_.paint.get(H);q.expression=G.value,q.updatePaintArray(O.start,O.end,L,o[I],w),S=!0}}}}return S}defines(){const o=[];for(const h in this.binders){const f=this.binders[h];(f instanceof cf||f instanceof Zu)&&o.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Oa||f instanceof Do)for(let _=0;_<f.paintVertexAttributes.length;_++)o.push(f.paintVertexAttributes[_].name);else if(f instanceof El)for(let _=0;_<Tl.members.length;_++)o.push(Tl.members[_].name)}return o}getBinderUniforms(){const o=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof cf||f instanceof Zu||f instanceof Do)for(const _ of f.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,h){const f=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof cf||w instanceof Zu||w instanceof Do){for(const S of w.uniformNames)if(h[S]){const I=w.getBinding(o,h[S],S);f.push({name:S,property:_,binding:I})}}}return f}setUniforms(o,h,f,_){for(const{name:w,property:S,binding:I}of h)this.binders[S].setUniform(I,_,f.get(S),w)}updatePaintBuffers(o){this._buffers=[];for(const h in this.binders){const f=this.binders[h];if(o&&f instanceof El){const _=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof Oa||f instanceof Do)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const h in this.binders){const f=this.binders[h];(f instanceof Oa||f instanceof Do||f instanceof El)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const h=this.binders[o];(h instanceof Oa||h instanceof Do||h instanceof El)&&h.destroy()}}}class Bc{constructor(o,h,f=()=>!0){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new tT(_,h,f);this.needsUpload=!1,this._featureMap=new Nc,this._bufferOffset=0}populatePaintArrays(o,h,f,_,w,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,h,_,w,S);h.id!==void 0&&this._featureMap.add(h.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,h,f,_){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(o,this._featureMap,h,w,_)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function eR(c,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${o}-`,"").replace(/-/g,"_")]}function rT(c,o,h){const f={color:{source:ie,composite:en},number:{source:Gt,composite:ie}},_=function(w){return{"line-pattern":{source:Ws,composite:Ws},"fill-pattern":{source:Ws,composite:Ws},"fill-extrusion-pattern":{source:Ws,composite:Ws}}[w]}(c);return _&&_[h]||f[o][h]}lr("ConstantBinder",cf),lr("CrossFadedConstantBinder",Zu),lr("SourceExpressionBinder",Oa),lr("CrossFadedCompositeBinder",El),lr("CompositeExpressionBinder",Do),lr("ProgramConfiguration",tT,{omit:["_buffers"]}),lr("ProgramConfigurationSet",Bc);const Ei=8192,Fb=Math.pow(2,14)-1,nT=-Fb-1;function Lc(c){const o=Ei/c.extent,h=c.loadGeometry();for(let f=0;f<h.length;f++){const _=h[f];for(let w=0;w<_.length;w++){const S=_[w],I=Math.round(S.x*o),P=Math.round(S.y*o);S.x=J(I,nT,Fb),S.y=J(P,nT,Fb),(I<S.x||I>S.x+1||P<S.y||P>S.y+1)&&ze("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function zc(c,o){return{type:c.type,id:c.id,properties:c.properties,geometry:o?Lc(c):[]}}function E_(c,o,h,f,_){c.emplaceBack(2*o+(f+1)/2,2*h+(_+1)/2)}class Bb{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new hs,this.indexArray=new to,this.segments=new bn,this.programConfigurations=new Bc(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){const _=this.layers[0],w=[];let S=null,I=!1;_.type==="circle"&&(S=_.layout.get("circle-sort-key"),I=!S.isConstant());for(const{feature:P,id:O,index:L,sourceLayerIndex:H}of o){const q=this.layers[0]._featureFilter.needGeometry,G=zc(P,q);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),G,f))continue;const ee=I?S.evaluate(G,{},f):void 0,ne={id:O,properties:P.properties,type:P.type,sourceLayerIndex:H,index:L,geometry:q?G.geometry:Lc(P),patterns:{},sortKey:ee};w.push(ne)}I&&w.sort((P,O)=>P.sortKey-O.sortKey);for(const P of w){const{geometry:O,index:L,sourceLayerIndex:H}=P,q=o[L].feature;this.addFeature(P,O,L,f),h.featureIndex.insert(q,O,L,H,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ms),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,h,f,_){for(const w of h)for(const S of w){const I=S.x,P=S.y;if(I<0||I>=Ei||P<0||P>=Ei)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=O.vertexLength;E_(this.layoutVertexArray,I,P,-1,-1),E_(this.layoutVertexArray,I,P,1,-1),E_(this.layoutVertexArray,I,P,1,1),E_(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},_)}}function iT(c,o){for(let h=0;h<c.length;h++)if(Yu(o,c[h]))return!0;for(let h=0;h<o.length;h++)if(Yu(c,o[h]))return!0;return!!Lb(c,o)}function tR(c,o,h){return!!Yu(c,o)||!!zb(o,c,h)}function sT(c,o){if(c.length===1)return aT(o,c[0]);for(let h=0;h<o.length;h++){const f=o[h];for(let _=0;_<f.length;_++)if(Yu(c,f[_]))return!0}for(let h=0;h<c.length;h++)if(aT(o,c[h]))return!0;for(let h=0;h<o.length;h++)if(Lb(c,o[h]))return!0;return!1}function rR(c,o,h){if(c.length>1){if(Lb(c,o))return!0;for(let f=0;f<o.length;f++)if(zb(o[f],c,h))return!0}for(let f=0;f<c.length;f++)if(zb(c[f],o,h))return!0;return!1}function Lb(c,o){if(c.length===0||o.length===0)return!1;for(let h=0;h<c.length-1;h++){const f=c[h],_=c[h+1];for(let w=0;w<o.length-1;w++)if(nR(f,_,o[w],o[w+1]))return!0}return!1}function nR(c,o,h,f){return Ne(c,h,f)!==Ne(o,h,f)&&Ne(c,o,h)!==Ne(c,o,f)}function zb(c,o,h){const f=h*h;if(o.length===1)return c.distSqr(o[0])<f;for(let _=1;_<o.length;_++)if(oT(c,o[_-1],o[_])<f)return!0;return!1}function oT(c,o,h){const f=o.distSqr(h);if(f===0)return c.distSqr(o);const _=((c.x-o.x)*(h.x-o.x)+(c.y-o.y)*(h.y-o.y))/f;return c.distSqr(_<0?o:_>1?h:h.sub(o)._mult(_)._add(o))}function aT(c,o){let h,f,_,w=!1;for(let S=0;S<c.length;S++){h=c[S];for(let I=0,P=h.length-1;I<h.length;P=I++)f=h[I],_=h[P],f.y>o.y!=_.y>o.y&&o.x<(_.x-f.x)*(o.y-f.y)/(_.y-f.y)+f.x&&(w=!w)}return w}function Yu(c,o){let h=!1;for(let f=0,_=c.length-1;f<c.length;_=f++){const w=c[f],S=c[_];w.y>o.y!=S.y>o.y&&o.x<(S.x-w.x)*(o.y-w.y)/(S.y-w.y)+w.x&&(h=!h)}return h}function iR(c,o,h){const f=h[0],_=h[2];if(c.x<f.x&&o.x<f.x||c.x>_.x&&o.x>_.x||c.y<f.y&&o.y<f.y||c.y>_.y&&o.y>_.y)return!1;const w=Ne(c,o,h[0]);return w!==Ne(c,o,h[1])||w!==Ne(c,o,h[2])||w!==Ne(c,o,h[3])}function uf(c,o,h){const f=o.paint.get(c).value;return f.kind==="constant"?f.value:h.programConfigurations.get(o.id).getMaxValue(c)}function I_(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function C_(c,o,h,f,_){if(!o[0]&&!o[1])return c;const w=T.convert(o)._mult(_);h==="viewport"&&w._rotate(-f);const S=[];for(let I=0;I<c.length;I++)S.push(c[I].sub(w));return S}let lT,cT;lr("CircleBucket",Bb,{omit:["layers"]});var sR={get paint(){return cT=cT||new b({"circle-radius":new Vr(Te.paint_circle["circle-radius"]),"circle-color":new Vr(Te.paint_circle["circle-color"]),"circle-blur":new Vr(Te.paint_circle["circle-blur"]),"circle-opacity":new Vr(Te.paint_circle["circle-opacity"]),"circle-translate":new mr(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new mr(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mr(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mr(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vr(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vr(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vr(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return lT=lT||new b({"circle-sort-key":new Vr(Te.layout_circle["circle-sort-key"])})}},bs=1e-6,Ku=typeof Float32Array<"u"?Float32Array:Array;function Ub(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function uT(c,o,h){var f=o[0],_=o[1],w=o[2],S=o[3],I=o[4],P=o[5],O=o[6],L=o[7],H=o[8],q=o[9],G=o[10],ee=o[11],ne=o[12],ge=o[13],Ae=o[14],tt=o[15],Le=h[0],Ye=h[1],gt=h[2],Nt=h[3];return c[0]=Le*f+Ye*I+gt*H+Nt*ne,c[1]=Le*_+Ye*P+gt*q+Nt*ge,c[2]=Le*w+Ye*O+gt*G+Nt*Ae,c[3]=Le*S+Ye*L+gt*ee+Nt*tt,c[4]=(Le=h[4])*f+(Ye=h[5])*I+(gt=h[6])*H+(Nt=h[7])*ne,c[5]=Le*_+Ye*P+gt*q+Nt*ge,c[6]=Le*w+Ye*O+gt*G+Nt*Ae,c[7]=Le*S+Ye*L+gt*ee+Nt*tt,c[8]=(Le=h[8])*f+(Ye=h[9])*I+(gt=h[10])*H+(Nt=h[11])*ne,c[9]=Le*_+Ye*P+gt*q+Nt*ge,c[10]=Le*w+Ye*O+gt*G+Nt*Ae,c[11]=Le*S+Ye*L+gt*ee+Nt*tt,c[12]=(Le=h[12])*f+(Ye=h[13])*I+(gt=h[14])*H+(Nt=h[15])*ne,c[13]=Le*_+Ye*P+gt*q+Nt*ge,c[14]=Le*w+Ye*O+gt*G+Nt*Ae,c[15]=Le*S+Ye*L+gt*ee+Nt*tt,c}Math.hypot||(Math.hypot=function(){for(var c=0,o=arguments.length;o--;)c+=arguments[o]*arguments[o];return Math.sqrt(c)});var hf,oR=uT;function P_(c,o,h){var f=o[0],_=o[1],w=o[2],S=o[3];return c[0]=h[0]*f+h[4]*_+h[8]*w+h[12]*S,c[1]=h[1]*f+h[5]*_+h[9]*w+h[13]*S,c[2]=h[2]*f+h[6]*_+h[10]*w+h[14]*S,c[3]=h[3]*f+h[7]*_+h[11]*w+h[15]*S,c}hf=new Ku(4),Ku!=Float32Array&&(hf[0]=0,hf[1]=0,hf[2]=0,hf[3]=0);class aR extends d{constructor(o){super(o,sR)}createBucket(o){return new Bb(o)}queryRadius(o){const h=o;return uf("circle-radius",this,h)+uf("circle-stroke-width",this,h)+I_(this.paint.get("circle-translate"))}queryIntersectsFeature(o,h,f,_,w,S,I,P){const O=C_(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,I),L=this.paint.get("circle-radius").evaluate(h,f)+this.paint.get("circle-stroke-width").evaluate(h,f),H=this.paint.get("circle-pitch-alignment")==="map",q=H?O:function(ee,ne){return ee.map(ge=>hT(ge,ne))}(O,P),G=H?L*I:L;for(const ee of _)for(const ne of ee){const ge=H?ne:hT(ne,P);let Ae=G;const tt=P_([],[ne.x,ne.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ae*=tt[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ae*=S.cameraToCenterDistance/tt[3]),tR(q,ge,Ae))return!0}return!1}}function hT(c,o){const h=P_([],[c.x,c.y,0,1],o);return new T(h[0]/h[3],h[1]/h[3])}class dT extends Bb{}let fT;lr("HeatmapBucket",dT,{omit:["layers"]});var lR={get paint(){return fT=fT||new b({"heatmap-radius":new Vr(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vr(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mr(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new af(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mr(Te.paint_heatmap["heatmap-opacity"])})}};function Vb(c,{width:o,height:h},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*h*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${o*h*f}`)}else _=new Uint8Array(o*h*f);return c.width=o,c.height=h,c.data=_,c}function pT(c,{width:o,height:h},f){if(o===c.width&&h===c.height)return;const _=Vb({},{width:o,height:h},f);jb(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,o),height:Math.min(c.height,h)},f),c.width=o,c.height=h,c.data=_.data}function jb(c,o,h,f,_,w){if(_.width===0||_.height===0)return o;if(_.width>c.width||_.height>c.height||h.x>c.width-_.width||h.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||f.x>o.width-_.width||f.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,I=o.data;if(S===I)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<_.height;P++){const O=((h.y+P)*c.width+h.x)*w,L=((f.y+P)*o.width+f.x)*w;for(let H=0;H<_.width*w;H++)I[L+H]=S[O+H]}return o}class df{constructor(o,h){Vb(this,o,1,h)}resize(o){pT(this,o,1)}clone(){return new df({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,f,_,w){jb(o,h,f,_,w,1)}}class ro{constructor(o,h){Vb(this,o,4,h)}resize(o){pT(this,o,4)}replace(o,h){h?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,f,_,w){jb(o,h,f,_,w,4)}}function gT(c){const o={},h=c.resolution||256,f=c.clips?c.clips.length:1,_=c.image||new ro({width:h,height:f});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const w=(S,I,P)=>{o[c.evaluationKey]=P;const O=c.expression.evaluate(o);_.data[S+I+0]=Math.floor(255*O.r/O.a),_.data[S+I+1]=Math.floor(255*O.g/O.a),_.data[S+I+2]=Math.floor(255*O.b/O.a),_.data[S+I+3]=Math.floor(255*O.a)};if(c.clips)for(let S=0,I=0;S<f;++S,I+=4*h)for(let P=0,O=0;P<h;P++,O+=4){const L=P/(h-1),{start:H,end:q}=c.clips[S];w(I,O,H*(1-L)+q*L)}else for(let S=0,I=0;S<h;S++,I+=4)w(0,I,S/(h-1));return _}lr("AlphaImage",df),lr("RGBAImage",ro);const Hb="big-fb";class cR extends d{createBucket(o){return new dT(o)}constructor(o){super(o,lR),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hb)&&this.heatmapFbos.delete(Hb)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let mT;var uR={get paint(){return mT=mT||new b({"hillshade-illumination-direction":new mr(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mr(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mr(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mr(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mr(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mr(Te.paint_hillshade["hillshade-accent-color"])})}};class hR extends d{constructor(o){super(o,uR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const dR=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:fR}=dR;function _T(c,o,h=2){const f=o&&o.length,_=f?o[0]*h:c.length;let w=yT(c,0,_,h,!0);const S=[];if(!w||w.next===w.prev)return S;let I,P,O;if(f&&(w=function(L,H,q,G){const ee=[];for(let ne=0,ge=H.length;ne<ge;ne++){const Ae=yT(L,H[ne]*G,ne<ge-1?H[ne+1]*G:L.length,G,!1);Ae===Ae.next&&(Ae.steiner=!0),ee.push(xR(Ae))}ee.sort(yR);for(let ne=0;ne<ee.length;ne++)q=vR(ee[ne],q);return q}(c,o,w,h)),c.length>80*h){I=1/0,P=1/0;let L=-1/0,H=-1/0;for(let q=h;q<_;q+=h){const G=c[q],ee=c[q+1];G<I&&(I=G),ee<P&&(P=ee),G>L&&(L=G),ee>H&&(H=ee)}O=Math.max(L-I,H-P),O=O!==0?32767/O:0}return ff(w,S,h,I,P,O,0),S}function yT(c,o,h,f,_){let w;if(_===function(S,I,P,O){let L=0;for(let H=I,q=P-O;H<P;H+=O)L+=(S[q]-S[H])*(S[H+1]+S[q+1]),q=H;return L}(c,o,h,f)>0)for(let S=o;S<h;S+=f)w=xT(S/f|0,c[S],c[S+1],w);else for(let S=h-f;S>=o;S-=f)w=xT(S/f|0,c[S],c[S+1],w);return w&&R_(w,w.next)&&(gf(w),w=w.next),w}function Uc(c,o){if(!c)return c;o||(o=c);let h,f=c;do if(h=!1,f.steiner||!R_(f,f.next)&&bi(f.prev,f,f.next)!==0)f=f.next;else{if(gf(f),f=o=f.prev,f===f.next)break;h=!0}while(h||f!==o);return o}function ff(c,o,h,f,_,w,S){if(!c)return;!S&&w&&function(P,O,L,H){let q=P;do q.z===0&&(q.z=Wb(q.x,q.y,O,L,H)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==P);q.prevZ.nextZ=null,q.prevZ=null,function(G){let ee,ne=1;do{let ge,Ae=G;G=null;let tt=null;for(ee=0;Ae;){ee++;let Le=Ae,Ye=0;for(let Nt=0;Nt<ne&&(Ye++,Le=Le.nextZ,Le);Nt++);let gt=ne;for(;Ye>0||gt>0&&Le;)Ye!==0&&(gt===0||!Le||Ae.z<=Le.z)?(ge=Ae,Ae=Ae.nextZ,Ye--):(ge=Le,Le=Le.nextZ,gt--),tt?tt.nextZ=ge:G=ge,ge.prevZ=tt,tt=ge;Ae=Le}tt.nextZ=null,ne*=2}while(ee>1)}(q)}(c,f,_,w);let I=c;for(;c.prev!==c.next;){const P=c.prev,O=c.next;if(w?gR(c,f,_,w):pR(c))o.push(P.i,c.i,O.i),gf(c),c=O.next,I=O.next;else if((c=O)===I){S?S===1?ff(c=mR(Uc(c),o),o,h,f,_,w,2):S===2&&_R(c,o,h,f,_,w):ff(Uc(c),o,h,f,_,w,1);break}}}function pR(c){const o=c.prev,h=c,f=c.next;if(bi(o,h,f)>=0)return!1;const _=o.x,w=h.x,S=f.x,I=o.y,P=h.y,O=f.y,L=_<w?_<S?_:S:w<S?w:S,H=I<P?I<O?I:O:P<O?P:O,q=_>w?_>S?_:S:w>S?w:S,G=I>P?I>O?I:O:P>O?P:O;let ee=f.next;for(;ee!==o;){if(ee.x>=L&&ee.x<=q&&ee.y>=H&&ee.y<=G&&Gu(_,I,w,P,S,O,ee.x,ee.y)&&bi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function gR(c,o,h,f){const _=c.prev,w=c,S=c.next;if(bi(_,w,S)>=0)return!1;const I=_.x,P=w.x,O=S.x,L=_.y,H=w.y,q=S.y,G=I<P?I<O?I:O:P<O?P:O,ee=L<H?L<q?L:q:H<q?H:q,ne=I>P?I>O?I:O:P>O?P:O,ge=L>H?L>q?L:q:H>q?H:q,Ae=Wb(G,ee,o,h,f),tt=Wb(ne,ge,o,h,f);let Le=c.prevZ,Ye=c.nextZ;for(;Le&&Le.z>=Ae&&Ye&&Ye.z<=tt;){if(Le.x>=G&&Le.x<=ne&&Le.y>=ee&&Le.y<=ge&&Le!==_&&Le!==S&&Gu(I,L,P,H,O,q,Le.x,Le.y)&&bi(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,Ye.x>=G&&Ye.x<=ne&&Ye.y>=ee&&Ye.y<=ge&&Ye!==_&&Ye!==S&&Gu(I,L,P,H,O,q,Ye.x,Ye.y)&&bi(Ye.prev,Ye,Ye.next)>=0))return!1;Ye=Ye.nextZ}for(;Le&&Le.z>=Ae;){if(Le.x>=G&&Le.x<=ne&&Le.y>=ee&&Le.y<=ge&&Le!==_&&Le!==S&&Gu(I,L,P,H,O,q,Le.x,Le.y)&&bi(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;Ye&&Ye.z<=tt;){if(Ye.x>=G&&Ye.x<=ne&&Ye.y>=ee&&Ye.y<=ge&&Ye!==_&&Ye!==S&&Gu(I,L,P,H,O,q,Ye.x,Ye.y)&&bi(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.nextZ}return!0}function mR(c,o){let h=c;do{const f=h.prev,_=h.next.next;!R_(f,_)&&vT(f,h,h.next,_)&&pf(f,_)&&pf(_,f)&&(o.push(f.i,h.i,_.i),gf(h),gf(h.next),h=c=_),h=h.next}while(h!==c);return Uc(h)}function _R(c,o,h,f,_,w){let S=c;do{let I=S.next.next;for(;I!==S.prev;){if(S.i!==I.i&&wR(S,I)){let P=bT(S,I);return S=Uc(S,S.next),P=Uc(P,P.next),ff(S,o,h,f,_,w,0),void ff(P,o,h,f,_,w,0)}I=I.next}S=S.next}while(S!==c)}function yR(c,o){return c.x-o.x}function vR(c,o){const h=function(_,w){let S=w;const I=_.x,P=_.y;let O,L=-1/0;do{if(P<=S.y&&P>=S.next.y&&S.next.y!==S.y){const ne=S.x+(P-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(ne<=I&&ne>L&&(L=ne,O=S.x<S.next.x?S:S.next,ne===I))return O}S=S.next}while(S!==w);if(!O)return null;const H=O,q=O.x,G=O.y;let ee=1/0;S=O;do{if(I>=S.x&&S.x>=q&&I!==S.x&&Gu(P<G?I:L,P,q,G,P<G?L:I,P,S.x,S.y)){const ne=Math.abs(P-S.y)/(I-S.x);pf(S,_)&&(ne<ee||ne===ee&&(S.x>O.x||S.x===O.x&&bR(O,S)))&&(O=S,ee=ne)}S=S.next}while(S!==H);return O}(c,o);if(!h)return o;const f=bT(h,c);return Uc(f,f.next),Uc(h,h.next)}function bR(c,o){return bi(c.prev,c,o.prev)<0&&bi(o.next,c,c.next)<0}function Wb(c,o,h,f,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function xR(c){let o=c,h=c;do(o.x<h.x||o.x===h.x&&o.y<h.y)&&(h=o),o=o.next;while(o!==c);return h}function Gu(c,o,h,f,_,w,S,I){return(_-S)*(o-I)>=(c-S)*(w-I)&&(c-S)*(f-I)>=(h-S)*(o-I)&&(h-S)*(w-I)>=(_-S)*(f-I)}function wR(c,o){return c.next.i!==o.i&&c.prev.i!==o.i&&!function(h,f){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==f.i&&_.next.i!==f.i&&vT(_,_.next,h,f))return!0;_=_.next}while(_!==h);return!1}(c,o)&&(pf(c,o)&&pf(o,c)&&function(h,f){let _=h,w=!1;const S=(h.x+f.x)/2,I=(h.y+f.y)/2;do _.y>I!=_.next.y>I&&_.next.y!==_.y&&S<(_.next.x-_.x)*(I-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==h);return w}(c,o)&&(bi(c.prev,c,o.prev)||bi(c,o.prev,o))||R_(c,o)&&bi(c.prev,c,c.next)>0&&bi(o.prev,o,o.next)>0)}function bi(c,o,h){return(o.y-c.y)*(h.x-o.x)-(o.x-c.x)*(h.y-o.y)}function R_(c,o){return c.x===o.x&&c.y===o.y}function vT(c,o,h,f){const _=M_(bi(c,o,h)),w=M_(bi(c,o,f)),S=M_(bi(h,f,c)),I=M_(bi(h,f,o));return _!==w&&S!==I||!(_!==0||!k_(c,h,o))||!(w!==0||!k_(c,f,o))||!(S!==0||!k_(h,c,f))||!(I!==0||!k_(h,o,f))}function k_(c,o,h){return o.x<=Math.max(c.x,h.x)&&o.x>=Math.min(c.x,h.x)&&o.y<=Math.max(c.y,h.y)&&o.y>=Math.min(c.y,h.y)}function M_(c){return c>0?1:c<0?-1:0}function pf(c,o){return bi(c.prev,c,c.next)<0?bi(c,o,c.next)>=0&&bi(c,c.prev,o)>=0:bi(c,o,c.prev)<0||bi(c,c.next,o)<0}function bT(c,o){const h=$b(c.i,c.x,c.y),f=$b(o.i,o.x,o.y),_=c.next,w=o.prev;return c.next=o,o.prev=c,h.next=_,_.prev=h,f.next=h,h.prev=f,w.next=f,f.prev=w,f}function xT(c,o,h,f){const _=$b(c,o,h);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function gf(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function $b(c,o,h){return{i:c,x:o,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qb(c,o,h){const f=h.patternDependencies;let _=!1;for(const w of o){const S=w.paint.get(`${c}-pattern`);S.isConstant()||(_=!0);const I=S.constantOr(null);I&&(_=!0,f[I.to]=!0,f[I.from]=!0)}return _}function Xb(c,o,h,f,_){const w=_.patternDependencies;for(const S of o){const I=S.paint.get(`${c}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:f-1},h,{},_.availableImages),O=I.evaluate({zoom:f},h,{},_.availableImages),L=I.evaluate({zoom:f+1},h,{},_.availableImages);P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,L=L&&L.name?L.name:L,w[P]=!0,w[O]=!0,w[L]=!0,h.patterns[S.id]={min:P,mid:O,max:L}}}return h}class Zb{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yo,this.indexArray=new to,this.indexArray2=new Xi,this.programConfigurations=new Bc(o.layers,o.zoom),this.segments=new bn,this.segments2=new bn,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.hasPattern=qb("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),S=[];for(const{feature:I,id:P,index:O,sourceLayerIndex:L}of o){const H=this.layers[0]._featureFilter.needGeometry,q=zc(I,H);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),q,f))continue;const G=w?_.evaluate(q,{},f,h.availableImages):void 0,ee={id:P,properties:I.properties,type:I.type,sourceLayerIndex:L,index:O,geometry:H?q.geometry:Lc(I),patterns:{},sortKey:G};S.push(ee)}w&&S.sort((I,P)=>I.sortKey-P.sortKey);for(const I of S){const{geometry:P,index:O,sourceLayerIndex:L}=I;if(this.hasPattern){const H=Xb("fill",this.layers,I,this.zoom,h);this.patternFeatures.push(H)}else this.addFeature(I,P,O,f,{});h.featureIndex.insert(o[O].feature,P,O,L,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}addFeatures(o,h,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,fR),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,h,f,_,w){for(const S of xu(h,500)){let I=0;for(const G of S)I+=G.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),O=P.vertexLength,L=[],H=[];for(const G of S){if(G.length===0)continue;G!==S[0]&&H.push(L.length/2);const ee=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ne=ee.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ne+G.length-1,ne),L.push(G[0].x),L.push(G[0].y);for(let ge=1;ge<G.length;ge++)this.layoutVertexArray.emplaceBack(G[ge].x,G[ge].y),this.indexArray2.emplaceBack(ne+ge-1,ne+ge),L.push(G[ge].x),L.push(G[ge].y);ee.vertexLength+=G.length,ee.primitiveLength+=G.length}const q=_T(L,H);for(let G=0;G<q.length;G+=3)this.indexArray.emplaceBack(O+q[G],O+q[G+1],O+q[G+2]);P.vertexLength+=I,P.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}}let wT,TT;lr("FillBucket",Zb,{omit:["layers","patternFeatures"]});var TR={get paint(){return TT=TT||new b({"fill-antialias":new mr(Te.paint_fill["fill-antialias"]),"fill-opacity":new Vr(Te.paint_fill["fill-opacity"]),"fill-color":new Vr(Te.paint_fill["fill-color"]),"fill-outline-color":new Vr(Te.paint_fill["fill-outline-color"]),"fill-translate":new mr(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new mr(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vu(Te.paint_fill["fill-pattern"])})},get layout(){return wT=wT||new b({"fill-sort-key":new Vr(Te.layout_fill["fill-sort-key"])})}};class SR extends d{constructor(o){super(o,TR)}recalculate(o,h){super.recalculate(o,h);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Zb(o)}queryRadius(){return I_(this.paint.get("fill-translate"))}queryIntersectsFeature(o,h,f,_,w,S,I){return sT(C_(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,I),_)}isTileClipped(){return!0}}const AR=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ER=C([{name:"a_centroid",components:2,type:"Int16"}],4),{members:IR}=AR;var Il={},CR=y,ST=Ju;function Ju(c,o,h,f,_){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=_,c.readFields(PR,this,o)}function PR(c,o,h){c==1?o.id=h.readVarint():c==2?function(f,_){for(var w=f.readVarint()+f.pos;f.pos<w;){var S=_._keys[f.readVarint()],I=_._values[f.readVarint()];_.properties[S]=I}}(h,o):c==3?o.type=h.readVarint():c==4&&(o._geometry=h.pos)}function RR(c){for(var o,h,f=0,_=0,w=c.length,S=w-1;_<w;S=_++)f+=((h=c[S]).x-(o=c[_]).x)*(o.y+h.y);return f}Ju.types=["Unknown","Point","LineString","Polygon"],Ju.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var o,h=c.readVarint()+c.pos,f=1,_=0,w=0,S=0,I=[];c.pos<h;){if(_<=0){var P=c.readVarint();f=7&P,_=P>>3}if(_--,f===1||f===2)w+=c.readSVarint(),S+=c.readSVarint(),f===1&&(o&&I.push(o),o=[]),o.push(new CR(w,S));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Ju.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var o=c.readVarint()+c.pos,h=1,f=0,_=0,w=0,S=1/0,I=-1/0,P=1/0,O=-1/0;c.pos<o;){if(f<=0){var L=c.readVarint();h=7&L,f=L>>3}if(f--,h===1||h===2)(_+=c.readSVarint())<S&&(S=_),_>I&&(I=_),(w+=c.readSVarint())<P&&(P=w),w>O&&(O=w);else if(h!==7)throw new Error("unknown command "+h)}return[S,P,I,O]},Ju.prototype.toGeoJSON=function(c,o,h){var f,_,w=this.extent*Math.pow(2,h),S=this.extent*c,I=this.extent*o,P=this.loadGeometry(),O=Ju.types[this.type];function L(G){for(var ee=0;ee<G.length;ee++){var ne=G[ee];G[ee]=[360*(ne.x+S)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+I)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(f=0;f<P.length;f++)H[f]=P[f][0];L(P=H);break;case 2:for(f=0;f<P.length;f++)L(P[f]);break;case 3:for(P=function(G){var ee=G.length;if(ee<=1)return[G];for(var ne,ge,Ae=[],tt=0;tt<ee;tt++){var Le=RR(G[tt]);Le!==0&&(ge===void 0&&(ge=Le<0),ge===Le<0?(ne&&Ae.push(ne),ne=[G[tt]]):ne.push(G[tt]))}return ne&&Ae.push(ne),Ae}(P),f=0;f<P.length;f++)for(_=0;_<P[f].length;_++)L(P[f][_])}P.length===1?P=P[0]:O="Multi"+O;var q={type:"Feature",geometry:{type:O,coordinates:P},properties:this.properties};return"id"in this&&(q.id=this.id),q};var kR=ST,AT=ET;function ET(c,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(MR,this,o),this.length=this._features.length}function MR(c,o,h){c===15?o.version=h.readVarint():c===1?o.name=h.readString():c===5?o.extent=h.readVarint():c===2?o._features.push(h.pos):c===3?o._keys.push(h.readString()):c===4&&o._values.push(function(f){for(var _=null,w=f.readVarint()+f.pos;f.pos<w;){var S=f.readVarint()>>3;_=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return _}(h))}ET.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var o=this._pbf.readVarint()+this._pbf.pos;return new kR(this._pbf,o,this.extent,this._keys,this._values)};var OR=AT;function DR(c,o,h){if(c===3){var f=new OR(h,h.readVarint()+h.pos);f.length&&(o[f.name]=f)}}Il.VectorTile=function(c,o){this.layers=c.readFields(DR,{},o)},Il.VectorTileFeature=ST,Il.VectorTileLayer=AT;const NR=Il.VectorTileFeature.types,Yb=Math.pow(2,13);function mf(c,o,h,f,_,w,S,I){c.emplaceBack(o,h,2*Math.floor(f*Yb)+S,_*Yb*2,w*Yb*2,Math.round(I))}class Kb{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new xl,this.centroidVertexArray=new es,this.indexArray=new to,this.programConfigurations=new Bc(o.layers,o.zoom),this.segments=new bn,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.features=[],this.hasPattern=qb("fill-extrusion",this.layers,h);for(const{feature:_,id:w,index:S,sourceLayerIndex:I}of o){const P=this.layers[0]._featureFilter.needGeometry,O=zc(_,P);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),O,f))continue;const L={id:w,sourceLayerIndex:I,index:S,geometry:P?O.geometry:Lc(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Xb("fill-extrusion",this.layers,L,this.zoom,h)):this.addFeature(L,L.geometry,S,f,{}),h.featureIndex.insert(_,L.geometry,S,I,this.index,!0)}}addFeatures(o,h,f){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,h,f)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,IR),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,ER.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,h,f,_,w){for(const S of xu(h,500)){const I={x:0,y:0,vertexCount:0};let P=0;for(const ee of S)P+=ee.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ee of S){if(ee.length===0||BR(ee))continue;let ne=0;for(let ge=0;ge<ee.length;ge++){const Ae=ee[ge];if(ge>=1){const tt=ee[ge-1];if(!FR(Ae,tt)){O.vertexLength+4>bn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Le=Ae.sub(tt)._perp()._unit(),Ye=tt.dist(Ae);ne+Ye>32768&&(ne=0),mf(this.layoutVertexArray,Ae.x,Ae.y,Le.x,Le.y,0,0,ne),mf(this.layoutVertexArray,Ae.x,Ae.y,Le.x,Le.y,0,1,ne),I.x+=2*Ae.x,I.y+=2*Ae.y,I.vertexCount+=2,ne+=Ye,mf(this.layoutVertexArray,tt.x,tt.y,Le.x,Le.y,0,0,ne),mf(this.layoutVertexArray,tt.x,tt.y,Le.x,Le.y,0,1,ne),I.x+=2*tt.x,I.y+=2*tt.y,I.vertexCount+=2;const gt=O.vertexLength;this.indexArray.emplaceBack(gt,gt+2,gt+1),this.indexArray.emplaceBack(gt+1,gt+2,gt+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+P>bn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),NR[o.type]!=="Polygon")continue;const L=[],H=[],q=O.vertexLength;for(const ee of S)if(ee.length!==0){ee!==S[0]&&H.push(L.length/2);for(let ne=0;ne<ee.length;ne++){const ge=ee[ne];mf(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),I.x+=ge.x,I.y+=ge.y,I.vertexCount+=1,L.push(ge.x),L.push(ge.y)}}const G=_T(L,H);for(let ee=0;ee<G.length;ee+=3)this.indexArray.emplaceBack(q+G[ee],q+G[ee+2],q+G[ee+1]);O.primitiveLength+=G.length/3,O.vertexLength+=P;for(let ee=0;ee<I.vertexCount;ee++){const ne=Math.floor(I.x/I.vertexCount),ge=Math.floor(I.y/I.vertexCount);this.centroidVertexArray.emplaceBack(ne,ge)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}}function FR(c,o){return c.x===o.x&&(c.x<0||c.x>Ei)||c.y===o.y&&(c.y<0||c.y>Ei)}function BR(c){return c.every(o=>o.x<0)||c.every(o=>o.x>Ei)||c.every(o=>o.y<0)||c.every(o=>o.y>Ei)}let IT;lr("FillExtrusionBucket",Kb,{omit:["layers","features"]});var LR={get paint(){return IT=IT||new b({"fill-extrusion-opacity":new mr(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vr(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mr(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mr(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vu(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vr(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vr(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mr(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class zR extends d{constructor(o){super(o,LR)}createBucket(o){return new Kb(o)}queryRadius(){return I_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,h,f,_,w,S,I,P){const O=C_(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,I),L=this.paint.get("fill-extrusion-height").evaluate(h,f),H=this.paint.get("fill-extrusion-base").evaluate(h,f),q=function(ee,ne,ge,Ae){const tt=[];for(const Le of ee){const Ye=[Le.x,Le.y,0,1];P_(Ye,Ye,ne),tt.push(new T(Ye[0]/Ye[3],Ye[1]/Ye[3]))}return tt}(O,P),G=function(ee,ne,ge,Ae){const tt=[],Le=[],Ye=Ae[8]*ne,gt=Ae[9]*ne,Nt=Ae[10]*ne,rr=Ae[11]*ne,Lr=Ae[8]*ge,er=Ae[9]*ge,Yt=Ae[10]*ge,xr=Ae[11]*ge;for(const dr of ee){const or=[],wt=[];for(const Ir of dr){const yr=Ir.x,Gr=Ir.y,zn=Ae[0]*yr+Ae[4]*Gr+Ae[12],Dn=Ae[1]*yr+Ae[5]*Gr+Ae[13],Li=Ae[2]*yr+Ae[6]*Gr+Ae[14],vo=Ae[3]*yr+Ae[7]*Gr+Ae[15],ns=Li+Nt,zi=vo+rr,xs=zn+Lr,ws=Dn+er,Ts=Li+Yt,mi=vo+xr,Ui=new T((zn+Ye)/zi,(Dn+gt)/zi);Ui.z=ns/zi,or.push(Ui);const ds=new T(xs/mi,ws/mi);ds.z=Ts/mi,wt.push(ds)}tt.push(or),Le.push(wt)}return[tt,Le]}(_,H,L,P);return function(ee,ne,ge){let Ae=1/0;sT(ge,ne)&&(Ae=CT(ge,ne[0]));for(let tt=0;tt<ne.length;tt++){const Le=ne[tt],Ye=ee[tt];for(let gt=0;gt<Le.length-1;gt++){const Nt=Le[gt],rr=[Nt,Le[gt+1],Ye[gt+1],Ye[gt],Nt];iT(ge,rr)&&(Ae=Math.min(Ae,CT(ge,rr)))}}return Ae!==1/0&&Ae}(G[0],G[1],q)}}function _f(c,o){return c.x*o.x+c.y*o.y}function CT(c,o){if(c.length===1){let h=0;const f=o[h++];let _;for(;!_||f.equals(_);)if(_=o[h++],!_)return 1/0;for(;h<o.length;h++){const w=o[h],S=c[0],I=_.sub(f),P=w.sub(f),O=S.sub(f),L=_f(I,I),H=_f(I,P),q=_f(P,P),G=_f(O,I),ee=_f(O,P),ne=L*q-H*H,ge=(q*G-H*ee)/ne,Ae=(L*ee-H*G)/ne,tt=f.z*(1-ge-Ae)+_.z*ge+w.z*Ae;if(isFinite(tt))return tt}return 1/0}{let h=1/0;for(const f of o)h=Math.min(h,f.z);return h}}const UR=C([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:VR}=UR,jR=C([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:HR}=jR,WR=Il.VectorTileFeature.types,$R=Math.cos(Math.PI/180*37.5),PT=Math.pow(2,14)/.5;class Gb{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Hu,this.layoutVertexArray2=new wl,this.indexArray=new to,this.programConfigurations=new Bc(o.layers,o.zoom),this.segments=new bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.hasPattern=qb("line",this.layers,h);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),S=[];for(const{feature:I,id:P,index:O,sourceLayerIndex:L}of o){const H=this.layers[0]._featureFilter.needGeometry,q=zc(I,H);if(!this.layers[0]._featureFilter.filter(new Zn(this.zoom),q,f))continue;const G=w?_.evaluate(q,{},f):void 0,ee={id:P,properties:I.properties,type:I.type,sourceLayerIndex:L,index:O,geometry:H?q.geometry:Lc(I),patterns:{},sortKey:G};S.push(ee)}w&&S.sort((I,P)=>I.sortKey-P.sortKey);for(const I of S){const{geometry:P,index:O,sourceLayerIndex:L}=I;if(this.hasPattern){const H=Xb("line",this.layers,I,this.zoom,h);this.patternFeatures.push(H)}else this.addFeature(I,P,O,f,{});h.featureIndex.insert(o[O].feature,P,O,L,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}addFeatures(o,h,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,HR)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,VR),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,h,f,_,w){const S=this.layers[0].layout,I=S.get("line-join").evaluate(o,{}),P=S.get("line-cap"),O=S.get("line-miter-limit"),L=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const H of h)this.addLine(H,o,I,P,O,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,w,_)}addLine(o,h,f,_,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ae=0;Ae<o.length-1;Ae++)this.totalDistance+=o[Ae].dist(o[Ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=WR[h.type]==="Polygon";let P=o.length;for(;P>=2&&o[P-1].equals(o[P-2]);)P--;let O=0;for(;O<P-1&&o[O].equals(o[O+1]);)O++;if(P<(I?3:2))return;f==="bevel"&&(w=1.05);const L=this.overscaling<=16?15*Ei/(512*this.overscaling):0,H=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let q,G,ee,ne,ge;this.e1=this.e2=-1,I&&(q=o[P-2],ge=o[O].sub(q)._unit()._perp());for(let Ae=O;Ae<P;Ae++){if(ee=Ae===P-1?I?o[O+1]:void 0:o[Ae+1],ee&&o[Ae].equals(ee))continue;ge&&(ne=ge),q&&(G=q),q=o[Ae],ge=ee?ee.sub(q)._unit()._perp():ne,ne=ne||ge;let tt=ne.add(ge);tt.x===0&&tt.y===0||tt._unit();const Le=ne.x*ge.x+ne.y*ge.y,Ye=tt.x*ge.x+tt.y*ge.y,gt=Ye!==0?1/Ye:1/0,Nt=2*Math.sqrt(2-2*Ye),rr=Ye<$R&&G&&ee,Lr=ne.x*ge.y-ne.y*ge.x>0;if(rr&&Ae>O){const xr=q.dist(G);if(xr>2*L){const dr=q.sub(q.sub(G)._mult(L/xr)._round());this.updateDistance(G,dr),this.addCurrentVertex(dr,ne,0,0,H),G=dr}}const er=G&&ee;let Yt=er?f:I?"butt":_;if(er&&Yt==="round"&&(gt<S?Yt="miter":gt<=2&&(Yt="fakeround")),Yt==="miter"&&gt>w&&(Yt="bevel"),Yt==="bevel"&&(gt>2&&(Yt="flipbevel"),gt<w&&(Yt="miter")),G&&this.updateDistance(G,q),Yt==="miter")tt._mult(gt),this.addCurrentVertex(q,tt,0,0,H);else if(Yt==="flipbevel"){if(gt>100)tt=ge.mult(-1);else{const xr=gt*ne.add(ge).mag()/ne.sub(ge).mag();tt._perp()._mult(xr*(Lr?-1:1))}this.addCurrentVertex(q,tt,0,0,H),this.addCurrentVertex(q,tt.mult(-1),0,0,H)}else if(Yt==="bevel"||Yt==="fakeround"){const xr=-Math.sqrt(gt*gt-1),dr=Lr?xr:0,or=Lr?0:xr;if(G&&this.addCurrentVertex(q,ne,dr,or,H),Yt==="fakeround"){const wt=Math.round(180*Nt/Math.PI/20);for(let Ir=1;Ir<wt;Ir++){let yr=Ir/wt;if(yr!==.5){const zn=yr-.5;yr+=yr*zn*(yr-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*zn*zn+(.848013+Le*(.215638*Le-1.06021)))}const Gr=ge.sub(ne)._mult(yr)._add(ne)._unit()._mult(Lr?-1:1);this.addHalfVertex(q,Gr.x,Gr.y,!1,Lr,0,H)}}ee&&this.addCurrentVertex(q,ge,-dr,-or,H)}else if(Yt==="butt")this.addCurrentVertex(q,tt,0,0,H);else if(Yt==="square"){const xr=G?1:-1;this.addCurrentVertex(q,tt,xr,xr,H)}else Yt==="round"&&(G&&(this.addCurrentVertex(q,ne,0,0,H),this.addCurrentVertex(q,ne,1,1,H,!0)),ee&&(this.addCurrentVertex(q,ge,-1,-1,H,!0),this.addCurrentVertex(q,ge,0,0,H)));if(rr&&Ae<P-1){const xr=q.dist(ee);if(xr>2*L){const dr=q.add(ee.sub(q)._mult(L/xr)._round());this.updateDistance(q,dr),this.addCurrentVertex(dr,ge,0,0,H),q=dr}}}}addCurrentVertex(o,h,f,_,w,S=!1){const I=h.y*_-h.x,P=-h.y-h.x*_;this.addHalfVertex(o,h.x+h.y*f,h.y-h.x*f,S,!1,f,w),this.addHalfVertex(o,I,P,S,!0,-_,w),this.distance>PT/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,h,f,_,w,S))}addHalfVertex({x:o,y:h},f,_,w,S,I,P){const O=.5*(this.lineClips?this.scaledDistance*(PT-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(w?1:0),(h<<1)+(S?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(I===0?0:I<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),P.primitiveLength++),S?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,h){this.distance+=o.dist(h),this.updateScaledDistance()}}let RT,kT;lr("LineBucket",Gb,{omit:["layers","patternFeatures"]});var MT={get paint(){return kT=kT||new b({"line-opacity":new Vr(Te.paint_line["line-opacity"]),"line-color":new Vr(Te.paint_line["line-color"]),"line-translate":new mr(Te.paint_line["line-translate"]),"line-translate-anchor":new mr(Te.paint_line["line-translate-anchor"]),"line-width":new Vr(Te.paint_line["line-width"]),"line-gap-width":new Vr(Te.paint_line["line-gap-width"]),"line-offset":new Vr(Te.paint_line["line-offset"]),"line-blur":new Vr(Te.paint_line["line-blur"]),"line-dasharray":new ju(Te.paint_line["line-dasharray"]),"line-pattern":new Vu(Te.paint_line["line-pattern"]),"line-gradient":new af(Te.paint_line["line-gradient"])})},get layout(){return RT=RT||new b({"line-cap":new mr(Te.layout_line["line-cap"]),"line-join":new Vr(Te.layout_line["line-join"]),"line-miter-limit":new mr(Te.layout_line["line-miter-limit"]),"line-round-limit":new mr(Te.layout_line["line-round-limit"]),"line-sort-key":new Vr(Te.layout_line["line-sort-key"])})}};class qR extends Vr{possiblyEvaluate(o,h){return h=new Zn(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(o,h)}evaluate(o,h,f,_){return h=le({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(o,h,f,_)}}let O_;class XR extends d{constructor(o){super(o,MT),this.gradientVersion=0,O_||(O_=new qR(MT.paint.properties["line-width"].specification),O_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof hr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,h){super.recalculate(o,h),this.paint._values["line-floorwidth"]=O_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Gb(o)}queryRadius(o){const h=o,f=OT(uf("line-width",this,h),uf("line-gap-width",this,h)),_=uf("line-offset",this,h);return f/2+Math.abs(_)+I_(this.paint.get("line-translate"))}queryIntersectsFeature(o,h,f,_,w,S,I){const P=C_(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,I),O=I/2*OT(this.paint.get("line-width").evaluate(h,f),this.paint.get("line-gap-width").evaluate(h,f)),L=this.paint.get("line-offset").evaluate(h,f);return L&&(_=function(H,q){const G=[];for(let ee=0;ee<H.length;ee++){const ne=H[ee],ge=[];for(let Ae=0;Ae<ne.length;Ae++){const tt=ne[Ae-1],Le=ne[Ae],Ye=ne[Ae+1],gt=Ae===0?new T(0,0):Le.sub(tt)._unit()._perp(),Nt=Ae===ne.length-1?new T(0,0):Ye.sub(Le)._unit()._perp(),rr=gt._add(Nt)._unit(),Lr=rr.x*Nt.x+rr.y*Nt.y;Lr!==0&&rr._mult(1/Lr),ge.push(rr._mult(q)._add(Le))}G.push(ge)}return G}(_,L*I)),function(H,q,G){for(let ee=0;ee<q.length;ee++){const ne=q[ee];if(H.length>=3){for(let ge=0;ge<ne.length;ge++)if(Yu(H,ne[ge]))return!0}if(rR(H,ne,G))return!0}return!1}(P,_,O)}isTileClipped(){return!0}}function OT(c,o){return o>0?o+2*c:c}const ZR=C([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YR=C([{name:"a_projected_pos",components:3,type:"Float32"}],4);C([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const KR=C([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);C([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DT=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),GR=C([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function JR(c,o,h){return c.sections.forEach(f=>{f.text=function(_,w,S){const I=w.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?_=_.toLocaleUpperCase():I==="lowercase"&&(_=_.toLocaleLowerCase()),ks.applyArabicShaping&&(_=ks.applyArabicShaping(_)),_}(f.text,o,h)}),c}C([{name:"triangle",components:3,type:"Uint16"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),C([{type:"Float32",name:"offsetX"}]),C([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),C([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const yf={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Mi=24,NT=On,FT=function(c,o,h,f,_){var w,S,I=8*_-f-1,P=(1<<I)-1,O=P>>1,L=-7,H=_-1,q=-1,G=c[o+H];for(H+=q,w=G&(1<<-L)-1,G>>=-L,L+=I;L>0;w=256*w+c[o+H],H+=q,L-=8);for(S=w&(1<<-L)-1,w>>=-L,L+=f;L>0;S=256*S+c[o+H],H+=q,L-=8);if(w===0)w=1-O;else{if(w===P)return S?NaN:1/0*(G?-1:1);S+=Math.pow(2,f),w-=O}return(G?-1:1)*S*Math.pow(2,w-f)},BT=function(c,o,h,f,_,w){var S,I,P,O=8*w-_-1,L=(1<<O)-1,H=L>>1,q=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=0,ee=1,ne=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=L):(S=Math.floor(Math.log(o)/Math.LN2),o*(P=Math.pow(2,-S))<1&&(S--,P*=2),(o+=S+H>=1?q/P:q*Math.pow(2,1-H))*P>=2&&(S++,P/=2),S+H>=L?(I=0,S=L):S+H>=1?(I=(o*P-1)*Math.pow(2,_),S+=H):(I=o*Math.pow(2,H-1)*Math.pow(2,_),S=0));_>=8;c[h+G]=255&I,G+=ee,I/=256,_-=8);for(S=S<<_|I,O+=_;O>0;c[h+G]=255&S,G+=ee,S/=256,O-=8);c[h+G-ee]|=128*ne};function On(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}On.Varint=0,On.Fixed64=1,On.Bytes=2,On.Fixed32=5;var Jb=4294967296,LT=1/Jb,zT=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Da(c){return c.type===On.Bytes?c.readVarint()+c.pos:c.pos+1}function Qu(c,o,h){return h?4294967296*o+(c>>>0):4294967296*(o>>>0)+(c>>>0)}function UT(c,o,h){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));h.realloc(f);for(var _=h.pos-1;_>=c;_--)h.buf[_+f]=h.buf[_]}function QR(c,o){for(var h=0;h<c.length;h++)o.writeVarint(c[h])}function ek(c,o){for(var h=0;h<c.length;h++)o.writeSVarint(c[h])}function tk(c,o){for(var h=0;h<c.length;h++)o.writeFloat(c[h])}function rk(c,o){for(var h=0;h<c.length;h++)o.writeDouble(c[h])}function nk(c,o){for(var h=0;h<c.length;h++)o.writeBoolean(c[h])}function ik(c,o){for(var h=0;h<c.length;h++)o.writeFixed32(c[h])}function sk(c,o){for(var h=0;h<c.length;h++)o.writeSFixed32(c[h])}function ok(c,o){for(var h=0;h<c.length;h++)o.writeFixed64(c[h])}function ak(c,o){for(var h=0;h<c.length;h++)o.writeSFixed64(c[h])}function D_(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+16777216*c[o+3]}function eh(c,o,h){c[h]=o,c[h+1]=o>>>8,c[h+2]=o>>>16,c[h+3]=o>>>24}function VT(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+(c[o+3]<<24)}On.prototype={destroy:function(){this.buf=null},readFields:function(c,o,h){for(h=h||this.length;this.pos<h;){var f=this.readVarint(),_=f>>3,w=this.pos;this.type=7&f,c(_,o,this),this.pos===w&&this.skip(f)}return o},readMessage:function(c,o){return this.readFields(c,o,this.readVarint()+this.pos)},readFixed32:function(){var c=D_(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=VT(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=D_(this.buf,this.pos)+D_(this.buf,this.pos+4)*Jb;return this.pos+=8,c},readSFixed64:function(){var c=D_(this.buf,this.pos)+VT(this.buf,this.pos+4)*Jb;return this.pos+=8,c},readFloat:function(){var c=FT(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=FT(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var o,h,f=this.buf;return o=127&(h=f[this.pos++]),h<128?o:(o|=(127&(h=f[this.pos++]))<<7,h<128?o:(o|=(127&(h=f[this.pos++]))<<14,h<128?o:(o|=(127&(h=f[this.pos++]))<<21,h<128?o:function(_,w,S){var I,P,O=S.buf;if(I=(112&(P=O[S.pos++]))>>4,P<128||(I|=(127&(P=O[S.pos++]))<<3,P<128)||(I|=(127&(P=O[S.pos++]))<<10,P<128)||(I|=(127&(P=O[S.pos++]))<<17,P<128)||(I|=(127&(P=O[S.pos++]))<<24,P<128)||(I|=(1&(P=O[S.pos++]))<<31,P<128))return Qu(_,I,w);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(h=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,o=this.pos;return this.pos=c,c-o>=12&&zT?function(h,f,_){return zT.decode(h.subarray(f,_))}(this.buf,o,c):function(h,f,_){for(var w="",S=f;S<_;){var I,P,O,L=h[S],H=null,q=L>239?4:L>223?3:L>191?2:1;if(S+q>_)break;q===1?L<128&&(H=L):q===2?(192&(I=h[S+1]))==128&&(H=(31&L)<<6|63&I)<=127&&(H=null):q===3?(P=h[S+2],(192&(I=h[S+1]))==128&&(192&P)==128&&((H=(15&L)<<12|(63&I)<<6|63&P)<=2047||H>=55296&&H<=57343)&&(H=null)):q===4&&(P=h[S+2],O=h[S+3],(192&(I=h[S+1]))==128&&(192&P)==128&&(192&O)==128&&((H=(15&L)<<18|(63&I)<<12|(63&P)<<6|63&O)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,q=1):H>65535&&(H-=65536,w+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),w+=String.fromCharCode(H),S+=q}return w}(this.buf,o,c)},readBytes:function(){var c=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,c);return this.pos=c,o},readPackedVarint:function(c,o){if(this.type!==On.Bytes)return c.push(this.readVarint(o));var h=Da(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(o));return c},readPackedSVarint:function(c){if(this.type!==On.Bytes)return c.push(this.readSVarint());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==On.Bytes)return c.push(this.readBoolean());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==On.Bytes)return c.push(this.readFloat());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==On.Bytes)return c.push(this.readDouble());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==On.Bytes)return c.push(this.readFixed32());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==On.Bytes)return c.push(this.readSFixed32());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==On.Bytes)return c.push(this.readFixed64());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==On.Bytes)return c.push(this.readSFixed64());var o=Da(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed64());return c},skip:function(c){var o=7&c;if(o===On.Varint)for(;this.buf[this.pos++]>127;);else if(o===On.Bytes)this.pos=this.readVarint()+this.pos;else if(o===On.Fixed32)this.pos+=4;else{if(o!==On.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(c,o){this.writeVarint(c<<3|o)},realloc:function(c){for(var o=this.length||16;o<this.pos+c;)o*=2;if(o!==this.length){var h=new Uint8Array(o);h.set(this.buf),this.buf=h,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),eh(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),eh(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),eh(this.buf,-1&c,this.pos),eh(this.buf,Math.floor(c*LT),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),eh(this.buf,-1&c,this.pos),eh(this.buf,Math.floor(c*LT),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(o,h){var f,_;if(o>=0?(f=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,_=_+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(w,S,I){I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,I.buf[I.pos]=127&(w>>>=7)}(f,0,h),function(w,S){var I=(7&w)<<4;S.buf[S.pos++]|=I|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))}(_,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var o=this.pos;this.pos=function(f,_,w){for(var S,I,P=0;P<_.length;P++){if((S=_.charCodeAt(P))>55295&&S<57344){if(!I){S>56319||P+1===_.length?(f[w++]=239,f[w++]=191,f[w++]=189):I=S;continue}if(S<56320){f[w++]=239,f[w++]=191,f[w++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(f[w++]=239,f[w++]=191,f[w++]=189,I=null);S<128?f[w++]=S:(S<2048?f[w++]=S>>6|192:(S<65536?f[w++]=S>>12|224:(f[w++]=S>>18|240,f[w++]=S>>12&63|128),f[w++]=S>>6&63|128),f[w++]=63&S|128)}return w}(this.buf,c,this.pos);var h=this.pos-o;h>=128&&UT(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),BT(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),BT(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var o=c.length;this.writeVarint(o),this.realloc(o);for(var h=0;h<o;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,o){this.pos++;var h=this.pos;c(o,this);var f=this.pos-h;f>=128&&UT(h,f,this),this.pos=h-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,o,h){this.writeTag(c,On.Bytes),this.writeRawMessage(o,h)},writePackedVarint:function(c,o){o.length&&this.writeMessage(c,QR,o)},writePackedSVarint:function(c,o){o.length&&this.writeMessage(c,ek,o)},writePackedBoolean:function(c,o){o.length&&this.writeMessage(c,nk,o)},writePackedFloat:function(c,o){o.length&&this.writeMessage(c,tk,o)},writePackedDouble:function(c,o){o.length&&this.writeMessage(c,rk,o)},writePackedFixed32:function(c,o){o.length&&this.writeMessage(c,ik,o)},writePackedSFixed32:function(c,o){o.length&&this.writeMessage(c,sk,o)},writePackedFixed64:function(c,o){o.length&&this.writeMessage(c,ok,o)},writePackedSFixed64:function(c,o){o.length&&this.writeMessage(c,ak,o)},writeBytesField:function(c,o){this.writeTag(c,On.Bytes),this.writeBytes(o)},writeFixed32Field:function(c,o){this.writeTag(c,On.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(c,o){this.writeTag(c,On.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(c,o){this.writeTag(c,On.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(c,o){this.writeTag(c,On.Fixed64),this.writeSFixed64(o)},writeVarintField:function(c,o){this.writeTag(c,On.Varint),this.writeVarint(o)},writeSVarintField:function(c,o){this.writeTag(c,On.Varint),this.writeSVarint(o)},writeStringField:function(c,o){this.writeTag(c,On.Bytes),this.writeString(o)},writeFloatField:function(c,o){this.writeTag(c,On.Fixed32),this.writeFloat(o)},writeDoubleField:function(c,o){this.writeTag(c,On.Fixed64),this.writeDouble(o)},writeBooleanField:function(c,o){this.writeVarintField(c,!!o)}};var Qb=p(NT);const ex=3;function lk(c,o,h){c===1&&h.readMessage(ck,o)}function ck(c,o,h){if(c===3){const{id:f,bitmap:_,width:w,height:S,left:I,top:P,advance:O}=h.readMessage(uk,{});o.push({id:f,bitmap:new df({width:w+2*ex,height:S+2*ex},_),metrics:{width:w,height:S,left:I,top:P,advance:O}})}}function uk(c,o,h){c===1?o.id=h.readVarint():c===2?o.bitmap=h.readBytes():c===3?o.width=h.readVarint():c===4?o.height=h.readVarint():c===5?o.left=h.readSVarint():c===6?o.top=h.readSVarint():c===7&&(o.advance=h.readVarint())}const hk=ex;function jT(c){let o=0,h=0;for(const S of c)o+=S.w*S.h,h=Math.max(h,S.w);c.sort((S,I)=>I.h-S.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),h),h:1/0}];let _=0,w=0;for(const S of c)for(let I=f.length-1;I>=0;I--){const P=f[I];if(!(S.w>P.w||S.h>P.h)){if(S.x=P.x,S.y=P.y,w=Math.max(w,S.y+S.h),_=Math.max(_,S.x+S.w),S.w===P.w&&S.h===P.h){const O=f.pop();I<f.length&&(f[I]=O)}else S.h===P.h?(P.x+=S.w,P.w-=S.w):S.w===P.w?(P.y+=S.h,P.h-=S.h):(f.push({x:P.x+S.w,y:P.y,w:P.w-S.w,h:S.h}),P.y+=S.h,P.h-=S.h);break}}return{w:_,h:w,fill:o/(_*w)||0}}const Os=1;class tx{constructor(o,{pixelRatio:h,version:f,stretchX:_,stretchY:w,content:S,textFitWidth:I,textFitHeight:P}){this.paddedRect=o,this.pixelRatio=h,this.stretchX=_,this.stretchY=w,this.content=S,this.version=f,this.textFitWidth=I,this.textFitHeight=P}get tl(){return[this.paddedRect.x+Os,this.paddedRect.y+Os]}get br(){return[this.paddedRect.x+this.paddedRect.w-Os,this.paddedRect.y+this.paddedRect.h-Os]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Os)/this.pixelRatio,(this.paddedRect.h-2*Os)/this.pixelRatio]}}class HT{constructor(o,h){const f={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(o,f,w),this.addImages(h,_,w);const{w:S,h:I}=jT(w),P=new ro({width:S||1,height:I||1});for(const O in o){const L=o[O],H=f[O].paddedRect;ro.copy(L.data,P,{x:0,y:0},{x:H.x+Os,y:H.y+Os},L.data)}for(const O in h){const L=h[O],H=_[O].paddedRect,q=H.x+Os,G=H.y+Os,ee=L.data.width,ne=L.data.height;ro.copy(L.data,P,{x:0,y:0},{x:q,y:G},L.data),ro.copy(L.data,P,{x:0,y:ne-1},{x:q,y:G-1},{width:ee,height:1}),ro.copy(L.data,P,{x:0,y:0},{x:q,y:G+ne},{width:ee,height:1}),ro.copy(L.data,P,{x:ee-1,y:0},{x:q-1,y:G},{width:1,height:ne}),ro.copy(L.data,P,{x:0,y:0},{x:q+ee,y:G},{width:1,height:ne})}this.image=P,this.iconPositions=f,this.patternPositions=_}addImages(o,h,f){for(const _ in o){const w=o[_],S={x:0,y:0,w:w.data.width+2*Os,h:w.data.height+2*Os};f.push(S),h[_]=new tx(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(o,h){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),h),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),h)}patchUpdatedImage(o,h,f){if(!o||!h||o.version===h.version)return;o.version=h.version;const[_,w]=o.tl;f.update(h.data,void 0,{x:_,y:w})}}var Cl;lr("ImagePosition",tx),lr("ImageAtlas",HT),u.ah=void 0,(Cl=u.ah||(u.ah={}))[Cl.none=0]="none",Cl[Cl.horizontal=1]="horizontal",Cl[Cl.vertical=2]="vertical",Cl[Cl.horizontalOnly=3]="horizontalOnly";const vf=-17;class bf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,h){const f=new bf;return f.scale=o||1,f.fontStack=h,f}static forImage(o){const h=new bf;return h.imageName=o,h}}class th{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,h){const f=new th;for(let _=0;_<o.sections.length;_++){const w=o.sections[_];w.image?f.addImageSection(w):f.addTextSection(w,h)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let h="";for(let f=0;f<o.length;f++){const _=o.charCodeAt(f+1)||null,w=o.charCodeAt(f-1)||null;h+=_&&b_(_)&&!yf[o[f+1]]||w&&b_(w)&&!yf[o[f-1]]||!yf[o[f]]?o[f]:yf[o[f]]}return h}(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&F_[this.text.charCodeAt(f)];f++)o++;let h=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&F_[this.text.charCodeAt(f)];f--)h--;this.text=this.text.substring(o,h),this.sectionIndex=this.sectionIndex.slice(o,h)}substring(o,h){const f=new th;return f.text=this.text.substring(o,h),f.sectionIndex=this.sectionIndex.slice(o,h),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,h)=>Math.max(o,this.sections[h].scale),0)}addTextSection(o,h){this.text+=o.text,this.sections.push(bf.forText(o.scale,o.fontStack||h));const f=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(f)}addImageSection(o){const h=o.image?o.image.name:"";if(h.length===0)return void ze("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(bf.forImage(h)),this.sectionIndex.push(this.sections.length-1)):ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function N_(c,o,h,f,_,w,S,I,P,O,L,H,q,G,ee){const ne=th.fromFeature(c,_);let ge;H===u.ah.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:Ae,processStyledBidirectionalText:tt}=ks;if(Ae&&ne.sections.length===1){ge=[];const gt=Ae(ne.toString(),rx(ne,O,w,o,f,G));for(const Nt of gt){const rr=new th;rr.text=Nt,rr.sections=ne.sections;for(let Lr=0;Lr<Nt.length;Lr++)rr.sectionIndex.push(0);ge.push(rr)}}else if(tt){ge=[];const gt=tt(ne.text,ne.sectionIndex,rx(ne,O,w,o,f,G));for(const Nt of gt){const rr=new th;rr.text=Nt[0],rr.sectionIndex=Nt[1],rr.sections=ne.sections,ge.push(rr)}}else ge=function(gt,Nt){const rr=[],Lr=gt.text;let er=0;for(const Yt of Nt)rr.push(gt.substring(er,Yt)),er=Yt;return er<Lr.length&&rr.push(gt.substring(er,Lr.length)),rr}(ne,rx(ne,O,w,o,f,G));const Le=[],Ye={positionedLines:Le,text:ne.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(gt,Nt,rr,Lr,er,Yt,xr,dr,or,wt,Ir,yr){let Gr=0,zn=vf,Dn=0,Li=0;const vo=dr==="right"?1:dr==="left"?0:.5;let ns=0;for(const mi of er){mi.trim();const Ui=mi.getMaxScale(),ds=(Ui-1)*Mi,is={positionedGlyphs:[],lineOffset:0};gt.positionedLines[ns]=is;const Ss=is.positionedGlyphs;let ss=0;if(!mi.length()){zn+=Yt,++ns;continue}for(let Ds=0;Ds<mi.length();Ds++){const En=mi.getSection(Ds),$n=mi.getSectionIndex(Ds),Jn=mi.getCharCode(Ds);let Xs=0,ai=null,ih=null,Jo=null,Qo=Mi;const bo=!(or===u.ah.horizontal||!Ir&&!sf(Jn)||Ir&&(F_[Jn]||(zi=Jn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(zi)))));if(En.imageName){const so=Lr[En.imageName];if(!so)continue;Jo=En.imageName,gt.iconsInText=gt.iconsInText||!0,ih=so.paddedRect;const Zi=so.displaySize;En.scale=En.scale*Mi/yr,ai={width:Zi[0],height:Zi[1],left:Os,top:-3,advance:bo?Zi[1]:Zi[0]},Xs=ds+(Mi-Zi[1]*En.scale),Qo=ai.advance;const Na=bo?Zi[0]*En.scale-Mi*Ui:Zi[1]*En.scale-Mi*Ui;Na>0&&Na>ss&&(ss=Na)}else{const so=rr[En.fontStack],Zi=so&&so[Jn];if(Zi&&Zi.rect)ih=Zi.rect,ai=Zi.metrics;else{const Na=Nt[En.fontStack],If=Na&&Na[Jn];if(!If)continue;ai=If.metrics}Xs=(Ui-En.scale)*Mi}bo?(gt.verticalizable=!0,Ss.push({glyph:Jn,imageName:Jo,x:Gr,y:zn+Xs,vertical:bo,scale:En.scale,fontStack:En.fontStack,sectionIndex:$n,metrics:ai,rect:ih}),Gr+=Qo*En.scale+wt):(Ss.push({glyph:Jn,imageName:Jo,x:Gr,y:zn+Xs,vertical:bo,scale:En.scale,fontStack:En.fontStack,sectionIndex:$n,metrics:ai,rect:ih}),Gr+=ai.advance*En.scale+wt)}Ss.length!==0&&(Dn=Math.max(Gr-wt,Dn),gk(Ss,0,Ss.length-1,vo,ss)),Gr=0;const io=Yt*Ui+ss;is.lineOffset=Math.max(ss,ds),zn+=io,Li=Math.max(io,Li),++ns}var zi;const xs=zn-vf,{horizontalAlign:ws,verticalAlign:Ts}=nx(xr);(function(mi,Ui,ds,is,Ss,ss,io,Ds,En){const $n=(Ui-ds)*Ss;let Jn=0;Jn=ss!==io?-Ds*is-vf:(-is*En+.5)*io;for(const Xs of mi)for(const ai of Xs.positionedGlyphs)ai.x+=$n,ai.y+=Jn})(gt.positionedLines,vo,ws,Ts,Dn,Li,Yt,xs,er.length),gt.top+=-Ts*xs,gt.bottom=gt.top+xs,gt.left+=-ws*Dn,gt.right=gt.left+Dn}(Ye,o,h,f,ge,S,I,P,H,O,q,ee),!function(gt){for(const Nt of gt)if(Nt.positionedGlyphs.length!==0)return!1;return!0}(Le)&&Ye}const F_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dk={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},fk={40:!0};function WT(c,o,h,f,_,w){if(o.imageName){const S=f[o.imageName];return S?S.displaySize[0]*o.scale*Mi/w+_:0}{const S=h[o.fontStack],I=S&&S[c];return I?I.metrics.advance*o.scale+_:0}}function $T(c,o,h,f){const _=Math.pow(c-o,2);return f?c<o?_/2:2*_:_+Math.abs(h)*h}function pk(c,o,h){let f=0;return c===10&&(f-=1e4),h&&(f+=150),c!==40&&c!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function qT(c,o,h,f,_,w){let S=null,I=$T(o,h,_,w);for(const P of f){const O=$T(o-P.x,h,_,w)+P.badness;O<=I&&(S=P,I=O)}return{index:c,x:o,priorBreak:S,badness:I}}function XT(c){return c?XT(c.priorBreak).concat(c.index):[]}function rx(c,o,h,f,_,w){if(!c)return[];const S=[],I=function(H,q,G,ee,ne,ge){let Ae=0;for(let tt=0;tt<H.length();tt++){const Le=H.getSection(tt);Ae+=WT(H.getCharCode(tt),Le,ee,ne,q,ge)}return Ae/Math.max(1,Math.ceil(Ae/G))}(c,o,h,f,_,w),P=c.text.indexOf("â")>=0;let O=0;for(let H=0;H<c.length();H++){const q=c.getSection(H),G=c.getCharCode(H);if(F_[G]||(O+=WT(G,q,f,_,o,w)),H<c.length()-1){const ee=!((L=G)<11904)&&(!!vn["CJK Compatibility Forms"](L)||!!vn["CJK Compatibility"](L)||!!vn["CJK Strokes"](L)||!!vn["CJK Symbols and Punctuation"](L)||!!vn["Enclosed CJK Letters and Months"](L)||!!vn["Halfwidth and Fullwidth Forms"](L)||!!vn["Ideographic Description Characters"](L)||!!vn["Vertical Forms"](L)||v_.test(String.fromCodePoint(L)));(dk[G]||ee||q.imageName||H!==c.length()-2&&fk[c.getCharCode(H+1)])&&S.push(qT(H+1,O,I,S,pk(G,c.getCharCode(H+1),ee&&P),!1))}}var L;return XT(qT(c.length(),O,I,S,0,!0))}function nx(c){let o=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:o,verticalAlign:h}}function gk(c,o,h,f,_){if(!f&&!_)return;const w=c[h],S=(c[h].x+w.metrics.advance*w.scale)*f;for(let I=o;I<=h;I++)c[I].x-=S,c[I].y+=_}function mk(c,o,h){const{horizontalAlign:f,verticalAlign:_}=nx(h),w=o[0]-c.displaySize[0]*f,S=o[1]-c.displaySize[1]*_;return{image:c,top:S,bottom:S+c.displaySize[1],left:w,right:w+c.displaySize[0]}}function ZT(c){var o,h;let f=c.left,_=c.top,w=c.right-f,S=c.bottom-_;const I=(o=c.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",P=(h=c.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",O=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(P==="proportional"){if(I==="stretchOnly"&&w/S<O||I==="proportional"){const L=Math.ceil(S*O);f*=L/w,w=L}}else if(I==="proportional"&&P==="stretchOnly"&&O!==0&&w/S>O){const L=Math.ceil(w/O);_*=L/S,S=L}return{x1:f,y1:_,x2:f+w,y2:_+S}}function YT(c,o,h,f,_,w){const S=c.image;let I;if(S.content){const ge=S.content,Ae=S.pixelRatio||1;I=[ge[0]/Ae,ge[1]/Ae,S.displaySize[0]-ge[2]/Ae,S.displaySize[1]-ge[3]/Ae]}const P=o.left*w,O=o.right*w;let L,H,q,G;h==="width"||h==="both"?(G=_[0]+P-f[3],H=_[0]+O+f[1]):(G=_[0]+(P+O-S.displaySize[0])/2,H=G+S.displaySize[0]);const ee=o.top*w,ne=o.bottom*w;return h==="height"||h==="both"?(L=_[1]+ee-f[0],q=_[1]+ne+f[2]):(L=_[1]+(ee+ne-S.displaySize[1])/2,q=L+S.displaySize[1]),{image:S,top:L,right:H,bottom:q,left:G,collisionPadding:I}}const xf=255,Go=128,Pl=xf*Go;function KT(c,o){const{expression:h}=o;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Zn(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=h;let w=0;for(;w<f.length&&f[w]<=c;)w++;w=Math.max(0,w-1);let S=w;for(;S<f.length&&f[S]<c+1;)S++;S=Math.min(f.length-1,S);const I=f[w],P=f[S];return h.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:P,minSize:h.evaluate(new Zn(I)),maxSize:h.evaluate(new Zn(P)),interpolationType:_}}}function ix(c,o,h){let f="never";const _=c.get(o);return _?f=_:c.get(h)&&(f="always"),f}const _k=Il.VectorTileFeature.types,yk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function B_(c,o,h,f,_,w,S,I,P,O,L,H,q){const G=I?Math.min(Pl,Math.round(I[0])):0,ee=I?Math.min(Pl,Math.round(I[1])):0;c.emplaceBack(o,h,Math.round(32*f),Math.round(32*_),w,S,(G<<1)+(P?1:0),ee,16*O,16*L,256*H,256*q)}function sx(c,o,h){c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h)}function vk(c){for(const o of c.sections)if(Ob(o.text))return!0;return!1}class ox{constructor(o){this.layoutVertexArray=new Wu,this.indexArray=new to,this.programConfigurations=o,this.segments=new bn,this.dynamicLayoutVertexArray=new lf,this.opacityVertexArray=new $s,this.hasVisibleVertices=!1,this.placedSymbolArray=new Yn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,h,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ZR.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,YR.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,yk,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}lr("SymbolBuffers",ox);class ax{constructor(o,h,f){this.layoutVertexArray=new o,this.layoutAttributes=h,this.indexArray=new f,this.segments=new bn,this.collisionVertexArray=new Yo}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,KR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}lr("CollisionBuffers",ax);class rh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(S=>S.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ub([]),this.placementViewportMatrix=Ub([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=KT(this.zoom,h["text-size"]),this.iconSizeData=KT(this.zoom,h["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=ix(f,"text-overlap","text-allow-overlap")!=="never"||ix(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(S=>u.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=o.sourceID}createArrays(){this.text=new ox(new Bc(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new ox(new Bc(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Kn,this.lineVertexArray=new Qi,this.symbolInstances=new gn,this.textAnchorOffsets=new Gn}calculateGlyphDependencies(o,h,f,_,w){for(let S=0;S<o.length;S++)if(h[o.charCodeAt(S)]=!0,(f||_)&&w){const I=yf[o.charAt(S)];I&&(h[I.charCodeAt(0)]=!0)}}populate(o,h,f){const _=this.layers[0],w=_.layout,S=w.get("text-font"),I=w.get("text-field"),P=w.get("icon-image"),O=(I.value.kind!=="constant"||I.value.value instanceof wn&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),L=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,H=w.get("symbol-sort-key");if(this.features=[],!O&&!L)return;const q=h.iconDependencies,G=h.glyphDependencies,ee=h.availableImages,ne=new Zn(this.zoom);for(const{feature:ge,id:Ae,index:tt,sourceLayerIndex:Le}of o){const Ye=_._featureFilter.needGeometry,gt=zc(ge,Ye);if(!_._featureFilter.filter(ne,gt,f))continue;let Nt,rr;if(Ye||(gt.geometry=Lc(ge)),O){const er=_.getValueAndResolveTokens("text-field",gt,f,ee),Yt=wn.factory(er),xr=this.hasRTLText=this.hasRTLText||vk(Yt);(!xr||ks.getRTLTextPluginStatus()==="unavailable"||xr&&ks.isParsed())&&(Nt=JR(Yt,_,gt))}if(L){const er=_.getValueAndResolveTokens("icon-image",gt,f,ee);rr=er instanceof si?er:si.fromString(er)}if(!Nt&&!rr)continue;const Lr=this.sortFeaturesByKey?H.evaluate(gt,{},f):void 0;if(this.features.push({id:Ae,text:Nt,icon:rr,index:tt,sourceLayerIndex:Le,geometry:gt.geometry,properties:ge.properties,type:_k[ge.type],sortKey:Lr}),rr&&(q[rr.name]=!0),Nt){const er=S.evaluate(gt,{},f).join(","),Yt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const xr of Nt.sections)if(xr.image)q[xr.image.name]=!0;else{const dr=rf(Nt.toString()),or=xr.fontStack||er,wt=G[or]=G[or]||{};this.calculateGlyphDependencies(xr.text,wt,Yt,this.allowVerticalPlacement,dr)}}}w.get("symbol-placement")==="line"&&(this.features=function(ge){const Ae={},tt={},Le=[];let Ye=0;function gt(er){Le.push(ge[er]),Ye++}function Nt(er,Yt,xr){const dr=tt[er];return delete tt[er],tt[Yt]=dr,Le[dr].geometry[0].pop(),Le[dr].geometry[0]=Le[dr].geometry[0].concat(xr[0]),dr}function rr(er,Yt,xr){const dr=Ae[Yt];return delete Ae[Yt],Ae[er]=dr,Le[dr].geometry[0].shift(),Le[dr].geometry[0]=xr[0].concat(Le[dr].geometry[0]),dr}function Lr(er,Yt,xr){const dr=xr?Yt[0][Yt[0].length-1]:Yt[0][0];return`${er}:${dr.x}:${dr.y}`}for(let er=0;er<ge.length;er++){const Yt=ge[er],xr=Yt.geometry,dr=Yt.text?Yt.text.toString():null;if(!dr){gt(er);continue}const or=Lr(dr,xr),wt=Lr(dr,xr,!0);if(or in tt&&wt in Ae&&tt[or]!==Ae[wt]){const Ir=rr(or,wt,xr),yr=Nt(or,wt,Le[Ir].geometry);delete Ae[or],delete tt[wt],tt[Lr(dr,Le[yr].geometry,!0)]=yr,Le[Ir].geometry=null}else or in tt?Nt(or,wt,xr):wt in Ae?rr(or,wt,xr):(gt(er),Ae[or]=Ye-1,tt[wt]=Ye-1)}return Le.filter(er=>er.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,Ae)=>ge.sortKey-Ae.sortKey)}update(o,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,h,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,h,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,h){const f=this.lineVertexArray.length;if(o.segment!==void 0){let _=o.dist(h[o.segment+1]),w=o.dist(h[o.segment]);const S={};for(let I=o.segment+1;I<h.length;I++)S[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:_},I<h.length-1&&(_+=h[I+1].dist(h[I]));for(let I=o.segment||0;I>=0;I--)S[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:w},I>0&&(w+=h[I-1].dist(h[I]));for(let I=0;I<h.length;I++){const P=S[I];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,h,f,_,w,S,I,P,O,L,H,q){const G=o.indexArray,ee=o.layoutVertexArray,ne=o.segments.prepareSegment(4*h.length,ee,G,this.canOverlap?S.sortKey:void 0),ge=this.glyphOffsetArray.length,Ae=ne.vertexLength,tt=this.allowVerticalPlacement&&I===u.ah.vertical?Math.PI/2:0,Le=S.text&&S.text.sections;for(let Ye=0;Ye<h.length;Ye++){const{tl:gt,tr:Nt,bl:rr,br:Lr,tex:er,pixelOffsetTL:Yt,pixelOffsetBR:xr,minFontScaleX:dr,minFontScaleY:or,glyphOffset:wt,isSDF:Ir,sectionIndex:yr}=h[Ye],Gr=ne.vertexLength,zn=wt[1];B_(ee,P.x,P.y,gt.x,zn+gt.y,er.x,er.y,f,Ir,Yt.x,Yt.y,dr,or),B_(ee,P.x,P.y,Nt.x,zn+Nt.y,er.x+er.w,er.y,f,Ir,xr.x,Yt.y,dr,or),B_(ee,P.x,P.y,rr.x,zn+rr.y,er.x,er.y+er.h,f,Ir,Yt.x,xr.y,dr,or),B_(ee,P.x,P.y,Lr.x,zn+Lr.y,er.x+er.w,er.y+er.h,f,Ir,xr.x,xr.y,dr,or),sx(o.dynamicLayoutVertexArray,P,tt),G.emplaceBack(Gr,Gr+1,Gr+2),G.emplaceBack(Gr+1,Gr+2,Gr+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Ye!==h.length-1&&yr===h[Ye+1].sectionIndex||o.programConfigurations.populatePaintArrays(ee.length,S,S.index,{},q,Le&&Le[yr])}o.placedSymbolArray.emplaceBack(P.x,P.y,ge,this.glyphOffsetArray.length-ge,Ae,O,L,P.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],I,0,!1,0,H)}_addCollisionDebugVertex(o,h,f,_,w,S){return h.emplaceBack(0,0),o.emplaceBack(f.x,f.y,_,w,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(o,h,f,_,w,S,I){const P=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),O=P.vertexLength,L=w.layoutVertexArray,H=w.collisionVertexArray,q=I.anchorX,G=I.anchorY;this._addCollisionDebugVertex(L,H,S,q,G,new T(o,h)),this._addCollisionDebugVertex(L,H,S,q,G,new T(f,h)),this._addCollisionDebugVertex(L,H,S,q,G,new T(f,_)),this._addCollisionDebugVertex(L,H,S,q,G,new T(o,_)),P.vertexLength+=4;const ee=w.indexArray;ee.emplaceBack(O,O+1),ee.emplaceBack(O+1,O+2),ee.emplaceBack(O+2,O+3),ee.emplaceBack(O+3,O),P.primitiveLength+=4}addDebugCollisionBoxes(o,h,f,_){for(let w=o;w<h;w++){const S=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,_?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ax(qs,DT.members,Xi),this.iconCollisionBox=new ax(qs,DT.members,Xi);for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(o,h,f,_,w,S,I,P,O){const L={};for(let H=h;H<f;H++){const q=o.get(H);L.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},L.textFeatureIndex=q.featureIndex;break}for(let H=_;H<w;H++){const q=o.get(H);L.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},L.verticalTextFeatureIndex=q.featureIndex;break}for(let H=S;H<I;H++){const q=o.get(H);L.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},L.iconFeatureIndex=q.featureIndex;break}for(let H=P;H<O;H++){const q=o.get(H);L.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},L.verticalIconFeatureIndex=q.featureIndex;break}return L}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,h){const f=o.placedSymbolArray.get(h),_=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<_;w+=4)o.indexArray.emplaceBack(w,w+1,w+2),o.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(o),f=Math.cos(o),_=[],w=[],S=[];for(let I=0;I<this.symbolInstances.length;++I){S.push(I);const P=this.symbolInstances.get(I);_.push(0|Math.round(h*P.anchorX+f*P.anchorY)),w.push(P.featureIndex)}return S.sort((I,P)=>_[I]-_[P]||w[P]-w[I]),S}addToSortKeyRanges(o,h){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===h?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const f=this.symbolInstances.get(h);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,w,S)=>{_>=0&&S.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let GT,JT;lr("SymbolBucket",rh,{omit:["layers","collisionBoxArray","features","compareText"]}),rh.MAX_GLYPHS=65535,rh.addDynamicAttributes=sx;var lx={get paint(){return JT=JT||new b({"icon-opacity":new Vr(Te.paint_symbol["icon-opacity"]),"icon-color":new Vr(Te.paint_symbol["icon-color"]),"icon-halo-color":new Vr(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vr(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vr(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new mr(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new mr(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Vr(Te.paint_symbol["text-opacity"]),"text-color":new Vr(Te.paint_symbol["text-color"],{runtimeType:dt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Vr(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Vr(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Vr(Te.paint_symbol["text-halo-blur"]),"text-translate":new mr(Te.paint_symbol["text-translate"]),"text-translate-anchor":new mr(Te.paint_symbol["text-translate-anchor"])})},get layout(){return GT=GT||new b({"symbol-placement":new mr(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new mr(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mr(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vr(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mr(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mr(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mr(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mr(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new mr(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mr(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vr(Te.layout_symbol["icon-size"]),"icon-text-fit":new mr(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mr(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vr(Te.layout_symbol["icon-image"]),"icon-rotate":new Vr(Te.layout_symbol["icon-rotate"]),"icon-padding":new Vr(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new mr(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Vr(Te.layout_symbol["icon-offset"]),"icon-anchor":new Vr(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mr(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mr(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mr(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Vr(Te.layout_symbol["text-field"]),"text-font":new Vr(Te.layout_symbol["text-font"]),"text-size":new Vr(Te.layout_symbol["text-size"]),"text-max-width":new Vr(Te.layout_symbol["text-max-width"]),"text-line-height":new mr(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Vr(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Vr(Te.layout_symbol["text-justify"]),"text-radial-offset":new Vr(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mr(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Vr(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Vr(Te.layout_symbol["text-anchor"]),"text-max-angle":new mr(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new mr(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Vr(Te.layout_symbol["text-rotate"]),"text-padding":new mr(Te.layout_symbol["text-padding"]),"text-keep-upright":new mr(Te.layout_symbol["text-keep-upright"]),"text-transform":new Vr(Te.layout_symbol["text-transform"]),"text-offset":new Vr(Te.layout_symbol["text-offset"]),"text-allow-overlap":new mr(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new mr(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new mr(Te.layout_symbol["text-ignore-placement"]),"text-optional":new mr(Te.layout_symbol["text-optional"])})}};class QT{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:xn,this.defaultValue=o}evaluate(o){if(o.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(o.formattedSection))return h.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lr("FormatSectionOverride",QT,{omit:["defaultValue"]});class L_ extends d{constructor(o){super(o,lx)}recalculate(o,h){if(super.recalculate(o,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const w of f)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,h,f,_){const w=this.layout.get(o).evaluate(h,{},f,_),S=this._unevaluatedLayout._values[o];return S.isDataDriven()||Pu(S.value)||!w?w:function(I,P){return P.replace(/{([^{}]+)}/g,(O,L)=>I&&L in I?String(I[L]):"")}(h.properties,w)}createBucket(o){return new rh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of lx.paint.overridableProperties){if(!L_.hasPaintOverride(this.layout,o))continue;const h=this.paint.get(o),f=new QT(h),_=new Cu(f,h.property.specification);let w=null;w=h.value.kind==="constant"||h.value.kind==="source"?new dl("source",_):new fl("composite",_,h.value.zoomStops),this.paint._values[o]=new _o(h.property,w,h.parameters)}}_handleOverridablePaintPropertyUpdate(o,h,f){return!(!this.layout||h.isDataDriven()||f.isDataDriven())&&L_.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,h){const f=o.get("text-field"),_=lx.paint.properties[h];let w=!1;const S=I=>{for(const P of I)if(_.overrides&&_.overrides.hasOverride(P))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof wn)S(f.value.value.sections);else if(f.value.kind==="source"){const I=O=>{w||(O instanceof Ni&&Ln(O.value)===br?S(O.value.sections):O instanceof vu?S(O.sections):O.eachChild(I))},P=f.value;P._styleExpression&&I(P._styleExpression.expression)}return w}}let e2;var bk={get paint(){return e2=e2||new b({"background-color":new mr(Te.paint_background["background-color"]),"background-pattern":new ju(Te.paint_background["background-pattern"]),"background-opacity":new mr(Te.paint_background["background-opacity"])})}};class xk extends d{constructor(o){super(o,bk)}}let t2;var wk={get paint(){return t2=t2||new b({"raster-opacity":new mr(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new mr(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mr(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mr(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new mr(Te.paint_raster["raster-saturation"]),"raster-contrast":new mr(Te.paint_raster["raster-contrast"]),"raster-resampling":new mr(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new mr(Te.paint_raster["raster-fade-duration"])})}};class Tk extends d{constructor(o){super(o,wk)}}class Sk extends d{constructor(o){super(o,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ak{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const cx=63710088e-1;class Rl{constructor(o,h){if(isNaN(o)||isNaN(h))throw new Error(`Invalid LngLat object: (${o}, ${h})`);if(this.lng=+o,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rl(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const h=Math.PI/180,f=this.lat*h,_=o.lat*h,w=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((o.lng-this.lng)*h);return cx*Math.acos(Math.min(w,1))}static convert(o){if(o instanceof Rl)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Rl(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Rl(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const r2=2*Math.PI*cx;function n2(c){return r2*Math.cos(c*Math.PI/180)}function i2(c){return(180+c)/360}function s2(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function o2(c,o){return c/n2(o)}function ux(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class wf{constructor(o,h,f=0){this.x=+o,this.y=+h,this.z=+f}static fromLngLat(o,h=0){const f=Rl.convert(o);return new wf(i2(f.lng),s2(f.lat),o2(h,f.lat))}toLngLat(){return new Rl(360*this.x-180,ux(this.y))}toAltitude(){return this.z*n2(ux(this.y))}meterInMercatorCoordinateUnits(){return 1/r2*(o=ux(this.y),1/Math.cos(o*Math.PI/180));var o}}function a2(c,o,h){var f=2*Math.PI*6378137/256/Math.pow(2,h);return[c*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class hx{constructor(o,h,f){if(!function(_,w,S){return!(_<0||_>25||S<0||S>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(o,h,f))throw new Error(`x=${h}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=h,this.y=f,this.key=Tf(0,o,o,h,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,h,f){const _=(S=this.y,I=this.z,P=a2(256*(w=this.x),256*(S=Math.pow(2,I)-S-1),I),O=a2(256*(w+1),256*(S+1),I),P[0]+","+P[1]+","+O[0]+","+O[1]);var w,S,I,P,O;const L=function(H,q,G){let ee,ne="";for(let ge=H;ge>0;ge--)ee=1<<ge-1,ne+=(q&ee?1:0)+(G&ee?2:0);return ne}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,_)}isChildOf(o){const h=this.z-o.z;return h>0&&o.x===this.x>>h&&o.y===this.y>>h}getTilePoint(o){const h=Math.pow(2,this.z);return new T((o.x*h-this.x)*Ei,(o.y*h-this.y)*Ei)}toString(){return`${this.z}/${this.x}/${this.y}`}}class l2{constructor(o,h){this.wrap=o,this.canonical=h,this.key=Tf(o,h.z,h.z,h.x,h.y)}}class no{constructor(o,h,f,_,w){if(o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=h,this.canonical=new hx(f,+_,+w),this.key=Tf(h,o,f,_,w)}clone(){return new no(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-o;return o>this.canonical.z?new no(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new no(o,this.wrap,o,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(o,h){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?Tf(this.wrap*+h,o,this.canonical.z,this.canonical.x,this.canonical.y):Tf(this.wrap*+h,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const h=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>h&&o.canonical.y===this.canonical.y>>h}children(o){if(this.overscaledZ>=o)return[new no(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new no(h,this.wrap,h,f,_),new no(h,this.wrap,h,f+1,_),new no(h,this.wrap,h,f,_+1),new no(h,this.wrap,h,f+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new no(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new no(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new l2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new wf(o.x-this.wrap,o.y))}}function Tf(c,o,h,f,_){(c*=2)<0&&(c=-1*c-1);const w=1<<h;return(w*w*c+w*_+f).toString(36)+h.toString(36)+o.toString(36)}lr("CanonicalTileID",hx),lr("OverscaledTileID",no,{omit:["posMatrix"]});class c2{constructor(o,h,f,_=1,w=1,S=1,I=0){if(this.uid=o,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void ze(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const P=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=S,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<P;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(P,O)]=this.data[this._idx(P-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,P)]=this.data[this._idx(O,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<P;O++)for(let L=0;L<P;L++){const H=this.get(O,L);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(o,h){const f=new Uint8Array(this.data.buffer),_=4*this._idx(o,h);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,h){if(o<-1||o>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(o+1)}unpack(o,h,f){return o*this.redFactor+h*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ro({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,h,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,w=h*this.dim+this.dim,S=f*this.dim,I=f*this.dim+this.dim;switch(h){case-1:_=w-1;break;case 1:w=_+1}switch(f){case-1:S=I-1;break;case 1:I=S+1}const P=-h*this.dim,O=-f*this.dim;for(let L=S;L<I;L++)for(let H=_;H<w;H++)this.data[this._idx(H,L)]=o.data[this._idx(H+P,L+O)]}}lr("DEMData",c2);class u2{constructor(o){this._stringToNumber={},this._numberToString=[];for(let h=0;h<o.length;h++){const f=o[h];this._stringToNumber[f]=h,this._numberToString[h]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class h2{constructor(o,h,f,_,w){this.type="Feature",this._vectorTileFeature=o,o._z=h,o._x=f,o._y=_,this.properties=o.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(o[h]=this[h]);return o}}class d2{constructor(o,h){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new ml(Ei,16,0),this.grid3D=new ml(Ei,16,0),this.featureIndexArray=new us,this.promoteId=h}insert(o,h,f,_,w,S){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,w);const P=S?this.grid3D:this.grid;for(let O=0;O<h.length;O++){const L=h[O],H=[1/0,1/0,-1/0,-1/0];for(let q=0;q<L.length;q++){const G=L[q];H[0]=Math.min(H[0],G.x),H[1]=Math.min(H[1],G.y),H[2]=Math.max(H[2],G.x),H[3]=Math.max(H[3],G.y)}H[0]<Ei&&H[1]<Ei&&H[2]>=0&&H[3]>=0&&P.insert(I,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Il.VectorTile(new Qb(this.rawTileData)).layers,this.sourceLayerCoder=new u2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,h,f,_){this.loadVTLayers();const w=o.params||{},S=Ei/o.tileSize/o.scale,I=Vd(w.filter),P=o.queryGeometry,O=o.queryPadding*S,L=p2(P),H=this.grid.query(L.minX-O,L.minY-O,L.maxX+O,L.maxY+O),q=p2(o.cameraQueryGeometry),G=this.grid3D.query(q.minX-O,q.minY-O,q.maxX+O,q.maxY+O,(ge,Ae,tt,Le)=>function(Ye,gt,Nt,rr,Lr){for(const Yt of Ye)if(gt<=Yt.x&&Nt<=Yt.y&&rr>=Yt.x&&Lr>=Yt.y)return!0;const er=[new T(gt,Nt),new T(gt,Lr),new T(rr,Lr),new T(rr,Nt)];if(Ye.length>2){for(const Yt of er)if(Yu(Ye,Yt))return!0}for(let Yt=0;Yt<Ye.length-1;Yt++)if(iR(Ye[Yt],Ye[Yt+1],er))return!0;return!1}(o.cameraQueryGeometry,ge-O,Ae-O,tt+O,Le+O));for(const ge of G)H.push(ge);H.sort(Ek);const ee={};let ne;for(let ge=0;ge<H.length;ge++){const Ae=H[ge];if(Ae===ne)continue;ne=Ae;const tt=this.featureIndexArray.get(Ae);let Le=null;this.loadMatchingFeature(ee,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,I,w.layers,w.availableImages,h,f,_,(Ye,gt,Nt)=>(Le||(Le=Lc(Ye)),gt.queryIntersectsFeature(P,Ye,Nt,Le,this.z,o.transform,S,o.pixelPosMatrix)))}return ee}loadMatchingFeature(o,h,f,_,w,S,I,P,O,L,H){const q=this.bucketLayerIDs[h];if(S&&!function(ge,Ae){for(let tt=0;tt<ge.length;tt++)if(Ae.indexOf(ge[tt])>=0)return!0;return!1}(S,q))return;const G=this.sourceLayerCoder.decode(f),ee=this.vtLayers[G].feature(_);if(w.needGeometry){const ge=zc(ee,!0);if(!w.filter(new Zn(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!w.filter(new Zn(this.tileID.overscaledZ),ee))return;const ne=this.getId(ee,G);for(let ge=0;ge<q.length;ge++){const Ae=q[ge];if(S&&S.indexOf(Ae)<0)continue;const tt=P[Ae];if(!tt)continue;let Le={};ne&&L&&(Le=L.getState(tt.sourceLayer||"_geojsonTileLayer",ne));const Ye=le({},O[Ae]);Ye.paint=f2(Ye.paint,tt.paint,ee,Le,I),Ye.layout=f2(Ye.layout,tt.layout,ee,Le,I);const gt=!H||H(ee,tt,Le);if(!gt)continue;const Nt=new h2(ee,this.z,this.x,this.y,ne);Nt.layer=Ye;let rr=o[Ae];rr===void 0&&(rr=o[Ae]=[]),rr.push({featureIndex:_,feature:Nt,intersectionZ:gt})}}lookupSymbolFeatures(o,h,f,_,w,S,I,P){const O={};this.loadVTLayers();const L=Vd(w);for(const H of o)this.loadMatchingFeature(O,f,_,H,L,S,I,P,h);return O}hasLayer(o){for(const h of this.bucketLayerIDs)for(const f of h)if(o===f)return!0;return!1}getId(o,h){let f=o.id;return this.promoteId&&(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof f=="boolean"&&(f=Number(f))),f}}function f2(c,o,h,f,_){return Ie(c,(w,S)=>{const I=o instanceof Dc?o.get(S):null;return I&&I.evaluate?I.evaluate(h,f,_):I})}function p2(c){let o=1/0,h=1/0,f=-1/0,_=-1/0;for(const w of c)o=Math.min(o,w.x),h=Math.min(h,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return{minX:o,minY:h,maxX:f,maxY:_}}function Ek(c,o){return o-c}function g2(c,o,h,f,_){const w=[];for(let S=0;S<c.length;S++){const I=c[S];let P;for(let O=0;O<I.length-1;O++){let L=I[O],H=I[O+1];L.x<o&&H.x<o||(L.x<o?L=new T(o,L.y+(o-L.x)/(H.x-L.x)*(H.y-L.y))._round():H.x<o&&(H=new T(o,L.y+(o-L.x)/(H.x-L.x)*(H.y-L.y))._round()),L.y<h&&H.y<h||(L.y<h?L=new T(L.x+(h-L.y)/(H.y-L.y)*(H.x-L.x),h)._round():H.y<h&&(H=new T(L.x+(h-L.y)/(H.y-L.y)*(H.x-L.x),h)._round()),L.x>=f&&H.x>=f||(L.x>=f?L=new T(f,L.y+(f-L.x)/(H.x-L.x)*(H.y-L.y))._round():H.x>=f&&(H=new T(f,L.y+(f-L.x)/(H.x-L.x)*(H.y-L.y))._round()),L.y>=_&&H.y>=_||(L.y>=_?L=new T(L.x+(_-L.y)/(H.y-L.y)*(H.x-L.x),_)._round():H.y>=_&&(H=new T(L.x+(_-L.y)/(H.y-L.y)*(H.x-L.x),_)._round()),P&&L.equals(P[P.length-1])||(P=[L],w.push(P)),P.push(H)))))}}return w}lr("FeatureIndex",d2,{omit:["rawTileData","sourceLayerCoder"]});class kl extends T{constructor(o,h,f,_){super(o,h),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new kl(this.x,this.y,this.angle,this.segment)}}function m2(c,o,h,f,_){if(o.segment===void 0||h===0)return!0;let w=o,S=o.segment+1,I=0;for(;I>-h/2;){if(S--,S<0)return!1;I-=c[S].dist(w),w=c[S]}I+=c[S].dist(c[S+1]),S++;const P=[];let O=0;for(;I<h/2;){const L=c[S],H=c[S+1];if(!H)return!1;let q=c[S-1].angleTo(L)-L.angleTo(H);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:I,angleDelta:q}),O+=q;I-P[0].distance>f;)O-=P.shift().angleDelta;if(O>_)return!1;S++,I+=L.dist(H)}return!0}function _2(c){let o=0;for(let h=0;h<c.length-1;h++)o+=c[h].dist(c[h+1]);return o}function y2(c,o,h){return c?.6*o*h:0}function v2(c,o){return Math.max(c?c.right-c.left:0,o?o.right-o.left:0)}function Ik(c,o,h,f,_,w){const S=y2(h,_,w),I=v2(h,f)*w;let P=0;const O=_2(c)/2;for(let L=0;L<c.length-1;L++){const H=c[L],q=c[L+1],G=H.dist(q);if(P+G>O){const ee=(O-P)/G,ne=_s.number(H.x,q.x,ee),ge=_s.number(H.y,q.y,ee),Ae=new kl(ne,ge,q.angleTo(H),L);return Ae._round(),!S||m2(c,Ae,I,S,o)?Ae:void 0}P+=G}}function Ck(c,o,h,f,_,w,S,I,P){const O=y2(f,w,S),L=v2(f,_),H=L*S,q=c[0].x===0||c[0].x===P||c[0].y===0||c[0].y===P;return o-H<o/4&&(o=H+o/4),b2(c,q?o/2*I%o:(L/2+2*w)*S*I%o,o,O,h,H,q,!1,P)}function b2(c,o,h,f,_,w,S,I,P){const O=w/2,L=_2(c);let H=0,q=o-h,G=[];for(let ee=0;ee<c.length-1;ee++){const ne=c[ee],ge=c[ee+1],Ae=ne.dist(ge),tt=ge.angleTo(ne);for(;q+h<H+Ae;){q+=h;const Le=(q-H)/Ae,Ye=_s.number(ne.x,ge.x,Le),gt=_s.number(ne.y,ge.y,Le);if(Ye>=0&&Ye<P&&gt>=0&&gt<P&&q-O>=0&&q+O<=L){const Nt=new kl(Ye,gt,tt,ee);Nt._round(),f&&!m2(c,Nt,w,f,_)||G.push(Nt)}}H+=Ae}return I||G.length||S||(G=b2(c,H/2,h,f,_,w,S,!0,P)),G}lr("Anchor",kl);const Sf=Os;function x2(c,o,h,f){const _=[],w=c.image,S=w.pixelRatio,I=w.paddedRect.w-2*Sf,P=w.paddedRect.h-2*Sf;let O={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const L=w.stretchX||[[0,I]],H=w.stretchY||[[0,P]],q=(wt,Ir)=>wt+Ir[1]-Ir[0],G=L.reduce(q,0),ee=H.reduce(q,0),ne=I-G,ge=P-ee;let Ae=0,tt=G,Le=0,Ye=ee,gt=0,Nt=ne,rr=0,Lr=ge;if(w.content&&f){const wt=w.content,Ir=wt[2]-wt[0],yr=wt[3]-wt[1];(w.textFitWidth||w.textFitHeight)&&(O=ZT(c)),Ae=z_(L,0,wt[0]),Le=z_(H,0,wt[1]),tt=z_(L,wt[0],wt[2]),Ye=z_(H,wt[1],wt[3]),gt=wt[0]-Ae,rr=wt[1]-Le,Nt=Ir-tt,Lr=yr-Ye}const er=O.x1,Yt=O.y1,xr=O.x2-er,dr=O.y2-Yt,or=(wt,Ir,yr,Gr)=>{const zn=U_(wt.stretch-Ae,tt,xr,er),Dn=V_(wt.fixed-gt,Nt,wt.stretch,G),Li=U_(Ir.stretch-Le,Ye,dr,Yt),vo=V_(Ir.fixed-rr,Lr,Ir.stretch,ee),ns=U_(yr.stretch-Ae,tt,xr,er),zi=V_(yr.fixed-gt,Nt,yr.stretch,G),xs=U_(Gr.stretch-Le,Ye,dr,Yt),ws=V_(Gr.fixed-rr,Lr,Gr.stretch,ee),Ts=new T(zn,Li),mi=new T(ns,Li),Ui=new T(ns,xs),ds=new T(zn,xs),is=new T(Dn/S,vo/S),Ss=new T(zi/S,ws/S),ss=o*Math.PI/180;if(ss){const En=Math.sin(ss),$n=Math.cos(ss),Jn=[$n,-En,En,$n];Ts._matMult(Jn),mi._matMult(Jn),ds._matMult(Jn),Ui._matMult(Jn)}const io=wt.stretch+wt.fixed,Ds=Ir.stretch+Ir.fixed;return{tl:Ts,tr:mi,bl:ds,br:Ui,tex:{x:w.paddedRect.x+Sf+io,y:w.paddedRect.y+Sf+Ds,w:yr.stretch+yr.fixed-io,h:Gr.stretch+Gr.fixed-Ds},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:is,pixelOffsetBR:Ss,minFontScaleX:Nt/S/xr,minFontScaleY:Lr/S/dr,isSDF:h}};if(f&&(w.stretchX||w.stretchY)){const wt=w2(L,ne,G),Ir=w2(H,ge,ee);for(let yr=0;yr<wt.length-1;yr++){const Gr=wt[yr],zn=wt[yr+1];for(let Dn=0;Dn<Ir.length-1;Dn++)_.push(or(Gr,Ir[Dn],zn,Ir[Dn+1]))}}else _.push(or({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:P+1}));return _}function z_(c,o,h){let f=0;for(const _ of c)f+=Math.max(o,Math.min(h,_[1]))-Math.max(o,Math.min(h,_[0]));return f}function w2(c,o,h){const f=[{fixed:-1,stretch:0}];for(const[_,w]of c){const S=f[f.length-1];f.push({fixed:_-S.stretch,stretch:S.stretch}),f.push({fixed:_-S.stretch,stretch:S.stretch+(w-_)})}return f.push({fixed:o+Sf,stretch:h}),f}function U_(c,o,h,f){return c/o*h+f}function V_(c,o,h,f){return c-o*h/f}class j_{constructor(o,h,f,_,w,S,I,P,O,L){var H;if(this.boxStartIndex=o.length,O){let q=S.top,G=S.bottom;const ee=S.collisionPadding;ee&&(q-=ee[1],G+=ee[3]);let ne=G-q;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{const q=!((H=S.image)===null||H===void 0)&&H.content&&(S.image.textFitWidth||S.image.textFitHeight)?ZT(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom};q.y1=q.y1*I-P[0],q.y2=q.y2*I+P[2],q.x1=q.x1*I-P[3],q.x2=q.x2*I+P[1];const G=S.collisionPadding;if(G&&(q.x1-=G[0]*I,q.y1-=G[1]*I,q.x2+=G[2]*I,q.y2+=G[3]*I),L){const ee=new T(q.x1,q.y1),ne=new T(q.x2,q.y1),ge=new T(q.x1,q.y2),Ae=new T(q.x2,q.y2),tt=L*Math.PI/180;ee._rotate(tt),ne._rotate(tt),ge._rotate(tt),Ae._rotate(tt),q.x1=Math.min(ee.x,ne.x,ge.x,Ae.x),q.x2=Math.max(ee.x,ne.x,ge.x,Ae.x),q.y1=Math.min(ee.y,ne.y,ge.y,Ae.y),q.y2=Math.max(ee.y,ne.y,ge.y,Ae.y)}o.emplaceBack(h.x,h.y,q.x1,q.y1,q.x2,q.y2,f,_,w)}this.boxEndIndex=o.length}}class Pk{constructor(o=[],h=(f,_)=>f<_?-1:f>_?1:0){if(this.data=o,this.length=this.data.length,this.compare=h,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:h,compare:f}=this,_=h[o];for(;o>0;){const w=o-1>>1,S=h[w];if(f(_,S)>=0)break;h[o]=S,o=w}h[o]=_}_down(o){const{data:h,compare:f}=this,_=this.length>>1,w=h[o];for(;o<_;){let S=1+(o<<1);const I=S+1;if(I<this.length&&f(h[I],h[S])<0&&(S=I),f(h[S],w)>=0)break;h[o]=h[S],o=S}h[o]=w}}function Rk(c,o=1,h=!1){let f=1/0,_=1/0,w=-1/0,S=-1/0;const I=c[0];for(let G=0;G<I.length;G++){const ee=I[G];(!G||ee.x<f)&&(f=ee.x),(!G||ee.y<_)&&(_=ee.y),(!G||ee.x>w)&&(w=ee.x),(!G||ee.y>S)&&(S=ee.y)}const P=Math.min(w-f,S-_);let O=P/2;const L=new Pk([],kk);if(P===0)return new T(f,_);for(let G=f;G<w;G+=P)for(let ee=_;ee<S;ee+=P)L.push(new nh(G+O,ee+O,O,c));let H=function(G){let ee=0,ne=0,ge=0;const Ae=G[0];for(let tt=0,Le=Ae.length,Ye=Le-1;tt<Le;Ye=tt++){const gt=Ae[tt],Nt=Ae[Ye],rr=gt.x*Nt.y-Nt.x*gt.y;ne+=(gt.x+Nt.x)*rr,ge+=(gt.y+Nt.y)*rr,ee+=3*rr}return new nh(ne/ee,ge/ee,0,G)}(c),q=L.length;for(;L.length;){const G=L.pop();(G.d>H.d||!H.d)&&(H=G,h&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,q)),G.max-H.d<=o||(O=G.h/2,L.push(new nh(G.p.x-O,G.p.y-O,O,c)),L.push(new nh(G.p.x+O,G.p.y-O,O,c)),L.push(new nh(G.p.x-O,G.p.y+O,O,c)),L.push(new nh(G.p.x+O,G.p.y+O,O,c)),q+=4)}return h&&(console.log(`num probes: ${q}`),console.log(`best distance: ${H.d}`)),H.p}function kk(c,o){return o.max-c.max}function nh(c,o,h,f){this.p=new T(c,o),this.h=h,this.d=function(_,w){let S=!1,I=1/0;for(let P=0;P<w.length;P++){const O=w[P];for(let L=0,H=O.length,q=H-1;L<H;q=L++){const G=O[L],ee=O[q];G.y>_.y!=ee.y>_.y&&_.x<(ee.x-G.x)*(_.y-G.y)/(ee.y-G.y)+G.x&&(S=!S),I=Math.min(I,oT(_,G,ee))}}return(S?1:-1)*Math.sqrt(I)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var rs;u.aq=void 0,(rs=u.aq||(u.aq={}))[rs.center=1]="center",rs[rs.left=2]="left",rs[rs.right=3]="right",rs[rs.top=4]="top",rs[rs.bottom=5]="bottom",rs[rs["top-left"]=6]="top-left",rs[rs["top-right"]=7]="top-right",rs[rs["bottom-left"]=8]="bottom-left",rs[rs["bottom-right"]=9]="bottom-right";const Ml=7,dx=Number.POSITIVE_INFINITY;function T2(c,o){return o[1]!==dx?function(h,f,_){let w=0,S=0;switch(f=Math.abs(f),_=Math.abs(_),h){case"top-right":case"top-left":case"top":S=_-Ml;break;case"bottom-right":case"bottom-left":case"bottom":S=-_+Ml}switch(h){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,S]}(c,o[0],o[1]):function(h,f){let _=0,w=0;f<0&&(f=0);const S=f/Math.SQRT2;switch(h){case"top-right":case"top-left":w=S-Ml;break;case"bottom-right":case"bottom-left":w=-S+Ml;break;case"bottom":w=-f+Ml;break;case"top":w=f-Ml}switch(h){case"top-right":case"bottom-right":_=-S;break;case"top-left":case"bottom-left":_=S;break;case"left":_=f;break;case"right":_=-f}return[_,w]}(c,o[0])}function S2(c,o,h){var f;const _=c.layout,w=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},h);if(w){const I=w.values,P=[];for(let O=0;O<I.length;O+=2){const L=P[O]=I[O],H=I[O+1].map(q=>q*Mi);L.startsWith("top")?H[1]-=Ml:L.startsWith("bottom")&&(H[1]+=Ml),P[O+1]=H}return new Sn(P)}const S=_.get("text-variable-anchor");if(S){let I;I=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(o,{},h)*Mi,dx]:_.get("text-offset").evaluate(o,{},h).map(O=>O*Mi);const P=[];for(const O of S)P.push(O,T2(O,I));return new Sn(P)}return null}function fx(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mk(c,o,h,f,_,w,S,I,P,O,L){let H=w.textMaxSize.evaluate(o,{});H===void 0&&(H=S);const q=c.layers[0].layout,G=q.get("icon-offset").evaluate(o,{},L),ee=E2(h.horizontal),ne=S/24,ge=c.tilePixelRatio*ne,Ae=c.tilePixelRatio*H/24,tt=c.tilePixelRatio*I,Le=c.tilePixelRatio*q.get("symbol-spacing"),Ye=q.get("text-padding")*c.tilePixelRatio,gt=function(wt,Ir,yr,Gr=1){const zn=wt.get("icon-padding").evaluate(Ir,{},yr),Dn=zn&&zn.values;return[Dn[0]*Gr,Dn[1]*Gr,Dn[2]*Gr,Dn[3]*Gr]}(q,o,L,c.tilePixelRatio),Nt=q.get("text-max-angle")/180*Math.PI,rr=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",Lr=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",er=q.get("symbol-placement"),Yt=Le/2,xr=q.get("icon-text-fit");let dr;f&&xr!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(dr=YT(f,h.vertical,xr,q.get("icon-text-fit-padding"),G,ne)),ee&&(f=YT(f,ee,xr,q.get("icon-text-fit-padding"),G,ne)));const or=(wt,Ir)=>{Ir.x<0||Ir.x>=Ei||Ir.y<0||Ir.y>=Ei||function(yr,Gr,zn,Dn,Li,vo,ns,zi,xs,ws,Ts,mi,Ui,ds,is,Ss,ss,io,Ds,En,$n,Jn,Xs,ai,ih){const Jo=yr.addToLineVertexArray(Gr,zn);let Qo,bo,so,Zi,Na=0,If=0,R2=0,k2=0,xx=-1,wx=-1;const Fa={};let M2=$u("");if(yr.allowVerticalPlacement&&Dn.vertical){const fs=zi.layout.get("text-rotate").evaluate($n,{},ai)+90;so=new j_(xs,Gr,ws,Ts,mi,Dn.vertical,Ui,ds,is,fs),ns&&(Zi=new j_(xs,Gr,ws,Ts,mi,ns,ss,io,is,fs))}if(Li){const fs=zi.layout.get("icon-rotate").evaluate($n,{}),oo=zi.layout.get("icon-text-fit")!=="none",Vc=x2(Li,fs,Xs,oo),Fo=ns?x2(ns,fs,Xs,oo):void 0;bo=new j_(xs,Gr,ws,Ts,mi,Li,ss,io,!1,fs),Na=4*Vc.length;const jc=yr.iconSizeData;let ea=null;jc.kind==="source"?(ea=[Go*zi.layout.get("icon-size").evaluate($n,{})],ea[0]>Pl&&ze(`${yr.layerIds[0]}: Value for "icon-size" is >= ${xf}. Reduce your "icon-size".`)):jc.kind==="composite"&&(ea=[Go*Jn.compositeIconSizes[0].evaluate($n,{},ai),Go*Jn.compositeIconSizes[1].evaluate($n,{},ai)],(ea[0]>Pl||ea[1]>Pl)&&ze(`${yr.layerIds[0]}: Value for "icon-size" is >= ${xf}. Reduce your "icon-size".`)),yr.addSymbols(yr.icon,Vc,ea,En,Ds,$n,u.ah.none,Gr,Jo.lineStartIndex,Jo.lineLength,-1,ai),xx=yr.icon.placedSymbolArray.length-1,Fo&&(If=4*Fo.length,yr.addSymbols(yr.icon,Fo,ea,En,Ds,$n,u.ah.vertical,Gr,Jo.lineStartIndex,Jo.lineLength,-1,ai),wx=yr.icon.placedSymbolArray.length-1)}const O2=Object.keys(Dn.horizontal);for(const fs of O2){const oo=Dn.horizontal[fs];if(!Qo){M2=$u(oo.text);const Fo=zi.layout.get("text-rotate").evaluate($n,{},ai);Qo=new j_(xs,Gr,ws,Ts,mi,oo,Ui,ds,is,Fo)}const Vc=oo.positionedLines.length===1;if(R2+=A2(yr,Gr,oo,vo,zi,is,$n,Ss,Jo,Dn.vertical?u.ah.horizontal:u.ah.horizontalOnly,Vc?O2:[fs],Fa,xx,Jn,ai),Vc)break}Dn.vertical&&(k2+=A2(yr,Gr,Dn.vertical,vo,zi,is,$n,Ss,Jo,u.ah.vertical,["vertical"],Fa,wx,Jn,ai));const Nk=Qo?Qo.boxStartIndex:yr.collisionBoxArray.length,Fk=Qo?Qo.boxEndIndex:yr.collisionBoxArray.length,Bk=so?so.boxStartIndex:yr.collisionBoxArray.length,Lk=so?so.boxEndIndex:yr.collisionBoxArray.length,zk=bo?bo.boxStartIndex:yr.collisionBoxArray.length,Uk=bo?bo.boxEndIndex:yr.collisionBoxArray.length,Vk=Zi?Zi.boxStartIndex:yr.collisionBoxArray.length,jk=Zi?Zi.boxEndIndex:yr.collisionBoxArray.length;let No=-1;const W_=(fs,oo)=>fs&&fs.circleDiameter?Math.max(fs.circleDiameter,oo):oo;No=W_(Qo,No),No=W_(so,No),No=W_(bo,No),No=W_(Zi,No);const D2=No>-1?1:0;D2&&(No*=ih/Mi),yr.glyphOffsetArray.length>=rh.MAX_GLYPHS&&ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$n.sortKey!==void 0&&yr.addToSortKeyRanges(yr.symbolInstances.length,$n.sortKey);const Hk=S2(zi,$n,ai),[Wk,$k]=function(fs,oo){const Vc=fs.length,Fo=oo==null?void 0:oo.values;if((Fo==null?void 0:Fo.length)>0)for(let jc=0;jc<Fo.length;jc+=2){const ea=Fo[jc+1];fs.emplaceBack(u.aq[Fo[jc]],ea[0],ea[1])}return[Vc,fs.length]}(yr.textAnchorOffsets,Hk);yr.symbolInstances.emplaceBack(Gr.x,Gr.y,Fa.right>=0?Fa.right:-1,Fa.center>=0?Fa.center:-1,Fa.left>=0?Fa.left:-1,Fa.vertical||-1,xx,wx,M2,Nk,Fk,Bk,Lk,zk,Uk,Vk,jk,ws,R2,k2,Na,If,D2,0,Ui,No,Wk,$k)}(c,Ir,wt,h,f,_,dr,c.layers[0],c.collisionBoxArray,o.index,o.sourceLayerIndex,c.index,ge,[Ye,Ye,Ye,Ye],rr,P,tt,gt,Lr,G,o,w,O,L,S)};if(er==="line")for(const wt of g2(o.geometry,0,0,Ei,Ei)){const Ir=Ck(wt,Le,Nt,h.vertical||ee,f,24,Ae,c.overscaling,Ei);for(const yr of Ir)ee&&Ok(c,ee.text,Yt,yr)||or(wt,yr)}else if(er==="line-center"){for(const wt of o.geometry)if(wt.length>1){const Ir=Ik(wt,Nt,h.vertical||ee,f,24,Ae);Ir&&or(wt,Ir)}}else if(o.type==="Polygon")for(const wt of xu(o.geometry,0)){const Ir=Rk(wt,16);or(wt[0],new kl(Ir.x,Ir.y,0))}else if(o.type==="LineString")for(const wt of o.geometry)or(wt,new kl(wt[0].x,wt[0].y,0));else if(o.type==="Point")for(const wt of o.geometry)for(const Ir of wt)or([Ir],new kl(Ir.x,Ir.y,0))}function A2(c,o,h,f,_,w,S,I,P,O,L,H,q,G,ee){const ne=function(tt,Le,Ye,gt,Nt,rr,Lr,er){const Yt=gt.layout.get("text-rotate").evaluate(rr,{})*Math.PI/180,xr=[];for(const dr of Le.positionedLines)for(const or of dr.positionedGlyphs){if(!or.rect)continue;const wt=or.rect||{};let Ir=hk+1,yr=!0,Gr=1,zn=0;const Dn=(Nt||er)&&or.vertical,Li=or.metrics.advance*or.scale/2;if(er&&Le.verticalizable&&(zn=dr.lineOffset/2-(or.imageName?-(Mi-or.metrics.width*or.scale)/2:(or.scale-1)*Mi)),or.imageName){const En=Lr[or.imageName];yr=En.sdf,Gr=En.pixelRatio,Ir=Os/Gr}const vo=Nt?[or.x+Li,or.y]:[0,0];let ns=Nt?[0,0]:[or.x+Li+Ye[0],or.y+Ye[1]-zn],zi=[0,0];Dn&&(zi=ns,ns=[0,0]);const xs=or.metrics.isDoubleResolution?2:1,ws=(or.metrics.left-Ir)*or.scale-Li+ns[0],Ts=(-or.metrics.top-Ir)*or.scale+ns[1],mi=ws+wt.w/xs*or.scale/Gr,Ui=Ts+wt.h/xs*or.scale/Gr,ds=new T(ws,Ts),is=new T(mi,Ts),Ss=new T(ws,Ui),ss=new T(mi,Ui);if(Dn){const En=new T(-Li,Li-vf),$n=-Math.PI/2,Jn=Mi/2-Li,Xs=new T(5-vf-Jn,-(or.imageName?Jn:0)),ai=new T(...zi);ds._rotateAround($n,En)._add(Xs)._add(ai),is._rotateAround($n,En)._add(Xs)._add(ai),Ss._rotateAround($n,En)._add(Xs)._add(ai),ss._rotateAround($n,En)._add(Xs)._add(ai)}if(Yt){const En=Math.sin(Yt),$n=Math.cos(Yt),Jn=[$n,-En,En,$n];ds._matMult(Jn),is._matMult(Jn),Ss._matMult(Jn),ss._matMult(Jn)}const io=new T(0,0),Ds=new T(0,0);xr.push({tl:ds,tr:is,bl:Ss,br:ss,tex:wt,writingMode:Le.writingMode,glyphOffset:vo,sectionIndex:or.sectionIndex,isSDF:yr,pixelOffsetTL:io,pixelOffsetBR:Ds,minFontScaleX:0,minFontScaleY:0})}return xr}(0,h,I,_,w,S,f,c.allowVerticalPlacement),ge=c.textSizeData;let Ae=null;ge.kind==="source"?(Ae=[Go*_.layout.get("text-size").evaluate(S,{})],Ae[0]>Pl&&ze(`${c.layerIds[0]}: Value for "text-size" is >= ${xf}. Reduce your "text-size".`)):ge.kind==="composite"&&(Ae=[Go*G.compositeTextSizes[0].evaluate(S,{},ee),Go*G.compositeTextSizes[1].evaluate(S,{},ee)],(Ae[0]>Pl||Ae[1]>Pl)&&ze(`${c.layerIds[0]}: Value for "text-size" is >= ${xf}. Reduce your "text-size".`)),c.addSymbols(c.text,ne,Ae,I,w,S,O,o,P.lineStartIndex,P.lineLength,q,ee);for(const tt of L)H[tt]=c.text.placedSymbolArray.length-1;return 4*ne.length}function E2(c){for(const o in c)return c[o];return null}function Ok(c,o,h,f){const _=c.compareText;if(o in _){const w=_[o];for(let S=w.length-1;S>=0;S--)if(f.dist(w[S])<h)return!0}else _[o]=[];return _[o].push(f),!1}const I2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class px{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,f]=new Uint8Array(o,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=I2[15&f];if(!w)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new px(I,S,w,o)}constructor(o,h=64,f=Float64Array,_){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const w=I2.indexOf(this.ArrayType),S=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-I%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+P,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+S+I+P),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+P,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=o)}add(o,h){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=h,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return gx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,h,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:S,nodeSize:I}=this,P=[0,w.length-1,0],O=[];for(;P.length;){const L=P.pop()||0,H=P.pop()||0,q=P.pop()||0;if(H-q<=I){for(let ge=q;ge<=H;ge++){const Ae=S[2*ge],tt=S[2*ge+1];Ae>=o&&Ae<=f&&tt>=h&&tt<=_&&O.push(w[ge])}continue}const G=q+H>>1,ee=S[2*G],ne=S[2*G+1];ee>=o&&ee<=f&&ne>=h&&ne<=_&&O.push(w[G]),(L===0?o<=ee:h<=ne)&&(P.push(q),P.push(G-1),P.push(1-L)),(L===0?f>=ee:_>=ne)&&(P.push(G+1),P.push(H),P.push(1-L))}return O}within(o,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:S}=this,I=[0,_.length-1,0],P=[],O=f*f;for(;I.length;){const L=I.pop()||0,H=I.pop()||0,q=I.pop()||0;if(H-q<=S){for(let ge=q;ge<=H;ge++)P2(w[2*ge],w[2*ge+1],o,h)<=O&&P.push(_[ge]);continue}const G=q+H>>1,ee=w[2*G],ne=w[2*G+1];P2(ee,ne,o,h)<=O&&P.push(_[G]),(L===0?o-f<=ee:h-f<=ne)&&(I.push(q),I.push(G-1),I.push(1-L)),(L===0?o+f>=ee:h+f>=ne)&&(I.push(G+1),I.push(H),I.push(1-L))}return P}}function gx(c,o,h,f,_,w){if(_-f<=h)return;const S=f+_>>1;C2(c,o,S,f,_,w),gx(c,o,h,f,S-1,1-w),gx(c,o,h,S+1,_,1-w)}function C2(c,o,h,f,_,w){for(;_>f;){if(_-f>600){const O=_-f+1,L=h-f+1,H=Math.log(O),q=.5*Math.exp(2*H/3),G=.5*Math.sqrt(H*q*(O-q)/O)*(L-O/2<0?-1:1);C2(c,o,h,Math.max(f,Math.floor(h-L*q/O+G)),Math.min(_,Math.floor(h+(O-L)*q/O+G)),w)}const S=o[2*h+w];let I=f,P=_;for(Af(c,o,f,h),o[2*_+w]>S&&Af(c,o,f,_);I<P;){for(Af(c,o,I,P),I++,P--;o[2*I+w]<S;)I++;for(;o[2*P+w]>S;)P--}o[2*f+w]===S?Af(c,o,f,P):(P++,Af(c,o,P,_)),P<=h&&(f=P+1),h<=P&&(_=P-1)}}function Af(c,o,h,f){mx(c,h,f),mx(o,2*h,2*f),mx(o,2*h+1,2*f+1)}function mx(c,o,h){const f=c[o];c[o]=c[h],c[h]=f}function P2(c,o,h,f){const _=c-h,w=o-f;return _*_+w*w}var _x;u.bg=void 0,(_x=u.bg||(u.bg={})).create="create",_x.load="load",_x.fullLoad="fullLoad";let H_=null,Ef=[];const yx=1e3/60,vx="loadTime",bx="fullLoadTime",Dk={mark(c){performance.mark(c)},frame(c){const o=c;H_!=null&&Ef.push(o-H_),H_=o},clearMetrics(){H_=null,Ef=[],performance.clearMeasures(vx),performance.clearMeasures(bx);for(const c in u.bg)performance.clearMarks(u.bg[c])},getPerformanceMetrics(){performance.measure(vx,u.bg.create,u.bg.load),performance.measure(bx,u.bg.create,u.bg.fullLoad);const c=performance.getEntriesByName(vx)[0].duration,o=performance.getEntriesByName(bx)[0].duration,h=Ef.length,f=1/(Ef.reduce((w,S)=>w+S,0)/h/1e3),_=Ef.filter(w=>w>yx).reduce((w,S)=>w+(S-yx)/yx,0);return{loadTime:c,fullLoadTime:o,fps:f,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};u.$=class extends W{},u.A=Ku,u.B=Cb,u.C=function(c){if(At==null){const o=c.navigator?c.navigator.userAgent:null;At=!!c.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return At},u.D=mr,u.E=mt,u.F=class{constructor(c,o){this.target=c,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ak(()=>this.process()),this.subscription=function(h,f,_,w){return h.addEventListener(f,_,!1),{unsubscribe:()=>{h.removeEventListener(f,_,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=ot(self)?c:window}registerMessageHandler(c,o){this.messageHandlers[c]=o}sendAsync(c,o){return new Promise((h,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:h,reject:f},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const I={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const w=[],S=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:_l(c.data,w)});this.target.postMessage(S,{transfer:w})})}receive(c){const o=c.data,h=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!=="resource://android"&&location.origin!=="resource://android"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[h];const f=this.abortControllers[h];return delete this.abortControllers[h],void(f&&f.abort())}if(ot(self)||o.mustQueue)return this.tasks[h]=o,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,o)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),o=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(c,o)}processTask(c,o){return a(this,void 0,void 0,function*(){if(o.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(o.error?_.reject(yl(o.error)):_.resolve(yl(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=yl(o.data),f=new AbortController;this.abortControllers[c]=f;try{const _=yield this.messageHandlers[o.type](o.sourceMapId,h,f);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}})}completeTask(c,o,h){const f=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?_l(o):null,data:_l(h,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=Or,u.H=function(){var c=new Ku(16);return Ku!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.I=tx,u.J=function(c,o,h){var f,_,w,S,I,P,O,L,H,q,G,ee,ne=h[0],ge=h[1],Ae=h[2];return o===c?(c[12]=o[0]*ne+o[4]*ge+o[8]*Ae+o[12],c[13]=o[1]*ne+o[5]*ge+o[9]*Ae+o[13],c[14]=o[2]*ne+o[6]*ge+o[10]*Ae+o[14],c[15]=o[3]*ne+o[7]*ge+o[11]*Ae+o[15]):(_=o[1],w=o[2],S=o[3],I=o[4],P=o[5],O=o[6],L=o[7],H=o[8],q=o[9],G=o[10],ee=o[11],c[0]=f=o[0],c[1]=_,c[2]=w,c[3]=S,c[4]=I,c[5]=P,c[6]=O,c[7]=L,c[8]=H,c[9]=q,c[10]=G,c[11]=ee,c[12]=f*ne+I*ge+H*Ae+o[12],c[13]=_*ne+P*ge+q*Ae+o[13],c[14]=w*ne+O*ge+G*Ae+o[14],c[15]=S*ne+L*ge+ee*Ae+o[15]),c},u.K=function(c,o,h){var f=h[0],_=h[1],w=h[2];return c[0]=o[0]*f,c[1]=o[1]*f,c[2]=o[2]*f,c[3]=o[3]*f,c[4]=o[4]*_,c[5]=o[5]*_,c[6]=o[6]*_,c[7]=o[7]*_,c[8]=o[8]*w,c[9]=o[9]*w,c[10]=o[10]*w,c[11]=o[11]*w,c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},u.L=uT,u.M=function(c,o){const h={};for(let f=0;f<o.length;f++){const _=o[f];_ in c&&(h[_]=c[_])}return h},u.N=Rl,u.O=i2,u.P=T,u.Q=s2,u.R=ro,u.S=no,u.T=Uu,u.U=B,u.V=V,u.W=_t,u.X=Ei,u.Y=C,u.Z=wf,u._=a,u.a=Sr,u.a$=function(c,o){var h=c[0],f=c[1],_=c[2],w=c[3],S=c[4],I=c[5],P=c[6],O=c[7],L=c[8],H=c[9],q=c[10],G=c[11],ee=c[12],ne=c[13],ge=c[14],Ae=c[15],tt=o[0],Le=o[1],Ye=o[2],gt=o[3],Nt=o[4],rr=o[5],Lr=o[6],er=o[7],Yt=o[8],xr=o[9],dr=o[10],or=o[11],wt=o[12],Ir=o[13],yr=o[14],Gr=o[15];return Math.abs(h-tt)<=bs*Math.max(1,Math.abs(h),Math.abs(tt))&&Math.abs(f-Le)<=bs*Math.max(1,Math.abs(f),Math.abs(Le))&&Math.abs(_-Ye)<=bs*Math.max(1,Math.abs(_),Math.abs(Ye))&&Math.abs(w-gt)<=bs*Math.max(1,Math.abs(w),Math.abs(gt))&&Math.abs(S-Nt)<=bs*Math.max(1,Math.abs(S),Math.abs(Nt))&&Math.abs(I-rr)<=bs*Math.max(1,Math.abs(I),Math.abs(rr))&&Math.abs(P-Lr)<=bs*Math.max(1,Math.abs(P),Math.abs(Lr))&&Math.abs(O-er)<=bs*Math.max(1,Math.abs(O),Math.abs(er))&&Math.abs(L-Yt)<=bs*Math.max(1,Math.abs(L),Math.abs(Yt))&&Math.abs(H-xr)<=bs*Math.max(1,Math.abs(H),Math.abs(xr))&&Math.abs(q-dr)<=bs*Math.max(1,Math.abs(q),Math.abs(dr))&&Math.abs(G-or)<=bs*Math.max(1,Math.abs(G),Math.abs(or))&&Math.abs(ee-wt)<=bs*Math.max(1,Math.abs(ee),Math.abs(wt))&&Math.abs(ne-Ir)<=bs*Math.max(1,Math.abs(ne),Math.abs(Ir))&&Math.abs(ge-yr)<=bs*Math.max(1,Math.abs(ge),Math.abs(yr))&&Math.abs(Ae-Gr)<=bs*Math.max(1,Math.abs(Ae),Math.abs(Gr))},u.a0=bn,u.a1=hx,u.a2=bt,u.a3=c=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(h=>{o.onloadstart=()=>{h(o)};for(const f of c){const _=window.document.createElement("source");kr(f)||(o.crossOrigin="Anonymous"),_.src=f,o.appendChild(_)}})},u.a4=function(){return Ce++},u.a5=tr,u.a6=rh,u.a7=Vd,u.a8=zc,u.a9=h2,u.aA=function(c){if(c.type==="custom")return new Sk(c);switch(c.type){case"background":return new xk(c);case"circle":return new aR(c);case"fill":return new SR(c);case"fill-extrusion":return new zR(c);case"heatmap":return new cR(c);case"hillshade":return new hR(c);case"line":return new XR(c);case"raster":return new Tk(c);case"symbol":return new L_(c)}},u.aB=De,u.aC=function(c,o){if(!c)return[{command:"setStyle",args:[o]}];let h=[];try{if(!yt(c.version,o.version))return[{command:"setStyle",args:[o]}];yt(c.center,o.center)||h.push({command:"setCenter",args:[o.center]}),yt(c.zoom,o.zoom)||h.push({command:"setZoom",args:[o.zoom]}),yt(c.bearing,o.bearing)||h.push({command:"setBearing",args:[o.bearing]}),yt(c.pitch,o.pitch)||h.push({command:"setPitch",args:[o.pitch]}),yt(c.sprite,o.sprite)||h.push({command:"setSprite",args:[o.sprite]}),yt(c.glyphs,o.glyphs)||h.push({command:"setGlyphs",args:[o.glyphs]}),yt(c.transition,o.transition)||h.push({command:"setTransition",args:[o.transition]}),yt(c.light,o.light)||h.push({command:"setLight",args:[o.light]}),yt(c.terrain,o.terrain)||h.push({command:"setTerrain",args:[o.terrain]}),yt(c.sky,o.sky)||h.push({command:"setSky",args:[o.sky]}),yt(c.projection,o.projection)||h.push({command:"setProjection",args:[o.projection]});const f={},_=[];(function(S,I,P,O){let L;for(L in I=I||{},S=S||{})Object.prototype.hasOwnProperty.call(S,L)&&(Object.prototype.hasOwnProperty.call(I,L)||$r(L,P,O));for(L in I)Object.prototype.hasOwnProperty.call(I,L)&&(Object.prototype.hasOwnProperty.call(S,L)?yt(S[L],I[L])||(S[L].type==="geojson"&&I[L].type==="geojson"&&Zt(S,I,L)?sr(P,{command:"setGeoJSONSourceData",args:[L,I[L].data]}):Jt(L,I,P,O)):Br(L,I,P))})(c.sources,o.sources,_,f);const w=[];c.layers&&c.layers.forEach(S=>{"source"in S&&f[S.source]?h.push({command:"removeLayer",args:[S.id]}):w.push(S)}),h=h.concat(_),function(S,I,P){I=I||[];const O=(S=S||[]).map(Fr),L=I.map(Fr),H=S.reduce(Jr,{}),q=I.reduce(Jr,{}),G=O.slice(),ee=Object.create(null);let ne,ge,Ae,tt,Le;for(let Ye=0,gt=0;Ye<O.length;Ye++)ne=O[Ye],Object.prototype.hasOwnProperty.call(q,ne)?gt++:(sr(P,{command:"removeLayer",args:[ne]}),G.splice(G.indexOf(ne,gt),1));for(let Ye=0,gt=0;Ye<L.length;Ye++)ne=L[L.length-1-Ye],G[G.length-1-Ye]!==ne&&(Object.prototype.hasOwnProperty.call(H,ne)?(sr(P,{command:"removeLayer",args:[ne]}),G.splice(G.lastIndexOf(ne,G.length-gt),1)):gt++,tt=G[G.length-Ye],sr(P,{command:"addLayer",args:[q[ne],tt]}),G.splice(G.length-Ye,0,ne),ee[ne]=!0);for(let Ye=0;Ye<L.length;Ye++)if(ne=L[Ye],ge=H[ne],Ae=q[ne],!ee[ne]&&!yt(ge,Ae))if(yt(ge.source,Ae.source)&&yt(ge["source-layer"],Ae["source-layer"])&&yt(ge.type,Ae.type)){for(Le in Ar(ge.layout,Ae.layout,P,ne,null,"setLayoutProperty"),Ar(ge.paint,Ae.paint,P,ne,null,"setPaintProperty"),yt(ge.filter,Ae.filter)||sr(P,{command:"setFilter",args:[ne,Ae.filter]}),yt(ge.minzoom,Ae.minzoom)&&yt(ge.maxzoom,Ae.maxzoom)||sr(P,{command:"setLayerZoomRange",args:[ne,Ae.minzoom,Ae.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Ar(ge[Le],Ae[Le],P,ne,Le.slice(6),"setPaintProperty"):yt(ge[Le],Ae[Le])||sr(P,{command:"setLayerProperty",args:[ne,Le,Ae[Le]]}));for(Le in Ae)Object.prototype.hasOwnProperty.call(Ae,Le)&&!Object.prototype.hasOwnProperty.call(ge,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Ar(ge[Le],Ae[Le],P,ne,Le.slice(6),"setPaintProperty"):yt(ge[Le],Ae[Le])||sr(P,{command:"setLayerProperty",args:[ne,Le,Ae[Le]]}))}else sr(P,{command:"removeLayer",args:[ne]}),tt=G[G.lastIndexOf(ne)+1],sr(P,{command:"addLayer",args:[Ae,tt]})}(w,o.layers,h)}catch(f){console.warn("Unable to compute style diff:",f),h=[{command:"setStyle",args:[o]}]}return h},u.aD=function(c){const o=[],h=c.id;return h===void 0&&o.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&o.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&o.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),o},u.aE=function c(o,h){if(Array.isArray(o)){if(!Array.isArray(h)||o.length!==h.length)return!1;for(let f=0;f<o.length;f++)if(!c(o[f],h[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&h!==null){if(typeof h!="object"||Object.keys(o).length!==Object.keys(h).length)return!1;for(const f in o)if(!c(o[f],h[f]))return!1;return!0}return o===h},u.aF=Ie,u.aG=Ue,u.aH=class extends Fc{constructor(c,o){super(c,o),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aI=A_,u.aJ=class extends Fc{constructor(c,o){super(c,o),this.current=QP}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let o=1;o<16;o++)if(c[o]!==this.current[o]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aK=Q1,u.aL=eT,u.aM=qr,u.aN=class extends Fc{constructor(c,o){super(c,o),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aO=class extends Fc{constructor(c,o){super(c,o),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aP=function(c,o,h,f,_,w,S){var I=1/(o-h),P=1/(f-_),O=1/(w-S);return c[0]=-2*I,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*P,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*O,c[11]=0,c[12]=(o+h)*I,c[13]=(_+f)*P,c[14]=(S+w)*O,c[15]=1,c},u.aQ=oR,u.aR=class extends je{},u.aS=GR,u.aT=class extends st{},u.aU=Hb,u.aV=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aW=gT,u.aX=es,u.aY=to,u.aZ=class extends _r{},u.a_=function(c,o){return c[0]===o[0]&&c[1]===o[1]&&c[2]===o[2]&&c[3]===o[3]&&c[4]===o[4]&&c[5]===o[5]&&c[6]===o[6]&&c[7]===o[7]&&c[8]===o[8]&&c[9]===o[9]&&c[10]===o[10]&&c[11]===o[11]&&c[12]===o[12]&&c[13]===o[13]&&c[14]===o[14]&&c[15]===o[15]},u.aa=function(c){const o={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,f,_,w)=>{const S=_||w;return o[f]=!S||S.toLowerCase(),""}),o["max-age"]){const h=parseInt(o["max-age"],10);isNaN(h)?delete o["max-age"]:o["max-age"]=h}return o},u.ab=function(c,o){const h=[];for(const f in c)f in o||h.push(f);return h},u.ac=J,u.ad=function(c,o,h){var f=Math.sin(h),_=Math.cos(h),w=o[0],S=o[1],I=o[2],P=o[3],O=o[4],L=o[5],H=o[6],q=o[7];return o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[0]=w*_+O*f,c[1]=S*_+L*f,c[2]=I*_+H*f,c[3]=P*_+q*f,c[4]=O*_-w*f,c[5]=L*_-S*f,c[6]=H*_-I*f,c[7]=q*_-P*f,c},u.ae=function(c){var o=new Ku(16);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=c[11],o[12]=c[12],o[13]=c[13],o[14]=c[14],o[15]=c[15],o},u.af=P_,u.ag=function(c,o){let h=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:S}=c,I=_?J(ys.interpolationFactor(_,o,w,S),0,1):0;c.kind==="camera"?f=_s.number(c.minSize,c.maxSize,I):h=I}return{uSizeT:h,uSize:f}},u.ai=function(c,{uSize:o,uSizeT:h},{lowerSize:f,upperSize:_}){return c.kind==="source"?f/Go:c.kind==="composite"?_s.number(f/Go,_/Go,h):o},u.aj=sx,u.ak=function(c,o,h,f){const _=o.y-c.y,w=o.x-c.x,S=f.y-h.y,I=f.x-h.x,P=S*w-I*_;if(P===0)return null;const O=(I*(c.y-h.y)-S*(c.x-h.x))/P;return new T(c.x+O*w,c.y+O*_)},u.al=g2,u.am=iT,u.an=Ub,u.ao=function(c){let o=1/0,h=1/0,f=-1/0,_=-1/0;for(const w of c)o=Math.min(o,w.x),h=Math.min(h,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return[o,h,f,_]},u.ap=Mi,u.ar=ix,u.as=function(c,o){var h=o[0],f=o[1],_=o[2],w=o[3],S=o[4],I=o[5],P=o[6],O=o[7],L=o[8],H=o[9],q=o[10],G=o[11],ee=o[12],ne=o[13],ge=o[14],Ae=o[15],tt=h*I-f*S,Le=h*P-_*S,Ye=h*O-w*S,gt=f*P-_*I,Nt=f*O-w*I,rr=_*O-w*P,Lr=L*ne-H*ee,er=L*ge-q*ee,Yt=L*Ae-G*ee,xr=H*ge-q*ne,dr=H*Ae-G*ne,or=q*Ae-G*ge,wt=tt*or-Le*dr+Ye*xr+gt*Yt-Nt*er+rr*Lr;return wt?(c[0]=(I*or-P*dr+O*xr)*(wt=1/wt),c[1]=(_*dr-f*or-w*xr)*wt,c[2]=(ne*rr-ge*Nt+Ae*gt)*wt,c[3]=(q*Nt-H*rr-G*gt)*wt,c[4]=(P*Yt-S*or-O*er)*wt,c[5]=(h*or-_*Yt+w*er)*wt,c[6]=(ge*Ye-ee*rr-Ae*Le)*wt,c[7]=(L*rr-q*Ye+G*Le)*wt,c[8]=(S*dr-I*Yt+O*Lr)*wt,c[9]=(f*Yt-h*dr-w*Lr)*wt,c[10]=(ee*Nt-ne*Ye+Ae*tt)*wt,c[11]=(H*Ye-L*Nt-G*tt)*wt,c[12]=(I*er-S*xr-P*Lr)*wt,c[13]=(h*xr-f*er+_*Lr)*wt,c[14]=(ne*Le-ee*gt-ge*tt)*wt,c[15]=(L*gt-H*Le+q*tt)*wt,c):null},u.at=fx,u.au=nx,u.av=px,u.aw=function(){const c={},o=Te.$version;for(const h in Te.$root){const f=Te.$root[h];if(f.required){let _=null;_=h==="version"?o:f.type==="array"?[]:{},_!=null&&(c[h]=_)}}return c},u.ax=tf,u.ay=vr,u.az=function(c){c=c.slice();const o=Object.create(null);for(let h=0;h<c.length;h++)o[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=Ct(c[h],o[c[h].ref]));return c},u.b=Qe,u.b0=function(c,o){return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=o[7],c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},u.b1=function(c,o,h){return c[0]=o[0]*h[0],c[1]=o[1]*h[1],c[2]=o[2]*h[2],c[3]=o[3]*h[3],c},u.b2=function(c,o){return c[0]*o[0]+c[1]*o[1]+c[2]*o[2]+c[3]*o[3]},u.b3=oe,u.b4=l2,u.b5=o2,u.b6=function(c,o,h,f,_){var w,S=1/Math.tan(o/2);return c[0]=S/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+f)*(w=1/(f-_)),c[14]=2*_*f*w):(c[10]=-1,c[14]=-2*f),c},u.b7=function(c,o,h){var f=Math.sin(h),_=Math.cos(h),w=o[4],S=o[5],I=o[6],P=o[7],O=o[8],L=o[9],H=o[10],q=o[11];return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[4]=w*_+O*f,c[5]=S*_+L*f,c[6]=I*_+H*f,c[7]=P*_+q*f,c[8]=O*_-w*f,c[9]=L*_-S*f,c[10]=H*_-I*f,c[11]=q*_-P*f,c},u.b8=U,u.b9=j,u.bA=NT,u.bB=function(c){return c.message===ar},u.bC=hl,u.bD=ks,u.ba=function(c){return c*Math.PI/180},u.bb=function(c,o){const{x:h,y:f}=wf.fromLngLat(o);return!(c<0||c>25||f<0||f>=1||h<0||h>=1)},u.bc=function(c,o){return c[0]=o[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=o[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=o[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bd=class extends z{},u.be=cx,u.bf=Dk,u.bh=ir,u.bi=function(c,o){Sr.REGISTERED_PROTOCOLS[c]=o},u.bj=function(c){delete Sr.REGISTERED_PROTOCOLS[c]},u.bk=function(c,o){const h={};for(let _=0;_<c.length;_++){const w=o&&o[c[_].id]||f_(c[_]);o&&(o[c[_].id]=w);let S=h[w];S||(S=h[w]=[]),S.push(c[_])}const f=[];for(const _ in h)f.push(h[_]);return f},u.bl=lr,u.bm=u2,u.bn=d2,u.bo=HT,u.bp=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Ei/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const o=c.bucket.layers[0],h=o.layout,f=o._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new Zn(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Zn(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Zn(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:L}=c.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Zn(O),c.canonical),f["text-size"].possiblyEvaluate(new Zn(L),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:L}=c.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Zn(O),c.canonical),f["icon-size"].possiblyEvaluate(new Zn(L),c.canonical)]}const w=h.get("text-line-height")*Mi,S=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",I=h.get("text-keep-upright"),P=h.get("text-size");for(const O of c.bucket.features){const L=h.get("text-font").evaluate(O,{},c.canonical).join(","),H=P.evaluate(O,{},c.canonical),q=_.layoutTextSize.evaluate(O,{},c.canonical),G=_.layoutIconSize.evaluate(O,{},c.canonical),ee={horizontal:{},vertical:void 0},ne=O.text;let ge,Ae=[0,0];if(ne){const Ye=ne.toString(),gt=h.get("text-letter-spacing").evaluate(O,{},c.canonical)*Mi,Nt=Pb(Ye)?gt:0,rr=h.get("text-anchor").evaluate(O,{},c.canonical),Lr=S2(o,O,c.canonical);if(!Lr){const dr=h.get("text-radial-offset").evaluate(O,{},c.canonical);Ae=dr?T2(rr,[dr*Mi,dx]):h.get("text-offset").evaluate(O,{},c.canonical).map(or=>or*Mi)}let er=S?"center":h.get("text-justify").evaluate(O,{},c.canonical);const Yt=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(O,{},c.canonical)*Mi:1/0,xr=()=>{c.bucket.allowVerticalPlacement&&rf(Ye)&&(ee.vertical=N_(ne,c.glyphMap,c.glyphPositions,c.imagePositions,L,Yt,w,rr,"left",Nt,Ae,u.ah.vertical,!0,q,H))};if(!S&&Lr){const dr=new Set;if(er==="auto")for(let wt=0;wt<Lr.values.length;wt+=2)dr.add(fx(Lr.values[wt]));else dr.add(er);let or=!1;for(const wt of dr)if(!ee.horizontal[wt])if(or)ee.horizontal[wt]=ee.horizontal[0];else{const Ir=N_(ne,c.glyphMap,c.glyphPositions,c.imagePositions,L,Yt,w,"center",wt,Nt,Ae,u.ah.horizontal,!1,q,H);Ir&&(ee.horizontal[wt]=Ir,or=Ir.positionedLines.length===1)}xr()}else{er==="auto"&&(er=fx(rr));const dr=N_(ne,c.glyphMap,c.glyphPositions,c.imagePositions,L,Yt,w,rr,er,Nt,Ae,u.ah.horizontal,!1,q,H);dr&&(ee.horizontal[er]=dr),xr(),rf(Ye)&&S&&I&&(ee.vertical=N_(ne,c.glyphMap,c.glyphPositions,c.imagePositions,L,Yt,w,rr,er,Nt,Ae,u.ah.vertical,!1,q,H))}}let tt=!1;if(O.icon&&O.icon.name){const Ye=c.imageMap[O.icon.name];Ye&&(ge=mk(c.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},c.canonical),h.get("icon-anchor").evaluate(O,{},c.canonical)),tt=!!Ye.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=tt:c.bucket.sdfIcons!==tt&&ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Le=E2(ee.horizontal)||ee.vertical;c.bucket.iconsInText=!!Le&&Le.iconsInText,(Le||ge)&&Mk(c.bucket,O,ee,ge,c.imageMap,_,q,G,Ae,tt,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bq=Gb,u.br=Zb,u.bs=Kb,u.bt=Il,u.bu=Qb,u.bv=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bw=function(c,o,h,f,_){return a(this,void 0,void 0,function*(){if(V())try{return yield _t(c,o,h,f,_)}catch{}return function(w,S,I,P,O){const L=w.width,H=w.height;Lt&&Ht||(Lt=new OffscreenCanvas(L,H),Ht=Lt.getContext("2d",{willReadFrequently:!0})),Lt.width=L,Lt.height=H,Ht.drawImage(w,0,0,L,H);const q=Ht.getImageData(S,I,P,O);return Ht.clearRect(0,0,L,H),q.data}(c,o,h,f,_)})},u.bx=c2,u.by=p,u.bz=y,u.c=Tt,u.d=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(o)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=le,u.f=c=>new Promise((o,h)=>{const f=new Image;f.onload=()=>{o(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=pt})},f.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(_):pt}),u.g=Et,u.h=(c,o)=>ur(le(c,{type:"json"}),o),u.i=ot,u.j=Nr,u.k=Hr,u.l=(c,o)=>ur(le(c,{type:"arrayBuffer"}),o),u.m=ur,u.n=function(c){return new Qb(c).readFields(lk,[])},u.o=df,u.p=jT,u.q=b,u.r=Ib,u.s=kr,u.t=Qd,u.u=ka,u.v=Te,u.w=ze,u.x=function([c,o,h]){return o+=90,o*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(o)*Math.sin(h),y:c*Math.sin(o)*Math.sin(h),z:c*Math.cos(h)}},u.y=_s,u.z=Zn}),i("worker",["./shared"],function(u){class a{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Y){for(const he of X){this._layerConfigs[he.id]=he;const Se=this._layers[he.id]=u.aA(he);Se._featureFilter=u.a7(Se.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const te=u.bk(Object.values(this._layerConfigs),this.keyCache);for(const he of te){const Se=he.map(Je=>this._layers[Je.id]),Oe=Se[0];if(Oe.visibility==="none")continue;const He=Oe.source||"";let ye=this.familiesBySource[He];ye||(ye=this.familiesBySource[He]={});const We=Oe.sourceLayer||"_geojsonTileLayer";let ft=ye[We];ft||(ft=ye[We]=[]),ft.push(Se)}}}class p{constructor(X){const Y={},te=[];for(const He in X){const ye=X[He],We=Y[He]={};for(const ft in ye){const Je=ye[+ft];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const kt={x:0,y:0,w:Je.bitmap.width+2,h:Je.bitmap.height+2};te.push(kt),We[ft]={rect:kt,metrics:Je.metrics}}}const{w:he,h:Se}=u.p(te),Oe=new u.o({width:he||1,height:Se||1});for(const He in X){const ye=X[He];for(const We in ye){const ft=ye[+We];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const Je=Y[He][We].rect;u.o.copy(ft.bitmap,Oe,{x:0,y:0},{x:Je.x+1,y:Je.y+1},ft.bitmap)}}this.image=Oe,this.positions=Y}}u.bl("GlyphAtlas",p);class y{constructor(X){this.tileID=new u.S(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[]}parse(X,Y,te,he){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=X,this.collisionBoxArray=new u.a5;const Se=new u.bm(Object.keys(X.layers).sort()),Oe=new u.bn(this.tileID,this.promoteId);Oe.bucketLayerIDs=[];const He={},ye={featureIndex:Oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},We=Y.familiesBySource[this.source];for(const Wt in We){const Rr=X.layers[Wt];if(!Rr)continue;Rr.version===1&&u.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Dr=Se.encode(Wt),It=[];for(let hn=0;hn<Rr.length;hn++){const Ur=Rr.feature(hn),Qr=Oe.getId(Ur,Wt);It.push({feature:Ur,id:Qr,index:hn,sourceLayerIndex:Dr})}for(const hn of We[Wt]){const Ur=hn[0];Ur.source!==this.source&&u.w(`layer.source = ${Ur.source} does not equal this.source = ${this.source}`),Ur.minzoom&&this.zoom<Math.floor(Ur.minzoom)||Ur.maxzoom&&this.zoom>=Ur.maxzoom||Ur.visibility!=="none"&&(x(hn,this.zoom,te),(He[Ur.id]=Ur.createBucket({index:Oe.bucketLayerIDs.length,layers:hn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source})).populate(It,ye,this.tileID.canonical),Oe.bucketLayerIDs.push(hn.map(Qr=>Qr.id)))}}const ft=u.aF(ye.glyphDependencies,Wt=>Object.keys(Wt).map(Number));this.inFlightDependencies.forEach(Wt=>Wt==null?void 0:Wt.abort()),this.inFlightDependencies=[];let Je=Promise.resolve({});if(Object.keys(ft).length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),Je=he.sendAsync({type:"GG",data:{stacks:ft,source:this.source,tileID:this.tileID,type:"glyphs"}},Wt)}const kt=Object.keys(ye.iconDependencies);let Vt=Promise.resolve({});if(kt.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),Vt=he.sendAsync({type:"GI",data:{icons:kt,source:this.source,tileID:this.tileID,type:"icons"}},Wt)}const Kt=Object.keys(ye.patternDependencies);let Wr=Promise.resolve({});if(Kt.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),Wr=he.sendAsync({type:"GI",data:{icons:Kt,source:this.source,tileID:this.tileID,type:"patterns"}},Wt)}const[Er,wr,gr]=yield Promise.all([Je,Vt,Wr]),Yr=new p(Er),Pr=new u.bo(wr,gr);for(const Wt in He){const Rr=He[Wt];Rr instanceof u.a6?(x(Rr.layers,this.zoom,te),u.bp({bucket:Rr,glyphMap:Er,glyphPositions:Yr.positions,imageMap:wr,imagePositions:Pr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Rr.hasPattern&&(Rr instanceof u.bq||Rr instanceof u.br||Rr instanceof u.bs)&&(x(Rr.layers,this.zoom,te),Rr.addFeatures(ye,this.tileID.canonical,Pr.patternPositions))}return this.status="done",{buckets:Object.values(He).filter(Wt=>!Wt.isEmpty()),featureIndex:Oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yr.image,imageAtlas:Pr,glyphMap:this.returnDependencies?Er:null,iconMap:this.returnDependencies?wr:null,glyphPositions:this.returnDependencies?Yr.positions:null}})}}function x(de,X,Y){const te=new u.z(X);for(const he of de)he.recalculate(te,Y)}class T{constructor(X,Y,te){this.actor=X,this.layerIndex=Y,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(X,Y){return u._(this,void 0,void 0,function*(){const te=yield u.l(X.request,Y);try{return{vectorTile:new u.bt.VectorTile(new u.bu(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(he){const Se=new Uint8Array(te.data);let Oe=`Unable to parse the tile at ${X.request.url}, `;throw Oe+=Se[0]===31&&Se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.message}`,new Error(Oe)}})}loadTile(X){return u._(this,void 0,void 0,function*(){const Y=X.uid,te=!!(X&&X.request&&X.request.collectResourceTiming)&&new u.bv(X.request),he=new y(X);this.loading[Y]=he;const Se=new AbortController;he.abort=Se;try{const Oe=yield this.loadVectorTile(X,Se);if(delete this.loading[Y],!Oe)return null;const He=Oe.rawData,ye={};Oe.expires&&(ye.expires=Oe.expires),Oe.cacheControl&&(ye.cacheControl=Oe.cacheControl);const We={};if(te){const Je=te.finish();Je&&(We.resourceTiming=JSON.parse(JSON.stringify(Je)))}he.vectorTile=Oe.vectorTile;const ft=he.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Y]=he,this.fetching[Y]={rawTileData:He,cacheControl:ye,resourceTiming:We};try{const Je=yield ft;return u.e({rawTileData:He.slice(0)},Je,ye,We)}finally{delete this.fetching[Y]}}catch(Oe){throw delete this.loading[Y],he.status="done",this.loaded[Y]=he,Oe}})}reloadTile(X){return u._(this,void 0,void 0,function*(){const Y=X.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[Y];if(te.showCollisionBoxes=X.showCollisionBoxes,te.status==="parsing"){const he=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor);let Se;if(this.fetching[Y]){const{rawTileData:Oe,cacheControl:He,resourceTiming:ye}=this.fetching[Y];delete this.fetching[Y],Se=u.e({rawTileData:Oe.slice(0)},he,He,ye)}else Se=he;return Se}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(X){return u._(this,void 0,void 0,function*(){const Y=this.loading,te=X.uid;Y&&Y[te]&&Y[te].abort&&(Y[te].abort.abort(),delete Y[te])})}removeTile(X){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[X.uid]&&delete this.loaded[X.uid]})}}class E{constructor(){this.loaded={}}loadTile(X){return u._(this,void 0,void 0,function*(){const{uid:Y,encoding:te,rawImageData:he,redFactor:Se,greenFactor:Oe,blueFactor:He,baseShift:ye}=X,We=he.width+2,ft=he.height+2,Je=u.b(he)?new u.R({width:We,height:ft},yield u.bw(he,-1,-1,We,ft)):he,kt=new u.bx(Y,Je,te,Se,Oe,He,ye);return this.loaded=this.loaded||{},this.loaded[Y]=kt,kt})}removeTile(X){const Y=this.loaded,te=X.uid;Y&&Y[te]&&delete Y[te]}}function k(de,X){if(de.length!==0){F(de[0],X);for(var Y=1;Y<de.length;Y++)F(de[Y],!X)}}function F(de,X){for(var Y=0,te=0,he=0,Se=de.length,Oe=Se-1;he<Se;Oe=he++){var He=(de[he][0]-de[Oe][0])*(de[Oe][1]+de[he][1]),ye=Y+He;te+=Math.abs(Y)>=Math.abs(He)?Y-ye+He:He-ye+Y,Y=ye}Y+te>=0!=!!X&&de.reverse()}var D=u.by(function de(X,Y){var te,he=X&&X.type;if(he==="FeatureCollection")for(te=0;te<X.features.length;te++)de(X.features[te],Y);else if(he==="GeometryCollection")for(te=0;te<X.geometries.length;te++)de(X.geometries[te],Y);else if(he==="Feature")de(X.geometry,Y);else if(he==="Polygon")k(X.coordinates,Y);else if(he==="MultiPolygon")for(te=0;te<X.coordinates.length;te++)k(X.coordinates[te],Y);return X});const N=u.bt.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},V=u.bz,U=u.bt.VectorTileFeature,j=J;function J(de,X){this.options=X||{},this.features=de,this.length=de.length}function oe(de,X){this.id=typeof de.id=="number"?de.id:void 0,this.type=de.type,this.rawGeometry=de.type===1?[de.geometry]:de.geometry,this.properties=de.tags,this.extent=X||4096}J.prototype.feature=function(de){return new oe(this.features[de],this.options.extent)},oe.prototype.loadGeometry=function(){var de=this.rawGeometry;this.geometry=[];for(var X=0;X<de.length;X++){for(var Y=de[X],te=[],he=0;he<Y.length;he++)te.push(new V(Y[he][0],Y[he][1]));this.geometry.push(te)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var de=this.geometry,X=1/0,Y=-1/0,te=1/0,he=-1/0,Se=0;Se<de.length;Se++)for(var Oe=de[Se],He=0;He<Oe.length;He++){var ye=Oe[He];X=Math.min(X,ye.x),Y=Math.max(Y,ye.x),te=Math.min(te,ye.y),he=Math.max(he,ye.y)}return[X,te,Y,he]},oe.prototype.toGeoJSON=U.prototype.toGeoJSON;var le=u.bA,Ce=j;function Ie(de){var X=new le;return function(Y,te){for(var he in Y.layers)te.writeMessage(3,Ue,Y.layers[he])}(de,X),X.finish()}function Ue(de,X){var Y;X.writeVarintField(15,de.version||1),X.writeStringField(1,de.name||""),X.writeVarintField(5,de.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<de.length;Y++)te.feature=de.feature(Y),X.writeMessage(2,De,te);var he=te.keys;for(Y=0;Y<he.length;Y++)X.writeStringField(3,he[Y]);var Se=te.values;for(Y=0;Y<Se.length;Y++)X.writeMessage(4,At,Se[Y])}function De(de,X){var Y=de.feature;Y.id!==void 0&&X.writeVarintField(1,Y.id),X.writeMessage(2,pe,de),X.writeVarintField(3,Y.type),X.writeMessage(4,ot,Y)}function pe(de,X){var Y=de.feature,te=de.keys,he=de.values,Se=de.keycache,Oe=de.valuecache;for(var He in Y.properties){var ye=Y.properties[He],We=Se[He];if(ye!==null){We===void 0&&(te.push(He),Se[He]=We=te.length-1),X.writeVarint(We);var ft=typeof ye;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(ye=JSON.stringify(ye));var Je=ft+":"+ye,kt=Oe[Je];kt===void 0&&(he.push(ye),Oe[Je]=kt=he.length-1),X.writeVarint(kt)}}}function ze(de,X){return(X<<3)+(7&de)}function Ne(de){return de<<1^de>>31}function ot(de,X){for(var Y=de.loadGeometry(),te=de.type,he=0,Se=0,Oe=Y.length,He=0;He<Oe;He++){var ye=Y[He],We=1;te===1&&(We=ye.length),X.writeVarint(ze(1,We));for(var ft=te===3?ye.length-1:ye.length,Je=0;Je<ft;Je++){Je===1&&te!==1&&X.writeVarint(ze(2,ft-1));var kt=ye[Je].x-he,Vt=ye[Je].y-Se;X.writeVarint(Ne(kt)),X.writeVarint(Ne(Vt)),he+=kt,Se+=Vt}te===3&&X.writeVarint(ze(7,1))}}function At(de,X){var Y=typeof de;Y==="string"?X.writeStringField(1,de):Y==="boolean"?X.writeBooleanField(7,de):Y==="number"&&(de%1!=0?X.writeDoubleField(3,de):de<0?X.writeSVarintField(6,de):X.writeVarintField(5,de))}B.exports=Ie,B.exports.fromVectorTileJs=Ie,B.exports.fromGeojsonVt=function(de,X){X=X||{};var Y={};for(var te in de)Y[te]=new Ce(de[te].features,X),Y[te].name=te,Y[te].version=X.version,Y[te].extent=X.extent;return Ie({layers:Y})},B.exports.GeoJSONWrapper=Ce;var Qe=u.by(B.exports);const pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:de=>de},_t=Math.fround||(Lt=new Float32Array(1),de=>(Lt[0]=+de,Lt[0]));var Lt;const Ht=3,ar=5,Tt=6;class Sr{constructor(X){this.options=Object.assign(Object.create(pt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Y,minZoom:te,maxZoom:he}=this.options;Y&&console.time("total time");const Se=`prepare ${X.length} points`;Y&&console.time(Se),this.points=X;const Oe=[];for(let ye=0;ye<X.length;ye++){const We=X[ye];if(!We.geometry)continue;const[ft,Je]=We.geometry.coordinates,kt=_t(ir(ft)),Vt=_t(vr(Je));Oe.push(kt,Vt,1/0,ye,-1,1),this.options.reduce&&Oe.push(0)}let He=this.trees[he+1]=this._createTree(Oe);Y&&console.timeEnd(Se);for(let ye=he;ye>=te;ye--){const We=+Date.now();He=this.trees[ye]=this._createTree(this._cluster(He,ye)),Y&&console.log("z%d: %d clusters in %dms",ye,He.numItems,+Date.now()-We)}return Y&&console.timeEnd("total time"),this}getClusters(X,Y){let te=((X[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,X[1]));let Se=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)te=-180,Se=180;else if(te>Se){const Je=this.getClusters([te,he,180,Oe],Y),kt=this.getClusters([-180,he,Se,Oe],Y);return Je.concat(kt)}const He=this.trees[this._limitZoom(Y)],ye=He.range(ir(te),vr(Oe),ir(Se),vr(he)),We=He.data,ft=[];for(const Je of ye){const kt=this.stride*Je;ft.push(We[kt+ar]>1?Et(We,kt,this.clusterProps):this.points[We[kt+Ht]])}return ft}getChildren(X){const Y=this._getOriginId(X),te=this._getOriginZoom(X),he="No cluster with the specified id.",Se=this.trees[te];if(!Se)throw new Error(he);const Oe=Se.data;if(Y*this.stride>=Oe.length)throw new Error(he);const He=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ye=Se.within(Oe[Y*this.stride],Oe[Y*this.stride+1],He),We=[];for(const ft of ye){const Je=ft*this.stride;Oe[Je+4]===X&&We.push(Oe[Je+ar]>1?Et(Oe,Je,this.clusterProps):this.points[Oe[Je+Ht]])}if(We.length===0)throw new Error(he);return We}getLeaves(X,Y,te){const he=[];return this._appendLeaves(he,X,Y=Y||10,te=te||0,0),he}getTile(X,Y,te){const he=this.trees[this._limitZoom(X)],Se=Math.pow(2,X),{extent:Oe,radius:He}=this.options,ye=He/Oe,We=(te-ye)/Se,ft=(te+1+ye)/Se,Je={features:[]};return this._addTileFeatures(he.range((Y-ye)/Se,We,(Y+1+ye)/Se,ft),he.data,Y,te,Se,Je),Y===0&&this._addTileFeatures(he.range(1-ye/Se,We,1,ft),he.data,Se,te,Se,Je),Y===Se-1&&this._addTileFeatures(he.range(0,We,ye/Se,ft),he.data,-1,te,Se,Je),Je.features.length?Je:null}getClusterExpansionZoom(X){let Y=this._getOriginZoom(X)-1;for(;Y<=this.options.maxZoom;){const te=this.getChildren(X);if(Y++,te.length!==1)break;X=te[0].properties.cluster_id}return Y}_appendLeaves(X,Y,te,he,Se){const Oe=this.getChildren(Y);for(const He of Oe){const ye=He.properties;if(ye&&ye.cluster?Se+ye.point_count<=he?Se+=ye.point_count:Se=this._appendLeaves(X,ye.cluster_id,te,he,Se):Se<he?Se++:X.push(He),X.length===te)break}return Se}_createTree(X){const Y=new u.av(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<X.length;te+=this.stride)Y.add(X[te],X[te+1]);return Y.finish(),Y.data=X,Y}_addTileFeatures(X,Y,te,he,Se,Oe){for(const He of X){const ye=He*this.stride,We=Y[ye+ar]>1;let ft,Je,kt;if(We)ft=Or(Y,ye,this.clusterProps),Je=Y[ye],kt=Y[ye+1];else{const Wr=this.points[Y[ye+Ht]];ft=Wr.properties;const[Er,wr]=Wr.geometry.coordinates;Je=ir(Er),kt=vr(wr)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(Je*Se-te)),Math.round(this.options.extent*(kt*Se-he))]],tags:ft};let Kt;Kt=We||this.options.generateId?Y[ye+Ht]:this.points[Y[ye+Ht]].id,Kt!==void 0&&(Vt.id=Kt),Oe.features.push(Vt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Y){const{radius:te,extent:he,reduce:Se,minPoints:Oe}=this.options,He=te/(he*Math.pow(2,Y)),ye=X.data,We=[],ft=this.stride;for(let Je=0;Je<ye.length;Je+=ft){if(ye[Je+2]<=Y)continue;ye[Je+2]=Y;const kt=ye[Je],Vt=ye[Je+1],Kt=X.within(ye[Je],ye[Je+1],He),Wr=ye[Je+ar];let Er=Wr;for(const wr of Kt){const gr=wr*ft;ye[gr+2]>Y&&(Er+=ye[gr+ar])}if(Er>Wr&&Er>=Oe){let wr,gr=kt*Wr,Yr=Vt*Wr,Pr=-1;const Wt=((Je/ft|0)<<5)+(Y+1)+this.points.length;for(const Rr of Kt){const Dr=Rr*ft;if(ye[Dr+2]<=Y)continue;ye[Dr+2]=Y;const It=ye[Dr+ar];gr+=ye[Dr]*It,Yr+=ye[Dr+1]*It,ye[Dr+4]=Wt,Se&&(wr||(wr=this._map(ye,Je,!0),Pr=this.clusterProps.length,this.clusterProps.push(wr)),Se(wr,this._map(ye,Dr)))}ye[Je+4]=Wt,We.push(gr/Er,Yr/Er,1/0,Wt,-1,Er),Se&&We.push(Pr)}else{for(let wr=0;wr<ft;wr++)We.push(ye[Je+wr]);if(Er>1)for(const wr of Kt){const gr=wr*ft;if(!(ye[gr+2]<=Y)){ye[gr+2]=Y;for(let Yr=0;Yr<ft;Yr++)We.push(ye[gr+Yr])}}}}return We}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Y,te){if(X[Y+ar]>1){const Oe=this.clusterProps[X[Y+Tt]];return te?Object.assign({},Oe):Oe}const he=this.points[X[Y+Ht]].properties,Se=this.options.map(he);return te&&Se===he?Object.assign({},Se):Se}}function Et(de,X,Y){return{type:"Feature",id:de[X+Ht],properties:Or(de,X,Y),geometry:{type:"Point",coordinates:[(te=de[X],360*(te-.5)),ur(de[X+1])]}};var te}function Or(de,X,Y){const te=de[X+ar],he=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Se=de[X+Tt],Oe=Se===-1?{}:Object.assign({},Y[Se]);return Object.assign(Oe,{cluster:!0,cluster_id:de[X+Ht],point_count:te,point_count_abbreviated:he})}function ir(de){return de/360+.5}function vr(de){const X=Math.sin(de*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function ur(de){const X=(180-360*de)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function kr(de,X,Y,te){let he=te;const Se=X+(Y-X>>1);let Oe,He=Y-X;const ye=de[X],We=de[X+1],ft=de[Y],Je=de[Y+1];for(let kt=X+3;kt<Y;kt+=3){const Vt=nn(de[kt],de[kt+1],ye,We,ft,Je);if(Vt>he)Oe=kt,he=Vt;else if(Vt===he){const Kt=Math.abs(kt-Se);Kt<He&&(Oe=kt,He=Kt)}}he>te&&(Oe-X>3&&kr(de,X,Oe,te),de[Oe+2]=he,Y-Oe>3&&kr(de,Oe,Y,te))}function nn(de,X,Y,te,he,Se){let Oe=he-Y,He=Se-te;if(Oe!==0||He!==0){const ye=((de-Y)*Oe+(X-te)*He)/(Oe*Oe+He*He);ye>1?(Y=he,te=Se):ye>0&&(Y+=Oe*ye,te+=He*ye)}return Oe=de-Y,He=X-te,Oe*Oe+He*He}function pr(de,X,Y,te){const he={id:de??null,type:X,geometry:Y,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")Hr(he,Y);else if(X==="Polygon")Hr(he,Y[0]);else if(X==="MultiLineString")for(const Se of Y)Hr(he,Se);else if(X==="MultiPolygon")for(const Se of Y)Hr(he,Se[0]);return he}function Hr(de,X){for(let Y=0;Y<X.length;Y+=3)de.minX=Math.min(de.minX,X[Y]),de.minY=Math.min(de.minY,X[Y+1]),de.maxX=Math.max(de.maxX,X[Y]),de.maxY=Math.max(de.maxY,X[Y+1])}function Nr(de,X,Y,te){if(!X.geometry)return;const he=X.geometry.coordinates;if(he&&he.length===0)return;const Se=X.geometry.type,Oe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let He=[],ye=X.id;if(Y.promoteId?ye=X.properties[Y.promoteId]:Y.generateId&&(ye=te||0),Se==="Point")mt(he,He);else if(Se==="MultiPoint")for(const We of he)mt(We,He);else if(Se==="LineString")Te(he,He,Oe,!1);else if(Se==="MultiLineString"){if(Y.lineMetrics){for(const We of he)He=[],Te(We,He,Oe,!1),de.push(pr(ye,"LineString",He,X.properties));return}Qt(he,He,Oe,!1)}else if(Se==="Polygon")Qt(he,He,Oe,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(const We of X.geometry.geometries)Nr(de,{id:ye,geometry:We,properties:X.properties},Y,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of he){const ft=[];Qt(We,ft,Oe,!0),He.push(ft)}}de.push(pr(ye,Se,He,X.properties))}function mt(de,X){X.push(Ct(de[0]),yt(de[1]),0)}function Te(de,X,Y,te){let he,Se,Oe=0;for(let ye=0;ye<de.length;ye++){const We=Ct(de[ye][0]),ft=yt(de[ye][1]);X.push(We,ft,0),ye>0&&(Oe+=te?(he*ft-We*Se)/2:Math.sqrt(Math.pow(We-he,2)+Math.pow(ft-Se,2))),he=We,Se=ft}const He=X.length-3;X[2]=1,kr(X,0,He,Y),X[He+2]=1,X.size=Math.abs(Oe),X.start=0,X.end=X.size}function Qt(de,X,Y,te){for(let he=0;he<de.length;he++){const Se=[];Te(de[he],Se,Y,te),X.push(Se)}}function Ct(de){return de/360+.5}function yt(de){const X=Math.sin(de*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function sr(de,X,Y,te,he,Se,Oe,He){if(te/=X,Se>=(Y/=X)&&Oe<te)return de;if(Oe<Y||Se>=te)return null;const ye=[];for(const We of de){const ft=We.geometry;let Je=We.type;const kt=he===0?We.minX:We.minY,Vt=he===0?We.maxX:We.maxY;if(kt>=Y&&Vt<te){ye.push(We);continue}if(Vt<Y||kt>=te)continue;let Kt=[];if(Je==="Point"||Je==="MultiPoint")Br(ft,Kt,Y,te,he);else if(Je==="LineString")$r(ft,Kt,Y,te,he,!1,He.lineMetrics);else if(Je==="MultiLineString")Zt(ft,Kt,Y,te,he,!1);else if(Je==="Polygon")Zt(ft,Kt,Y,te,he,!0);else if(Je==="MultiPolygon")for(const Wr of ft){const Er=[];Zt(Wr,Er,Y,te,he,!0),Er.length&&Kt.push(Er)}if(Kt.length){if(He.lineMetrics&&Je==="LineString"){for(const Wr of Kt)ye.push(pr(We.id,Je,Wr,We.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(Kt.length===1?(Je="LineString",Kt=Kt[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=Kt.length===3?"Point":"MultiPoint"),ye.push(pr(We.id,Je,Kt,We.tags))}}return ye.length?ye:null}function Br(de,X,Y,te,he){for(let Se=0;Se<de.length;Se+=3){const Oe=de[Se+he];Oe>=Y&&Oe<=te&&Ar(X,de[Se],de[Se+1],de[Se+2])}}function $r(de,X,Y,te,he,Se,Oe){let He=Jt(de);const ye=he===0?Fr:Jr;let We,ft,Je=de.start;for(let Er=0;Er<de.length-3;Er+=3){const wr=de[Er],gr=de[Er+1],Yr=de[Er+2],Pr=de[Er+3],Wt=de[Er+4],Rr=he===0?wr:gr,Dr=he===0?Pr:Wt;let It=!1;Oe&&(We=Math.sqrt(Math.pow(wr-Pr,2)+Math.pow(gr-Wt,2))),Rr<Y?Dr>Y&&(ft=ye(He,wr,gr,Pr,Wt,Y),Oe&&(He.start=Je+We*ft)):Rr>te?Dr<te&&(ft=ye(He,wr,gr,Pr,Wt,te),Oe&&(He.start=Je+We*ft)):Ar(He,wr,gr,Yr),Dr<Y&&Rr>=Y&&(ft=ye(He,wr,gr,Pr,Wt,Y),It=!0),Dr>te&&Rr<=te&&(ft=ye(He,wr,gr,Pr,Wt,te),It=!0),!Se&&It&&(Oe&&(He.end=Je+We*ft),X.push(He),He=Jt(de)),Oe&&(Je+=We)}let kt=de.length-3;const Vt=de[kt],Kt=de[kt+1],Wr=he===0?Vt:Kt;Wr>=Y&&Wr<=te&&Ar(He,Vt,Kt,de[kt+2]),kt=He.length-3,Se&&kt>=3&&(He[kt]!==He[0]||He[kt+1]!==He[1])&&Ar(He,He[0],He[1],He[2]),He.length&&X.push(He)}function Jt(de){const X=[];return X.size=de.size,X.start=de.start,X.end=de.end,X}function Zt(de,X,Y,te,he,Se){for(const Oe of de)$r(Oe,X,Y,te,he,Se,!1)}function Ar(de,X,Y,te){de.push(X,Y,te)}function Fr(de,X,Y,te,he,Se){const Oe=(Se-X)/(te-X);return Ar(de,Se,Y+(he-Y)*Oe,1),Oe}function Jr(de,X,Y,te,he,Se){const Oe=(Se-Y)/(he-Y);return Ar(de,X+(te-X)*Oe,Se,1),Oe}function bt(de,X){const Y=[];for(let te=0;te<de.length;te++){const he=de[te],Se=he.type;let Oe;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Oe=zr(he.geometry,X);else if(Se==="MultiLineString"||Se==="Polygon"){Oe=[];for(const He of he.geometry)Oe.push(zr(He,X))}else if(Se==="MultiPolygon"){Oe=[];for(const He of he.geometry){const ye=[];for(const We of He)ye.push(zr(We,X));Oe.push(ye)}}Y.push(pr(he.id,Se,Oe,he.tags))}return Y}function zr(de,X){const Y=[];Y.size=de.size,de.start!==void 0&&(Y.start=de.start,Y.end=de.end);for(let te=0;te<de.length;te+=3)Y.push(de[te]+X,de[te+1],de[te+2]);return Y}function Mr(de,X){if(de.transformed)return de;const Y=1<<de.z,te=de.x,he=de.y;for(const Se of de.features){const Oe=Se.geometry,He=Se.type;if(Se.geometry=[],He===1)for(let ye=0;ye<Oe.length;ye+=2)Se.geometry.push(Zr(Oe[ye],Oe[ye+1],X,Y,te,he));else for(let ye=0;ye<Oe.length;ye++){const We=[];for(let ft=0;ft<Oe[ye].length;ft+=2)We.push(Zr(Oe[ye][ft],Oe[ye][ft+1],X,Y,te,he));Se.geometry.push(We)}}return de.transformed=!0,de}function Zr(de,X,Y,te,he,Se){return[Math.round(Y*(de*te-he)),Math.round(Y*(X*te-Se))]}function xn(de,X,Y,te,he){const Se=X===he.maxZoom?0:he.tolerance/((1<<X)*he.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:de.length,source:null,x:Y,y:te,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const He of de)Ot(Oe,He,Se,he);return Oe}function Ot(de,X,Y,te){const he=X.geometry,Se=X.type,Oe=[];if(de.minX=Math.min(de.minX,X.minX),de.minY=Math.min(de.minY,X.minY),de.maxX=Math.max(de.maxX,X.maxX),de.maxY=Math.max(de.maxY,X.maxY),Se==="Point"||Se==="MultiPoint")for(let He=0;He<he.length;He+=3)Oe.push(he[He],he[He+1]),de.numPoints++,de.numSimplified++;else if(Se==="LineString")qe(Oe,he,de,Y,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(let He=0;He<he.length;He++)qe(Oe,he[He],de,Y,Se==="Polygon",He===0);else if(Se==="MultiPolygon")for(let He=0;He<he.length;He++){const ye=he[He];for(let We=0;We<ye.length;We++)qe(Oe,ye[We],de,Y,!0,We===0)}if(Oe.length){let He=X.tags||null;if(Se==="LineString"&&te.lineMetrics){He={};for(const We in X.tags)He[We]=X.tags[We];He.mapbox_clip_start=he.start/he.size,He.mapbox_clip_end=he.end/he.size}const ye={geometry:Oe,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:He};X.id!==null&&(ye.id=X.id),de.features.push(ye)}}function qe(de,X,Y,te,he,Se){const Oe=te*te;if(te>0&&X.size<(he?Oe:te))return void(Y.numPoints+=X.length/3);const He=[];for(let ye=0;ye<X.length;ye+=3)(te===0||X[ye+2]>Oe)&&(Y.numSimplified++,He.push(X[ye],X[ye+1])),Y.numPoints++;he&&function(ye,We){let ft=0;for(let Je=0,kt=ye.length,Vt=kt-2;Je<kt;Vt=Je,Je+=2)ft+=(ye[Je]-ye[Vt])*(ye[Je+1]+ye[Vt+1]);if(ft>0===We)for(let Je=0,kt=ye.length;Je<kt/2;Je+=2){const Vt=ye[Je],Kt=ye[Je+1];ye[Je]=ye[kt-2-Je],ye[Je+1]=ye[kt-1-Je],ye[kt-2-Je]=Vt,ye[kt-1-Je]=Kt}}(He,Se),de.push(He)}const $e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class dt{constructor(X,Y){const te=(Y=this.options=function(Se,Oe){for(const He in Oe)Se[He]=Oe[He];return Se}(Object.create($e),Y)).debug;if(te&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(Se,Oe){const He=[];if(Se.type==="FeatureCollection")for(let ye=0;ye<Se.features.length;ye++)Nr(He,Se.features[ye],Oe,ye);else Nr(He,Se.type==="Feature"?Se:{geometry:Se},Oe);return He}(X,Y);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(Se,Oe){const He=Oe.buffer/Oe.extent;let ye=Se;const We=sr(Se,1,-1-He,He,0,-1,2,Oe),ft=sr(Se,1,1-He,2+He,0,-1,2,Oe);return(We||ft)&&(ye=sr(Se,1,-He,1+He,0,-1,2,Oe)||[],We&&(ye=bt(We,1).concat(ye)),ft&&(ye=ye.concat(bt(ft,-1)))),ye}(he,Y),he.length&&this.splitTile(he,0,0,0),te&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,Y,te,he,Se,Oe,He){const ye=[X,Y,te,he],We=this.options,ft=We.debug;for(;ye.length;){he=ye.pop(),te=ye.pop(),Y=ye.pop(),X=ye.pop();const Je=1<<Y,kt=xt(Y,te,he);let Vt=this.tiles[kt];if(!Vt&&(ft>1&&console.time("creation"),Vt=this.tiles[kt]=xn(X,Y,te,he,We),this.tileCoords.push({z:Y,x:te,y:he}),ft)){ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,te,he,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));const It=`z${Y}`;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(Vt.source=X,Se==null){if(Y===We.indexMaxZoom||Vt.numPoints<=We.indexMaxPoints)continue}else{if(Y===We.maxZoom||Y===Se)continue;if(Se!=null){const It=Se-Y;if(te!==Oe>>It||he!==He>>It)continue}}if(Vt.source=null,X.length===0)continue;ft>1&&console.time("clipping");const Kt=.5*We.buffer/We.extent,Wr=.5-Kt,Er=.5+Kt,wr=1+Kt;let gr=null,Yr=null,Pr=null,Wt=null,Rr=sr(X,Je,te-Kt,te+Er,0,Vt.minX,Vt.maxX,We),Dr=sr(X,Je,te+Wr,te+wr,0,Vt.minX,Vt.maxX,We);X=null,Rr&&(gr=sr(Rr,Je,he-Kt,he+Er,1,Vt.minY,Vt.maxY,We),Yr=sr(Rr,Je,he+Wr,he+wr,1,Vt.minY,Vt.maxY,We),Rr=null),Dr&&(Pr=sr(Dr,Je,he-Kt,he+Er,1,Vt.minY,Vt.maxY,We),Wt=sr(Dr,Je,he+Wr,he+wr,1,Vt.minY,Vt.maxY,We),Dr=null),ft>1&&console.timeEnd("clipping"),ye.push(gr||[],Y+1,2*te,2*he),ye.push(Yr||[],Y+1,2*te,2*he+1),ye.push(Pr||[],Y+1,2*te+1,2*he),ye.push(Wt||[],Y+1,2*te+1,2*he+1)}}getTile(X,Y,te){X=+X,Y=+Y,te=+te;const he=this.options,{extent:Se,debug:Oe}=he;if(X<0||X>24)return null;const He=1<<X,ye=xt(X,Y=Y+He&He-1,te);if(this.tiles[ye])return Mr(this.tiles[ye],Se);Oe>1&&console.log("drilling down to z%d-%d-%d",X,Y,te);let We,ft=X,Je=Y,kt=te;for(;!We&&ft>0;)ft--,Je>>=1,kt>>=1,We=this.tiles[xt(ft,Je,kt)];return We&&We.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",ft,Je,kt),console.time("drilling down")),this.splitTile(We.source,ft,Je,kt,X,Y,te),Oe>1&&console.timeEnd("drilling down"),this.tiles[ye]?Mr(this.tiles[ye],Se):null):null}}function xt(de,X,Y){return 32*((1<<de)*Y+X)+de}function at(de,X){return X?de.properties[X]:de.id}function Dt(de,X){if(de==null)return!0;if(de.type==="Feature")return at(de,X)!=null;if(de.type==="FeatureCollection"){const Y=new Set;for(const te of de.features){const he=at(te,X);if(he==null||Y.has(he))return!1;Y.add(he)}return!0}return!1}function br(de,X){const Y=new Map;if(de!=null)if(de.type==="Feature")Y.set(at(de,X),de);else for(const te of de.features)Y.set(at(te,X),te);return Y}class tn extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(X,Y){return u._(this,void 0,void 0,function*(){const te=X.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return null;const Se=new class{constructor(He){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=He.length,this._features=He}feature(He){return new class{constructor(ye){this._feature=ye,this.extent=u.X,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const We of this._feature.geometry)ye.push([new u.P(We[0],We[1])]);return ye}{const ye=[];for(const We of this._feature.geometry){const ft=[];for(const Je of We)ft.push(new u.P(Je[0],Je[1]));ye.push(ft)}return ye}}toGeoJSON(ye,We,ft){return N.call(this,ye,We,ft)}}(this._features[He])}}(he.features);let Oe=Qe(Se);return Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),{vectorTile:Se,rawData:Oe.buffer}})}loadData(X){return u._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const te=!!(X&&X.request&&X.request.collectResourceTiming)&&new u.bv(X.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(X,this._pendingRequest),this._geoJSONIndex=X.cluster?new Sr(function({superclusterOptions:Oe,clusterProperties:He}){if(!He||!Oe)return Oe;const ye={},We={},ft={accumulated:null,zoom:0},Je={properties:null},kt=Object.keys(He);for(const Vt of kt){const[Kt,Wr]=He[Vt],Er=u.bC(Wr),wr=u.bC(typeof Kt=="string"?[Kt,["accumulated"],["get",Vt]]:Kt);ye[Vt]=Er.value,We[Vt]=wr.value}return Oe.map=Vt=>{Je.properties=Vt;const Kt={};for(const Wr of kt)Kt[Wr]=ye[Wr].evaluate(ft,Je);return Kt},Oe.reduce=(Vt,Kt)=>{Je.properties=Kt;for(const Wr of kt)ft.accumulated=Vt[Wr],Vt[Wr]=We[Wr].evaluate(ft,Je)},Oe}(X)).load((yield this._pendingData).features):(he=yield this._pendingData,new dt(he,X.geojsonVtOptions)),this.loaded={};const Se={};if(te){const Oe=te.finish();Oe&&(Se.resourceTiming={},Se.resourceTiming[X.source]=JSON.parse(JSON.stringify(Oe)))}return Se}catch(Se){if(delete this._pendingRequest,u.bB(Se))return{abandoned:!0};throw Se}var he})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(X){const Y=this.loaded;return Y&&Y[X.uid]?super.reloadTile(X):this.loadTile(X)}loadAndProcessGeoJSON(X,Y){return u._(this,void 0,void 0,function*(){let te=yield this.loadGeoJSON(X,Y);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(D(te,!0),X.filter){const he=u.bC(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(Oe=>`${Oe.key}: ${Oe.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(Oe=>he.value.evaluate({zoom:0},Oe))}}return te})}loadGeoJSON(X,Y){return u._(this,void 0,void 0,function*(){const{promoteId:te}=X;if(X.request){const he=yield u.h(X.request,Y);return this._dataUpdateable=Dt(he.data,te)?br(he.data,te):void 0,he.data}if(typeof X.data=="string")try{const he=JSON.parse(X.data);return this._dataUpdateable=Dt(he,te)?br(he,te):void 0,he}catch{throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`)}if(!X.dataDiff)throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X.source}`);return function(he,Se,Oe){var He,ye,We,ft;if(Se.removeAll&&he.clear(),Se.remove)for(const Je of Se.remove)he.delete(Je);if(Se.add)for(const Je of Se.add){const kt=at(Je,Oe);kt!=null&&he.set(kt,Je)}if(Se.update)for(const Je of Se.update){let kt=he.get(Je.id);if(kt==null)continue;const Vt=!Je.removeAllProperties&&(((He=Je.removeProperties)===null||He===void 0?void 0:He.length)>0||((ye=Je.addOrUpdateProperties)===null||ye===void 0?void 0:ye.length)>0);if((Je.newGeometry||Je.removeAllProperties||Vt)&&(kt=Object.assign({},kt),he.set(Je.id,kt),Vt&&(kt.properties=Object.assign({},kt.properties))),Je.newGeometry&&(kt.geometry=Je.newGeometry),Je.removeAllProperties)kt.properties={};else if(((We=Je.removeProperties)===null||We===void 0?void 0:We.length)>0)for(const Kt of Je.removeProperties)Object.prototype.hasOwnProperty.call(kt.properties,Kt)&&delete kt.properties[Kt];if(((ft=Je.addOrUpdateProperties)===null||ft===void 0?void 0:ft.length)>0)for(const{key:Kt,value:Wr}of Je.addOrUpdateProperties)kt.properties[Kt]=Wr}}(this._dataUpdateable,X.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(X){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(X){return this._geoJSONIndex.getClusterExpansionZoom(X.clusterId)}getClusterChildren(X){return this._geoJSONIndex.getChildren(X.clusterId)}getClusterLeaves(X){return this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset)}}class pn{constructor(X){this.self=X,this.actor=new u.F(X),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,te)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=te},this.self.addProtocol=u.bi,this.self.removeProtocol=u.bj,this.self.registerRTLTextPlugin=Y=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,te)=>this._getDEMWorkerSource(Y,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(Y,te)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(Y,te)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(Y,te)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(Y,te)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(Y,te)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][te.type]||!this.workerSources[Y][te.type][te.source])return;const he=this.workerSources[Y][te.type][te.source];delete this.workerSources[Y][te.type][te.source],he.removeSource!==void 0&&he.removeSource(te)})),this.actor.registerMessageHandler("RM",Y=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,te)=>u._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(Y,te)=>this._syncRTLPluginState(Y,te)),this.actor.registerMessageHandler("IS",(Y,te)=>u._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(Y,te)=>this._setImages(Y,te)),this.actor.registerMessageHandler("UL",(Y,te)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(Y,te)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(te)}))}_setImages(X,Y){return u._(this,void 0,void 0,function*(){this.availableImages[X]=Y;for(const te in this.workerSources[X]){const he=this.workerSources[X][te];for(const Se in he)he[Se].availableImages=Y}})}_syncRTLPluginState(X,Y){return u._(this,void 0,void 0,function*(){if(u.bD.isParsed())return u.bD.getState();if(Y.pluginStatus!=="loading")return u.bD.setState(Y),Y;const te=Y.pluginURL;if(this.self.importScripts(te),u.bD.isParsed()){const he={pluginStatus:"loaded",pluginURL:te};return u.bD.setState(he),he}throw u.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${te}`)})}_getAvailableImages(X){let Y=this.availableImages[X];return Y||(Y=[]),Y}_getLayerIndex(X){let Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new a),Y}_getWorkerSource(X,Y,te){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),!this.workerSources[X][Y][te]){const he={sendAsync:(Se,Oe)=>(Se.targetMapId=X,this.actor.sendAsync(Se,Oe))};switch(Y){case"vector":this.workerSources[X][Y][te]=new T(he,this._getLayerIndex(X),this._getAvailableImages(X));break;case"geojson":this.workerSources[X][Y][te]=new tn(he,this._getLayerIndex(X),this._getAvailableImages(X));break;default:this.workerSources[X][Y][te]=new this.externalWorkerSourceTypes[Y](he,this._getLayerIndex(X),this._getAvailableImages(X))}}return this.workerSources[X][Y][te]}_getDEMWorkerSource(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new E),this.demWorkerSources[X][Y]}}return u.i(self)&&(self.worker=new pn(self)),pn}),i("index",["exports","./shared"],function(u,a){var p="4.7.1";let y,x;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:b=>new Promise((s,d)=>{const g=requestAnimationFrame(s);b.signal.addEventListener("abort",()=>{cancelAnimationFrame(g),d(a.c())})}),getImageData(b,s=0){return this.getImageCanvasContext(b).getImageData(-s,-s,b.width+2*s,b.height+2*s)},getImageCanvasContext(b){const s=window.document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return s.width=b.width,s.height=b.height,d.drawImage(b,0,0,b.width,b.height),d},resolveURL:b=>(y||(y=document.createElement("a")),y.href=b,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class E{static testProp(s){if(!E.docStyle)return s[0];for(let d=0;d<s.length;d++)if(s[d]in E.docStyle)return s[d];return s[0]}static create(s,d,g){const m=window.document.createElement(s);return d!==void 0&&(m.className=d),g&&g.appendChild(m),m}static createNS(s,d){return window.document.createElementNS(s,d)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(s,d){s.style[E.transformProp]=d}static addEventListener(s,d,g,m={}){s.addEventListener(d,g,"passive"in m?m:m.capture)}static removeEventListener(s,d,g,m={}){s.removeEventListener(d,g,"passive"in m?m:m.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static getScale(s){const d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}static getPoint(s,d,g){const m=d.boundingClientRect;return new a.P((g.clientX-m.left)/d.x-s.clientLeft,(g.clientY-m.top)/d.y-s.clientTop)}static mousePos(s,d){const g=E.getScale(s);return E.getPoint(s,g,d)}static touchPos(s,d){const g=[],m=E.getScale(s);for(let v=0;v<d.length;v++)g.push(E.getPoint(s,m,d[v]));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const k={supported:!1,testSupport:function(b){!N&&D&&(B?V(b):F=b)}};let F,D,N=!1,B=!1;function V(b){const s=b.createTexture();b.bindTexture(b.TEXTURE_2D,s);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,D),b.isContextLost())return;k.supported=!0}catch{}b.deleteTexture(s),N=!0}var U;typeof document<"u"&&(D=document.createElement("img"),D.onload=()=>{F&&V(F),F=null,B=!0},D.onerror=()=>{N=!0,F=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let s,d,g,m;b.resetRequestQueue=()=>{s=[],d=0,g=0,m={}},b.addThrottleControl=M=>{const z=g++;return m[z]=M,z},b.removeThrottleControl=M=>{delete m[M],C()},b.getImage=(M,z,W=!0)=>new Promise(($,Q)=>{k.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),a.e(M,{type:"image"}),s.push({abortController:z,requestParameters:M,supportImageRefresh:W,state:"queued",onError:ie=>{Q(ie)},onSuccess:ie=>{$(ie)}}),C()});const v=M=>a._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:z,supportImageRefresh:W,onError:$,onSuccess:Q,abortController:ie}=M,ce=W===!1&&!a.i(self)&&!a.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((Pe,Fe)=>Pe&&Fe==="accept",!0));d++;const be=ce?R(z,ie):a.m(z,ie);try{const Pe=yield be;delete M.abortController,M.state="completed",Pe.data instanceof HTMLImageElement||a.b(Pe.data)?Q(Pe):Pe.data&&Q({data:yield(Ee=Pe.data,typeof createImageBitmap=="function"?a.d(Ee):a.f(Ee)),cacheControl:Pe.cacheControl,expires:Pe.expires})}catch(Pe){delete M.abortController,$(Pe)}finally{d--,C()}var Ee}),C=()=>{const M=(()=>{for(const z of Object.keys(m))if(m[z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=d;z<M&&s.length>0;z++){const W=s.shift();W.abortController.signal.aborted?z--:v(W)}},R=(M,z)=>new Promise((W,$)=>{const Q=new Image,ie=M.url,ce=M.credentials;ce&&ce==="include"?Q.crossOrigin="use-credentials":(ce&&ce==="same-origin"||!a.s(ie))&&(Q.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{Q.src="",$(a.c())}),Q.fetchPriority="high",Q.onload=()=>{Q.onerror=Q.onload=null,W({data:Q})},Q.onerror=()=>{Q.onerror=Q.onload=null,z.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Q.src=ie})}(U||(U={})),U.resetRequestQueue();class j{constructor(s){this._transformRequestFn=s}transformRequest(s,d){return this._transformRequestFn&&this._transformRequestFn(s,d)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function J(b){var s=new a.A(3);return s[0]=b[0],s[1]=b[1],s[2]=b[2],s}var oe,le=function(b,s,d){return b[0]=s[0]-d[0],b[1]=s[1]-d[1],b[2]=s[2]-d[2],b};oe=new a.A(3),a.A!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0);var Ce=function(b){var s=b[0],d=b[1];return s*s+d*d};function Ie(b){const s=[];if(typeof b=="string")s.push({id:"default",url:b});else if(b&&b.length>0){const d=[];for(const{id:g,url:m}of b){const v=`${g}${m}`;d.indexOf(v)===-1&&(d.push(v),s.push({id:g,url:m}))}}return s}function Ue(b,s,d){const g=b.split("?");return g[0]+=`${s}${d}`,g.join("?")}(function(){var b=new a.A(2);a.A!=Float32Array&&(b[0]=0,b[1]=0)})();class De{constructor(s,d,g,m){this.context=s,this.format=g,this.texture=s.gl.createTexture(),this.update(d,m)}update(s,d,g){const{width:m,height:v}=s,C=!(this.size&&this.size[0]===m&&this.size[1]===v||g),{context:R}=this,{gl:M}=R;if(this.useMipmap=!!(d&&d.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!d||d.premultiply!==!1)),C)this.size=[m,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.b(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,m,v,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:z,y:W}=g||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.b(s)?M.texSubImage2D(M.TEXTURE_2D,0,z,W,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,z,W,m,v,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(s,d,g){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),g!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,g||s),this.filter=s),d!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,d),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function pe(b){const{userImage:s}=b;return!!(s&&s.render&&s.render())&&(b.data.replace(new Uint8Array(s.data.buffer)),!0)}class ze extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,promiseResolve:g}of this.requestors)g(this._getImagesForIds(d));this.requestors=[]}}getImage(s){const d=this.images[s];if(d&&!d.data&&d.spriteData){const g=d.spriteData;d.data=new a.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),d.spriteData=null}return d}addImage(s,d){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let g=!0;const m=d.data||d.spriteData;return this._validateStretch(d.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(d.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(d.content,d)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,d){if(!s)return!0;let g=0;for(const m of s){if(m[0]<g||m[1]<m[0]||d<m[1])return!1;g=m[1]}return!0}_validateContent(s,d){if(!s)return!0;if(s.length!==4)return!1;const g=d.spriteData,m=g&&g.width||d.data.width,v=g&&g.height||d.data.height;return!(s[0]<0||m<s[0]||s[1]<0||v<s[1]||s[2]<0||m<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,d,g=!0){const m=this.getImage(s);if(g&&(m.data.width!==d.data.width||m.data.height!==d.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=m.version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((d,g)=>{let m=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(m=!1);this.isLoaded()||m?d(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:d})})}_getImagesForIds(s){const d={};for(const g of s){let m=this.getImage(g);m||(this.fire(new a.k("styleimagemissing",{id:g})),m=this.getImage(g)),m?d[g]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],g=this.getImage(s);if(!g)return null;if(d&&d.position.version===g.version)return d.position;if(d)d.position.version=g.version;else{const m={w:g.data.width+2,h:g.data.height+2,x:0,y:0},v=new a.I(m,g);this.patterns[s]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new De(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:d,h:g}=a.p(s),m=this.atlasImage;m.resize({width:d||1,height:g||1});for(const v in this.patterns){const{bin:C}=this.patterns[v],R=C.x+1,M=C.y+1,z=this.getImage(v).data,W=z.width,$=z.height;a.R.copy(z,m,{x:0,y:0},{x:R,y:M},{width:W,height:$}),a.R.copy(z,m,{x:0,y:$-1},{x:R,y:M-1},{width:W,height:1}),a.R.copy(z,m,{x:0,y:0},{x:R,y:M+$},{width:W,height:1}),a.R.copy(z,m,{x:W-1,y:0},{x:R-1,y:M},{width:1,height:$}),a.R.copy(z,m,{x:0,y:0},{x:R+W,y:M},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const g=this.getImage(d);g||a.w(`Image with ID: "${d}" was not found`),pe(g)&&this.updateImage(d,g)}}}const Ne=1e20;function ot(b,s,d,g,m,v,C,R,M){for(let z=s;z<s+g;z++)At(b,d*v+z,v,m,C,R,M);for(let z=d;z<d+m;z++)At(b,z*v+s,1,g,C,R,M)}function At(b,s,d,g,m,v,C){v[0]=0,C[0]=-1e20,C[1]=Ne,m[0]=b[s];for(let R=1,M=0,z=0;R<g;R++){m[R]=b[s+R*d];const W=R*R;do{const $=v[M];z=(m[R]-m[$]+W-$*$)/(R-$)/2}while(z<=C[M]&&--M>-1);M++,v[M]=R,C[M]=z,C[M+1]=Ne}for(let R=0,M=0;R<g;R++){for(;C[M+1]<R;)M++;const z=v[M],W=R-z;b[s+R*d]=m[z]+W*W}}class Qe{constructor(s,d){this.requestManager=s,this.localIdeographFontFamily=d,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return a._(this,void 0,void 0,function*(){const d=[];for(const v in s)for(const C of s[v])d.push(this._getAndCacheGlyphsPromise(v,C));const g=yield Promise.all(d),m={};for(const{stack:v,id:C,glyph:R}of g)m[v]||(m[v]={}),m[v][C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return m})}_getAndCacheGlyphsPromise(s,d){return a._(this,void 0,void 0,function*(){let g=this.entries[s];g||(g=this.entries[s]={glyphs:{},requests:{},ranges:{}});let m=g.glyphs[d];if(m!==void 0)return{stack:s,id:d,glyph:m};if(m=this._tinySDF(g,s,d),m)return g.glyphs[d]=m,{stack:s,id:d,glyph:m};const v=Math.floor(d/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[v])return{stack:s,id:d,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[v]){const R=Qe.loadGlyphRange(s,v,this.url,this.requestManager);g.requests[v]=R}const C=yield g.requests[v];for(const R in C)this._doesCharSupportLocalGlyph(+R)||(g.glyphs[+R]=C[+R]);return g.ranges[v]=!0,{stack:s,id:d,glyph:C[d]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))}_tinySDF(s,d,g){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(g))return;let v=s.tinySDF;if(!v){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),v=s.tinySDF=new Qe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:R})}const C=v.draw(String.fromCharCode(g));return{id:g,bitmap:new a.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qe.loadGlyphRange=function(b,s,d,g){return a._(this,void 0,void 0,function*(){const m=256*s,v=m+255,C=g.transformRequest(d.replace("{fontstack}",b).replace("{range}",`${m}-${v}`),"Glyphs"),R=yield a.l(C,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${s}, ${m}-${v}`);const M={};for(const z of a.n(R.data))M[z.id]=z;return M})},Qe.TinySDF=class{constructor({fontSize:b=24,buffer:s=3,radius:d=8,cutoff:g=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:C="normal"}={}){this.buffer=s,this.cutoff=g,this.radius=d;const R=this.size=b+4*s,M=this._createCanvas(R),z=this.ctx=M.getContext("2d",{willReadFrequently:!0});z.font=`${C} ${v} ${b}px ${m}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(b){const s=document.createElement("canvas");return s.width=s.height=b,s}draw(b){const{width:s,actualBoundingBoxAscent:d,actualBoundingBoxDescent:g,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(b),C=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),M=Math.min(this.size-this.buffer,C+Math.ceil(g)),z=R+2*this.buffer,W=M+2*this.buffer,$=Math.max(z*W,0),Q=new Uint8ClampedArray($),ie={data:Q,width:z,height:W,glyphWidth:R,glyphHeight:M,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(R===0||M===0)return ie;const{ctx:ce,buffer:be,gridInner:Ee,gridOuter:Pe}=this;ce.clearRect(be,be,R,M),ce.fillText(b,be,be+C);const Fe=ce.getImageData(be,be,R,M);Pe.fill(Ne,0,$),Ee.fill(0,0,$);for(let _e=0;_e<M;_e++)for(let je=0;je<R;je++){const Xe=Fe.data[4*(_e*R+je)+3]/255;if(Xe===0)continue;const st=(_e+be)*z+je+be;if(Xe===1)Pe[st]=0,Ee[st]=Ne;else{const St=.5-Xe;Pe[st]=St>0?St*St:0,Ee[st]=St<0?St*St:0}}ot(Pe,0,0,z,W,z,this.f,this.v,this.z),ot(Ee,be,be,R,M,z,this.f,this.v,this.z);for(let _e=0;_e<$;_e++){const je=Math.sqrt(Pe[_e])-Math.sqrt(Ee[_e]);Q[_e]=Math.round(255-255*(je/this.radius+this.cutoff))}return ie}};class pt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,d){return a.x(s.expression.evaluate(d))}interpolate(s,d,g){return{x:a.y.number(s.x,d.x,g),y:a.y.number(s.y,d.y,g),z:a.y.number(s.z,d.z,g)}}}let _t;class Lt extends a.E{constructor(s){super(),_t=_t||new a.q({anchor:new a.D(a.v.light.anchor),position:new pt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(_t),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(a.r,s,d))for(const g in s){const m=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),m):this._transitionable.setValue(g,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,g){return(!g||g.validate!==!1)&&a.t(this,s.call(a.u,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Ht=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class ar extends a.E{constructor(s){super(),this._transitionable=new a.T(Ht),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(s,d={}){if(!this._validate(a.B,s,d)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in s){const m=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),m):this._transitionable.setValue(g,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,g={}){return(g==null?void 0:g.validate)!==!1&&a.t(this,s.call(a.u,a.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class Tt{constructor(s,d){this.width=s,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,d){const g=s.join(",")+String(d);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(s,d)),this.dashEntry[g]}getDashRanges(s,d,g){const m=[];let v=s.length%2==1?-s[s.length-1]*g:0,C=s[0]*g,R=!0;m.push({left:v,right:C,isDash:R,zeroLength:s[0]===0});let M=s[0];for(let z=1;z<s.length;z++){R=!R;const W=s[z];v=M*g,M+=W,C=M*g,m.push({left:v,right:C,isDash:R,zeroLength:W===0})}return m}addRoundDash(s,d,g){const m=d/2;for(let v=-g;v<=g;v++){const C=this.width*(this.nextRow+g+v);let R=0,M=s[R];for(let z=0;z<this.width;z++){z/M.right>1&&(M=s[++R]);const W=Math.abs(z-M.left),$=Math.abs(z-M.right),Q=Math.min(W,$);let ie;const ce=v/g*(m+1);if(M.isDash){const be=m-Math.abs(ce);ie=Math.sqrt(Q*Q+be*be)}else ie=m-Math.sqrt(Q*Q+ce*ce);this.data[C+z]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(s){for(let R=s.length-1;R>=0;--R){const M=s[R],z=s[R+1];M.zeroLength?s.splice(R,1):z&&z.isDash===M.isDash&&(z.left=M.left,s.splice(R,1))}const d=s[0],g=s[s.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const m=this.width*this.nextRow;let v=0,C=s[v];for(let R=0;R<this.width;R++){R/C.right>1&&(C=s[++v]);const M=Math.abs(R-C.left),z=Math.abs(R-C.right),W=Math.min(M,z);this.data[m+R]=Math.max(0,Math.min(255,(C.isDash?W:-W)+128))}}addDash(s,d){const g=d?7:0,m=2*g+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let R=0;R<s.length;R++)v+=s[R];if(v!==0){const R=this.width/v,M=this.getDashRanges(s,this.width,R);d?this.addRoundDash(M,R,g):this.addRegularDash(M)}const C={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:v};return this.nextRow+=m,this.dirty=!0,C}bind(s){const d=s.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Sr="maplibre_preloaded_worker_pool";class Et{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sr]}numActive(){return Object.keys(this.active).length}}const Or=Math.floor(T.hardwareConcurrency/2);let ir,vr;function ur(){return ir||(ir=new Et),ir}Et.workerCount=a.C(globalThis)?Math.max(Math.min(Or,3),1):1;class kr{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const g=this.workerPool.acquire(d);for(let m=0;m<g.length;m++){const v=new a.F(g[m],d);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,d){const g=[];for(const m of this.actors)g.push(m.sendAsync({type:s,data:d}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,d){for(const g of this.actors)g.registerMessageHandler(s,d)}}function nn(){return vr||(vr=new kr(ur(),a.G),vr.registerMessageHandler("GR",(b,s,d)=>a.m(s,d))),vr}function pr(b,s){const d=a.H();return a.J(d,d,[1,1,0]),a.K(d,d,[.5*b.width,.5*b.height,1]),a.L(d,d,b.calculatePosMatrix(s.toUnwrapped()))}function Hr(b,s,d,g,m,v){const C=function($,Q,ie){if($)for(const ce of $){const be=Q[ce];if(be&&be.source===ie&&be.type==="fill-extrusion")return!0}else for(const ce in Q){const be=Q[ce];if(be.source===ie&&be.type==="fill-extrusion")return!0}return!1}(m&&m.layers,s,b.id),R=v.maxPitchScaleFactor(),M=b.tilesIn(g,R,C);M.sort(Nr);const z=[];for(const $ of M)z.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(s,d,b._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,m,v,R,pr(b.transform,$.tileID))});const W=function($){const Q={},ie={};for(const ce of $){const be=ce.queryResults,Ee=ce.wrappedTileID,Pe=ie[Ee]=ie[Ee]||{};for(const Fe in be){const _e=be[Fe],je=Pe[Fe]=Pe[Fe]||{},Xe=Q[Fe]=Q[Fe]||[];for(const st of _e)je[st.featureIndex]||(je[st.featureIndex]=!0,Xe.push(st))}}return Q}(z);for(const $ in W)W[$].forEach(Q=>{const ie=Q.feature,ce=b.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ce});return W}function Nr(b,s){const d=b.tileID,g=s.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}function mt(b,s,d){return a._(this,void 0,void 0,function*(){let g=b;if(b.url?g=(yield a.h(s.transformRequest(b.url,"Source"),d)).data:yield T.frameAsync(d),!g)return null;const m=a.M(a.e(g,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(m.vectorLayerIds=g.vector_layers.map(v=>v.id)),m})}class Te{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.N?new a.N(s.lng,s.lat):a.N.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.N?new a.N(s.lng,s.lat):a.N.convert(s),this}extend(s){const d=this._sw,g=this._ne;let m,v;if(s instanceof a.N)m=s,v=s;else{if(!(s instanceof Te))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Te.convert(s)):this.extend(a.N.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.N.convert(s)):this;if(m=s._sw,v=s._ne,!m||!v)return this}return d||g?(d.lng=Math.min(m.lng,d.lng),d.lat=Math.min(m.lat,d.lat),g.lng=Math.max(v.lng,g.lng),g.lat=Math.max(v.lat,g.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(v.lng,v.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:g}=a.N.convert(s);let m=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&m}static convert(s){return s instanceof Te?s:s&&new Te(s)}static fromLngLat(s,d=0){const g=360*d/40075017,m=g/Math.cos(Math.PI/180*s.lat);return new Te(new a.N(s.lng-m,s.lat-g),new a.N(s.lng+m,s.lat+g))}adjustAntiMeridian(){const s=new a.N(this._sw.lng,this._sw.lat),d=new a.N(this._ne.lng,this._ne.lat);return new Te(s,s.lng>d.lng?new a.N(d.lng+360,d.lat):d)}}class Qt{constructor(s,d,g){this.bounds=Te.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),g=Math.floor(a.O(this.bounds.getWest())*d),m=Math.floor(a.Q(this.bounds.getNorth())*d),v=Math.ceil(a.O(this.bounds.getEast())*d),C=Math.ceil(a.Q(this.bounds.getSouth())*d);return s.x>=g&&s.x<v&&s.y>=m&&s.y<C}}class Ct extends a.E{constructor(s,d,g,m){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(d,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(a.e(this,s),s.bounds&&(this.tileBounds=new Qt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new a.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(s){return a._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((v,C)=>{s.reloadPromise={resolve:v,reject:C}})}else s.actor=this.dispatcher.getActor(),m="LT";s.abortController=new AbortController;try{const v=yield s.actor.sendAsync({type:m,data:g},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,v)}catch(v){if(delete s.abortController,s.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,d){if(d&&d.resourceTiming&&(s.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&s.setExpiryData(d),s.loadVectorData(d,this.map.painter),s.reloadPromise){const g=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(g.resolve).catch(g.reject)}}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class yt extends a.E{constructor(s,d,g,m){super(),this.id=s,this.dispatcher=g,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},d),a.e(this,a.M(d,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(a.e(this,s),s.bounds&&(this.tileBounds=new Qt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new a.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return a._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const g=yield U.getImage(this.map._requestManager.transformRequest(d,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const m=this.map.painter.context,v=m.gl,C=g.data;s.texture=this.map.painter.getTileTexture(C.width),s.texture?s.texture.update(C,{useMipmap:!0}):(s.texture=new De(m,C,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class sr extends yt{constructor(s,d,g,m){super(s,d,g,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(s){return a._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(d,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const m=yield U.getImage(g,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const C=a.b(v)&&a.U()?v:yield this.readImageNow(v),R={type:this.type,uid:s.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const M=yield s.actor.sendAsync({type:"LDT",data:R});s.dem=M,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}})}readImageNow(s){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const d=s.width+2,g=s.height+2;try{return new a.R({width:d,height:g},yield a.W(s,-1,-1,d,g))}catch{}}return T.getImageData(s,1)})}_getNeighboringTiles(s){const d=s.canonical,g=Math.pow(2,d.z),m=(d.x-1+g)%g,v=d.x===0?s.wrap-1:s.wrap,C=(d.x+1+g)%g,R=d.x+1===g?s.wrap+1:s.wrap,M={};return M[new a.S(s.overscaledZ,v,d.z,m,d.y).key]={backfilled:!1},M[new a.S(s.overscaledZ,R,d.z,C,d.y).key]={backfilled:!1},d.y>0&&(M[new a.S(s.overscaledZ,v,d.z,m,d.y-1).key]={backfilled:!1},M[new a.S(s.overscaledZ,s.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},M[new a.S(s.overscaledZ,R,d.z,C,d.y-1).key]={backfilled:!1}),d.y+1<g&&(M[new a.S(s.overscaledZ,v,d.z,m,d.y+1).key]={backfilled:!1},M[new a.S(s.overscaledZ,s.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},M[new a.S(s.overscaledZ,R,d.z,C,d.y+1).key]={backfilled:!1}),M}unloadTile(s){return a._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Br extends a.E{constructor(s,d,g,m){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(m),this._data=d.data,this._options=a.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const v=a.X/this.tileSize;d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*v,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*v,extent:a.X,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:a.X,radius:(d.clusterRadius||50)*v,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}getData(){return a._(this,void 0,void 0,function*(){const s=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,d,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:d,offset:g}})}_updateWorkerData(s){return a._(this,void 0,void 0,function*(){const d=a.e({type:this.type},this.workerOptions);s?d.dataDiff=s:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;g.resourceTiming&&g.resourceTiming[this.id]&&(m=g.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(v,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(g))}})}loaded(){return this._pendingLoads===0}loadTile(s){return a._(this,void 0,void 0,function*(){const d=s.actor?"RT":"LT";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const m=yield this.actor.sendAsync({type:d,data:g},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(m,this.map.painter,d==="RT")})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $r=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jt extends a.E{constructor(s,d,g,m){super(),this.id=s,this.dispatcher=g,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=d}load(s){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield U.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,s&&(this.coordinates=s),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new a.j(d))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const d=s.map(a.Z.fromLngLat);this.tileID=function(m){let v=1/0,C=1/0,R=-1/0,M=-1/0;for(const Q of m)v=Math.min(v,Q.x),C=Math.min(C,Q.y),R=Math.max(R,Q.x),M=Math.max(M,Q.y);const z=Math.max(R-v,M-C),W=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),$=Math.pow(2,W);return new a.a1(W,Math.floor((v+R)/2*$),Math.floor((C+M)/2*$))}(d),this.minzoom=this.maxzoom=this.tileID.z;const g=d.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(g[0].x,g[0].y,0,0),this._boundsArray.emplaceBack(g[1].x,g[1].y,a.X,0),this._boundsArray.emplaceBack(g[3].x,g[3].y,0,a.X),this._boundsArray.emplaceBack(g[2].x,g[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,$r.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new De(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let g=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zt extends Jt{constructor(s,d,g,m){super(s,d,g,m),this.roundZoom=!0,this.type="video",this.options=d}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const d of s.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield a.a3(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new a.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const d=this.video.seekable;s<d.start(0)||s>d.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,$r.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new De(s,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let g=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ar extends Jt{constructor(s,d,g,m){super(s,d,g,m),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(C=>typeof C!="number"))||this.fire(new a.j(new a.a2(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${s}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${s}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,g=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,$r.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new De(d,this.canvas,g.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Fr={},Jr=b=>{switch(b){case"geojson":return Br;case"image":return Jt;case"raster":return yt;case"raster-dem":return sr;case"vector":return Ct;case"video":return Zt;case"canvas":return Ar}return Fr[b]},bt="RTLPluginLoaded";class zr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return a._(this,arguments,void 0,function*(d,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=T.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(bt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Mr=null;function Zr(){return Mr||(Mr=new zr),Mr}class xn{constructor(s,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a4(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const d=s+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,d,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(m,v){const C={};if(!v)return C;for(const R of m){const M=R.layerIds.map(z=>v.getLayer(z)).filter(Boolean);if(M.length!==0){R.layers=M,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(z=>M.filter(W=>W.id===z)[0]));for(const z of M)C[z.id]=R}}return C}(s.buckets,d.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a6){if(this.hasSymbolBuckets=!0,!g)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a6&&v.hasRTLText){this.hasRTLText=!0,Zr().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(m).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const g in this.buckets){const m=this.buckets[g];m.uploadPending()&&m.upload(s)}const d=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new De(s,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new De(s,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,d,g,m,v,C,R,M,z,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:C,tileSize:this.tileSize,pixelPosMatrix:W,transform:M,params:R,queryPadding:this.queryPadding*z},s,d,g):{}}querySourceFeatures(s,d){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const m=g.loadVTLayers(),v=d&&d.sourceLayer?d.sourceLayer:"",C=m._geojsonTileLayer||m[v];if(!C)return;const R=a.a7(d&&d.filter),{z:M,x:z,y:W}=this.tileID.canonical,$={z:M,x:z,y:W};for(let Q=0;Q<C.length;Q++){const ie=C.feature(Q);if(R.needGeometry){const Ee=a.a8(ie,!0);if(!R.filter(new a.z(this.tileID.overscaledZ),Ee,this.tileID.canonical))continue}else if(!R.filter(new a.z(this.tileID.overscaledZ),ie))continue;const ce=g.getId(ie,v),be=new a.a9(ie,M,z,W,ce);be.tile=$,s.push(be)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const d=this.expirationTime;if(s.cacheControl){const g=a.aa(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let m=!1;if(this.expirationTime>g)m=!1;else if(d)if(this.expirationTime<d)m=!0;else{const v=this.expirationTime-d;v?this.expirationTime=g+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!d.style.hasLayer(m))continue;const v=this.buckets[m],C=v.layers[0].sourceLayer||"_geojsonTileLayer",R=g[C],M=s[C];if(!R||!M||Object.keys(M).length===0)continue;v.update(M,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=d&&d.style&&d.style.getLayer(m);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=T.now()+s}setDependencies(s,d){const g={};for(const m of d)g[m]=!0;this.dependencies[s]=g}hasDependency(s,d){for(const g of s){const m=this.dependencies[g];if(m){for(const v of d)if(m[v])return!0}}return!1}}class Ot{constructor(s,d){this.max=s,this.onRemove=d,this.reset()}reset(){for(const s in this.data)for(const d of this.data[s])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(s,d,g){const m=s.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:d,timeout:void 0};if(g!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},g)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const d=this.data[s].shift();return d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),d.value}getByKey(s){const d=this.data[s];return d?d[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,d){if(!this.has(s))return this;const g=s.wrapped().key,m=d===void 0?0:this.data[g].indexOf(d),v=this.data[g][m];return this.data[g].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(v.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(s){const d=[];for(const g in this.data)for(const m of this.data[g])s(m.value)||d.push(m);for(const g of d)this.remove(g.value.tileID,g)}}class qe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,d,g){const m=String(d);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][m]=this.stateChanges[s][m]||{},a.e(this.stateChanges[s][m],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==m&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][m]===null){this.deletedStates[s][m]={};for(const v in this.state[s][m])g[v]||(this.deletedStates[s][m][v]=null)}else for(const v in g)this.deletedStates[s]&&this.deletedStates[s][m]&&this.deletedStates[s][m][v]===null&&delete this.deletedStates[s][m][v]}removeFeatureState(s,d,g){if(this.deletedStates[s]===null)return;const m=String(d);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&d!==void 0)this.deletedStates[s][m]!==null&&(this.deletedStates[s][m]=this.deletedStates[s][m]||{},this.deletedStates[s][m][g]=null);else if(d!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][m])for(g in this.deletedStates[s][m]={},this.stateChanges[s][m])this.deletedStates[s][m][g]=null;else this.deletedStates[s][m]=null;else this.deletedStates[s]=null}getState(s,d){const g=String(d),m=a.e({},(this.state[s]||{})[g],(this.stateChanges[s]||{})[g]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][d];if(v===null)return{};for(const C in v)delete m[C]}return m}initializeTileState(s,d){s.setFeatureState(this.state,d)}coalesceChanges(s,d){const g={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const C in this.stateChanges[m])this.state[m][C]||(this.state[m][C]={}),a.e(this.state[m][C],this.stateChanges[m][C]),v[C]=this.state[m][C];g[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const C in this.state[m])v[C]={},this.state[m][C]={};else for(const C in this.deletedStates[m]){if(this.deletedStates[m][C]===null)this.state[m][C]={};else for(const R of Object.keys(this.deletedStates[m][C]))delete this.state[m][C][R];v[C]=this.state[m][C]}g[m]=g[m]||{},a.e(g[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const m in s)s[m].setFeatureState(g,d)}}class $e extends a.E{constructor(s,d,g){super(),this.id=s,this.dispatcher=g,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,C,R)=>{const M=new(Jr(v.type))(m,v,C,R);if(M.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${M.id}`);return M})(s,d,g,this),this._tiles={},this._cache=new Ot(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qe,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const d=this._tiles[s];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,d,g){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,d,g)}catch(m){s.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new a.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const g=this._tiles[d];g.upload(s),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(dt).map(s=>s.key)}getRenderableIds(s){const d=[];for(const g in this._tiles)this._isIdRenderable(g,s)&&d.push(this._tiles[g]);return s?d.sort((g,m)=>{const v=g.tileID,C=m.tileID,R=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),M=new a.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-C.overscaledZ||M.y-R.y||M.x-R.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(dt).map(g=>g.key)}hasRenderableParent(s){const d=this.findLoadedParent(s,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(s,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(d||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,d){return a._(this,void 0,void 0,function*(){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=d),yield this._loadTile(g,s,d))})}_tileLoaded(s,d,g){s.timeAdded=T.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(d,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const d=this.getRenderableIds();for(let m=0;m<d.length;m++){const v=d[m];if(s.neighboringTiles&&s.neighboringTiles[v]){const C=this.getTileByID(v);g(s,C),g(C,s)}}function g(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let C=v.tileID.canonical.x-m.tileID.canonical.x;const R=v.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),z=v.tileID.key;C===0&&R===0||Math.abs(R)>1||(Math.abs(C)>1&&(Math.abs(C+M)===1?C+=M:Math.abs(C-M)===1&&(C-=M)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,C,R),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,d,g,m){for(const v in this._tiles){let C=this._tiles[v];if(m[v]||!C.hasData()||C.tileID.overscaledZ<=d||C.tileID.overscaledZ>g)continue;let R=C.tileID;for(;C&&C.tileID.overscaledZ>d+1;){const z=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[z.key],C&&C.hasData()&&(R=z)}let M=R;for(;M.overscaledZ>d;)if(M=M.scaledTo(M.overscaledZ-1),s[M.key]){m[R.key]=R;break}}}findLoadedParent(s,d){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=d?g:null}for(let g=s.overscaledZ-1;g>=d;g--){const m=s.scaledTo(g),v=this._getLoadedTile(m);if(v)return v}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const d=this._tiles[s.key];return d&&d.hasData()?d:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const d=Math.ceil(s.width/this._source.tileSize)+1,g=Math.ceil(s.height/this._source.tileSize)+1,m=Math.floor(d*g*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(s){const d=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,d){const g={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+d),g[v.tileID.key]=v}this._tiles=g;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(s,d,g,m,v,C){const R={},M={},z=Object.keys(s),W=T.now();for(const $ of z){const Q=s[$],ie=this._tiles[$];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=W)continue;const ce=this.findLoadedParent(Q,d),be=this.findLoadedSibling(Q),Ee=ce||be||null;Ee&&(this._addTile(Ee.tileID),R[Ee.tileID.key]=Ee.tileID),M[$]=Q}this._retainLoadedChildren(M,m,g,s);for(const $ in R)s[$]||(this._coveredTiles[$]=!0,s[$]=R[$]);if(C){const $={},Q={};for(const ie of v)this._tiles[ie.key].hasData()?$[ie.key]=ie:Q[ie.key]=ie;for(const ie in Q){const ce=Q[ie].children(this._source.maxzoom);this._tiles[ce[0].key]&&this._tiles[ce[1].key]&&this._tiles[ce[2].key]&&this._tiles[ce[3].key]&&($[ce[0].key]=s[ce[0].key]=ce[0],$[ce[1].key]=s[ce[1].key]=ce[1],$[ce[2].key]=s[ce[2].key]=ce[2],$[ce[3].key]=s[ce[3].key]=ce[3],delete Q[ie])}for(const ie in Q){const ce=Q[ie],be=this.findLoadedParent(ce,this._source.minzoom),Ee=this.findLoadedSibling(ce),Pe=be||Ee||null;if(Pe){$[Pe.tileID.key]=s[Pe.tileID.key]=Pe.tileID;for(const Fe in $)$[Fe].isChildOf(Pe.tileID)&&delete $[Fe]}}for(const ie in this._tiles)$[ie]||(this._coveredTiles[ie]=!0)}}update(s,d){if(!this._sourceLoaded||this._paused)return;let g;this.transform=s,this.terrain=d,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new a.S(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y)):(g=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(g=g.filter(W=>this._source.hasTile(W)))):g=[];const m=s.coveringZoomLevel(this._source),v=Math.max(m-$e.maxOverzooming,this._source.minzoom),C=Math.max(m+$e.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const W={};for(const $ of g)if($.canonical.z>this._source.minzoom){const Q=$.scaledTo($.canonical.z-1);W[Q.key]=Q;const ie=$.scaledTo(Math.max(this._source.minzoom,Math.min($.canonical.z,5)));W[ie.key]=ie}g=g.concat(Object.values(W))}const R=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(g,m);xt(this._source.type)&&this._updateCoveredAndRetainedTiles(M,v,C,m,g,d);for(const W in M)this._tiles[W].clearFadeHold();const z=a.ab(this._tiles,M);for(const W of z){const $=this._tiles[W];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(W)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,d){var g;const m={},v={},C=Math.max(d-$e.maxOverzooming,this._source.minzoom),R=Math.max(d+$e.maxUnderzooming,this._source.minzoom),M={};for(const z of s){const W=this._addTile(z);m[z.key]=z,W.hasData()||d<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,d,R,m);for(const z of s){let W=this._tiles[z.key];if(W.hasData())continue;if(d+1>this._source.maxzoom){const Q=z.children(this._source.maxzoom)[0],ie=this.getTile(Q);if(ie&&ie.hasData()){m[Q.key]=Q;continue}}else{const Q=z.children(this._source.maxzoom);if(m[Q[0].key]&&m[Q[1].key]&&m[Q[2].key]&&m[Q[3].key])continue}let $=W.wasRequested();for(let Q=z.overscaledZ-1;Q>=C;--Q){const ie=z.scaledTo(Q);if(v[ie.key])break;if(v[ie.key]=!0,W=this.getTile(ie),!W&&$&&(W=this._addTile(ie)),W){const ce=W.hasData();if((ce||!(!((g=this.map)===null||g===void 0)&&g.cancelPendingTileRequestsWhileZooming)||$)&&(m[ie.key]=ie),$=W.wasRequested(),ce)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const d=[];let g,m=this._tiles[s].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){g=this._loadedParentTiles[m.key];break}d.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(g=this._getLoadedTile(v),g)break;m=v}for(const v of d)this._loadedParentTiles[v]=g}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const d=this._tiles[s].tileID,g=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=g}}_addTile(s){let d=this._tiles[s.key];if(d)return d;d=this._cache.getAndRemove(s),d&&(this._setTileReloadTimer(s.key,d),d.tileID=s,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,d)));const g=d;return d||(d=new xn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(d,s.key,d.state)),d.uses++,this._tiles[s.key]=d,g||this._source.fire(new a.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(s,d){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=d.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const d=this._tiles[s];d&&(d.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(s){const d=s.sourceDataType;s.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,d,g){const m=[],v=this.transform;if(!v)return m;const C=g?v.getCameraQueryGeometry(s):s,R=s.map(ce=>v.pointCoordinate(ce,this.terrain)),M=C.map(ce=>v.pointCoordinate(ce,this.terrain)),z=this.getIds();let W=1/0,$=1/0,Q=-1/0,ie=-1/0;for(const ce of M)W=Math.min(W,ce.x),$=Math.min($,ce.y),Q=Math.max(Q,ce.x),ie=Math.max(ie,ce.y);for(let ce=0;ce<z.length;ce++){const be=this._tiles[z[ce]];if(be.holdingForFade())continue;const Ee=be.tileID,Pe=Math.pow(2,v.zoom-be.tileID.overscaledZ),Fe=d*be.queryPadding*a.X/be.tileSize/Pe,_e=[Ee.getTilePoint(new a.Z(W,$)),Ee.getTilePoint(new a.Z(Q,ie))];if(_e[0].x-Fe<a.X&&_e[0].y-Fe<a.X&&_e[1].x+Fe>=0&&_e[1].y+Fe>=0){const je=R.map(st=>Ee.getTilePoint(st)),Xe=M.map(st=>Ee.getTilePoint(st));m.push({tile:be,tileID:Ee,queryGeometry:je,cameraQueryGeometry:Xe,scale:Pe})}}return m}getVisibleCoordinates(s){const d=this.getRenderableIds(s).map(g=>this._tiles[g].tileID);for(const g of d)g.posMatrix=this.transform.calculatePosMatrix(g.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(xt(this._source.type)){const s=T.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=s)return!0}return!1}setFeatureState(s,d,g){this._state.updateState(s=s||"_geojsonTileLayer",d,g)}removeFeatureState(s,d,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",d,g)}getFeatureState(s,d){return this._state.getState(s=s||"_geojsonTileLayer",d)}setDependencies(s,d,g){const m=this._tiles[s];m&&m.setDependencies(d,g)}reloadTilesForDependencies(s,d){for(const g in this._tiles)this._tiles[g].hasDependency(s,d)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(s,d))}}function dt(b,s){const d=Math.abs(2*b.wrap)-+(b.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return b.overscaledZ-s.overscaledZ||g-d||s.canonical.y-b.canonical.y||s.canonical.x-b.canonical.x}function xt(b){return b==="raster"||b==="image"||b==="video"}$e.maxOverzooming=10,$e.maxUnderzooming=3;class at{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ac(s,0,1);let d=1,g=this._distances[d];const m=s*this.paddedLength+this.padding;for(;g<m&&d<this._distances.length;)g=this._distances[++d];const v=d-1,C=this._distances[v],R=g-C,M=R>0?(m-C)/R:0;return this.points[v].mult(1-M).add(this.points[d].mult(M))}}function Dt(b,s){let d=!0;return b==="always"||b!=="never"&&s!=="never"||(d=!1),d}class br{constructor(s,d,g){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(d/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,g,m,v){this._forEachCell(d,g,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(s,d,g,m){this._forEachCell(d-m,g-m,d+m,g+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(g),this.circles.push(m)}_insertBoxCell(s,d,g,m,v,C){this.boxCells[v].push(C)}_insertCircleCell(s,d,g,m,v,C){this.circleCells[v].push(C)}_query(s,d,g,m,v,C,R){if(g<0||s>this.width||m<0||d>this.height)return[];const M=[];if(s<=0&&d<=0&&this.width<=g&&this.height<=m){if(v)return[{key:null,x1:s,y1:d,x2:g,y2:m}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const W=this.circles[3*z],$=this.circles[3*z+1],Q=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:W-Q,y1:$-Q,x2:W+Q,y2:$+Q})}}else this._forEachCell(s,d,g,m,this._queryCell,M,{hitTest:v,overlapMode:C,seenUids:{box:{},circle:{}}},R);return M}query(s,d,g,m){return this._query(s,d,g,m,!1,null)}hitTest(s,d,g,m,v,C){return this._query(s,d,g,m,!0,v,C).length>0}hitTestCircle(s,d,g,m,v){const C=s-g,R=s+g,M=d-g,z=d+g;if(R<0||C>this.width||z<0||M>this.height)return!1;const W=[];return this._forEachCell(C,M,R,z,this._queryCellCircle,W,{hitTest:!0,overlapMode:m,circle:{x:s,y:d,radius:g},seenUids:{box:{},circle:{}}},v),W.length>0}_queryCell(s,d,g,m,v,C,R,M){const{seenUids:z,hitTest:W,overlapMode:$}=R,Q=this.boxCells[v];if(Q!==null){const ce=this.bboxes;for(const be of Q)if(!z.box[be]){z.box[be]=!0;const Ee=4*be,Pe=this.boxKeys[be];if(s<=ce[Ee+2]&&d<=ce[Ee+3]&&g>=ce[Ee+0]&&m>=ce[Ee+1]&&(!M||M(Pe))&&(!W||!Dt($,Pe.overlapMode))&&(C.push({key:Pe,x1:ce[Ee],y1:ce[Ee+1],x2:ce[Ee+2],y2:ce[Ee+3]}),W))return!0}}const ie=this.circleCells[v];if(ie!==null){const ce=this.circles;for(const be of ie)if(!z.circle[be]){z.circle[be]=!0;const Ee=3*be,Pe=this.circleKeys[be];if(this._circleAndRectCollide(ce[Ee],ce[Ee+1],ce[Ee+2],s,d,g,m)&&(!M||M(Pe))&&(!W||!Dt($,Pe.overlapMode))){const Fe=ce[Ee],_e=ce[Ee+1],je=ce[Ee+2];if(C.push({key:Pe,x1:Fe-je,y1:_e-je,x2:Fe+je,y2:_e+je}),W)return!0}}}return!1}_queryCellCircle(s,d,g,m,v,C,R,M){const{circle:z,seenUids:W,overlapMode:$}=R,Q=this.boxCells[v];if(Q!==null){const ce=this.bboxes;for(const be of Q)if(!W.box[be]){W.box[be]=!0;const Ee=4*be,Pe=this.boxKeys[be];if(this._circleAndRectCollide(z.x,z.y,z.radius,ce[Ee+0],ce[Ee+1],ce[Ee+2],ce[Ee+3])&&(!M||M(Pe))&&!Dt($,Pe.overlapMode))return C.push(!0),!0}}const ie=this.circleCells[v];if(ie!==null){const ce=this.circles;for(const be of ie)if(!W.circle[be]){W.circle[be]=!0;const Ee=3*be,Pe=this.circleKeys[be];if(this._circlesCollide(ce[Ee],ce[Ee+1],ce[Ee+2],z.x,z.y,z.radius)&&(!M||M(Pe))&&!Dt($,Pe.overlapMode))return C.push(!0),!0}}}_forEachCell(s,d,g,m,v,C,R,M){const z=this._convertToXCellCoord(s),W=this._convertToYCellCoord(d),$=this._convertToXCellCoord(g),Q=this._convertToYCellCoord(m);for(let ie=z;ie<=$;ie++)for(let ce=W;ce<=Q;ce++)if(v.call(this,s,d,g,m,this.xCellCount*ce+ie,C,R,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,g,m,v,C){const R=m-s,M=v-d,z=g+C;return z*z>R*R+M*M}_circleAndRectCollide(s,d,g,m,v,C,R){const M=(C-m)/2,z=Math.abs(s-(m+M));if(z>M+g)return!1;const W=(R-v)/2,$=Math.abs(d-(v+W));if($>W+g)return!1;if(z<=M||$<=W)return!0;const Q=z-M,ie=$-W;return Q*Q+ie*ie<=g*g}}function tn(b,s,d,g,m){const v=a.H();return s?(a.K(v,v,[1/m,1/m,1]),d||a.ad(v,v,g.angle)):a.L(v,g.labelPlaneMatrix,b),v}function pn(b,s,d,g,m){if(s){const v=a.ae(b);return a.K(v,v,[m,m,1]),d||a.ad(v,v,-g.angle),v}return g.glCoordMatrix}function de(b,s,d,g){let m;g?(m=[b,s,g(b,s),1],a.af(m,m,d)):(m=[b,s,0,1],Wr(m,m,d));const v=m[3];return{point:new a.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function X(b,s){return .5+b/s*.5}function Y(b,s){return b.x>=-s[0]&&b.x<=s[0]&&b.y>=-s[1]&&b.y<=s[1]}function te(b,s,d,g,m,v,C,R,M,z,W,$,Q,ie,ce){const be=g?b.textSizeData:b.iconSizeData,Ee=a.ag(be,d.transform.zoom),Pe=[256/d.width*2+1,256/d.height*2+1],Fe=g?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;Fe.clear();const _e=b.lineVertexArray,je=g?b.text.placedSymbolArray:b.icon.placedSymbolArray,Xe=d.transform.width/d.transform.height;let st=!1;for(let St=0;St<je.length;St++){const Bt=je.get(St);if(Bt.hidden||Bt.writingMode===a.ah.vertical&&!st){Kt(Bt.numGlyphs,Fe);continue}st=!1;const Gt=de(Bt.anchorX,Bt.anchorY,s,ce);if(!Y(Gt.point,Pe)){Kt(Bt.numGlyphs,Fe);continue}const nr=X(d.transform.cameraToCenterDistance,Gt.signedDistanceFromCamera),$t=a.ai(be,Ee,Bt),jt=C?$t/nr:$t*nr,_r={getElevation:ce,labelPlaneMatrix:m,lineVertexArray:_e,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:z,tileAnchorPoint:new a.P(Bt.anchorX,Bt.anchorY),unwrappedTileID:W,width:$,height:Q,translation:ie},en=Oe(_r,Bt,jt,!1,R,s,v,b.glyphOffsetArray,Fe,Xe,M);st=en.useVertical,(en.notEnoughRoom||st||en.needsFlipping&&Oe(_r,Bt,jt,!0,R,s,v,b.glyphOffsetArray,Fe,Xe,M).notEnoughRoom)&&Kt(Bt.numGlyphs,Fe)}g?b.text.dynamicLayoutVertexBuffer.updateData(Fe):b.icon.dynamicLayoutVertexBuffer.updateData(Fe)}function he(b,s,d,g,m,v,C,R){const M=v.glyphStartIndex+v.numGlyphs,z=v.lineStartIndex,W=v.lineStartIndex+v.lineLength,$=s.getoffsetX(v.glyphStartIndex),Q=s.getoffsetX(M-1),ie=kt(b*$,d,g,m,v.segment,z,W,R,C);if(!ie)return null;const ce=kt(b*Q,d,g,m,v.segment,z,W,R,C);return ce?R.projectionCache.anyProjectionOccluded?null:{first:ie,last:ce}:null}function Se(b,s,d,g){return b===a.ah.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*g?{useVertical:!0}:(b===a.ah.vertical?s.y<d.y:s.x>d.x)?{needsFlipping:!0}:null}function Oe(b,s,d,g,m,v,C,R,M,z,W){const $=d/24,Q=s.lineOffsetX*$,ie=s.lineOffsetY*$;let ce;if(s.numGlyphs>1){const be=s.glyphStartIndex+s.numGlyphs,Ee=s.lineStartIndex,Pe=s.lineStartIndex+s.lineLength,Fe=he($,R,Q,ie,g,s,W,b);if(!Fe)return{notEnoughRoom:!0};const _e=de(Fe.first.point.x,Fe.first.point.y,C,b.getElevation).point,je=de(Fe.last.point.x,Fe.last.point.y,C,b.getElevation).point;if(m&&!g){const Xe=Se(s.writingMode,_e,je,z);if(Xe)return Xe}ce=[Fe.first];for(let Xe=s.glyphStartIndex+1;Xe<be-1;Xe++)ce.push(kt($*R.getoffsetX(Xe),Q,ie,g,s.segment,Ee,Pe,b,W));ce.push(Fe.last)}else{if(m&&!g){const Ee=de(b.tileAnchorPoint.x,b.tileAnchorPoint.y,v,b.getElevation).point,Pe=s.lineStartIndex+s.segment+1,Fe=new a.P(b.lineVertexArray.getx(Pe),b.lineVertexArray.gety(Pe)),_e=de(Fe.x,Fe.y,v,b.getElevation),je=_e.signedDistanceFromCamera>0?_e.point:function(st,St,Bt,Gt,nr,$t){return He(st,St,Bt,1,nr,$t)}(b.tileAnchorPoint,Fe,Ee,0,v,b),Xe=Se(s.writingMode,Ee,je,z);if(Xe)return Xe}const be=kt($*R.getoffsetX(s.glyphStartIndex),Q,ie,g,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,b,W);if(!be||b.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ce=[be]}for(const be of ce)a.aj(M,be.point,be.angle);return{}}function He(b,s,d,g,m,v){const C=b.add(b.sub(s)._unit()),R=m!==void 0?de(C.x,C.y,m,v.getElevation).point:We(C.x,C.y,v).point,M=d.sub(R);return d.add(M._mult(g/M.mag()))}function ye(b,s,d){const g=s.projectionCache;if(g.projections[b])return g.projections[b];const m=new a.P(s.lineVertexArray.getx(b),s.lineVertexArray.gety(b)),v=We(m.x,m.y,s);if(v.signedDistanceFromCamera>0)return g.projections[b]=v.point,g.anyProjectionOccluded=g.anyProjectionOccluded||v.isOccluded,v.point;const C=b-d.direction;return function(R,M,z,W,$){return He(R,M,z,W,void 0,$)}(d.distanceFromAnchor===0?s.tileAnchorPoint:new a.P(s.lineVertexArray.getx(C),s.lineVertexArray.gety(C)),m,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,s)}function We(b,s,d){const g=b+d.translation[0],m=s+d.translation[1];let v;return!d.pitchWithMap&&d.projection.useSpecialProjectionForSymbols?(v=d.projection.projectTileCoordinates(g,m,d.unwrappedTileID,d.getElevation),v.point.x=(.5*v.point.x+.5)*d.width,v.point.y=(.5*-v.point.y+.5)*d.height):(v=de(g,m,d.labelPlaneMatrix,d.getElevation),v.isOccluded=!1),v}function ft(b,s,d){return b._unit()._perp()._mult(s*d)}function Je(b,s,d,g,m,v,C,R,M){if(R.projectionCache.offsets[b])return R.projectionCache.offsets[b];const z=d.add(s);if(b+M.direction<g||b+M.direction>=m)return R.projectionCache.offsets[b]=z,z;const W=ye(b+M.direction,R,M),$=ft(W.sub(d),C,M.direction),Q=d.add($),ie=W.add($);return R.projectionCache.offsets[b]=a.ak(v,z,Q,ie)||z,R.projectionCache.offsets[b]}function kt(b,s,d,g,m,v,C,R,M){const z=g?b-s:b+s;let W=z>0?1:-1,$=0;g&&(W*=-1,$=Math.PI),W<0&&($+=Math.PI);let Q,ie=W>0?v+m:v+m+1;R.projectionCache.cachedAnchorPoint?Q=R.projectionCache.cachedAnchorPoint:(Q=We(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=Q);let ce,be,Ee=Q,Pe=Q,Fe=0,_e=0;const je=Math.abs(z),Xe=[];let st;for(;Fe+_e<=je;){if(ie+=W,ie<v||ie>=C)return null;Fe+=_e,Pe=Ee,be=ce;const Gt={absOffsetX:je,direction:W,distanceFromAnchor:Fe,previousVertex:Pe};if(Ee=ye(ie,R,Gt),d===0)Xe.push(Pe),st=Ee.sub(Pe);else{let nr;const $t=Ee.sub(Pe);nr=$t.mag()===0?ft(ye(ie+W,R,Gt).sub(Ee),d,W):ft($t,d,W),be||(be=Pe.add(nr)),ce=Je(ie,nr,Ee,v,C,be,d,R,Gt),Xe.push(be),st=ce.sub(be)}_e=st.mag()}const St=st._mult((je-Fe)/_e)._add(be||Pe),Bt=$+Math.atan2(Ee.y-Pe.y,Ee.x-Pe.x);return Xe.push(St),{point:St,angle:M?Bt:0,path:Xe}}const Vt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Kt(b,s){for(let d=0;d<b;d++){const g=s.length;s.resize(g+4),s.float32.set(Vt,3*g)}}function Wr(b,s,d){const g=s[0],m=s[1];return b[0]=d[0]*g+d[4]*m+d[12],b[1]=d[1]*g+d[5]*m+d[13],b[3]=d[3]*g+d[7]*m+d[15],b}const Er=100;class wr{constructor(s,d,g=new br(s.width+200,s.height+200,25),m=new br(s.width+200,s.height+200,25)){this.transform=s,this.mapProjection=d,this.grid=g,this.ignoredGrid=m,this.pitchFactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Er,this.screenBottomBoundary=s.height+Er,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,d,g,m,v,C,R,M,z,W,$){const Q=s.anchorPointX+M[0],ie=s.anchorPointY+M[1],ce=this.projectAndGetPerspectiveRatio(m,Q,ie,v,W),be=g*ce.perspectiveRatio;let Ee;if(C||R)Ee=this._projectCollisionBox(s,be,m,v,C,R,M,ce,W,$);else{const Xe=ce.point.x+($?$.x*be:0),st=ce.point.y+($?$.y*be:0);Ee={allPointsOccluded:!1,box:[Xe+s.x1*be,st+s.y1*be,Xe+s.x2*be,st+s.y2*be]}}const[Pe,Fe,_e,je]=Ee.box;return this.mapProjection.useSpecialProjectionForSymbols&&(C?Ee.allPointsOccluded:this.mapProjection.isOccluded(Q,ie,v))||ce.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Pe,Fe,_e,je)||d!=="always"&&this.grid.hitTest(Pe,Fe,_e,je,d,z)?{box:[Pe,Fe,_e,je],placeable:!1,offscreen:!1}:{box:[Pe,Fe,_e,je],placeable:!0,offscreen:this.isOffscreen(Pe,Fe,_e,je)}}placeCollisionCircles(s,d,g,m,v,C,R,M,z,W,$,Q,ie,ce,be,Ee){const Pe=[],Fe=new a.P(d.anchorX,d.anchorY),_e=this.getPerspectiveRatio(C,Fe.x,Fe.y,R,Ee),je=($?v/_e:v*_e)/a.ap,Xe={getElevation:Ee,labelPlaneMatrix:M,lineVertexArray:g,pitchWithMap:$,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Fe,unwrappedTileID:R,width:this.transform.width,height:this.transform.height,translation:be},st=he(je,m,d.lineOffsetX*je,d.lineOffsetY*je,!1,d,!1,Xe);let St=!1,Bt=!1,Gt=!0;if(st){const nr=.5*ie*_e+ce,$t=new a.P(-100,-100),jt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),_r=new at,en=st.first,qt=st.last;let tr=[];for(let on=en.path.length-1;on>=1;on--)tr.push(en.path[on]);for(let on=1;on<qt.path.length;on++)tr.push(qt.path[on]);const Kr=2.5*nr;if(z){const on=this.projectPathToScreenSpace(tr,Xe,z);tr=on.some(gn=>gn.signedDistanceFromCamera<=0)?[]:on.map(gn=>gn.point)}let Yn=[];if(tr.length>0){const on=tr[0].clone(),gn=tr[0].clone();for(let Kn=1;Kn<tr.length;Kn++)on.x=Math.min(on.x,tr[Kn].x),on.y=Math.min(on.y,tr[Kn].y),gn.x=Math.max(gn.x,tr[Kn].x),gn.y=Math.max(gn.y,tr[Kn].y);Yn=on.x>=$t.x&&gn.x<=jt.x&&on.y>=$t.y&&gn.y<=jt.y?[tr]:gn.x<$t.x||on.x>jt.x||gn.y<$t.y||on.y>jt.y?[]:a.al([tr],$t.x,$t.y,jt.x,jt.y)}for(const on of Yn){_r.reset(on,.25*nr);let gn=0;gn=_r.length<=.5*nr?1:Math.ceil(_r.paddedLength/Kr)+1;for(let Kn=0;Kn<gn;Kn++){const Qi=Kn/Math.max(gn-1,1),eo=_r.lerp(Qi),Gn=eo.x+Er,vs=eo.y+Er;Pe.push(Gn,vs,nr,0);const us=Gn-nr,es=vs-nr,hs=Gn+nr,yo=vs+nr;if(Gt=Gt&&this.isOffscreen(us,es,hs,yo),Bt=Bt||this.isInsideGrid(us,es,hs,yo),s!=="always"&&this.grid.hitTestCircle(Gn,vs,nr,s,Q)&&(St=!0,!W))return{circles:[],offscreen:!1,collisionDetected:St}}}}return{circles:!W&&St||!Bt||_e<this.perspectiveRatioCutoff?[]:Pe,offscreen:Gt,collisionDetected:St}}projectPathToScreenSpace(s,d,g){return s.map(m=>de(m.x,m.y,g,d.getElevation))}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let g=1/0,m=1/0,v=-1/0,C=-1/0;for(const W of s){const $=new a.P(W.x+Er,W.y+Er);g=Math.min(g,$.x),m=Math.min(m,$.y),v=Math.max(v,$.x),C=Math.max(C,$.y),d.push($)}const R=this.grid.query(g,m,v,C).concat(this.ignoredGrid.query(g,m,v,C)),M={},z={};for(const W of R){const $=W.key;if(M[$.bucketInstanceId]===void 0&&(M[$.bucketInstanceId]={}),M[$.bucketInstanceId][$.featureIndex])continue;const Q=[new a.P(W.x1,W.y1),new a.P(W.x2,W.y1),new a.P(W.x2,W.y2),new a.P(W.x1,W.y2)];a.am(d,Q)&&(M[$.bucketInstanceId][$.featureIndex]=!0,z[$.bucketInstanceId]===void 0&&(z[$.bucketInstanceId]=[]),z[$.bucketInstanceId].push($.featureIndex))}return z}insertCollisionBox(s,d,g,m,v,C){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:C,overlapMode:d},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,g,m,v,C){const R=g?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:v,collisionGroupID:C,overlapMode:d};for(let z=0;z<s.length;z+=4)R.insertCircle(M,s[z],s[z+1],s[z+2])}projectAndGetPerspectiveRatio(s,d,g,m,v){let C;v?(C=[d,g,v(d,g),1],a.af(C,C,s)):(C=[d,g,0,1],Wr(C,C,s));const R=C[3];return{point:new a.P((C[0]/R+1)/2*this.transform.width+Er,(-C[1]/R+1)/2*this.transform.height+Er),perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}getPerspectiveRatio(s,d,g,m,v){const C=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,g,m,v):de(d,g,s,v);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(s,d,g,m){return g<Er||s>=this.screenRightBoundary||m<Er||d>this.screenBottomBoundary}isInsideGrid(s,d,g,m){return g>=0&&s<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=a.an([]);return a.J(s,s,[-100,-100,0]),s}_projectCollisionBox(s,d,g,m,v,C,R,M,z,W){let $=new a.P(1,0),Q=new a.P(0,1);const ie=new a.P(s.anchorPointX+R[0],s.anchorPointY+R[1]);if(C&&!v){const Gt=this.projectAndGetPerspectiveRatio(g,ie.x+1,ie.y,m,z).point.sub(M.point).unit(),nr=Math.atan(Gt.y/Gt.x)+(Gt.x<0?Math.PI:0),$t=Math.sin(nr),jt=Math.cos(nr);$=new a.P(jt,$t),Q=new a.P(-$t,jt)}else if(!C&&v){const Gt=-this.transform.angle,nr=Math.sin(Gt),$t=Math.cos(Gt);$=new a.P($t,nr),Q=new a.P(-nr,$t)}let ce=M.point,be=d;if(v){ce=ie;const Gt=this.transform.zoom-Math.floor(this.transform.zoom);be=Math.pow(2,-Gt),be*=this.mapProjection.getPitchedTextCorrection(this.transform,ie,m),W||(be*=a.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}W&&(ce=ce.add($.mult(W.x*be)).add(Q.mult(W.y*be)));const Ee=s.x1*be,Pe=s.x2*be,Fe=(Ee+Pe)/2,_e=s.y1*be,je=s.y2*be,Xe=(_e+je)/2,st=[{offsetX:Ee,offsetY:_e},{offsetX:Fe,offsetY:_e},{offsetX:Pe,offsetY:_e},{offsetX:Pe,offsetY:Xe},{offsetX:Pe,offsetY:je},{offsetX:Fe,offsetY:je},{offsetX:Ee,offsetY:je},{offsetX:Ee,offsetY:Xe}];let St=[];for(const{offsetX:Gt,offsetY:nr}of st)St.push(new a.P(ce.x+$.x*Gt+Q.x*nr,ce.y+$.y*Gt+Q.y*nr));let Bt=!1;if(v){const Gt=St.map(nr=>this.projectAndGetPerspectiveRatio(g,nr.x,nr.y,m,z));Bt=Gt.some(nr=>!nr.isOccluded),St=Gt.map(nr=>nr.point)}else Bt=!0;return{box:a.ao(St),allPointsOccluded:!Bt}}}function gr(b,s,d){return s*(a.X/(b.tileSize*Math.pow(2,d-b.tileID.overscaledZ)))}class Yr{constructor(s,d,g,m){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):m&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Pr{constructor(s,d,g,m,v){this.text=new Yr(s?s.text:null,d,g,v),this.icon=new Yr(s?s.icon:null,d,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(s,d,g){this.text=s,this.icon=d,this.skipFade=g}}class Rr{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class Dr{constructor(s,d,g,m,v){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=g,this.bucketIndex=m,this.tileID=v}}class It{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:g=>g.collisionGroupID===d}}return this.collisionGroups[s]}}function hn(b,s,d,g,m){const{horizontalAlign:v,verticalAlign:C}=a.au(b);return new a.P(-(v-.5)*s+g[0]*m,-(C-.5)*d+g[1]*m)}class Ur{constructor(s,d,g,m,v,C){this.transform=s.clone(),this.terrain=g,this.collisionIndex=new wr(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new It(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const d=this.terrain;return d?(g,m)=>d.getElevation(s,g,m):null}getBucketParts(s,d,g,m){const v=g.getBucket(d),C=g.latestFeatureIndex;if(!v||!C||d.id!==v.layerIds[0])return;const R=g.collisionBoxArray,M=v.layers[0].layout,z=v.layers[0].paint,W=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),$=g.tileSize/a.X,Q=g.tileID.toUnwrapped(),ie=this.transform.calculatePosMatrix(Q),ce=M.get("text-pitch-alignment")==="map",be=M.get("text-rotation-alignment")==="map",Ee=gr(g,1,this.transform.zoom),Pe=this.collisionIndex.mapProjection.translatePosition(this.transform,g,z.get("text-translate"),z.get("text-translate-anchor")),Fe=this.collisionIndex.mapProjection.translatePosition(this.transform,g,z.get("icon-translate"),z.get("icon-translate-anchor")),_e=tn(ie,ce,be,this.transform,Ee);let je=null;if(ce){const st=pn(ie,ce,be,this.transform,Ee);je=a.L([],this.transform.labelPlaneMatrix,st)}this.retainedQueryData[v.bucketInstanceId]=new Dr(v.bucketInstanceId,C,v.sourceLayerIndex,v.index,g.tileID);const Xe={bucket:v,layout:M,translationText:Pe,translationIcon:Fe,posMatrix:ie,unwrappedTileID:Q,textLabelPlaneMatrix:_e,labelToScreenMatrix:je,scale:W,textPixelRatio:$,holdingForFade:g.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const st of v.sortKeyRanges){const{sortKey:St,symbolInstanceStart:Bt,symbolInstanceEnd:Gt}=st;s.push({sortKey:St,symbolInstanceStart:Bt,symbolInstanceEnd:Gt,parameters:Xe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(s,d,g,m,v,C,R,M,z,W,$,Q,ie,ce,be,Ee,Pe,Fe,_e){const je=a.aq[s.textAnchor],Xe=[s.textOffset0,s.textOffset1],st=hn(je,g,m,Xe,v),St=this.collisionIndex.placeCollisionBox(d,Q,M,z,W,R,C,Ee,$.predicate,_e,st);if((!Fe||this.collisionIndex.placeCollisionBox(Fe,Q,M,z,W,R,C,Pe,$.predicate,_e,st).placeable)&&St.placeable){let Bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID].text&&(Bt=this.prevPlacement.variableOffsets[ie.crossTileID].anchor),ie.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ie.crossTileID]={textOffset:Xe,width:g,height:m,anchor:je,textBoxScale:v,prevAnchor:Bt},this.markUsedJustification(ce,je,ie,be),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,be,ie),this.placedOrientations[ie.crossTileID]=be),{shift:st,placedGlyphBoxes:St}}}placeLayerBucketPart(s,d,g){const{bucket:m,layout:v,translationText:C,translationIcon:R,posMatrix:M,unwrappedTileID:z,textLabelPlaneMatrix:W,labelToScreenMatrix:$,textPixelRatio:Q,holdingForFade:ie,collisionBoxArray:ce,partiallyEvaluatedTextSize:be,collisionGroup:Ee}=s.parameters,Pe=v.get("text-optional"),Fe=v.get("icon-optional"),_e=a.ar(v,"text-overlap","text-allow-overlap"),je=_e==="always",Xe=a.ar(v,"icon-overlap","icon-allow-overlap"),st=Xe==="always",St=v.get("text-rotation-alignment")==="map",Bt=v.get("text-pitch-alignment")==="map",Gt=v.get("icon-text-fit")!=="none",nr=v.get("symbol-z-order")==="viewport-y",$t=je&&(st||!m.hasIconData()||Fe),jt=st&&(je||!m.hasTextData()||Pe);!m.collisionArrays&&ce&&m.deserializeCollisionBoxes(ce);const _r=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),en=(qt,tr,Kr)=>{var Yn,on;if(d[qt.crossTileID])return;if(ie)return void(this.placements[qt.crossTileID]=new Wt(!1,!1,!1));let gn=!1,Kn=!1,Qi=!0,eo=null,Gn={box:null,placeable:!1,offscreen:null},vs={placeable:!1},us=null,es=null,hs=null,yo=0,xl=0,Hu=0;tr.textFeatureIndex?yo=tr.textFeatureIndex:qt.useRuntimeCollisionCircles&&(yo=qt.featureIndex),tr.verticalTextFeatureIndex&&(xl=tr.verticalTextFeatureIndex);const wl=tr.textBox;if(wl){const $s=Xi=>{let ts=a.ah.horizontal;if(m.allowVerticalPlacement&&!Xi&&this.prevPlacement){const Ms=this.prevPlacement.placedOrientations[qt.crossTileID];Ms&&(this.placedOrientations[qt.crossTileID]=Ms,ts=Ms,this.markUsedOrientation(m,ts,qt))}return ts},qs=(Xi,ts)=>{if(m.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&tr.verticalTextBox){for(const Ms of m.writingModes)if(Ms===a.ah.vertical?(Gn=ts(),vs=Gn):Gn=Xi(),Gn&&Gn.placeable)break}else Gn=Xi()},Yo=qt.textAnchorOffsetStartIndex,to=qt.textAnchorOffsetEndIndex;if(to===Yo){const Xi=(ts,Ms)=>{const bn=this.collisionIndex.placeCollisionBox(ts,_e,Q,M,z,Bt,St,C,Ee.predicate,_r);return bn&&bn.placeable&&(this.markUsedOrientation(m,Ms,qt),this.placedOrientations[qt.crossTileID]=Ms),bn};qs(()=>Xi(wl,a.ah.horizontal),()=>{const ts=tr.verticalTextBox;return m.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&ts?Xi(ts,a.ah.vertical):{box:null,offscreen:null}}),$s(Gn&&Gn.placeable)}else{let Xi=a.aq[(on=(Yn=this.prevPlacement)===null||Yn===void 0?void 0:Yn.variableOffsets[qt.crossTileID])===null||on===void 0?void 0:on.anchor];const ts=(bn,Ma,Tl)=>{const Sl=bn.x2-bn.x1,w_=bn.y2-bn.y1,Db=qt.textBoxScale,T_=Gt&&Xe==="never"?Ma:null;let Ko=null,S_=_e==="never"?1:2,$u="never";Xi&&S_++;for(let Nc=0;Nc<S_;Nc++){for(let qu=Yo;qu<to;qu++){const Xu=m.textAnchorOffsets.get(qu);if(Xi&&Xu.textAnchor!==Xi)continue;const Al=this.attemptAnchorPlacement(Xu,bn,Sl,w_,Db,St,Bt,Q,M,z,Ee,$u,qt,m,Tl,C,R,T_,_r);if(Al&&(Ko=Al.placedGlyphBoxes,Ko&&Ko.placeable))return gn=!0,eo=Al.shift,Ko}Xi?Xi=null:$u=_e}return g&&!Ko&&(Ko={box:this.collisionIndex.placeCollisionBox(wl,"always",Q,M,z,Bt,St,C,Ee.predicate,_r,new a.P(0,0)).box,offscreen:!1,placeable:!1}),Ko};qs(()=>ts(wl,tr.iconBox,a.ah.horizontal),()=>{const bn=tr.verticalTextBox;return m.allowVerticalPlacement&&(!Gn||!Gn.placeable)&&qt.numVerticalGlyphVertices>0&&bn?ts(bn,tr.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Gn&&(gn=Gn.placeable,Qi=Gn.offscreen);const Ms=$s(Gn&&Gn.placeable);if(!gn&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[qt.crossTileID];bn&&(this.variableOffsets[qt.crossTileID]=bn,this.markUsedJustification(m,bn.anchor,qt,Ms))}}}if(us=Gn,gn=us&&us.placeable,Qi=us&&us.offscreen,qt.useRuntimeCollisionCircles){const $s=m.text.placedSymbolArray.get(qt.centerJustifiedTextSymbolIndex),qs=a.ai(m.textSizeData,be,$s),Yo=v.get("text-padding");es=this.collisionIndex.placeCollisionCircles(_e,$s,m.lineVertexArray,m.glyphOffsetArray,qs,M,z,W,$,g,Bt,Ee.predicate,qt.collisionCircleDiameter,Yo,C,_r),es.circles.length&&es.collisionDetected&&!g&&a.w("Collisions detected, but collision boxes are not shown"),gn=je||es.circles.length>0&&!es.collisionDetected,Qi=Qi&&es.offscreen}if(tr.iconFeatureIndex&&(Hu=tr.iconFeatureIndex),tr.iconBox){const $s=qs=>this.collisionIndex.placeCollisionBox(qs,Xe,Q,M,z,Bt,St,R,Ee.predicate,_r,Gt&&eo?eo:void 0);vs&&vs.placeable&&tr.verticalIconBox?(hs=$s(tr.verticalIconBox),Kn=hs.placeable):(hs=$s(tr.iconBox),Kn=hs.placeable),Qi=Qi&&hs.offscreen}const Ws=Pe||qt.numHorizontalGlyphVertices===0&&qt.numVerticalGlyphVertices===0,Wu=Fe||qt.numIconVertices===0;Ws||Wu?Wu?Ws||(Kn=Kn&&gn):gn=Kn&&gn:Kn=gn=Kn&&gn;const lf=Kn&&hs.placeable;if(gn&&us.placeable&&this.collisionIndex.insertCollisionBox(us.box,_e,v.get("text-ignore-placement"),m.bucketInstanceId,vs&&vs.placeable&&xl?xl:yo,Ee.ID),lf&&this.collisionIndex.insertCollisionBox(hs.box,Xe,v.get("icon-ignore-placement"),m.bucketInstanceId,Hu,Ee.ID),es&&gn&&this.collisionIndex.insertCollisionCircles(es.circles,_e,v.get("text-ignore-placement"),m.bucketInstanceId,yo,Ee.ID),g&&this.storeCollisionData(m.bucketInstanceId,Kr,tr,us,hs,es),qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qt.crossTileID]=new Wt(gn||$t,Kn||jt,Qi||m.justReloaded),d[qt.crossTileID]=!0};if(nr){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qt=m.getSortedSymbolIndexes(this.transform.angle);for(let tr=qt.length-1;tr>=0;--tr){const Kr=qt[tr];en(m.symbolInstances.get(Kr),m.collisionArrays[Kr],Kr)}}else for(let qt=s.symbolInstanceStart;qt<s.symbolInstanceEnd;qt++)en(m.symbolInstances.get(qt),m.collisionArrays[qt],qt);if(g&&m.bucketInstanceId in this.collisionCircleArrays){const qt=this.collisionCircleArrays[m.bucketInstanceId];a.as(qt.invProjMatrix,M),qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(s,d,g,m,v,C){if(g.textBox||g.iconBox){let R,M;this.collisionBoxArrays.has(s)?R=this.collisionBoxArrays.get(s):(R=new Map,this.collisionBoxArrays.set(s,R)),R.has(d)?M=R.get(d):(M={text:null,icon:null},R.set(d,M)),g.textBox&&(M.text=m.box),g.iconBox&&(M.icon=v.box)}if(C){let R=this.collisionCircleArrays[s];R===void 0&&(R=this.collisionCircleArrays[s]=new Rr);for(let M=0;M<C.circles.length;M+=4)R.circles.push(C.circles[M+0]),R.circles.push(C.circles[M+1]),R.circles.push(C.circles[M+2]),R.circles.push(C.collisionDetected?1:0)}}markUsedJustification(s,d,g,m){let v;v=m===a.ah.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.at(d)];const C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const R of C)R>=0&&(s.text.placedSymbolArray.get(R).crossTileID=v>=0&&R!==v?0:g.crossTileID)}markUsedOrientation(s,d,g){const m=d===a.ah.horizontal||d===a.ah.horizontalOnly?d:0,v=d===a.ah.vertical?d:0,C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const R of C)s.text.placedSymbolArray.get(R).placedOrientation=m;g.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let g=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const m=d?d.symbolFadeChange(s):1,v=d?d.opacities:{},C=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],W=v[M];W?(this.opacities[M]=new Pr(W,m,z.text,z.icon),g=g||z.text!==W.text.placed||z.icon!==W.icon.placed):(this.opacities[M]=new Pr(null,m,z.text,z.icon,z.skipFade),g=g||z.text||z.icon)}for(const M in v){const z=v[M];if(!this.opacities[M]){const W=new Pr(z,m,!1,!1);W.isHidden()||(this.opacities[M]=W,g=g||z.text.placed||z.icon.placed)}}for(const M in C)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=C[M]);for(const M in R)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=R[M]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const g={};for(const m of d){const v=m.getBucket(s);v&&m.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,m.tileID,g,m.collisionBoxArray)}}updateBucketOpacities(s,d,g,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const v=s.layers[0],C=v.layout,R=new Pr(null,0,!1,!1,!0),M=C.get("text-allow-overlap"),z=C.get("icon-allow-overlap"),W=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=C.get("text-rotation-alignment")==="map",Q=C.get("text-pitch-alignment")==="map",ie=C.get("icon-text-fit")!=="none",ce=new Pr(null,0,M&&(z||!s.hasIconData()||C.get("icon-optional")),z&&(M||!s.hasTextData()||C.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const be=(Pe,Fe,_e)=>{for(let je=0;je<Fe/4;je++)Pe.opacityVertexArray.emplaceBack(_e);Pe.hasVisibleVertices=Pe.hasVisibleVertices||_e!==Ps},Ee=this.collisionBoxArrays.get(s.bucketInstanceId);for(let Pe=0;Pe<s.symbolInstances.length;Pe++){const Fe=s.symbolInstances.get(Pe),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:je,crossTileID:Xe}=Fe;let st=this.opacities[Xe];g[Xe]?st=R:st||(st=ce,this.opacities[Xe]=st),g[Xe]=!0;const St=Fe.numIconVertices>0,Bt=this.placedOrientations[Fe.crossTileID],Gt=Bt===a.ah.vertical,nr=Bt===a.ah.horizontal||Bt===a.ah.horizontalOnly;if(_e>0||je>0){const jt=si(st.text);be(s.text,_e,Gt?Ps:jt),be(s.text,je,nr?Ps:jt);const _r=st.text.isHidden();[Fe.rightJustifiedTextSymbolIndex,Fe.centerJustifiedTextSymbolIndex,Fe.leftJustifiedTextSymbolIndex].forEach(tr=>{tr>=0&&(s.text.placedSymbolArray.get(tr).hidden=_r||Gt?1:0)}),Fe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Fe.verticalPlacedTextSymbolIndex).hidden=_r||nr?1:0);const en=this.variableOffsets[Fe.crossTileID];en&&this.markUsedJustification(s,en.anchor,Fe,Bt);const qt=this.placedOrientations[Fe.crossTileID];qt&&(this.markUsedJustification(s,"left",Fe,qt),this.markUsedOrientation(s,qt,Fe))}if(St){const jt=si(st.icon),_r=!(ie&&Fe.verticalPlacedIconSymbolIndex&&Gt);Fe.placedIconSymbolIndex>=0&&(be(s.icon,Fe.numIconVertices,_r?jt:Ps),s.icon.placedSymbolArray.get(Fe.placedIconSymbolIndex).hidden=st.icon.isHidden()),Fe.verticalPlacedIconSymbolIndex>=0&&(be(s.icon,Fe.numVerticalIconVertices,_r?Ps:jt),s.icon.placedSymbolArray.get(Fe.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}const $t=Ee&&Ee.has(Pe)?Ee.get(Pe):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const jt=s.collisionArrays[Pe];if(jt){let _r=new a.P(0,0);if(jt.textBox||jt.verticalTextBox){let en=!0;if(W){const qt=this.variableOffsets[Xe];qt?(_r=hn(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textBoxScale),$&&_r._rotate(Q?this.transform.angle:-this.transform.angle)):en=!1}if(jt.textBox||jt.verticalTextBox){let qt;jt.textBox&&(qt=Gt),jt.verticalTextBox&&(qt=nr),Qr(s.textCollisionBox.collisionVertexArray,st.text.placed,!en||qt,$t.text,_r.x,_r.y)}}if(jt.iconBox||jt.verticalIconBox){const en=!!(!nr&&jt.verticalIconBox);let qt;jt.iconBox&&(qt=en),jt.verticalIconBox&&(qt=!en),Qr(s.iconCollisionBox.collisionVertexArray,st.icon.placed,qt,$t.icon,ie?_r.x:0,ie?_r.y:0)}}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Pe.invProjMatrix,s.placementViewportMatrix=Pe.viewportMatrix,s.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const g=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Qr(b,s,d,g,m,v){g&&g.length!==0||(g=[0,0,0,0]);const C=g[0]-Er,R=g[1]-Er,M=g[2]-Er,z=g[3]-Er;b.emplaceBack(s?1:0,d?1:0,m||0,v||0,C,R),b.emplaceBack(s?1:0,d?1:0,m||0,v||0,M,R),b.emplaceBack(s?1:0,d?1:0,m||0,v||0,M,z),b.emplaceBack(s?1:0,d?1:0,m||0,v||0,C,z)}const qr=Math.pow(2,25),In=Math.pow(2,24),dn=Math.pow(2,17),wn=Math.pow(2,16),Cn=Math.pow(2,9),vi=Math.pow(2,8),Sn=Math.pow(2,1);function si(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const s=b.placed?1:0,d=Math.floor(127*b.opacity);return d*qr+s*In+d*dn+s*wn+d*Cn+s*vi+d*Sn+s}const Ps=0;function zs(){return{isOccluded:(b,s,d)=>!1,getPitchedTextCorrection:(b,s,d)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(b,s,d,g){throw new Error("Not implemented.")},translatePosition:(b,s,d,g)=>function(m,v,C,R,M=!1){if(!C[0]&&!C[1])return[0,0];const z=M?R==="map"?m.angle:0:R==="viewport"?-m.angle:0;if(z){const W=Math.sin(z),$=Math.cos(z);C=[C[0]*$-C[1]*W,C[0]*W+C[1]*$]}return[M?C[0]:gr(v,C[0],m.zoom),M?C[1]:gr(v,C[1],m.zoom)]}(b,s,d,g),getCircleRadiusCorrection:b=>1}}class Ln{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,g,m,v){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(C,m,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((R,M)=>R.sortKey-M.sortKey));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,v())return!0;return!1}}class ki{constructor(s,d,g,m,v,C,R,M){this.placement=new Ur(s,zs(),d,C,R,M),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,d,g){const m=T.now(),v=()=>!this._forceFullPlacement&&T.now()-m>2;for(;this._currentPlacementIndex>=0;){const C=d[s[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Ln(C)),this._inProgressLayer.continuePlacement(g[C.source],this.placement,this._showCollisionBoxes,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ni=512/a.X/2;class Hn{constructor(s,d,g){this.tileID=s,this.bucketInstanceId=g,this._symbolsByKey={};const m=new Map;for(let v=0;v<d.length;v++){const C=d.get(v),R=C.key,M=m.get(R);M?M.push(C):m.set(R,[C])}for(const[v,C]of m){const R={positions:C.map(M=>({x:Math.floor(M.anchorX*Ni),y:Math.floor(M.anchorY*Ni)})),crossTileIDs:C.map(M=>M.crossTileID)};if(R.positions.length>128){const M=new a.av(R.positions.length,16,Uint16Array);for(const{x:z,y:W}of R.positions)M.add(z,W);M.finish(),delete R.positions,R.index=M}this._symbolsByKey[v]=R}}getScaledCoordinates(s,d){const{x:g,y:m,z:v}=this.tileID.canonical,{x:C,y:R,z:M}=d.canonical,z=Ni/Math.pow(2,M-v),W=(R*a.X+s.anchorY)*z,$=m*a.X*Ni;return{x:Math.floor((C*a.X+s.anchorX)*z-g*a.X*Ni),y:Math.floor(W-$)}}findMatches(s,d,g){const m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let v=0;v<s.length;v++){const C=s.get(v);if(C.crossTileID)continue;const R=this._symbolsByKey[C.key];if(!R)continue;const M=this.getScaledCoordinates(C,d);if(R.index){const z=R.index.range(M.x-m,M.y-m,M.x+m,M.y+m).sort();for(const W of z){const $=R.crossTileIDs[W];if(!g[$]){g[$]=!0,C.crossTileID=$;break}}}else if(R.positions)for(let z=0;z<R.positions.length;z++){const W=R.positions[z],$=R.crossTileIDs[z];if(Math.abs(W.x-M.x)<=m&&Math.abs(W.y-M.y)<=m&&!g[$]){g[$]=!0,C.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class cs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(d!==0)for(const g in this.indexes){const m=this.indexes[g],v={};for(const C in m){const R=m[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),v[R.tileID.key]=R}this.indexes[g]=v}this.lng=s}addBucket(s,d,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<d.symbolInstances.length;v++)d.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const m=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const C=this.indexes[v];if(Number(v)>s.overscaledZ)for(const R in C){const M=C[R];M.tileID.isChildOf(s)&&M.findMatches(d.symbolInstances,s,m)}else{const R=C[s.scaledTo(Number(v)).key];R&&R.findMatches(d.symbolInstances,s,m)}}for(let v=0;v<d.symbolInstances.length;v++){const C=d.symbolInstances.get(v);C.crossTileID||(C.crossTileID=g.generate(),m[C.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Hn(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const g of d.getCrossTileIDsLists())for(const m of g)delete this.usedCrossTileIDs[s][m]}removeStaleBuckets(s){let d=!1;for(const g in this.indexes){const m=this.indexes[g];for(const v in m)s[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,m[v]),delete m[v],d=!0)}return d}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new cs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,g){let m=this.layerIndexes[s.id];m===void 0&&(m=this.layerIndexes[s.id]=new Wi);let v=!1;const C={};m.handleWrapJump(g);for(const R of d){const M=R.getBucket(s);M&&s.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(R.tileID,M,this.crossTileIDs)&&(v=!0),C[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(C)&&(v=!0),v}pruneUnusedLayers(s){const d={};s.forEach(g=>{d[g]=!0});for(const g in this.layerIndexes)d[g]||delete this.layerIndexes[g]}}const Fi=(b,s)=>a.t(b,s&&s.filter(d=>d.identifier!=="source.canvas")),$i=a.aw();class Xo extends a.E{constructor(s,d={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const m=this.sourceCaches[g].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[g].reload()}},this.map=s,this.dispatcher=new kr(ur(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,m)=>this.getGlyphs(g,m)),this.dispatcher.registerMessageHandler("GI",(g,m)=>this.getImages(g,m)),this.imageManager=new ze,this.imageManager.setEventedParent(this),this.glyphManager=new Qe(s._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Tt(256,512),this.crossTileSymbolIndex=new ko,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),Zr().on(bt,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const m=this.sourceCaches[g.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const C in this._layers){const R=this._layers[C];R.source===v.id&&this._validateLayer(R)}})}loadURL(s,d={},g){this.fire(new a.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const m=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,d,g)}).catch(C=>{this._loadStyleRequest=null,C&&!v.signal.aborted&&this.fire(new a.j(C))})}loadJSON(s,d={},g){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(s,d,g)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load($i,{validate:!1})}_load(s,d,g){var m;const v=d.transformStyle?d.transformStyle(g,s):s;if(!d.validate||!Fi(this,a.u(v))){this._loaded=!0,this.stylesheet=v;for(const C in v.sources)this.addSource(C,v.sources[C],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Lt(this.stylesheet.light),this.sky=new ar(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const s=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of s){const g=a.aA(d);g.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=g}}_loadSprite(s,d=!1,g=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,C,R,M){return a._(this,void 0,void 0,function*(){const z=Ie(v),W=R>1?"@2x":"",$={},Q={};for(const{id:ie,url:ce}of z){const be=C.transformRequest(Ue(ce,W,".json"),"SpriteJSON");$[ie]=a.h(be,M);const Ee=C.transformRequest(Ue(ce,W,".png"),"SpriteImage");Q[ie]=U.getImage(Ee,M)}return yield Promise.all([...Object.values($),...Object.values(Q)]),function(ie,ce){return a._(this,void 0,void 0,function*(){const be={};for(const Ee in ie){be[Ee]={};const Pe=T.getImageCanvasContext((yield ce[Ee]).data),Fe=(yield ie[Ee]).data;for(const _e in Fe){const{width:je,height:Xe,x:st,y:St,sdf:Bt,pixelRatio:Gt,stretchX:nr,stretchY:$t,content:jt,textFitWidth:_r,textFitHeight:en}=Fe[_e];be[Ee][_e]={data:null,pixelRatio:Gt,sdf:Bt,stretchX:nr,stretchY:$t,content:jt,textFitWidth:_r,textFitHeight:en,spriteData:{width:je,height:Xe,x:st,y:St,context:Pe}}}}return be})}($,Q)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const C in v){this._spritesImagesIds[C]=[];const R=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(M=>!(M in v)):[];for(const M of R)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in v[C]){const z=C==="default"?M:`${C}:${M}`;this._spritesImagesIds[C].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[C][M],!1):this.imageManager.addImage(z,v[C][M]),d&&(this._changedImages[z]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),g&&g(m)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(s){const d=this.sourceCaches[s.source];if(!d)return;const g=s.sourceLayer;if(!g)return;const m=d.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.j(new Error(`Source layer "${g}" does not exist on source "${m.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,d=!1){const g=this._serializedAllLayers();if(!s||s.length===0)return Object.values(d?a.aB(g):g);const m=[];for(const v of s)if(g[v]){const C=d?a.aB(g[v]):g[v];m.push(C)}return m}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const d=Object.keys(this._layers);for(const g of d){const m=this._layers[g];m.type!=="custom"&&(s[g]=m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const d=this._changed;if(d){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const C in this._updatedSources){const R=this._updatedSources[C];if(R==="reload")this._reloadSource(C);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const g={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];g[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in g){const v=this.sourceCaches[m];!!g[m]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(s),this.sky.recalculate(s),this.z=s.zoom,d&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,d={}){var g;this._checkLoaded();const m=this.serialize();if(s=d.transformStyle?d.transformStyle(m,s):s,((g=d.validate)===null||g===void 0||g)&&Fi(this,a.u(s)))return!1;(s=a.aB(s)).layers=a.az(s.layers);const v=a.aC(m,s),C=this._getOperationsToPerform(v);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const R of C.operations)R();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const d=[],g=[];for(const m of s)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":d.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":d.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":d.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":d.push(()=>{});break;default:g.push(m.command)}return{operations:d,unimplemented:g}}addImage(s,d){if(this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,d,g={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.u.source,`sources.${s}`,d,null,g))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const m=this.sourceCaches[s]=new $e(s,d,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:s})),m.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===s)return this.fire(new a.j(new Error(`Source "${s}" cannot be removed while layer "${g}" is using it.`)));const d=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],d.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const g=this.sourceCaches[s].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(d),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,d,g={}){this._checkLoaded();const m=s.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(s.type==="custom"){if(Fi(this,a.aD(s)))return;v=a.aA(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(m,s.source),s=a.aB(s),s=a.e(s,{source:m})),this._validate(a.u.layer,`layers.${m}`,s,{arrayIndex:-1},g))return;v=a.aA(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const C=d?this._order.indexOf(d):this._order.length;if(d&&C===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${d}".`)));else{if(this._order.splice(C,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const R=this._removedLayers[m];delete this._removedLayers[m],R.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const g=this._order.indexOf(s);this._order.splice(g,1);const m=d?this._order.indexOf(d):this._order.length;d&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${s}" before non-existing layer "${d}".`))):(this._order.splice(m,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${s}".`)));d.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,d,g){this._checkLoaded();const m=this.getLayer(s);m?m.minzoom===d&&m.maxzoom===g||(d!=null&&(m.minzoom=d),g!=null&&(m.maxzoom=g),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,d,g={}){this._checkLoaded();const m=this.getLayer(s);if(m){if(!a.aE(m.filter,d))return d==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,d,null,g)||(m.filter=a.aB(d),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.aB(this.getLayer(s).filter)}setLayoutProperty(s,d,g,m={}){this._checkLoaded();const v=this.getLayer(s);v?a.aE(v.getLayoutProperty(d),g)||(v.setLayoutProperty(d,g,m),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,d){const g=this.getLayer(s);if(g)return g.getLayoutProperty(d);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,d,g,m={}){this._checkLoaded();const v=this.getLayer(s);v?a.aE(v.getPaintProperty(d),g)||(v.setPaintProperty(d,g,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const g=s.source,m=s.sourceLayer,v=this.sourceCaches[g];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const C=v.getSource().type;C==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||m?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,s.id,d)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,d){this._checkLoaded();const g=s.source,m=this.sourceCaches[g];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const v=m.getSource().type,C=v==="vector"?s.sourceLayer:void 0;v!=="vector"||C?d&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(C,s.id,d):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const d=s.source,g=s.sourceLayer,m=this.sourceCaches[d];if(m!==void 0)return m.getSource().type!=="vector"||g?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(g,s.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.aF(this.sourceCaches,v=>v.serialize()),d=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:s,layers:d,terrain:g},v=>v!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const d=C=>this._layers[C].type==="fill-extrusion",g={},m=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(d(R)){g[R]=C;for(const M of s){const z=M[R];if(z)for(const W of z)m.push(W)}}}m.sort((C,R)=>R.intersectionZ-C.intersectionZ);const v=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(d(R))for(let M=m.length-1;M>=0;M--){const z=m[M].feature;if(g[z.layer.id]<C)break;v.push(z),m.pop()}else for(const M of s){const z=M[R];if(z)for(const W of z)v.push(W.feature)}}return v}queryRenderedFeatures(s,d,g){d&&d.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",d.filter,null,d);const m={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const M=this._layers[R];if(!M)return this.fire(new a.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const v=[];d.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const R in this.sourceCaches)d.layers&&!m[R]||v.push(Hr(this.sourceCaches[R],this._layers,C,s,d,g));return this.placement&&v.push(function(R,M,z,W,$,Q,ie){const ce={},be=Q.queryRenderedSymbols(W),Ee=[];for(const Pe of Object.keys(be).map(Number))Ee.push(ie[Pe]);Ee.sort(Nr);for(const Pe of Ee){const Fe=Pe.featureIndex.lookupSymbolFeatures(be[Pe.bucketInstanceId],M,Pe.bucketIndex,Pe.sourceLayerIndex,$.filter,$.layers,$.availableImages,R);for(const _e in Fe){const je=ce[_e]=ce[_e]||[],Xe=Fe[_e];Xe.sort((st,St)=>{const Bt=Pe.featureSortOrder;if(Bt){const Gt=Bt.indexOf(st.featureIndex);return Bt.indexOf(St.featureIndex)-Gt}return St.featureIndex-st.featureIndex});for(const st of Xe)je.push(st)}}for(const Pe in ce)ce[Pe].forEach(Fe=>{const _e=Fe.feature,je=z[R[Pe].source].getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=je});return ce}(this._layers,C,this.sourceCaches,s,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,d){d&&d.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",d.filter,null,d);const g=this.sourceCaches[s];return g?function(m,v){const C=m.getRenderableIds().map(z=>m.getTileByID(z)),R=[],M={};for(let z=0;z<C.length;z++){const W=C[z],$=W.tileID.canonical.key;M[$]||(M[$]=!0,W.querySourceFeatures(R,v))}return R}(g,d):[]}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const g=this.light.getLight();let m=!1;for(const C in s)if(!a.aE(s[C],g[C])){m=!0;break}if(!m)return;const v={now:T.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(v)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,d={}){const g=this.getSky();let m=!1;if(!s&&!g)return;if(s&&!g)m=!0;else if(!s&&g)m=!0;else for(const C in s)if(!a.aE(s[C],g[C])){m=!0;break}if(!m)return;const v={now:T.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,d),this.sky.updateTransitions(v)}_validate(s,d,g,m,v={}){return(!v||v.validate!==!1)&&Fi(this,s.call(a.u,a.e({key:d,style:this.serialize(),value:g,styleSpec:a.v},m)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Zr().off(bt,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const g=this.sourceCaches[d];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const d in this.sourceCaches)this.sourceCaches[d].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,d,g,m,v=!1){let C=!1,R=!1;const M={};for(const z of this._order){const W=this._layers[z];if(W.type!=="symbol")continue;if(!M[W.source]){const Q=this.sourceCaches[W.source];M[W.source]=Q.getRenderableIds(!0).map(ie=>Q.getTileByID(ie)).sort((ie,ce)=>ce.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(ce.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(W,M[W.source],s.center.lng);C=C||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),s.zoom))&&(this.pauseablePlacement=new ki(s,this.map.terrain,this._order,v,d,g,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C)for(const z of this._order){const W=this._layers[z];W.type==="symbol"&&this.placement.updateLayerOpacities(W,M[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d){return a._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[d.source];return m&&m.setDependencies(d.tileID.key,d.type,d.icons),g})}getGlyphs(s,d){return a._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(d.stacks),m=this.sourceCaches[d.source];return m&&m.setDependencies(d.tileID.key,d.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,d={}){this._checkLoaded(),s&&this._validate(a.u.glyphs,"glyphs",s,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,d,g={},m){this._checkLoaded();const v=[{id:s,url:d}],C=[...Ie(this.stylesheet.sprite),...v];this._validate(a.u.sprite,"sprite",C,null,g)||(this.stylesheet.sprite=C,this._loadSprite(v,!0,m))}removeSprite(s){this._checkLoaded();const d=Ie(this.stylesheet.sprite);if(d.find(g=>g.id===s)){if(this._spritesImagesIds[s])for(const g of this._spritesImagesIds[s])this.imageManager.removeImage(g),this._changedImages[g]=!0;d.splice(d.findIndex(g=>g.id===s),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Ie(this.stylesheet.sprite)}setSprite(s,d={},g){this._checkLoaded(),s&&this._validate(a.u.sprite,"sprite",s,null,d)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,g):(this._unloadSprite(),g&&g(null)))}}var Us=a.Y([{name:"a_pos",type:"Int16",components:2}]);const ms={prelude:ln(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ln(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ln(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ln(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ln("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ln("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ln("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ln(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ln(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ln(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ln(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ln(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ln(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ln(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ln(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ln(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ln(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ln("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ln("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ln("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ln("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ln(b,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/attribute ([\w]+) ([\w]+)/g),m=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v?v.concat(m):m,R={};return{fragmentSource:b=b.replace(d,(M,z,W,$,Q)=>(R[Q]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
varying ${W} ${$} ${Q};
#else
uniform ${W} ${$} u_${Q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Q}
    ${W} ${$} ${Q} = u_${Q};
#endif
`)),vertexSource:s=s.replace(d,(M,z,W,$,Q)=>{const ie=$==="float"?"vec2":"vec4",ce=Q.match(/color/)?"color":ie;return R[Q]?z==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${W} ${ie} a_${Q};
varying ${W} ${$} ${Q};
#else
uniform ${W} ${$} u_${Q};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${W} ${$} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${ce}(a_${Q}, u_${Q}_t);
#else
    ${W} ${$} ${Q} = u_${Q};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${W} ${ie} a_${Q};
#else
uniform ${W} ${$} u_${Q};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${W} ${$} ${Q} = a_${Q};
#else
    ${W} ${$} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${W} ${$} ${Q} = unpack_mix_${ce}(a_${Q}, u_${Q}_t);
#else
    ${W} ${$} ${Q} = u_${Q};
#endif
`}),staticAttributes:g,staticUniforms:C}}class mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,g,m,v,C,R,M,z){this.context=s;let W=this.boundPaintVertexBuffers.length!==m.length;for(let $=0;!W&&$<m.length;$++)this.boundPaintVertexBuffers[$]!==m[$]&&(W=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==g||W||this.boundIndexBuffer!==v||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(d,g,m,v,C,R,M,z):(s.bindVertexArray.set(this.vao),R&&R.bind(),v&&v.dynamicDraw&&v.bind(),M&&M.bind(),z&&z.bind())}freshBind(s,d,g,m,v,C,R,M){const z=s.numAttributes,W=this.context,$=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=M,d.enableAttributes($,s);for(const Q of g)Q.enableAttributes($,s);C&&C.enableAttributes($,s),R&&R.enableAttributes($,s),M&&M.enableAttributes($,s),d.bind(),d.setVertexAttribPointers($,s,v);for(const Q of g)Q.bind(),Q.setVertexAttribPointers($,s,v);C&&(C.bind(),C.setVertexAttribPointers($,s,v)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers($,s,v)),M&&(M.bind(),M.setVertexAttribPointers($,s,v)),W.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const _c=(b,s,d,g,m)=>({u_matrix:b,u_texture:0,u_ele_delta:s,u_fog_matrix:d,u_fog_color:g?g.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:g?g.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?g.calculateFogBlendOpacity(m):0,u_horizon_color:g?g.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:g?g.properties.get("horizon-fog-blend"):1});function re(b){const s=[];for(let d=0;d<b.length;d++){if(b[d]===null)continue;const g=b[d].split(" ");s.push(g.pop())}return s}class ae{constructor(s,d,g,m,v,C){const R=s.gl;this.program=R.createProgram();const M=re(d.staticAttributes),z=g?g.getBinderAttributes():[],W=M.concat(z),$=ms.prelude.staticUniforms?re(ms.prelude.staticUniforms):[],Q=d.staticUniforms?re(d.staticUniforms):[],ie=g?g.getBinderUniforms():[],ce=$.concat(Q).concat(ie),be=[];for(const st of ce)be.indexOf(st)<0&&be.push(st);const Ee=g?g.defines():[];v&&Ee.push("#define OVERDRAW_INSPECTOR;"),C&&Ee.push("#define TERRAIN3D;");const Pe=Ee.concat(ms.prelude.fragmentSource,d.fragmentSource).join(`
`),Fe=Ee.concat(ms.prelude.vertexSource,d.vertexSource).join(`
`),_e=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(_e,Pe),R.compileShader(_e),!R.getShaderParameter(_e,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(_e)}`);R.attachShader(this.program,_e);const je=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(je,Fe),R.compileShader(je),!R.getShaderParameter(je,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(je)}`);R.attachShader(this.program,je),this.attributes={};const Xe={};this.numAttributes=W.length;for(let st=0;st<this.numAttributes;st++)W[st]&&(R.bindAttribLocation(this.program,st,W[st]),this.attributes[W[st]]=st);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(je),R.deleteShader(_e);for(let st=0;st<be.length;st++){const St=be[st];if(St&&!Xe[St]){const Bt=R.getUniformLocation(this.program,St);Bt&&(Xe[St]=Bt)}}this.fixedUniforms=m(s,Xe),this.terrainUniforms=((st,St)=>({u_depth:new a.aH(st,St.u_depth),u_terrain:new a.aH(st,St.u_terrain),u_terrain_dim:new a.aI(st,St.u_terrain_dim),u_terrain_matrix:new a.aJ(st,St.u_terrain_matrix),u_terrain_unpack:new a.aK(st,St.u_terrain_unpack),u_terrain_exaggeration:new a.aI(st,St.u_terrain_exaggeration)}))(s,Xe),this.binderUniforms=g?g.getUniforms(s,Xe):[]}draw(s,d,g,m,v,C,R,M,z,W,$,Q,ie,ce,be,Ee,Pe,Fe){const _e=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(m),s.setColorMode(v),s.setCullFace(C),M){s.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,M.depthTexture),s.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,M.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(M[Xe])}for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(R[Xe]);be&&be.setUniforms(s,this.binderUniforms,ie,{zoom:ce});let je=0;switch(d){case _e.LINES:je=2;break;case _e.TRIANGLES:je=3;break;case _e.LINE_STRIP:je=1}for(const Xe of Q.get()){const st=Xe.vaos||(Xe.vaos={});(st[z]||(st[z]=new mc)).bind(s,this,W,be?be.getPaintVertexBuffers():[],$,Xe.vertexOffset,Ee,Pe,Fe),_e.drawElements(d,Xe.primitiveLength*je,_e.UNSIGNED_SHORT,Xe.primitiveOffset*je*2)}}}function Me(b,s,d){const g=1/gr(d,1,s.transform.tileZoom),m=Math.pow(2,d.tileID.overscaledZ),v=d.tileSize*Math.pow(2,s.transform.tileZoom)/m,C=v*(d.tileID.canonical.x+d.tileID.wrap*m),R=v*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[g,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[C>>16,R>>16],u_pixel_coord_lower:[65535&C,65535&R]}}const ht=(b,s,d,g)=>{const m=s.style.light,v=m.properties.get("position"),C=[v.x,v.y,v.z],R=function(){var z=new a.A(9);return a.A!=Float32Array&&(z[1]=0,z[2]=0,z[3]=0,z[5]=0,z[6]=0,z[7]=0),z[0]=1,z[4]=1,z[8]=1,z}();m.properties.get("anchor")==="viewport"&&function(z,W){var $=Math.sin(W),Q=Math.cos(W);z[0]=Q,z[1]=$,z[2]=0,z[3]=-$,z[4]=Q,z[5]=0,z[6]=0,z[7]=0,z[8]=1}(R,-s.transform.angle),function(z,W,$){var Q=W[0],ie=W[1],ce=W[2];z[0]=Q*$[0]+ie*$[3]+ce*$[6],z[1]=Q*$[1]+ie*$[4]+ce*$[7],z[2]=Q*$[2]+ie*$[5]+ce*$[8]}(C,C,R);const M=m.properties.get("color");return{u_matrix:b,u_lightpos:C,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+d,u_opacity:g}},Ft=(b,s,d,g,m,v,C)=>a.e(ht(b,s,d,g),Me(v,s,C),{u_height_factor:-Math.pow(2,m.overscaledZ)/C.tileSize/8}),hr=b=>({u_matrix:b}),fn=(b,s,d,g)=>a.e(hr(b),Me(d,s,g)),Si=(b,s)=>({u_matrix:b,u_world:s}),Ai=(b,s,d,g,m)=>a.e(fn(b,s,d,g),{u_world:m}),qi=(b,s,d,g)=>{const m=b.transform;let v,C;if(g.paint.get("circle-pitch-alignment")==="map"){const R=gr(d,1,m.zoom);v=!0,C=[R,R]}else v=!1,C=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(s.posMatrix,d,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:C}},Bi=(b,s,d)=>({u_matrix:b,u_inv_matrix:s,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}),yc=(b,s,d=1)=>({u_matrix:b,u_color:s,u_overlay:0,u_overlay_scale:d}),_s=b=>({u_matrix:b}),ys=(b,s,d,g)=>({u_matrix:b,u_extrude_scale:gr(s,1,d),u_intensity:g}),mu=(b,s,d,g)=>{const m=a.H();a.aP(m,0,b.width,b.height,0,0,1);const v=b.context.gl;return{u_matrix:m,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:d,u_color_ramp:g,u_opacity:s.paint.get("heatmap-opacity")}};function _u(b,s){const d=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new a.Z(0,g/d).toLngLat().lat,new a.Z(0,(g+1)/d).toLngLat().lat]}const yu=(b,s,d,g)=>{const m=b.transform;return{u_matrix:Xm(b,s,d,g),u_ratio:1/gr(s,1,m.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},$m=(b,s,d,g,m)=>a.e(yu(b,s,d,m),{u_image:0,u_image_height:g}),il=(b,s,d,g,m)=>{const v=b.transform,C=qm(s,v);return{u_matrix:Xm(b,s,d,m),u_texsize:s.imageAtlasTexture.size,u_ratio:1/gr(s,1,v.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},db=(b,s,d,g,m,v)=>{const C=b.lineAtlas,R=qm(s,b.transform),M=d.layout.get("line-cap")==="round",z=C.getDash(g.from,M),W=C.getDash(g.to,M),$=z.width*m.fromScale,Q=W.width*m.toScale;return a.e(yu(b,s,d,v),{u_patternscale_a:[R/$,-z.height/2],u_patternscale_b:[R/Q,-W.height/2],u_sdfgamma:C.width/(256*Math.min($,Q)*b.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:W.y,u_mix:m.t})};function qm(b,s){return 1/gr(b,1,s.tileZoom)}function Xm(b,s,d,g){return b.translatePosMatrix(g?g.posMatrix:s.tileID.posMatrix,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const fb=(b,s,d,g,m)=>{return{u_matrix:b,u_tl_parent:s,u_scale_parent:d,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(C=m.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:pb(m.paint.get("raster-hue-rotate"))};var v,C};function pb(b){b*=Math.PI/180;const s=Math.sin(b),d=Math.cos(b);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const Zm=(b,s,d,g,m,v,C,R,M,z,W,$,Q,ie)=>{const ce=C.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ce.width/ce.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:R,u_label_plane_matrix:M,u_coord_matrix:z,u_is_text:+$,u_pitch_with_map:+g,u_is_along_line:m,u_is_variable_anchor:v,u_texsize:Q,u_texture:0,u_translation:W,u_pitched_scale:ie}},vc=(b,s,d,g,m,v,C,R,M,z,W,$,Q,ie,ce)=>{const be=C.transform;return a.e(Zm(b,s,d,g,m,v,C,R,M,z,W,$,Q,ce),{u_gamma_scale:g?Math.cos(be._pitch)*be.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Sd=(b,s,d,g,m,v,C,R,M,z,W,$,Q,ie)=>a.e(vc(b,s,d,g,m,v,C,R,M,z,W,!0,$,!0,ie),{u_texsize_icon:Q,u_texture_icon:1}),vu=(b,s,d)=>({u_matrix:b,u_opacity:s,u_color:d}),Ad=(b,s,d,g,m,v)=>a.e(function(C,R,M,z){const W=M.imageManager.getPattern(C.from.toString()),$=M.imageManager.getPattern(C.to.toString()),{width:Q,height:ie}=M.imageManager.getPixelSize(),ce=Math.pow(2,z.tileID.overscaledZ),be=z.tileSize*Math.pow(2,M.transform.tileZoom)/ce,Ee=be*(z.tileID.canonical.x+z.tileID.wrap*ce),Pe=be*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:W.tl,u_pattern_br_a:W.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[Q,ie],u_mix:R.t,u_pattern_size_a:W.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/gr(z,1,M.transform.tileZoom),u_pixel_coord_upper:[Ee>>16,Pe>>16],u_pixel_coord_lower:[65535&Ee,65535&Pe]}}(g,v,d,m),{u_matrix:b,u_opacity:s}),Ed={fillExtrusion:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_lightpos:new a.aN(b,s.u_lightpos),u_lightintensity:new a.aI(b,s.u_lightintensity),u_lightcolor:new a.aN(b,s.u_lightcolor),u_vertical_gradient:new a.aI(b,s.u_vertical_gradient),u_opacity:new a.aI(b,s.u_opacity)}),fillExtrusionPattern:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_lightpos:new a.aN(b,s.u_lightpos),u_lightintensity:new a.aI(b,s.u_lightintensity),u_lightcolor:new a.aN(b,s.u_lightcolor),u_vertical_gradient:new a.aI(b,s.u_vertical_gradient),u_height_factor:new a.aI(b,s.u_height_factor),u_image:new a.aH(b,s.u_image),u_texsize:new a.aO(b,s.u_texsize),u_pixel_coord_upper:new a.aO(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,s.u_pixel_coord_lower),u_scale:new a.aN(b,s.u_scale),u_fade:new a.aI(b,s.u_fade),u_opacity:new a.aI(b,s.u_opacity)}),fill:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix)}),fillPattern:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_image:new a.aH(b,s.u_image),u_texsize:new a.aO(b,s.u_texsize),u_pixel_coord_upper:new a.aO(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,s.u_pixel_coord_lower),u_scale:new a.aN(b,s.u_scale),u_fade:new a.aI(b,s.u_fade)}),fillOutline:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_world:new a.aO(b,s.u_world)}),fillOutlinePattern:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_world:new a.aO(b,s.u_world),u_image:new a.aH(b,s.u_image),u_texsize:new a.aO(b,s.u_texsize),u_pixel_coord_upper:new a.aO(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,s.u_pixel_coord_lower),u_scale:new a.aN(b,s.u_scale),u_fade:new a.aI(b,s.u_fade)}),circle:(b,s)=>({u_camera_to_center_distance:new a.aI(b,s.u_camera_to_center_distance),u_scale_with_map:new a.aH(b,s.u_scale_with_map),u_pitch_with_map:new a.aH(b,s.u_pitch_with_map),u_extrude_scale:new a.aO(b,s.u_extrude_scale),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_matrix:new a.aJ(b,s.u_matrix)}),collisionBox:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_pixel_extrude_scale:new a.aO(b,s.u_pixel_extrude_scale)}),collisionCircle:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_inv_matrix:new a.aJ(b,s.u_inv_matrix),u_camera_to_center_distance:new a.aI(b,s.u_camera_to_center_distance),u_viewport_size:new a.aO(b,s.u_viewport_size)}),debug:(b,s)=>({u_color:new a.aL(b,s.u_color),u_matrix:new a.aJ(b,s.u_matrix),u_overlay:new a.aH(b,s.u_overlay),u_overlay_scale:new a.aI(b,s.u_overlay_scale)}),clippingMask:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix)}),heatmap:(b,s)=>({u_extrude_scale:new a.aI(b,s.u_extrude_scale),u_intensity:new a.aI(b,s.u_intensity),u_matrix:new a.aJ(b,s.u_matrix)}),heatmapTexture:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_world:new a.aO(b,s.u_world),u_image:new a.aH(b,s.u_image),u_color_ramp:new a.aH(b,s.u_color_ramp),u_opacity:new a.aI(b,s.u_opacity)}),hillshade:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_image:new a.aH(b,s.u_image),u_latrange:new a.aO(b,s.u_latrange),u_light:new a.aO(b,s.u_light),u_shadow:new a.aL(b,s.u_shadow),u_highlight:new a.aL(b,s.u_highlight),u_accent:new a.aL(b,s.u_accent)}),hillshadePrepare:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_image:new a.aH(b,s.u_image),u_dimension:new a.aO(b,s.u_dimension),u_zoom:new a.aI(b,s.u_zoom),u_unpack:new a.aK(b,s.u_unpack)}),line:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_ratio:new a.aI(b,s.u_ratio),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,s.u_units_to_pixels)}),lineGradient:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_ratio:new a.aI(b,s.u_ratio),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,s.u_units_to_pixels),u_image:new a.aH(b,s.u_image),u_image_height:new a.aI(b,s.u_image_height)}),linePattern:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_texsize:new a.aO(b,s.u_texsize),u_ratio:new a.aI(b,s.u_ratio),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_image:new a.aH(b,s.u_image),u_units_to_pixels:new a.aO(b,s.u_units_to_pixels),u_scale:new a.aN(b,s.u_scale),u_fade:new a.aI(b,s.u_fade)}),lineSDF:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_ratio:new a.aI(b,s.u_ratio),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(b,s.u_units_to_pixels),u_patternscale_a:new a.aO(b,s.u_patternscale_a),u_patternscale_b:new a.aO(b,s.u_patternscale_b),u_sdfgamma:new a.aI(b,s.u_sdfgamma),u_image:new a.aH(b,s.u_image),u_tex_y_a:new a.aI(b,s.u_tex_y_a),u_tex_y_b:new a.aI(b,s.u_tex_y_b),u_mix:new a.aI(b,s.u_mix)}),raster:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_tl_parent:new a.aO(b,s.u_tl_parent),u_scale_parent:new a.aI(b,s.u_scale_parent),u_buffer_scale:new a.aI(b,s.u_buffer_scale),u_fade_t:new a.aI(b,s.u_fade_t),u_opacity:new a.aI(b,s.u_opacity),u_image0:new a.aH(b,s.u_image0),u_image1:new a.aH(b,s.u_image1),u_brightness_low:new a.aI(b,s.u_brightness_low),u_brightness_high:new a.aI(b,s.u_brightness_high),u_saturation_factor:new a.aI(b,s.u_saturation_factor),u_contrast_factor:new a.aI(b,s.u_contrast_factor),u_spin_weights:new a.aN(b,s.u_spin_weights)}),symbolIcon:(b,s)=>({u_is_size_zoom_constant:new a.aH(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,s.u_is_size_feature_constant),u_size_t:new a.aI(b,s.u_size_t),u_size:new a.aI(b,s.u_size),u_camera_to_center_distance:new a.aI(b,s.u_camera_to_center_distance),u_pitch:new a.aI(b,s.u_pitch),u_rotate_symbol:new a.aH(b,s.u_rotate_symbol),u_aspect_ratio:new a.aI(b,s.u_aspect_ratio),u_fade_change:new a.aI(b,s.u_fade_change),u_matrix:new a.aJ(b,s.u_matrix),u_label_plane_matrix:new a.aJ(b,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,s.u_coord_matrix),u_is_text:new a.aH(b,s.u_is_text),u_pitch_with_map:new a.aH(b,s.u_pitch_with_map),u_is_along_line:new a.aH(b,s.u_is_along_line),u_is_variable_anchor:new a.aH(b,s.u_is_variable_anchor),u_texsize:new a.aO(b,s.u_texsize),u_texture:new a.aH(b,s.u_texture),u_translation:new a.aO(b,s.u_translation),u_pitched_scale:new a.aI(b,s.u_pitched_scale)}),symbolSDF:(b,s)=>({u_is_size_zoom_constant:new a.aH(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,s.u_is_size_feature_constant),u_size_t:new a.aI(b,s.u_size_t),u_size:new a.aI(b,s.u_size),u_camera_to_center_distance:new a.aI(b,s.u_camera_to_center_distance),u_pitch:new a.aI(b,s.u_pitch),u_rotate_symbol:new a.aH(b,s.u_rotate_symbol),u_aspect_ratio:new a.aI(b,s.u_aspect_ratio),u_fade_change:new a.aI(b,s.u_fade_change),u_matrix:new a.aJ(b,s.u_matrix),u_label_plane_matrix:new a.aJ(b,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,s.u_coord_matrix),u_is_text:new a.aH(b,s.u_is_text),u_pitch_with_map:new a.aH(b,s.u_pitch_with_map),u_is_along_line:new a.aH(b,s.u_is_along_line),u_is_variable_anchor:new a.aH(b,s.u_is_variable_anchor),u_texsize:new a.aO(b,s.u_texsize),u_texture:new a.aH(b,s.u_texture),u_gamma_scale:new a.aI(b,s.u_gamma_scale),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_is_halo:new a.aH(b,s.u_is_halo),u_translation:new a.aO(b,s.u_translation),u_pitched_scale:new a.aI(b,s.u_pitched_scale)}),symbolTextAndIcon:(b,s)=>({u_is_size_zoom_constant:new a.aH(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(b,s.u_is_size_feature_constant),u_size_t:new a.aI(b,s.u_size_t),u_size:new a.aI(b,s.u_size),u_camera_to_center_distance:new a.aI(b,s.u_camera_to_center_distance),u_pitch:new a.aI(b,s.u_pitch),u_rotate_symbol:new a.aH(b,s.u_rotate_symbol),u_aspect_ratio:new a.aI(b,s.u_aspect_ratio),u_fade_change:new a.aI(b,s.u_fade_change),u_matrix:new a.aJ(b,s.u_matrix),u_label_plane_matrix:new a.aJ(b,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(b,s.u_coord_matrix),u_is_text:new a.aH(b,s.u_is_text),u_pitch_with_map:new a.aH(b,s.u_pitch_with_map),u_is_along_line:new a.aH(b,s.u_is_along_line),u_is_variable_anchor:new a.aH(b,s.u_is_variable_anchor),u_texsize:new a.aO(b,s.u_texsize),u_texsize_icon:new a.aO(b,s.u_texsize_icon),u_texture:new a.aH(b,s.u_texture),u_texture_icon:new a.aH(b,s.u_texture_icon),u_gamma_scale:new a.aI(b,s.u_gamma_scale),u_device_pixel_ratio:new a.aI(b,s.u_device_pixel_ratio),u_is_halo:new a.aH(b,s.u_is_halo),u_translation:new a.aO(b,s.u_translation),u_pitched_scale:new a.aI(b,s.u_pitched_scale)}),background:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_opacity:new a.aI(b,s.u_opacity),u_color:new a.aL(b,s.u_color)}),backgroundPattern:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_opacity:new a.aI(b,s.u_opacity),u_image:new a.aH(b,s.u_image),u_pattern_tl_a:new a.aO(b,s.u_pattern_tl_a),u_pattern_br_a:new a.aO(b,s.u_pattern_br_a),u_pattern_tl_b:new a.aO(b,s.u_pattern_tl_b),u_pattern_br_b:new a.aO(b,s.u_pattern_br_b),u_texsize:new a.aO(b,s.u_texsize),u_mix:new a.aI(b,s.u_mix),u_pattern_size_a:new a.aO(b,s.u_pattern_size_a),u_pattern_size_b:new a.aO(b,s.u_pattern_size_b),u_scale_a:new a.aI(b,s.u_scale_a),u_scale_b:new a.aI(b,s.u_scale_b),u_pixel_coord_upper:new a.aO(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(b,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(b,s.u_tile_units_to_pixels)}),terrain:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_texture:new a.aH(b,s.u_texture),u_ele_delta:new a.aI(b,s.u_ele_delta),u_fog_matrix:new a.aJ(b,s.u_fog_matrix),u_fog_color:new a.aL(b,s.u_fog_color),u_fog_ground_blend:new a.aI(b,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(b,s.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(b,s.u_horizon_color),u_horizon_fog_blend:new a.aI(b,s.u_horizon_fog_blend)}),terrainDepth:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_ele_delta:new a.aI(b,s.u_ele_delta)}),terrainCoords:(b,s)=>({u_matrix:new a.aJ(b,s.u_matrix),u_texture:new a.aH(b,s.u_texture),u_terrain_coords_id:new a.aI(b,s.u_terrain_coords_id),u_ele_delta:new a.aI(b,s.u_ele_delta)}),sky:(b,s)=>({u_sky_color:new a.aL(b,s.u_sky_color),u_horizon_color:new a.aL(b,s.u_horizon_color),u_horizon:new a.aI(b,s.u_horizon),u_sky_horizon_blend:new a.aI(b,s.u_sky_horizon_blend)})};class go{constructor(s,d,g){this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gb={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Id{constructor(s,d,g,m){this.length=d.length,this.attributes=g,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let g=0;g<this.attributes.length;g++){const m=d.attributes[this.attributes[g].name];m!==void 0&&s.enableVertexAttribArray(m)}}setVertexAttribPointers(s,d,g){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],C=d.attributes[v.name];C!==void 0&&s.vertexAttribPointer(C,v.components,s[gb[v.type]],!1,this.itemSize,v.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ta=new WeakMap;function Zo(b){var s;if(Ta.has(b))return Ta.get(b);{const d=(s=b.getParameter(b.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Ta.set(b,d),d}}class Pn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bu extends Pn{getDefault(){return a.aM.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class mb extends Pn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class sl extends Pn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class _b extends Pn{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ym extends Pn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class yb extends Pn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Km extends Pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Cd extends Pn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Gm extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class Jm extends Pn{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qm extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class e_ extends Pn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Sa extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class t_ extends Pn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class vb extends Pn{getDefault(){return a.aM.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class r_ extends Pn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class bc extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class bb extends Pn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class xu extends Pn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class xb extends Pn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class wb extends Pn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class n_ extends Pn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class i_ extends Pn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class s_ extends Pn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Pd extends Pn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class o_ extends Pn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class wu extends Pn{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Mo extends Pn{getDefault(){return null}set(s){var d;if(s===this.current&&!this.dirty)return;const g=this.gl;Zo(g)?g.bindVertexArray(s):(d=g.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Rd extends Pn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class kd extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Md extends Pn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Tu extends Pn{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class Od extends Tu{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Aa extends Tu{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Dd extends Tu{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Tb{constructor(s,d,g,m,v){this.context=s,this.width=d,this.height=g;const C=s.gl,R=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Od(s,R),m)this.depthAttachment=v?new Dd(s,R):new Aa(s,R);else if(v)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class pi{constructor(s,d,g){this.blendFunction=s,this.blendColor=d,this.mask=g}}pi.Replace=[1,0],pi.disabled=new pi(pi.Replace,a.aM.transparent,[!1,!1,!1,!1]),pi.unblended=new pi(pi.Replace,a.aM.transparent,[!0,!0,!0,!0]),pi.alphaBlended=new pi([1,771],a.aM.transparent,[!0,!0,!0,!0]);class Sb{constructor(s){var d,g;if(this.gl=s,this.clearColor=new bu(this),this.clearDepth=new mb(this),this.clearStencil=new sl(this),this.colorMask=new _b(this),this.depthMask=new Ym(this),this.stencilMask=new yb(this),this.stencilFunc=new Km(this),this.stencilOp=new Cd(this),this.stencilTest=new Gm(this),this.depthRange=new Jm(this),this.depthTest=new Qm(this),this.depthFunc=new e_(this),this.blend=new Sa(this),this.blendFunc=new t_(this),this.blendColor=new vb(this),this.blendEquation=new r_(this),this.cullFace=new bc(this),this.cullFaceSide=new bb(this),this.frontFace=new xu(this),this.program=new xb(this),this.activeTexture=new wb(this),this.viewport=new n_(this),this.bindFramebuffer=new i_(this),this.bindRenderbuffer=new s_(this),this.bindTexture=new Pd(this),this.bindVertexBuffer=new o_(this),this.bindElementBuffer=new wu(this),this.bindVertexArray=new Mo(this),this.pixelStoreUnpack=new Rd(this),this.pixelStoreUnpackPremultiplyAlpha=new kd(this),this.pixelStoreUnpackFlipY=new Md(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Zo(s)){this.HALF_FLOAT=s.HALF_FLOAT;const m=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=s.RGBA16F)!==null&&d!==void 0?d:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(g=s.RGB16F)!==null&&g!==void 0?g:m==null?void 0:m.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const m=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new go(this,s,d)}createVertexBuffer(s,d,g){return new Id(this,s,d,g)}createRenderbuffer(s,d,g){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,s,d,g),this.bindRenderbuffer.set(null),v}createFramebuffer(s,d,g,m){return new Tb(this,s,d,g,m)}clear({color:s,depth:d,stencil:g}){const m=this.gl;let v=0;s&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),m.clear(v)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.aE(s.blendFunction,pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Zo(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var d;return Zo(this.gl)?this.gl.deleteVertexArray(s):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class un{constructor(s,d,g){this.func=s,this.mask=d,this.range=g}}un.ReadOnly=!1,un.ReadWrite=!0,un.disabled=new un(519,un.ReadOnly,[0,1]);const Su=7680;class Wn{constructor(s,d,g,m,v,C){this.test=s,this.ref=d,this.mask=g,this.fail=m,this.depthFail=v,this.pass=C}}Wn.disabled=new Wn({func:519,mask:0},0,0,Su,Su,Su);class Mn{constructor(s,d,g){this.enable=s,this.mode=d,this.frontFace=g}}let Ea;function xc(b,s,d,g,m){const v=b.context,C=v.gl,R=b.useProgram("collisionBox"),M=[];let z=0,W=0;for(let Pe=0;Pe<g.length;Pe++){const Fe=g[Pe],_e=s.getTile(Fe).getBucket(d);if(!_e)continue;const je=m?_e.textCollisionBox:_e.iconCollisionBox,Xe=_e.collisionCircleArray;if(Xe.length>0){const st=a.H();a.aQ(st,_e.placementInvProjMatrix,b.transform.glCoordMatrix),a.aQ(st,st,_e.placementViewportMatrix),M.push({circleArray:Xe,circleOffset:W,transform:Fe.posMatrix,invTransform:st,coord:Fe}),z+=Xe.length/4,W=z}je&&R.draw(v,C.LINES,un.disabled,Wn.disabled,b.colorModeForRenderPass(),Mn.disabled,{u_matrix:Fe.posMatrix,u_pixel_extrude_scale:[1/($=b.transform).width,1/$.height]},b.style.map.terrain&&b.style.map.terrain.getTerrainData(Fe),d.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,b.transform.zoom,null,null,je.collisionVertexBuffer)}var $;if(!m||!M.length)return;const Q=b.useProgram("collisionCircle"),ie=new a.aR;ie.resize(4*z),ie._trim();let ce=0;for(const Pe of M)for(let Fe=0;Fe<Pe.circleArray.length/4;Fe++){const _e=4*Fe,je=Pe.circleArray[_e+0],Xe=Pe.circleArray[_e+1],st=Pe.circleArray[_e+2],St=Pe.circleArray[_e+3];ie.emplace(ce++,je,Xe,st,St,0),ie.emplace(ce++,je,Xe,st,St,1),ie.emplace(ce++,je,Xe,st,St,2),ie.emplace(ce++,je,Xe,st,St,3)}(!Ea||Ea.length<2*z)&&(Ea=function(Pe){const Fe=2*Pe,_e=new a.aT;_e.resize(Fe),_e._trim();for(let je=0;je<Fe;je++){const Xe=6*je;_e.uint16[Xe+0]=4*je+0,_e.uint16[Xe+1]=4*je+1,_e.uint16[Xe+2]=4*je+2,_e.uint16[Xe+3]=4*je+2,_e.uint16[Xe+4]=4*je+3,_e.uint16[Xe+5]=4*je+0}return _e}(z));const be=v.createIndexBuffer(Ea,!0),Ee=v.createVertexBuffer(ie,a.aS.members,!0);for(const Pe of M){const Fe=Bi(Pe.transform,Pe.invTransform,b.transform);Q.draw(v,C.TRIANGLES,un.disabled,Wn.disabled,b.colorModeForRenderPass(),Mn.disabled,Fe,b.style.map.terrain&&b.style.map.terrain.getTerrainData(Pe.coord),d.id,Ee,be,a.a0.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,b.transform.zoom,null,null,null)}Ee.destroy(),be.destroy()}Mn.disabled=new Mn(!1,1029,2305),Mn.backCCW=new Mn(!0,1029,2305);const wc=a.an(new Float32Array(16));function Nd(b,s,d,g,m,v){const{horizontalAlign:C,verticalAlign:R}=a.au(b);return new a.P((-(C-.5)*s/m+g[0])*v,(-(R-.5)*d/m+g[1])*v)}function Ia(b,s,d,g,m,v){const C=s.tileAnchorPoint.add(new a.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let R=g.mult(v);d||(R=R.rotate(-m));const M=C.add(R);return de(M.x,M.y,s.labelPlaneMatrix,s.getElevation).point}if(d){const R=We(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(b),M=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return b.add(g.rotate(M))}return b.add(g)}function ol(b,s,d,g,m,v,C,R,M,z,W,$,Q,ie){const ce=b.text.placedSymbolArray,be=b.text.dynamicLayoutVertexArray,Ee=b.icon.dynamicLayoutVertexArray,Pe={};be.clear();for(let Fe=0;Fe<ce.length;Fe++){const _e=ce.get(Fe),je=_e.hidden||!_e.crossTileID||b.allowVerticalPlacement&&!_e.placedOrientation?null:g[_e.crossTileID];if(je){const Xe=new a.P(_e.anchorX,_e.anchorY),st={getElevation:ie,width:m.width,height:m.height,labelPlaneMatrix:v,pitchWithMap:d,projection:W,tileAnchorPoint:Xe,translation:$,unwrappedTileID:Q},St=d?de(Xe.x,Xe.y,C,ie):We(Xe.x,Xe.y,st),Bt=X(m.cameraToCenterDistance,St.signedDistanceFromCamera);let Gt=a.ai(b.textSizeData,M,_e)*Bt/a.ap;d&&(Gt*=b.tilePixelRatio/R);const{width:nr,height:$t,anchor:jt,textOffset:_r,textBoxScale:en}=je,qt=Nd(jt,nr,$t,_r,en,Gt),tr=W.getPitchedTextCorrection(m,Xe.add(new a.P($[0],$[1])),Q),Kr=Ia(St.point,st,s,qt,m.angle,tr),Yn=b.allowVerticalPlacement&&_e.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let on=0;on<_e.numGlyphs;on++)a.aj(be,Kr,Yn);z&&_e.associatedIconIndex>=0&&(Pe[_e.associatedIconIndex]={shiftedAnchor:Kr,angle:Yn})}else Kt(_e.numGlyphs,be)}if(z){Ee.clear();const Fe=b.icon.placedSymbolArray;for(let _e=0;_e<Fe.length;_e++){const je=Fe.get(_e);if(je.hidden)Kt(je.numGlyphs,Ee);else{const Xe=Pe[_e];if(Xe)for(let st=0;st<je.numGlyphs;st++)a.aj(Ee,Xe.shiftedAnchor,Xe.angle);else Kt(je.numGlyphs,Ee)}}b.icon.dynamicLayoutVertexBuffer.updateData(Ee)}b.text.dynamicLayoutVertexBuffer.updateData(be)}function Vs(b,s,d){return d.iconsInText&&s?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Fd(b,s,d,g,m,v,C,R,M,z,W,$){const Q=b.context,ie=Q.gl,ce=b.transform,be=zs(),Ee=R==="map",Pe=M==="map",Fe=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",_e=Ee&&!Pe&&!Fe,je=!Pe&&Fe,Xe=!d.layout.get("symbol-sort-key").isConstant();let st=!1;const St=b.depthModeForSublayer(0,un.ReadOnly),Bt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Gt=[],nr=be.getCircleRadiusCorrection(ce);for(const $t of g){const jt=s.getTile($t),_r=jt.getBucket(d);if(!_r)continue;const en=m?_r.text:_r.icon;if(!en||!en.segments.get().length||!en.hasVisibleVertices)continue;const qt=en.programConfigurations.get(d.id),tr=m||_r.sdfIcons,Kr=m?_r.textSizeData:_r.iconSizeData,Yn=Pe||ce.pitch!==0,on=b.useProgram(Vs(tr,m,_r),qt),gn=a.ag(Kr,ce.zoom),Kn=b.style.map.terrain&&b.style.map.terrain.getTerrainData($t);let Qi,eo,Gn,vs,us=[0,0],es=null;if(m)eo=jt.glyphAtlasTexture,Gn=ie.LINEAR,Qi=jt.glyphAtlasTexture.size,_r.iconsInText&&(us=jt.imageAtlasTexture.size,es=jt.imageAtlasTexture,vs=Yn||b.options.rotating||b.options.zooming||Kr.kind==="composite"||Kr.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const bn=d.layout.get("icon-size").constantOr(0)!==1||_r.iconsNeedLinear;eo=jt.imageAtlasTexture,Gn=tr||b.options.rotating||b.options.zooming||bn||Yn?ie.LINEAR:ie.NEAREST,Qi=jt.imageAtlasTexture.size}const hs=gr(jt,1,b.transform.zoom),yo=je?$t.posMatrix:wc,xl=tn(yo,Pe,Ee,b.transform,hs),Hu=pn(yo,Pe,Ee,b.transform,hs),wl=pn($t.posMatrix,Pe,Ee,b.transform,hs),Ws=be.translatePosition(b.transform,jt,v,C),Wu=Bt&&_r.hasTextData(),lf=d.layout.get("icon-text-fit")!=="none"&&Wu&&_r.hasIconData();if(Fe){const bn=b.style.map.terrain?(Tl,Sl)=>b.style.map.terrain.getElevation($t,Tl,Sl):null,Ma=d.layout.get("text-rotation-alignment")==="map";te(_r,$t.posMatrix,b,m,xl,wl,Pe,z,Ma,be,$t.toUnwrapped(),ce.width,ce.height,Ws,bn)}const $s=$t.posMatrix,qs=m&&Bt||lf,Yo=Fe||qs?wc:xl,to=Hu,Xi=tr&&d.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ts;ts=tr?_r.iconsInText?Sd(Kr.kind,gn,_e,Pe,Fe,qs,b,$s,Yo,to,Ws,Qi,us,nr):vc(Kr.kind,gn,_e,Pe,Fe,qs,b,$s,Yo,to,Ws,m,Qi,!0,nr):Zm(Kr.kind,gn,_e,Pe,Fe,qs,b,$s,Yo,to,Ws,m,Qi,nr);const Ms={program:on,buffers:en,uniformValues:ts,atlasTexture:eo,atlasTextureIcon:es,atlasInterpolation:Gn,atlasInterpolationIcon:vs,isSDF:tr,hasHalo:Xi};if(Xe&&_r.canOverlap){st=!0;const bn=en.segments.get();for(const Ma of bn)Gt.push({segments:new a.a0([Ma]),sortKey:Ma.sortKey,state:Ms,terrainData:Kn})}else Gt.push({segments:en.segments,sortKey:0,state:Ms,terrainData:Kn})}st&&Gt.sort(($t,jt)=>$t.sortKey-jt.sortKey);for(const $t of Gt){const jt=$t.state;if(Q.activeTexture.set(ie.TEXTURE0),jt.atlasTexture.bind(jt.atlasInterpolation,ie.CLAMP_TO_EDGE),jt.atlasTextureIcon&&(Q.activeTexture.set(ie.TEXTURE1),jt.atlasTextureIcon&&jt.atlasTextureIcon.bind(jt.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),jt.isSDF){const _r=jt.uniformValues;jt.hasHalo&&(_r.u_is_halo=1,Bd(jt.buffers,$t.segments,d,b,jt.program,St,W,$,_r,$t.terrainData)),_r.u_is_halo=0}Bd(jt.buffers,$t.segments,d,b,jt.program,St,W,$,jt.uniformValues,$t.terrainData)}}function Bd(b,s,d,g,m,v,C,R,M,z){const W=g.context;m.draw(W,W.gl.TRIANGLES,v,C,R,Mn.disabled,M,z,d.id,b.layoutVertexBuffer,b.indexBuffer,s,d.paint,g.transform.zoom,b.programConfigurations.get(d.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Ld(b,s,d,g){const m=b.context,v=m.gl,C=Wn.disabled,R=new pi([v.ONE,v.ONE],a.aM.transparent,[!0,!0,!0,!0]),M=s.getBucket(d);if(!M)return;const z=g.key;let W=d.heatmapFbos.get(z);W||(W=Tc(m,s.tileSize,s.tileSize),d.heatmapFbos.set(z,W)),m.bindFramebuffer.set(W.framebuffer),m.viewport.set([0,0,s.tileSize,s.tileSize]),m.clear({color:a.aM.transparent});const $=M.programConfigurations.get(d.id),Q=b.useProgram("heatmap",$),ie=b.style.map.terrain.getTerrainData(g);Q.draw(m,v.TRIANGLES,un.disabled,C,R,Mn.disabled,ys(g.posMatrix,s,b.transform.zoom,d.paint.get("heatmap-intensity")),ie,d.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,d.paint,b.transform.zoom,$)}function Ca(b,s,d){const g=b.context,m=g.gl;g.setColorMode(b.colorModeForRenderPass());const v=Sc(g,s),C=d.key,R=s.heatmapFbos.get(C);R&&(g.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,R.colorAttachment.get()),g.activeTexture.set(m.TEXTURE1),v.bind(m.LINEAR,m.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(g,m.TRIANGLES,un.disabled,Wn.disabled,b.colorModeForRenderPass(),Mn.disabled,mu(b,s,0,1),null,s.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,s.paint,b.transform.zoom),R.destroy(),s.heatmapFbos.delete(C))}function Tc(b,s,d){var g,m;const v=b.gl,C=v.createTexture();v.bindTexture(v.TEXTURE_2D,C),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const R=(g=b.HALF_FLOAT)!==null&&g!==void 0?g:v.UNSIGNED_BYTE,M=(m=b.RGBA16F)!==null&&m!==void 0?m:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,M,s,d,0,v.RGBA,R,null);const z=b.createFramebuffer(s,d,!1,!1);return z.colorAttachment.set(C),z}function Sc(b,s){return s.colorRampTexture||(s.colorRampTexture=new De(b,s.colorRamp,b.gl.RGBA)),s.colorRampTexture}function al(b,s,d,g,m){if(!d||!g||!g.imageAtlas)return;const v=g.imageAtlas.patternPositions;let C=v[d.to.toString()],R=v[d.from.toString()];if(!C&&R&&(C=R),!R&&C&&(R=C),!C||!R){const M=m.getPaintProperty(s);C=v[M],R=v[M]}C&&R&&b.setConstantPatternPositions(C,R)}function Ac(b,s,d,g,m,v,C){const R=b.context.gl,M="fill-pattern",z=d.paint.get(M),W=z&&z.constantOr(1),$=d.getCrossfadeParameters();let Q,ie,ce,be,Ee;C?(ie=W&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=R.LINES):(ie=W?"fillPattern":"fill",Q=R.TRIANGLES);const Pe=z.constantOr(null);for(const Fe of g){const _e=s.getTile(Fe);if(W&&!_e.patternsLoaded())continue;const je=_e.getBucket(d);if(!je)continue;const Xe=je.programConfigurations.get(d.id),st=b.useProgram(ie,Xe),St=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Fe);W&&(b.context.activeTexture.set(R.TEXTURE0),_e.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Xe.updatePaintBuffers($)),al(Xe,M,Pe,_e,d);const Bt=St?Fe:null,Gt=b.translatePosMatrix(Bt?Bt.posMatrix:Fe.posMatrix,_e,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(C){be=je.indexBuffer2,Ee=je.segments2;const nr=[R.drawingBufferWidth,R.drawingBufferHeight];ce=ie==="fillOutlinePattern"&&W?Ai(Gt,b,$,_e,nr):Si(Gt,nr)}else be=je.indexBuffer,Ee=je.segments,ce=W?fn(Gt,b,$,_e):hr(Gt);st.draw(b.context,Q,m,b.stencilModeForClipping(Fe),v,Mn.disabled,ce,St,d.id,je.layoutVertexBuffer,be,Ee,d.paint,b.transform.zoom,Xe)}}function Au(b,s,d,g,m,v,C){const R=b.context,M=R.gl,z="fill-extrusion-pattern",W=d.paint.get(z),$=W.constantOr(1),Q=d.getCrossfadeParameters(),ie=d.paint.get("fill-extrusion-opacity"),ce=W.constantOr(null);for(const be of g){const Ee=s.getTile(be),Pe=Ee.getBucket(d);if(!Pe)continue;const Fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(be),_e=Pe.programConfigurations.get(d.id),je=b.useProgram($?"fillExtrusionPattern":"fillExtrusion",_e);$&&(b.context.activeTexture.set(M.TEXTURE0),Ee.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),_e.updatePaintBuffers(Q)),al(_e,z,ce,Ee,d);const Xe=b.translatePosMatrix(be.posMatrix,Ee,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),st=d.paint.get("fill-extrusion-vertical-gradient"),St=$?Ft(Xe,b,st,ie,be,Q,Ee):ht(Xe,b,st,ie);je.draw(R,R.gl.TRIANGLES,m,v,C,Mn.backCCW,St,Fe,d.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,d.paint,b.transform.zoom,_e,b.style.map.terrain&&Pe.centroidVertexBuffer)}}function ll(b,s,d,g,m,v,C){const R=b.context,M=R.gl,z=d.fbo;if(!z)return;const W=b.useProgram("hillshade"),$=b.style.map.terrain&&b.style.map.terrain.getTerrainData(s);R.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get()),W.draw(R,M.TRIANGLES,m,v,C,Mn.disabled,((Q,ie,ce,be)=>{const Ee=ce.paint.get("hillshade-shadow-color"),Pe=ce.paint.get("hillshade-highlight-color"),Fe=ce.paint.get("hillshade-accent-color");let _e=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(_e-=Q.transform.angle);const je=!Q.options.moving;return{u_matrix:be?be.posMatrix:Q.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),je),u_image:0,u_latrange:_u(0,ie.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),_e],u_shadow:Ee,u_highlight:Pe,u_accent:Fe}})(b,d,g,$?s:null),$,g.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function cl(b,s,d,g,m,v){const C=b.context,R=C.gl,M=s.dem;if(M&&M.data){const z=M.dim,W=M.stride,$=M.getPixels();if(C.activeTexture.set(R.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||b.getTileTexture(W),s.demTexture){const ie=s.demTexture;ie.update($,{premultiply:!1}),ie.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else s.demTexture=new De(C,$,R.RGBA,{premultiply:!1}),s.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);C.activeTexture.set(R.TEXTURE0);let Q=s.fbo;if(!Q){const ie=new De(C,{width:z,height:z,data:null},R.RGBA);ie.bind(R.LINEAR,R.CLAMP_TO_EDGE),Q=s.fbo=C.createFramebuffer(z,z,!0,!1),Q.colorAttachment.set(ie.texture)}C.bindFramebuffer.set(Q.framebuffer),C.viewport.set([0,0,z,z]),b.useProgram("hillshadePrepare").draw(C,R.TRIANGLES,g,m,v,Mn.disabled,((ie,ce)=>{const be=ce.stride,Ee=a.H();return a.aP(Ee,0,a.X,-a.X,0,0,1),a.J(Ee,Ee,[0,-a.X,0]),{u_matrix:Ee,u_image:1,u_dimension:[be,be],u_zoom:ie.overscaledZ,u_unpack:ce.getUnpackVector()}})(s.tileID,M),null,d.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function a_(b,s,d,g,m,v){const C=g.paint.get("raster-fade-duration");if(!v&&C>0){const R=T.now(),M=(R-b.timeAdded)/C,z=s?(R-s.timeAdded)/C:-1,W=d.getSource(),$=m.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),Q=!s||Math.abs(s.tileID.overscaledZ-$)>Math.abs(b.tileID.overscaledZ-$),ie=Q&&b.refreshedUponExpiration?1:a.ac(Q?M:1-z,0,1);return b.refreshedUponExpiration&&M>=1&&(b.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const zd=new a.aM(1,0,0,1),An=new a.aM(0,1,0,1),Eu=new a.aM(0,0,1,1),Ab=new a.aM(1,0,1,1),l_=new a.aM(0,1,1,1);function ul(b,s,d,g){Iu(b,0,s+d/2,b.transform.width,d,g)}function c_(b,s,d,g){Iu(b,s-d/2,0,d,b.transform.height,g)}function Iu(b,s,d,g,m,v){const C=b.context,R=C.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*b.pixelRatio,d*b.pixelRatio,g*b.pixelRatio,m*b.pixelRatio),C.clear({color:v}),R.disable(R.SCISSOR_TEST)}function u_(b,s,d){const g=b.context,m=g.gl,v=d.posMatrix,C=b.useProgram("debug"),R=un.disabled,M=Wn.disabled,z=b.colorModeForRenderPass(),W="$debug",$=b.style.map.terrain&&b.style.map.terrain.getTerrainData(d);g.activeTexture.set(m.TEXTURE0);const Q=s.getTileByID(d.key).latestRawTileData,ie=Math.floor((Q&&Q.byteLength||0)/1024),ce=s.getTile(d).tileSize,be=512/Math.min(ce,512)*(d.overscaledZ/b.transform.zoom)*.5;let Ee=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ee+=` => ${d.overscaledZ}`),function(Pe,Fe){Pe.initDebugOverlayCanvas();const _e=Pe.debugOverlayCanvas,je=Pe.context.gl,Xe=Pe.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,_e.width,_e.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Fe,5,5),Xe.strokeText(Fe,5,5),Pe.debugOverlayTexture.update(_e),Pe.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(b,`${Ee} ${ie}kB`),C.draw(g,m.TRIANGLES,R,M,pi.alphaBlended,Mn.disabled,yc(v,a.aM.transparent,be),null,W,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),C.draw(g,m.LINE_STRIP,R,M,z,Mn.disabled,yc(v,a.aM.red),$,W,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function h_(b,s,d){const g=b.context,m=g.gl,v=b.colorModeForRenderPass(),C=new un(m.LEQUAL,un.ReadWrite,b.depthRangeFor3D),R=b.useProgram("terrain"),M=s.getTerrainMesh();g.bindFramebuffer.set(null),g.viewport.set([0,0,b.width,b.height]);for(const z of d){const W=b.renderToTexture.getTexture(z),$=s.getTerrainData(z.tileID);g.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,W.texture);const Q=b.transform.calculatePosMatrix(z.tileID.toUnwrapped()),ie=s.getMeshFrameDelta(b.transform.zoom),ce=b.transform.calculateFogMatrix(z.tileID.toUnwrapped()),be=_c(Q,ie,ce,b.style.sky,b.transform.pitch);R.draw(g,m.TRIANGLES,C,Wn.disabled,v,Mn.backCCW,be,$,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Cu{constructor(s,d,g){this.vertexBuffer=s,this.indexBuffer=d,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Pu{constructor(s,d){this.context=new Sb(s),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=$e.maxUnderzooming+$e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ko}resize(s,d,g){if(this.width=Math.floor(s*g),this.height=Math.floor(d*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const s=this.context,d=new a.aX;d.emplaceBack(0,0),d.emplaceBack(a.X,0),d.emplaceBack(0,a.X),d.emplaceBack(a.X,a.X),this.tileExtentBuffer=s.createVertexBuffer(d,Us.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const g=new a.aX;g.emplaceBack(0,0),g.emplaceBack(a.X,0),g.emplaceBack(0,a.X),g.emplaceBack(a.X,a.X),this.debugBuffer=s.createVertexBuffer(g,Us.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const m=new a.$;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=s.createVertexBuffer(m,$r.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const v=new a.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Us.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const C=new a.aZ;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(C);const R=new a.aY;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(R);const M=this.context.gl;this.stencilClearMode=new Wn({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=a.H();a.aP(g,0,this.width,this.height,0,0,1),a.K(g,g,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,d.TRIANGLES,un.disabled,this.stencilClearMode,pi.disabled,Mn.disabled,_s(g),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d){if(this.currentStencilSource===s.source||!s.isTileClipped()||!d||!d.length)return;this.currentStencilSource=s.source;const g=this.context,m=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(pi.disabled),g.setDepthMode(un.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const R=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);v.draw(g,m.TRIANGLES,un.disabled,new Wn({func:m.ALWAYS,mask:0},R,255,m.KEEP,m.KEEP,m.REPLACE),pi.disabled,Mn.disabled,_s(C.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new Wn({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){const d=this.context.gl;return new Wn({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(s){const d=this.context.gl,g=s.sort((C,R)=>R.overscaledZ-C.overscaledZ),m=g[g.length-1].overscaledZ,v=g[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const C={};for(let R=0;R<v;R++)C[R+m]=new Wn({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=v,[C,g]}return[{[m]:Wn.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new pi([s.CONSTANT_COLOR,s.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pi.unblended:pi.alphaBlended}depthModeForSublayer(s,d,g){if(!this.opaquePassEnabledForLayer())return un.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new un(g||this.context.gl.LEQUAL,d,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const g=this.style._order,m=this.style.sourceCaches,v={},C={},R={};for(const M in m){const z=m[M];z.used&&z.prepare(this.context),v[M]=z.getVisibleCoordinates(),C[M]=v[M].slice().reverse(),R[M]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<g.length;M++)if(this.style._layers[g[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of g){const z=this.style._layers[M];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const W=C[z.source];(z.type==="custom"||W.length)&&this.renderLayer(this,m[z.source],z,W)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,z){const W=M.context,$=W.gl,Q=((Pe,Fe,_e)=>({u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:(Fe.height/2+Fe.getHorizon())*_e,u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*Fe.height/2*_e}))(z,M.style.map.transform,M.pixelRatio),ie=new un($.LEQUAL,un.ReadWrite,[0,1]),ce=Wn.disabled,be=M.colorModeForRenderPass(),Ee=M.useProgram("sky");if(!z.mesh){const Pe=new a.aX;Pe.emplaceBack(-1,-1),Pe.emplaceBack(1,-1),Pe.emplaceBack(1,1),Pe.emplaceBack(-1,1);const Fe=new a.aY;Fe.emplaceBack(0,1,2),Fe.emplaceBack(0,2,3),z.mesh=new Cu(W.createVertexBuffer(Pe,Us.members),W.createIndexBuffer(Fe),a.a0.simpleSegment(0,0,Pe.length,Fe.length))}Ee.draw(W,$.TRIANGLES,ie,ce,be,Mn.disabled,Q,void 0,"sky",z.mesh.vertexBuffer,z.mesh.indexBuffer,z.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[g[this.currentLayer]],z=m[M.source],W=v[M.source];this._renderTileClippingMasks(M,W),this.renderLayer(this,z,M,W)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const M=this.style._layers[g[this.currentLayer]],z=m[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const W=(M.type==="symbol"?R:C)[M.source];this._renderTileClippingMasks(M,v[M.source]),this.renderLayer(this,z,M,W)}if(this.options.showTileBoundaries){const M=function(z,W){let $=null;const Q=Object.values(z._layers).flatMap(Ee=>Ee.source&&!Ee.isHidden(W)?[z.sourceCaches[Ee.source]]:[]),ie=Q.filter(Ee=>Ee.getSource().type==="vector"),ce=Q.filter(Ee=>Ee.getSource().type!=="vector"),be=Ee=>{(!$||$.getSource().maxzoom<Ee.getSource().maxzoom)&&($=Ee)};return ie.forEach(Ee=>be(Ee)),$||ce.forEach(Ee=>be(Ee)),$}(this.style,this.transform.zoom);M&&function(z,W,$){for(let Q=0;Q<$.length;Q++)u_(z,W,$[Q])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const z=M.transform.padding;ul(M,M.transform.height-(z.top||0),3,zd),ul(M,z.bottom||0,3,An),c_(M,z.left||0,3,Eu),c_(M,M.transform.width-(z.right||0),3,Ab);const W=M.transform.centerPoint;(function($,Q,ie,ce){Iu($,Q-1,ie-10,2,20,ce),Iu($,Q-10,ie-1,20,2,ce)})(M,W.x,M.transform.height-W.y,l_)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=s?!a.a_(d,g):!a.a$(d,g)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.b0(d,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,C){const R=v.context,M=R.gl,z=pi.unblended,W=new un(M.LEQUAL,un.ReadWrite,[0,1]),$=C.getTerrainMesh(),Q=C.sourceCache.getRenderableTiles(),ie=v.useProgram("terrainDepth");R.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),R.clear({color:a.aM.transparent,depth:1});for(const ce of Q){const be=C.getTerrainData(ce.tileID),Ee={u_matrix:v.transform.calculatePosMatrix(ce.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(v.transform.zoom)};ie.draw(R,M.TRIANGLES,W,Wn.disabled,z,Mn.backCCW,Ee,be,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,C){const R=v.context,M=R.gl,z=pi.unblended,W=new un(M.LEQUAL,un.ReadWrite,[0,1]),$=C.getTerrainMesh(),Q=C.getCoordsTexture(),ie=C.sourceCache.getRenderableTiles(),ce=v.useProgram("terrainCoords");R.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),R.clear({color:a.aM.transparent,depth:1}),C.coordsIndex=[];for(const be of ie){const Ee=C.getTerrainData(be.tileID);R.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Q.texture);const Pe={u_matrix:v.transform.calculatePosMatrix(be.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(v.transform.zoom)};ce.draw(R,M.TRIANGLES,W,Wn.disabled,z,Mn.backCCW,Pe,Ee,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),C.coordsIndex.push(be.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(s,d,g,m){if(!g.isHidden(this.transform.zoom)&&(g.type==="background"||g.type==="custom"||(m||[]).length))switch(this.id=g.id,g.type){case"symbol":(function(v,C,R,M,z){if(v.renderPass!=="translucent")return;const W=Wn.disabled,$=v.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,ie,ce,be,Ee,Pe,Fe,_e,je){const Xe=ie.transform,st=zs(),St=Ee==="map",Bt=Pe==="map";for(const Gt of Q){const nr=be.getTile(Gt),$t=nr.getBucket(ce);if(!$t||!$t.text||!$t.text.segments.get().length)continue;const jt=a.ag($t.textSizeData,Xe.zoom),_r=gr(nr,1,ie.transform.zoom),en=tn(Gt.posMatrix,Bt,St,ie.transform,_r),qt=ce.layout.get("icon-text-fit")!=="none"&&$t.hasIconData();if(jt){const tr=Math.pow(2,Xe.zoom-nr.tileID.overscaledZ),Kr=ie.style.map.terrain?(on,gn)=>ie.style.map.terrain.getElevation(Gt,on,gn):null,Yn=st.translatePosition(Xe,nr,Fe,_e);ol($t,St,Bt,je,Xe,en,Gt.posMatrix,tr,jt,qt,st,Yn,Gt.toUnwrapped(),Kr)}}}(M,v,R,C,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),z),R.paint.get("icon-opacity").constantOr(1)!==0&&Fd(v,C,R,M,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),W,$),R.paint.get("text-opacity").constantOr(1)!==0&&Fd(v,C,R,M,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),W,$),C.map.showCollisionBoxes&&(xc(v,C,R,M,!0),xc(v,C,R,M,!1))})(s,d,g,m,this.style.placement.variableOffsets);break;case"circle":(function(v,C,R,M){if(v.renderPass!=="translucent")return;const z=R.paint.get("circle-opacity"),W=R.paint.get("circle-stroke-width"),$=R.paint.get("circle-stroke-opacity"),Q=!R.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(W.constantOr(1)===0||$.constantOr(1)===0))return;const ie=v.context,ce=ie.gl,be=v.depthModeForSublayer(0,un.ReadOnly),Ee=Wn.disabled,Pe=v.colorModeForRenderPass(),Fe=[];for(let _e=0;_e<M.length;_e++){const je=M[_e],Xe=C.getTile(je),st=Xe.getBucket(R);if(!st)continue;const St=st.programConfigurations.get(R.id),Bt=v.useProgram("circle",St),Gt=st.layoutVertexBuffer,nr=st.indexBuffer,$t=v.style.map.terrain&&v.style.map.terrain.getTerrainData(je),jt={programConfiguration:St,program:Bt,layoutVertexBuffer:Gt,indexBuffer:nr,uniformValues:qi(v,je,Xe,R),terrainData:$t};if(Q){const _r=st.segments.get();for(const en of _r)Fe.push({segments:new a.a0([en]),sortKey:en.sortKey,state:jt})}else Fe.push({segments:st.segments,sortKey:0,state:jt})}Q&&Fe.sort((_e,je)=>_e.sortKey-je.sortKey);for(const _e of Fe){const{programConfiguration:je,program:Xe,layoutVertexBuffer:st,indexBuffer:St,uniformValues:Bt,terrainData:Gt}=_e.state;Xe.draw(ie,ce.TRIANGLES,be,Ee,Pe,Mn.disabled,Bt,Gt,R.id,st,St,_e.segments,R.paint,v.transform.zoom,je)}})(s,d,g,m);break;case"heatmap":(function(v,C,R,M){if(R.paint.get("heatmap-opacity")===0)return;const z=v.context;if(v.style.map.terrain){for(const W of M){const $=C.getTile(W);C.hasRenderableParent(W)||(v.renderPass==="offscreen"?Ld(v,$,R,W):v.renderPass==="translucent"&&Ca(v,R,W))}z.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(W,$,Q,ie){const ce=W.context,be=ce.gl,Ee=Wn.disabled,Pe=new pi([be.ONE,be.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(Fe,_e,je){const Xe=Fe.gl;Fe.activeTexture.set(Xe.TEXTURE1),Fe.viewport.set([0,0,_e.width/4,_e.height/4]);let st=je.heatmapFbos.get(a.aU);st?(Xe.bindTexture(Xe.TEXTURE_2D,st.colorAttachment.get()),Fe.bindFramebuffer.set(st.framebuffer)):(st=Tc(Fe,_e.width/4,_e.height/4),je.heatmapFbos.set(a.aU,st))})(ce,W,Q),ce.clear({color:a.aM.transparent});for(let Fe=0;Fe<ie.length;Fe++){const _e=ie[Fe];if($.hasRenderableParent(_e))continue;const je=$.getTile(_e),Xe=je.getBucket(Q);if(!Xe)continue;const st=Xe.programConfigurations.get(Q.id),St=W.useProgram("heatmap",st),{zoom:Bt}=W.transform;St.draw(ce,be.TRIANGLES,un.disabled,Ee,Pe,Mn.disabled,ys(_e.posMatrix,je,Bt,Q.paint.get("heatmap-intensity")),null,Q.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,Q.paint,W.transform.zoom,st)}ce.viewport.set([0,0,W.width,W.height])}(v,C,R,M):v.renderPass==="translucent"&&function(W,$){const Q=W.context,ie=Q.gl;Q.setColorMode(W.colorModeForRenderPass());const ce=$.heatmapFbos.get(a.aU);ce&&(Q.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,ce.colorAttachment.get()),Q.activeTexture.set(ie.TEXTURE1),Sc(Q,$).bind(ie.LINEAR,ie.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(Q,ie.TRIANGLES,un.disabled,Wn.disabled,W.colorModeForRenderPass(),Mn.disabled,mu(W,$,0,1),null,$.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,$.paint,W.transform.zoom))}(v,R)})(s,d,g,m);break;case"line":(function(v,C,R,M){if(v.renderPass!=="translucent")return;const z=R.paint.get("line-opacity"),W=R.paint.get("line-width");if(z.constantOr(1)===0||W.constantOr(1)===0)return;const $=v.depthModeForSublayer(0,un.ReadOnly),Q=v.colorModeForRenderPass(),ie=R.paint.get("line-dasharray"),ce=R.paint.get("line-pattern"),be=ce.constantOr(1),Ee=R.paint.get("line-gradient"),Pe=R.getCrossfadeParameters(),Fe=be?"linePattern":ie?"lineSDF":Ee?"lineGradient":"line",_e=v.context,je=_e.gl;let Xe=!0;for(const st of M){const St=C.getTile(st);if(be&&!St.patternsLoaded())continue;const Bt=St.getBucket(R);if(!Bt)continue;const Gt=Bt.programConfigurations.get(R.id),nr=v.context.program.get(),$t=v.useProgram(Fe,Gt),jt=Xe||$t.program!==nr,_r=v.style.map.terrain&&v.style.map.terrain.getTerrainData(st),en=ce.constantOr(null);if(en&&St.imageAtlas){const Kr=St.imageAtlas,Yn=Kr.patternPositions[en.to.toString()],on=Kr.patternPositions[en.from.toString()];Yn&&on&&Gt.setConstantPatternPositions(Yn,on)}const qt=_r?st:null,tr=be?il(v,St,R,Pe,qt):ie?db(v,St,R,ie,Pe,qt):Ee?$m(v,St,R,Bt.lineClipsArray.length,qt):yu(v,St,R,qt);if(be)_e.activeTexture.set(je.TEXTURE0),St.imageAtlasTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE),Gt.updatePaintBuffers(Pe);else if(ie&&(jt||v.lineAtlas.dirty))_e.activeTexture.set(je.TEXTURE0),v.lineAtlas.bind(_e);else if(Ee){const Kr=Bt.gradients[R.id];let Yn=Kr.texture;if(R.gradientVersion!==Kr.version){let on=256;if(R.stepInterpolant){const gn=C.getSource().maxzoom,Kn=st.canonical.z===gn?Math.ceil(1<<v.transform.maxZoom-st.canonical.z):1;on=a.ac(a.aV(Bt.maxLineLength/a.X*1024*Kn),256,_e.maxTextureSize)}Kr.gradient=a.aW({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:on,image:Kr.gradient||void 0,clips:Bt.lineClipsArray}),Kr.texture?Kr.texture.update(Kr.gradient):Kr.texture=new De(_e,Kr.gradient,je.RGBA),Kr.version=R.gradientVersion,Yn=Kr.texture}_e.activeTexture.set(je.TEXTURE0),Yn.bind(R.stepInterpolant?je.NEAREST:je.LINEAR,je.CLAMP_TO_EDGE)}$t.draw(_e,je.TRIANGLES,$,v.stencilModeForClipping(st),Q,Mn.disabled,tr,_r,R.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,R.paint,v.transform.zoom,Gt,Bt.layoutVertexBuffer2),Xe=!1}})(s,d,g,m);break;case"fill":(function(v,C,R,M){const z=R.paint.get("fill-color"),W=R.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const $=v.colorModeForRenderPass(),Q=R.paint.get("fill-pattern"),ie=v.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&z.constantOr(a.aM.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===ie){const ce=v.depthModeForSublayer(1,v.renderPass==="opaque"?un.ReadWrite:un.ReadOnly);Ac(v,C,R,M,ce,$,!1)}if(v.renderPass==="translucent"&&R.paint.get("fill-antialias")){const ce=v.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,un.ReadOnly);Ac(v,C,R,M,ce,$,!0)}})(s,d,g,m);break;case"fill-extrusion":(function(v,C,R,M){const z=R.paint.get("fill-extrusion-opacity");if(z!==0&&v.renderPass==="translucent"){const W=new un(v.context.gl.LEQUAL,un.ReadWrite,v.depthRangeFor3D);if(z!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))Au(v,C,R,M,W,Wn.disabled,pi.disabled),Au(v,C,R,M,W,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const $=v.colorModeForRenderPass();Au(v,C,R,M,W,Wn.disabled,$)}}})(s,d,g,m);break;case"hillshade":(function(v,C,R,M){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const z=v.context,W=v.depthModeForSublayer(0,un.ReadOnly),$=v.colorModeForRenderPass(),[Q,ie]=v.renderPass==="translucent"?v.stencilConfigForOverlap(M):[{},M];for(const ce of ie){const be=C.getTile(ce);be.needsHillshadePrepare!==void 0&&be.needsHillshadePrepare&&v.renderPass==="offscreen"?cl(v,be,R,W,Wn.disabled,$):v.renderPass==="translucent"&&ll(v,ce,be,R,W,Q[ce.overscaledZ],$)}z.viewport.set([0,0,v.width,v.height])})(s,d,g,m);break;case"raster":(function(v,C,R,M){if(v.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!M.length)return;const z=v.context,W=z.gl,$=C.getSource(),Q=v.useProgram("raster"),ie=v.colorModeForRenderPass(),[ce,be]=$ instanceof Jt?[{},M]:v.stencilConfigForOverlap(M),Ee=be[be.length-1].overscaledZ,Pe=!v.options.moving;for(const Fe of be){const _e=v.depthModeForSublayer(Fe.overscaledZ-Ee,R.paint.get("raster-opacity")===1?un.ReadWrite:un.ReadOnly,W.LESS),je=C.getTile(Fe);je.registerFadeDuration(R.paint.get("raster-fade-duration"));const Xe=C.findLoadedParent(Fe,0),st=C.findLoadedSibling(Fe),St=a_(je,Xe||st||null,C,R,v.transform,v.style.map.terrain);let Bt,Gt;const nr=R.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;z.activeTexture.set(W.TEXTURE0),je.texture.bind(nr,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(W.TEXTURE1),Xe?(Xe.texture.bind(nr,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Bt=Math.pow(2,Xe.tileID.overscaledZ-je.tileID.overscaledZ),Gt=[je.tileID.canonical.x*Bt%1,je.tileID.canonical.y*Bt%1]):je.texture.bind(nr,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),je.texture.useMipmap&&z.extTextureFilterAnisotropic&&v.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const $t=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Fe),jt=$t?Fe:null,_r=jt?jt.posMatrix:v.transform.calculatePosMatrix(Fe.toUnwrapped(),Pe),en=fb(_r,Gt||[0,0],Bt||1,St,R);$ instanceof Jt?Q.draw(z,W.TRIANGLES,_e,Wn.disabled,ie,Mn.disabled,en,$t,R.id,$.boundsBuffer,v.quadTriangleIndexBuffer,$.boundsSegments):Q.draw(z,W.TRIANGLES,_e,ce[Fe.overscaledZ],ie,Mn.disabled,en,$t,R.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(s,d,g,m);break;case"background":(function(v,C,R,M){const z=R.paint.get("background-color"),W=R.paint.get("background-opacity");if(W===0)return;const $=v.context,Q=$.gl,ie=v.transform,ce=ie.tileSize,be=R.paint.get("background-pattern");if(v.isPatternMissing(be))return;const Ee=!be&&z.a===1&&W===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==Ee)return;const Pe=Wn.disabled,Fe=v.depthModeForSublayer(0,Ee==="opaque"?un.ReadWrite:un.ReadOnly),_e=v.colorModeForRenderPass(),je=v.useProgram(be?"backgroundPattern":"background"),Xe=M||ie.coveringTiles({tileSize:ce,terrain:v.style.map.terrain});be&&($.activeTexture.set(Q.TEXTURE0),v.imageManager.bind(v.context));const st=R.getCrossfadeParameters();for(const St of Xe){const Bt=M?St.posMatrix:v.transform.calculatePosMatrix(St.toUnwrapped()),Gt=be?Ad(Bt,W,v,be,{tileID:St,tileSize:ce},st):vu(Bt,W,z),nr=v.style.map.terrain&&v.style.map.terrain.getTerrainData(St);je.draw($,Q.TRIANGLES,Fe,Pe,_e,Mn.disabled,Gt,nr,R.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(s,0,g,m);break;case"custom":(function(v,C,R){const M=v.context,z=R.implementation;if(v.renderPass==="offscreen"){const W=z.prerender;W&&(v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),W.call(z,M.gl,v.transform.customLayerMatrix()),M.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),M.setStencilMode(Wn.disabled);const W=z.renderingMode==="3d"?new un(v.context.gl.LEQUAL,un.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,un.ReadOnly);M.setDepthMode(W),z.render(M.gl,v.transform.customLayerMatrix(),{farZ:v.transform.farZ,nearZ:v.transform.nearZ,fov:v.transform._fov,modelViewProjectionMatrix:v.transform.modelViewProjectionMatrix,projectionMatrix:v.transform.projectionMatrix}),M.setDirty(),v.setBaseState(),M.bindFramebuffer.set(null)}})(s,0,g)}}translatePosMatrix(s,d,g,m,v){if(!g[0]&&!g[1])return s;const C=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(C){const z=Math.sin(C),W=Math.cos(C);g=[g[0]*W-g[1]*z,g[0]*z+g[1]*W]}const R=[v?g[0]:gr(d,g[0],this.transform.zoom),v?g[1]:gr(d,g[1],this.transform.zoom),0],M=new Float32Array(16);return a.J(M,s,R),M}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),g=this.imageManager.getPattern(s.to.toString());return!d||!g}useProgram(s,d){this.cache=this.cache||{};const g=s+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[g]||(this.cache[g]=new ae(this.context,ms[s],d,Ed[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new De(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:d}=this.context.gl;return this.width!==s||this.height!==d}}class hl{constructor(s,d){this.points=s,this.planes=d}static fromInvProjectionMatrix(s,d,g){const m=Math.pow(2,g),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const M=1/(R=a.af([],R,s))[3]/d*m;return a.b1(R,R,[M,M,1/R[3],M])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const M=function(Q,ie){var ce=ie[0],be=ie[1],Ee=ie[2],Pe=ce*ce+be*be+Ee*Ee;return Pe>0&&(Pe=1/Math.sqrt(Pe)),Q[0]=ie[0]*Pe,Q[1]=ie[1]*Pe,Q[2]=ie[2]*Pe,Q}([],function(Q,ie,ce){var be=ie[0],Ee=ie[1],Pe=ie[2],Fe=ce[0],_e=ce[1],je=ce[2];return Q[0]=Ee*je-Pe*_e,Q[1]=Pe*Fe-be*je,Q[2]=be*_e-Ee*Fe,Q}([],le([],v[R[0]],v[R[1]]),le([],v[R[2]],v[R[1]]))),z=-((W=M)[0]*($=v[R[1]])[0]+W[1]*$[1]+W[2]*$[2]);var W,$;return M.concat(z)});return new hl(v,C)}}class dl{constructor(s,d){this.min=s,this.max=d,this.center=function(g,m,v){return g[0]=.5*m[0],g[1]=.5*m[1],g[2]=.5*m[2],g}([],function(g,m,v){return g[0]=m[0]+v[0],g[1]=m[1]+v[1],g[2]=m[2]+v[2],g}([],this.min,this.max))}quadrant(s){const d=[s%2==0,s<2],g=J(this.min),m=J(this.max);for(let v=0;v<d.length;v++)g[v]=d[v]?this.min[v]:this.center[v],m[v]=d[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new dl(g,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let m=0;m<s.planes.length;m++){const v=s.planes[m];let C=0;for(let R=0;R<d.length;R++)a.b2(v,d[R])>=0&&C++;if(C===0)return 0;C!==d.length&&(g=!1)}if(g)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let R=0;R<s.points.length;R++){const M=s.points[R][m]-this.min[m];v=Math.min(v,M),C=Math.max(C,M)}if(C<0||v>this.max[m]-this.min[m])return 0}return 1}}class fl{constructor(s=0,d=0,g=0,m=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(g)||g<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=g,this.right=m}interpolate(s,d,g){return d.top!=null&&s.top!=null&&(this.top=a.y.number(s.top,d.top,g)),d.bottom!=null&&s.bottom!=null&&(this.bottom=a.y.number(s.bottom,d.bottom,g)),d.left!=null&&s.left!=null&&(this.left=a.y.number(s.left,d.left,g)),d.right!=null&&s.right!=null&&(this.right=a.y.number(s.right,d.right,g)),this}getCenter(s,d){const g=a.ac((this.left+s-this.right)/2,0,s),m=a.ac((this.top+d-this.bottom)/2,0,d);return new a.P(g,m)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new fl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ud=85.051129;class pl{constructor(s,d,g,m,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=d||22,this._minPitch=g??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.lngRange=s.lngRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const d=-a.b3(s,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var g=new a.A(4);return a.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}(),function(g,m,v){var C=m[0],R=m[1],M=m[2],z=m[3],W=Math.sin(v),$=Math.cos(v);g[0]=C*$+M*W,g[1]=R*$+z*W,g[2]=C*-W+M*$,g[3]=R*-W+z*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const d=a.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const d=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,g){this._unmodified=!1,this._edgeInsets.interpolate(s,d,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const d=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(s){const d=[new a.b4(0,s)];if(this._renderWorldCopies){const g=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),C=this.pointCoordinate(new a.P(0,this.height)),R=Math.floor(Math.min(g.x,m.x,v.x,C.x)),M=Math.floor(Math.max(g.x,m.x,v.x,C.x)),z=1;for(let W=R-z;W<=M+z;W++)W!==0&&d.push(new a.b4(W,s))}return d}coveringTiles(s){var d,g;let m=this.coveringZoomLevel(s);const v=m;if(s.minzoom!==void 0&&m<s.minzoom)return[];s.maxzoom!==void 0&&m>s.maxzoom&&(m=s.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),R=a.Z.fromLngLat(this.center),M=Math.pow(2,m),z=[M*C.x,M*C.y,0],W=[M*R.x,M*R.y,0],$=hl.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let Q=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=m);const ie=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ce=_e=>({aabb:new dl([_e*M,0,0],[(_e+1)*M,M,0]),zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),be=[],Ee=[],Pe=m,Fe=s.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let _e=1;_e<=3;_e++)be.push(ce(-_e)),be.push(ce(_e));for(be.push(ce(0));be.length>0;){const _e=be.pop(),je=_e.x,Xe=_e.y;let st=_e.fullyVisible;if(!st){const $t=_e.aabb.intersects($);if($t===0)continue;st=$t===2}const St=s.terrain?z:W,Bt=_e.aabb.distanceX(St),Gt=_e.aabb.distanceY(St),nr=Math.max(Math.abs(Bt),Math.abs(Gt));if(_e.zoom===Pe||nr>ie+(1<<Pe-_e.zoom)-2&&_e.zoom>=Q){const $t=Pe-_e.zoom,jt=z[0]-.5-(je<<$t),_r=z[1]-.5-(Xe<<$t);Ee.push({tileID:new a.S(_e.zoom===Pe?Fe:_e.zoom,_e.wrap,_e.zoom,je,Xe),distanceSq:Ce([W[0]-.5-je,W[1]-.5-Xe]),tileDistanceToCamera:Math.sqrt(jt*jt+_r*_r)})}else for(let $t=0;$t<4;$t++){const jt=(je<<1)+$t%2,_r=(Xe<<1)+($t>>1),en=_e.zoom+1;let qt=_e.aabb.quadrant($t);if(s.terrain){const tr=new a.S(en,_e.wrap,en,jt,_r),Kr=s.terrain.getMinMaxElevation(tr),Yn=(d=Kr.minElevation)!==null&&d!==void 0?d:this.elevation,on=(g=Kr.maxElevation)!==null&&g!==void 0?g:this.elevation;qt=new dl([qt.min[0],qt.min[1],Yn],[qt.max[0],qt.max[1],on])}be.push({aabb:qt,zoom:en,x:jt,y:_r,wrap:_e.wrap,fullyVisible:st})}}return Ee.sort((_e,je)=>_e.distanceSq-je.distanceSq).map(_e=>_e.tileID)}resize(s,d){this.width=s,this.height=d,this.pixelsToGLUnits=[2/s,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const d=a.ac(s.lat,-85.051129,Ud);return new a.P(a.O(s.lng)*this.worldSize,a.Q(d)*this.worldSize)}unproject(s){return new a.Z(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const d=this.elevation,g=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,s),v=s.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-v))return;const C=g+d-v,R=Math.cos(this._pitch)*this.cameraToCenterDistance/C/a.b5(1,m.lat),M=this.scaleZoom(R/this.tileSize);this._elevation=v,this._center=m,this.zoom=M}setLocationAtPoint(s,d){const g=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),C=new a.Z(v.x-(g.x-m.x),v.y-(g.y-m.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,d){return d?this.coordinatePoint(this.locationCoordinate(s),d.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,d){return this.coordinateLocation(this.pointCoordinate(s,d))}locationCoordinate(s){return a.Z.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,d){if(d){const Q=d.pointCoordinate(s);if(Q!=null)return Q}const g=[s.x,s.y,0,1],m=[s.x,s.y,1,1];a.af(g,g,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const v=g[3],C=m[3],R=g[1]/v,M=m[1]/C,z=g[2]/v,W=m[2]/C,$=z===W?0:(0-z)/(W-z);return new a.Z(a.y.number(g[0]/v,m[0]/C,$)/this.worldSize,a.y.number(R,M,$)/this.worldSize)}coordinatePoint(s,d=0,g=this.pixelMatrix){const m=[s.x*this.worldSize,s.y*this.worldSize,d,1];return a.af(m,m,g),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new a.P(0,s))).extend(this.pointLocation(new a.P(this.width,s))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ud])}calculateTileMatrix(s){const d=s.canonical,g=this.worldSize/this.zoomScale(d.z),m=d.x+Math.pow(2,d.z)*s.wrap,v=a.an(new Float64Array(16));return a.J(v,v,[m*g,d.y*g,0]),a.K(v,v,[g/a.X,g/a.X,1]),v}calculatePosMatrix(s,d=!1){const g=s.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[g])return m[g];const v=this.calculateTileMatrix(s);return a.L(v,d?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,v),m[g]=new Float32Array(v),m[g]}calculateFogMatrix(s){const d=s.key,g=this._fogMatrixCache;if(g[d])return g[d];const m=this.calculateTileMatrix(s);return a.L(m,this.fogMatrix,m),g[d]=new Float32Array(m),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,d){d=a.ac(+d,this.minZoom,this.maxZoom);const g={center:new a.N(s.lng,s.lat),zoom:d};let m=this.lngRange;!this._renderWorldCopies&&m===null&&(m=[-179.9999999999,179.9999999999]);const v=this.tileSize*this.zoomScale(g.zoom);let C=0,R=v,M=0,z=v,W=0,$=0;const{x:Q,y:ie}=this.size;if(this.latRange){const _e=this.latRange;C=a.Q(_e[1])*v,R=a.Q(_e[0])*v,R-C<ie&&(W=ie/(R-C))}m&&(M=a.b3(a.O(m[0])*v,0,v),z=a.b3(a.O(m[1])*v,0,v),z<M&&(z+=v),z-M<Q&&($=Q/(z-M)));const{x:ce,y:be}=this.project.call({worldSize:v},s);let Ee,Pe;const Fe=Math.max($||0,W||0);if(Fe){const _e=new a.P($?(z+M)/2:ce,W?(R+C)/2:be);return g.center=this.unproject.call({worldSize:v},_e).wrap(),g.zoom+=this.scaleZoom(Fe),g}if(this.latRange){const _e=ie/2;be-_e<C&&(Pe=C+_e),be+_e>R&&(Pe=R-_e)}if(m){const _e=(M+z)/2;let je=ce;this._renderWorldCopies&&(je=a.b3(ce,_e-v/2,_e+v/2));const Xe=Q/2;je-Xe<M&&(Ee=M+Xe),je+Xe>z&&(Ee=z-Xe)}if(Ee!==void 0||Pe!==void 0){const _e=new a.P(Ee??ce,Pe??be);g.center=this.unproject.call({worldSize:v},_e).wrap()}return g}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:d,zoom:g}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=g,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,d=this.point.x,g=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.K(m,m,[this.width/2,-this.height/2,1]),a.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.K(m,m,[1,-1,1]),a.J(m,m,[-1,-1,0]),a.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),R=v-C*this._pixelPerMeter/Math.cos(this._pitch),M=C<0?R:v,z=Math.PI/2+this._pitch,W=this._fov*(.5+s.y/this.height),$=Math.sin(W)*M/Math.sin(a.ac(Math.PI-z-W,.01,Math.PI-.01)),Q=this.getHorizon(),ie=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+s.y/(2*Q)),ce=Math.sin(ie)*M/Math.sin(a.ac(Math.PI-z-ie,.01,Math.PI-.01)),be=Math.min($,ce);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*be+M),this.nearZ=this.height/50,m=new Float64Array(16),a.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-s.x/this.width,m[9]=2*s.y/this.height,this.projectionMatrix=a.ae(m),a.K(m,m,[1,-1,1]),a.J(m,m,[0,0,-this.cameraToCenterDistance]),a.b7(m,m,this._pitch),a.ad(m,m,this.angle),a.J(m,m,[-d,-g,0]),this.mercatorMatrix=a.K([],m,[this.worldSize,this.worldSize,this.worldSize]),a.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,m),a.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=a.as([],m),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,v,this.farZ),this.fogMatrix[8]=2*-s.x/this.width,this.fogMatrix[9]=2*s.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-d,-g,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,m);const Ee=this.width%2/2,Pe=this.height%2/2,Fe=Math.cos(this.angle),_e=Math.sin(this.angle),je=d-Math.round(d)+Fe*Ee+_e*Pe,Xe=g-Math.round(g)+Fe*Pe+_e*Ee,st=new Float64Array(m);if(a.J(st,st,[je>.5?je-1:je,Xe>.5?Xe-1:Xe,0]),this.alignedModelViewProjectionMatrix=st,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new a.P(0,0)),d=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,s))}getCameraQueryGeometry(s){const d=this.getCameraPoint();if(s.length===1)return[s[0],d];{let g=d.x,m=d.y,v=d.x,C=d.y;for(const R of s)g=Math.min(g,R.x),m=Math.min(m,R.y),v=Math.max(v,R.x),C=Math.max(C,R.y);return[new a.P(g,m),new a.P(v,m),new a.P(v,C),new a.P(g,C),new a.P(g,m)]}}lngLatToCameraDepth(s,d){const g=this.locationCoordinate(s),m=[g.x*this.worldSize,g.y*this.worldSize,d,1];return a.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function Ec(b,s){let d,g=!1,m=null,v=null;const C=()=>{m=null,g&&(b.apply(v,d),m=setTimeout(C,s),g=!1)};return(...R)=>(g=!0,v=this,d=R,m||C(),m)}class Ru{constructor(s){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let g;return d.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(g=m)}),(g&&g[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(g=>isNaN(g))){const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const g=d.join("/");let m=g;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${g}`);let v=window.location.hash.replace(m,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let C=window.location.href.replace(/(#.+)?$/,v);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=Ec(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const d=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,m=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),C=Math.round(d.lng*v)/v,R=Math.round(d.lat*v)/v,M=this._map.getBearing(),z=this._map.getPitch();let W="";if(W+=s?`/${C}/${R}/${g}`:`${g}/${R}/${C}`,(M||z)&&(W+="/"+Math.round(10*M)/10),z&&(W+=`/${Math.round(z)}`),this._hashName){const $=this._hashName;let Q=!1;const ie=window.location.hash.slice(1).split("&").map(ce=>{const be=ce.split("=")[0];return be===$?(Q=!0,`${be}=${W}`):ce}).filter(ce=>ce);return Q||ie.push(`${$}=${W}`),`#${ie.join("&")}`}return`#${W}`}}const ku={linearity:.3,easing:a.b8(0,0,.3,1)},Vd=a.e({deceleration:2500,maxSpeed:1400},ku),Eb=a.e({deceleration:20,maxSpeed:1400},ku),d_=a.e({deceleration:1e3,maxSpeed:360},ku),Mu=a.e({deceleration:1e3,maxSpeed:90},ku);class jd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=T.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)d.zoom+=v.zoomDelta||0,d.bearing+=v.bearingDelta||0,d.pitch+=v.pitchDelta||0,v.panDelta&&d.pan._add(v.panDelta),v.around&&(d.around=v.around),v.pinchAround&&(d.pinchAround=v.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(d.pan.mag()){const v=Cc(d.pan.mag(),g,a.e({},Vd,s||{}));m.offset=d.pan.mult(v.amount/d.pan.mag()),m.center=this._map.transform.center,Ic(m,v)}if(d.zoom){const v=Cc(d.zoom,g,Eb);m.zoom=this._map.transform.zoom+v.amount,Ic(m,v)}if(d.bearing){const v=Cc(d.bearing,g,d_);m.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),Ic(m,v)}if(d.pitch){const v=Cc(d.pitch,g,Mu);m.pitch=this._map.transform.pitch+v.amount,Ic(m,v)}if(m.zoom||m.bearing){const v=d.pinchAround===void 0?d.around:d.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Ic(b,s){(!b.duration||b.duration<s.duration)&&(b.duration=s.duration,b.easing=s.easing)}function Cc(b,s,d){const{maxSpeed:g,linearity:m,deceleration:v}=d,C=a.ac(b*m/(s/1e3),-g,g),R=Math.abs(C)/(v*m);return{easing:d.easing,duration:1e3*R,amount:C*(R/2)}}class Ji extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g,m={}){const v=E.mousePos(d.getCanvas(),g),C=d.unproject(v);super(s,a.e({point:v,lngLat:C,originalEvent:g},m)),this._defaultPrevented=!1,this.target=d}}class Pa extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g){const m=s==="touchend"?g.changedTouches:g.touches,v=E.touchPos(d.getCanvasContainer(),m),C=v.map(M=>d.unproject(M)),R=v.reduce((M,z,W,$)=>M.add(z.div($.length)),new a.P(0,0));super(s,{points:v,point:R,lngLats:C,lngLat:d.unproject(R),originalEvent:g}),this._defaultPrevented=!1}}class f_ extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class p_{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new f_(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new Ji(s.type,this._map,s))}mouseup(s){this._map.fire(new Ji(s.type,this._map,s))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ji(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Ji(s.type,this._map,s))}mouseover(s){this._map.fire(new Ji(s.type,this._map,s))}mouseout(s){this._map.fire(new Ji(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Pa(s.type,this._map,s))}touchmove(s){this._map.fire(new Pa(s.type,this._map,s))}touchend(s){this._map.fire(new Pa(s.type,this._map,s))}touchcancel(s){this._map.fire(new Pa(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gi{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Ji(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Ji(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Js{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(a.P.convert(s),this._map.terrain)}}class Rs{constructor(s,d){this._map=s,this._tr=new Js(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&s.button===0&&(E.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const g=d;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=g,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(m.x,g.x),C=Math.max(m.x,g.x),R=Math.min(m.y,g.y),M=Math.max(m.y,g.y);E.setTransform(this._box,`translate(${v}px,${R}px)`),this._box.style.width=C-v+"px",this._box.style.height=M-R+"px"}mouseupWindow(s,d){if(!this._active||s.button!==0)return;const g=this._startPos,m=d;if(this.reset(),E.suppressClick(),g.x!==m.x||g.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(g,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new a.k(s,{originalEvent:d}))}}function Pc(b,s){if(b.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${s.length}`);const d={};for(let g=0;g<b.length;g++)d[b[g].identifier]=s[g];return d}class Hd{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const C of m)v._add(C);return v.div(m.length)}(d),this.touches=Pc(g,d)))}touchmove(s,d,g){if(this.aborted||!this.centroid)return;const m=Pc(g,d);for(const v in this.touches){const C=m[v];(!C||C.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,d,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ou{constructor(s){this.singleTap=new Hd(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,g){this.singleTap.touchstart(s,d,g)}touchmove(s,d,g){this.singleTap.touchmove(s,d,g)}touchend(s,d,g){const m=this.singleTap.touchend(s,d,g);if(m){const v=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(m)<30;if(v&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class gl{constructor(s){this._tr=new Js(s),this._zoomIn=new Ou({numTouches:1,numTaps:2}),this._zoomOut=new Ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,g){this._zoomIn.touchstart(s,d,g),this._zoomOut.touchstart(s,d,g)}touchmove(s,d,g){this._zoomIn.touchmove(s,d,g),this._zoomOut.touchmove(s,d,g)}touchend(s,d,g){const m=this._zoomIn.touchend(s,d,g),v=this._zoomOut.touchend(s,d,g),C=this._tr;return m?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(m)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const d=this._moveFunction(...s);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(s,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,d){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const m=d.length?d[0]:d;return!this._moved&&m.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(g,m))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&E.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Wd={0:1,2:2};class Du{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const d=E.mouseButton(s);this._eventButton=d}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(d,g){const m=Wd[g];return d.buttons===void 0||(d.buttons&m)!==m}(s,this._eventButton)}isValidEndEvent(s){return E.mouseButton(s)===this._eventButton}}class $d{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const Nu=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=s=>{s.preventDefault()}},qd=({enable:b,clickTolerance:s,bearingDegreesPerPixelMoved:d=.8})=>{const g=new Du({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Oo({clickTolerance:s,move:(m,v)=>({bearingDelta:(v.x-m.x)*d}),moveStateManager:g,enable:b,assignEvents:Nu})},Xd=({enable:b,clickTolerance:s,pitchDegreesPerPixelMoved:d=-.5})=>{const g=new Du({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Oo({clickTolerance:s,move:(m,v)=>({pitchDelta:(v.y-m.y)*d}),moveStateManager:g,enable:b,assignEvents:Nu})};class Ra{constructor(s,d){this._clickTolerance=s.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,d,g){return this._calculateTransform(s,d,g)}touchmove(s,d,g){if(this._active){if(!this._shouldBePrevented(g.length))return s.preventDefault(),this._calculateTransform(s,d,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,d,g){this._calculateTransform(s,d,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,g){g.length>0&&(this._active=!0);const m=Pc(g,d),v=new a.P(0,0),C=new a.P(0,0);let R=0;for(const z in m){const W=m[z],$=this._touches[z];$&&(v._add(W),C._add(W.sub($)),R++,m[z]=W)}if(this._touches=m,this._shouldBePrevented(R)||!C.mag())return;const M=C.div(R);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(R),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,d,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,g){if(!this._firstTwoTouches)return;s.preventDefault();const[m,v]=this._firstTwoTouches,C=Rc(g,d,m),R=Rc(g,d,v);if(!C||!R)return;const M=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],M,s)}touchend(s,d,g){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,C=Rc(g,d,m),R=Rc(g,d,v);C&&R||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rc(b,s,d){for(let g=0;g<b.length;g++)if(b[g].identifier===d)return s[g]}function Zd(b,s){return Math.log(b/s)/Math.LN2}class Yd extends Fu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Zd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zd(this._distance,g),pinchAround:d}}}function Kd(b,s){return 180*b.angleWith(s)/Math.PI}class Gd extends Fu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d,g){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Kd(this._vector,m),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,g=Kd(s,this._startVector);return Math.abs(g)<d}}function Bu(b){return Math.abs(b.y)>Math.abs(b.x)}class kc extends Fu{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,d,g){super.touchstart(s,d,g),this._currentTouchCount=g.length}_start(s){this._lastPoints=s,Bu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,g.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,d,g){if(this._valid!==void 0)return this._valid;const m=s.mag()>=2,v=d.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=s.y>0==d.y>0;return Bu(s)&&Bu(d)&&C}}const g_={panStep:100,bearingStep:15,pitchStep:10};class js{constructor(s){this._tr=new Js(s);const d=g_;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,g=0,m=0,v=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?m=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?m=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,m=0),{cameraAnimation:R=>{const M=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:mo,zoom:d?Math.round(M.zoom)+d*(s.shiftKey?2:1):M.zoom,bearing:M.bearing+g*this._bearingStep,pitch:M.pitch+m*this._pitchStep,offset:[-v*this._panStep,-C*this._panStep],center:M.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mo(b){return b*(2-b)}const Jd=4.000244140625;class Qs{constructor(s,d){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=s,this._tr=new Js(s),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let d=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=T.now(),m=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,d!==0&&d%Jd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=E.mousePos(this._map.getCanvas(),s),g=this._tr;this._around=d.y>g.transform.height/2-g.transform.getHorizon()?a.N.convert(this._aroundCenter?g.center:g.unproject(d)):a.N.convert(g.center),this._aroundPoint=g.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Jd?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const W=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*z))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,g=this._startZoom,m=this._easing;let v,C=!1;const R=T.now()-this._lastWheelEventTime;if(this._type==="wheel"&&g&&m&&R){const M=Math.min(R/200,1),z=m(M);v=a.y.number(g,d,z),M<1?this._frameId||(this._frameId=!0):C=!0}else v=d,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=a.b9;if(this._prevEase){const g=this._prevEase,m=(T.now()-g.start)/g.duration,v=g.easing(m+.01)-g.easing(m),C=.27/Math.sqrt(v*v+1e-4)*.01,R=Math.sqrt(.0729-C*C);d=a.b8(C,R,.25,1)}return this._prevEase={start:T.now(),duration:s,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ib{constructor(s){this._tr=new Js(s),this.reset()}reset(){this._active=!1}dblclick(s,d){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cb{constructor(){this._tap=new Ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,d,g){if(!this._swipePoint)if(this._tapTime){const m=d[0],v=s.timeStamp-this._tapTime<500,C=this._tapPoint.dist(m)<30;v&&C?g.length>0&&(this._swipePoint=m,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(s,d,g)}touchmove(s,d,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const m=d[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,d,g)}touchend(s,d,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const m=this._tap.touchend(s,d,g);m&&(this._tapTime=s.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class m_{constructor(s,d,g){this._el=s,this._mousePan=d,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class __{constructor(s,d,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=d,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qd{constructor(s,d,g,m){this._el=s,this._touchZoom=d,this._touchRotate=g,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ml{constructor(s,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=E.create("div","maplibregl-cooperative-gesture-screen",s);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=d,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=g,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(E.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,d){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:s,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Hs=b=>b.zoom||b.drag||b.pitch||b.rotate;class lr extends a.k{}function Lu(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class ef{constructor(s,d){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=m.type==="renderFrame"?void 0:m,R={needsRenderFrame:!1},M={},z={},W=m.touches,$=W?this._getMapTouches(W):void 0,Q=$?E.touchPos(this._map.getCanvas(),$):E.mousePos(this._map.getCanvas(),m);for(const{handlerName:be,handler:Ee,allowed:Pe}of this._handlers){if(!Ee.isEnabled())continue;let Fe;this._blockedByActive(z,Pe,be)?Ee.reset():Ee[v||m.type]&&(Fe=Ee[v||m.type](m,Q,$),this.mergeHandlerResult(R,M,Fe,be,C),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||Ee.isActive())&&(z[be]=Ee)}const ie={};for(const be in this._previousActiveHandlers)z[be]||(ie[be]=C);this._previousActiveHandlers=z,(Object.keys(ie).length||Lu(R))&&(this._changes.push([R,M,ie]),this._triggerRenderFrame()),(Object.keys(z).length||Lu(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=R;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jd(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,C]of this._listeners)E.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,d,g]of this._listeners)E.removeEventListener(s,d,s===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const d=this._map,g=d.getCanvasContainer();this._add("mapEvent",new p_(d,s));const m=d.boxZoom=new Rs(d,s);this._add("boxZoom",m),s.interactive&&s.boxZoom&&m.enable();const v=d.cooperativeGestures=new ml(d,s.cooperativeGestures);this._add("cooperativeGestures",v),s.cooperativeGestures&&v.enable();const C=new gl(d),R=new Ib(d);d.doubleClickZoom=new ka(R,C),this._add("tapZoom",C),this._add("clickZoom",R),s.interactive&&s.doubleClickZoom&&d.doubleClickZoom.enable();const M=new Cb;this._add("tapDragZoom",M);const z=d.touchPitch=new kc(d);this._add("touchPitch",z),s.interactive&&s.touchPitch&&d.touchPitch.enable(s.touchPitch);const W=qd(s),$=Xd(s);d.dragRotate=new __(s,W,$),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]),s.interactive&&s.dragRotate&&d.dragRotate.enable();const Q=(({enable:Fe,clickTolerance:_e})=>{const je=new Du({checkCorrectEvent:Xe=>E.mouseButton(Xe)===0&&!Xe.ctrlKey});return new Oo({clickTolerance:_e,move:(Xe,st)=>({around:st,panDelta:st.sub(Xe)}),activateOnStart:!0,moveStateManager:je,enable:Fe,assignEvents:Nu})})(s),ie=new Ra(s,d);d.dragPan=new m_(g,Q,ie),this._add("mousePan",Q),this._add("touchPan",ie,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&d.dragPan.enable(s.dragPan);const ce=new Gd,be=new Yd;d.touchZoomRotate=new Qd(g,be,ce,M),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&d.touchZoomRotate.enable(s.touchZoomRotate);const Ee=d.scrollZoom=new Qs(d,()=>this._triggerRenderFrame());this._add("scrollZoom",Ee,["mousePan"]),s.interactive&&s.scrollZoom&&d.scrollZoom.enable(s.scrollZoom);const Pe=d.keyboard=new js(d);this._add("keyboard",Pe),s.interactive&&s.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new gi(d))}_add(s,d,g){this._handlers.push({handlerName:s,handler:d,allowed:g}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hs(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,d,g){for(const m in s)if(m!==g&&(!d||d.indexOf(m)<0))return!0;return!1}_getMapTouches(s){const d=[];for(const g of s)this._el.contains(g.target)&&d.push(g);return d}mergeHandlerResult(s,d,g,m,v){if(!g)return;a.e(s,g);const C={handlerName:m,originalEvent:g.originalEvent||v};g.zoomDelta!==void 0&&(d.zoom=C),g.panDelta!==void 0&&(d.drag=C),g.pitchDelta!==void 0&&(d.pitch=C),g.bearingDelta!==void 0&&(d.rotate=C)}_applyChanges(){const s={},d={},g={};for(const[m,v,C]of this._changes)m.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(s.around=m.around),m.pinchAround!==void 0&&(s.pinchAround=m.pinchAround),m.noInertia&&(s.noInertia=m.noInertia),a.e(d,v),a.e(g,C);this._updateMapTransform(s,d,g),this._changes=[]}_updateMapTransform(s,d,g){const m=this._map,v=m._getTransformForUpdate(),C=m.terrain;if(!(Lu(s)||C&&this._terrainMovement))return this._fireEvents(d,g,!0);let{panDelta:R,zoomDelta:M,bearingDelta:z,pitchDelta:W,around:$,pinchAround:Q}=s;Q!==void 0&&($=Q),m._stop(!0),$=$||m.transform.centerPoint;const ie=v.pointLocation(R?$.sub(R):$);z&&(v.bearing+=z),W&&(v.pitch+=W),M&&(v.zoom+=M),C?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(R)):v.setLocationAtPoint(ie,$):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(ie,$)):v.setLocationAtPoint(ie,$),m._applyUpdatedTransform(v),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,g,!0)}_fireEvents(s,d,g){const m=Hs(this._eventsInProgress),v=Hs(s),C={};for(const $ in s){const{originalEvent:Q}=s[$];this._eventsInProgress[$]||(C[`${$}start`]=Q),this._eventsInProgress[$]=s[$]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const $ in C)this._fireEvent($,C[$]);v&&this._fireEvent("move",v.originalEvent);for(const $ in s){const{originalEvent:Q}=s[$];this._fireEvent($,Q)}const R={};let M;for(const $ in this._eventsInProgress){const{handlerName:Q,originalEvent:ie}=this._eventsInProgress[$];this._handlersById[Q].isActive()||(delete this._eventsInProgress[$],M=d[Q]||ie,R[`${$}end`]=M)}for(const $ in R)this._fireEvent($,R[$]);const z=Hs(this._eventsInProgress),W=(m||v)&&!z;if(W&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();$.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform($)}if(g&&W){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=ie=>ie!==0&&-this._bearingSnap<ie&&ie<this._bearingSnap;!$||!$.essential&&T.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:M})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new a.k(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new lr("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class y_ extends a.E{constructor(s,d){super(),this._renderFrameCallback=()=>{const g=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}panBy(s,d,g){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},d),g)}panTo(s,d,g){return this.easeTo(a.e({center:s},d),g)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,g){return this.easeTo(a.e({zoom:s},d),g)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,g){return this.easeTo(a.e({bearing:s},d),g)}resetNorth(s,d){return this.rotateTo(0,a.e({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}cameraForBounds(s,d){s=Te.convert(s).adjustAntiMeridian();const g=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),g,d)}_cameraForBoxAndBearing(s,d,g,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const $t=m.padding;m.padding={top:$t,bottom:$t,right:$t,left:$t}}m.padding=a.e(v,m.padding);const C=this.transform,R=C.padding,M=new Te(s,d),z=C.project(M.getNorthWest()),W=C.project(M.getNorthEast()),$=C.project(M.getSouthEast()),Q=C.project(M.getSouthWest()),ie=a.ba(-g),ce=z.rotate(ie),be=W.rotate(ie),Ee=$.rotate(ie),Pe=Q.rotate(ie),Fe=new a.P(Math.max(ce.x,be.x,Pe.x,Ee.x),Math.max(ce.y,be.y,Pe.y,Ee.y)),_e=new a.P(Math.min(ce.x,be.x,Pe.x,Ee.x),Math.min(ce.y,be.y,Pe.y,Ee.y)),je=Fe.sub(_e),Xe=(C.width-(R.left+R.right+m.padding.left+m.padding.right))/je.x,st=(C.height-(R.top+R.bottom+m.padding.top+m.padding.bottom))/je.y;if(st<0||Xe<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const St=Math.min(C.scaleZoom(C.scale*Math.min(Xe,st)),m.maxZoom),Bt=a.P.convert(m.offset),Gt=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.ba(g)),nr=Bt.add(Gt).mult(C.scale/C.zoomScale(St));return{center:C.unproject(z.add($).div(2).sub(nr)),zoom:St,bearing:g}}fitBounds(s,d,g){return this._fitInternal(this.cameraForBounds(s,d),d,g)}fitScreenCoordinates(s,d,g,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(s)),this.transform.pointLocation(a.P.convert(d)),g,m),m,v)}_fitInternal(s,d,g){return s?(delete(d=a.e(s,d)).padding,d.linear?this.easeTo(d,g):this.flyTo(d,g)):this}jumpTo(s,d){this.stop();const g=this._getTransformForUpdate();let m=!1,v=!1,C=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(m=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=a.N.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(v=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(C=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),this._applyUpdatedTransform(g),this.fire(new a.k("movestart",d)).fire(new a.k("move",d)),m&&this.fire(new a.k("zoomstart",d)).fire(new a.k("zoom",d)).fire(new a.k("zoomend",d)),v&&this.fire(new a.k("rotatestart",d)).fire(new a.k("rotate",d)).fire(new a.k("rotateend",d)),C&&this.fire(new a.k("pitchstart",d)).fire(new a.k("pitch",d)).fire(new a.k("pitchend",d)),this.fire(new a.k("moveend",d))}calculateCameraOptionsFromTo(s,d,g,m=0){const v=a.Z.fromLngLat(s,d),C=a.Z.fromLngLat(g,m),R=C.x-v.x,M=C.y-v.y,z=C.z-v.z,W=Math.hypot(R,M,z);if(W===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(R,M),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/W/this.transform.tileSize),ie=180*Math.atan2(R,-M)/Math.PI;let ce=180*Math.acos($/W)/Math.PI;return ce=z<0?90-ce:90+ce,{center:C.toLngLat(),zoom:Q,pitch:ce,bearing:ie}}easeTo(s,d){var g;this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.b9},s)).animate===!1||!s.essential&&T.prefersReducedMotion)&&(s.duration=0);const m=this._getTransformForUpdate(),v=m.zoom,C=m.bearing,R=m.pitch,M=m.padding,z="bearing"in s?this._normalizeBearing(s.bearing,C):C,W="pitch"in s?+s.pitch:R,$="padding"in s?s.padding:m.padding,Q=a.P.convert(s.offset);let ie=m.centerPoint.add(Q);const ce=m.pointLocation(ie),{center:be,zoom:Ee}=m.getConstrained(a.N.convert(s.center||ce),(g=s.zoom)!==null&&g!==void 0?g:v);this._normalizeCenter(be,m);const Pe=m.project(ce),Fe=m.project(be).sub(Pe),_e=m.zoomScale(Ee-v);let je,Xe;s.around&&(je=a.N.convert(s.around),Xe=m.locationPoint(je));const st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ee!==v,this._rotating=this._rotating||C!==z,this._pitching=this._pitching||W!==R,this._padding=!m.isPaddingEqual($),this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,st),this.terrain&&this._prepareElevation(be),this._ease(St=>{if(this._zooming&&(m.zoom=a.y.number(v,Ee,St)),this._rotating&&(m.bearing=a.y.number(C,z,St)),this._pitching&&(m.pitch=a.y.number(R,W,St)),this._padding&&(m.interpolatePadding(M,$,St),ie=m.centerPoint.add(Q)),this.terrain&&!s.freezeElevation&&this._updateElevation(St),je)m.setLocationAtPoint(je,Xe);else{const Bt=m.zoomScale(m.zoom-v),Gt=Ee>v?Math.min(2,_e):Math.max(.5,_e),nr=Math.pow(Gt,1-St),$t=m.unproject(Pe.add(Fe.mult(St*nr)).mult(Bt));m.setLocationAtPoint(m.renderWorldCopies?$t.wrap():$t,ie)}this._applyUpdatedTransform(m),this._fireMoveEvents(d)},St=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d,St)},s),this}_prepareEase(s,d,g={}){this._moving=!0,d||g.moving||this.fire(new a.k("movestart",s)),this._zooming&&!g.zooming&&this.fire(new a.k("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new a.k("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new a.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&d!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(g-(d-(g*s+this._elevationStart))/(1-s)),this._elevationTarget=d}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){const d=s.getCameraPosition(),g=this.terrain.getElevationForLngLatZoom(d.lngLat,s.zoom);if(d.altitude<g){const m=this.calculateCameraOptionsFromTo(d.lngLat,g,s.center,s.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(s){const d=[];if(this.terrain&&d.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&d.push(m=>this.transformCameraUpdate(m)),!d.length)return;const g=s.clone();for(const m of d){const v=g.clone(),{center:C,zoom:R,pitch:M,bearing:z,elevation:W}=m(v);C&&(v.center=C),R!==void 0&&(v.zoom=R),M!==void 0&&(v.pitch=M),z!==void 0&&(v.bearing=z),W!==void 0&&(v.elevation=W),g.apply(v)}this.transform.apply(g)}_fireMoveEvents(s){this.fire(new a.k("move",s)),this._zooming&&this.fire(new a.k("zoom",s)),this._rotating&&this.fire(new a.k("rotate",s)),this._pitching&&this.fire(new a.k("pitch",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const g=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.k("zoomend",s)),m&&this.fire(new a.k("rotateend",s)),v&&this.fire(new a.k("pitchend",s)),this.fire(new a.k("moveend",s))}flyTo(s,d){var g;if(!s.essential&&T.prefersReducedMotion){const tr=a.M(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tr,d)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},s);const m=this._getTransformForUpdate(),v=m.zoom,C=m.bearing,R=m.pitch,M=m.padding,z="bearing"in s?this._normalizeBearing(s.bearing,C):C,W="pitch"in s?+s.pitch:R,$="padding"in s?s.padding:m.padding,Q=a.P.convert(s.offset);let ie=m.centerPoint.add(Q);const ce=m.pointLocation(ie),{center:be,zoom:Ee}=m.getConstrained(a.N.convert(s.center||ce),(g=s.zoom)!==null&&g!==void 0?g:v);this._normalizeCenter(be,m);const Pe=m.zoomScale(Ee-v),Fe=m.project(ce),_e=m.project(be).sub(Fe);let je=s.curve;const Xe=Math.max(m.width,m.height),st=Xe/Pe,St=_e.mag();if("minZoom"in s){const tr=a.ac(Math.min(s.minZoom,v,Ee),m.minZoom,m.maxZoom),Kr=Xe/m.zoomScale(tr-v);je=Math.sqrt(Kr/St*2)}const Bt=je*je;function Gt(tr){const Kr=(st*st-Xe*Xe+(tr?-1:1)*Bt*Bt*St*St)/(2*(tr?st:Xe)*Bt*St);return Math.log(Math.sqrt(Kr*Kr+1)-Kr)}function nr(tr){return(Math.exp(tr)-Math.exp(-tr))/2}function $t(tr){return(Math.exp(tr)+Math.exp(-tr))/2}const jt=Gt(!1);let _r=function(tr){return $t(jt)/$t(jt+je*tr)},en=function(tr){return Xe*(($t(jt)*(nr(Kr=jt+je*tr)/$t(Kr))-nr(jt))/Bt)/St;var Kr},qt=(Gt(!0)-jt)/je;if(Math.abs(St)<1e-6||!isFinite(qt)){if(Math.abs(Xe-st)<1e-6)return this.easeTo(s,d);const tr=st<Xe?-1:1;qt=Math.abs(Math.log(st/Xe))/je,en=()=>0,_r=Kr=>Math.exp(tr*je*Kr)}return s.duration="duration"in s?+s.duration:1e3*qt/("screenSpeed"in s?+s.screenSpeed/je:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=C!==z,this._pitching=W!==R,this._padding=!m.isPaddingEqual($),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(be),this._ease(tr=>{const Kr=tr*qt,Yn=1/_r(Kr);m.zoom=tr===1?Ee:v+m.scaleZoom(Yn),this._rotating&&(m.bearing=a.y.number(C,z,tr)),this._pitching&&(m.pitch=a.y.number(R,W,tr)),this._padding&&(m.interpolatePadding(M,$,tr),ie=m.centerPoint.add(Q)),this.terrain&&!s.freezeElevation&&this._updateElevation(tr);const on=tr===1?be:m.unproject(Fe.add(_e.mult(en(Kr))).mult(Yn));m.setLocationAtPoint(m.renderWorldCopies?on.wrap():on,ie),this._applyUpdatedTransform(m),this._fireMoveEvents(d)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}return s||(g=this.handlers)===null||g===void 0||g.stop(!1),this}_ease(s,d,g){g.animate===!1||g.duration===0?(s(1),d()):(this._easeStart=T.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,d){s=a.b3(s,-180,180);const g=Math.abs(s-d);return Math.abs(s-360-d)<g&&(s-=360),Math.abs(s+360-d)<g&&(s+=360),s}_normalizeCenter(s,d){if(!d.renderWorldCopies||d.lngRange)return;const g=s.lng-d.center.lng;s.lng+=g>180?-360:g<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const _l={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class yl{constructor(s=_l){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const g=this._map._getUIString(`AttributionControl.${d}`);s.title=g,s.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const d=this._map.style.sourceCaches;for(const m in d){const v=d[m];if(v.used||v.usedForTerrain){const C=v.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter(m=>String(m).trim()),s.sort((m,v)=>m.length-v.length),s=s.filter((m,v)=>{for(let C=v+1;C<s.length;C++)if(s[C].indexOf(m)>=0)return!1;return!0});const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class tf{constructor(s={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const g=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const d=E.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,g=d?this._queue.concat(d):this._queue;for(const m of g)if(m.id===s)return void(m.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const g of d)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var rf=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Pb extends a.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,d){this.sourceCache.update(s,d),this._renderableTilesKeys=[];const g={};for(const m of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))g[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aP(m.posMatrix,0,a.X,0,a.X,0,1),this._tiles[m.key]=new xn(m,this.tileSize));for(const m in this._tiles)g[m]||delete this._tiles[m]}freeRtt(s){for(const d in this._tiles){const g=this._tiles[d];(!s||g.tileID.equals(s)||g.tileID.isChildOf(s)||s.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const d={};for(const g of this._renderableTilesKeys){const m=this._tiles[g].tileID;if(m.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),a.aP(v.posMatrix,0,a.X,0,a.X,0,1),d[g]=v}else if(m.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=m.canonical.z-s.canonical.z,R=m.canonical.x-(m.canonical.x>>C<<C),M=m.canonical.y-(m.canonical.y>>C<<C),z=a.X>>C;a.aP(v.posMatrix,0,z,0,z,0,1),a.J(v.posMatrix,v.posMatrix,[-R*z,-M*z,0]),d[g]=v}else if(s.canonical.isChildOf(m.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=s.canonical.z-m.canonical.z,R=s.canonical.x-(s.canonical.x>>C<<C),M=s.canonical.y-(s.canonical.y>>C<<C),z=a.X>>C;a.aP(v.posMatrix,0,a.X,0,a.X,0,1),a.J(v.posMatrix,v.posMatrix,[R*z,M*z,0]),a.K(v.posMatrix,v.posMatrix,[1/2**C,1/2**C,0]),d[g]=v}}return d}getSourceTile(s,d){const g=this.sourceCache._source;let m=s.overscaledZ-this.deltaZoom;if(m>g.maxzoom&&(m=g.maxzoom),m<g.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&d)for(;m>=g.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(m--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=s)}}class nf{constructor(s,d,g){this.painter=s,this.sourceCache=new Pb(d),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,d,g,m=a.X){var v;if(!(d>=0&&d<m&&g>=0&&g<m))return 0;const C=this.getTerrainData(s),R=(v=C.tile)===null||v===void 0?void 0:v.dem;if(!R)return 0;const M=function(ce,be,Ee){var Pe=be[0],Fe=be[1];return ce[0]=Ee[0]*Pe+Ee[4]*Fe+Ee[12],ce[1]=Ee[1]*Pe+Ee[5]*Fe+Ee[13],ce}([],[d/m*a.X,g/m*a.X],C.u_terrain_matrix),z=[M[0]*R.dim,M[1]*R.dim],W=Math.floor(z[0]),$=Math.floor(z[1]),Q=z[0]-W,ie=z[1]-$;return R.get(W,$)*(1-Q)*(1-ie)+R.get(W+1,$)*Q*(1-ie)+R.get(W,$+1)*(1-Q)*ie+R.get(W+1,$+1)*Q*ie}getElevationForLngLatZoom(s,d){if(!a.bb(d,s.wrap()))return 0;const{tileID:g,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(s,d);return this.getElevation(g,m%a.X,v%a.X,a.X)}getElevation(s,d,g,m=a.X){return this.getDEMElevation(s,d,g,m)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new De(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new De(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const d=this.sourceCache.getSourceTile(s,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const m=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new De(m,d.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),d.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const g=d&&d+d.tileID.key+s.key;if(g&&!this._demMatrixCache[g]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-d.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=m?v=s.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>v<<v),R=s.canonical.y-(s.canonical.y>>v<<v),M=a.bc(new Float64Array(16),[1/(a.X<<v),1/(a.X<<v),0]);a.J(M,M,[C*a.X,R*a.X,0]),this._demMatrixCache[s.key]={matrix:M,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(s){const d=this.painter,g=d.width/devicePixelRatio,m=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new De(d.context,{width:g,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new De(d.context,{width:g,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(g,m,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,g,m))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,C=0;v<this._coordsTextureSize;v++)for(let R=0;R<this._coordsTextureSize;R++,C+=4)d[C+0]=255&R,d[C+1]=255&v,d[C+2]=R>>8<<4|v>>8,d[C+3]=0;const g=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),m=new De(s,g,s.gl.RGBA,{premultiply:!1});return m.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),g=this.painter.context,m=g.gl,v=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,R-C-1,1,1,m.RGBA,m.UNSIGNED_BYTE,d),g.bindFramebuffer.set(null);const M=d[0]+(d[2]>>4<<8),z=d[1]+((15&d[2])<<8),W=this.coordsIndex[255-d[3]],$=W&&this.sourceCache.getTileByID(W);if(!$)return null;const Q=this._coordsTextureSize,ie=(1<<$.tileID.canonical.z)*Q;return new a.Z(($.tileID.canonical.x*Q+M)/ie+$.tileID.wrap,($.tileID.canonical.y*Q+z)/ie,this.getElevation($.tileID,M,z,Q))}depthAtPoint(s){const d=new Uint8Array(4),g=this.painter.context,m=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,d),g.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,d=new a.bd,g=new a.aY,m=this.meshSize,v=a.X/m,C=m*m;for(let $=0;$<=m;$++)for(let Q=0;Q<=m;Q++)d.emplaceBack(Q*v,$*v,0);for(let $=0;$<C;$+=m+1)for(let Q=0;Q<m;Q++)g.emplaceBack(Q+$,m+Q+$+1,m+Q+$+2),g.emplaceBack(Q+$,m+Q+$+2,Q+$+1);const R=d.length,M=R+2*(m+1);for(const $ of[0,1])for(let Q=0;Q<=m;Q++)for(const ie of[0,1])d.emplaceBack(Q*v,$*a.X,ie);for(let $=0;$<2*m;$+=2)g.emplaceBack(M+$,M+$+1,M+$+3),g.emplaceBack(M+$,M+$+3,M+$+2),g.emplaceBack(R+$,R+$+3,R+$+1),g.emplaceBack(R+$,R+$+2,R+$+3);const z=d.length,W=z+2*(m+1);for(const $ of[0,1])for(let Q=0;Q<=m;Q++)for(const ie of[0,1])d.emplaceBack($*a.X,Q*v,ie);for(let $=0;$<2*m;$+=2)g.emplaceBack(z+$,z+$+1,z+$+3),g.emplaceBack(z+$,z+$+3,z+$+2),g.emplaceBack(W+$,W+$+3,W+$+1),g.emplaceBack(W+$,W+$+2,W+$+3);return this._mesh=new Cu(s.createVertexBuffer(d,rf.members),s.createIndexBuffer(g),a.a0.simpleSegment(0,0,d.length,g.length)),this._mesh}getMeshFrameDelta(s){return 2*Math.PI*a.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,d){var g;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(s,d);return(g=this.getMinMaxElevation(m).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(s){const d=this.getTerrainData(s).tile,g={minElevation:null,maxElevation:null};return d&&d.dem&&(g.minElevation=d.dem.min*this.exaggeration,g.maxElevation=d.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(s,d){const g=a.Z.fromLngLat(s.wrap()),m=(1<<d)*a.X,v=g.x*m,C=g.y*m,R=Math.floor(v/a.X),M=Math.floor(C/a.X);return{tileID:new a.S(d,0,d,R,M),mercatorX:v,mercatorY:C}}}class Rb{constructor(s,d,g){this._context=s,this._size=d,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new De(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(g.texture),{id:s,fbo:d,texture:g,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>s.id!==d),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const vl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class v_{constructor(s,d){this.painter=s,this.terrain=d,this.pool=new Rb(s.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(g=>!s._layers[g].isHidden(d)),this._coordsDescendingInv={};for(const g in s.sourceCaches){this._coordsDescendingInv[g]={};const m=s.sourceCaches[g].getVisibleCoordinates();for(const v of m){const C=this.terrain.sourceCache.getTerrainCoords(v);for(const R in C)this._coordsDescendingInv[g][R]||(this._coordsDescendingInv[g][R]=[]),this._coordsDescendingInv[g][R].push(C[R])}}this._coordsDescendingInvStr={};for(const g of s._order){const m=s._layers[g],v=m.source;if(vl[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const C in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][C]=this._coordsDescendingInv[v][C].map(R=>R.key).sort().join()}}for(const g of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][g.tileID.key];v&&v!==g.rttCoords[m]&&(g.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const d=s.type,g=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(vl[d]&&(this._prevType&&vl[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(s.id),!m))return!0;if(vl[this._prevType]||vl[d]&&m){this._prevType=d;const v=this._stacks.length-1,C=this._stacks[v]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(h_(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[v]){const z=this.pool.getObjectForId(R.rtt[v].id);if(z.stamp===R.rtt[v].stamp){this.pool.useObject(z);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),R.rtt[v]={id:M.id,stamp:M.stamp},g.context.bindFramebuffer.set(M.fbo.framebuffer),g.context.clear({color:a.aM.transparent,stencil:0}),g.currentStencilSource=void 0;for(let z=0;z<C.length;z++){const W=g.style._layers[C[z]],$=W.source?this._coordsDescendingInv[W.source][R.tileID.key]:[R.tileID];g.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),g._renderTileClippingMasks(W,$),g.renderLayer(g,g.style.sourceCaches[W.source],W,$),W.source&&(R.rttCoords[W.source]=this._coordsDescendingInvStr[W.source][R.tileID.key])}}return h_(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),vl[d]}return!1}}const sf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},b_=p,kb={hash:!1,interactive:!0,bearingSnap:7,attributionControl:_l,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},of=b=>{b.touchstart=b.dragStart,b.touchmoveWindow=b.dragMove,b.touchend=b.dragEnd},Mb={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ob{constructor(s,d,g=!1){this.mousedown=C=>{this.startMouse(a.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),E.mousePos(this.element,C)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,E.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=s.dragRotate._mouseRotate.getClickTolerance(),v=s.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=qd({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:R,bearingDegreesPerPixelMoved:M=.8})=>{const z=new $d;return new Oo({clickTolerance:R,move:(W,$)=>({bearingDelta:($.x-W.x)*M}),moveStateManager:z,enable:C,assignEvents:of})})({clickTolerance:m,enable:!0}),this.map=s,g&&(this.mousePitch=Xd({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:R,pitchDegreesPerPixelMoved:M=-.5})=>{const z=new $d;return new Oo({clickTolerance:R,move:(W,$)=>({pitchDelta:($.y-W.y)*M}),moveStateManager:z,enable:C,assignEvents:of})})({clickTolerance:v,enable:!0})),E.addEventListener(d,"mousedown",this.mousedown),E.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(d,"touchcancel",this.reset)}startMouse(s,d){this.mouseRotate.dragStart(s,d),this.mousePitch&&this.mousePitch.dragStart(s,d),E.disableDrag()}startTouch(s,d){this.touchRotate.dragStart(s,d),this.touchPitch&&this.touchPitch.dragStart(s,d),E.disableDrag()}moveMouse(s,d){const g=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(s,d)||{};if(m&&g.setBearing(g.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(s,d)||{};v&&g.setPitch(g.getPitch()+v)}}moveTouch(s,d){const g=this.map,{bearingDelta:m}=this.touchRotate.dragMove(s,d)||{};if(m&&g.setBearing(g.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(s,d)||{};v&&g.setPitch(g.getPitch()+v)}}off(){const s=this.element;E.removeEventListener(s,"mousedown",this.mousedown),E.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}}let ks;function Zn(b,s,d){const g=new a.N(b.lng,b.lat);if(b=new a.N(b.lng,b.lat),s){const m=new a.N(b.lng-360,b.lat),v=new a.N(b.lng+360,b.lat),C=d.locationPoint(b).distSqr(s);d.locationPoint(m).distSqr(s)<C?b=m:d.locationPoint(v).distSqr(s)<C&&(b=v)}for(;Math.abs(b.lng-d.center.lng)>180;){const m=d.locationPoint(b);if(m.x>=0&&m.y>=0&&m.x<=d.width&&m.y<=d.height)break;b.lng>d.center.lng?b.lng-=360:b.lng+=360}return b.lng!==g.lng&&d.locationPoint(b).y>d.height/2-d.getHorizon()?b:g}const bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zu(b,s,d){const g=b.classList;for(const m in bl)g.remove(`maplibregl-${d}-anchor-${m}`);g.add(`maplibregl-${d}-anchor-${s}`)}class Uu extends a.E{constructor(s){if(super(),this._onKeyPress=d=>{const g=d.code,m=d.charCode||d.keyCode;g!=="Space"&&g!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=d=>{const g=d.originalEvent.target,m=this._element;this._popup&&(g===m||m.contains(g))&&this.togglePopup()},this._update=d=>{var g;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Zn(this._lngLat,this._flatPos,this._map.transform):(g=this._lngLat)===null||g===void 0?void 0:g.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${bl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${v}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div");const d=E.createNS("http://www.w3.org/2000/svg","svg"),g=41,m=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${g}px`),d.setAttributeNS(null,"width",`${m}px`),d.setAttributeNS(null,"viewBox",`0 0 ${m} ${g}`);const v=E.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const C=E.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const R=E.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Pe of M){const Fe=E.createNS("http://www.w3.org/2000/svg","ellipse");Fe.setAttributeNS(null,"opacity","0.04"),Fe.setAttributeNS(null,"cx","10.5"),Fe.setAttributeNS(null,"cy","5.80029008"),Fe.setAttributeNS(null,"rx",Pe.rx),Fe.setAttributeNS(null,"ry",Pe.ry),R.appendChild(Fe)}const z=E.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const W=E.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(W);const $=E.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const Q=E.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(Q);const ie=E.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const ce=E.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=E.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const Ee=E.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#FFFFFF"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962"),ce.appendChild(be),ce.appendChild(Ee),C.appendChild(R),C.appendChild(z),C.appendChild($),C.appendChild(ie),C.appendChild(ce),d.appendChild(C),d.setAttributeNS(null,"height",g*this._scale+"px"),d.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(d),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),zu(this._element,this._anchor,"marker"),s&&s.className)for(const d of s.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.N.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const m=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var d,g;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),C=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,C)-v<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/m.transform._pixelPerMeter,M=Math.sin(m.getPitch()*Math.PI/180)*R,z=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),W=m.transform.lngLatToCameraDepth(this._lngLat,C+M)-z>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&W&&this._popup.remove(),this._element.style.opacity=W?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,d){return s===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const x_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mc=0,Oc=!1;const _o={maxWidth:100,unit:"metric"};function Dc(b,s,d){const g=d&&d.maxWidth||100,m=b._container.clientHeight/2,v=b.unproject([0,m]),C=b.unproject([g,m]),R=v.distanceTo(C);if(d&&d.unit==="imperial"){const M=3.2808*R;M>5280?mr(s,g,M/5280,b._getUIString("ScaleControl.Miles")):mr(s,g,M,b._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?mr(s,g,R/1852,b._getUIString("ScaleControl.NauticalMiles")):R>=1e3?mr(s,g,R/1e3,b._getUIString("ScaleControl.Kilometers")):mr(s,g,R,b._getUIString("ScaleControl.Meters"))}function mr(b,s,d,g){const m=function(v){const C=Math.pow(10,`${Math.floor(v)}`.length-1);let R=v/C;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(R),C*R}(d);b.style.width=s*(m/d)+"px",b.innerHTML=`${m}&nbsp;${g}`}const Vr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ju(b){if(b){if(typeof b=="number"){const s=Math.round(Math.abs(b)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,b),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-b),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(b,0),right:new a.P(-b,0)}}if(b instanceof a.P||Array.isArray(b)){const s=a.P.convert(b);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(b.center||[0,0]),top:a.P.convert(b.top||[0,0]),"top-left":a.P.convert(b["top-left"]||[0,0]),"top-right":a.P.convert(b["top-right"]||[0,0]),bottom:a.P.convert(b.bottom||[0,0]),"bottom-left":a.P.convert(b["bottom-left"]||[0,0]),"bottom-right":a.P.convert(b["bottom-right"]||[0,0]),left:a.P.convert(b.left||[0,0]),right:a.P.convert(b.right||[0,0])}}return ju(new a.P(0,0))}const af=p;u.AJAXError=a.bh,u.Evented=a.E,u.LngLat=a.N,u.MercatorCoordinate=a.Z,u.Point=a.P,u.addProtocol=a.bi,u.config=a.a,u.removeProtocol=a.bj,u.AttributionControl=yl,u.BoxZoomHandler=Rs,u.CanvasSource=Ar,u.CooperativeGesturesHandler=ml,u.DoubleClickZoomHandler=ka,u.DragPanHandler=m_,u.DragRotateHandler=__,u.EdgeInsets=fl,u.FullscreenControl=class extends a.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var s;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=d==null?void 0:d.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Br,u.GeolocateControl=class extends a.E{constructor(b){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const d=new a.N(s.coords.longitude,s.coords.latitude),g=s.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),C=Te.fromLngLat(d,g);this._map.fitBounds(C,v,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const d=new a.N(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Oc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uu({element:this._dotElement}),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},x_,b)}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(s=!1){if(ks!==void 0&&!s)return ks;if(window.navigator.permissions===void 0)return ks=!!window.navigator.geolocation,ks;try{ks=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ks=!!window.navigator.geolocation}return ks})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mc=0,Oc=!1}_isOutOfMapMaxBounds(b){const s=this._map.getMaxBounds(),d=b.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),s=b.getSouthEast(),d=b.getNorthEast(),g=s.distanceTo(d),m=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mc--,Oc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mc++,Mc>1?(b={maximumAge:6e5,timeout:0},Oc=!0):(b=this.options.positionOptions,Oc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Ru,u.ImageSource=Jt,u.KeyboardHandler=js,u.LngLatBounds=Te,u.LogoControl=tf,u.Map=class extends y_{constructor(b){a.bf.mark(a.bg.create);const s=Object.assign(Object.assign({},kb),b);if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pl(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies),{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new vn,this._controls=[],this._mapId=a.a4(),this._contextLost=d=>{d.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:d}))},this._contextRestored=d=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:d}))},this._onMapScroll=d=>{if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=s.preserveDrawingBuffer===!0,this._antialias=s.antialias===!0,this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},sf),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new j(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let d=!1;const g=Ec(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{d?g(m):d=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ef(this,s),this._hash=s.hash&&new Ru(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,a.e({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new yl(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new tf,s.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.k(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.k(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new a.k("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(b,s){if(s===void 0&&(s=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=b.onAdd(this);this._controls.push(b);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(d,g.firstChild):g.appendChild(d),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(b);return s>-1&&this._controls.splice(s,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,s,d,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,s,d,g)}resize(b){var s;const d=this._containerDimensions(),g=d[0],m=d[1],v=this._getClampedPixelRatio(g,m);if(this._resizeCanvas(g,m,v),this.painter.resize(g,m,v),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const M=this._getClampedPixelRatio(g,m);this._resizeCanvas(g,m,M),this.painter.resize(g,m,M)}this.transform.resize(g,m),(s=this._requestedCameraState)===null||s===void 0||s.resize(g,m);const C=!this._moving;return C&&(this.stop(),this.fire(new a.k("movestart",b)).fire(new a.k("move",b))),this.fire(new a.k("resize",b)),C&&this.fire(new a.k("moveend",b)),this}_getClampedPixelRatio(b,s){const{0:d,1:g}=this._maxCanvasSize,m=this.getPixelRatio(),v=b*m,C=s*m;return Math.min(v>d?d/v:1,C>g?g/C:1)*m}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(Te.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(a.N.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.pointLocation(a.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,s,d){if(b==="mouseenter"||b==="mouseover"){let g=!1;return{layers:s,listener:d,delegates:{mousemove:v=>{const C=s.filter(M=>this.getLayer(M)),R=C.length!==0?this.queryRenderedFeatures(v.point,{layers:C}):[];R.length?g||(g=!0,d.call(this,new Ji(b,this,v.originalEvent,{features:R}))):g=!1},mouseout:()=>{g=!1}}}}if(b==="mouseleave"||b==="mouseout"){let g=!1;return{layers:s,listener:d,delegates:{mousemove:C=>{const R=s.filter(M=>this.getLayer(M));(R.length!==0?this.queryRenderedFeatures(C.point,{layers:R}):[]).length?g=!0:g&&(g=!1,d.call(this,new Ji(b,this,C.originalEvent)))},mouseout:C=>{g&&(g=!1,d.call(this,new Ji(b,this,C.originalEvent)))}}}}{const g=m=>{const v=s.filter(R=>this.getLayer(R)),C=v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[];C.length&&(m.features=C,d.call(this,m),delete m.features)};return{layers:s,listener:d,delegates:{[b]:g}}}}_saveDelegatedListener(b,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(s)}_removeDelegatedListener(b,s,d){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const g=this._delegatedListeners[b];for(let m=0;m<g.length;m++){const v=g[m];if(v.listener===d&&v.layers.length===s.length&&v.layers.every(C=>s.includes(C))){for(const C in v.delegates)this.off(C,v.delegates[C]);return void g.splice(m,1)}}}on(b,s,d){if(d===void 0)return super.on(b,s);const g=this._createDelegatedListener(b,typeof s=="string"?[s]:s,d);this._saveDelegatedListener(b,g);for(const m in g.delegates)this.on(m,g.delegates[m]);return this}once(b,s,d){if(d===void 0)return super.once(b,s);const g=typeof s=="string"?[s]:s,m=this._createDelegatedListener(b,g,d);for(const v in m.delegates){const C=m.delegates[v];m.delegates[v]=(...R)=>{this._removeDelegatedListener(b,g,d),C(...R)}}this._saveDelegatedListener(b,m);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(b,s,d){return d===void 0?super.off(b,s):(this._removeDelegatedListener(b,typeof s=="string"?[s]:s,d),this)}queryRenderedFeatures(b,s){if(!this.style)return[];let d;const g=b instanceof a.P||Array.isArray(b),m=g?b:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(g?{}:b)||{},m instanceof a.P||typeof m[0]=="number")d=[a.P.convert(m)];else{const v=a.P.convert(m[0]),C=a.P.convert(m[1]);d=[v,new a.P(C.x,v.y),C,new a.P(v.x,C.y),v]}return this.style.queryRenderedFeatures(d,s,this.transform)}querySourceFeatures(b,s){return this.style.querySourceFeatures(b,s)}setStyle(b,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(b,s))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const s=this._locale[b];if(s==null)throw new Error(`Missing UI string '${b}'`);return s}_updateStyle(b,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,s));const d=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new Xo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,s,d):this.style.loadJSON(b,s,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,s){if(typeof b=="string"){const d=this._requestManager.transformRequest(b,"Style");a.h(d,new AbortController).then(g=>{this._updateDiff(g.data,s)}).catch(g=>{g&&this.fire(new a.j(g))})}else typeof b=="object"&&this._updateDiff(b,s)}_updateDiff(b,s){try{this.style.setState(b,s)&&this._update(!0)}catch(d){a.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(b,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(b,s){return this._lazyInitEmptyStyle(),this.style.addSource(b,s),this._update(!0)}isSourceLoaded(b){const s=this.style&&this.style.sourceCaches[b];if(s!==void 0)return s.loaded();this.fire(new a.j(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const s=this.style.sourceCaches[b.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&s.reload();for(const d in this.style._layers){const g=this.style._layers[d];g.type==="hillshade"&&g.source===b.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nf(this.painter,s,b),this.painter.renderToTexture=new v_(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==b.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:b})),this}getTerrain(){var b,s;return(s=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const s in b){const d=b[s]._tiles;for(const g in d){const m=d[g];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,s,d={}){const{pixelRatio:g=1,sdf:m=!1,stretchX:v,stretchY:C,content:R,textFitWidth:M,textFitHeight:z}=d;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:W,height:$,data:Q}=s,ie=s;return this.style.addImage(b,{data:new a.R({width:W,height:$},new Uint8Array(Q)),pixelRatio:g,stretchX:v,stretchY:C,content:R,textFitWidth:M,textFitHeight:z,sdf:m,version:0,userImage:ie}),ie.onAdd&&ie.onAdd(this,b),this}}{const{width:W,height:$,data:Q}=T.getImageData(s);this.style.addImage(b,{data:new a.R({width:W,height:$},Q),pixelRatio:g,stretchX:v,stretchY:C,content:R,textFitWidth:M,textFitHeight:z,sdf:m,version:0})}}updateImage(b,s){const d=this.style.getImage(b);if(!d)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof HTMLImageElement||a.b(s)?T.getImageData(s):s,{width:m,height:v,data:C}=g;if(m===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==d.data.width||v!==d.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(s instanceof HTMLImageElement||a.b(s));return d.data.replace(C,R),this.style.updateImage(b,d),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return U.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,s){return this._lazyInitEmptyStyle(),this.style.addLayer(b,s),this._update(!0)}moveLayer(b,s){return this.style.moveLayer(b,s),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,s,d){return this.style.setLayerZoomRange(b,s,d),this._update(!0)}setFilter(b,s,d={}){return this.style.setFilter(b,s,d),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,s,d,g={}){return this.style.setPaintProperty(b,s,d,g),this._update(!0)}getPaintProperty(b,s){return this.style.getPaintProperty(b,s)}setLayoutProperty(b,s,d,g={}){return this.style.setLayoutProperty(b,s,d,g),this._update(!0)}getLayoutProperty(b,s){return this.style.getLayoutProperty(b,s)}setGlyphs(b,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,s,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,s,d,g=>{g||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,s,d=>{d||this._update(!0)}),this}setLight(b,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(b){return this._lazyInitEmptyStyle(),this.style.setSky(b),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,s){return this.style.setFeatureState(b,s),this._update()}removeFeatureState(b,s){return this.style.removeFeatureState(b,s),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,s=0;return this._container&&(b=this._container.clientWidth||400,s=this._container.clientHeight||300),[b,s]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const s=this._canvasContainer=E.create("div","maplibregl-canvas-container",b);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),g=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],g);const m=this._controlContainer=E.create("div","maplibregl-control-container",b),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=E.create("div",`maplibregl-ctrl-${C} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,s,d){this._canvas.width=Math.floor(d*b),this._canvas.height=Math.floor(d*s),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const b={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{s={requestedAttributes:b},g&&(s.statusMessage=g.statusMessage,s.type=g.type)},{once:!0});const d=this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b);if(!d){const g="Failed to initialize WebGL";throw s?(s.message=g,new Error(JSON.stringify(s))):new Error(g)}this.painter=new Pu(d,this.transform),k.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=T.now();this.style.zoomHistory.update(m,v);const C=new a.z(m,{now:v,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=C.crossFadingFactor();R===1&&R===this._crossFadingFactor||(d=!0,this._crossFadingFactor=R),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(b=>{a.bf.frame(b),this._frameRequest=null,this._render(b)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return b_}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Ji,u.MapTouchEvent=Pa,u.MapWheelEvent=f_,u.Marker=Uu,u.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const s=this._map.getZoom(),d=s===this._map.getMaxZoom(),g=s===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,d)=>{const g=this._map._getUIString(`NavigationControl.${d}`);s.title=g,s.setAttribute("aria-label",g)},this.options=a.e({},Mb,b),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ob(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,s){const d=E.create("button",b,this._container);return d.type="button",d.addEventListener("click",s),d}},u.Popup=class extends a.E{constructor(b){super(),this.remove=()=>(this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Zn(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!s)return;const g=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const v=ju(this.options.offset);if(!m){const R=this._container.offsetWidth,M=this._container.offsetHeight;let z;z=g.y+v.bottom.y<M?["top"]:g.y>this._map.transform.height-M?["bottom"]:[],g.x<R/2?z.push("left"):g.x>this._map.transform.width-R/2&&z.push("right"),m=z.length===0?"bottom":z.join("-")}let C=g.add(v[m]);this.options.subpixelPositioning||(C=C.round()),E.setTransform(this._container,`${bl[m]} translate(${C.x}px,${C.y}px)`),zu(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Vr),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=a.N.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const s=document.createDocumentFragment(),d=document.createElement("body");let g;for(d.innerHTML=b;g=d.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Vu);b&&b.focus()}},u.RasterDEMTileSource=sr,u.RasterTileSource=yt,u.ScaleControl=class{constructor(b){this._onMove=()=>{Dc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Dc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_o),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=Qs,u.Style=Xo,u.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=kc,u.TwoFingersTouchRotateHandler=Gd,u.TwoFingersTouchZoomHandler=Yd,u.TwoFingersTouchZoomRotateHandler=Qd,u.VectorTileSource=Ct,u.VideoSource=Zt,u.addSourceType=(b,s)=>a._(void 0,void 0,void 0,function*(){if(Jr(b))throw new Error(`A source type called "${b}" already exists.`);((d,g)=>{Fr[d]=g})(b,s)}),u.clearPrewarmedResources=function(){const b=ir;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Sr),ir=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return Zr().getRTLTextPluginStatus()},u.getVersion=function(){return af},u.getWorkerCount=function(){return Et.workerCount},u.getWorkerUrl=function(){return a.a.WORKER_URL},u.importScriptInWorkers=function(b){return nn().broadcast("IS",b)},u.prewarm=function(){ur().acquire(Sr)},u.setMaxParallelImageRequests=function(b){a.a.MAX_PARALLEL_IMAGE_REQUESTS=b},u.setRTLTextPlugin=function(b,s){return Zr().setRTLTextPlugin(b,s)},u.setWorkerCount=function(b){Et.workerCount=b},u.setWorkerUrl=function(b){a.a.WORKER_URL=b}});var l=t;return l})})(uI);var iO=uI.exports;const wi=zw(iO);function $2(r){const t=document.createElement("canvas");t.width=32,t.height=32;const n=t.getContext("2d"),i=1,l=31,u=i+2,a=l-2,p=i+1,y=l-1,x=new Path2D;return x.moveTo(u,i),x.lineTo(a,i),x.bezierCurveTo(y,p,y,p,l,u),x.lineTo(l,a),x.bezierCurveTo(y,y,y,y,a,l),x.lineTo(u,l),x.bezierCurveTo(p,y,p,y,i,a),x.lineTo(i,u),x.bezierCurveTo(p,p,p,p,u,i),x.closePath(),n.fillStyle=r.fill,n.fill(x),n.strokeStyle=r.stroke,n.stroke(x),[n.getImageData(0,0,32,32),{content:[u,u,a,a],stretchX:[[u,a]],stretchY:[[u,a]]}]}var sO=Ve("<div><!></div>");function oO(r,e){zt(e,!0);let t=fe(e,"map",15),n=fe(e,"zoom",15),i=fe(e,"bounds",15),l=fe(e,"center",15),u=null,a=e.style,p=yn({map:void 0});qv("map",p);let y=Ks(n()),x=Ks(l());const T=()=>{t()&&Ks(n())!==y&&(y=t().getZoom(),t().setZoom(n()))},E=()=>{t()&&l().toString()!=wi.LngLat.convert(x).toString()&&(x=t().getCenter(),t().setCenter(l()))},k=()=>{e.style!=a&&(!p.map&&u?F(u):p.map&&p.map.setStyle(e.style||null))},F=V=>{if(!e.style)return;let U;try{U=new wi.Map({container:V,zoom:n(),bounds:i(),center:l(),style:e.style,transformRequest:e.transformRequest,attributionControl:e.attribution===!1||e.attribution===void 0?e.attribution:{customAttribution:e.attribution}}),U.addImage("shield",...$2({fill:"hsl(0, 0%, 98%)",stroke:"hsl(0, 0%, 75%)"})),U.addImage("shield-dark",...$2({fill:"hsl(0, 0%, 16%)",stroke:"hsl(0, 0%, 30%)"}));const j=new wi.ScaleControl({maxWidth:100,unit:"metric"});U.addControl(j,KM&&window.innerWidth<768?"top-left":"bottom-left"),U.on("load",()=>{t(U),p.map=U,T(),E(),i(U.getBounds()),a=e.style,U.on("moveend",()=>{n(U.getZoom()),y=n(),l(U.getCenter()),x=l(),i(U.getBounds())})})}catch(j){console.log(j)}return{destroy(){U==null||U.remove(),p.map=void 0}}};Xr(k),Xr(T),Xr(E);var D=sO(),N=Be(D);{var B=V=>{var U=it(),j=xe(U);fr(j,()=>e.children),K(V,U)};et(N,V=>{e.children&&V(B)})}ke(D),WM(D,V=>F==null?void 0:F(V)),Cs(D,V=>u=V,()=>u),ct(()=>Di(D,1,rl(e.class))),K(r,D),Ut()}const Uw="-",aO=r=>{const e=cO(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:u=>{const a=u.split(Uw);return a[0]===""&&a.length!==1&&a.shift(),dI(a,e)||lO(u)},getConflictingClassGroupIds:(u,a)=>{const p=t[u]||[];return a&&n[u]?[...p,...n[u]]:p}}},dI=(r,e)=>{var u;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),i=n?dI(r.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const l=r.join(Uw);return(u=e.validators.find(({validator:a})=>a(l)))==null?void 0:u.classGroupId},q2=/^\[(.+)\]$/,lO=r=>{if(q2.test(r)){const e=q2.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},cO=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return hO(Object.entries(r.classGroups),t).forEach(([l,u])=>{P0(u,n,l,e)}),n},P0=(r,e,t,n)=>{r.forEach(i=>{if(typeof i=="string"){const l=i===""?e:X2(e,i);l.classGroupId=t;return}if(typeof i=="function"){if(uO(i)){P0(i(n),e,t,n);return}e.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([l,u])=>{P0(u,X2(e,l),t,n)})})},X2=(r,e)=>{let t=r;return e.split(Uw).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},uO=r=>r.isThemeGetter,hO=(r,e)=>e?r.map(([t,n])=>{const i=n.map(l=>typeof l=="string"?e+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([u,a])=>[e+u,a])):l);return[t,i]}):r,dO=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const i=(l,u)=>{t.set(l,u),e++,e>r&&(e=0,n=t,t=new Map)};return{get(l){let u=t.get(l);if(u!==void 0)return u;if((u=n.get(l))!==void 0)return i(l,u),u},set(l,u){t.has(l)?t.set(l,u):i(l,u)}}},fI="!",fO=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,i=e[0],l=e.length,u=a=>{const p=[];let y=0,x=0,T;for(let N=0;N<a.length;N++){let B=a[N];if(y===0){if(B===i&&(n||a.slice(N,N+l)===e)){p.push(a.slice(x,N)),x=N+l;continue}if(B==="/"){T=N;continue}}B==="["?y++:B==="]"&&y--}const E=p.length===0?a:a.substring(x),k=E.startsWith(fI),F=k?E.substring(1):E,D=T&&T>x?T-x:void 0;return{modifiers:p,hasImportantModifier:k,baseClassName:F,maybePostfixModifierPosition:D}};return t?a=>t({className:a,parseClassName:u}):u},pO=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},gO=r=>({cache:dO(r.cacheSize),parseClassName:fO(r),...aO(r)}),mO=/\s+/,_O=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:i}=e,l=[],u=r.trim().split(mO);let a="";for(let p=u.length-1;p>=0;p-=1){const y=u[p],{modifiers:x,hasImportantModifier:T,baseClassName:E,maybePostfixModifierPosition:k}=t(y);let F=!!k,D=n(F?E.substring(0,k):E);if(!D){if(!F){a=y+(a.length>0?" "+a:a);continue}if(D=n(E),!D){a=y+(a.length>0?" "+a:a);continue}F=!1}const N=pO(x).join(":"),B=T?N+fI:N,V=B+D;if(l.includes(V))continue;l.push(V);const U=i(D,F);for(let j=0;j<U.length;++j){const J=U[j];l.push(B+J)}a=y+(a.length>0?" "+a:a)}return a};function yO(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=pI(e))&&(n&&(n+=" "),n+=t);return n}const pI=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=pI(r[n]))&&(t&&(t+=" "),t+=e);return t};function vO(r,...e){let t,n,i,l=u;function u(p){const y=e.reduce((x,T)=>T(x),r());return t=gO(y),n=t.cache.get,i=t.cache.set,l=a,a(p)}function a(p){const y=n(p);if(y)return y;const x=_O(p,t);return i(p,x),x}return function(){return l(yO.apply(null,arguments))}}const li=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},gI=/^\[(?:([a-z-]+):)?(.+)\]$/i,bO=/^\d+\/\d+$/,xO=new Set(["px","full","screen"]),wO=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,TO=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,SO=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,AO=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,EO=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ba=r=>Ph(r)||xO.has(r)||bO.test(r),Ol=r=>dd(r,"length",DO),Ph=r=>!!r&&!Number.isNaN(Number(r)),kx=r=>dd(r,"number",Ph),Rf=r=>!!r&&Number.isInteger(Number(r)),IO=r=>r.endsWith("%")&&Ph(r.slice(0,-1)),mn=r=>gI.test(r),Dl=r=>wO.test(r),CO=new Set(["length","size","percentage"]),PO=r=>dd(r,CO,mI),RO=r=>dd(r,"position",mI),kO=new Set(["image","url"]),MO=r=>dd(r,kO,FO),OO=r=>dd(r,"",NO),kf=()=>!0,dd=(r,e,t)=>{const n=gI.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},DO=r=>TO.test(r)&&!SO.test(r),mI=()=>!1,NO=r=>AO.test(r),FO=r=>EO.test(r),BO=()=>{const r=li("colors"),e=li("spacing"),t=li("blur"),n=li("brightness"),i=li("borderColor"),l=li("borderRadius"),u=li("borderSpacing"),a=li("borderWidth"),p=li("contrast"),y=li("grayscale"),x=li("hueRotate"),T=li("invert"),E=li("gap"),k=li("gradientColorStops"),F=li("gradientColorStopPositions"),D=li("inset"),N=li("margin"),B=li("opacity"),V=li("padding"),U=li("saturate"),j=li("scale"),J=li("sepia"),oe=li("skew"),le=li("space"),Ce=li("translate"),Ie=()=>["auto","contain","none"],Ue=()=>["auto","hidden","clip","visible","scroll"],De=()=>["auto",mn,e],pe=()=>[mn,e],ze=()=>["",Ba,Ol],Ne=()=>["auto",Ph,mn],ot=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],At=()=>["solid","dashed","dotted","double","none"],Qe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],pt=()=>["start","end","center","between","around","evenly","stretch"],_t=()=>["","0",mn],Lt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ht=()=>[Ph,mn];return{cacheSize:500,separator:":",theme:{colors:[kf],spacing:[Ba,Ol],blur:["none","",Dl,mn],brightness:Ht(),borderColor:[r],borderRadius:["none","","full",Dl,mn],borderSpacing:pe(),borderWidth:ze(),contrast:Ht(),grayscale:_t(),hueRotate:Ht(),invert:_t(),gap:pe(),gradientColorStops:[r],gradientColorStopPositions:[IO,Ol],inset:De(),margin:De(),opacity:Ht(),padding:pe(),saturate:Ht(),scale:Ht(),sepia:_t(),skew:Ht(),space:pe(),translate:pe()},classGroups:{aspect:[{aspect:["auto","square","video",mn]}],container:["container"],columns:[{columns:[Dl]}],"break-after":[{"break-after":Lt()}],"break-before":[{"break-before":Lt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ot(),mn]}],overflow:[{overflow:Ue()}],"overflow-x":[{"overflow-x":Ue()}],"overflow-y":[{"overflow-y":Ue()}],overscroll:[{overscroll:Ie()}],"overscroll-x":[{"overscroll-x":Ie()}],"overscroll-y":[{"overscroll-y":Ie()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[D]}],"inset-x":[{"inset-x":[D]}],"inset-y":[{"inset-y":[D]}],start:[{start:[D]}],end:[{end:[D]}],top:[{top:[D]}],right:[{right:[D]}],bottom:[{bottom:[D]}],left:[{left:[D]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Rf,mn]}],basis:[{basis:De()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",mn]}],grow:[{grow:_t()}],shrink:[{shrink:_t()}],order:[{order:["first","last","none",Rf,mn]}],"grid-cols":[{"grid-cols":[kf]}],"col-start-end":[{col:["auto",{span:["full",Rf,mn]},mn]}],"col-start":[{"col-start":Ne()}],"col-end":[{"col-end":Ne()}],"grid-rows":[{"grid-rows":[kf]}],"row-start-end":[{row:["auto",{span:[Rf,mn]},mn]}],"row-start":[{"row-start":Ne()}],"row-end":[{"row-end":Ne()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",mn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",mn]}],gap:[{gap:[E]}],"gap-x":[{"gap-x":[E]}],"gap-y":[{"gap-y":[E]}],"justify-content":[{justify:["normal",...pt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...pt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...pt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[N]}],mx:[{mx:[N]}],my:[{my:[N]}],ms:[{ms:[N]}],me:[{me:[N]}],mt:[{mt:[N]}],mr:[{mr:[N]}],mb:[{mb:[N]}],ml:[{ml:[N]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",mn,e]}],"min-w":[{"min-w":[mn,e,"min","max","fit"]}],"max-w":[{"max-w":[mn,e,"none","full","min","max","fit","prose",{screen:[Dl]},Dl]}],h:[{h:[mn,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[mn,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[mn,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[mn,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Dl,Ol]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",kx]}],"font-family":[{font:[kf]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",mn]}],"line-clamp":[{"line-clamp":["none",Ph,kx]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ba,mn]}],"list-image":[{"list-image":["none",mn]}],"list-style-type":[{list:["none","disc","decimal",mn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[B]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[B]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...At(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ba,Ol]}],"underline-offset":[{"underline-offset":["auto",Ba,mn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:pe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",mn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",mn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[B]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ot(),RO]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",PO]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},MO]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[F]}],"gradient-via-pos":[{via:[F]}],"gradient-to-pos":[{to:[F]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[B]}],"border-style":[{border:[...At(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[B]}],"divide-style":[{divide:At()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...At()]}],"outline-offset":[{"outline-offset":[Ba,mn]}],"outline-w":[{outline:[Ba,Ol]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:ze()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[B]}],"ring-offset-w":[{"ring-offset":[Ba,Ol]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Dl,OO]}],"shadow-color":[{shadow:[kf]}],opacity:[{opacity:[B]}],"mix-blend":[{"mix-blend":[...Qe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Qe()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[p]}],"drop-shadow":[{"drop-shadow":["","none",Dl,mn]}],grayscale:[{grayscale:[y]}],"hue-rotate":[{"hue-rotate":[x]}],invert:[{invert:[T]}],saturate:[{saturate:[U]}],sepia:[{sepia:[J]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[p]}],"backdrop-grayscale":[{"backdrop-grayscale":[y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[x]}],"backdrop-invert":[{"backdrop-invert":[T]}],"backdrop-opacity":[{"backdrop-opacity":[B]}],"backdrop-saturate":[{"backdrop-saturate":[U]}],"backdrop-sepia":[{"backdrop-sepia":[J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[u]}],"border-spacing-x":[{"border-spacing-x":[u]}],"border-spacing-y":[{"border-spacing-y":[u]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",mn]}],duration:[{duration:Ht()}],ease:[{ease:["linear","in","out","in-out",mn]}],delay:[{delay:Ht()}],animate:[{animate:["none","spin","ping","pulse","bounce",mn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Rf,mn]}],"translate-x":[{"translate-x":[Ce]}],"translate-y":[{"translate-y":[Ce]}],"skew-x":[{"skew-x":[oe]}],"skew-y":[{"skew-y":[oe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",mn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",mn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":pe()}],"scroll-mx":[{"scroll-mx":pe()}],"scroll-my":[{"scroll-my":pe()}],"scroll-ms":[{"scroll-ms":pe()}],"scroll-me":[{"scroll-me":pe()}],"scroll-mt":[{"scroll-mt":pe()}],"scroll-mr":[{"scroll-mr":pe()}],"scroll-mb":[{"scroll-mb":pe()}],"scroll-ml":[{"scroll-ml":pe()}],"scroll-p":[{"scroll-p":pe()}],"scroll-px":[{"scroll-px":pe()}],"scroll-py":[{"scroll-py":pe()}],"scroll-ps":[{"scroll-ps":pe()}],"scroll-pe":[{"scroll-pe":pe()}],"scroll-pt":[{"scroll-pt":pe()}],"scroll-pr":[{"scroll-pr":pe()}],"scroll-pb":[{"scroll-pb":pe()}],"scroll-pl":[{"scroll-pl":pe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",mn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Ba,Ol,kx]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},LO=vO(BO);var _I={exports:{}};(function(r){var e={};function t(l){return Math.floor(Math.abs(l)+.5)*(l>=0?1:-1)}function n(l,u,a){l=t(l*a),u=t(u*a);var p=(l-u)*2;p<0&&(p=-p-1);for(var y="";p>=32;)y+=String.fromCharCode((32|p&31)+63),p/=32;return y+=String.fromCharCode((p|0)+63),y}e.decode=function(l,u){for(var a=0,p=0,y=0,x=[],T=0,E=0,k=null,F,D,N=Math.pow(10,Number.isInteger(u)?u:5);a<l.length;){k=null,T=1,E=0;do k=l.charCodeAt(a++)-63,E+=(k&31)*T,T*=32;while(k>=32);F=E&1?(-E-1)/2:E/2,T=1,E=0;do k=l.charCodeAt(a++)-63,E+=(k&31)*T,T*=32;while(k>=32);D=E&1?(-E-1)/2:E/2,p+=F,y+=D,x.push([p/N,y/N])}return x},e.encode=function(l,u){if(!l.length)return"";for(var a=Math.pow(10,Number.isInteger(u)?u:5),p=n(l[0][0],0,a)+n(l[0][1],0,a),y=1;y<l.length;y++){var x=l[y],T=l[y-1];p+=n(x[0],T[0],a),p+=n(x[1],T[1],a)}return p};function i(l){for(var u=[],a=0;a<l.length;a++){var p=l[a].slice();u.push([p[1],p[0]])}return u}e.fromGeoJSON=function(l,u){if(l&&l.type==="Feature"&&(l=l.geometry),!l||l.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return e.encode(i(l.coordinates),u)},e.toGeoJSON=function(l,u){var a=e.decode(l,u);return{type:"LineString",coordinates:i(a)}},r.exports&&(r.exports=e)})(_I);var zO=_I.exports;const tu=zw(zO),yI=r=>{const e=[];for(let t=0;t<r.legs.length;t++)if(r.legs[t].interlineWithPreviousLeg){const n=e[e.length-1],i=r.legs[t];n.intermediateStops.push({...n.to,switchTo:i}),n.to=i.to,n.duration+=i.duration,n.endTime=i.endTime,n.scheduledEndTime=i.scheduledEndTime,n.realTime||(n.realTime=i.realTime),n.intermediateStops.push(...i.intermediateStops),n.legGeometry={points:tu.encode([...tu.decode(n.legGeometry.points),...tu.decode(i.legGeometry.points)]),precision:n.legGeometry.precision,length:n.legGeometry.length+i.legGeometry.length}}else e.push(r.legs[t]);r.legs=e},Z2=(r,e)=>{const t=n=>{n.legs[0].from.name==="START"&&(n.legs[0].from.name=r.label),n.legs[n.legs.length-1].to.name==="END"&&(n.legs[n.legs.length-1].to.name=e.label),yI(n)};return n=>{if(n.error)throw new Error(String(n.error));return n.data.itineraries.forEach(t),n.data.direct.forEach(t),n.data}},vI={ticket:"Ticket",ticketOptions:"Ticket Options",includedInTicket:"Included in ticket",journeyDetails:"Journey Details",transfers:"transfers",walk:"Walk",bike:"Bike",cargoBike:"Cargo bike",scooterStanding:"Standing kick scooter",scooterSeated:"Seated kick scooter",car:"Car",taxi:"Taxi",moped:"Moped",from:"From",to:"To",position:"Position",arrival:"Arrival",departure:"Departure",connections:"Connections",duration:"Duration",arrivals:"Arrivals",later:"later",earlier:"earlier",departures:"Departures",switchToArrivals:"Switch to arrivals",switchToDepartures:"Switch to departures",track:"Platform",platform:"Platform",trackAbr:"Pl.",platformAbr:"Pl.",arrivalOnTrack:"Arrival on track",tripIntermediateStops:r=>{switch(r){case 0:return"No intermediate stops";case 1:return"1 intermediate stop";default:return`${r} intermediate stops`}},sharingProvider:"Provider",roundtripStationReturnConstraint:"The vehicle must be returned to the departure station.",noItinerariesFound:"No itineraries found.",advancedSearchOptions:"Options",selectTransitModes:"Select transit modes",defaultSelectedModes:"All transit modes",selectElevationCosts:"Avoid steep incline.",useRoutedTransfers:"Use routed transfers",wheelchair:"Accessible transfers",bikeRental:"Allow usage of sharing vehicles",requireBikeTransport:"Bike carriage",requireCarTransport:"Car carriage",considerRentalReturnConstraints:"Return rental vehicles within journey",default:"Default",timetableSources:"Timetable sources",tripCancelled:"Trip cancelled",stopCancelled:"Stop cancelled",inOutDisallowed:"Entry/exit not possible",inDisallowed:"Entry not possible",outDisallowed:"Exit not possible",unscheduledTrip:"Additional service",alertsAvailable:"Service alerts present",dataExpiredSince:"Warning: Expired data, last valid",FLEX:"On-Demand",WALK:"Walking",BIKE:"Bike",RENTAL:"Sharing",CAR:"Car",CAR_PARKING:"Car Parking",CAR_DROPOFF:"Drop-off (car)",TRANSIT:"Transit",TRAM:"Tram",SUBWAY:"Subway",FERRY:"Ferry",AIRPLANE:"Airplane",SUBURBAN:"Suburban Rail",BUS:"Bus",COACH:"Long Distance Bus / Coach",RAIL:"Train",HIGHSPEED_RAIL:"High Speed Rail",LONG_DISTANCE:"Intercity Rail",NIGHT_RAIL:"Night Rail",REGIONAL_FAST_RAIL:"Fast Rail",REGIONAL_RAIL:"Regional Rail",OTHER:"Other",RENTAL_BICYCLE:"Shared bike",RENTAL_CARGO_BICYCLE:"Shared cargo bike",RENTAL_CAR:"Shared car",RENTAL_MOPED:"Shared moped",RENTAL_SCOOTER_STANDING:"Shared standing scooter",RENTAL_SCOOTER_SEATED:"Shared seated scooter",RENTAL_OTHER:"Other shared vehicle",CABLE_CAR:"Cable car",FUNICULAR:"Funicular",AERIAL_LIFT:"Aerial lift",routingSegments:{maxTransfers:"Max. transfers",maxTravelTime:"Max. travel time",firstMile:"First mile",lastMile:"Last mile",direct:"Direct connection",maxPreTransitTime:"Max. pre-transit time",maxPostTransitTime:"Max. post-transit time",maxDirectTime:"Max. direct time"},elevationCosts:{NONE:"No detours",LOW:"Small detours",HIGH:"Large detours"},isochrones:{title:"Isochrones",displayLevel:"Display level",maxComputeLevel:"Max. computation level",canvasRects:"Rects (Overlay)",canvasCircles:"Circles (Overlay)",geojsonCircles:"Circles (Geometry)",styling:"Isochrones styling",noData:"No data",requestFailed:"Request failed"},incline:"Incline",toll:"Warning! A fee must be paid to use this route.",accessRestriction:"No access",continuesAs:"Continues as",rent:"Rent",rideThroughAllowed:"Riding through allowed",rideThroughNotAllowed:"Riding through not allowed",rideEndAllowed:"Parking allowed",rideEndNotAllowed:"Parking only at stations"},UO={ticket:"Fahrschein",ticketOptions:"Fahrscheinoptionen",includedInTicket:"Im Fahrschein enthalten",journeyDetails:"Verbindungsdetails",transfers:"Umstiege",walk:"FuÃweg",bike:"Fahrrad",cargoBike:"Lastenfahrrad",scooterStanding:"Stehroller",scooterSeated:"Sitzroller",car:"Auto",taxi:"Taxi",moped:"Moped",from:"Von",to:"Nach",position:"Position",arrival:"Ankunft",departure:"Abfahrt",duration:"Dauer",arrivals:"AnkÃ¼nfte",connections:"Verbindungen",departures:"Abfahrten",later:"spÃ¤ter",earlier:"frÃ¼her",track:"Gleis",platform:"Steig",trackAbr:"Gl.",platformAbr:"Stg.",arrivalOnTrack:"Ankunft auf Gleis",switchToArrivals:"Wechsel zu AnkÃ¼nften",switchToDepartures:"Wechsel zu Abfahrten",tripIntermediateStops:r=>{switch(r){case 0:return"Fahrt ohne Zwischenhalt";case 1:return"Fahrt eine Station";default:return`Fahrt ${r} Stationen`}},sharingProvider:"Anbieter",roundtripStationReturnConstraint:"Das Fahrzeug muss wieder an der Abfahrtsstation abgestellt werden.",noItinerariesFound:"Keine Verbindungen gefunden.",advancedSearchOptions:"Optionen",selectTransitModes:"Ãffentliche Verkehrsmittel auswÃ¤hlen",defaultSelectedModes:"Alle Verkehrsmittel",selectElevationCosts:"Steile Steigungen vermeiden.",useRoutedTransfers:"Geroutete Umstiege verwenden",wheelchair:"Barrierefreie Umstiege",bikeRental:"Sharing-Fahrzeuge berÃ¼cksichtigen",requireBikeTransport:"Fahrradmitnahme",requireCarTransport:"Automitnahme",considerRentalReturnConstraints:"Leihfahrzeuge innerhalb der Reise zurÃ¼ckgeben",default:"Vorgabe",timetableSources:"Fahrplandatenquellen",tripCancelled:"Fahrt entfÃ¤llt",stopCancelled:"Halt entfÃ¤llt",inOutDisallowed:"Ein-/Ausstieg nicht mÃ¶glich",inDisallowed:"Einstieg nicht mÃ¶glich",outDisallowed:"Ausstieg nicht mÃ¶glich",unscheduledTrip:"ZusÃ¤tzliche Fahrt",alertsAvailable:"Meldungen liegen vor",dataExpiredSince:"Achtung: Veraltete Daten, zuletzt gÃ¼ltig am",FLEX:"Bedarfsverkehr",WALK:"Zu FuÃ",BIKE:"Fahrrad",RENTAL:"Sharing",CAR:"Auto",CAR_DROPOFF:"Absetzen (Auto)",CAR_PARKING:"P+R Park & Ride",TRANSIT:"ÃPV",TRAM:"Tram",SUBWAY:"U-Bahn",FERRY:"FÃ¤hre",AIRPLANE:"Flugzeug",SUBURBAN:"S-Bahn",BUS:"Bus",COACH:"Reisebus",RAIL:"Zug",HIGHSPEED_RAIL:"Hochgeschwindigkeitszug",LONG_DISTANCE:"Intercityzug",NIGHT_RAIL:"Nachtzug",REGIONAL_FAST_RAIL:"Schnellzug",REGIONAL_RAIL:"Regionalzug",OTHER:"Andere",routingSegments:{maxTransfers:"Max. Umstiege",maxTravelTime:"Max. Reisezeit",firstMile:"Erste Meile",lastMile:"Letzte Meile",direct:"Direktverbindung",maxPreTransitTime:"Max. Vorlaufzeit",maxPostTransitTime:"Max. Nachlaufzeit",maxDirectTime:"Max. Direktzeit"},elevationCosts:{NONE:"Keine Umwege",LOW:"Kleine Umwege",HIGH:"GroÃe Umwege"},isochrones:{title:"Isochronen",displayLevel:"Darstellungsebene",maxComputeLevel:"Max. Berechnungsebene",canvasRects:"Rechtecke (Overlay)",canvasCircles:"Kreise (Overlay)",geojsonCircles:"Kreise (Geometrie)",styling:"Darstellung der Isochronen",noData:"Keine Daten",requestFailed:"Anfrage fehlgeschlagen"},RENTAL_BICYCLE:"Bikesharing",RENTAL_CARGO_BICYCLE:"Lastenrad Sharing",RENTAL_CAR:"Car Sharing",RENTAL_MOPED:"Moped Sharing",RENTAL_SCOOTER_STANDING:"Scooter Sharing",RENTAL_SCOOTER_SEATED:"Sitzroller Sharing",RENTAL_OTHER:"Anderes sharing Fahrzeug",incline:"Steigung",CABLE_CAR:"Seilbahn",FUNICULAR:"Standseilbahn",AERIAL_LIFT:"Luftseilbahn",toll:"Achtung! Mautpflichtige StraÃe.",accessRestriction:"Kein Zugang",continuesAs:"Weiter als",rent:"Ausleihen",rideThroughAllowed:"Durchfahrt erlaubt",rideThroughNotAllowed:"Durchfahrt nicht erlaubt",rideEndAllowed:"Parken erlaubt",rideEndNotAllowed:"Parken nur an Stationen"},VO={ticket:"Billet",ticketOptions:"Options de billet",includedInTicket:"Inclus dans le billet",journeyDetails:"DÃ©tails du voyage",walk:"Ã  pied",bike:"VÃ©lo",cargoBike:"VÃ©lo Cargo",scooterStanding:"Trottinette",scooterSeated:"Trottinette avec siÃ¨ge",car:"Voiture",taxi:"Taxi",moped:"Mobylette",from:"De",to:"Ã",position:"Position",arrival:"ArrivÃ©e",departure:"DÃ©part",duration:"DurÃ©e",arrivals:"ArrivÃ©es",later:"plus tard",earlier:"plus tÃ´t",departures:"DÃ©parts",connections:"ItinÃ©raires",switchToArrivals:"Afficher les arrivÃ©es",switchToDepartures:"Afficher les dÃ©parts",track:"Voie",platform:"Quai",trackAbr:"V.",platformAbr:"Q.",arrivalOnTrack:"ArrivÃ©e sur la voie",tripIntermediateStops:r=>{switch(r){case 0:return"Aucun arrÃªt intermÃ©diaire";case 1:return"1 arrÃªt intermÃ©diaire";default:return`${r} arrÃªts intermÃ©diaires`}},sharingProvider:"Fournisseur",transfers:"correspondances",roundtripStationReturnConstraint:"Le vÃ©hicule doit Ãªtre retournÃ© Ã  la station de dÃ©part.",noItinerariesFound:"Aucun itinÃ©raire trouvÃ©.",advancedSearchOptions:"Options",selectTransitModes:"SÃ©lectionner les modes de transport en commun",defaultSelectedModes:"Tous les transports en commun",selectElevationCosts:"Ãvitez les pentes abruptes.",wheelchair:"Correspondances accessibles",useRoutedTransfers:"Utiliser les correspondances routÃ©es",bikeRental:"Utiliser vÃ©hicules partagÃ©s",requireBikeTransport:"Transport vÃ©lo",requireCarTransport:"Transport voiture",considerRentalReturnConstraints:"Retourner les vÃ©hicules partagÃ©s pendant le voyage",default:"Faire dÃ©faut",timetableSources:"Sources des horaires",tripCancelled:"Voyage annulÃ©",stopCancelled:"ArrÃªt supprimÃ©",inOutDisallowed:"Impossible de monter/descendre",inDisallowed:"Impossible de monter",outDisallowed:"Impossible de descendre",unscheduledTrip:"Voyage supplÃ©mentaire",alertsAvailable:"Annonces disponibles",dataExpiredSince:"Attention : DonnÃ©es expirÃ©es, valides jusquâau",FLEX:"Transport Ã  la demande",WALK:"Ã pied",BIKE:"VÃ©lo",RENTAL:"LouÃ©",CAR:"Voiture",CAR_PARKING:"Garage voiture",CAR_DROPOFF:"DÃ©pose (voiture)",TRANSIT:"Transports en commun",TRAM:"Tram",SUBWAY:"MÃ©tro",FERRY:"Ferry",AIRPLANE:"Avion",SUBURBAN:"RER",BUS:"Bus",COACH:"Autocar",RAIL:"Train",HIGHSPEED_RAIL:"Train Ã  grande vitesse",LONG_DISTANCE:"Train intercitÃ©",NIGHT_RAIL:"Train de nuit",REGIONAL_FAST_RAIL:"Train express",REGIONAL_RAIL:"Train rÃ©gional",OTHER:"Autres",routingSegments:{maxTransfers:"Max. de correspondances",maxTravelTime:"Temps de trajet max.",firstMile:"Premier kilomÃ¨tre",lastMile:"Dernier kilomÃ¨tre",direct:"Connexion directe",maxPreTransitTime:"DurÃ©e max. avant transit",maxPostTransitTime:"DurÃ©e max. aprÃ¨s transit",maxDirectTime:"DurÃ©e max. directe"},elevationCosts:{NONE:"Pas de dÃ©tours",LOW:"Petits dÃ©tours",HIGH:"Grands dÃ©tours"},isochrones:{title:"Isochrones",displayLevel:"Couche de prÃ©sentation",maxComputeLevel:"Niveau de calcul max.",canvasRects:"Rectes (Superposer)",canvasCircles:"Cercles (Superposer)",geojsonCircles:"Circles (GÃ©omÃ©trie)",styling:"Style pour Isochrone",noData:"Pas de donnÃ©es",requestFailed:"Ãchec de la demande"},RENTAL_BICYCLE:"VÃ©lo partagÃ©",RENTAL_CARGO_BICYCLE:"VÃ©lo cargo partagÃ©",RENTAL_CAR:"Voiture partagÃ©e",RENTAL_MOPED:"Mobylette partagÃ©e",RENTAL_SCOOTER_STANDING:"Trottinette debout partagÃ©e",RENTAL_SCOOTER_SEATED:"Trottinette assise partagÃ©e",RENTAL_OTHER:"Autre vÃ©hicule partagÃ©",incline:"Pente",CABLE_CAR:"TÃ©lÃ©phÃ©rique",FUNICULAR:"Funiculaire",AERIAL_LIFT:"RemontÃ©e mÃ©canique",toll:"Attention ! Route Ã  pÃ©age.",accessRestriction:"AccÃ¨s restreint",continuesAs:"Continue comme",rent:"Louer",rideThroughAllowed:"Passage autorisÃ©",rideThroughNotAllowed:"Passage non autorisÃ©",rideEndAllowed:"Stationnement autorisÃ©",rideEndNotAllowed:"Stationnement uniquement aux stations"},jO={ticket:"Bilet",ticketOptions:"Opcje biletu",includedInTicket:"Zawarte w ramach biletu",journeyDetails:"SzczegÃ³Åy podrÃ³Å¼y",transfers:"przesiadki",walk:"Pieszo",bike:"Rower",cargoBike:"Rower cargo",scooterStanding:"Hulajnoga stojÄca",scooterSeated:"Hulajnoga z siedziskiem",car:"SamochÃ³d",taxi:"TaksÃ³wka",moped:"Skuter",from:"Z",to:"Do",position:"Pozycja",arrival:"Przyjazd",departure:"Odjazd",duration:"Czas trwania",arrivals:"Przyjazdy",later:"pÃ³Åºniej",earlier:"wczeÅniej",departures:"Odjazdy",connections:"PoÅÄczenia",switchToArrivals:"PrzeÅÄcz na przyjazdy",switchToDepartures:"PrzeÅÄcz na odjazdy",track:"Tor",platform:"Peron",trackAbr:"T.",platformAbr:"Pr.",arrivalOnTrack:"Przyjazd na tor",tripIntermediateStops:r=>r==0?"Brak przystankÃ³w poÅrednich":r==1?"1 przystanek poÅredni":r%10>1&&r%10<5&&r!=12&&r!=13&&r!=14?`${r} przystanki poÅrednie`:`${r} przystankÃ³w poÅrednich`,sharingProvider:"Dostawca danych",roundtripStationReturnConstraint:"Pojazd musi zostaÄ zwrÃ³cony do stacji poczÄtkowej.",noItinerariesFound:"Nie znaleziono poÅÄczeÅ.",advancedSearchOptions:"Opcje",selectTransitModes:"Wybierz Årodki transportu",defaultSelectedModes:"Wszystkie Årodki transportu",selectElevationCosts:"Unikaj stromych nachyleÅ.",wheelchair:"Bezbarierowe przesiadki",useRoutedTransfers:"Wyznacz trasy dla przesiadek",bikeRental:"UÅ¼yj pojazdÃ³w wspÃ³Ådzielonych",requireBikeTransport:"PrzewÃ³z roweru",requireCarTransport:"PrzewÃ³z samochodu",considerRentalReturnConstraints:"ZwrÃ³Ä pojazd wspÃ³Ådzielony podczas podrÃ³Å¼y",default:"DomyÅlne",timetableSources:"Å¹rÃ³dÅa danych rozkÅadowych",tripCancelled:"Kurs odwoÅany",stopCancelled:"Przystanek nieobsÅugiwany",inOutDisallowed:"Zabronione wejÅcie i wyjÅcie",inDisallowed:"Zabronione wejÅcie",outDisallowed:"Zabronione wyjÅcie",unscheduledTrip:"Kurs dodatkowy",alertsAvailable:"IstniejÄ ogÅoszenia",dataExpiredSince:"Uwaga: Dane nieaktualne, ostatnio waÅ¼ne",FLEX:"Transport na Å¼Ädanie",WALK:"Pieszo",BIKE:"Rower",RENTAL:"WspÃ³Ådzielenie pojazdÃ³w",CAR:"SamochÃ³d",CAR_PARKING:"SamochÃ³d (uÅ¼yj parkingÃ³w)",CAR_DROPOFF:"SamochÃ³d (tylko zatrzymanie)",TRANSIT:"Transport publiczny",TRAM:"Tramwaj",SUBWAY:"Metro",FERRY:"Prom",AIRPLANE:"Samolot",SUBURBAN:"Kolej miejska",BUS:"Autobus",COACH:"Autokar dalekobieÅ¼ny",RAIL:"Kolej",HIGHSPEED_RAIL:"Kolej duÅ¼ych prÄdkoÅci",LONG_DISTANCE:"Kolej dalekobieÅ¼na",NIGHT_RAIL:"Nocne pociÄgi",REGIONAL_FAST_RAIL:"PociÄg pospieszny",REGIONAL_RAIL:"Kolej regionalna",OTHER:"Inne",routingSegments:{maxTransfers:"Maks. iloÅÄ przesiadek",maxTravelTime:"Maks. czas podrÃ³Å¼y",firstMile:"PoczÄtek podrÃ³Å¼y",lastMile:"OsiÄgniÄcie celu",direct:"PoÅÄczenie bezpoÅrednie",maxPreTransitTime:"Maks. czas dotarcia",maxPostTransitTime:"Maks. czas dotarcia",maxDirectTime:"Maks. czas dotarcia"},elevationCosts:{NONE:"Bez odchyleÅ od trasy",LOW:"MaÅe odchylenia od trasy",HIGH:"DuÅ¼e odchylenia od trasy"},isochrones:{title:"Izochrony",displayLevel:"Poziom wyÅwietlania",maxComputeLevel:"Maks. poziom wyliczenia",canvasRects:"Kwadraty (warstwa)",canvasCircles:"OkrÄgi (warstwa)",geojsonCircles:"OkrÄgi (geometria)",styling:"Styl izochron",noData:"Brak danych",requestFailed:"BÅÄd zapytania"},RENTAL_BICYCLE:"Rower wspÃ³Ådzielony",RENTAL_CARGO_BICYCLE:"Rower cargo wspÃ³Ådzielony",RENTAL_CAR:"SamochÃ³d wspÃ³Ådzielony",RENTAL_MOPED:"Skuter wspÃ³Ådzielony",RENTAL_SCOOTER_STANDING:"Hulajnoga stojÄca wspÃ³Ådzielona",RENTAL_SCOOTER_SEATED:"Hulajnoga z siedziskiem wspÃ³Ådzielona",RENTAL_OTHER:"Inny pojazd wspÃ³Ådzielony",incline:"Nachylenie",CABLE_CAR:"Kolej linowa",FUNICULAR:"Kolej linowo-terenowa",AERIAL_LIFT:"WyciÄg krzeseÅkowy",toll:"Uwaga! Za przejazd tÄ trasÄ pobierana jest opÅata.",accessRestriction:"Ograniczony dostÄp",continuesAs:"Kontynuuje jako",rent:"WypoÅ¼ycz",rideThroughAllowed:"Przejazd dozwolony",rideThroughNotAllowed:"Przejazd niedozwolony",rideEndAllowed:"Parkowanie dozwolone",rideEndNotAllowed:"Parkowanie tylko na stacjach"},HO={ticket:"JÃ­zdenka",ticketOptions:"MoÅ¾nosti jÃ­zdenky",includedInTicket:"ZahrnutÃ© v jÃ­zdence",journeyDetails:"Detail cesty",transfers:"pÅestupy",walk:"PÄÅ¡ky",bike:"Kolo",cargoBike:"NÃ¡kladnÃ­ kolo",scooterStanding:"KolobÄÅ¾ka",scooterSeated:"KolobÄÅ¾ka se sedaÄkou",car:"Auto",taxi:"Taxi",moped:"SkÃºtr",from:"Z",to:"Do",position:"Pozice",arrival:"PÅÃ­jezd",departure:"Odjezd",duration:"Äas cesty",arrivals:"PÅÃ­jezdy",later:"pozdÄji",earlier:"dÅive",departures:"Odjezdy",connections:"Spoje",switchToArrivals:"PÅepni na pÅÃ­jezdy",switchToDepartures:"PÅepni na odjezdy",track:"Kolej",platform:"NÃ¡stupiÅ¡tÄ",platformAbr:"NÃ¡st.",trackAbr:"K.",arrivalOnTrack:"PÅÃ­jezd na kolej",tripIntermediateStops:r=>r==0?"Bez mezizastÃ¡vek":r==1?"1 mezizastÃ¡vka":r%10>1&&r%10<5&&r!=12&&r!=13&&r!=14?`${r} mezizastÃ¡vky`:`${r} mezizastÃ¡vek`,sharingProvider:"Poskytovatel dat",roundtripStationReturnConstraint:"Pojezd musÃ­ bÃ½t vrÃ¡cen k poÄÃ¡teÄnÃ­ stanice",noItinerariesFound:"SpojenÃ­ nebylo nalezeno.",advancedSearchOptions:"MoÅ¾nosti",selectTransitModes:"Vyber dopravnÃ­ prostÅedky",defaultSelectedModes:"VÅ¡echny dopravnÃ­ prostÅedky",selectElevationCosts:"Bez prudkÃ©ho stoupÃ¡nÃ­.",wheelchair:"BezbariÃ©rovÃ© pÅestupy",useRoutedTransfers:"PoÄÃ­tej trasu pro pÅestupy",bikeRental:"Povol pouÅ¾itÃ­ sdÃ­lenÃ½ch vozidel",requireBikeTransport:"PÅeprava kola",requireCarTransport:"PÅeprava auta",considerRentalReturnConstraints:"VraÅ¥ sdÃ­lenÃ© vozidla bÄhem cesty",default:"default",timetableSources:"Zdroje dÃ¡t JÅ",tripCancelled:"Spoj odÅeknut",stopCancelled:"ZastÃ¡vka bez obsluhy",inOutDisallowed:"Vstup/vÃ½stup nenÃ­ povolen",inDisallowed:"Vstup nenÃ­ povolen",outDisallowed:"VÃ½stup nenÃ­ povolen",unscheduledTrip:"DoplÅkovÃ½ spoj",alertsAvailable:"OznÃ¡menÃ­ o provozu",dataExpiredSince:"Pozor: ZastaralÃ¡ data, platnÃ¡ naposledy",FLEX:"PoptÃ¡vkovÃ¡ doprava",WALK:"ChÅ¯ze",BIKE:"Kolo",RENTAL:"SdÃ­lenÃ© prostÅedky",CAR:"Auto",CAR_PARKING:"Auto (vyuÅ¾itÃ­ parkovÃ­Å¡Å¥)",CAR_DROPOFF:"Auto (pouze zastavenÃ­)",TRANSIT:"HromadnÃ¡ doprava",TRAM:"Tramvaj",SUBWAY:"Metro",FERRY:"PÅÃ­voz",AIRPLANE:"Letadlo",SUBURBAN:"MÄstskÃ¡ Å¾eleznice",BUS:"Autobus",COACH:"DÃ¡lkovÃ½ autokar",RAIL:"Å½eleznice",HIGHSPEED_RAIL:"VysokorychlostnÃ­ Å¾eleznice",LONG_DISTANCE:"DÃ¡lkovÃ¡ Å¾eleznice",NIGHT_RAIL:"NoÄnÃ­ vlaky",REGIONAL_FAST_RAIL:"ZrychlenÃ¡ Å¾eleznice",REGIONAL_RAIL:"RegionÃ¡lnÃ­ Å¾eleznice",OTHER:"JinÃ©",routingSegments:{maxTransfers:"Max. poÄet pÅestupÅ¯",maxTravelTime:"Max. Äas cesty",firstMile:"PÅesun k prvnÃ­ zastÃ¡vce",lastMile:"PÅesun od poslednÃ­ zastÃ¡vky",direct:"PÅÃ­mÃ© spojenÃ­",maxPreTransitTime:"Max. Äas pÅesunu",maxPostTransitTime:"Max. Äas pÅesunu",maxDirectTime:"Max. Äas pÅesunu"},elevationCosts:{NONE:"Bez odklonÅ¯",LOW:"MalÃ© odklony",HIGH:"VelkÃ© odklony"},isochrones:{title:"Izochrony",displayLevel:"ÃroveÅ ukazovÃ¡nÃ­",maxComputeLevel:"Max. ÃºroveÅ vypoÄÃ­tÃ¡nÃ­",canvasRects:"Ätverce",canvasCircles:"Okruhy (zjednoduÅ¡enÃ¡ projekce)",geojsonCircles:"Okruhy (pokroÄilÃ¡ projekce)",styling:"Styl izochron",noData:"Å½Ã¡dnÃ© data",requestFailed:"Chyba Å¾Ã¡dosti"},RENTAL_BICYCLE:"SdÃ­lenÃ© kolo",RENTAL_CARGO_BICYCLE:"SdÃ­lenÃ© nÃ¡kladnÃ­ kolo",RENTAL_CAR:"SdÃ­lenÃ© auto",RENTAL_MOPED:"SdÃ­lenÃ½ skÃºtr",RENTAL_SCOOTER_STANDING:"SdÃ­lenÃ¡ kolobÄÅ¾ka",RENTAL_SCOOTER_SEATED:"SdÃ­lenÃ¡ kolobÄÅ¾ka se sedaÄkou",RENTAL_OTHER:"JinÃ© sdÃ­lenÃ© vozidla",incline:"Sklon",CABLE_CAR:"LanovÃ¡ drÃ¡ha",FUNICULAR:"LanovÃ¡ drÃ¡ha",AERIAL_LIFT:"LanovÃ¡ drÃ¡ha",toll:"Pozor! PrÅ¯jezd tuto trasou je placenÃ½.",accessRestriction:"OmezenÃ½ dostup",continuesAs:"PokraÄuje jako",rent:"PÅ¯jÄit si",rideThroughAllowed:"PrÅ¯jezd povolen",rideThroughNotAllowed:"PrÅ¯jezd zakÃ¡zÃ¡n",rideEndAllowed:"ParkovÃ¡nÃ­ povoleno",rideEndNotAllowed:"ParkovÃ¡nÃ­ pouze na stanicÃ­ch"},bI=new Map(Object.entries({pl:jO,en:vI,de:UO,fr:VO,cz:HO}));var zE;const R0=(zE=navigator.languages.find(r=>bI.has(r.slice(0,2)))??"en")==null?void 0:zE.slice(0,2),fa=R0??navigator.language,Rt=R0?bI.get(R0):vI;function kn(...r){return LO(ep(r))}const mh=new URLSearchParams(window.location.search),Hc=(r,e)=>{if(mh){const t=mh.get(r);if(t!=null)return t.split(",").filter(n=>n.length)}return e||[]},q_=(r,e)=>{mh!=null&&mh.has(e)&&(r[e]=mh.get(e))},Ey=(r,e,t=!1)=>{q_(r,"debug"),q_(r,"dark"),q_(r,"light"),q_(r,"motis");const n=new URLSearchParams(r);(t?eI:tI)("?"+n.toString(),e)},fd=(r,e,t,n=!1,i=!1)=>{Ey({stopArriveBy:n,stopId:e,time:t.toISOString()},{stopArriveBy:n,selectedStop:{name:r,stopId:e,time:t},selectedItinerary:i?void 0:ti.state.selectedItinerary,tripId:i?void 0:ti.state.tripId,showDepartures:!0},i)},fp=async(r,e=!1)=>{var i;const{data:t,error:n}=await CM({query:{tripId:r,joinInterlinedLegs:!1,language:[fa]}});if(n){console.log(n),alert(String(((i=n.error)==null?void 0:i.toString())??n));return}yI(t),Ey({tripId:r},{selectedItinerary:t,tripId:r,selectedStop:e?void 0:ti.state.selectedStop,showDepartures:!1},e)};var WO=Ve("<div><!></div>");function wo(r,e){zt(e,!0);let t=null,n=Pt(!1);class i{constructor(){Z(this,"getDefaultPosition")}onAdd(E){return t}onRemove(E){var k;(k=t==null?void 0:t.parentNode)==null||k.removeChild(t)}}let l=new i,u=Ja("map");Xr(()=>{u.map&&t&&e.position!=null&&(u.map.addControl(l,e.position),ve(n,!0))}),oc(()=>{var T;return(T=u.map)==null?void 0:T.removeControl(l)});var a=WO();let p;var y=Be(a);{var x=T=>{var E=it(),k=xe(E);fr(k,()=>e.children),K(T,E)};et(y,T=>{e.children&&T(x)})}ke(a),Cs(a,T=>t=T,()=>t),ct((T,E)=>p=Di(a,1,T,null,p,E),[()=>rl(kn("clear-both pointer-events-auto pt-2 md:pt-4 px-2 md:px-4 max-w-full",e.class)),()=>({hidden:!A(n)&&e.position!=null})]),K(r,a),Ut()}function $O(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"arrow-up-down"},()=>t,{iconNode:[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function qO(r){return typeof r=="function"}function XO(r){return r!==null&&typeof r=="object"}const ZO=["string","number","bigint","boolean"];function k0(r){return r==null||ZO.includes(typeof r)?!0:Array.isArray(r)?r.every(e=>k0(e)):typeof r=="object"?Object.getPrototypeOf(r)===Object.prototype:!1}const pp=Symbol("box"),Vw=Symbol("is-writable");function YO(r){return XO(r)&&pp in r}function KO(r){return nt.isBox(r)&&Vw in r}function nt(r){let e=Pt(yn(r));return{[pp]:!0,[Vw]:!0,get current(){return A(e)},set current(t){ve(e,t,!0)}}}function GO(r,e){const t=Re(r);return e?{[pp]:!0,[Vw]:!0,get current(){return A(t)},set current(n){e(n)}}:{[pp]:!0,get current(){return r()}}}function JO(r){return nt.isBox(r)?r:qO(r)?nt.with(r):nt(r)}function QO(r){return Object.entries(r).reduce((e,[t,n])=>nt.isBox(n)?(nt.isWritableBox(n)?Object.defineProperty(e,t,{get(){return n.current},set(i){n.current=i}}):Object.defineProperty(e,t,{get(){return n.current}}),e):Object.assign(e,{[t]:n}),{})}function eD(r){return nt.isWritableBox(r)?{[pp]:!0,get current(){return r.current}}:r}nt.from=JO;nt.with=GO;nt.flatten=QO;nt.readonly=eD;nt.isBox=YO;nt.isWritableBox=KO;function xI(...r){return function(e){var t;for(const n of r)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):(t=n.current)==null||t.call(this,e)}}}var wI={},Y2=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,tD=/\n/g,rD=/^\s*/,nD=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,iD=/^:\s*/,sD=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,oD=/^[;\s]*/,aD=/^\s+|\s+$/g,lD=`
`,K2="/",G2="*",Xc="",cD="comment",uD="declaration",hD=function(r,e){if(typeof r!="string")throw new TypeError("First argument must be a string");if(!r)return[];e=e||{};var t=1,n=1;function i(F){var D=F.match(tD);D&&(t+=D.length);var N=F.lastIndexOf(lD);n=~N?F.length-N:n+F.length}function l(){var F={line:t,column:n};return function(D){return D.position=new u(F),y(),D}}function u(F){this.start=F,this.end={line:t,column:n},this.source=e.source}u.prototype.content=r;function a(F){var D=new Error(e.source+":"+t+":"+n+": "+F);if(D.reason=F,D.filename=e.source,D.line=t,D.column=n,D.source=r,!e.silent)throw D}function p(F){var D=F.exec(r);if(D){var N=D[0];return i(N),r=r.slice(N.length),D}}function y(){p(rD)}function x(F){var D;for(F=F||[];D=T();)D!==!1&&F.push(D);return F}function T(){var F=l();if(!(K2!=r.charAt(0)||G2!=r.charAt(1))){for(var D=2;Xc!=r.charAt(D)&&(G2!=r.charAt(D)||K2!=r.charAt(D+1));)++D;if(D+=2,Xc===r.charAt(D-1))return a("End of comment missing");var N=r.slice(2,D-2);return n+=2,i(N),r=r.slice(D),n+=2,F({type:cD,comment:N})}}function E(){var F=l(),D=p(nD);if(D){if(T(),!p(iD))return a("property missing ':'");var N=p(sD),B=F({type:uD,property:J2(D[0].replace(Y2,Xc)),value:N?J2(N[0].replace(Y2,Xc)):Xc});return p(oD),B}}function k(){var F=[];x(F);for(var D;D=E();)D!==!1&&(F.push(D),x(F));return F}return y(),k()};function J2(r){return r?r.replace(aD,Xc):Xc}var dD=C0&&C0.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wI,"__esModule",{value:!0});var Q2=wI.default=pD,fD=dD(hD);function pD(r,e){var t=null;if(!r||typeof r!="string")return t;var n=(0,fD.default)(r),i=typeof e=="function";return n.forEach(function(l){if(l.type==="declaration"){var u=l.property,a=l.value;i?e(u,a,l):a&&(t=t||{},t[u]=a)}}),t}const gD=Q2.default||Q2,mD=/\d/,_D=["-","_","/","."];function yD(r=""){if(!mD.test(r))return r!==r.toLowerCase()}function vD(r){const e=[];let t="",n,i;for(const l of r){const u=_D.includes(l);if(u===!0){e.push(t),t="",n=void 0;continue}const a=yD(l);if(i===!1){if(n===!1&&a===!0){e.push(t),t=l,n=a;continue}if(n===!0&&a===!1&&t.length>1){const p=t.at(-1);e.push(t.slice(0,Math.max(0,t.length-1))),t=p+l,n=a;continue}}t+=l,n=a,i=u}return e.push(t),e}function TI(r){return r?vD(r).map(e=>xD(e)).join(""):""}function bD(r){return wD(TI(r||""))}function xD(r){return r?r[0].toUpperCase()+r.slice(1):""}function wD(r){return r?r[0].toLowerCase()+r.slice(1):""}function Wf(r){if(!r)return{};const e={};function t(n,i){if(n.startsWith("-moz-")||n.startsWith("-webkit-")||n.startsWith("-ms-")||n.startsWith("-o-")){e[TI(n)]=i;return}if(n.startsWith("--")){e[n]=i;return}e[bD(n)]=i}return gD(r,t),e}function Ka(...r){return(...e)=>{for(const t of r)typeof t=="function"&&t(...e)}}function TD(r,e){const t=RegExp(r,"g");return n=>{if(typeof n!="string")throw new TypeError(`expected an argument of type string, but got ${typeof n}`);return n.match(t)?n.replace(t,e):n}}const SD=TD(/[A-Z]/,r=>`-${r.toLowerCase()}`);function AD(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError(`expected an argument of type object, but got ${typeof r}`);return Object.keys(r).map(e=>`${SD(e)}: ${r[e]};`).join(`
`)}function jw(r={}){return AD(r).replace(`
`," ")}const ED={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"},ID=jw(ED);function CD(r){var e;return r.length>2&&r.startsWith("on")&&r[2]===((e=r[2])==null?void 0:e.toLowerCase())}function hi(...r){const e={...r[0]};for(let t=1;t<r.length;t++){const n=r[t];for(const i in n){const l=e[i],u=n[i],a=typeof l=="function",p=typeof u=="function";if(a&&CD(i)){const y=l,x=u;e[i]=xI(y,x)}else if(a&&p)e[i]=Ka(l,u);else if(i==="class"){const y=k0(l),x=k0(u);y&&x?e[i]=ep(l,u):y?e[i]=ep(l):x&&(e[i]=ep(u))}else if(i==="style"){const y=typeof l=="object",x=typeof u=="object",T=typeof l=="string",E=typeof u=="string";if(y&&x)e[i]={...l,...u};else if(y&&E){const k=Wf(u);e[i]={...l,...k}}else if(T&&x){const k=Wf(l);e[i]={...k,...u}}else if(T&&E){const k=Wf(l),F=Wf(u);e[i]={...k,...F}}else y?e[i]=l:x?e[i]=u:T?e[i]=l:E&&(e[i]=u)}else e[i]=u!==void 0?u:l}}return typeof e.style=="object"&&(e.style=jw(e.style).replaceAll(`
`," ")),e.hidden!==!0&&(e.hidden=void 0,delete e.hidden),e.disabled!==!0&&(e.disabled=void 0,delete e.disabled),e}const SI=typeof window<"u"?window:void 0;function PD(r){let e=r.activeElement;for(;e!=null&&e.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}var la,ca,Wa,Bh,py;const J1=class J1 extends Map{constructor(t){super();ut(this,Bh);ut(this,la,new Map);ut(this,ca,zo(0));ut(this,Wa,zo(0));if(t){for(var[n,i]of t)super.set(n,i);se(this,Wa).v=super.size}}has(t){var n=se(this,la),i=n.get(t);if(i===void 0){var l=super.get(t);if(l!==void 0)i=zo(0),n.set(t,i);else return A(se(this,ca)),!1}return A(i),!0}forEach(t,n){Nn(this,Bh,py).call(this),super.forEach(t,n)}get(t){var n=se(this,la),i=n.get(t);if(i===void 0){var l=super.get(t);if(l!==void 0)i=zo(0),n.set(t,i);else{A(se(this,ca));return}}return A(i),super.get(t)}set(t,n){var T;var i=se(this,la),l=i.get(t),u=super.get(t),a=super.set(t,n),p=se(this,ca);if(l===void 0)i.set(t,zo(0)),ve(se(this,Wa),super.size),ph(p);else if(u!==n){ph(l);var y=p.reactions===null?null:new Set(p.reactions),x=y===null||!((T=l.reactions)!=null&&T.every(E=>y.has(E)));x&&ph(p)}return a}delete(t){var n=se(this,la),i=n.get(t),l=super.delete(t);return i!==void 0&&(n.delete(t),ve(se(this,Wa),super.size),ve(i,-1),ph(se(this,ca))),l}clear(){if(super.size!==0){super.clear();var t=se(this,la);ve(se(this,Wa),0);for(var n of t.values())ve(n,-1);ph(se(this,ca)),t.clear()}}keys(){return A(se(this,ca)),super.keys()}values(){return Nn(this,Bh,py).call(this),super.values()}entries(){return Nn(this,Bh,py).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return A(se(this,Wa)),super.size}};la=new WeakMap,ca=new WeakMap,Wa=new WeakMap,Bh=new WeakSet,py=function(){A(se(this,ca));var t=se(this,la);if(se(this,Wa).v!==t.size)for(var n of F2(J1.prototype,this,"keys").call(this))t.has(n)||t.set(n,zo(0));for(var[,i]of se(this,la))A(i)};let gp=J1;var Lh,Np;class RD{constructor(e={}){ut(this,Lh);ut(this,Np);const{window:t=SI,document:n=t==null?void 0:t.document}=e;t!==void 0&&(Yi(this,Lh,n),Yi(this,Np,YM(i=>{const l=ui(t,"focusin",i),u=ui(t,"focusout",i);return()=>{l(),u()}})))}get current(){var e;return(e=se(this,Np))==null||e.call(this),se(this,Lh)?PD(se(this,Lh)):null}}Lh=new WeakMap,Np=new WeakMap;new RD;function kD(r){return typeof r=="function"}function MD(r,e){switch(r){case"post":Xr(e);break;case"pre":QE(e);break}}function AI(r,e,t,n={}){const{lazy:i=!1}=n;let l=!i,u=Array.isArray(r)?[]:void 0;MD(e,()=>{const a=Array.isArray(r)?r.map(y=>y()):r();if(!l){l=!0,u=a;return}const p=fo(()=>t(a,u));return u=a,p})}function Rn(r,e,t){AI(r,"post",e,t)}function OD(r,e,t){AI(r,"pre",e,t)}Rn.pre=OD;function DD(r){return kD(r)?r():r}var $a;class ND{constructor(e,t={box:"border-box"}){ut(this,$a,Pt(yn({width:0,height:0})));var i,l;const n=t.window??SI;ve(se(this,$a),{width:((i=t.initialSize)==null?void 0:i.width)??0,height:((l=t.initialSize)==null?void 0:l.height)??0},!0),Xr(()=>{if(!n)return;const u=DD(e);if(!u)return;const a=new n.ResizeObserver(p=>{for(const y of p){const x=t.box==="content-box"?y.contentBoxSize:y.borderBoxSize,T=Array.isArray(x)?x:[x];A(se(this,$a)).width=T.reduce((E,k)=>Math.max(E,k.inlineSize),0),A(se(this,$a)).height=T.reduce((E,k)=>Math.max(E,k.blockSize),0)}});return a.observe(u),()=>{a.disconnect()}})}get current(){return A(se(this,$a))}get width(){return A(se(this,$a)).width}get height(){return A(se(this,$a)).height}}$a=new WeakMap;var Fp,Bp;class EI{constructor(e){ut(this,Fp,Pt(void 0));ut(this,Bp);Xr(()=>{ve(se(this,Fp),se(this,Bp),!0),Yi(this,Bp,e())})}get current(){return A(se(this,Fp))}}Fp=new WeakMap,Bp=new WeakMap;var Lp,qa;class nl{constructor(e){ut(this,Lp);ut(this,qa);Yi(this,Lp,e),Yi(this,qa,Symbol(e))}get key(){return se(this,qa)}exists(){return _M(se(this,qa))}get(){const e=Ja(se(this,qa));if(e===void 0)throw new Error(`Context "${se(this,Lp)}" not found`);return e}getOr(e){const t=Ja(se(this,qa));return t===void 0?e:t}set(e){return qv(se(this,qa),e)}}Lp=new WeakMap,qa=new WeakMap;function Hw(r){Xr(()=>()=>{r()})}function di({id:r,ref:e,deps:t=()=>!0,onRefChange:n,getRootNode:i}){Rn([()=>r.current,t],([l])=>{const u=(i==null?void 0:i())??document,a=u==null?void 0:u.getElementById(l);a?e.current=a:e.current=null,n==null||n(e.current)}),Hw(()=>{e.current=null,n==null||n(null)})}function Zv(r,e){return setTimeout(e,r)}function pd(r){Nw().then(r)}function Ww(r){Xr(()=>fo(()=>r()))}function $w(r){return r?"open":"closed"}function FD(r){return r?"checked":"unchecked"}function II(r){return r?"true":"false"}function CI(r){return r?"true":"false"}function Po(r){return r?"":void 0}function PI(r){return r?"true":"false"}function BD(r){return r?"true":"false"}function RI(r,e){return r?"true":"false"}function kI(r){return r?"true":void 0}function LD(r){return r?"":void 0}function zD(r){return r?!0:void 0}function qw(r){return r?!0:void 0}function UD(r){return r?!0:void 0}const VD="Alt",ho="ArrowDown",gd="ArrowLeft",md="ArrowRight",Ls="ArrowUp",jD="Backspace",HD="CapsLock",WD="Control",_d="End",Kh="Enter",Xw="Escape",$D="F1",qD="F10",XD="F11",ZD="F12",YD="F2",KD="F3",GD="F4",JD="F5",QD="F6",eN="F7",tN="F8",rN="F9",yd="Home",nN="Meta",Zw="PageDown",Yw="PageUp",iN="Shift",Rh=" ",mp="Tab";function sN(r){return window.getComputedStyle(r).getPropertyValue("direction")}function oN(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?gd:md,vertical:ho}[e]}function aN(r="ltr",e="horizontal"){return{horizontal:r==="rtl"?md:gd,vertical:Ls}[e]}function lN(r="ltr",e="horizontal"){return["ltr","rtl"].includes(r)||(r="ltr"),["horizontal","vertical"].includes(e)||(e="horizontal"),{nextKey:oN(r,e),prevKey:aN(r,e)}}const Yv=typeof document<"u",M0=cN();function cN(){var r,e;return Yv&&((r=window==null?void 0:window.navigator)==null?void 0:r.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((e=window==null?void 0:window.navigator)==null?void 0:e.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function O0(r){return r instanceof HTMLElement}function uN(r){return r instanceof Element}function MI(r){return r instanceof Element||r instanceof SVGElement}function hN(r){return r!==null}function dN(r){return r instanceof HTMLInputElement&&"select"in r}function fN(r,e){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function OI(r){const e=nt(null);function t(){if(!Yv)return[];const u=document.getElementById(r.rootNodeId.current);return u?r.candidateSelector?Array.from(u.querySelectorAll(r.candidateSelector)):r.candidateAttr?Array.from(u.querySelectorAll(`[${r.candidateAttr}]:not([data-disabled])`)):[]:[]}function n(){var a;const u=t();u.length&&((a=u[0])==null||a.focus())}function i(u,a,p=!1){var U;const y=document.getElementById(r.rootNodeId.current);if(!y||!u)return;const x=t();if(!x.length)return;const T=x.indexOf(u),E=sN(y),{nextKey:k,prevKey:F}=lN(E,r.orientation.current),D=r.loop.current,N={[k]:T+1,[F]:T-1,[yd]:0,[_d]:x.length-1};if(p){const j=k===ho?md:ho,J=F===Ls?gd:Ls;N[j]=T+1,N[J]=T-1}let B=N[a.key];if(B===void 0)return;a.preventDefault(),B<0&&D?B=x.length-1:B===x.length&&D&&(B=0);const V=x[B];if(V)return V.focus(),e.current=V.id,(U=r.onCandidateFocus)==null||U.call(r,V),V}function l(u){const a=t(),p=e.current!==null;return u&&!p&&a[0]===u?(e.current=u.id,0):(u==null?void 0:u.id)===e.current?0:-1}return{setCurrentTabStopId(u){e.current=u},getTabIndex:l,handleKeydown:i,focusFirstCandidate:n,currentTabStopId:e}}globalThis.bitsIdCounter??(globalThis.bitsIdCounter={current:0});function _i(r="bits"){return globalThis.bitsIdCounter.current++,`${r}-${globalThis.bitsIdCounter.current}`}function Xn(){}function pN(r,e){const t=nt(r);function n(l){return e[t.current][l]??t.current}return{state:t,dispatch:l=>{t.current=n(l)}}}function gN(r,e){let t=Pt(yn({})),n=Pt("none");const i=r.current?"mounted":"unmounted";let l=Pt(null);const u=new EI(()=>r.current);Rn([()=>e.current,()=>r.current],([E,k])=>{!E||!k||pd(()=>{ve(l,document.getElementById(E),!0)})});const{state:a,dispatch:p}=pN(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Rn(()=>r.current,E=>{if(A(l)||ve(l,document.getElementById(e.current),!0),!A(l)||!(E!==u.current))return;const F=A(n),D=X_(A(l));E?p("MOUNT"):D==="none"||A(t).display==="none"?p("UNMOUNT"):p(u&&F!==D?"ANIMATION_OUT":"UNMOUNT")});function y(E){if(A(l)||ve(l,document.getElementById(e.current),!0),!A(l))return;const k=X_(A(l)),F=k.includes(E.animationName)||k==="none";E.target===A(l)&&F&&p("ANIMATION_END")}function x(E){A(l)||ve(l,document.getElementById(e.current),!0),A(l)&&E.target===A(l)&&ve(n,X_(A(l)),!0)}Rn(()=>a.current,()=>{if(A(l)||ve(l,document.getElementById(e.current),!0),!A(l))return;const E=X_(A(l));ve(n,a.current==="mounted"?E:"none",!0)}),Rn(()=>A(l),E=>{if(E)return ve(t,getComputedStyle(E),!0),Ka(ui(E,"animationstart",x),ui(E,"animationcancel",y),ui(E,"animationend",y))});const T=Re(()=>["mounted","unmountSuspended"].includes(a.current));return{get current(){return A(T)}}}function X_(r){return r&&getComputedStyle(r).animationName||"none"}function mN(r,e){zt(e,!0);const t=gN(nt.with(()=>e.present),nt.with(()=>e.id));var n=it(),i=xe(n);{var l=u=>{var a=it(),p=xe(a);fr(p,()=>e.presence??Cr,()=>({present:t})),K(u,a)};et(i,u=>{(e.forceMount||e.present||t.current)&&u(l)})}K(r,n),Ut()}function _N(r,e){var t=it(),n=xe(t);zM(n,()=>e.children,i=>{var l=it(),u=xe(l);fr(u,()=>e.children??Cr),K(i,l)}),K(r,t)}function DI(r,e){zt(e,!0);let t=fe(e,"to",3,"body");const n=yM();let i=Re(l);function l(){if(!Yv||e.disabled)return null;let T=null;return typeof t()=="string"?T=document.querySelector(t()):(t()instanceof HTMLElement||t()instanceof DocumentFragment)&&(T=t()),T}let u;function a(){u&&(dy(u),u=null)}Rn([()=>A(i),()=>e.disabled],([T,E])=>{if(!T||E){a();return}return u=hy(_N,{target:T,props:{children:e.children},context:n}),()=>{a()}});var p=it(),y=xe(p);{var x=T=>{var E=it(),k=xe(E);fr(k,()=>e.children??Cr),K(T,E)};et(y,T=>{e.disabled&&T(x)})}K(r,p),Ut()}function NI(r,e,t,n){const i=Array.isArray(e)?e:[e];return i.forEach(l=>r.addEventListener(l,t,n)),()=>{i.forEach(l=>r.removeEventListener(l,t,n))}}class FI{constructor(e,t={bubbles:!0,cancelable:!0}){Z(this,"eventName");Z(this,"options");this.eventName=e,this.options=t}createEvent(e){return new CustomEvent(this.eventName,{...this.options,detail:e})}dispatch(e,t){const n=this.createEvent(t);return e.dispatchEvent(n),n}listen(e,t,n){const i=l=>{t(l)};return ui(e,this.eventName,i,n)}}function eS(r,e=500){let t=null;const n=(...i)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{r(...i)},e)};return n.destroy=()=>{t!==null&&(clearTimeout(t),t=null)},n}function Kw(r,e){return r===e||r.contains(e)}function BI(r){return(r==null?void 0:r.ownerDocument)??document}function yN(r,e){const{clientX:t,clientY:n}=r,i=e.getBoundingClientRect();return t<i.left||t>i.right||n<i.top||n>i.bottom}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var zh,Qc,Zl,Uh,Vh,Yl,zp,Up,Xa,lv,ud,LI,cv,jh,uv,hv,dv,fv,Vp,zI,pv,gv;class vN{constructor(e){ut(this,ud);Z(this,"opts");ut(this,zh);ut(this,Qc);ut(this,Zl,{pointerdown:!1});ut(this,Uh,!1);ut(this,Vh,!1);Z(this,"node",nt(null));ut(this,Yl);ut(this,zp);ut(this,Up,Pt(null));ut(this,Xa,Xn);ut(this,lv,e=>{e.defaultPrevented||this.currNode&&pd(()=>{var t,n;!this.currNode||se(this,fv).call(this,e.target)||e.target&&!se(this,Vh)&&((n=(t=se(this,zp)).current)==null||n.call(t,e))})});ut(this,cv,e=>{let t=e;t.defaultPrevented&&(t=tS(e)),se(this,zh).current(e)});ut(this,jh,eS(e=>{if(!this.currNode){se(this,Xa).call(this);return}const t=this.opts.isValidEvent.current(e,this.currNode)||TN(e,this.currNode);if(!se(this,Uh)||Nn(this,ud,zI).call(this)||!t){se(this,Xa).call(this);return}let n=e;if(n.defaultPrevented&&(n=tS(n)),se(this,Qc).current!=="close"&&se(this,Qc).current!=="defer-otherwise-close"){se(this,Xa).call(this);return}e.pointerType==="touch"?(se(this,Xa).call(this),Yi(this,Xa,NI(se(this,Yl),"click",se(this,cv),{once:!0}))):se(this,zh).current(n)},10));ut(this,uv,e=>{se(this,Zl)[e.type]=!0});ut(this,hv,e=>{se(this,Zl)[e.type]=!1});ut(this,dv,()=>{this.node.current&&Yi(this,Uh,wN(this.node.current))});ut(this,fv,e=>this.node.current?Kw(this.node.current,e):!1);ut(this,Vp,eS(()=>{for(const e in se(this,Zl))se(this,Zl)[e]=!1;Yi(this,Uh,!1)},20));ut(this,pv,()=>{Yi(this,Vh,!0)});ut(this,gv,()=>{Yi(this,Vh,!1)});Z(this,"props",{onfocuscapture:se(this,pv),onblurcapture:se(this,gv)});this.opts=e,di({id:e.id,ref:this.node,deps:()=>e.enabled.current,onRefChange:i=>{this.currNode=i}}),Yi(this,Qc,e.interactOutsideBehavior),Yi(this,zh,e.onInteractOutside),Yi(this,zp,e.onFocusOutside),Xr(()=>{Yi(this,Yl,BI(this.currNode))});let t=Xn;const n=()=>{se(this,Vp).call(this),globalThis.bitsDismissableLayers.delete(this),se(this,jh).destroy(),t()};Rn([()=>this.opts.enabled.current,()=>this.currNode],([i,l])=>{if(!(!i||!l))return Zv(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,se(this,Qc)),t(),t=Nn(this,ud,LI).call(this))}),n}),Hw(()=>{se(this,Vp).destroy(),globalThis.bitsDismissableLayers.delete(this),se(this,jh).destroy(),se(this,Xa).call(this),t()})}get currNode(){return A(se(this,Up))}set currNode(e){ve(se(this,Up),e,!0)}}zh=new WeakMap,Qc=new WeakMap,Zl=new WeakMap,Uh=new WeakMap,Vh=new WeakMap,Yl=new WeakMap,zp=new WeakMap,Up=new WeakMap,Xa=new WeakMap,lv=new WeakMap,ud=new WeakSet,LI=function(){return Ka(ui(se(this,Yl),"pointerdown",Ka(se(this,uv),se(this,dv)),{capture:!0}),ui(se(this,Yl),"pointerdown",Ka(se(this,hv),se(this,jh))),ui(se(this,Yl),"focusin",se(this,lv)))},cv=new WeakMap,jh=new WeakMap,uv=new WeakMap,hv=new WeakMap,dv=new WeakMap,fv=new WeakMap,Vp=new WeakMap,zI=function(){return Object.values(se(this,Zl)).some(Boolean)},pv=new WeakMap,gv=new WeakMap;function bN(r){return new vN(r)}function xN(r){return r.findLast(([e,{current:t}])=>t==="close"||t==="ignore")}function wN(r){const e=[...globalThis.bitsDismissableLayers],t=xN(e);if(t)return t[0].node.current===r;const[n]=e[0];return n.node.current===r}function TN(r,e){if("button"in r&&r.button>0)return!1;const t=r.target;return uN(t)?BI(t).documentElement.contains(t)&&!Kw(e,t)&&yN(r,e):!1}function tS(r){const e=r.currentTarget,t=r.target;let n;r instanceof PointerEvent?n=new PointerEvent(r.type,r):n=new PointerEvent("pointerdown",r);let i=!1;return new Proxy(n,{get:(u,a)=>a==="currentTarget"?e:a==="target"?t:a==="preventDefault"?()=>{i=!0,typeof u.preventDefault=="function"&&u.preventDefault()}:a==="defaultPrevented"?i:a in u?u[a]:r[a]})}function SN(r,e){zt(e,!0);let t=fe(e,"interactOutsideBehavior",3,"close"),n=fe(e,"onInteractOutside",3,Xn),i=fe(e,"onFocusOutside",3,Xn),l=fe(e,"isValidEvent",3,()=>!1);const u=bN({id:nt.with(()=>e.id),interactOutsideBehavior:nt.with(()=>t()),onInteractOutside:nt.with(()=>n()),enabled:nt.with(()=>e.enabled),onFocusOutside:nt.with(()=>i()),isValidEvent:nt.with(()=>l())});var a=it(),p=xe(a);fr(p,()=>e.children??Cr,()=>({props:u.props})),K(r,a),Ut()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var mv,_v;class AN{constructor(e){Z(this,"opts");ut(this,mv,()=>ui(document,"keydown",se(this,_v),{passive:!1}));ut(this,_v,e=>{if(e.key!==Xw||!IN(this))return;const t=new KeyboardEvent(e.type,e);e.preventDefault();const n=this.opts.escapeKeydownBehavior.current;n!=="close"&&n!=="defer-otherwise-close"||this.opts.onEscapeKeydown.current(t)});this.opts=e;let t=Xn;Rn(()=>e.enabled.current,n=>(n&&(globalThis.bitsEscapeLayers.set(this,e.escapeKeydownBehavior),t=se(this,mv).call(this)),()=>{t(),globalThis.bitsEscapeLayers.delete(this)}))}}mv=new WeakMap,_v=new WeakMap;function EN(r){return new AN(r)}function IN(r){const e=[...globalThis.bitsEscapeLayers],t=e.findLast(([i,{current:l}])=>l==="close"||l==="ignore");if(t)return t[0]===r;const[n]=e[0];return n===r}function CN(r,e){zt(e,!0);let t=fe(e,"escapeKeydownBehavior",3,"close"),n=fe(e,"onEscapeKeydown",3,Xn);EN({escapeKeydownBehavior:nt.with(()=>t()),onEscapeKeydown:nt.with(()=>n()),enabled:nt.with(()=>e.enabled)});var i=it(),l=xe(i);fr(l,()=>e.children??Cr),K(r,i),Ut()}const Nl=nt([]);function PN(){return{add(r){const e=Nl.current[0];e&&r.id!==e.id&&e.pause(),Nl.current=rS(Nl.current,r),Nl.current.unshift(r)},remove(r){var e;Nl.current=rS(Nl.current,r),(e=Nl.current[0])==null||e.resume()},get current(){return Nl.current}}}function RN(){let r=Pt(!1),e=Pt(!1);return{id:_i(),get paused(){return A(r)},get isHandlingFocus(){return A(e)},set isHandlingFocus(t){ve(e,t,!0)},pause(){ve(r,!0)},resume(){ve(r,!1)}}}function rS(r,e){return[...r].filter(t=>t.id!==e.id)}function kN(r){return r.filter(e=>e.tagName!=="A")}function jl(r,{select:e=!1}={}){if(!(r&&r.focus)||document.activeElement===r)return;const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&dN(r)&&e&&r.select()}function MN(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(jl(n,{select:e}),document.activeElement!==t)return!0}function nS(r,e){for(const t of r)if(!fN(t,e))return t}function UI(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const i=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||i?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function ON(r){const e=UI(r),t=nS(e,r),n=nS(e.reverse(),r);return[t,n]}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var DN=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],NN=DN.join(","),VI=typeof Element>"u",Iy=VI?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Cy=!VI&&Element.prototype.getRootNode?function(r){var e;return r==null||(e=r.getRootNode)===null||e===void 0?void 0:e.call(r)}:function(r){return r==null?void 0:r.ownerDocument},FN=function r(e,t){var n;t===void 0&&(t=!0);var i=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),l=i===""||i==="true",u=l||t&&e&&r(e.parentNode);return u},BN=function(e){var t,n=e==null||(t=e.getAttribute)===null||t===void 0?void 0:t.call(e,"contenteditable");return n===""||n==="true"},LN=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},zN=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||BN(e))&&!LN(e)?0:e.tabIndex},jI=function(e){return e.tagName==="INPUT"},UN=function(e){return jI(e)&&e.type==="hidden"},VN=function(e){var t=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return t},jN=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},HN=function(e){if(!e.name)return!0;var t=e.form||Cy(e),n=function(a){return t.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=n(window.CSS.escape(e.name));else try{i=n(e.name)}catch(u){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",u.message),!1}var l=jN(i,e.form);return!l||l===e},WN=function(e){return jI(e)&&e.type==="radio"},$N=function(e){return WN(e)&&!HN(e)},qN=function(e){var t,n=e&&Cy(e),i=(t=n)===null||t===void 0?void 0:t.host,l=!1;if(n&&n!==e){var u,a,p;for(l=!!((u=i)!==null&&u!==void 0&&(a=u.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(p=e.ownerDocument)!==null&&p!==void 0&&p.contains(e));!l&&i;){var y,x,T;n=Cy(i),i=(y=n)===null||y===void 0?void 0:y.host,l=!!((x=i)!==null&&x!==void 0&&(T=x.ownerDocument)!==null&&T!==void 0&&T.contains(i))}}return l},iS=function(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n===0&&i===0},XN=function(e,t){var n=t.displayCheck,i=t.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var l=Iy.call(e,"details>summary:first-of-type"),u=l?e.parentElement:e;if(Iy.call(u,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var p=e.parentElement,y=Cy(e);if(p&&!p.shadowRoot&&i(p)===!0)return iS(e);e.assignedSlot?e=e.assignedSlot:!p&&y!==e.ownerDocument?e=y.host:e=p}e=a}if(qN(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return iS(e);return!1},ZN=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if(t.tagName==="FIELDSET"&&t.disabled){for(var n=0;n<t.children.length;n++){var i=t.children.item(n);if(i.tagName==="LEGEND")return Iy.call(t,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}t=t.parentElement}return!1},YN=function(e,t){return!(t.disabled||FN(t)||UN(t)||XN(t,e)||VN(t)||ZN(t))},KN=function(e,t){return!($N(t)||zN(t)<0||!YN(e,t))},GN=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return Iy.call(e,NN)===!1?!1:KN(t,e)};const JN=new FI("focusScope.autoFocusOnMount",{bubbles:!1,cancelable:!0}),QN=new FI("focusScope.autoFocusOnDestroy",{bubbles:!1,cancelable:!0}),e4=new nl("FocusScope");function t4({id:r,loop:e,enabled:t,onOpenAutoFocus:n,onCloseAutoFocus:i,forceMount:l}){const u=PN(),a=RN(),p=nt(null),y=e4.getOr({ignoreCloseAutoFocus:!1});let x=null;di({id:r,ref:p,deps:()=>t.current});function T(B){if(!(a.paused||!p.current||a.isHandlingFocus)){a.isHandlingFocus=!0;try{const V=B.target;if(!O0(V))return;const U=p.current.contains(V);if(B.type==="focusin")if(U)x=V;else{if(y.ignoreCloseAutoFocus)return;jl(x,{select:!0})}else B.type==="focusout"&&!U&&!y.ignoreCloseAutoFocus&&jl(x,{select:!0})}finally{a.isHandlingFocus=!1}}}function E(B){if(!x||!p.current)return;let V=!1;for(const U of B){if(U.type==="childList"&&U.removedNodes.length>0)for(const j of U.removedNodes){if(j===x){V=!0;break}if(j.nodeType===Node.ELEMENT_NODE&&j.contains(x)){V=!0;break}}if(V)break}V&&p.current&&!p.current.contains(document.activeElement)&&jl(p.current)}Rn([()=>p.current,()=>t.current],([B,V])=>{if(!B||!V)return;const U=Ka(ui(document,"focusin",T),ui(document,"focusout",T)),j=new MutationObserver(E);return j.observe(B,{childList:!0,subtree:!0,attributes:!1}),()=>{U(),j.disconnect()}}),Rn([()=>l.current,()=>p.current],([B,V])=>{if(B)return;const U=document.activeElement;return k(V,U),()=>{V&&F(U)}}),Rn([()=>l.current,()=>p.current,()=>t.current],([B,V])=>{if(!B)return;const U=document.activeElement;return k(V,U),()=>{V&&F(U)}});function k(B,V){if(B||(B=document.getElementById(r.current)),!B||!t.current)return;if(u.add(a),!B.contains(V)){const j=JN.createEvent();n.current(j),j.defaultPrevented||pd(()=>{if(!B)return;MN(kN(UI(B)),{select:!0})||jl(B)})}}function F(B){var j;const V=QN.createEvent();(j=i.current)==null||j.call(i,V);const U=y.ignoreCloseAutoFocus;Zv(0,()=>{!V.defaultPrevented&&B&&!U&&jl(GN(B)?B:document.body,{select:!0}),u.remove(a)})}function D(B){if(!t.current||!e.current&&!t.current||a.paused)return;const V=B.key===mp&&!B.ctrlKey&&!B.altKey&&!B.metaKey,U=document.activeElement;if(!(V&&U))return;const j=p.current;if(!j)return;const[J,oe]=ON(j);J&&oe?!B.shiftKey&&U===oe?(B.preventDefault(),e.current&&jl(J,{select:!0})):B.shiftKey&&U===J&&(B.preventDefault(),e.current&&jl(oe,{select:!0})):U===j&&B.preventDefault()}const N=Re(()=>({id:r.current,tabindex:-1,onkeydown:D}));return{get props(){return A(N)}}}function r4(r,e){zt(e,!0);let t=fe(e,"trapFocus",3,!1),n=fe(e,"loop",3,!1),i=fe(e,"onCloseAutoFocus",3,Xn),l=fe(e,"onOpenAutoFocus",3,Xn),u=fe(e,"forceMount",3,!1);const a=t4({enabled:nt.with(()=>t()),loop:nt.with(()=>n()),onCloseAutoFocus:nt.with(()=>i()),onOpenAutoFocus:nt.with(()=>l()),id:nt.with(()=>e.id),forceMount:nt.with(()=>u())});var p=it(),y=xe(p);fr(y,()=>e.focusScope??Cr,()=>({props:a.props})),K(r,p),Ut()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Hh,jp,yv,HI,vv,Hp;class n4{constructor(e){ut(this,yv);Z(this,"opts");ut(this,Hh,Xn);ut(this,jp,nt(null));ut(this,vv,e=>{const t=se(this,jp).current,n=e.target;!O0(t)||!O0(n)||!this.opts.enabled.current||!o4(this)||!Kw(t,n)||(this.opts.onPointerDown.current(e),!e.defaultPrevented&&Yi(this,Hh,s4(t)))});ut(this,Hp,()=>{se(this,Hh).call(this),Yi(this,Hh,Xn)});this.opts=e,di({id:e.id,ref:se(this,jp),deps:()=>this.opts.enabled.current});let t=Xn;Rn(()=>this.opts.enabled.current,n=>(n&&(globalThis.bitsTextSelectionLayers.set(this,this.opts.enabled),t(),t=Nn(this,yv,HI).call(this)),()=>{t(),se(this,Hp).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Hh=new WeakMap,jp=new WeakMap,yv=new WeakSet,HI=function(){return Ka(ui(document,"pointerdown",se(this,vv)),ui(document,"pointerup",xI(se(this,Hp),this.opts.onPointerUp.current)))},vv=new WeakMap,Hp=new WeakMap;function i4(r){return new n4(r)}const sS=r=>r.style.userSelect||r.style.webkitUserSelect;function s4(r){const e=document.body,t=sS(e),n=sS(r);return Z_(e,"none"),Z_(r,"text"),()=>{Z_(e,t),Z_(r,n)}}function Z_(r,e){r.style.userSelect=e,r.style.webkitUserSelect=e}function o4(r){const e=[...globalThis.bitsTextSelectionLayers];if(!e.length)return!1;const t=e.at(-1);return t?t[0]===r:!1}function a4(r,e){zt(e,!0);let t=fe(e,"preventOverflowTextSelection",3,!0),n=fe(e,"onPointerDown",3,Xn),i=fe(e,"onPointerUp",3,Xn);i4({id:nt.with(()=>e.id),onPointerDown:nt.with(()=>n()),onPointerUp:nt.with(()=>i()),enabled:nt.with(()=>e.enabled&&t())});var l=it(),u=xe(l);fr(u,()=>e.children??Cr),K(r,l),Ut()}function l4(r){let e=0,t=Pt(void 0),n;function i(){e-=1,n&&e<=0&&(n(),ve(t,void 0),n=void 0)}return(...l)=>(e+=1,A(t)===void 0&&(n=vM(()=>{ve(t,r(...l),!0)})),Xr(()=>()=>{i()}),A(t))}const c4=l4(()=>{const r=new gp,e=Re(()=>{for(const l of r.values())if(l)return!0;return!1});let t=Pt(null),n=null;function i(){Yv&&(document.body.setAttribute("style",A(t)??""),document.body.style.removeProperty("--scrollbar-width"),M0&&(n==null||n()))}return Xr(()=>{const l=A(e);return fo(()=>{if(!l)return;ve(t,document.body.getAttribute("style"),!0);const u=getComputedStyle(document.body),a=window.innerWidth-document.documentElement.clientWidth,y={padding:Number.parseInt(u.paddingRight??"0",10)+a,margin:Number.parseInt(u.marginRight??"0",10)};a>0&&(document.body.style.paddingRight=`${y.padding}px`,document.body.style.marginRight=`${y.margin}px`,document.body.style.setProperty("--scrollbar-width",`${a}px`),document.body.style.overflow="hidden"),M0&&(n=NI(document,"touchmove",x=>{x.target===document.documentElement&&(x.touches.length>1||x.preventDefault())},{passive:!1})),pd(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Xr(()=>()=>{n==null||n()}),{get map(){return r},resetBodyStyle:i}});function u4(r,e=()=>null){const t=_i(),n=c4();if(!n)return;const i=Re(e);n.map.set(t,r??!1);const l=nt.with(()=>n.map.get(t)??!1,u=>n.map.set(t,u));return Xr(()=>()=>{n.map.delete(t),!h4(n.map)&&(A(i)===null?requestAnimationFrame(()=>n.resetBodyStyle()):Zv(A(i),()=>n.resetBodyStyle()))}),l}function h4(r){for(const[e,t]of r)if(t)return!0;return!1}function oS(r,e){zt(e,!0);let t=fe(e,"preventScroll",3,!0),n=fe(e,"restoreScrollDelay",3,null);u4(t(),()=>n()),Ut()}function d4(r,e){return r>=0&&r<e.length}function WI(r,e,t=!0){if(!(r.length===0||e<0||e>=r.length))return r.length===1&&e===0?r[0]:e===r.length-1?t?r[0]:void 0:r[e+1]}function $I(r,e,t=!0){if(!(r.length===0||e<0||e>=r.length))return r.length===1&&e===0?r[0]:e===0?t?r[r.length-1]:void 0:r[e-1]}function qI(r,e,t,n=!0){if(r.length===0||e<0||e>=r.length)return;let i=e+t;return n?i=(i%r.length+r.length)%r.length:i=Math.max(0,Math.min(i,r.length-1)),r[i]}function XI(r,e,t,n=!0){if(r.length===0||e<0||e>=r.length)return;let i=e-t;return n?i=(i%r.length+r.length)%r.length:i=Math.max(0,Math.min(i,r.length-1)),r[i]}function Gw(r,e,t){const n=e.toLowerCase();if(n.endsWith(" ")){const T=n.slice(0,-1);if(r.filter(D=>D.toLowerCase().startsWith(T)).length<=1)return Gw(r,T,t);const k=t==null?void 0:t.toLowerCase();if(k&&k.startsWith(T)&&k.charAt(T.length)===" "&&e.trim()===T)return t;const F=r.filter(D=>D.toLowerCase().startsWith(n));if(F.length>0){const D=t?r.indexOf(t):-1;return aS(F,Math.max(D,0)).find(V=>V!==t)||t}}const l=e.length>1&&Array.from(e).every(T=>T===e[0])?e[0]:e,u=l.toLowerCase(),a=t?r.indexOf(t):-1;let p=aS(r,Math.max(a,0));l.length===1&&(p=p.filter(T=>T!==t));const x=p.find(T=>T==null?void 0:T.toLowerCase().startsWith(u));return x!==t?x:void 0}function aS(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var f4=Ve("<input/>"),p4=Ve("<input/>");function Jw(r,e){zt(e,!0);let t=fe(e,"value",15),n=an(e,["$$slots","$$events","$$legacy","value"]);const i=Re(()=>hi(n,{"aria-hidden":"true",tabindex:-1,style:ID}));var l=it(),u=xe(l);{var a=y=>{var x=f4();Ay(x);let T;ct(()=>T=Tn(x,T,{...A(i),value:t()})),K(y,x)},p=y=>{var x=p4();Ay(x);let T;ct(()=>T=Tn(x,T,{...A(i)})),cI(x,t),K(y,x)};et(u,y=>{A(i).type==="checkbox"?y(a):y(p,!1)})}K(r,l),Ut()}const g4=["top","right","bottom","left"],ac=Math.min,co=Math.max,Py=Math.round,Y_=Math.floor,_a=r=>({x:r,y:r}),m4={left:"right",right:"left",bottom:"top",top:"bottom"},_4={start:"end",end:"start"};function D0(r,e,t){return co(r,ac(e,t))}function Qa(r,e){return typeof r=="function"?r(e):r}function el(r){return r.split("-")[0]}function vd(r){return r.split("-")[1]}function Qw(r){return r==="x"?"y":"x"}function e1(r){return r==="y"?"height":"width"}function Ga(r){return["top","bottom"].includes(el(r))?"y":"x"}function t1(r){return Qw(Ga(r))}function y4(r,e,t){t===void 0&&(t=!1);const n=vd(r),i=t1(r),l=e1(i);let u=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[l]>e.floating[l]&&(u=Ry(u)),[u,Ry(u)]}function v4(r){const e=Ry(r);return[N0(r),e,N0(e)]}function N0(r){return r.replace(/start|end/g,e=>_4[e])}function b4(r,e,t){const n=["left","right"],i=["right","left"],l=["top","bottom"],u=["bottom","top"];switch(r){case"top":case"bottom":return t?e?i:n:e?n:i;case"left":case"right":return e?l:u;default:return[]}}function x4(r,e,t,n){const i=vd(r);let l=b4(el(r),t==="start",n);return i&&(l=l.map(u=>u+"-"+i),e&&(l=l.concat(l.map(N0)))),l}function Ry(r){return r.replace(/left|right|bottom|top/g,e=>m4[e])}function w4(r){return{top:0,right:0,bottom:0,left:0,...r}}function ZI(r){return typeof r!="number"?w4(r):{top:r,right:r,bottom:r,left:r}}function ky(r){const{x:e,y:t,width:n,height:i}=r;return{width:n,height:i,top:t,left:e,right:e+n,bottom:t+i,x:e,y:t}}function lS(r,e,t){let{reference:n,floating:i}=r;const l=Ga(e),u=t1(e),a=e1(u),p=el(e),y=l==="y",x=n.x+n.width/2-i.width/2,T=n.y+n.height/2-i.height/2,E=n[a]/2-i[a]/2;let k;switch(p){case"top":k={x,y:n.y-i.height};break;case"bottom":k={x,y:n.y+n.height};break;case"right":k={x:n.x+n.width,y:T};break;case"left":k={x:n.x-i.width,y:T};break;default:k={x:n.x,y:n.y}}switch(vd(e)){case"start":k[u]-=E*(t&&y?-1:1);break;case"end":k[u]+=E*(t&&y?-1:1);break}return k}const T4=async(r,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:l=[],platform:u}=t,a=l.filter(Boolean),p=await(u.isRTL==null?void 0:u.isRTL(e));let y=await u.getElementRects({reference:r,floating:e,strategy:i}),{x,y:T}=lS(y,n,p),E=n,k={},F=0;for(let D=0;D<a.length;D++){const{name:N,fn:B}=a[D],{x:V,y:U,data:j,reset:J}=await B({x,y:T,initialPlacement:n,placement:E,strategy:i,middlewareData:k,rects:y,platform:u,elements:{reference:r,floating:e}});x=V??x,T=U??T,k={...k,[N]:{...k[N],...j}},J&&F<=50&&(F++,typeof J=="object"&&(J.placement&&(E=J.placement),J.rects&&(y=J.rects===!0?await u.getElementRects({reference:r,floating:e,strategy:i}):J.rects),{x,y:T}=lS(y,E,p)),D=-1)}return{x,y:T,placement:E,strategy:i,middlewareData:k}};async function _p(r,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:l,rects:u,elements:a,strategy:p}=r,{boundary:y="clippingAncestors",rootBoundary:x="viewport",elementContext:T="floating",altBoundary:E=!1,padding:k=0}=Qa(e,r),F=ZI(k),N=a[E?T==="floating"?"reference":"floating":T],B=ky(await l.getClippingRect({element:(t=await(l.isElement==null?void 0:l.isElement(N)))==null||t?N:N.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(a.floating)),boundary:y,rootBoundary:x,strategy:p})),V=T==="floating"?{x:n,y:i,width:u.floating.width,height:u.floating.height}:u.reference,U=await(l.getOffsetParent==null?void 0:l.getOffsetParent(a.floating)),j=await(l.isElement==null?void 0:l.isElement(U))?await(l.getScale==null?void 0:l.getScale(U))||{x:1,y:1}:{x:1,y:1},J=ky(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:V,offsetParent:U,strategy:p}):V);return{top:(B.top-J.top+F.top)/j.y,bottom:(J.bottom-B.bottom+F.bottom)/j.y,left:(B.left-J.left+F.left)/j.x,right:(J.right-B.right+F.right)/j.x}}const S4=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:i,rects:l,platform:u,elements:a,middlewareData:p}=e,{element:y,padding:x=0}=Qa(r,e)||{};if(y==null)return{};const T=ZI(x),E={x:t,y:n},k=t1(i),F=e1(k),D=await u.getDimensions(y),N=k==="y",B=N?"top":"left",V=N?"bottom":"right",U=N?"clientHeight":"clientWidth",j=l.reference[F]+l.reference[k]-E[k]-l.floating[F],J=E[k]-l.reference[k],oe=await(u.getOffsetParent==null?void 0:u.getOffsetParent(y));let le=oe?oe[U]:0;(!le||!await(u.isElement==null?void 0:u.isElement(oe)))&&(le=a.floating[U]||l.floating[F]);const Ce=j/2-J/2,Ie=le/2-D[F]/2-1,Ue=ac(T[B],Ie),De=ac(T[V],Ie),pe=Ue,ze=le-D[F]-De,Ne=le/2-D[F]/2+Ce,ot=D0(pe,Ne,ze),At=!p.arrow&&vd(i)!=null&&Ne!==ot&&l.reference[F]/2-(Ne<pe?Ue:De)-D[F]/2<0,Qe=At?Ne<pe?Ne-pe:Ne-ze:0;return{[k]:E[k]+Qe,data:{[k]:ot,centerOffset:Ne-ot-Qe,...At&&{alignmentOffset:Qe}},reset:At}}}),A4=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:i,middlewareData:l,rects:u,initialPlacement:a,platform:p,elements:y}=e,{mainAxis:x=!0,crossAxis:T=!0,fallbackPlacements:E,fallbackStrategy:k="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:D=!0,...N}=Qa(r,e);if((t=l.arrow)!=null&&t.alignmentOffset)return{};const B=el(i),V=Ga(a),U=el(a)===a,j=await(p.isRTL==null?void 0:p.isRTL(y.floating)),J=E||(U||!D?[Ry(a)]:v4(a)),oe=F!=="none";!E&&oe&&J.push(...x4(a,D,F,j));const le=[a,...J],Ce=await _p(e,N),Ie=[];let Ue=((n=l.flip)==null?void 0:n.overflows)||[];if(x&&Ie.push(Ce[B]),T){const ot=y4(i,u,j);Ie.push(Ce[ot[0]],Ce[ot[1]])}if(Ue=[...Ue,{placement:i,overflows:Ie}],!Ie.every(ot=>ot<=0)){var De,pe;const ot=(((De=l.flip)==null?void 0:De.index)||0)+1,At=le[ot];if(At){var ze;const pt=T==="alignment"?V!==Ga(At):!1,_t=((ze=Ue[0])==null?void 0:ze.overflows[0])>0;if(!pt||_t)return{data:{index:ot,overflows:Ue},reset:{placement:At}}}let Qe=(pe=Ue.filter(pt=>pt.overflows[0]<=0).sort((pt,_t)=>pt.overflows[1]-_t.overflows[1])[0])==null?void 0:pe.placement;if(!Qe)switch(k){case"bestFit":{var Ne;const pt=(Ne=Ue.filter(_t=>{if(oe){const Lt=Ga(_t.placement);return Lt===V||Lt==="y"}return!0}).map(_t=>[_t.placement,_t.overflows.filter(Lt=>Lt>0).reduce((Lt,Ht)=>Lt+Ht,0)]).sort((_t,Lt)=>_t[1]-Lt[1])[0])==null?void 0:Ne[0];pt&&(Qe=pt);break}case"initialPlacement":Qe=a;break}if(i!==Qe)return{reset:{placement:Qe}}}return{}}}};function cS(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function uS(r){return g4.some(e=>r[e]>=0)}const E4=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...i}=Qa(r,e);switch(n){case"referenceHidden":{const l=await _p(e,{...i,elementContext:"reference"}),u=cS(l,t.reference);return{data:{referenceHiddenOffsets:u,referenceHidden:uS(u)}}}case"escaped":{const l=await _p(e,{...i,altBoundary:!0}),u=cS(l,t.floating);return{data:{escapedOffsets:u,escaped:uS(u)}}}default:return{}}}}};async function I4(r,e){const{placement:t,platform:n,elements:i}=r,l=await(n.isRTL==null?void 0:n.isRTL(i.floating)),u=el(t),a=vd(t),p=Ga(t)==="y",y=["left","top"].includes(u)?-1:1,x=l&&p?-1:1,T=Qa(e,r);let{mainAxis:E,crossAxis:k,alignmentAxis:F}=typeof T=="number"?{mainAxis:T,crossAxis:0,alignmentAxis:null}:{mainAxis:T.mainAxis||0,crossAxis:T.crossAxis||0,alignmentAxis:T.alignmentAxis};return a&&typeof F=="number"&&(k=a==="end"?F*-1:F),p?{x:k*x,y:E*y}:{x:E*y,y:k*x}}const C4=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:i,y:l,placement:u,middlewareData:a}=e,p=await I4(e,r);return u===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:i+p.x,y:l+p.y,data:{...p,placement:u}}}}},P4=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:l=!0,crossAxis:u=!1,limiter:a={fn:N=>{let{x:B,y:V}=N;return{x:B,y:V}}},...p}=Qa(r,e),y={x:t,y:n},x=await _p(e,p),T=Ga(el(i)),E=Qw(T);let k=y[E],F=y[T];if(l){const N=E==="y"?"top":"left",B=E==="y"?"bottom":"right",V=k+x[N],U=k-x[B];k=D0(V,k,U)}if(u){const N=T==="y"?"top":"left",B=T==="y"?"bottom":"right",V=F+x[N],U=F-x[B];F=D0(V,F,U)}const D=a.fn({...e,[E]:k,[T]:F});return{...D,data:{x:D.x-t,y:D.y-n,enabled:{[E]:l,[T]:u}}}}}},R4=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:i,rects:l,middlewareData:u}=e,{offset:a=0,mainAxis:p=!0,crossAxis:y=!0}=Qa(r,e),x={x:t,y:n},T=Ga(i),E=Qw(T);let k=x[E],F=x[T];const D=Qa(a,e),N=typeof D=="number"?{mainAxis:D,crossAxis:0}:{mainAxis:0,crossAxis:0,...D};if(p){const U=E==="y"?"height":"width",j=l.reference[E]-l.floating[U]+N.mainAxis,J=l.reference[E]+l.reference[U]-N.mainAxis;k<j?k=j:k>J&&(k=J)}if(y){var B,V;const U=E==="y"?"width":"height",j=["top","left"].includes(el(i)),J=l.reference[T]-l.floating[U]+(j&&((B=u.offset)==null?void 0:B[T])||0)+(j?0:N.crossAxis),oe=l.reference[T]+l.reference[U]+(j?0:((V=u.offset)==null?void 0:V[T])||0)-(j?N.crossAxis:0);F<J?F=J:F>oe&&(F=oe)}return{[E]:k,[T]:F}}}},k4=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:i,rects:l,platform:u,elements:a}=e,{apply:p=()=>{},...y}=Qa(r,e),x=await _p(e,y),T=el(i),E=vd(i),k=Ga(i)==="y",{width:F,height:D}=l.floating;let N,B;T==="top"||T==="bottom"?(N=T,B=E===(await(u.isRTL==null?void 0:u.isRTL(a.floating))?"start":"end")?"left":"right"):(B=T,N=E==="end"?"top":"bottom");const V=D-x.top-x.bottom,U=F-x.left-x.right,j=ac(D-x[N],V),J=ac(F-x[B],U),oe=!e.middlewareData.shift;let le=j,Ce=J;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(Ce=U),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(le=V),oe&&!E){const Ue=co(x.left,0),De=co(x.right,0),pe=co(x.top,0),ze=co(x.bottom,0);k?Ce=F-2*(Ue!==0||De!==0?Ue+De:co(x.left,x.right)):le=D-2*(pe!==0||ze!==0?pe+ze:co(x.top,x.bottom))}await p({...e,availableWidth:Ce,availableHeight:le});const Ie=await u.getDimensions(a.floating);return F!==Ie.width||D!==Ie.height?{reset:{rects:!0}}:{}}}};function Kv(){return typeof window<"u"}function bd(r){return YI(r)?(r.nodeName||"").toLowerCase():"#document"}function po(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function wa(r){var e;return(e=(YI(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function YI(r){return Kv()?r instanceof Node||r instanceof po(r).Node:!1}function Wo(r){return Kv()?r instanceof Element||r instanceof po(r).Element:!1}function ya(r){return Kv()?r instanceof HTMLElement||r instanceof po(r).HTMLElement:!1}function hS(r){return!Kv()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof po(r).ShadowRoot}function Fm(r){const{overflow:e,overflowX:t,overflowY:n,display:i}=$o(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(i)}function M4(r){return["table","td","th"].includes(bd(r))}function Gv(r){return[":popover-open",":modal"].some(e=>{try{return r.matches(e)}catch{return!1}})}function r1(r){const e=n1(),t=Wo(r)?$o(r):r;return["transform","translate","scale","rotate","perspective"].some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function O4(r){let e=lc(r);for(;ya(e)&&!Gh(e);){if(r1(e))return e;if(Gv(e))return null;e=lc(e)}return null}function n1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Gh(r){return["html","body","#document"].includes(bd(r))}function $o(r){return po(r).getComputedStyle(r)}function Jv(r){return Wo(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function lc(r){if(bd(r)==="html")return r;const e=r.assignedSlot||r.parentNode||hS(r)&&r.host||wa(r);return hS(e)?e.host:e}function KI(r){const e=lc(r);return Gh(e)?r.ownerDocument?r.ownerDocument.body:r.body:ya(e)&&Fm(e)?e:KI(e)}function yp(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=KI(r),l=i===((n=r.ownerDocument)==null?void 0:n.body),u=po(i);if(l){const a=F0(u);return e.concat(u,u.visualViewport||[],Fm(i)?i:[],a&&t?yp(a):[])}return e.concat(i,yp(i,[],t))}function F0(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function GI(r){const e=$o(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=ya(r),l=i?r.offsetWidth:t,u=i?r.offsetHeight:n,a=Py(t)!==l||Py(n)!==u;return a&&(t=l,n=u),{width:t,height:n,$:a}}function i1(r){return Wo(r)?r:r.contextElement}function kh(r){const e=i1(r);if(!ya(e))return _a(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:l}=GI(e);let u=(l?Py(t.width):t.width)/n,a=(l?Py(t.height):t.height)/i;return(!u||!Number.isFinite(u))&&(u=1),(!a||!Number.isFinite(a))&&(a=1),{x:u,y:a}}const D4=_a(0);function JI(r){const e=po(r);return!n1()||!e.visualViewport?D4:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function N4(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==po(r)?!1:e}function au(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=r.getBoundingClientRect(),l=i1(r);let u=_a(1);e&&(n?Wo(n)&&(u=kh(n)):u=kh(r));const a=N4(l,t,n)?JI(l):_a(0);let p=(i.left+a.x)/u.x,y=(i.top+a.y)/u.y,x=i.width/u.x,T=i.height/u.y;if(l){const E=po(l),k=n&&Wo(n)?po(n):n;let F=E,D=F0(F);for(;D&&n&&k!==F;){const N=kh(D),B=D.getBoundingClientRect(),V=$o(D),U=B.left+(D.clientLeft+parseFloat(V.paddingLeft))*N.x,j=B.top+(D.clientTop+parseFloat(V.paddingTop))*N.y;p*=N.x,y*=N.y,x*=N.x,T*=N.y,p+=U,y+=j,F=po(D),D=F0(F)}}return ky({width:x,height:T,x:p,y})}function s1(r,e){const t=Jv(r).scrollLeft;return e?e.left+t:au(wa(r)).left+t}function QI(r,e,t){t===void 0&&(t=!1);const n=r.getBoundingClientRect(),i=n.left+e.scrollLeft-(t?0:s1(r,n)),l=n.top+e.scrollTop;return{x:i,y:l}}function F4(r){let{elements:e,rect:t,offsetParent:n,strategy:i}=r;const l=i==="fixed",u=wa(n),a=e?Gv(e.floating):!1;if(n===u||a&&l)return t;let p={scrollLeft:0,scrollTop:0},y=_a(1);const x=_a(0),T=ya(n);if((T||!T&&!l)&&((bd(n)!=="body"||Fm(u))&&(p=Jv(n)),ya(n))){const k=au(n);y=kh(n),x.x=k.x+n.clientLeft,x.y=k.y+n.clientTop}const E=u&&!T&&!l?QI(u,p,!0):_a(0);return{width:t.width*y.x,height:t.height*y.y,x:t.x*y.x-p.scrollLeft*y.x+x.x+E.x,y:t.y*y.y-p.scrollTop*y.y+x.y+E.y}}function B4(r){return Array.from(r.getClientRects())}function L4(r){const e=wa(r),t=Jv(r),n=r.ownerDocument.body,i=co(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),l=co(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let u=-t.scrollLeft+s1(r);const a=-t.scrollTop;return $o(n).direction==="rtl"&&(u+=co(e.clientWidth,n.clientWidth)-i),{width:i,height:l,x:u,y:a}}function z4(r,e){const t=po(r),n=wa(r),i=t.visualViewport;let l=n.clientWidth,u=n.clientHeight,a=0,p=0;if(i){l=i.width,u=i.height;const y=n1();(!y||y&&e==="fixed")&&(a=i.offsetLeft,p=i.offsetTop)}return{width:l,height:u,x:a,y:p}}function U4(r,e){const t=au(r,!0,e==="fixed"),n=t.top+r.clientTop,i=t.left+r.clientLeft,l=ya(r)?kh(r):_a(1),u=r.clientWidth*l.x,a=r.clientHeight*l.y,p=i*l.x,y=n*l.y;return{width:u,height:a,x:p,y}}function dS(r,e,t){let n;if(e==="viewport")n=z4(r,t);else if(e==="document")n=L4(wa(r));else if(Wo(e))n=U4(e,t);else{const i=JI(r);n={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return ky(n)}function eC(r,e){const t=lc(r);return t===e||!Wo(t)||Gh(t)?!1:$o(t).position==="fixed"||eC(t,e)}function V4(r,e){const t=e.get(r);if(t)return t;let n=yp(r,[],!1).filter(a=>Wo(a)&&bd(a)!=="body"),i=null;const l=$o(r).position==="fixed";let u=l?lc(r):r;for(;Wo(u)&&!Gh(u);){const a=$o(u),p=r1(u);!p&&a.position==="fixed"&&(i=null),(l?!p&&!i:!p&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Fm(u)&&!p&&eC(r,u))?n=n.filter(x=>x!==u):i=a,u=lc(u)}return e.set(r,n),n}function j4(r){let{element:e,boundary:t,rootBoundary:n,strategy:i}=r;const u=[...t==="clippingAncestors"?Gv(e)?[]:V4(e,this._c):[].concat(t),n],a=u[0],p=u.reduce((y,x)=>{const T=dS(e,x,i);return y.top=co(T.top,y.top),y.right=ac(T.right,y.right),y.bottom=ac(T.bottom,y.bottom),y.left=co(T.left,y.left),y},dS(e,a,i));return{width:p.right-p.left,height:p.bottom-p.top,x:p.left,y:p.top}}function H4(r){const{width:e,height:t}=GI(r);return{width:e,height:t}}function W4(r,e,t){const n=ya(e),i=wa(e),l=t==="fixed",u=au(r,!0,l,e);let a={scrollLeft:0,scrollTop:0};const p=_a(0);function y(){p.x=s1(i)}if(n||!n&&!l)if((bd(e)!=="body"||Fm(i))&&(a=Jv(e)),n){const k=au(e,!0,l,e);p.x=k.x+e.clientLeft,p.y=k.y+e.clientTop}else i&&y();l&&!n&&i&&y();const x=i&&!n&&!l?QI(i,a):_a(0),T=u.left+a.scrollLeft-p.x-x.x,E=u.top+a.scrollTop-p.y-x.y;return{x:T,y:E,width:u.width,height:u.height}}function Mx(r){return $o(r).position==="static"}function fS(r,e){if(!ya(r)||$o(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return wa(r)===t&&(t=t.ownerDocument.body),t}function tC(r,e){const t=po(r);if(Gv(r))return t;if(!ya(r)){let i=lc(r);for(;i&&!Gh(i);){if(Wo(i)&&!Mx(i))return i;i=lc(i)}return t}let n=fS(r,e);for(;n&&M4(n)&&Mx(n);)n=fS(n,e);return n&&Gh(n)&&Mx(n)&&!r1(n)?t:n||O4(r)||t}const $4=async function(r){const e=this.getOffsetParent||tC,t=this.getDimensions,n=await t(r.floating);return{reference:W4(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function q4(r){return $o(r).direction==="rtl"}const X4={convertOffsetParentRelativeRectToViewportRelativeRect:F4,getDocumentElement:wa,getClippingRect:j4,getOffsetParent:tC,getElementRects:$4,getClientRects:B4,getDimensions:H4,getScale:kh,isElement:Wo,isRTL:q4};function rC(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function Z4(r,e){let t=null,n;const i=wa(r);function l(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function u(a,p){a===void 0&&(a=!1),p===void 0&&(p=1),l();const y=r.getBoundingClientRect(),{left:x,top:T,width:E,height:k}=y;if(a||e(),!E||!k)return;const F=Y_(T),D=Y_(i.clientWidth-(x+E)),N=Y_(i.clientHeight-(T+k)),B=Y_(x),U={rootMargin:-F+"px "+-D+"px "+-N+"px "+-B+"px",threshold:co(0,ac(1,p))||1};let j=!0;function J(oe){const le=oe[0].intersectionRatio;if(le!==p){if(!j)return u();le?u(!1,le):n=setTimeout(()=>{u(!1,1e-7)},1e3)}le===1&&!rC(y,r.getBoundingClientRect())&&u(),j=!1}try{t=new IntersectionObserver(J,{...U,root:i.ownerDocument})}catch{t=new IntersectionObserver(J,U)}t.observe(r)}return u(!0),l}function Y4(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:l=!0,elementResize:u=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:p=!1}=n,y=i1(r),x=i||l?[...y?yp(y):[],...yp(e)]:[];x.forEach(B=>{i&&B.addEventListener("scroll",t,{passive:!0}),l&&B.addEventListener("resize",t)});const T=y&&a?Z4(y,t):null;let E=-1,k=null;u&&(k=new ResizeObserver(B=>{let[V]=B;V&&V.target===y&&k&&(k.unobserve(e),cancelAnimationFrame(E),E=requestAnimationFrame(()=>{var U;(U=k)==null||U.observe(e)})),t()}),y&&!p&&k.observe(y),k.observe(e));let F,D=p?au(r):null;p&&N();function N(){const B=au(r);D&&!rC(D,B)&&t(),D=B,F=requestAnimationFrame(N)}return t(),()=>{var B;x.forEach(V=>{i&&V.removeEventListener("scroll",t),l&&V.removeEventListener("resize",t)}),T==null||T(),(B=k)==null||B.disconnect(),k=null,p&&cancelAnimationFrame(F)}}const K4=C4,G4=P4,J4=A4,Q4=k4,eF=E4,tF=S4,rF=R4,nF=(r,e,t)=>{const n=new Map,i={platform:X4,...t},l={...i.platform,_c:n};return T4(r,e,{...i,platform:l})};function Mf(r){return typeof r=="function"?r():r}function nC(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function pS(r,e){const t=nC(r);return Math.round(e*t)/t}function iF(r){const e=r.whileElementsMounted,t=Re(()=>Mf(r.open)??!0),n=Re(()=>Mf(r.middleware)),i=Re(()=>Mf(r.transform)??!0),l=Re(()=>Mf(r.placement)??"bottom"),u=Re(()=>Mf(r.strategy)??"absolute"),a=r.reference;let p=Pt(0),y=Pt(0);const x=nt(null);let T=Pt(yn(A(u))),E=Pt(yn(A(l))),k=Pt(yn({})),F=Pt(!1);const D=Re(()=>{const J={position:A(T),left:"0",top:"0"};if(!x.current)return J;const oe=pS(x.current,A(p)),le=pS(x.current,A(y));return A(i)?{...J,transform:`translate(${oe}px, ${le}px)`,...nC(x.current)>=1.5&&{willChange:"transform"}}:{position:A(T),left:`${oe}px`,top:`${le}px`}});let N;function B(){a.current===null||x.current===null||nF(a.current,x.current,{middleware:A(n),placement:A(l),strategy:A(u)}).then(J=>{ve(p,J.x,!0),ve(y,J.y,!0),ve(T,J.strategy,!0),ve(E,J.placement,!0),ve(k,J.middlewareData,!0),ve(F,!0)})}function V(){typeof N=="function"&&(N(),N=void 0)}function U(){if(V(),e===void 0){B();return}a.current===null||x.current===null||(N=e(a.current,x.current,B))}function j(){A(t)||ve(F,!1)}return Xr(B),Xr(U),Xr(j),Xr(()=>V),{floating:x,reference:a,get strategy(){return A(T)},get placement(){return A(E)},get middlewareData(){return A(k)},get isPositioned(){return A(F)},get floatingStyles(){return A(D)},get update(){return B}}}const sF={top:"bottom",right:"left",bottom:"top",left:"right"};class oF{constructor(){Z(this,"anchorNode",nt(null));Z(this,"customAnchorNode",nt(null));Z(this,"triggerNode",nt(null));Xr(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Wp,bv,$p,xv,qp,wv,Xp,Zp,Yp,Kp,Gp,Jp,Qp,eg,tg,rg,ng,ig,sg,og,ag,lg,cg,ug;class aF{constructor(e,t){Z(this,"opts");Z(this,"root");Z(this,"contentRef",nt(null));Z(this,"wrapperRef",nt(null));Z(this,"arrowRef",nt(null));Z(this,"arrowId",nt(_i()));ut(this,Wp,Re(()=>{if(typeof this.opts.style=="string")return Wf(this.opts.style);if(!this.opts.style)return{}}));ut(this,bv);ut(this,$p,new ND(()=>this.arrowRef.current??void 0));ut(this,xv,Re(()=>{var e;return((e=se(this,$p))==null?void 0:e.width)??0}));ut(this,qp,Re(()=>{var e;return((e=se(this,$p))==null?void 0:e.height)??0}));ut(this,wv,Re(()=>{var e;return((e=this.opts.side)==null?void 0:e.current)+(this.opts.align.current!=="center"?`-${this.opts.align.current}`:"")}));ut(this,Xp,Re(()=>Array.isArray(this.opts.collisionBoundary.current)?this.opts.collisionBoundary.current:[this.opts.collisionBoundary.current]));ut(this,Zp,Re(()=>A(se(this,Xp)).length>0));ut(this,Yp,Re(()=>({padding:this.opts.collisionPadding.current,boundary:A(se(this,Xp)).filter(hN),altBoundary:this.hasExplicitBoundaries})));ut(this,Kp,Pt(void 0));ut(this,Gp,Pt(void 0));ut(this,Jp,Pt(void 0));ut(this,Qp,Pt(void 0));ut(this,eg,Re(()=>[K4({mainAxis:this.opts.sideOffset.current+A(se(this,qp)),alignmentAxis:this.opts.alignOffset.current}),this.opts.avoidCollisions.current&&G4({mainAxis:!0,crossAxis:!1,limiter:this.opts.sticky.current==="partial"?rF():void 0,...this.detectOverflowOptions}),this.opts.avoidCollisions.current&&J4({...this.detectOverflowOptions}),Q4({...this.detectOverflowOptions,apply:({rects:e,availableWidth:t,availableHeight:n})=>{const{width:i,height:l}=e.reference;ve(se(this,Kp),t,!0),ve(se(this,Gp),n,!0),ve(se(this,Jp),i,!0),ve(se(this,Qp),l,!0)}}),this.arrowRef.current&&tF({element:this.arrowRef.current,padding:this.opts.arrowPadding.current}),fF({arrowWidth:A(se(this,xv)),arrowHeight:A(se(this,qp))}),this.opts.hideWhenDetached.current&&eF({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Z(this,"floating");ut(this,tg,Re(()=>pF(this.floating.placement)));ut(this,rg,Re(()=>gF(this.floating.placement)));ut(this,ng,Re(()=>{var e;return((e=this.floating.middlewareData.arrow)==null?void 0:e.x)??0}));ut(this,ig,Re(()=>{var e;return((e=this.floating.middlewareData.arrow)==null?void 0:e.y)??0}));ut(this,sg,Re(()=>{var e;return((e=this.floating.middlewareData.arrow)==null?void 0:e.centerOffset)!==0}));ut(this,og,Pt());ut(this,ag,Re(()=>sF[this.placedSide]));ut(this,lg,Re(()=>{var e,t,n;return{id:this.opts.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(e=this.floating.middlewareData.transformOrigin)==null?void 0:e.x} ${(t=this.floating.middlewareData.transformOrigin)==null?void 0:t.y}`,"--bits-floating-available-width":`${A(se(this,Kp))}px`,"--bits-floating-available-height":`${A(se(this,Gp))}px`,"--bits-floating-anchor-width":`${A(se(this,Jp))}px`,"--bits-floating-anchor-height":`${A(se(this,Qp))}px`,...((n=this.floating.middlewareData.hide)==null?void 0:n.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...A(se(this,Wp))},dir:this.opts.dir.current}}));ut(this,cg,Re(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:jw({...A(se(this,Wp))})})));ut(this,ug,Re(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.opts=e,this.root=t,e.customAnchor&&(this.root.customAnchorNode.current=e.customAnchor.current),Rn(()=>e.customAnchor.current,n=>{this.root.customAnchorNode.current=n}),di({id:this.opts.wrapperId,ref:this.wrapperRef,deps:()=>this.opts.enabled.current}),di({id:this.opts.id,ref:this.contentRef,deps:()=>this.opts.enabled.current}),this.floating=iF({strategy:()=>this.opts.strategy.current,placement:()=>A(se(this,wv)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...n)=>{var l;return Y4(...n,{animationFrame:((l=se(this,bv))==null?void 0:l.current)==="always"})},open:()=>this.opts.enabled.current}),Xr(()=>{var n;this.floating.isPositioned&&((n=this.opts.onPlaced)==null||n.current())}),Rn(()=>this.contentRef.current,n=>{n&&(this.contentZIndex=window.getComputedStyle(n).zIndex)}),Xr(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return A(se(this,Zp))}set hasExplicitBoundaries(e){ve(se(this,Zp),e)}get detectOverflowOptions(){return A(se(this,Yp))}set detectOverflowOptions(e){ve(se(this,Yp),e)}get middleware(){return A(se(this,eg))}set middleware(e){ve(se(this,eg),e)}get placedSide(){return A(se(this,tg))}set placedSide(e){ve(se(this,tg),e)}get placedAlign(){return A(se(this,rg))}set placedAlign(e){ve(se(this,rg),e)}get arrowX(){return A(se(this,ng))}set arrowX(e){ve(se(this,ng),e)}get arrowY(){return A(se(this,ig))}set arrowY(e){ve(se(this,ig),e)}get cannotCenterArrow(){return A(se(this,sg))}set cannotCenterArrow(e){ve(se(this,sg),e)}get contentZIndex(){return A(se(this,og))}set contentZIndex(e){ve(se(this,og),e,!0)}get arrowBaseSide(){return A(se(this,ag))}set arrowBaseSide(e){ve(se(this,ag),e)}get wrapperProps(){return A(se(this,lg))}set wrapperProps(e){ve(se(this,lg),e)}get props(){return A(se(this,cg))}set props(e){ve(se(this,cg),e)}get arrowStyle(){return A(se(this,ug))}set arrowStyle(e){ve(se(this,ug),e)}}Wp=new WeakMap,bv=new WeakMap,$p=new WeakMap,xv=new WeakMap,qp=new WeakMap,wv=new WeakMap,Xp=new WeakMap,Zp=new WeakMap,Yp=new WeakMap,Kp=new WeakMap,Gp=new WeakMap,Jp=new WeakMap,Qp=new WeakMap,eg=new WeakMap,tg=new WeakMap,rg=new WeakMap,ng=new WeakMap,ig=new WeakMap,sg=new WeakMap,og=new WeakMap,ag=new WeakMap,lg=new WeakMap,cg=new WeakMap,ug=new WeakMap;class lF{constructor(e,t){Z(this,"opts");Z(this,"root");Z(this,"ref",nt(null));this.opts=e,this.root=t,e.virtualEl&&e.virtualEl.current?t.triggerNode=nt.from(e.virtualEl.current):di({id:e.id,ref:this.ref,onRefChange:n=>{t.triggerNode.current=n}})}}const o1=new nl("Floating.Root"),cF=new nl("Floating.Content");function uF(){return o1.set(new oF)}function hF(r){return cF.set(new aF(r,o1.get()))}function dF(r){return new lF(r,o1.get())}function fF(r){return{name:"transformOrigin",options:r,fn(e){var N,B,V;const{placement:t,rects:n,middlewareData:i}=e,u=((N=i.arrow)==null?void 0:N.centerOffset)!==0,a=u?0:r.arrowWidth,p=u?0:r.arrowHeight,[y,x]=a1(t),T={start:"0%",center:"50%",end:"100%"}[x],E=(((B=i.arrow)==null?void 0:B.x)??0)+a/2,k=(((V=i.arrow)==null?void 0:V.y)??0)+p/2;let F="",D="";return y==="bottom"?(F=u?T:`${E}px`,D=`${-p}px`):y==="top"?(F=u?T:`${E}px`,D=`${n.floating.height+p}px`):y==="right"?(F=`${-p}px`,D=u?T:`${k}px`):y==="left"&&(F=`${n.floating.width+p}px`,D=u?T:`${k}px`),{data:{x:F,y:D}}}}}function a1(r){const[e,t="center"]=r.split("-");return[e,t]}function pF(r){return a1(r)[0]}function gF(r){return a1(r)[1]}function iC(r,e){zt(e,!0),uF();var t=it(),n=xe(t);fr(n,()=>e.children??Cr),K(r,t),Ut()}function sC(r,e=1e4,t=Xn){let n=null,i=Pt(yn(r));function l(){return window.setTimeout(()=>{ve(i,r,!0),t(r)},e)}return Xr(()=>()=>{n&&clearTimeout(n)}),nt.with(()=>A(i),u=>{ve(i,u,!0),t(u),n&&clearTimeout(n),n=l()})}function mF(r){const e=sC("",1e3),t=(r==null?void 0:r.onMatch)??(u=>u.focus()),n=(r==null?void 0:r.getCurrentItem)??(()=>document.activeElement);function i(u,a){var k,F;if(!a.length)return;e.current=e.current+u;const p=n(),y=((F=(k=a.find(D=>D===p))==null?void 0:k.textContent)==null?void 0:F.trim())??"",x=a.map(D=>{var N;return((N=D.textContent)==null?void 0:N.trim())??""}),T=Gw(x,e.current,y),E=a.find(D=>{var N;return((N=D.textContent)==null?void 0:N.trim())===T});return E&&t(E),E}function l(){e.current=""}return{search:e,handleTypeaheadSearch:i,resetTypeahead:l}}function _F(r){const e=sC("",1e3),t=Re(()=>r.candidateValues());function n(l){if(!r.enabled||!A(t).length)return;e.current=e.current+l;const u=r.getCurrentItem(),a=A(t).find(T=>T===u)??"",p=A(t).map(T=>T??""),y=Gw(p,e.current,a),x=A(t).find(T=>T===y);return x&&r.onMatch(x),x}function i(){e.current=""}return{search:e,handleTypeaheadSearch:n,resetTypeahead:i}}const gS=[gd,Xw,md,iN,HD,WD,VD,nN,Kh,$D,YD,KD,GD,JD,QD,eN,tN,rN,qD,XD,ZD],yF=[ho,Yw,yd],vF=[Ls,Zw,_d],oC=[...yF,...vF];var hg,dg,fg,pg,gg,mg,_g,yg,vg,bg;class aC{constructor(e){Z(this,"opts");ut(this,hg,Pt(!1));ut(this,dg,Pt(""));ut(this,fg,Pt(null));ut(this,pg,Pt(null));ut(this,gg,Pt(null));ut(this,mg,Pt(""));ut(this,_g,Pt(null));ut(this,yg,Re(()=>this.highlightedNode?this.highlightedNode.getAttribute("data-value"):null));ut(this,vg,Re(()=>{if(this.highlightedNode)return this.highlightedNode.id}));ut(this,bg,Re(()=>this.highlightedNode?this.highlightedNode.getAttribute("data-label"):null));Z(this,"isUsingKeyboard",!1);Z(this,"isCombobox",!1);Z(this,"bitsAttrs");this.opts=e,this.isCombobox=e.isCombobox,this.bitsAttrs=zF(this),QE(()=>{this.opts.open.current||this.setHighlightedNode(null)})}get touchedInput(){return A(se(this,hg))}set touchedInput(e){ve(se(this,hg),e,!0)}get inputValue(){return A(se(this,dg))}set inputValue(e){ve(se(this,dg),e,!0)}get inputNode(){return A(se(this,fg))}set inputNode(e){ve(se(this,fg),e,!0)}get contentNode(){return A(se(this,pg))}set contentNode(e){ve(se(this,pg),e,!0)}get triggerNode(){return A(se(this,gg))}set triggerNode(e){ve(se(this,gg),e,!0)}get valueId(){return A(se(this,mg))}set valueId(e){ve(se(this,mg),e,!0)}get highlightedNode(){return A(se(this,_g))}set highlightedNode(e){ve(se(this,_g),e,!0)}get highlightedValue(){return A(se(this,yg))}set highlightedValue(e){ve(se(this,yg),e)}get highlightedId(){return A(se(this,vg))}set highlightedId(e){ve(se(this,vg),e)}get highlightedLabel(){return A(se(this,bg))}set highlightedLabel(e){ve(se(this,bg),e)}setHighlightedNode(e,t=!1){this.highlightedNode=e,e&&(this.isUsingKeyboard||t)&&e.scrollIntoView({block:this.opts.scrollAlignment.current})}getCandidateNodes(){const e=this.contentNode;return e?Array.from(e.querySelectorAll(`[${this.bitsAttrs.item}]:not([data-disabled])`)):[]}setHighlightedToFirstCandidate(){this.setHighlightedNode(null);const e=this.getCandidateNodes();e.length&&this.setHighlightedNode(e[0])}getNodeByValue(e){return this.getCandidateNodes().find(n=>n.dataset.value===e)??null}setOpen(e){this.opts.open.current=e}toggleOpen(){this.opts.open.current=!this.opts.open.current}handleOpen(){this.setOpen(!0)}handleClose(){this.setHighlightedNode(null),this.setOpen(!1)}toggleMenu(){this.toggleOpen()}}hg=new WeakMap,dg=new WeakMap,fg=new WeakMap,pg=new WeakMap,gg=new WeakMap,mg=new WeakMap,_g=new WeakMap,yg=new WeakMap,vg=new WeakMap,bg=new WeakMap;var xg,wg,Tg,Sg;class bF extends aC{constructor(t){super(t);Z(this,"opts");Z(this,"isMulti",!1);ut(this,xg,Re(()=>this.opts.value.current!==""));ut(this,wg,Re(()=>{var n;return this.opts.items.current.length?((n=this.opts.items.current.find(i=>i.value===this.opts.value.current))==null?void 0:n.label)??"":""}));ut(this,Tg,Re(()=>this.opts.items.current.length?this.opts.items.current.filter(n=>!n.disabled).map(n=>n.label):[]));ut(this,Sg,Re(()=>!(this.isMulti||this.opts.items.current.length===0)));this.opts=t,Xr(()=>{!this.opts.open.current&&this.highlightedNode&&this.setHighlightedNode(null)}),Rn(()=>this.opts.open.current,()=>{this.opts.open.current&&this.setInitialHighlightedNode()})}get hasValue(){return A(se(this,xg))}set hasValue(t){ve(se(this,xg),t)}get currentLabel(){return A(se(this,wg))}set currentLabel(t){ve(se(this,wg),t)}get candidateLabels(){return A(se(this,Tg))}set candidateLabels(t){ve(se(this,Tg),t)}get dataTypeaheadEnabled(){return A(se(this,Sg))}set dataTypeaheadEnabled(t){ve(se(this,Sg),t)}includesItem(t){return this.opts.value.current===t}toggleItem(t,n=t){this.opts.value.current=this.includesItem(t)?"":t,this.inputValue=n}setInitialHighlightedNode(){pd(()=>{if(this.highlightedNode&&document.contains(this.highlightedNode))return;if(this.opts.value.current!==""){const n=this.getNodeByValue(this.opts.value.current);if(n){this.setHighlightedNode(n,!0);return}}const t=this.getCandidateNodes()[0];t&&this.setHighlightedNode(t,!0)})}}xg=new WeakMap,wg=new WeakMap,Tg=new WeakMap,Sg=new WeakMap;var Ag;class xF extends aC{constructor(t){super(t);Z(this,"opts");Z(this,"isMulti",!0);ut(this,Ag,Re(()=>this.opts.value.current.length>0));this.opts=t,Xr(()=>{!this.opts.open.current&&this.highlightedNode&&this.setHighlightedNode(null)}),Rn(()=>this.opts.open.current,()=>{this.opts.open.current&&this.setInitialHighlightedNode()})}get hasValue(){return A(se(this,Ag))}set hasValue(t){ve(se(this,Ag),t)}includesItem(t){return this.opts.value.current.includes(t)}toggleItem(t,n=t){this.includesItem(t)?this.opts.value.current=this.opts.value.current.filter(i=>i!==t):this.opts.value.current=[...this.opts.value.current,t],this.inputValue=n}setInitialHighlightedNode(){pd(()=>{if(this.highlightedNode&&document.contains(this.highlightedNode))return;if(this.opts.value.current.length&&this.opts.value.current[0]!==""){const n=this.getNodeByValue(this.opts.value.current[0]);if(n){this.setHighlightedNode(n,!0);return}}const t=this.getCandidateNodes()[0];t&&this.setHighlightedNode(t,!0)})}}Ag=new WeakMap;var Eg;class wF{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Eg,Re(()=>({id:this.opts.id.current,role:"combobox",disabled:this.root.opts.disabled.current?!0:void 0,"aria-activedescendant":this.root.highlightedId,"aria-autocomplete":"list","aria-expanded":CI(this.root.opts.open.current),"data-state":$w(this.root.opts.open.current),"data-disabled":Po(this.root.opts.disabled.current),onkeydown:this.onkeydown,oninput:this.oninput,[this.root.bitsAttrs.input]:""})));this.opts=e,this.root=t,di({...e,onRefChange:n=>{this.root.inputNode=n}}),this.onkeydown=this.onkeydown.bind(this),this.oninput=this.oninput.bind(this),Rn([()=>this.root.opts.value.current,()=>this.opts.clearOnDeselect.current],([n,i],[l])=>{i&&(Array.isArray(n)&&Array.isArray(l)?n.length===0&&l.length!==0&&(this.root.inputValue=""):n===""&&l!==""&&(this.root.inputValue=""))})}onkeydown(e){if(this.root.isUsingKeyboard=!0,e.key!==Xw){if((e.key===Ls||e.key===ho)&&e.preventDefault(),!this.root.opts.open.current){if(gS.includes(e.key)||e.key===mp||e.key===jD&&this.root.inputValue===""||(this.root.handleOpen(),this.root.hasValue))return;const t=this.root.getCandidateNodes();if(!t.length)return;if(e.key===ho){const n=t[0];this.root.setHighlightedNode(n)}else if(e.key===Ls){const n=t[t.length-1];this.root.setHighlightedNode(n)}return}if(e.key===mp){this.root.handleClose();return}if(e.key===Kh&&!e.isComposing){e.preventDefault();const t=this.root.highlightedValue===this.root.opts.value.current;if(!this.root.opts.allowDeselect.current&&t&&!this.root.isMulti){this.root.handleClose();return}this.root.highlightedValue&&this.root.toggleItem(this.root.highlightedValue,this.root.highlightedLabel??void 0),!this.root.isMulti&&!t&&this.root.handleClose()}if(e.key===Ls&&e.altKey&&this.root.handleClose(),oC.includes(e.key)){e.preventDefault();const t=this.root.getCandidateNodes(),n=this.root.highlightedNode,i=n?t.indexOf(n):-1,l=this.root.opts.loop.current;let u;if(e.key===ho?u=WI(t,i,l):e.key===Ls?u=$I(t,i,l):e.key===Zw?u=qI(t,i,10,l):e.key===Yw?u=XI(t,i,10,l):e.key===yd?u=t[0]:e.key===_d&&(u=t[t.length-1]),!u)return;this.root.setHighlightedNode(u);return}gS.includes(e.key)||this.root.highlightedNode||this.root.setHighlightedToFirstCandidate()}}oninput(e){this.root.inputValue=e.currentTarget.value,this.root.setHighlightedToFirstCandidate()}get props(){return A(se(this,Eg))}set props(e){ve(se(this,Eg),e)}}Eg=new WeakMap;var eu,Wh,xa,lC,B0,L0,Ig;class TF{constructor(e,t){ut(this,xa);Z(this,"opts");Z(this,"root");ut(this,eu);ut(this,Wh);ut(this,Ig,Re(()=>({id:this.opts.id.current,disabled:this.root.opts.disabled.current?!0:void 0,"aria-haspopup":"listbox","aria-expanded":CI(this.root.opts.open.current),"aria-activedescendant":this.root.highlightedId,"data-state":$w(this.root.opts.open.current),"data-disabled":Po(this.root.opts.disabled.current),"data-placeholder":this.root.hasValue?void 0:"",[this.root.bitsAttrs.trigger]:"",onpointerdown:this.onpointerdown,onkeydown:this.onkeydown,onclick:this.onclick,onpointerup:this.onpointerup})));this.opts=e,this.root=t,di({...e,onRefChange:n=>{this.root.triggerNode=n}}),Yi(this,eu,mF({getCurrentItem:()=>this.root.highlightedNode,onMatch:n=>{this.root.setHighlightedNode(n)}})),Yi(this,Wh,_F({getCurrentItem:()=>this.root.isMulti?"":this.root.currentLabel,onMatch:n=>{if(this.root.isMulti||!this.root.opts.items.current)return;const i=this.root.opts.items.current.find(l=>l.label===n);i&&(this.root.opts.value.current=i.value)},enabled:!this.root.isMulti&&this.root.dataTypeaheadEnabled,candidateValues:()=>this.root.isMulti?[]:this.root.candidateLabels})),this.onkeydown=this.onkeydown.bind(this),this.onpointerdown=this.onpointerdown.bind(this),this.onpointerup=this.onpointerup.bind(this),this.onclick=this.onclick.bind(this)}onkeydown(e){if(this.root.isUsingKeyboard=!0,(e.key===Ls||e.key===ho)&&e.preventDefault(),!this.root.opts.open.current){if(e.key===Kh||e.key===Rh||e.key===ho||e.key===Ls)e.preventDefault(),this.root.handleOpen();else if(!this.root.isMulti&&this.root.dataTypeaheadEnabled){se(this,Wh).handleTypeaheadSearch(e.key);return}if(this.root.hasValue)return;const u=this.root.getCandidateNodes();if(!u.length)return;if(e.key===ho){const a=u[0];this.root.setHighlightedNode(a)}else if(e.key===Ls){const a=u[u.length-1];this.root.setHighlightedNode(a)}return}if(e.key===mp){this.root.handleClose();return}if((e.key===Kh||e.key===Rh&&se(this,eu).search.current==="")&&!e.isComposing&&(e.preventDefault(),Nn(this,xa,L0).call(this)))return;if(e.key===Ls&&e.altKey&&this.root.handleClose(),oC.includes(e.key)){e.preventDefault();const u=this.root.getCandidateNodes(),a=this.root.highlightedNode,p=a?u.indexOf(a):-1,y=this.root.opts.loop.current;let x;if(e.key===ho?x=WI(u,p,y):e.key===Ls?x=$I(u,p,y):e.key===Zw?x=qI(u,p,10,y):e.key===Yw?x=XI(u,p,10,y):e.key===yd?x=u[0]:e.key===_d&&(x=u[u.length-1]),!x)return;this.root.setHighlightedNode(x);return}const t=e.ctrlKey||e.altKey||e.metaKey,n=e.key.length===1,i=e.key===Rh,l=this.root.getCandidateNodes();if(e.key!==mp){if(!t&&(n||i)){!se(this,eu).handleTypeaheadSearch(e.key,l)&&i&&(e.preventDefault(),Nn(this,xa,L0).call(this));return}this.root.highlightedNode||this.root.setHighlightedToFirstCandidate()}}onclick(e){e.currentTarget.focus()}onpointerdown(e){if(this.root.opts.disabled.current)return;if(e.pointerType==="touch")return e.preventDefault();const t=e.target;t!=null&&t.hasPointerCapture(e.pointerId)&&(t==null||t.releasePointerCapture(e.pointerId)),e.button===0&&e.ctrlKey===!1&&(this.root.opts.open.current===!1?Nn(this,xa,B0).call(this,e):this.root.handleClose())}onpointerup(e){e.preventDefault(),e.pointerType==="touch"&&(this.root.opts.open.current===!1?Nn(this,xa,B0).call(this,e):this.root.handleClose())}get props(){return A(se(this,Ig))}set props(e){ve(se(this,Ig),e)}}eu=new WeakMap,Wh=new WeakMap,xa=new WeakSet,lC=function(){this.root.opts.open.current=!0,se(this,Wh).resetTypeahead(),se(this,eu).resetTypeahead()},B0=function(e){Nn(this,xa,lC).call(this)},L0=function(){const e=this.root.highlightedValue===this.root.opts.value.current;return!this.root.opts.allowDeselect.current&&e&&!this.root.isMulti?(this.root.handleClose(),!0):(this.root.highlightedValue!==null&&this.root.toggleItem(this.root.highlightedValue,this.root.highlightedLabel??void 0),!this.root.isMulti&&!e?(this.root.handleClose(),!0):!1)},Ig=new WeakMap;var Cg,Pg,Tv,Rg,kg;class SF{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Cg,Pt(null));ut(this,Pg,Pt(!1));ut(this,Tv,Re(()=>{const e=this.root.isCombobox?"--bits-combobox":"--bits-select";return{[`${e}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`${e}-content-available-width`]:"var(--bits-floating-available-width)",[`${e}-content-available-height`]:"var(--bits-floating-available-height)",[`${e}-anchor-width`]:" var(--bits-floating-anchor-width)",[`${e}-anchor-height`]:"var(--bits-floating-anchor-height)"}}));Z(this,"onInteractOutside",e=>{if(e.target===this.root.triggerNode||e.target===this.root.inputNode){e.preventDefault();return}this.opts.onInteractOutside.current(e),!e.defaultPrevented&&this.root.handleClose()});Z(this,"onEscapeKeydown",e=>{this.opts.onEscapeKeydown.current(e),!e.defaultPrevented&&this.root.handleClose()});Z(this,"onOpenAutoFocus",e=>{e.preventDefault()});Z(this,"onCloseAutoFocus",e=>{e.preventDefault()});ut(this,Rg,Re(()=>({open:this.root.opts.open.current})));ut(this,kg,Re(()=>({id:this.opts.id.current,role:"listbox","aria-multiselectable":this.root.isMulti?"true":void 0,"data-state":$w(this.root.opts.open.current),[this.root.bitsAttrs.content]:"",style:{display:"flex",flexDirection:"column",outline:"none",boxSizing:"border-box",pointerEvents:"auto",...A(se(this,Tv))},onpointermove:this.onpointermove})));Z(this,"popperProps",{onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown,onOpenAutoFocus:this.onOpenAutoFocus,onCloseAutoFocus:this.onCloseAutoFocus,trapFocus:!1,loop:!1,onPlaced:()=>{this.root.opts.open.current&&(this.isPositioned=!0)}});this.opts=e,this.root=t,di({...e,onRefChange:n=>{this.root.contentNode=n},deps:()=>this.root.opts.open.current}),Hw(()=>{this.root.contentNode=null,this.isPositioned=!1}),Rn(()=>this.root.opts.open.current,()=>{this.root.opts.open.current||(this.isPositioned=!1)}),this.onpointermove=this.onpointermove.bind(this)}get viewportNode(){return A(se(this,Cg))}set viewportNode(e){ve(se(this,Cg),e,!0)}get isPositioned(){return A(se(this,Pg))}set isPositioned(e){ve(se(this,Pg),e,!0)}onpointermove(e){this.root.isUsingKeyboard=!1}get snippetProps(){return A(se(this,Rg))}set snippetProps(e){ve(se(this,Rg),e)}get props(){return A(se(this,kg))}set props(e){ve(se(this,kg),e)}}Cg=new WeakMap,Pg=new WeakMap,Tv=new WeakMap,Rg=new WeakMap,kg=new WeakMap;var Mg,Og,Dg,Ng,Fg;class AF{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Mg,Re(()=>this.root.includesItem(this.opts.value.current)));ut(this,Og,Re(()=>this.root.highlightedValue===this.opts.value.current));Z(this,"prevHighlighted",new EI(()=>this.isHighlighted));ut(this,Dg,Pt(!1));ut(this,Ng,Re(()=>({selected:this.isSelected,highlighted:this.isHighlighted})));ut(this,Fg,Re(()=>({id:this.opts.id.current,role:"option","aria-selected":this.root.includesItem(this.opts.value.current)?"true":void 0,"data-value":this.opts.value.current,"data-disabled":Po(this.opts.disabled.current),"data-highlighted":this.root.highlightedValue===this.opts.value.current&&!this.opts.disabled.current?"":void 0,"data-selected":this.root.includesItem(this.opts.value.current)?"":void 0,"data-label":this.opts.label.current,[this.root.bitsAttrs.item]:"",onpointermove:this.onpointermove,onpointerdown:this.onpointerdown,onpointerup:this.onpointerup})));this.opts=e,this.root=t,di({...e,deps:()=>this.mounted}),Rn([()=>this.isHighlighted,()=>this.prevHighlighted.current],()=>{this.isHighlighted?this.opts.onHighlight.current():this.prevHighlighted.current&&this.opts.onUnhighlight.current()}),Rn(()=>this.mounted,()=>{this.mounted&&this.root.setInitialHighlightedNode()}),this.onpointerdown=this.onpointerdown.bind(this),this.onpointerup=this.onpointerup.bind(this),this.onpointermove=this.onpointermove.bind(this)}get isSelected(){return A(se(this,Mg))}set isSelected(e){ve(se(this,Mg),e)}get isHighlighted(){return A(se(this,Og))}set isHighlighted(e){ve(se(this,Og),e)}get mounted(){return A(se(this,Dg))}set mounted(e){ve(se(this,Dg),e,!0)}handleSelect(){if(this.opts.disabled.current)return;const e=this.opts.value.current===this.root.opts.value.current;if(!this.root.opts.allowDeselect.current&&e&&!this.root.isMulti){this.root.handleClose();return}this.root.toggleItem(this.opts.value.current,this.opts.label.current),!this.root.isMulti&&!e&&this.root.handleClose()}get snippetProps(){return A(se(this,Ng))}set snippetProps(e){ve(se(this,Ng),e)}onpointerdown(e){e.preventDefault()}onpointerup(e){if(!(e.defaultPrevented||!this.opts.ref.current)){if(e.pointerType==="touch"&&!M0){ui(this.opts.ref.current,"click",()=>{this.handleSelect(),this.root.setHighlightedNode(this.opts.ref.current)},{once:!0});return}e.preventDefault(),this.handleSelect(),e.pointerType==="touch"&&this.root.setHighlightedNode(this.opts.ref.current)}}onpointermove(e){e.pointerType!=="touch"&&this.root.highlightedNode!==this.opts.ref.current&&this.root.setHighlightedNode(this.opts.ref.current)}get props(){return A(se(this,Fg))}set props(e){ve(se(this,Fg),e)}}Mg=new WeakMap,Og=new WeakMap,Dg=new WeakMap,Ng=new WeakMap,Fg=new WeakMap;var Bg,Lg;class EF{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Bg,Re(()=>this.root.opts.name.current!==""));ut(this,Lg,Re(()=>({disabled:qw(this.root.opts.disabled.current),required:UD(this.root.opts.required.current),name:this.root.opts.name.current,value:this.opts.value.current,onfocus:this.onfocus})));this.opts=e,this.root=t,this.onfocus=this.onfocus.bind(this)}get shouldRender(){return A(se(this,Bg))}set shouldRender(e){ve(se(this,Bg),e)}onfocus(e){var t,n;e.preventDefault(),this.root.isCombobox?(n=this.root.inputNode)==null||n.focus():(t=this.root.triggerNode)==null||t.focus()}get props(){return A(se(this,Lg))}set props(e){ve(se(this,Lg),e)}}Bg=new WeakMap,Lg=new WeakMap;var zg,Ug;class IF{constructor(e,t){Z(this,"opts");Z(this,"content");Z(this,"root");ut(this,zg,Pt(0));ut(this,Ug,Re(()=>({id:this.opts.id.current,role:"presentation",[this.root.bitsAttrs.viewport]:"",style:{position:"relative",flex:1,overflow:"auto"}})));this.opts=e,this.content=t,this.root=t.root,di({...e,onRefChange:n=>{this.content.viewportNode=n},deps:()=>this.root.opts.open.current})}get prevScrollTop(){return A(se(this,zg))}set prevScrollTop(e){ve(se(this,zg),e,!0)}get props(){return A(se(this,Ug))}set props(e){ve(se(this,Ug),e)}}zg=new WeakMap,Ug=new WeakMap;var Vg,jg;class cC{constructor(e,t){Z(this,"opts");Z(this,"content");Z(this,"root");Z(this,"autoScrollTimer",null);Z(this,"userScrollTimer",-1);Z(this,"isUserScrolling",!1);Z(this,"onAutoScroll",Xn);ut(this,Vg,Pt(!1));ut(this,jg,Re(()=>({id:this.opts.id.current,"aria-hidden":kI(!0),style:{flexShrink:0},onpointerdown:this.onpointerdown,onpointermove:this.onpointermove,onpointerleave:this.onpointerleave})));this.opts=e,this.content=t,this.root=t.root,di({...e,deps:()=>this.mounted}),Rn([()=>this.mounted],()=>{if(!this.mounted){this.isUserScrolling=!1;return}this.isUserScrolling}),Xr(()=>{this.mounted||this.clearAutoScrollInterval()}),this.onpointerdown=this.onpointerdown.bind(this),this.onpointermove=this.onpointermove.bind(this),this.onpointerleave=this.onpointerleave.bind(this)}get mounted(){return A(se(this,Vg))}set mounted(e){ve(se(this,Vg),e,!0)}handleUserScroll(){window.clearTimeout(this.userScrollTimer),this.isUserScrolling=!0,this.userScrollTimer=window.setTimeout(()=>{this.isUserScrolling=!1},200)}clearAutoScrollInterval(){this.autoScrollTimer!==null&&(window.clearTimeout(this.autoScrollTimer),this.autoScrollTimer=null)}onpointerdown(e){if(this.autoScrollTimer!==null)return;const t=n=>{this.onAutoScroll(),this.autoScrollTimer=window.setTimeout(()=>t(n+1),this.opts.delay.current(n))};this.autoScrollTimer=window.setTimeout(()=>t(1),this.opts.delay.current(0))}onpointermove(e){this.onpointerdown(e)}onpointerleave(e){this.clearAutoScrollInterval()}get props(){return A(se(this,jg))}set props(e){ve(se(this,jg),e)}}Vg=new WeakMap,jg=new WeakMap;var Hg,Wg;class CF{constructor(e){Z(this,"scrollButtonState");Z(this,"content");Z(this,"root");ut(this,Hg,Pt(!1));Z(this,"scrollIntoViewTimer",null);Z(this,"handleScroll",(e=!1)=>{if(e||this.scrollButtonState.handleUserScroll(),!this.content.viewportNode)return;const t=this.content.viewportNode.scrollHeight-this.content.viewportNode.clientHeight,n=Number.parseInt(getComputedStyle(this.content.viewportNode).paddingTop,10);this.canScrollDown=Math.ceil(this.content.viewportNode.scrollTop)<t-n});Z(this,"handleAutoScroll",()=>{const e=this.content.viewportNode,t=this.root.highlightedNode;!e||!t||(e.scrollTop=e.scrollTop+t.offsetHeight)});ut(this,Wg,Re(()=>({...this.scrollButtonState.props,[this.root.bitsAttrs["scroll-down-button"]]:""})));this.scrollButtonState=e,this.content=e.content,this.root=e.root,this.scrollButtonState.onAutoScroll=this.handleAutoScroll,Rn([()=>this.content.viewportNode,()=>this.content.isPositioned],()=>{if(!(!this.content.viewportNode||!this.content.isPositioned))return this.handleScroll(!0),ui(this.content.viewportNode,"scroll",()=>this.handleScroll())}),Rn(()=>this.scrollButtonState.mounted,()=>{this.scrollButtonState.mounted&&(this.scrollIntoViewTimer&&clearTimeout(this.scrollIntoViewTimer),this.scrollIntoViewTimer=Zv(5,()=>{const t=this.root.highlightedNode;t==null||t.scrollIntoView({block:this.root.opts.scrollAlignment.current})}))})}get canScrollDown(){return A(se(this,Hg))}set canScrollDown(e){ve(se(this,Hg),e,!0)}get props(){return A(se(this,Wg))}set props(e){ve(se(this,Wg),e)}}Hg=new WeakMap,Wg=new WeakMap;var $g,qg;class PF{constructor(e){Z(this,"scrollButtonState");Z(this,"content");Z(this,"root");ut(this,$g,Pt(!1));Z(this,"handleScroll",(e=!1)=>{if(e||this.scrollButtonState.handleUserScroll(),!this.content.viewportNode)return;const t=Number.parseInt(getComputedStyle(this.content.viewportNode).paddingTop,10);this.canScrollUp=this.content.viewportNode.scrollTop-t>.1});Z(this,"handleAutoScroll",()=>{!this.content.viewportNode||!this.root.highlightedNode||(this.content.viewportNode.scrollTop=this.content.viewportNode.scrollTop-this.root.highlightedNode.offsetHeight)});ut(this,qg,Re(()=>({...this.scrollButtonState.props,[this.root.bitsAttrs["scroll-up-button"]]:""})));this.scrollButtonState=e,this.content=e.content,this.root=e.root,this.scrollButtonState.onAutoScroll=this.handleAutoScroll,Rn([()=>this.content.viewportNode,()=>this.content.isPositioned],()=>{if(!(!this.content.viewportNode||!this.content.isPositioned))return this.handleScroll(!0),ui(this.content.viewportNode,"scroll",()=>this.handleScroll())})}get canScrollUp(){return A(se(this,$g))}set canScrollUp(e){ve(se(this,$g),e,!0)}get props(){return A(se(this,qg))}set props(e){ve(se(this,qg),e)}}$g=new WeakMap,qg=new WeakMap;const xd=new nl("Select.Root | Combobox.Root"),Qv=new nl("Select.Content | Combobox.Content");function uC(r){const{type:e,...t}=r,n=e==="single"?new bF(t):new xF(t);return xd.set(n)}function RF(r){return new wF(r,xd.get())}function kF(r){return Qv.set(new SF(r,xd.get()))}function MF(r){return new TF(r,xd.get())}function OF(r){return new AF(r,xd.get())}function DF(r){return new IF(r,Qv.get())}function NF(r){return new PF(new cC(r,Qv.get()))}function FF(r){return new CF(new cC(r,Qv.get()))}function BF(r){return new EF(r,xd.get())}const LF=["trigger","content","item","viewport","scroll-up-button","scroll-down-button","group","group-label","separator","arrow","input","content-wrapper","item-text","value"];function zF(r){const e=r.isCombobox,t={};for(const n of LF)t[n]=e?`data-combobox-${n}`:`data-select-${n}`;return t}function My(r,e){zt(e,!0);let t=fe(e,"value",15,"");const n=BF({value:nt.with(()=>t())});var i=it(),l=xe(i);{var u=a=>{Jw(a,cn(()=>n.props,{get value(){return t()},set value(p){t(p)}}))};et(l,a=>{n.shouldRender&&a(u)})}K(r,i),Ut()}var UF=Ve("<!> <!>",1);function VF(r,e){zt(e,!0);let t=fe(e,"value",15),n=fe(e,"onValueChange",3,Xn),i=fe(e,"name",3,""),l=fe(e,"disabled",3,!1),u=fe(e,"open",15,!1),a=fe(e,"onOpenChange",3,Xn),p=fe(e,"loop",3,!1),y=fe(e,"scrollAlignment",3,"nearest"),x=fe(e,"required",3,!1),T=fe(e,"items",19,()=>[]),E=fe(e,"allowDeselect",3,!0);if(t()===void 0){const U=e.type==="single"?"":[];t(U)}Rn.pre(()=>t(),()=>{t()===void 0&&t(e.type==="single"?"":[])});const k=uC({type:e.type,value:nt.with(()=>t(),U=>{t(U),n()(U)}),disabled:nt.with(()=>l()),required:nt.with(()=>x()),open:nt.with(()=>u(),U=>{u(U),a()(U)}),loop:nt.with(()=>p()),scrollAlignment:nt.with(()=>y()),name:nt.with(()=>i()),isCombobox:!0,items:nt.with(()=>T()),allowDeselect:nt.with(()=>E())});var F=UF(),D=xe(F);iC(D,{children:(U,j)=>{var J=it(),oe=xe(J);fr(oe,()=>e.children??Cr),K(U,J)},$$slots:{default:!0}});var N=we(D,2);{var B=U=>{var j=it(),J=xe(j);{var oe=le=>{var Ce=it(),Ie=xe(Ce);jn(Ie,17,()=>k.opts.value.current,Hi,(Ue,De)=>{My(Ue,{get value(){return A(De)}})}),K(le,Ce)};et(J,le=>{k.opts.value.current.length&&le(oe)})}K(U,j)},V=U=>{My(U,{get value(){return k.opts.value.current},set value(j){k.opts.value.current=j}})};et(N,U=>{Array.isArray(k.opts.value.current)?U(B):U(V,!1)})}K(r,F),Ut()}function hC(r,e){zt(e,!0),dF({id:nt.with(()=>e.id),virtualEl:nt.with(()=>e.virtualEl)});var t=it(),n=xe(t);fr(n,()=>e.children??Cr),K(r,t),Ut()}function jF(r,e){zt(e,!0);let t=fe(e,"side",3,"bottom"),n=fe(e,"sideOffset",3,0),i=fe(e,"align",3,"center"),l=fe(e,"alignOffset",3,0),u=fe(e,"arrowPadding",3,0),a=fe(e,"avoidCollisions",3,!0),p=fe(e,"collisionBoundary",19,()=>[]),y=fe(e,"collisionPadding",3,0),x=fe(e,"hideWhenDetached",3,!1),T=fe(e,"onPlaced",3,()=>{}),E=fe(e,"sticky",3,"partial"),k=fe(e,"updatePositionStrategy",3,"optimized"),F=fe(e,"strategy",3,"fixed"),D=fe(e,"dir",3,"ltr"),N=fe(e,"style",19,()=>({})),B=fe(e,"wrapperId",19,_i),V=fe(e,"customAnchor",3,null);const U=hF({side:nt.with(()=>t()),sideOffset:nt.with(()=>n()),align:nt.with(()=>i()),alignOffset:nt.with(()=>l()),id:nt.with(()=>e.id),arrowPadding:nt.with(()=>u()),avoidCollisions:nt.with(()=>a()),collisionBoundary:nt.with(()=>p()),collisionPadding:nt.with(()=>y()),hideWhenDetached:nt.with(()=>x()),onPlaced:nt.with(()=>T()),sticky:nt.with(()=>E()),updatePositionStrategy:nt.with(()=>k()),strategy:nt.with(()=>F()),dir:nt.with(()=>D()),style:nt.with(()=>N()),enabled:nt.with(()=>e.enabled),wrapperId:nt.with(()=>B()),customAnchor:nt.with(()=>V())}),j=Re(()=>hi(U.wrapperProps,{style:{pointerEvents:"auto"}}));var J=it(),oe=xe(J);fr(oe,()=>e.content??Cr,()=>({props:U.props,wrapperProps:A(j)})),K(r,J),Ut()}function HF(r,e){zt(e,!0),Dm(()=>{var i;(i=e.onPlaced)==null||i.call(e)});var t=it(),n=xe(t);fr(n,()=>e.content??Cr,()=>({props:{},wrapperProps:{}})),K(r,t),Ut()}var WF=Ve("<input/>");function $F(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"clearOnDeselect",3,!1),l=an(e,["$$slots","$$events","$$legacy","id","ref","child","defaultValue","clearOnDeselect"]);const u=RF({id:nt.with(()=>t()),ref:nt.with(()=>n(),x=>n(x)),clearOnDeselect:nt.with(()=>i())});e.defaultValue&&(u.root.inputValue=e.defaultValue);const a=Re(()=>hi(l,u.props,{value:u.root.inputValue}));var p=it(),y=xe(p);Tr(y,()=>hC,(x,T)=>{T(x,{get id(){return t()},children:(E,k)=>{var F=it(),D=xe(F);{var N=V=>{var U=it(),j=xe(U);fr(j,()=>e.child,()=>({props:A(a)})),K(V,U)},B=V=>{var U=WF();Ay(U);let j;ct(()=>j=Tn(U,j,{...A(a)})),K(V,U)};et(D,V=>{e.child?V(N):V(B,!1)})}K(E,F)},$$slots:{default:!0}})}),K(r,p),Ut()}const qF="data-separator-root";var Xg;class XF{constructor(e){Z(this,"opts");ut(this,Xg,Re(()=>({id:this.opts.id.current,role:this.opts.decorative.current?"none":"separator","aria-orientation":this.opts.orientation.current,"aria-hidden":kI(this.opts.decorative.current),"data-orientation":this.opts.orientation.current,[qF]:""})));this.opts=e,di(e)}get props(){return A(se(this,Xg))}set props(e){ve(se(this,Xg),e)}}Xg=new WeakMap;function ZF(r){return new XF(r)}var YF=Ve("<div><!></div>");function KF(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"decorative",3,!1),l=fe(e,"orientation",3,"horizontal"),u=an(e,["$$slots","$$events","$$legacy","id","ref","child","children","decorative","orientation"]);const a=ZF({ref:nt.with(()=>n(),k=>n(k)),id:nt.with(()=>t()),decorative:nt.with(()=>i()),orientation:nt.with(()=>l())}),p=Re(()=>hi(u,a.props));var y=it(),x=xe(y);{var T=k=>{var F=it(),D=xe(F);fr(D,()=>e.child,()=>({props:A(p)})),K(k,F)},E=k=>{var F=YF();let D;var N=Be(F);fr(N,()=>e.children??Cr),ke(F),ct(()=>D=Tn(F,D,{...A(p)})),K(k,F)};et(x,k=>{e.child?k(T):k(E,!1)})}K(r,y),Ut()}function GF(r,e){let t=fe(e,"isStatic",3,!1),n=an(e,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var i=it(),l=xe(i);{var u=p=>{HF(p,{get content(){return e.content},get onPlaced(){return e.onPlaced}})},a=p=>{jF(p,cn({get content(){return e.content},get onPlaced(){return e.onPlaced}},()=>n))};et(l,p=>{t()?p(u):p(a,!1)})}K(r,i)}var JF=Ve("<!> <!>",1);function dC(r,e){zt(e,!0);let t=fe(e,"interactOutsideBehavior",3,"close"),n=fe(e,"trapFocus",3,!0),i=fe(e,"isValidEvent",3,()=>!1),l=fe(e,"customAnchor",3,null),u=fe(e,"isStatic",3,!1),a=an(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);GF(r,{get isStatic(){return u()},get id(){return e.id},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get enabled(){return e.enabled},content:(y,x)=>{let T=()=>x==null?void 0:x().props,E=()=>x==null?void 0:x().wrapperProps;var k=JF(),F=xe(k);{var D=U=>{oS(U,{get preventScroll(){return e.preventScroll}})},N=(U,j)=>{{var J=oe=>{oS(oe,{get preventScroll(){return e.preventScroll}})};et(U,oe=>{e.forceMount||oe(J)},j)}};et(F,U=>{e.forceMount&&e.enabled?U(D):U(N,!1)})}var B=we(F,2);const V=Re(()=>e.enabled&&n());r4(B,{get id(){return e.id},get onOpenAutoFocus(){return e.onOpenAutoFocus},get onCloseAutoFocus(){return e.onCloseAutoFocus},get loop(){return e.loop},get trapFocus(){return A(V)},get forceMount(){return e.forceMount},focusScope:(j,J)=>{let oe=()=>J==null?void 0:J().props;CN(j,{get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get enabled(){return e.enabled},children:(le,Ce)=>{SN(le,{get id(){return e.id},get onInteractOutside(){return e.onInteractOutside},get onFocusOutside(){return e.onFocusOutside},get interactOutsideBehavior(){return t()},get isValidEvent(){return i()},get enabled(){return e.enabled},children:(Ue,De)=>{let pe=()=>De==null?void 0:De().props;a4(Ue,{get id(){return e.id},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get enabled(){return e.enabled},children:(ze,Ne)=>{var ot=it(),At=xe(ot),Qe=Gs(()=>({props:hi(a,T(),pe(),oe(),{style:{pointerEvents:"auto"}}),wrapperProps:E()}));fr(At,()=>e.popper??Cr,()=>A(Qe)),K(ze,ot)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),K(y,k)},$$slots:{content:!0}}),Ut()}function QF(r,e){let t=fe(e,"interactOutsideBehavior",3,"close"),n=fe(e,"trapFocus",3,!0),i=fe(e,"isValidEvent",3,()=>!1),l=fe(e,"customAnchor",3,null),u=fe(e,"isStatic",3,!1),a=an(e,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);mN(r,cn({get id(){return e.id},get present(){return e.present}},()=>a,{presence:y=>{dC(y,cn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get isStatic(){return u()},get enabled(){return e.present},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return t()},get loop(){return e.loop},get trapFocus(){return n()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside},forceMount:!1},()=>a))},$$slots:{presence:!0}}))}function eB(r,e){let t=fe(e,"interactOutsideBehavior",3,"close"),n=fe(e,"trapFocus",3,!0),i=fe(e,"isValidEvent",3,()=>!1),l=fe(e,"customAnchor",3,null),u=fe(e,"isStatic",3,!1),a=an(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);dC(r,cn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return l()},get isStatic(){return u()},get enabled(){return e.enabled},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return t()},get loop(){return e.loop},get trapFocus(){return n()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside}},()=>a,{forceMount:!0}))}var tB=Ve("<div><div><!></div></div>"),rB=Ve("<div><div><!></div></div>");function fC(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"forceMount",3,!1),l=fe(e,"side",3,"bottom"),u=fe(e,"onInteractOutside",3,Xn),a=fe(e,"onEscapeKeydown",3,Xn),p=fe(e,"preventScroll",3,!1),y=an(e,["$$slots","$$events","$$legacy","id","ref","forceMount","side","onInteractOutside","onEscapeKeydown","children","child","preventScroll"]);const x=kF({id:nt.with(()=>t()),ref:nt.with(()=>n(),N=>n(N)),onInteractOutside:nt.with(()=>u()),onEscapeKeydown:nt.with(()=>a())}),T=Re(()=>hi(y,x.props));var E=it(),k=xe(E);{var F=N=>{eB(N,cn(()=>A(T),()=>x.popperProps,{get side(){return l()},get enabled(){return x.root.opts.open.current},get id(){return t()},get preventScroll(){return p()},forceMount:!0,popper:(V,U)=>{let j=()=>U==null?void 0:U().props,J=()=>U==null?void 0:U().wrapperProps;var oe=it();const le=Re(()=>hi(j(),{style:x.props.style}));var Ce=xe(oe);{var Ie=De=>{var pe=it(),ze=xe(pe),Ne=Gs(()=>({props:A(le),wrapperProps:J(),...x.snippetProps}));fr(ze,()=>e.child,()=>A(Ne)),K(De,pe)},Ue=De=>{var pe=tB();let ze;var Ne=Be(pe);let ot;var At=Be(Ne);fr(At,()=>e.children??Cr),ke(Ne),ke(pe),ct(()=>{ze=Tn(pe,ze,{...J()}),ot=Tn(Ne,ot,{...A(le)})}),K(De,pe)};et(Ce,De=>{e.child?De(Ie):De(Ue,!1)})}K(V,oe)},$$slots:{popper:!0}}))},D=(N,B)=>{{var V=U=>{QF(U,cn(()=>A(T),()=>x.popperProps,{get side(){return l()},get present(){return x.root.opts.open.current},get id(){return t()},get preventScroll(){return p()},forceMount:!1,popper:(J,oe)=>{let le=()=>oe==null?void 0:oe().props,Ce=()=>oe==null?void 0:oe().wrapperProps;var Ie=it();const Ue=Re(()=>hi(le(),{style:x.props.style}));var De=xe(Ie);{var pe=Ne=>{var ot=it(),At=xe(ot),Qe=Gs(()=>({props:A(Ue),wrapperProps:Ce(),...x.snippetProps}));fr(At,()=>e.child,()=>A(Qe)),K(Ne,ot)},ze=Ne=>{var ot=rB();let At;var Qe=Be(ot);let pt;var _t=Be(Qe);fr(_t,()=>e.children??Cr),ke(Qe),ke(ot),ct(()=>{At=Tn(ot,At,{...Ce()}),pt=Tn(Qe,pt,{...A(Ue)})}),K(Ne,ot)};et(De,Ne=>{e.child?Ne(pe):Ne(ze,!1)})}K(J,Ie)},$$slots:{popper:!0}}))};et(N,U=>{i()||U(V)},B)}};et(k,N=>{i()?N(F):N(D,!1)})}K(r,E),Ut()}function l1(r,e){zt(e,!0);let t=fe(e,"mounted",15,!1),n=fe(e,"onMountedChange",3,Xn);Ww(()=>(t(!0),n()(!0),()=>{t(!1),n()(!1)})),Ut()}var nB=Ve("<div><!></div>"),iB=Ve("<!> <!>",1);function pC(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"label",19,()=>e.value),l=fe(e,"disabled",3,!1),u=fe(e,"onHighlight",3,Xn),a=fe(e,"onUnhighlight",3,Xn),p=an(e,["$$slots","$$events","$$legacy","id","ref","value","label","disabled","children","child","onHighlight","onUnhighlight"]);const y=OF({id:nt.with(()=>t()),ref:nt.with(()=>n(),N=>n(N)),value:nt.with(()=>e.value),disabled:nt.with(()=>l()),label:nt.with(()=>i()),onHighlight:nt.with(()=>u()),onUnhighlight:nt.with(()=>a())}),x=Re(()=>hi(p,y.props));var T=iB(),E=xe(T);{var k=N=>{var B=it(),V=xe(B),U=Gs(()=>({props:A(x),...y.snippetProps}));fr(V,()=>e.child,()=>A(U)),K(N,B)},F=N=>{var B=nB();let V;var U=Be(B);fr(U,()=>e.children??Cr,()=>y.snippetProps),ke(B),ct(()=>V=Tn(B,V,{...A(x)})),K(N,B)};et(E,N=>{e.child?N(k):N(F,!1)})}var D=we(E,2);l1(D,{get mounted(){return y.mounted},set mounted(N){y.mounted=N}}),K(r,T),Ut()}var sB=Ve("<div><!></div>");function oB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=an(e,["$$slots","$$events","$$legacy","id","ref","children","child"]);const l=DF({id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T))}),u=Re(()=>hi(i,l.props));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E);fr(k,()=>e.child,()=>({props:A(u)})),K(T,E)},x=T=>{var E=sB();let k;var F=Be(E);fr(F,()=>e.children??Cr),ke(E),ct(()=>k=Tn(E,k,{...A(u)})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}var aB=Ve("<div><!></div>"),lB=Ve("<!> <!>",1);function cB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"delay",3,()=>50),l=an(e,["$$slots","$$events","$$legacy","id","ref","delay","child","children"]);const u=FF({id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T)),delay:nt.with(()=>i())}),a=Re(()=>hi(l,u.props));var p=it(),y=xe(p);{var x=T=>{var E=lB(),k=xe(E);l1(k,{get mounted(){return u.scrollButtonState.mounted},set mounted(B){u.scrollButtonState.mounted=B}});var F=we(k,2);{var D=B=>{var V=it(),U=xe(V);fr(U,()=>e.child,()=>({props:l})),K(B,V)},N=B=>{var V=aB();let U;var j=Be(V);fr(j,()=>e.children??Cr),ke(V),ct(()=>U=Tn(V,U,{...A(a)})),K(B,V)};et(F,B=>{e.child?B(D):B(N,!1)})}K(T,E)};et(y,T=>{u.canScrollDown&&T(x)})}K(r,p),Ut()}var uB=Ve("<div><!></div>"),hB=Ve("<!> <!>",1);function dB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"delay",3,()=>50),l=an(e,["$$slots","$$events","$$legacy","id","ref","delay","child","children"]);const u=NF({id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T)),delay:nt.with(()=>i())}),a=Re(()=>hi(l,u.props));var p=it(),y=xe(p);{var x=T=>{var E=hB(),k=xe(E);l1(k,{get mounted(){return u.scrollButtonState.mounted},set mounted(B){u.scrollButtonState.mounted=B}});var F=we(k,2);{var D=B=>{var V=it(),U=xe(V);fr(U,()=>e.child,()=>({props:l})),K(B,V)},N=B=>{var V=uB();let U;var j=Be(V);fr(j,()=>e.children??Cr),ke(V),ct(()=>U=Tn(V,U,{...A(a)})),K(B,V)};et(F,B=>{e.child?B(D):B(N,!1)})}K(T,E)};et(y,T=>{u.canScrollUp&&T(x)})}K(r,p),Ut()}const fB="data-label-root";var Zg;class pB{constructor(e){Z(this,"opts");ut(this,Zg,Re(()=>({id:this.opts.id.current,[fB]:"",onmousedown:this.onmousedown})));this.opts=e,this.onmousedown=this.onmousedown.bind(this),di(e)}onmousedown(e){e.detail>1&&e.preventDefault()}get props(){return A(se(this,Zg))}set props(e){ve(se(this,Zg),e)}}Zg=new WeakMap;function gB(r){return new pB(r)}var mB=Ve("<label><!></label>");function gC(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=an(e,["$$slots","$$events","$$legacy","children","child","id","ref","for"]);const l=gB({id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T))}),u=Re(()=>hi(i,l.props,{for:e.for}));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E);fr(k,()=>e.child,()=>({props:A(u)})),K(T,E)},x=T=>{var E=mB();let k;var F=Be(E);fr(F,()=>e.children??Cr),ke(E),ct(()=>k=Tn(E,k,{...A(u),for:e.for})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}const _B="data-radio-group-root",mC="data-radio-group-item";var Yg,Kg;class yB{constructor(e){Z(this,"opts");Z(this,"rovingFocusGroup");ut(this,Yg,Re(()=>this.opts.value.current!==""));ut(this,Kg,Re(()=>({id:this.opts.id.current,role:"radiogroup","aria-required":PI(this.opts.required.current),"data-disabled":Po(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,[_B]:""})));this.opts=e,this.rovingFocusGroup=OI({rootNodeId:this.opts.id,candidateAttr:mC,loop:this.opts.loop,orientation:this.opts.orientation}),di({id:this.opts.id,ref:this.opts.ref})}get hasValue(){return A(se(this,Yg))}set hasValue(e){ve(se(this,Yg),e)}isChecked(e){return this.opts.value.current===e}setValue(e){this.opts.value.current=e}get props(){return A(se(this,Kg))}set props(e){ve(se(this,Kg),e)}}Yg=new WeakMap,Kg=new WeakMap;var Gg,$h,qh,Kl,Jg,Qg;class vB{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Gg,Re(()=>this.root.opts.value.current===this.opts.value.current));ut(this,$h,Re(()=>this.opts.disabled.current||this.root.opts.disabled.current));ut(this,qh,Re(()=>this.root.isChecked(this.opts.value.current)));ut(this,Kl,Pt(-1));ut(this,Jg,Re(()=>({checked:A(se(this,qh))})));ut(this,Qg,Re(()=>({id:this.opts.id.current,disabled:A(se(this,$h))?!0:void 0,"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Po(A(se(this,$h))),"data-state":A(se(this,qh))?"checked":"unchecked","aria-checked":RI(A(se(this,qh))),[mC]:"",type:"button",role:"radio",tabindex:A(se(this,Kl)),onkeydown:this.onkeydown,onfocus:this.onfocus,onclick:this.onclick})));this.opts=e,this.root=t,di(e),this.opts.value.current===this.root.opts.value.current?(this.root.rovingFocusGroup.setCurrentTabStopId(this.opts.id.current),ve(se(this,Kl),0)):this.root.opts.value.current||ve(se(this,Kl),0),Xr(()=>{ve(se(this,Kl),this.root.rovingFocusGroup.getTabIndex(this.opts.ref.current),!0)}),Rn([()=>this.opts.value.current,()=>this.root.opts.value.current],()=>{this.opts.value.current===this.root.opts.value.current&&(this.root.rovingFocusGroup.setCurrentTabStopId(this.opts.id.current),ve(se(this,Kl),0))}),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this),this.onfocus=this.onfocus.bind(this)}get checked(){return A(se(this,Gg))}set checked(e){ve(se(this,Gg),e)}onclick(e){this.opts.disabled.current||this.root.setValue(this.opts.value.current)}onfocus(e){this.root.hasValue&&this.root.setValue(this.opts.value.current)}onkeydown(e){if(!A(se(this,$h))){if(e.key===Rh){e.preventDefault(),this.root.setValue(this.opts.value.current);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e,!0)}}get snippetProps(){return A(se(this,Jg))}set snippetProps(e){ve(se(this,Jg),e)}get props(){return A(se(this,Qg))}set props(e){ve(se(this,Qg),e)}}Gg=new WeakMap,$h=new WeakMap,qh=new WeakMap,Kl=new WeakMap,Jg=new WeakMap,Qg=new WeakMap;var em,tm;class bB{constructor(e){Z(this,"root");ut(this,em,Re(()=>this.root.opts.name.current!==void 0));ut(this,tm,Re(()=>({name:this.root.opts.name.current,value:this.root.opts.value.current,required:this.root.opts.required.current,disabled:this.root.opts.disabled.current})));this.root=e}get shouldRender(){return A(se(this,em))}set shouldRender(e){ve(se(this,em),e)}get props(){return A(se(this,tm))}set props(e){ve(se(this,tm),e)}}em=new WeakMap,tm=new WeakMap;const c1=new nl("RadioGroup.Root");function xB(r){return c1.set(new yB(r))}function wB(r){return new vB(r,c1.get())}function TB(){return new bB(c1.get())}function SB(r,e){zt(e,!1);const t=TB();Nm();var n=it(),i=xe(n);{var l=u=>{Jw(u,cn(()=>t.props))};et(i,u=>{t.shouldRender&&u(l)})}K(r,n),Ut()}var AB=Ve("<div><!></div>"),EB=Ve("<!> <!>",1);function IB(r,e){zt(e,!0);let t=fe(e,"disabled",3,!1),n=fe(e,"value",15,""),i=fe(e,"ref",15,null),l=fe(e,"orientation",3,"vertical"),u=fe(e,"loop",3,!0),a=fe(e,"name",3,void 0),p=fe(e,"required",3,!1),y=fe(e,"id",19,_i),x=fe(e,"onValueChange",3,Xn),T=an(e,["$$slots","$$events","$$legacy","disabled","children","child","value","ref","orientation","loop","name","required","id","onValueChange"]);const E=xB({orientation:nt.with(()=>l()),disabled:nt.with(()=>t()),loop:nt.with(()=>u()),name:nt.with(()=>a()),required:nt.with(()=>p()),id:nt.with(()=>y()),value:nt.with(()=>n(),U=>{var j;U!==n()&&(n(U),(j=x())==null||j(U))}),ref:nt.with(()=>i(),U=>i(U))}),k=Re(()=>hi(T,E.props));var F=EB(),D=xe(F);{var N=U=>{var j=it(),J=xe(j);fr(J,()=>e.child,()=>({props:A(k)})),K(U,j)},B=U=>{var j=AB();let J;var oe=Be(j);fr(oe,()=>e.children??Cr),ke(j),ct(()=>J=Tn(j,J,{...A(k)})),K(U,j)};et(D,U=>{e.child?U(N):U(B,!1)})}var V=we(D,2);SB(V,{}),K(r,F),Ut()}var CB=Ve("<button><!></button>");function PB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"disabled",3,!1),i=fe(e,"ref",15,null),l=an(e,["$$slots","$$events","$$legacy","id","children","child","value","disabled","ref"]);const u=wB({value:nt.with(()=>e.value),disabled:nt.with(()=>n()??!1),id:nt.with(()=>t()),ref:nt.with(()=>i(),E=>i(E))}),a=Re(()=>hi(l,u.props));var p=it(),y=xe(p);{var x=E=>{var k=it(),F=xe(k),D=Gs(()=>({props:A(a),...u.snippetProps}));fr(F,()=>e.child,()=>A(D)),K(E,k)},T=E=>{var k=CB();let F;var D=Be(k);fr(D,()=>e.children??Cr,()=>u.snippetProps),ke(k),ct(()=>F=Tn(k,F,{...A(a)})),K(E,k)};et(y,E=>{e.child?E(x):E(T,!1)})}K(r,p),Ut()}var RB=Ve("<!> <!>",1);function kB(r,e){zt(e,!0);let t=fe(e,"value",15),n=fe(e,"onValueChange",3,Xn),i=fe(e,"name",3,""),l=fe(e,"disabled",3,!1),u=fe(e,"open",15,!1),a=fe(e,"onOpenChange",3,Xn),p=fe(e,"loop",3,!1),y=fe(e,"scrollAlignment",3,"nearest"),x=fe(e,"required",3,!1),T=fe(e,"items",19,()=>[]),E=fe(e,"allowDeselect",3,!1);function k(){t()===void 0&&t(e.type==="single"?"":[])}k(),Rn.pre(()=>t(),()=>{k()});const F=uC({type:e.type,value:nt.with(()=>t(),j=>{t(j),n()(j)}),disabled:nt.with(()=>l()),required:nt.with(()=>x()),open:nt.with(()=>u(),j=>{u(j),a()(j)}),loop:nt.with(()=>p()),scrollAlignment:nt.with(()=>y()),name:nt.with(()=>i()),isCombobox:!1,items:nt.with(()=>T()),allowDeselect:nt.with(()=>E())});var D=RB(),N=xe(D);iC(N,{children:(j,J)=>{var oe=it(),le=xe(oe);fr(le,()=>e.children??Cr),K(j,oe)},$$slots:{default:!0}});var B=we(N,2);{var V=j=>{var J=it(),oe=xe(J);{var le=Ce=>{var Ie=it(),Ue=xe(Ie);jn(Ue,17,()=>F.opts.value.current,Hi,(De,pe)=>{My(De,{get value(){return A(pe)}})}),K(Ce,Ie)};et(oe,Ce=>{F.opts.value.current.length&&Ce(le)})}K(j,J)},U=j=>{My(j,{get value(){return F.opts.value.current},set value(J){F.opts.value.current=J}})};et(B,j=>{Array.isArray(F.opts.value.current)?j(V):j(U,!1)})}K(r,D),Ut()}var MB=Ve("<button><!></button>");function OB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"type",3,"button"),l=an(e,["$$slots","$$events","$$legacy","id","ref","child","children","type"]);const u=MF({id:nt.with(()=>t()),ref:nt.with(()=>n(),x=>n(x))}),a=Re(()=>hi(l,u.props,{type:i()}));var p=it(),y=xe(p);Tr(y,()=>hC,(x,T)=>{T(x,{get id(){return t()},children:(E,k)=>{var F=it(),D=xe(F);{var N=V=>{var U=it(),j=xe(U);fr(j,()=>e.child,()=>({props:A(a)})),K(V,U)},B=V=>{var U=MB();let j;var J=Be(U);fr(J,()=>e.children??Cr),ke(U),ct(()=>j=Tn(U,j,{...A(a)})),K(V,U)};et(D,V=>{e.child?V(N):V(B,!1)})}K(E,F)},$$slots:{default:!0}})}),K(r,p),Ut()}function DB(r,e,t){const n={position:"absolute"};return r==="lr"?(n.left=`${e}%`,n.right=`${t}%`):r==="rl"?(n.right=`${e}%`,n.left=`${t}%`):r==="bt"?(n.bottom=`${e}%`,n.top=`${t}%`):(n.top=`${e}%`,n.bottom=`${t}%`),n}function _C(r,e){const t={position:"absolute"};return r==="lr"?(t.left=`${e}%`,t.translate="-50% 0"):r==="rl"?(t.right=`${e}%`,t.translate="50% 0"):r==="bt"?(t.bottom=`${e}%`,t.translate="0 50%"):(t.top=`${e}%`,t.translate="0 -50%"),t}function yC(r,e,t){const n={position:"absolute"};return r==="lr"?(n.left=`${e}%`,n.translate=`${t}% 0`):r==="rl"?(n.right=`${e}%`,n.translate=`${-t}% 0`):r==="bt"?(n.bottom=`${e}%`,n.translate=`0 ${-t}%`):(n.top=`${e}%`,n.translate=`0 ${t}%`),n}function Mh(r,e,t,n){const i=(r-(Number.isNaN(e)?0:e))%n;let l=Math.abs(i)*2>=n?r+Math.sign(i)*(n-Math.abs(i)):r-i;Number.isNaN(e)?!Number.isNaN(t)&&l>t&&(l=Math.floor(t/n)*n):l<e?l=e:!Number.isNaN(t)&&l>t&&(l=e+Math.floor((t-e)/n)*n);const u=n.toString(),a=u.indexOf("."),p=a>=0?u.length-a:0;if(p>0){const y=10**p;l=Math.round(l*y)/y}return l}function u1(r,e,t=!0){const[n,i]=r,[l,u]=e,a=(u-l)/(i-n);return p=>{const y=l+a*(p-n);return t?y>Math.max(l,u)?Math.max(l,u):y<Math.min(l,u)?Math.min(l,u):y:y}}const NB="data-slider-root",Oy="data-slider-thumb",FB="data-slider-range",vC="data-slider-tick";var rm,nm,Sv,im;class bC{constructor(e){Z(this,"opts");ut(this,rm,Pt(!1));ut(this,nm,Re(()=>this.opts.orientation.current==="horizontal"?this.opts.dir.current==="rtl"?"rl":"lr":this.opts.dir.current==="rtl"?"tb":"bt"));ut(this,Sv,Re(()=>{if(!this.opts.disabled.current)return this.opts.orientation.current==="horizontal"?"pan-y":"pan-x"}));Z(this,"getAllThumbs",()=>{const e=this.opts.ref.current;return e?Array.from(e.querySelectorAll(`[${Oy}]`)):[]});Z(this,"getThumbScale",()=>{var p,y;if(this.opts.thumbPositioning.current==="exact")return[0,100];const e=this.opts.orientation.current==="vertical",t=this.getAllThumbs()[0],n=e?t==null?void 0:t.offsetHeight:t==null?void 0:t.offsetWidth;if(n===void 0||Number.isNaN(n)||n===0)return[0,100];const i=e?(p=this.opts.ref.current)==null?void 0:p.offsetHeight:(y=this.opts.ref.current)==null?void 0:y.offsetWidth;if(i===void 0||Number.isNaN(i)||i===0)return[0,100];const l=n/2/i*100,u=l,a=100-l;return[u,a]});Z(this,"getPositionFromValue",e=>{const t=this.getThumbScale();return u1([this.opts.min.current,this.opts.max.current],t)(e)});ut(this,im,Re(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,"data-disabled":Po(this.opts.disabled.current),style:{touchAction:A(se(this,Sv))},[NB]:""})));this.opts=e,di(e)}get isActive(){return A(se(this,rm))}set isActive(e){ve(se(this,rm),e,!0)}get direction(){return A(se(this,nm))}set direction(e){ve(se(this,nm),e)}isThumbActive(e){return this.isActive}get props(){return A(se(this,im))}set props(e){ve(se(this,im),e)}}rm=new WeakMap,nm=new WeakMap,Sv=new WeakMap,im=new WeakMap;var sm,om,am,lm,cm;class BB extends bC{constructor(t){super(t);Z(this,"opts");Z(this,"isMulti",!1);Z(this,"updateValue",t=>{this.opts.value.current=Mh(t,this.opts.min.current,this.opts.max.current,this.opts.step.current)});Z(this,"handlePointerMove",t=>{if(!this.isActive||this.opts.disabled.current)return;t.preventDefault(),t.stopPropagation();const n=this.opts.ref.current,i=this.getAllThumbs()[0];if(!n||!i)return;i.focus();const{left:l,right:u,top:a,bottom:p}=n.getBoundingClientRect();this.direction==="lr"?this.applyPosition({clientXY:t.clientX,start:l,end:u}):this.direction==="rl"?this.applyPosition({clientXY:t.clientX,start:u,end:l}):this.direction==="bt"?this.applyPosition({clientXY:t.clientY,start:p,end:a}):this.direction==="tb"&&this.applyPosition({clientXY:t.clientY,start:a,end:p})});Z(this,"handlePointerDown",t=>{if(t.button!==0||this.opts.disabled.current)return;const n=this.opts.ref.current,i=this.getAllThumbs()[0];if(!i||!n)return;const l=t.target;!MI(l)||!n.contains(l)||(t.preventDefault(),i.focus(),this.isActive=!0,this.handlePointerMove(t))});Z(this,"handlePointerUp",()=>{this.opts.disabled.current||(this.isActive&&this.opts.onValueCommit.current(fo(()=>this.opts.value.current)),this.isActive=!1)});ut(this,sm,Re(()=>{const t=this.opts.value.current;return Array.from({length:1},()=>{const n=t,i=this.getPositionFromValue(n),l=_C(this.direction,i);return{role:"slider","aria-valuemin":this.opts.min.current,"aria-valuemax":this.opts.max.current,"aria-valuenow":n,"aria-disabled":II(this.opts.disabled.current),"aria-orientation":this.opts.orientation.current,"data-value":n,tabindex:this.opts.disabled.current?-1:0,style:l,[Oy]:""}})}));ut(this,om,Re(()=>this.thumbsPropsArr.map((t,n)=>n)));ut(this,am,Re(()=>{const t=this.opts.max.current,n=this.opts.min.current,i=this.opts.step.current,l=t-n;let u=Math.ceil(l/i);l%i==0&&u++;const a=this.opts.value.current;return Array.from({length:u},(p,y)=>{const x=y*i,T=u1([0,(u-1)*i],this.getThumbScale()),E=y===0,k=y===u-1,F=E?0:k?-100:-50,D=yC(this.direction,T(x),F),N=n+y*i,B=N<=a;return{"data-disabled":Po(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,"data-bounded":B?"":void 0,"data-value":N,style:D,[vC]:""}})}));ut(this,lm,Re(()=>this.ticksPropsArr.map((t,n)=>n)));ut(this,cm,Re(()=>({ticks:this.ticksRenderArr,thumbs:this.thumbsRenderArr})));this.opts=t,Ww(()=>Ka(ui(document,"pointerdown",this.handlePointerDown),ui(document,"pointerup",this.handlePointerUp),ui(document,"pointermove",this.handlePointerMove),ui(document,"pointerleave",this.handlePointerUp))),Rn([()=>this.opts.step.current,()=>this.opts.min.current,()=>this.opts.max.current,()=>this.opts.value.current],([n,i,l,u])=>{const a=y=>Mh(y,i,l,n)===y,p=y=>Mh(y,i,l,n);a(u)||(this.opts.value.current=p(u))})}applyPosition({clientXY:t,start:n,end:i}){const l=this.opts.min.current,u=this.opts.max.current,p=(t-n)/(i-n)*(u-l)+l;if(p<l)this.updateValue(l);else if(p>u)this.updateValue(u);else{const y=this.opts.step.current,x=Math.floor((p-l)/y),T=l+x*y+y/2,E=l+(x+1)*y+y/2,k=p>=T&&p<E?(x+1)*y+l:x*y+l;k<=u&&this.updateValue(k)}}get thumbsPropsArr(){return A(se(this,sm))}set thumbsPropsArr(t){ve(se(this,sm),t)}get thumbsRenderArr(){return A(se(this,om))}set thumbsRenderArr(t){ve(se(this,om),t)}get ticksPropsArr(){return A(se(this,am))}set ticksPropsArr(t){ve(se(this,am),t)}get ticksRenderArr(){return A(se(this,lm))}set ticksRenderArr(t){ve(se(this,lm),t)}get snippetProps(){return A(se(this,cm))}set snippetProps(t){ve(se(this,cm),t)}}sm=new WeakMap,om=new WeakMap,am=new WeakMap,lm=new WeakMap,cm=new WeakMap;var um,hm,Av,dm,fm,pm,gm,mm;class LB extends bC{constructor(t){super(t);Z(this,"opts");Z(this,"isMulti",!0);ut(this,um,Pt(null));ut(this,hm,Pt(0));ut(this,Av,t=>{const n=this.getAllThumbs();if(!n.length)return;for(const a of n)a.blur();const i=n.map(a=>{if(this.opts.orientation.current==="horizontal"){const{left:p,right:y}=a.getBoundingClientRect();return Math.abs(t.clientX-(p+y)/2)}else{const{top:p,bottom:y}=a.getBoundingClientRect();return Math.abs(t.clientY-(p+y)/2)}}),l=n[i.indexOf(Math.min(...i))],u=n.indexOf(l);return{node:l,idx:u}});Z(this,"handlePointerMove",t=>{if(!this.isActive||this.opts.disabled.current)return;t.preventDefault(),t.stopPropagation();const n=this.opts.ref.current,i=this.activeThumb;if(!n||!i)return;i.node.focus();const{left:l,right:u,top:a,bottom:p}=n.getBoundingClientRect(),y=this.direction;y==="lr"?this.applyPosition({clientXY:t.clientX,activeThumbIdx:i.idx,start:l,end:u}):y==="rl"?this.applyPosition({clientXY:t.clientX,activeThumbIdx:i.idx,start:u,end:l}):y==="bt"?this.applyPosition({clientXY:t.clientY,activeThumbIdx:i.idx,start:p,end:a}):y==="tb"&&this.applyPosition({clientXY:t.clientY,activeThumbIdx:i.idx,start:a,end:p})});Z(this,"handlePointerDown",t=>{if(t.button!==0||this.opts.disabled.current)return;const n=this.opts.ref.current,i=se(this,Av).call(this,t);if(!i||!n)return;const l=t.target;!MI(l)||!n.contains(l)||(t.preventDefault(),this.activeThumb=i,i.node.focus(),this.isActive=!0,this.handlePointerMove(t))});Z(this,"handlePointerUp",()=>{this.opts.disabled.current||(this.isActive&&this.opts.onValueCommit.current(fo(()=>this.opts.value.current)),this.isActive=!1)});Z(this,"getAllThumbs",()=>{const t=this.opts.ref.current;return t?Array.from(t.querySelectorAll(`[${Oy}]`)):[]});Z(this,"updateValue",(t,n)=>{const i=this.opts.value.current;if(!i.length){this.opts.value.current.push(t);return}if(i[n]===t)return;const u=[...i];if(!d4(n,u))return;const a=u[n]>t?-1:1,p=()=>{var F;const E=n+a;u[n]=u[E],u[E]=t;const k=this.getAllThumbs();k.length&&((F=k[E])==null||F.focus(),this.activeThumb={node:k[E],idx:E})};if(this.opts.autoSort.current&&(a===-1&&t<u[n-1]||a===1&&t>u[n+1])){p(),this.opts.value.current=u;return}const y=this.opts.min.current,x=this.opts.max.current,T=this.opts.step.current;u[n]=Mh(t,y,x,T),this.opts.value.current=u});ut(this,dm,Re(()=>{const t=this.opts.value.current;return Array.from({length:t.length||1},(n,i)=>{const l=fo(()=>this.currentThumbIdx);l<t.length&&fo(()=>{this.currentThumbIdx=l+1});const u=t[i],a=this.getPositionFromValue(u??0),p=_C(this.direction,a);return{role:"slider","aria-valuemin":this.opts.min.current,"aria-valuemax":this.opts.max.current,"aria-valuenow":u,"aria-disabled":II(this.opts.disabled.current),"aria-orientation":this.opts.orientation.current,"data-value":u,tabindex:this.opts.disabled.current?-1:0,style:p,[Oy]:""}})}));ut(this,fm,Re(()=>this.thumbsPropsArr.map((t,n)=>n)));ut(this,pm,Re(()=>{const t=this.opts.max.current,n=this.opts.min.current,i=this.opts.step.current,l=t-n;let u=Math.ceil(l/i);l%i==0&&u++;const a=this.opts.value.current;return Array.from({length:u},(p,y)=>{const x=y*i,T=u1([0,(u-1)*i],this.getThumbScale()),E=y===0,k=y===u-1,F=E?0:k?-100:-50,D=yC(this.direction,T(x),F),N=n+y*i,B=a.length===1?N<=a[0]:a[0]<=N&&N<=a[a.length-1];return{"data-disabled":Po(this.opts.disabled.current),"data-orientation":this.opts.orientation.current,"data-bounded":B?"":void 0,"data-value":N,style:D,[vC]:""}})}));ut(this,gm,Re(()=>this.ticksPropsArr.map((t,n)=>n)));ut(this,mm,Re(()=>({ticks:this.ticksRenderArr,thumbs:this.thumbsRenderArr})));this.opts=t,Ww(()=>Ka(ui(document,"pointerdown",this.handlePointerDown),ui(document,"pointerup",this.handlePointerUp),ui(document,"pointermove",this.handlePointerMove),ui(document,"pointerleave",this.handlePointerUp))),Rn([()=>this.opts.step.current,()=>this.opts.min.current,()=>this.opts.max.current,()=>this.opts.value.current],([n,i,l,u])=>{const a=y=>Mh(y,i,l,n)===y,p=y=>Mh(y,i,l,n);u.some(y=>!a(y))&&(this.opts.value.current=u.map(p))})}get activeThumb(){return A(se(this,um))}set activeThumb(t){ve(se(this,um),t,!0)}get currentThumbIdx(){return A(se(this,hm))}set currentThumbIdx(t){ve(se(this,hm),t,!0)}isThumbActive(t){var n;return this.isActive&&((n=this.activeThumb)==null?void 0:n.idx)===t}applyPosition({clientXY:t,activeThumbIdx:n,start:i,end:l}){const u=this.opts.min.current,a=this.opts.max.current,y=(t-i)/(l-i)*(a-u)+u;if(y<u)this.updateValue(u,n);else if(y>a)this.updateValue(a,n);else{const x=this.opts.step.current,T=Math.floor((y-u)/x),E=u+T*x+x/2,k=u+(T+1)*x+x/2,F=y>=E&&y<k?(T+1)*x+u:T*x+u;F<=a&&this.updateValue(F,n)}}get thumbsPropsArr(){return A(se(this,dm))}set thumbsPropsArr(t){ve(se(this,dm),t)}get thumbsRenderArr(){return A(se(this,fm))}set thumbsRenderArr(t){ve(se(this,fm),t)}get ticksPropsArr(){return A(se(this,pm))}set ticksPropsArr(t){ve(se(this,pm),t)}get ticksRenderArr(){return A(se(this,gm))}set ticksRenderArr(t){ve(se(this,gm),t)}get snippetProps(){return A(se(this,mm))}set snippetProps(t){ve(se(this,mm),t)}}um=new WeakMap,hm=new WeakMap,Av=new WeakMap,dm=new WeakMap,fm=new WeakMap,pm=new WeakMap,gm=new WeakMap,mm=new WeakMap;const zB=[gd,md,Ls,ho,yd,_d];var _m,ym;class UB{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,_m,Re(()=>{const e=Array.isArray(this.root.opts.value.current)&&this.root.opts.value.current.length>1?this.root.getPositionFromValue(Math.min(...this.root.opts.value.current)??0):0,t=Array.isArray(this.root.opts.value.current)?100-this.root.getPositionFromValue(Math.max(...this.root.opts.value.current)??0):100-this.root.getPositionFromValue(this.root.opts.value.current);return{position:"absolute",...DB(this.root.direction,e,t)}}));ut(this,ym,Re(()=>({id:this.opts.id.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Po(this.root.opts.disabled.current),style:this.rangeStyles,[FB]:""})));this.opts=e,this.root=t,di(e)}get rangeStyles(){return A(se(this,_m))}set rangeStyles(e){ve(se(this,_m),e)}get props(){return A(se(this,ym))}set props(e){ve(se(this,ym),e)}}_m=new WeakMap,ym=new WeakMap;var Ev,gs,Fs,vm;class VB{constructor(e,t){ut(this,gs);Z(this,"opts");Z(this,"root");ut(this,Ev,Re(()=>this.root.opts.disabled.current||this.opts.disabled.current));ut(this,vm,Re(()=>({...this.root.thumbsPropsArr[this.opts.index.current],id:this.opts.id.current,onkeydown:this.onkeydown,"data-active":this.root.isThumbActive(this.opts.index.current)?"":void 0})));this.opts=e,this.root=t,di(e),this.onkeydown=this.onkeydown.bind(this)}onkeydown(e){if(A(se(this,Ev)))return;const t=this.opts.ref.current;if(!t)return;const n=this.root.getAllThumbs();if(!n.length)return;const i=n.indexOf(t);if(this.root.isMulti&&(this.root.currentThumbIdx=i),!zB.includes(e.key))return;e.preventDefault();const l=this.root.opts.min.current,u=this.root.opts.max.current,a=this.root.opts.value.current,p=Array.isArray(a)?a[i]:a,y=this.root.opts.orientation.current,x=this.root.direction,T=this.root.opts.step.current;switch(e.key){case yd:Nn(this,gs,Fs).call(this,l);break;case _d:Nn(this,gs,Fs).call(this,u);break;case gd:if(y!=="horizontal")break;if(e.metaKey){const E=x==="rl"?u:l;Nn(this,gs,Fs).call(this,E)}else x==="rl"&&p<u?Nn(this,gs,Fs).call(this,p+T):x==="lr"&&p>l&&Nn(this,gs,Fs).call(this,p-T);break;case md:if(y!=="horizontal")break;if(e.metaKey){const E=x==="rl"?l:u;Nn(this,gs,Fs).call(this,E)}else x==="rl"&&p>l?Nn(this,gs,Fs).call(this,p-T):x==="lr"&&p<u&&Nn(this,gs,Fs).call(this,p+T);break;case Ls:if(e.metaKey){const E=x==="tb"?l:u;Nn(this,gs,Fs).call(this,E)}else x==="tb"&&p>l?Nn(this,gs,Fs).call(this,p-T):x!=="tb"&&p<u&&Nn(this,gs,Fs).call(this,p+T);break;case ho:if(e.metaKey){const E=x==="tb"?u:l;Nn(this,gs,Fs).call(this,E)}else x==="tb"&&p<u?Nn(this,gs,Fs).call(this,p+T):x!=="tb"&&p>l&&Nn(this,gs,Fs).call(this,p-T);break}this.root.opts.onValueCommit.current(this.root.opts.value.current)}get props(){return A(se(this,vm))}set props(e){ve(se(this,vm),e)}}Ev=new WeakMap,gs=new WeakSet,Fs=function(e){this.root.isMulti?this.root.updateValue(e,this.opts.index.current):this.root.updateValue(e)},vm=new WeakMap;const h1=new nl("Slider.Root");function jB(r){const{type:e,...t}=r,n=e==="single"?new BB(t):new LB(t);return h1.set(n)}function HB(r){return new UB(r,h1.get())}function WB(r){return new VB(r,h1.get())}var $B=Ve("<span><!></span>");function qB(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"value",15),l=fe(e,"onValueChange",3,Xn),u=fe(e,"onValueCommit",3,Xn),a=fe(e,"disabled",3,!1),p=fe(e,"min",3,0),y=fe(e,"max",3,100),x=fe(e,"step",3,1),T=fe(e,"dir",3,"ltr"),E=fe(e,"autoSort",3,!0),k=fe(e,"orientation",3,"horizontal"),F=fe(e,"thumbPositioning",3,"contain"),D=an(e,["$$slots","$$events","$$legacy","children","child","id","ref","value","type","onValueChange","onValueCommit","disabled","min","max","step","dir","autoSort","orientation","thumbPositioning"]);function N(){i()===void 0&&i(e.type==="single"?0:[])}N(),Rn.pre(()=>i(),()=>{N()});const B=jB({id:nt.with(()=>t()),ref:nt.with(()=>n(),le=>n(le)),value:nt.with(()=>i(),le=>{i(le),l()(le)}),onValueCommit:nt.with(()=>u()),disabled:nt.with(()=>a()),min:nt.with(()=>p()),max:nt.with(()=>y()),step:nt.with(()=>x()),dir:nt.with(()=>T()),autoSort:nt.with(()=>E()),orientation:nt.with(()=>k()),thumbPositioning:nt.with(()=>F()),type:e.type}),V=Re(()=>hi(D,B.props));var U=it(),j=xe(U);{var J=le=>{var Ce=it(),Ie=xe(Ce),Ue=Gs(()=>({props:A(V),...B.snippetProps}));fr(Ie,()=>e.child,()=>A(Ue)),K(le,Ce)},oe=le=>{var Ce=$B();let Ie;var Ue=Be(Ce);fr(Ue,()=>e.children??Cr,()=>B.snippetProps),ke(Ce),ct(()=>Ie=Tn(Ce,Ie,{...A(V)})),K(le,Ce)};et(j,le=>{e.child?le(J):le(oe,!1)})}K(r,U),Ut()}var XB=Ve("<span><!></span>");function ZB(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"id",19,_i),i=an(e,["$$slots","$$events","$$legacy","children","child","ref","id"]);const l=HB({id:nt.with(()=>n()),ref:nt.with(()=>t(),T=>t(T))}),u=Re(()=>hi(i,l.props));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E);fr(k,()=>e.child,()=>({props:A(u)})),K(T,E)},x=T=>{var E=XB();let k;var F=Be(E);fr(F,()=>e.children??Cr),ke(E),ct(()=>k=Tn(E,k,{...A(u)})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}var YB=Ve("<span><!></span>");function KB(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"id",19,_i),i=fe(e,"disabled",3,!1),l=an(e,["$$slots","$$events","$$legacy","children","child","ref","id","index","disabled"]);const u=WB({id:nt.with(()=>n()),ref:nt.with(()=>t(),E=>t(E)),index:nt.with(()=>e.index),disabled:nt.with(()=>i())}),a=Re(()=>hi(l,u.props));var p=it(),y=xe(p);{var x=E=>{var k=it(),F=xe(k),D=Gs(()=>({active:u.root.isThumbActive(u.opts.index.current),props:A(a)}));fr(F,()=>e.child,()=>A(D)),K(E,k)},T=E=>{var k=YB();let F;var D=Be(k),N=Gs(()=>({active:u.root.isThumbActive(u.opts.index.current)}));fr(D,()=>e.children??Cr,()=>A(N)),ke(k),ct(()=>F=Tn(k,F,{...A(a)})),K(E,k)};et(y,E=>{e.child?E(x):E(T,!1)})}K(r,p),Ut()}const GB="data-switch-root",JB="data-switch-thumb";var bm,z0,xm,wm,Tm;class QB{constructor(e){ut(this,bm);Z(this,"opts");ut(this,xm,Re(()=>({"data-disabled":Po(this.opts.disabled.current),"data-state":FD(this.opts.checked.current),"data-required":LD(this.opts.required.current)})));ut(this,wm,Re(()=>({checked:this.opts.checked.current})));ut(this,Tm,Re(()=>({...this.sharedProps,id:this.opts.id.current,role:"switch",disabled:qw(this.opts.disabled.current),"aria-checked":RI(this.opts.checked.current),"aria-required":PI(this.opts.required.current),[GB]:"",onclick:this.onclick,onkeydown:this.onkeydown})));this.opts=e,di(e),this.onkeydown=this.onkeydown.bind(this),this.onclick=this.onclick.bind(this)}onkeydown(e){!(e.key===Kh||e.key===Rh)||this.opts.disabled.current||(e.preventDefault(),Nn(this,bm,z0).call(this))}onclick(e){this.opts.disabled.current||Nn(this,bm,z0).call(this)}get sharedProps(){return A(se(this,xm))}set sharedProps(e){ve(se(this,xm),e)}get snippetProps(){return A(se(this,wm))}set snippetProps(e){ve(se(this,wm),e)}get props(){return A(se(this,Tm))}set props(e){ve(se(this,Tm),e)}}bm=new WeakSet,z0=function(){this.opts.checked.current=!this.opts.checked.current},xm=new WeakMap,wm=new WeakMap,Tm=new WeakMap;var Sm,Am;class eL{constructor(e){Z(this,"root");ut(this,Sm,Re(()=>this.root.opts.name.current!==void 0));ut(this,Am,Re(()=>({type:"checkbox",name:this.root.opts.name.current,value:this.root.opts.value.current,checked:this.root.opts.checked.current,disabled:this.root.opts.disabled.current,required:this.root.opts.required.current})));this.root=e}get shouldRender(){return A(se(this,Sm))}set shouldRender(e){ve(se(this,Sm),e)}get props(){return A(se(this,Am))}set props(e){ve(se(this,Am),e)}}Sm=new WeakMap,Am=new WeakMap;var Em,Im;class tL{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Em,Re(()=>({checked:this.root.opts.checked.current})));ut(this,Im,Re(()=>({...this.root.sharedProps,id:this.opts.id.current,[JB]:""})));this.opts=e,this.root=t,di(e)}get snippetProps(){return A(se(this,Em))}set snippetProps(e){ve(se(this,Em),e)}get props(){return A(se(this,Im))}set props(e){ve(se(this,Im),e)}}Em=new WeakMap,Im=new WeakMap;const d1=new nl("Switch.Root");function rL(r){return d1.set(new QB(r))}function nL(){return new eL(d1.get())}function iL(r){return new tL(r,d1.get())}function sL(r,e){zt(e,!1);const t=nL();Nm();var n=it(),i=xe(n);{var l=u=>{Jw(u,cn(()=>t.props))};et(i,u=>{t.shouldRender&&u(l)})}K(r,n),Ut()}var oL=Ve("<button><!></button>"),aL=Ve("<!> <!>",1);function lL(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"id",19,_i),i=fe(e,"disabled",3,!1),l=fe(e,"required",3,!1),u=fe(e,"checked",15,!1),a=fe(e,"value",3,"on"),p=fe(e,"name",3,void 0),y=fe(e,"type",3,"button"),x=fe(e,"onCheckedChange",3,Xn),T=an(e,["$$slots","$$events","$$legacy","child","children","ref","id","disabled","required","checked","value","name","type","onCheckedChange"]);const E=rL({checked:nt.with(()=>u(),U=>{var j;u(U),(j=x())==null||j(U)}),disabled:nt.with(()=>i()??!1),required:nt.with(()=>l()),value:nt.with(()=>a()),name:nt.with(()=>p()),id:nt.with(()=>n()),ref:nt.with(()=>t(),U=>t(U))}),k=Re(()=>hi(T,E.props,{type:y()}));var F=aL(),D=xe(F);{var N=U=>{var j=it(),J=xe(j),oe=Gs(()=>({props:A(k),...E.snippetProps}));fr(J,()=>e.child,()=>A(oe)),K(U,j)},B=U=>{var j=oL();let J;var oe=Be(j);fr(oe,()=>e.children??Cr,()=>E.snippetProps),ke(j),ct(()=>J=Tn(j,J,{...A(k)})),K(U,j)};et(D,U=>{e.child?U(N):U(B,!1)})}var V=we(D,2);sL(V,{}),K(r,F),Ut()}var cL=Ve("<span><!></span>");function uL(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"id",19,_i),i=an(e,["$$slots","$$events","$$legacy","child","children","ref","id"]);const l=iL({id:nt.with(()=>n()),ref:nt.with(()=>t(),T=>t(T))}),u=Re(()=>hi(i,l.props));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E),F=Gs(()=>({props:A(u),...l.snippetProps}));fr(k,()=>e.child,()=>A(F)),K(T,E)},x=T=>{var E=cL();let k;var F=Be(E);fr(F,()=>e.children??Cr,()=>l.snippetProps),ke(E),ct(()=>k=Tn(E,k,{...A(u)})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}const hL="data-tabs-root",dL="data-tabs-list",xC="data-tabs-trigger",fL="data-tabs-content";var Cm,Pm;class pL{constructor(e){Z(this,"opts");Z(this,"rovingFocusGroup");ut(this,Cm,Pt(yn([])));Z(this,"valueToTriggerId",new gp);Z(this,"valueToContentId",new gp);ut(this,Pm,Re(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,[hL]:""})));this.opts=e,di(e),this.rovingFocusGroup=OI({candidateAttr:xC,rootNodeId:this.opts.id,loop:this.opts.loop,orientation:this.opts.orientation})}get triggerIds(){return A(se(this,Cm))}set triggerIds(e){ve(se(this,Cm),e,!0)}registerTrigger(e,t){return this.triggerIds.push(e),this.valueToTriggerId.set(t,e),()=>{this.triggerIds=this.triggerIds.filter(n=>n!==e),this.valueToTriggerId.delete(t)}}registerContent(e,t){return this.valueToContentId.set(t,e),()=>{this.valueToContentId.delete(t)}}setValue(e){this.opts.value.current=e}get props(){return A(se(this,Pm))}set props(e){ve(se(this,Pm),e)}}Cm=new WeakMap,Pm=new WeakMap;var Iv,Rm;class gL{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Iv,Re(()=>this.root.opts.disabled.current));ut(this,Rm,Re(()=>({id:this.opts.id.current,role:"tablist","aria-orientation":this.root.opts.orientation.current,"data-orientation":this.root.opts.orientation.current,[dL]:"","data-disabled":Po(A(se(this,Iv)))})));this.opts=e,this.root=t,di(e)}get props(){return A(se(this,Rm))}set props(e){ve(se(this,Rm),e)}}Iv=new WeakMap,Rm=new WeakMap;var Xh,Gl,Zh,Cv,Yh,gy,km;class mL{constructor(e,t){ut(this,Yh);Z(this,"opts");Z(this,"root");ut(this,Xh,Re(()=>this.root.opts.value.current===this.opts.value.current));ut(this,Gl,Re(()=>this.opts.disabled.current||this.root.opts.disabled.current));ut(this,Zh,Pt(0));ut(this,Cv,Re(()=>this.root.valueToContentId.get(this.opts.value.current)));ut(this,km,Re(()=>({id:this.opts.id.current,role:"tab","data-state":wC(A(se(this,Xh))),"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Po(A(se(this,Gl))),"aria-selected":BD(A(se(this,Xh))),"aria-controls":A(se(this,Cv)),[xC]:"",disabled:qw(A(se(this,Gl))),tabindex:A(se(this,Zh)),onclick:this.onclick,onfocus:this.onfocus,onkeydown:this.onkeydown})));this.opts=e,this.root=t,di(e),Rn([()=>this.opts.id.current,()=>this.opts.value.current],([n,i])=>this.root.registerTrigger(n,i)),Xr(()=>{this.root.triggerIds.length,A(se(this,Xh))||!this.root.opts.value.current?ve(se(this,Zh),0):ve(se(this,Zh),-1)}),this.onfocus=this.onfocus.bind(this),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onfocus(e){this.root.opts.activationMode.current!=="automatic"||A(se(this,Gl))||Nn(this,Yh,gy).call(this)}onclick(e){A(se(this,Gl))||Nn(this,Yh,gy).call(this)}onkeydown(e){if(!A(se(this,Gl))){if(e.key===Rh||e.key===Kh){e.preventDefault(),Nn(this,Yh,gy).call(this);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,e)}}get props(){return A(se(this,km))}set props(e){ve(se(this,km),e)}}Xh=new WeakMap,Gl=new WeakMap,Zh=new WeakMap,Cv=new WeakMap,Yh=new WeakSet,gy=function(){this.root.opts.value.current!==this.opts.value.current&&this.root.setValue(this.opts.value.current)},km=new WeakMap;var Mm,Pv,Om;class _L{constructor(e,t){Z(this,"opts");Z(this,"root");ut(this,Mm,Re(()=>this.root.opts.value.current===this.opts.value.current));ut(this,Pv,Re(()=>this.root.valueToTriggerId.get(this.opts.value.current)));ut(this,Om,Re(()=>({id:this.opts.id.current,role:"tabpanel",hidden:zD(!A(se(this,Mm))),tabindex:0,"data-value":this.opts.value.current,"data-state":wC(A(se(this,Mm))),"aria-labelledby":A(se(this,Pv)),[fL]:""})));this.opts=e,this.root=t,di(e),Rn([()=>this.opts.id.current,()=>this.opts.value.current],([n,i])=>this.root.registerContent(n,i))}get props(){return A(se(this,Om))}set props(e){ve(se(this,Om),e)}}Mm=new WeakMap,Pv=new WeakMap,Om=new WeakMap;const eb=new nl("Tabs.Root");function yL(r){return eb.set(new pL(r))}function vL(r){return new mL(r,eb.get())}function bL(r){return new gL(r,eb.get())}function xL(r){return new _L(r,eb.get())}function wC(r){return r?"active":"inactive"}var wL=Ve("<div><!></div>");function TL(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=fe(e,"value",15,""),l=fe(e,"onValueChange",3,Xn),u=fe(e,"orientation",3,"horizontal"),a=fe(e,"loop",3,!0),p=fe(e,"activationMode",3,"automatic"),y=fe(e,"disabled",3,!1),x=an(e,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","orientation","loop","activationMode","disabled","children","child"]);const T=yL({id:nt.with(()=>t()),value:nt.with(()=>i(),B=>{i(B),l()(B)}),orientation:nt.with(()=>u()),loop:nt.with(()=>a()),activationMode:nt.with(()=>p()),disabled:nt.with(()=>y()),ref:nt.with(()=>n(),B=>n(B))}),E=Re(()=>hi(x,T.props));var k=it(),F=xe(k);{var D=B=>{var V=it(),U=xe(V);fr(U,()=>e.child,()=>({props:A(E)})),K(B,V)},N=B=>{var V=wL();let U;var j=Be(V);fr(j,()=>e.children??Cr),ke(V),ct(()=>U=Tn(V,U,{...A(E)})),K(B,V)};et(F,B=>{e.child?B(D):B(N,!1)})}K(r,k),Ut()}var SL=Ve("<div><!></div>");function AL(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=an(e,["$$slots","$$events","$$legacy","children","child","id","ref","value"]);const l=xL({value:nt.with(()=>e.value),id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T))}),u=Re(()=>hi(i,l.props));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E);fr(k,()=>e.child,()=>({props:A(u)})),K(T,E)},x=T=>{var E=SL();let k;var F=Be(E);fr(F,()=>e.children??Cr),ke(E),ct(()=>k=Tn(E,k,{...A(u)})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}var EL=Ve("<div><!></div>");function IL(r,e){zt(e,!0);let t=fe(e,"id",19,_i),n=fe(e,"ref",15,null),i=an(e,["$$slots","$$events","$$legacy","child","children","id","ref"]);const l=bL({id:nt.with(()=>t()),ref:nt.with(()=>n(),T=>n(T))}),u=Re(()=>hi(i,l.props));var a=it(),p=xe(a);{var y=T=>{var E=it(),k=xe(E);fr(k,()=>e.child,()=>({props:A(u)})),K(T,E)},x=T=>{var E=EL();let k;var F=Be(E);fr(F,()=>e.children??Cr),ke(E),ct(()=>k=Tn(E,k,{...A(u)})),K(T,E)};et(p,T=>{e.child?T(y):T(x,!1)})}K(r,a),Ut()}var CL=Ve("<button><!></button>");function PL(r,e){zt(e,!0);let t=fe(e,"disabled",3,!1),n=fe(e,"id",19,_i),i=fe(e,"type",3,"button"),l=fe(e,"ref",15,null),u=an(e,["$$slots","$$events","$$legacy","child","children","disabled","id","type","value","ref"]);const a=vL({id:nt.with(()=>n()),disabled:nt.with(()=>t()??!1),value:nt.with(()=>e.value),ref:nt.with(()=>l(),k=>l(k))}),p=Re(()=>hi(u,a.props,{type:i()}));var y=it(),x=xe(y);{var T=k=>{var F=it(),D=xe(F);fr(D,()=>e.child,()=>({props:A(p)})),K(k,F)},E=k=>{var F=CL();let D;var N=Be(F);fr(N,()=>e.children??Cr),ke(F),ct(()=>D=Tn(F,D,{...A(p)})),K(k,F)};et(x,k=>{e.child?k(T):k(E,!1)})}K(r,y),Ut()}function f1(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"class",7),i=fe(e,"value",15),l=an(e,["$$slots","$$events","$$legacy","ref","class","value"]);var u=it(),a=xe(u);const p=Re(()=>kn("grid gap-1",n()));return Tr(a,()=>IB,(y,x)=>{x(y,cn({get class(){return A(p)}},()=>l,{get value(){return i()},set value(T){i(T)},get ref(){return t()},set ref(T){t(T)}}))}),K(r,u),Ut({get class(){return n()},set class(y){n(y)}})}function RL(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"circle"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var kL=Ve('<div class="flex items-center justify-center"><!></div>');function vp(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class"]);var i=it(),l=xe(i);const u=Re(()=>kn("border-primary text-primary focus-visible:ring-ring aspect-square size-4 rounded-full border shadow focus:outline-none focus-visible:ring-1 disabled:cursor-not-allowed disabled:opacity-50",e.class));Tr(l,()=>PB,(a,p)=>{p(a,cn({get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(x){t(x)},children:(x,T)=>{let E=()=>T==null?void 0:T().checked;var k=kL(),F=Be(k);{var D=N=>{RL(N,{class:"fill-primary size-3.5"})};et(F,N=>{E()&&N(D)})}ke(k),K(x,k)},$$slots:{default:!0}}))}),K(r,i),Ut()}var mS=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Zs=r=>!r||typeof r!="object"||Object.keys(r).length===0,ML=(r,e)=>JSON.stringify(r)===JSON.stringify(e);function TC(r,e){r.forEach(function(t){Array.isArray(t)?TC(t,e):e.push(t)})}function SC(r){let e=[];return TC(r,e),e}var AC=(...r)=>SC(r).filter(Boolean),EC=(r,e)=>{let t={},n=Object.keys(r),i=Object.keys(e);for(let l of n)if(i.includes(l)){let u=r[l],a=e[l];Array.isArray(u)||Array.isArray(a)?t[l]=AC(a,u):typeof u=="object"&&typeof a=="object"?t[l]=EC(u,a):t[l]=a+" "+u}else t[l]=r[l];for(let l of i)n.includes(l)||(t[l]=e[l]);return t},_S=r=>!r||typeof r!="string"?r:r.replace(/\s+/g," ").trim();const p1="-",OL=r=>{const e=NL(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:u=>{const a=u.split(p1);return a[0]===""&&a.length!==1&&a.shift(),IC(a,e)||DL(u)},getConflictingClassGroupIds:(u,a)=>{const p=t[u]||[];return a&&n[u]?[...p,...n[u]]:p}}},IC=(r,e)=>{var u;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),i=n?IC(r.slice(1),n):void 0;if(i)return i;if(e.validators.length===0)return;const l=r.join(p1);return(u=e.validators.find(({validator:a})=>a(l)))==null?void 0:u.classGroupId},yS=/^\[(.+)\]$/,DL=r=>{if(yS.test(r)){const e=yS.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},NL=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return BL(Object.entries(r.classGroups),t).forEach(([l,u])=>{U0(u,n,l,e)}),n},U0=(r,e,t,n)=>{r.forEach(i=>{if(typeof i=="string"){const l=i===""?e:vS(e,i);l.classGroupId=t;return}if(typeof i=="function"){if(FL(i)){U0(i(n),e,t,n);return}e.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([l,u])=>{U0(u,vS(e,l),t,n)})})},vS=(r,e)=>{let t=r;return e.split(p1).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},FL=r=>r.isThemeGetter,BL=(r,e)=>e?r.map(([t,n])=>{const i=n.map(l=>typeof l=="string"?e+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([u,a])=>[e+u,a])):l);return[t,i]}):r,LL=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const i=(l,u)=>{t.set(l,u),e++,e>r&&(e=0,n=t,t=new Map)};return{get(l){let u=t.get(l);if(u!==void 0)return u;if((u=n.get(l))!==void 0)return i(l,u),u},set(l,u){t.has(l)?t.set(l,u):i(l,u)}}},CC="!",zL=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,i=e[0],l=e.length,u=a=>{const p=[];let y=0,x=0,T;for(let N=0;N<a.length;N++){let B=a[N];if(y===0){if(B===i&&(n||a.slice(N,N+l)===e)){p.push(a.slice(x,N)),x=N+l;continue}if(B==="/"){T=N;continue}}B==="["?y++:B==="]"&&y--}const E=p.length===0?a:a.substring(x),k=E.startsWith(CC),F=k?E.substring(1):E,D=T&&T>x?T-x:void 0;return{modifiers:p,hasImportantModifier:k,baseClassName:F,maybePostfixModifierPosition:D}};return t?a=>t({className:a,parseClassName:u}):u},UL=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},VL=r=>({cache:LL(r.cacheSize),parseClassName:zL(r),...OL(r)}),jL=/\s+/,HL=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:i}=e,l=[],u=r.trim().split(jL);let a="";for(let p=u.length-1;p>=0;p-=1){const y=u[p],{modifiers:x,hasImportantModifier:T,baseClassName:E,maybePostfixModifierPosition:k}=t(y);let F=!!k,D=n(F?E.substring(0,k):E);if(!D){if(!F){a=y+(a.length>0?" "+a:a);continue}if(D=n(E),!D){a=y+(a.length>0?" "+a:a);continue}F=!1}const N=UL(x).join(":"),B=T?N+CC:N,V=B+D;if(l.includes(V))continue;l.push(V);const U=i(D,F);for(let j=0;j<U.length;++j){const J=U[j];l.push(B+J)}a=y+(a.length>0?" "+a:a)}return a};function WL(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=PC(e))&&(n&&(n+=" "),n+=t);return n}const PC=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=PC(r[n]))&&(t&&(t+=" "),t+=e);return t};function V0(r,...e){let t,n,i,l=u;function u(p){const y=e.reduce((x,T)=>T(x),r());return t=VL(y),n=t.cache.get,i=t.cache.set,l=a,a(p)}function a(p){const y=n(p);if(y)return y;const x=HL(p,t);return i(p,x),x}return function(){return l(WL.apply(null,arguments))}}const ci=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},RC=/^\[(?:([a-z-]+):)?(.+)\]$/i,$L=/^\d+\/\d+$/,qL=new Set(["px","full","screen"]),XL=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ZL=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,YL=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,KL=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GL=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,La=r=>Oh(r)||qL.has(r)||$L.test(r),Fl=r=>wd(r,"length",sz),Oh=r=>!!r&&!Number.isNaN(Number(r)),Ox=r=>wd(r,"number",Oh),Of=r=>!!r&&Number.isInteger(Number(r)),JL=r=>r.endsWith("%")&&Oh(r.slice(0,-1)),_n=r=>RC.test(r),Bl=r=>XL.test(r),QL=new Set(["length","size","percentage"]),ez=r=>wd(r,QL,kC),tz=r=>wd(r,"position",kC),rz=new Set(["image","url"]),nz=r=>wd(r,rz,az),iz=r=>wd(r,"",oz),Df=()=>!0,wd=(r,e,t)=>{const n=RC.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},sz=r=>ZL.test(r)&&!YL.test(r),kC=()=>!1,oz=r=>KL.test(r),az=r=>GL.test(r),j0=()=>{const r=ci("colors"),e=ci("spacing"),t=ci("blur"),n=ci("brightness"),i=ci("borderColor"),l=ci("borderRadius"),u=ci("borderSpacing"),a=ci("borderWidth"),p=ci("contrast"),y=ci("grayscale"),x=ci("hueRotate"),T=ci("invert"),E=ci("gap"),k=ci("gradientColorStops"),F=ci("gradientColorStopPositions"),D=ci("inset"),N=ci("margin"),B=ci("opacity"),V=ci("padding"),U=ci("saturate"),j=ci("scale"),J=ci("sepia"),oe=ci("skew"),le=ci("space"),Ce=ci("translate"),Ie=()=>["auto","contain","none"],Ue=()=>["auto","hidden","clip","visible","scroll"],De=()=>["auto",_n,e],pe=()=>[_n,e],ze=()=>["",La,Fl],Ne=()=>["auto",Oh,_n],ot=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],At=()=>["solid","dashed","dotted","double","none"],Qe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],pt=()=>["start","end","center","between","around","evenly","stretch"],_t=()=>["","0",_n],Lt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ht=()=>[Oh,_n];return{cacheSize:500,separator:":",theme:{colors:[Df],spacing:[La,Fl],blur:["none","",Bl,_n],brightness:Ht(),borderColor:[r],borderRadius:["none","","full",Bl,_n],borderSpacing:pe(),borderWidth:ze(),contrast:Ht(),grayscale:_t(),hueRotate:Ht(),invert:_t(),gap:pe(),gradientColorStops:[r],gradientColorStopPositions:[JL,Fl],inset:De(),margin:De(),opacity:Ht(),padding:pe(),saturate:Ht(),scale:Ht(),sepia:_t(),skew:Ht(),space:pe(),translate:pe()},classGroups:{aspect:[{aspect:["auto","square","video",_n]}],container:["container"],columns:[{columns:[Bl]}],"break-after":[{"break-after":Lt()}],"break-before":[{"break-before":Lt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ot(),_n]}],overflow:[{overflow:Ue()}],"overflow-x":[{"overflow-x":Ue()}],"overflow-y":[{"overflow-y":Ue()}],overscroll:[{overscroll:Ie()}],"overscroll-x":[{"overscroll-x":Ie()}],"overscroll-y":[{"overscroll-y":Ie()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[D]}],"inset-x":[{"inset-x":[D]}],"inset-y":[{"inset-y":[D]}],start:[{start:[D]}],end:[{end:[D]}],top:[{top:[D]}],right:[{right:[D]}],bottom:[{bottom:[D]}],left:[{left:[D]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Of,_n]}],basis:[{basis:De()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",_n]}],grow:[{grow:_t()}],shrink:[{shrink:_t()}],order:[{order:["first","last","none",Of,_n]}],"grid-cols":[{"grid-cols":[Df]}],"col-start-end":[{col:["auto",{span:["full",Of,_n]},_n]}],"col-start":[{"col-start":Ne()}],"col-end":[{"col-end":Ne()}],"grid-rows":[{"grid-rows":[Df]}],"row-start-end":[{row:["auto",{span:[Of,_n]},_n]}],"row-start":[{"row-start":Ne()}],"row-end":[{"row-end":Ne()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",_n]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",_n]}],gap:[{gap:[E]}],"gap-x":[{"gap-x":[E]}],"gap-y":[{"gap-y":[E]}],"justify-content":[{justify:["normal",...pt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...pt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...pt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[N]}],mx:[{mx:[N]}],my:[{my:[N]}],ms:[{ms:[N]}],me:[{me:[N]}],mt:[{mt:[N]}],mr:[{mr:[N]}],mb:[{mb:[N]}],ml:[{ml:[N]}],"space-x":[{"space-x":[le]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[le]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",_n,e]}],"min-w":[{"min-w":[_n,e,"min","max","fit"]}],"max-w":[{"max-w":[_n,e,"none","full","min","max","fit","prose",{screen:[Bl]},Bl]}],h:[{h:[_n,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[_n,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[_n,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[_n,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Bl,Fl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ox]}],"font-family":[{font:[Df]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",_n]}],"line-clamp":[{"line-clamp":["none",Oh,Ox]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",La,_n]}],"list-image":[{"list-image":["none",_n]}],"list-style-type":[{list:["none","disc","decimal",_n]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[B]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[B]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...At(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",La,Fl]}],"underline-offset":[{"underline-offset":["auto",La,_n]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:pe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_n]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_n]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[B]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ot(),tz]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",ez]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},nz]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[F]}],"gradient-via-pos":[{via:[F]}],"gradient-to-pos":[{to:[F]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[B]}],"border-style":[{border:[...At(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[B]}],"divide-style":[{divide:At()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...At()]}],"outline-offset":[{"outline-offset":[La,_n]}],"outline-w":[{outline:[La,Fl]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:ze()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[B]}],"ring-offset-w":[{"ring-offset":[La,Fl]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Bl,iz]}],"shadow-color":[{shadow:[Df]}],opacity:[{opacity:[B]}],"mix-blend":[{"mix-blend":[...Qe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Qe()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[p]}],"drop-shadow":[{"drop-shadow":["","none",Bl,_n]}],grayscale:[{grayscale:[y]}],"hue-rotate":[{"hue-rotate":[x]}],invert:[{invert:[T]}],saturate:[{saturate:[U]}],sepia:[{sepia:[J]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[p]}],"backdrop-grayscale":[{"backdrop-grayscale":[y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[x]}],"backdrop-invert":[{"backdrop-invert":[T]}],"backdrop-opacity":[{"backdrop-opacity":[B]}],"backdrop-saturate":[{"backdrop-saturate":[U]}],"backdrop-sepia":[{"backdrop-sepia":[J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[u]}],"border-spacing-x":[{"border-spacing-x":[u]}],"border-spacing-y":[{"border-spacing-y":[u]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",_n]}],duration:[{duration:Ht()}],ease:[{ease:["linear","in","out","in-out",_n]}],delay:[{delay:Ht()}],animate:[{animate:["none","spin","ping","pulse","bounce",_n]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Of,_n]}],"translate-x":[{"translate-x":[Ce]}],"translate-y":[{"translate-y":[Ce]}],"skew-x":[{"skew-x":[oe]}],"skew-y":[{"skew-y":[oe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",_n]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_n]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":pe()}],"scroll-mx":[{"scroll-mx":pe()}],"scroll-my":[{"scroll-my":pe()}],"scroll-ms":[{"scroll-ms":pe()}],"scroll-me":[{"scroll-me":pe()}],"scroll-mt":[{"scroll-mt":pe()}],"scroll-mr":[{"scroll-mr":pe()}],"scroll-mb":[{"scroll-mb":pe()}],"scroll-ml":[{"scroll-ml":pe()}],"scroll-p":[{"scroll-p":pe()}],"scroll-px":[{"scroll-px":pe()}],"scroll-py":[{"scroll-py":pe()}],"scroll-ps":[{"scroll-ps":pe()}],"scroll-pe":[{"scroll-pe":pe()}],"scroll-pt":[{"scroll-pt":pe()}],"scroll-pr":[{"scroll-pr":pe()}],"scroll-pb":[{"scroll-pb":pe()}],"scroll-pl":[{"scroll-pl":pe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_n]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[La,Fl,Ox]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},lz=(r,{cacheSize:e,prefix:t,separator:n,experimentalParseClassName:i,extend:l={},override:u={}})=>{$f(r,"cacheSize",e),$f(r,"prefix",t),$f(r,"separator",n),$f(r,"experimentalParseClassName",i);for(const a in u)cz(r[a],u[a]);for(const a in l)uz(r[a],l[a]);return r},$f=(r,e,t)=>{t!==void 0&&(r[e]=t)},cz=(r,e)=>{if(e)for(const t in e)$f(r,t,e[t])},uz=(r,e)=>{if(e)for(const t in e){const n=e[t];n!==void 0&&(r[t]=(r[t]||[]).concat(n))}},hz=(r,...e)=>typeof r=="function"?V0(j0,r,...e):V0(()=>lz(j0(),r),...e),dz=V0(j0);var fz={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},MC=r=>r||void 0,bp=(...r)=>MC(SC(r).filter(Boolean).join(" ")),Dx=null,Ua={},H0=!1,Nf=(...r)=>e=>e.twMerge?((!Dx||H0)&&(H0=!1,Dx=Zs(Ua)?dz:hz({...Ua,extend:{theme:Ua.theme,classGroups:Ua.classGroups,conflictingClassGroupModifiers:Ua.conflictingClassGroupModifiers,conflictingClassGroups:Ua.conflictingClassGroups,...Ua.extend}})),MC(Dx(bp(r)))):bp(r),bS=(r,e)=>{for(let t in e)r.hasOwnProperty(t)?r[t]=bp(r[t],e[t]):r[t]=e[t];return r},pz=(r,e)=>{let{extend:t=null,slots:n={},variants:i={},compoundVariants:l=[],compoundSlots:u=[],defaultVariants:a={}}=r,p={...fz,...e},y=t!=null&&t.base?bp(t.base,r==null?void 0:r.base):r==null?void 0:r.base,x=t!=null&&t.variants&&!Zs(t.variants)?EC(i,t.variants):i,T=t!=null&&t.defaultVariants&&!Zs(t.defaultVariants)?{...t.defaultVariants,...a}:a;!Zs(p.twMergeConfig)&&!ML(p.twMergeConfig,Ua)&&(H0=!0,Ua=p.twMergeConfig);let E=Zs(t==null?void 0:t.slots),k=Zs(n)?{}:{base:bp(r==null?void 0:r.base,E&&(t==null?void 0:t.base)),...n},F=E?k:bS({...t==null?void 0:t.slots},Zs(k)?{base:r==null?void 0:r.base}:k),D=Zs(t==null?void 0:t.compoundVariants)?l:AC(t==null?void 0:t.compoundVariants,l),N=V=>{if(Zs(x)&&Zs(n)&&E)return Nf(y,V==null?void 0:V.class,V==null?void 0:V.className)(p);if(D&&!Array.isArray(D))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof D}`);if(u&&!Array.isArray(u))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof u}`);let U=(pe,ze,Ne=[],ot)=>{let At=Ne;if(typeof ze=="string")At=At.concat(_S(ze).split(" ").map(Qe=>`${pe}:${Qe}`));else if(Array.isArray(ze))At=At.concat(ze.reduce((Qe,pt)=>Qe.concat(`${pe}:${pt}`),[]));else if(typeof ze=="object"&&typeof ot=="string"){for(let Qe in ze)if(ze.hasOwnProperty(Qe)&&Qe===ot){let pt=ze[Qe];if(pt&&typeof pt=="string"){let _t=_S(pt);At[ot]?At[ot]=At[ot].concat(_t.split(" ").map(Lt=>`${pe}:${Lt}`)):At[ot]=_t.split(" ").map(Lt=>`${pe}:${Lt}`)}else Array.isArray(pt)&&pt.length>0&&(At[ot]=pt.reduce((_t,Lt)=>_t.concat(`${pe}:${Lt}`),[]))}}return At},j=(pe,ze=x,Ne=null,ot=null)=>{var At;let Qe=ze[pe];if(!Qe||Zs(Qe))return null;let pt=(At=ot==null?void 0:ot[pe])!=null?At:V==null?void 0:V[pe];if(pt===null)return null;let _t=mS(pt),Lt=Array.isArray(p.responsiveVariants)&&p.responsiveVariants.length>0||p.responsiveVariants===!0,Ht=T==null?void 0:T[pe],ar=[];if(typeof _t=="object"&&Lt)for(let[Et,Or]of Object.entries(_t)){let ir=Qe[Or];if(Et==="initial"){Ht=Or;continue}Array.isArray(p.responsiveVariants)&&!p.responsiveVariants.includes(Et)||(ar=U(Et,ir,ar,Ne))}let Tt=_t!=null&&typeof _t!="object"?_t:mS(Ht),Sr=Qe[Tt||"false"];return typeof ar=="object"&&typeof Ne=="string"&&ar[Ne]?bS(ar,Sr):ar.length>0?(ar.push(Sr),Ne==="base"?ar.join(" "):ar):Sr},J=()=>x?Object.keys(x).map(pe=>j(pe,x)):null,oe=(pe,ze)=>{if(!x||typeof x!="object")return null;let Ne=new Array;for(let ot in x){let At=j(ot,x,pe,ze),Qe=pe==="base"&&typeof At=="string"?At:At&&At[pe];Qe&&(Ne[Ne.length]=Qe)}return Ne},le={};for(let pe in V)V[pe]!==void 0&&(le[pe]=V[pe]);let Ce=(pe,ze)=>{var Ne;let ot=typeof(V==null?void 0:V[pe])=="object"?{[pe]:(Ne=V[pe])==null?void 0:Ne.initial}:{};return{...T,...le,...ot,...ze}},Ie=(pe=[],ze)=>{let Ne=[];for(let{class:ot,className:At,...Qe}of pe){let pt=!0;for(let[_t,Lt]of Object.entries(Qe)){let Ht=Ce(_t,ze)[_t];if(Array.isArray(Lt)){if(!Lt.includes(Ht)){pt=!1;break}}else{let ar=Tt=>Tt==null||Tt===!1;if(ar(Lt)&&ar(Ht))continue;if(Ht!==Lt){pt=!1;break}}}pt&&(ot&&Ne.push(ot),At&&Ne.push(At))}return Ne},Ue=pe=>{let ze=Ie(D,pe);if(!Array.isArray(ze))return ze;let Ne={};for(let ot of ze)if(typeof ot=="string"&&(Ne.base=Nf(Ne.base,ot)(p)),typeof ot=="object")for(let[At,Qe]of Object.entries(ot))Ne[At]=Nf(Ne[At],Qe)(p);return Ne},De=pe=>{if(u.length<1)return null;let ze={};for(let{slots:Ne=[],class:ot,className:At,...Qe}of u){if(!Zs(Qe)){let pt=!0;for(let _t of Object.keys(Qe)){let Lt=Ce(_t,pe)[_t];if(Lt===void 0||(Array.isArray(Qe[_t])?!Qe[_t].includes(Lt):Qe[_t]!==Lt)){pt=!1;break}}if(!pt)continue}for(let pt of Ne)ze[pt]=ze[pt]||[],ze[pt].push([ot,At])}return ze};if(!Zs(n)||!E){let pe={};if(typeof F=="object"&&!Zs(F))for(let ze of Object.keys(F))pe[ze]=Ne=>{var ot,At;return Nf(F[ze],oe(ze,Ne),((ot=Ue(Ne))!=null?ot:[])[ze],((At=De(Ne))!=null?At:[])[ze],Ne==null?void 0:Ne.class,Ne==null?void 0:Ne.className)(p)};return pe}return Nf(y,J(),Ie(D),V==null?void 0:V.class,V==null?void 0:V.className)(p)},B=()=>{if(!(!x||typeof x!="object"))return Object.keys(x)};return N.variantKeys=B(),N.extend=t,N.base=y,N.slots=F,N.variants=x,N.defaultVariants=T,N.compoundSlots=u,N.compoundVariants=D,N};const xS=pz({base:"focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",child:""},size:{default:"px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}});var gz=Ve("<a><!></a>"),mz=Ve("<button><!></button>");function Bn(r,e){zt(e,!0);let t=fe(e,"variant",3,"default"),n=fe(e,"size",3,"default"),i=fe(e,"ref",15,null),l=fe(e,"href",3,void 0),u=fe(e,"type",3,"button"),a=an(e,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);var p=it(),y=xe(p);{var x=E=>{var k=gz();let F;var D=Be(k);fr(D,()=>e.children??Cr),ke(k),Cs(k,N=>i(N),()=>i()),ct(N=>F=Tn(k,F,{class:N,href:l(),...a}),[()=>kn(xS({variant:t(),size:n()}),e.class)]),K(E,k)},T=E=>{var k=mz();let F;var D=Be(k);fr(D,()=>e.children??Cr),ke(k),Cs(k,N=>i(N),()=>i()),ct(N=>F=Tn(k,F,{class:N,type:u(),...a}),[()=>kn(xS({variant:t(),size:n()}),e.class)]),K(E,k)};et(y,E=>{l()?E(x):E(T,!1)})}K(r,p),Ut()}function xp(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class"]);var i=it(),l=xe(i);const u=Re(()=>kn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e.class));Tr(l,()=>gC,(a,p)=>{p(a,cn({get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(y){t(y)}}))}),K(r,i),Ut()}function _z(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"map-pin-house"},()=>t,{iconNode:[["path",{d:"M15 22a1 1 0 0 1-1-1v-4a1 1 0 0 1 .445-.832l3-2a1 1 0 0 1 1.11 0l3 2A1 1 0 0 1 22 17v4a1 1 0 0 1-1 1z"}],["path",{d:"M18 10a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 .601.2"}],["path",{d:"M18 22v-3"}],["circle",{cx:"10",cy:"10",r:"3"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function yz(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"map-pin"},()=>t,{iconNode:[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}],["circle",{cx:"12",cy:"10",r:"3"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}const vz=/^([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)$/,bz=/^([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)$/,OC=r=>{if(!r)return;const e=r.match(vz);if(e)return Oi([Number(e[3]),Number(e[1])],Number(e[5]));const t=r.match(bz);if(t)return Oi([Number(t[3]),Number(t[1])])};function Oi(r,e){const{lat:t,lng:n}=wi.LngLat.convert(r),i=e==null?`${t},${n}`:`${t},${n},${e}`;return{label:i,match:{lat:t,lon:n,level:e,id:"",areas:[],type:"PLACE",name:i,tokens:[],score:0}}}const Nx=(r,e)=>{if(!r||r.trim()==="")return{label:"",match:void 0};const t=OC(r);return t?(e&&(t.label=e,t.match.name=e),t):{label:e||"",match:{lat:0,lon:0,level:0,id:r,areas:[],type:"STOP",name:e||"",tokens:[],score:0}}},cc=r=>{var e;switch(r.mode){case"WALK":return["walk","hsl(var(--foreground) / 1)","hsl(var(--background) / 1)"];case"BIKE":return["bike","hsl(var(--foreground) / 1)","hsl(var(--background) / 1)"];case"RENTAL":switch((e=r.rental)==null?void 0:e.formFactor){case"BICYCLE":return["bike","#075985","white"];case"CARGO_BICYCLE":return["cargo_bike","#075985","white"];case"CAR":return["car","#4c4947","white"];case"MOPED":return["moped","#075985","white"];case"SCOOTER_SEATED":case"SCOOTER_STANDING":return["scooter","#075985","white"];case"OTHER":default:return["bike","#075985","white"]}case"CAR":case"CAR_PARKING":return["car","#4c4947","white"];case"FLEX":case"ODM":return["taxi","#fdb813","white"];case"TRANSIT":case"BUS":return["bus","#ff9800","white"];case"COACH":return["bus","#9ccc65","black"];case"TRAM":return["tram","#ebe717","white"];case"SUBURBAN":return["sbahn","#4caf50","white"];case"SUBWAY":return["ubahn","#3f51b5","white"];case"FERRY":return["ship","#00acc1","white"];case"AIRPLANE":return["plane","#90a4ae","white"];case"HIGHSPEED_RAIL":return["train","#9c27b0","white"];case"LONG_DISTANCE":return["train","#e91e63","white"];case"NIGHT_RAIL":return["train","#1a237e","white"];case"REGIONAL_FAST_RAIL":case"REGIONAL_RAIL":case"RAIL":return["train","#f44336","white"];case"FUNICULAR":return["funicular","#795548","white"];case"CABLE_CAR":return["tram","#795548","white"];case"AERIAL_LIFT":return["aerial_lift","#795548","white"]}return["train","#000000","white"]},nc=r=>{const[e,t,n]=cc(r);return!r.routeColor||r.routeColor==="000000"?[t,n]:["#"+r.routeColor,"#"+r.routeTextColor||"000000"]},wS=r=>`border-color: ${nc(r)[0]}`,tb=r=>{const[e,t]=nc(r);return`background-color: ${e}; color: ${t}; fill: ${t}`},TS=(r,e=Cr)=>{var t=xz();const n=Re(()=>cc({mode:e()})[0]),i=Re(()=>cc({mode:e()})[1]);var l=Be(t),u=Be(l);ke(l),ke(t),ct(()=>{rc(t,`background-color: ${A(i)??""}; fill: white;`),Xv(u,"xlink:href",`#${A(n)}`)}),K(r,t)};var xz=Ve('<div class="rounded-full flex items-center justify-center p-1"><svg class="relative size-4 rounded-full"><use></use></svg></div>'),wz=Ve('<img class="size-5"/>'),Tz=Ve('<div class="mt-1 ml-4 flex flex-row gap-1.5 items-center"></div>'),Sz=Ve('<div class="flex items-center grow"><!> <div class="flex flex-col ml-4"><span class="font-semibold text-nowrap text-ellipsis overflow-hidden"> </span> <span class="text-muted-foreground text-nowrap text-ellipsis overflow-hidden"> </span></div></div> <!>',1),Az=Ve("<!> <!>",1);function Dy(r,e){zt(e,!0);let t=fe(e,"items",31,()=>yn([])),n=fe(e,"selected",15),i=fe(e,"onlyStations",11,!1),l=Pt(""),u=Pt("");const a=D=>{var N;if(D){const B=D.areas.find(oe=>oe.matched),V=D.areas.find(oe=>oe.default);B!=null&&B.name.match(/^[0-9]*$/)&&(B.name+=" "+(V==null?void 0:V.name));let U=(N=B??V)==null?void 0:N.name;U==D.name&&(U=D.areas[0].name);const j=new Set;D.areas.forEach((oe,le)=>{(oe.matched||oe.unique||oe.default)&&j.add(le)});const J=Array.from(j);return J.sort((oe,le)=>le-oe),J.map(oe=>D.areas[oe].name).join(", ")}return""},p=D=>{const N=a(D);return N?D.name+", "+N:D.name},y=async()=>{const D=OC(A(l));if(D){n(D),t([]);return}const N=e.place?wi.LngLat.convert(e.place):void 0,B=N?{place:`${N.lat},${N.lng}`}:{},{data:V,error:U}=await PM({query:{...B,text:A(l),language:[fa],type:i()?"STOP":void 0}});if(U){console.error("TYPEAHEAD ERROR: ",U);return}t(V.map(J=>({label:p(J),match:J})));const j=new Set;t(t().filter(J=>{var le;const oe=((le=J.match)==null?void 0:le.type)+J.label;return j.has(oe)?!1:(j.add(oe),!0)}))},x=D=>{const N=JSON.parse(D);return{match:N,label:p(N)}};Xr(()=>{n()&&(ve(u,JSON.stringify(n().match),!0),ve(l,n().label,!0))});let T=Pt(null);Xr(()=>{A(T)&&A(l)&&(A(T).value=A(l))});let E;Xr(()=>{A(l)&&(clearTimeout(E),E=setTimeout(()=>{y()},150))});var k=it(),F=xe(k);Tr(F,()=>VF,(D,N)=>{N(D,{type:"single",allowDeselect:!1,get value(){return A(u)},onValueChange:B=>{if(B&&(n(x(B)),ve(l,n().label,!0),i()&&n().match)){const V=n().match;fd(V.name,V.id,new Date,void 0,!0)}},children:(B,V)=>{var U=Az(),j=xe(U);Tr(j,()=>$F,(le,Ce)=>{Ce(le,{get placeholder(){return e.placeholder},get name(){return e.name},class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",autocomplete:"off",oninput:Ie=>ve(l,Ie.currentTarget.value,!0),get"aria-label"(){return e.placeholder},get"data-combobox-input"(){return A(l)},get ref(){return A(T)},set ref(Ie){ve(T,Ie,!0)}})});var J=we(j,2);{var oe=le=>{var Ce=it(),Ie=xe(Ce);Tr(Ie,()=>DI,(Ue,De)=>{De(Ue,{children:(pe,ze)=>{var Ne=it(),ot=xe(Ne);Tr(ot,()=>fC,(At,Qe)=>{Qe(At,{align:"start",class:"absolute top-2 w-[var(--bits-combobox-anchor-width)] z-10 overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md outline-none",children:(pt,_t)=>{var Lt=it(),Ht=xe(Lt);jn(Ht,17,t,ar=>ar.match,(ar,Tt)=>{var Sr=it(),Et=xe(Sr);const Or=Re(()=>JSON.stringify(A(Tt).match));Tr(Et,()=>pC,(ir,vr)=>{vr(ir,{class:"flex w-full cursor-default select-none rounded-sm py-4 pl-4 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:opacity-50",get value(){return A(Or)},get label(){return A(Tt).label},children:(ur,kr)=>{var nn=Sz(),pr=xe(nn),Hr=Be(pr);{var Nr=Jt=>{TS(Jt,()=>{var Zt;return(Zt=A(Tt).match.modes)!=null&&Zt.length?A(Tt).match.modes[0]:"BUS"})},mt=(Jt,Zt)=>{{var Ar=Jr=>{_z(Jr,{class:"size-5"})},Fr=(Jr,bt)=>{{var zr=Mr=>{var Zr=it(),xn=xe(Zr);{var Ot=$e=>{yz($e,{class:"size-5"})},qe=$e=>{var dt=wz();ct(()=>{var xt,at;ls(dt,"src",`icons/${(xt=A(Tt).match)==null?void 0:xt.category}.svg`),ls(dt,"alt",(at=A(Tt).match)==null?void 0:at.category)}),K($e,dt)};et(xn,$e=>{var dt,xt;!((dt=A(Tt).match)!=null&&dt.category)||((xt=A(Tt).match)==null?void 0:xt.category)=="none"?$e(Ot):$e(qe,!1)})}K(Mr,Zr)};et(Jr,Mr=>{var Zr;((Zr=A(Tt).match)==null?void 0:Zr.type)=="PLACE"&&Mr(zr)},bt)}};et(Jt,Jr=>{var bt;((bt=A(Tt).match)==null?void 0:bt.type)=="ADDRESS"?Jr(Ar):Jr(Fr,!1)},Zt)}};et(Hr,Jt=>{var Zt;((Zt=A(Tt).match)==null?void 0:Zt.type)=="STOP"?Jt(Nr):Jt(mt,!1)})}var Te=we(Hr,2),Qt=Be(Te),Ct=Be(Qt,!0);ke(Qt);var yt=we(Qt,2),sr=Be(yt,!0);ke(yt),ke(Te),ke(pr);var Br=we(pr,2);{var $r=Jt=>{var Zt=Tz();jn(Zt,21,()=>A(Tt).match.modes,Hi,(Ar,Fr)=>{TS(Ar,()=>A(Fr))}),ke(Zt),K(Jt,Zt)};et(Br,Jt=>{var Zt;((Zt=A(Tt).match)==null?void 0:Zt.type)=="STOP"&&Jt($r)})}ct(Jt=>{var Zt;vt(Ct,(Zt=A(Tt).match)==null?void 0:Zt.name),vt(sr,Jt)},[()=>a(A(Tt).match)]),K(ur,nn)},$$slots:{default:!0}})}),K(ar,Sr)}),K(pt,Lt)},$$slots:{default:!0}})}),K(pe,Ne)},$$slots:{default:!0}})}),K(le,Ce)};et(J,le=>{t().length!==0&&le(oe)})}K(B,U)},$$slots:{default:!0}})}),K(r,k),Ut()}function Ez(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"check"},()=>t,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var Iz=Ve('<span class="absolute right-2 flex size-3.5 items-center justify-center"><!></span> <!>',1);function Jh(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","value","label","children"]);var i=it(),l=xe(i);const u=Re(()=>kn("data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e.class));Tr(l,()=>pC,(a,p)=>{p(a,cn({get value(){return e.value},get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(x){t(x)},children:(x,T)=>{let E=()=>T==null?void 0:T().selected,k=()=>T==null?void 0:T().highlighted;var F=Iz(),D=xe(F),N=Be(D);{var B=J=>{Ez(J,{class:"size-4"})};et(N,J=>{E()&&J(B)})}ke(D);var V=we(D,2);{var U=J=>{var oe=it(),le=xe(oe);fr(le,()=>e.children,()=>({selected:E(),highlighted:k()})),K(J,oe)},j=J=>{var oe=jr();ct(()=>vt(oe,e.label||e.value)),K(J,oe)};et(V,J=>{e.children?J(U):J(j,!1)})}K(x,F)},$$slots:{default:!0}}))}),K(r,i),Ut()}var Cz=Ve("<!> <!> <!>",1);function Qh(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"sideOffset",3,4),i=an(e,["$$slots","$$events","$$legacy","ref","class","sideOffset","portalProps","children"]);var l=it(),u=xe(l);Tr(u,()=>DI,(a,p)=>{p(a,cn(()=>e.portalProps,{children:(y,x)=>{var T=it(),E=xe(T);const k=Re(()=>kn("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border shadow-md data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e.class));Tr(E,()=>fC,(F,D)=>{D(F,cn({get sideOffset(){return n()},get class(){return A(k)}},()=>i,{get ref(){return t()},set ref(N){t(N)},children:(N,B)=>{var V=Cz(),U=xe(V);Tr(U,()=>kz,(le,Ce)=>{Ce(le,{})});var j=we(U,2);const J=Re(()=>kn("h-[var(--bits-select-anchor-height)] w-full min-w-[var(--bits-select-anchor-width)] p-1"));Tr(j,()=>oB,(le,Ce)=>{Ce(le,{get class(){return A(J)},children:(Ie,Ue)=>{var De=it(),pe=xe(De);fr(pe,()=>e.children??Cr),K(Ie,De)},$$slots:{default:!0}})});var oe=we(j,2);Tr(oe,()=>Rz,(le,Ce)=>{Ce(le,{})}),K(N,V)},$$slots:{default:!0}}))}),K(y,T)},$$slots:{default:!0}}))}),K(r,l),Ut()}function Bm(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"chevron-down"},()=>t,{iconNode:[["path",{d:"m6 9 6 6 6-6"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var Pz=Ve("<!> <!>",1);function ed(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=it(),l=xe(i);const u=Re(()=>kn("border-input ring-offset-background data-[placeholder]:text-muted-foreground focus:ring-ring flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border bg-transparent px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e.class));Tr(l,()=>OB,(a,p)=>{p(a,cn({get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(y){t(y)},children:(y,x)=>{var T=Pz(),E=xe(T);fr(E,()=>e.children??Cr);var k=we(E,2);Bm(k,{class:"size-4 opacity-50"}),K(y,T)},$$slots:{default:!0}}))}),K(r,i),Ut()}function K_(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"orientation",3,"horizontal"),i=an(e,["$$slots","$$events","$$legacy","ref","class","orientation"]);var l=it(),u=xe(l);const a=Re(()=>kn("bg-border shrink-0",n()==="horizontal"?"h-[1px] w-full":"min-h-full w-[1px]",e.class));Tr(u,()=>KF,(p,y)=>{y(p,cn({get class(){return A(a)},get orientation(){return n()}},()=>i,{get ref(){return t()},set ref(x){t(x)}}))}),K(r,l),Ut()}function Rz(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class"]);var i=it(),l=xe(i);const u=Re(()=>kn("flex cursor-default items-center justify-center py-1",e.class));Tr(l,()=>cB,(a,p)=>{p(a,cn({get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(y){t(y)},children:(y,x)=>{Bm(y,{class:"size-4"})},$$slots:{default:!0}}))}),K(r,i),Ut()}function DC(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"chevron-up"},()=>t,{iconNode:[["path",{d:"m18 15-6-6-6 6"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function kz(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class"]);var i=it(),l=xe(i);const u=Re(()=>kn("flex cursor-default items-center justify-center py-1",e.class));Tr(l,()=>dB,(a,p)=>{p(a,cn({get class(){return A(u)}},()=>n,{get ref(){return t()},set ref(y){t(y)},children:(y,x)=>{DC(y,{class:"size-4"})},$$slots:{default:!0}}))}),K(r,i),Ut()}const td=kB;var Mz=Ve('<div class="flex items-center space-x-3 my-2"><!> <!></div>');function qf(r,e){zt(e,!0);let t=fe(e,"checked",15,!1);var n=Mz(),i=Be(n);const l=Re(()=>kn("peer inline-flex h-[21px] min-h-[21px] w-[45px] shrink-0 cursor-pointer items-center rounded-full px-[3px] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-foreground data-[state=unchecked]:bg-border data-[state=unchecked]:shadow-mini-inset dark:data-[state=checked]:bg-foreground",e.class));Tr(i,()=>lL,(a,p)=>{p(a,{get id(){return e.id},get class(){return A(l)},get onCheckedChange(){return e.onCheckedChange},get checked(){return t()},set checked(y){t(y)},children:(y,x)=>{var T=it(),E=xe(T);Tr(E,()=>uL,(k,F)=>{F(k,{class:"pointer-events-none block size-[15px] shrink-0 rounded-full bg-background transition-transform data-[state=checked]:translate-x-6 data-[state=unchecked]:translate-x-0 data-[state=unchecked]:shadow-mini dark:border dark:border-background/30 dark:bg-foreground dark:shadow-popover dark:data-[state=unchecked]:border"})}),K(y,T)},$$slots:{default:!0}})});var u=we(i,2);Tr(u,()=>gC,(a,p)=>{p(a,{get for(){return e.id},class:"text-sm font-medium",children:(y,x)=>{sn();var T=jr();ct(()=>vt(T,e.label)),K(y,T)},$$slots:{default:!0}})}),ke(n),K(r,n),Ut()}const xi={time:void 0,fromPlace:void 0,toPlace:void 0,arriveBy:!1,timetableView:!0,withFares:!1,searchWindow:7200,pedestrianProfile:"FOOT",transitModes:["TRANSIT"],preTransitModes:["WALK"],postTransitModes:["WALK"],directModes:["WALK"],preTransitRentalFormFactors:[],postTransitRentalFormFactors:[],directRentalFormFactors:[],preTransitRentalPropulsionTypes:[],postTransitRentalPropulsionTypes:[],directRentalPropulsionTypes:[],ignorePreTransitRentalReturnConstraints:!1,ignorePostTransitRentalReturnConstraints:!1,ignoreDirectRentalReturnConstraints:!1,requireBikeTransport:!1,requireCarTransport:!1,elevationCosts:"NONE",useRoutedTransfers:!1,joinInterlinedLegs:!0,maxMatchingDistance:25,maxTransfers:14,maxTravelTime:45*60,maxPreTransitTime:900,maxPostTransitTime:900,maxDirectTime:1800,fastestDirectFactor:1,additionalTransferTime:0,transferTimeFactor:1,numItineraries:5,circleResolution:void 0,maxItineraries:void 0,passengers:1,luggage:0,slowDirect:!1,isochronesDisplayLevel:"GEOMETRY_CIRCLES",isochronesColor:"#ffff00",isochronesOpacity:250,algorithm:"RAPTOR"},Oz=r=>{const e={...r};return Object.keys(e).forEach(t=>{if(t in xi){const n=e[t],i=xi[t];JSON.stringify(n)===JSON.stringify(i)&&delete e[t]}else console.warn(`Unknown query parameter: ${t}`)}),e},Ho=r=>{let e=Math.floor(r/3600),t=Math.ceil((r-e*3600)/60);return t===60&&(e+=1,t=0),[e!==0?e+" h":"",t!==0||e===0?t+" min":""].join(" ").trim()},Dz=r=>{if(!r)return"";const e=Math.floor(r/1e3),t=e>5?0:Math.ceil(r-e*1e3);return[e!==0?e+" km":"",t!==0?t+" m":""].join(" ").trim()},my=["WALK","BIKE","CAR","FLEX","CAR_DROPOFF","CAR_PARKING","RENTAL_BICYCLE","RENTAL_CARGO_BICYCLE","RENTAL_CAR","RENTAL_MOPED","RENTAL_SCOOTER_STANDING","RENTAL_SCOOTER_SEATED","RENTAL_OTHER"],Fx=(r,e)=>r.filter(t=>my.includes(t)).map(t=>t).concat(e.map(t=>`RENTAL_${t}`)),Bx=r=>r.filter(e=>e.startsWith("RENTAL_")).map(e=>e.replace("RENTAL_","")),Ff=r=>{const e=r.some(n=>n.startsWith("RENTAL_"))?["RENTAL"]:[];return[...r.filter(n=>!n.startsWith("RENTAL_")),...e].map(n=>n)},Ny=["AIRPLANE","HIGHSPEED_RAIL","LONG_DISTANCE","NIGHT_RAIL","COACH","REGIONAL_FAST_RAIL","REGIONAL_RAIL","SUBURBAN","SUBWAY","TRAM","BUS","FERRY","CABLE_CAR","FUNICULAR","AERIAL_LIFT","OTHER"];var Nz=Ve('<div class="w-full text-right pr-4"> </div>'),Fz=Ve('<div class="w-full text-right pr-2"> </div>'),Bz=Ve("<!> <!>",1);function SS(r,e){zt(e,!0);let t=fe(e,"value",15),n=fe(e,"labelFormatter",3,p=>p.toString());var i=it(),l=xe(i),u=()=>t().toString(),a=p=>t(parseInt(p));Tr(l,()=>td,(p,y)=>{y(p,{type:"single",get value(){return u()},set value(x){a(x)},get items(){return e.possibleValues},children:(x,T)=>{var E=Bz(),k=xe(E);Tr(k,()=>ed,(D,N)=>{N(D,{class:"flex items-center w-full overflow-hidden","aria-label":"max travel time",children:(B,V)=>{var U=Nz(),j=Be(U,!0);ke(U),ct(J=>vt(j,J),[()=>n()(t())]),K(B,U)},$$slots:{default:!0}})});var F=we(k,2);Tr(F,()=>Qh,(D,N)=>{N(D,{align:"end",children:(B,V)=>{var U=it(),j=xe(U);jn(j,19,()=>e.possibleValues,(J,oe)=>oe+J.value,(J,oe)=>{var le=it(),Ce=xe(le);Tr(Ce,()=>Jh,(Ie,Ue)=>{Ue(Ie,{get value(){return A(oe).value},get label(){return A(oe).label},children:(De,pe)=>{var ze=Fz(),Ne=Be(ze,!0);ke(ze),ct(()=>vt(Ne,A(oe).label)),K(De,ze)},$$slots:{default:!0}})}),K(J,le)}),K(B,U)},$$slots:{default:!0}})}),K(x,E)},$$slots:{default:!0}})}),K(r,i),Ut()}var Lz=Ve("<span> </span>"),zz=Ve("<!> <!>",1),Uz=Ve("<!> <!>",1),Vz=Ve('<div class="grid grid-cols-[1fr_2fr_1fr] items-center gap-2"><div class="text-sm"> </div> <!> <!> <div><!></div></div>');function Lx(r,e){zt(e,!0);let t=fe(e,"modes",15),n=fe(e,"maxTransitTime",15),i=fe(e,"ignoreRentalReturnConstraints",15);const l=e.possibleModes.map(j=>({value:j,label:Rt[j]})),u=j=>j.some(J=>J.startsWith("RENTAL_")),a=Re(()=>u(t())),p=Re(()=>l.filter(j=>{var J;return(J=t())==null?void 0:J.includes(j.value)}).map(j=>j.label).join(", "));var y=Vz(),x=Be(y),T=Be(x,!0);ke(x);var E=we(x,2);Tr(E,()=>td,(j,J)=>{J(j,{type:"multiple",get value(){return t()},set value(oe){t(oe)},children:(oe,le)=>{var Ce=zz(),Ie=xe(Ce);Tr(Ie,()=>ed,(De,pe)=>{pe(De,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return e.label},children:(ze,Ne)=>{var ot=Lz(),At=Be(ot,!0);ke(ot),ct(()=>vt(At,A(p))),K(ze,ot)},$$slots:{default:!0}})});var Ue=we(Ie,2);Tr(Ue,()=>Qh,(De,pe)=>{pe(De,{sideOffset:10,children:(ze,Ne)=>{var ot=it(),At=xe(ot);jn(At,19,()=>e.possibleModes,(Qe,pt)=>pt+Qe,(Qe,pt)=>{var _t=it(),Lt=xe(_t);Tr(Lt,()=>Jh,(Ht,ar)=>{ar(Ht,{get value(){return A(pt)},get label(){return Rt[A(pt)]},children:(Tt,Sr)=>{sn();var Et=jr();ct(()=>vt(Et,Rt[A(pt)])),K(Tt,Et)},$$slots:{default:!0}})}),K(Qe,_t)}),K(ze,ot)},$$slots:{default:!0}})}),K(oe,Ce)},$$slots:{default:!0}})});var k=we(E,2),F=()=>n().toString(),D=j=>n(parseInt(j));Tr(k,()=>td,(j,J)=>{J(j,{type:"single",get value(){return F()},set value(oe){D(oe)},children:(oe,le)=>{var Ce=Uz(),Ie=xe(Ce);Tr(Ie,()=>ed,(De,pe)=>{pe(De,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return Rt.routingSegments.maxPreTransitTime},children:(ze,Ne)=>{sn();var ot=jr();ct(At=>vt(ot,At),[()=>Ho(n())]),K(ze,ot)},$$slots:{default:!0}})});var Ue=we(Ie,2);Tr(Ue,()=>Qh,(De,pe)=>{pe(De,{sideOffset:10,children:(ze,Ne)=>{var ot=it(),At=xe(ot);jn(At,16,()=>e.possibleMaxTransitTime,Qe=>Qe,(Qe,pt)=>{var _t=it(),Lt=xe(_t);const Ht=Re(()=>`${pt}`),ar=Re(()=>Ho(pt));Tr(Lt,()=>Jh,(Tt,Sr)=>{Sr(Tt,{get value(){return A(Ht)},get label(){return A(ar)},children:(Et,Or)=>{sn();var ir=jr();ct(vr=>vt(ir,vr),[()=>Ho(pt)]),K(Et,ir)},$$slots:{default:!0}})}),K(Qe,_t)}),K(ze,ot)},$$slots:{default:!0}})}),K(oe,Ce)},$$slots:{default:!0}})});var N=we(k,2),B=Be(N),V=()=>!i(),U=j=>i(!j);qf(B,{get checked(){return V()},set checked(j){U(j)},get label(){return Rt.considerRentalReturnConstraints},id:"ignorePreTransitRentalReturnConstraints"}),ke(N),ke(y),ct(j=>{vt(T,e.label),Di(N,1,j)},[()=>rl(kn("col-span-2 col-start-2",A(a)||"hidden"))]),K(r,y),Ut()}function jz(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"bus-front"},()=>t,{iconNode:[["path",{d:"M4 6 2 7"}],["path",{d:"M10 6h4"}],["path",{d:"m22 7-2-1"}],["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2"}],["path",{d:"M4 11h16"}],["path",{d:"M8 15h.01"}],["path",{d:"M16 15h.01"}],["path",{d:"M6 19v2"}],["path",{d:"M18 21v-2"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var Hz=Ve("<!> ",1),Wz=Ve("<!> <!>",1);function $z(r,e){zt(e,!0);let t=fe(e,"transitModes",15);const n=Ny.map(a=>({value:a,label:Rt[a]})),i=Re(()=>t().length==Ny.length||t().includes("TRANSIT")?Rt.defaultSelectedModes:n.filter(a=>{var p;return(p=t())==null?void 0:p.includes(a.value)}).map(a=>a.label).join(", "));var l=it(),u=xe(l);Tr(u,()=>td,(a,p)=>{p(a,{type:"multiple",get value(){return t()},set value(y){t(y)},children:(y,x)=>{var T=Wz(),E=xe(T);Tr(E,()=>ed,(F,D)=>{D(F,{class:"flex items-center w-full overflow-hidden",get"aria-label"(){return Rt.selectTransitModes},children:(N,B)=>{var V=Hz(),U=xe(V);jz(U,{class:"mr-[9px] size-6 text-muted-foreground shrink-0"});var j=we(U);ct(()=>vt(j,` ${A(i)??""}`)),K(N,V)},$$slots:{default:!0}})});var k=we(E,2);Tr(k,()=>Qh,(F,D)=>{D(F,{sideOffset:10,children:(N,B)=>{var V=it(),U=xe(V);jn(U,19,()=>n,(j,J)=>J+j.value,(j,J)=>{var oe=it(),le=xe(oe);Tr(le,()=>Jh,(Ce,Ie)=>{Ie(Ce,{get value(){return A(J).value},get label(){return A(J).label},children:(Ue,De)=>{sn();var pe=jr();ct(()=>vt(pe,A(J).label)),K(Ue,pe)},$$slots:{default:!0}})}),K(j,oe)}),K(N,V)},$$slots:{default:!0}})}),K(y,T)},$$slots:{default:!0}})}),K(r,l),Ut()}var qz=Ve(" <!>",1),Xz=Ve('<div class="text-sm"> </div> <!>',1),Zz=Ve("<!> <!>",1),Yz=Ve('<div class="w-full space-y-4"><!> <div class="space-y-2"><!> <!> <!> <!> <div><div class="text-sm"> </div> <!> <!></div> <!> <!> <!></div> <div class="grid grid-cols-2 items-center"><div class="text-sm"> </div> <!></div> <!></div>'),Kz=Ve("<!> <!>",1);function NC(r,e){zt(e,!0);let t=fe(e,"useRoutedTransfers",15),n=fe(e,"wheelchair",15),i=fe(e,"requireBikeTransport",15),l=fe(e,"requireCarTransport",15),u=fe(e,"transitModes",15),a=fe(e,"maxTransfers",15),p=fe(e,"maxTravelTime",15,void 0),y=fe(e,"possibleMaxTravelTimes",19,()=>[]),x=fe(e,"preTransitModes",15),T=fe(e,"postTransitModes",15),E=fe(e,"directModes",15,void 0),k=fe(e,"maxPreTransitTime",15),F=fe(e,"maxPostTransitTime",15),D=fe(e,"maxDirectTime",15,void 0),N=fe(e,"elevationCosts",15);const B=[...Array(xi.maxTransfers+1).keys()].map(pe=>({value:pe.toString(),label:pe.toString()})),V=[5*60,10*60,15*60,20*60,25*60,30*60,35*60,40*60,45*60,50*60,60*60,90*60,120*60,180*60,240*60,300*60,360*60],U=[1*60,5*60,10*60,15*60,20*60,25*60,30*60,40*60,50*60,60*60];function j(pe){return function(ze){ze&&(x([pe]),T([pe]),E([pe]))}}u().includes("TRANSIT")&&u([...Ny]),i()&&j("BIKE")(!0),l()&&j("CAR")(!0);const J=[{value:"NONE",label:Rt.elevationCosts.NONE},{value:"LOW",label:Rt.elevationCosts.LOW},{value:"HIGH",label:Rt.elevationCosts.HIGH}];let oe=Pt(!1),le=Re(()=>{var pe;return i()||x().includes("BIKE")||T().includes("BIKE")||((pe=E())==null?void 0:pe.includes("BIKE"))});var Ce=Kz(),Ie=xe(Ce);Bn(Ie,{variant:"ghost",onclick:()=>ve(oe,!A(oe)),children:(pe,ze)=>{sn();var Ne=qz(),ot=xe(Ne),At=we(ot);{var Qe=_t=>{DC(_t,{class:"size-[18px]"})},pt=_t=>{Bm(_t,{class:"size-[18px]"})};et(At,_t=>{A(oe)?_t(Qe):_t(pt,!1)})}ct(()=>vt(ot,`${Rt.advancedSearchOptions??""} `)),K(pe,Ne)},$$slots:{default:!0}});var Ue=we(Ie,2);{var De=pe=>{var ze=Yz(),Ne=Be(ze);$z(Ne,{get transitModes(){return u()},set transitModes(Ct){u(Ct)}});var ot=we(Ne,2),At=Be(ot);qf(At,{get label(){return Rt.useRoutedTransfers},id:"useRoutedTransfers",onCheckedChange:Ct=>{n()&&!Ct&&n(!1)},get checked(){return t()},set checked(Ct){t(Ct)}});var Qe=we(At,2);qf(Qe,{get label(){return Rt.wheelchair},id:"wheelchair",onCheckedChange:Ct=>{Ct&&!t()&&t(!0)},get checked(){return n()},set checked(Ct){n(Ct)}});var pt=we(Qe,2);const _t=Re(()=>j("BIKE"));qf(pt,{get label(){return Rt.requireBikeTransport},get onCheckedChange(){return A(_t)},id:"requireBikeTransport",get checked(){return i()},set checked(Ct){i(Ct)}});var Lt=we(pt,2);qf(Lt,{get label(){return Rt.requireCarTransport},id:"requireCarTransport",onCheckedChange:Ct=>{Ct&&!t()&&t(!0),j("CAR")(Ct)},get checked(){return l()},set checked(Ct){l(Ct)}});var Ht=we(Lt,2),ar=Be(Ht),Tt=Be(ar,!0);ke(ar);var Sr=we(ar,2);SS(Sr,{possibleValues:B,get value(){return a()},set value(Ct){a(Ct)}});var Et=we(Sr,2);{var Or=Ct=>{var yt=Xz(),sr=xe(yt),Br=Be(sr,!0);ke(sr);var $r=we(sr,2);SS($r,{get possibleValues(){return y()},labelFormatter:Ho,get value(){return p()},set value(Jt){p(Jt)}}),ct(()=>vt(Br,Rt.routingSegments.maxTravelTime)),K(Ct,yt)};et(Et,Ct=>{p()!==void 0&&Ct(Or)})}ke(Ht);var ir=we(Ht,2);Lx(ir,{get label(){return Rt.routingSegments.firstMile},possibleModes:my,possibleMaxTransitTime:U,get ignoreRentalReturnConstraints(){return e.ignorePreTransitRentalReturnConstraints},get modes(){return x()},set modes(Ct){x(Ct)},get maxTransitTime(){return k()},set maxTransitTime(Ct){k(Ct)}});var vr=we(ir,2);Lx(vr,{get label(){return Rt.routingSegments.lastMile},possibleModes:my,possibleMaxTransitTime:U,get ignoreRentalReturnConstraints(){return e.ignorePostTransitRentalReturnConstraints},get modes(){return T()},set modes(Ct){T(Ct)},get maxTransitTime(){return F()},set maxTransitTime(Ct){F(Ct)}});var ur=we(vr,2);{var kr=Ct=>{Lx(Ct,{get label(){return Rt.routingSegments.direct},possibleModes:my,possibleMaxTransitTime:V,get ignoreRentalReturnConstraints(){return e.ignoreDirectRentalReturnConstraints},get modes(){return E()},set modes(yt){E(yt)},get maxTransitTime(){return D()},set maxTransitTime(yt){D(yt)}})};et(ur,Ct=>{E()!==void 0&&D()!==void 0&&e.ignoreDirectRentalReturnConstraints!==void 0&&Ct(kr)})}ke(ot);var nn=we(ot,2),pr=Be(nn),Hr=Be(pr,!0);ke(pr);var Nr=we(pr,2);const mt=Re(()=>!A(le));Tr(Nr,()=>td,(Ct,yt)=>{yt(Ct,{get disabled(){return A(mt)},type:"single",get value(){return N()},set value(sr){N(sr)},children:(sr,Br)=>{var $r=Zz(),Jt=xe($r);Tr(Jt,()=>ed,(Ar,Fr)=>{Fr(Ar,{get"aria-label"(){return Rt.selectElevationCosts},children:(Jr,bt)=>{sn();var zr=jr();ct(()=>vt(zr,Rt.elevationCosts[N()])),K(Jr,zr)},$$slots:{default:!0}})});var Zt=we(Jt,2);Tr(Zt,()=>Qh,(Ar,Fr)=>{Fr(Ar,{sideOffset:10,children:(Jr,bt)=>{var zr=it(),Mr=xe(zr);jn(Mr,19,()=>J,(Zr,xn)=>xn+Zr.value,(Zr,xn)=>{var Ot=it(),qe=xe(Ot);Tr(qe,()=>Jh,($e,dt)=>{dt($e,{get value(){return A(xn).value},get label(){return A(xn).label},children:(xt,at)=>{sn();var Dt=jr();ct(()=>vt(Dt,A(xn).label)),K(xt,Dt)},$$slots:{default:!0}})}),K(Zr,Ot)}),K(Jr,zr)},$$slots:{default:!0}})}),K(sr,$r)},$$slots:{default:!0}})}),ke(nn);var Te=we(nn,2);{var Qt=Ct=>{var yt=it(),sr=xe(yt);fr(sr,()=>e.additionalComponents),K(Ct,yt)};et(Te,Ct=>{e.additionalComponents&&Ct(Qt)})}ke(ze),ct(()=>{Di(Ht,1,`grid ${p()===void 0?"grid-cols-2":"grid-cols-4"} items-center gap-2`),vt(Tt,Rt.routingSegments.maxTransfers),vt(Hr,Rt.selectElevationCosts)}),K(pe,ze)};et(Ue,pe=>{A(oe)&&pe(De)})}K(r,Ce),Ut()}var Gz=(r,e)=>{const t=r.target.value,n=new Date(`${t}Z`);isNaN(n.getTime())||e(new Date(n.getTime()+n.getTimezoneOffset()*6e4))},Jz=Ve('<input type="datetime-local"/>');function Fy(r,e){zt(e,!0);let t=fe(e,"value",15),n;Xr(()=>{if(n!==void 0){t().setSeconds(0,0);const l=new Date(t().getTime()-t().getTimezoneOffset()*6e4).toISOString().slice(0,-1);n.value=l}});var i=Jz();i.__change=[Gz,t],Cs(i,l=>n=l,()=>n),ct(l=>Di(i,1,l),[()=>rl(kn("flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e.class))]),K(r,i),Ut()}pc(["change"]);var Qz=Ve("<!> <span> </span>",1),e6=Ve("<!> <span> </span>",1),t6=Ve("<!> <!>",1),r6=Ve('<div id="searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!> <!> <!> <!> <div class="flex flex-row gap-2 flex-wrap"><!> <!> <!></div></div>');function n6(r,e){zt(e,!0);let t=fe(e,"from",15),n=fe(e,"to",15),i=fe(e,"time",15),l=fe(e,"arriveBy",15),u=fe(e,"pedestrianProfile",15),a=fe(e,"useRoutedTransfers",15),p=fe(e,"maxTransfers",15),y=fe(e,"requireCarTransport",15),x=fe(e,"requireBikeTransport",15),T=fe(e,"transitModes",15),E=fe(e,"preTransitModes",15),k=fe(e,"postTransitModes",15),F=fe(e,"directModes",15),D=fe(e,"elevationCosts",15),N=fe(e,"maxPreTransitTime",15),B=fe(e,"maxPostTransitTime",15),V=fe(e,"maxDirectTime",15),U=fe(e,"ignorePreTransitRentalReturnConstraints",15),j=fe(e,"ignorePostTransitRentalReturnConstraints",15),J=fe(e,"ignoreDirectRentalReturnConstraints",15),oe=Pt(yn([])),le=Pt(yn([]));const Ce=()=>{navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(Ie,Tt=>console.log(Tt),{enableHighAccuracy:!0})},Ie=Tt=>{t(Oi({lat:Tt.coords.latitude,lon:Tt.coords.longitude},0))};var Ue=r6(),De=Be(Ue);Dy(De,{get place(){return e.geocodingBiasPlace},name:"from",get placeholder(){return Rt.from},get selected(){return t()},set selected(Tt){t(Tt)},get items(){return A(oe)},set items(Tt){ve(oe,Tt,!0)}});var pe=we(De,2);Dy(pe,{get place(){return e.geocodingBiasPlace},name:"to",get placeholder(){return Rt.to},get selected(){return n()},set selected(Tt){n(Tt)},get items(){return A(le)},set items(Tt){ve(le,Tt,!0)}});var ze=we(pe,2);Bn(ze,{variant:"ghost",class:"absolute z-10 right-4 top-0",size:"icon",onclick:()=>Ce(),children:(Tt,Sr)=>{Lw(Tt,{class:"w-5 h-5"})},$$slots:{default:!0}});var Ne=we(ze,2);Bn(Ne,{class:"absolute z-10 right-14 top-6",variant:"outline",size:"icon",onclick:()=>{const Tt=n();n(t()),t(Tt);const Sr=A(le);ve(le,A(oe),!0),ve(oe,Sr,!0)},children:(Tt,Sr)=>{$O(Tt,{class:"w-5 h-5"})},$$slots:{default:!0}});var ot=we(Ne,2),At=Be(ot);Fy(At,{get value(){return i()},set value(Tt){i(Tt)}});var Qe=we(At,2),pt=()=>l()?"arrival":"departure",_t=Tt=>l(Tt==="arrival");Tr(Qe,()=>f1,(Tt,Sr)=>{Sr(Tt,{class:"flex",get value(){return pt()},set value(Et){_t(Et)},children:(Et,Or)=>{var ir=t6(),vr=xe(ir);xp(vr,{for:"departure",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(kr,nn)=>{var pr=Qz(),Hr=xe(pr);Tr(Hr,()=>vp,(Te,Qt)=>{Qt(Te,{value:"departure",id:"departure",class:"sr-only",get"aria-label"(){return Rt.departure}})});var Nr=we(Hr,2),mt=Be(Nr,!0);ke(Nr),ct(()=>vt(mt,Rt.departure)),K(kr,pr)},$$slots:{default:!0}});var ur=we(vr,2);xp(ur,{for:"arrival",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(kr,nn)=>{var pr=e6(),Hr=xe(pr);Tr(Hr,()=>vp,(Te,Qt)=>{Qt(Te,{value:"arrival",id:"arrival",class:"sr-only",get"aria-label"(){return Rt.arrival}})});var Nr=we(Hr,2),mt=Be(Nr,!0);ke(Nr),ct(()=>vt(mt,Rt.arrival)),K(kr,pr)},$$slots:{default:!0}}),K(Et,ir)},$$slots:{default:!0}})});var Lt=we(Qe,2),Ht=()=>u()==="WHEELCHAIR",ar=Tt=>u(Tt?"WHEELCHAIR":"FOOT");NC(Lt,{get wheelchair(){return Ht()},set wheelchair(Tt){ar(Tt)},maxTravelTime:void 0,get useRoutedTransfers(){return a()},set useRoutedTransfers(Tt){a(Tt)},get requireCarTransport(){return y()},set requireCarTransport(Tt){y(Tt)},get maxTransfers(){return p()},set maxTransfers(Tt){p(Tt)},get requireBikeTransport(){return x()},set requireBikeTransport(Tt){x(Tt)},get transitModes(){return T()},set transitModes(Tt){T(Tt)},get preTransitModes(){return E()},set preTransitModes(Tt){E(Tt)},get postTransitModes(){return k()},set postTransitModes(Tt){k(Tt)},get directModes(){return F()},set directModes(Tt){F(Tt)},get maxPreTransitTime(){return N()},set maxPreTransitTime(Tt){N(Tt)},get maxPostTransitTime(){return B()},set maxPostTransitTime(Tt){B(Tt)},get maxDirectTime(){return V()},set maxDirectTime(Tt){V(Tt)},get elevationCosts(){return D()},set elevationCosts(Tt){D(Tt)},get ignorePreTransitRentalReturnConstraints(){return U()},set ignorePreTransitRentalReturnConstraints(Tt){U(Tt)},get ignorePostTransitRentalReturnConstraints(){return j()},set ignorePostTransitRentalReturnConstraints(Tt){j(Tt)},get ignoreDirectRentalReturnConstraints(){return J()},set ignoreDirectRentalReturnConstraints(Tt){J(Tt)}}),ke(ot),ke(Ue),K(r,Ue),Ut()}const FC=r=>{const e=()=>{ti.state.scrollY=r.scrollTop,eI("",ti.state)},t=n=>{requestAnimationFrame(()=>{var i,l;r.scrollTop=((l=(i=n.state)==null?void 0:i["sveltekit:states"])==null?void 0:l.scrollY)??0})};return r.addEventListener("scrollend",e),window.addEventListener("popstate",t),()=>{r.removeEventListener("scrollend",e),window.removeEventListener("popstate",t)}},i6=r=>{ti.state.scrollY==null&&(r.scrollTop=0)};var s6=Ve("<div><!></div>");function oa(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);Dm(()=>{if(!(window.innerWidth<768)&&t().classList.contains("scrollable"))return FC(t())});var i=s6();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("bg-card text-card-foreground rounded-xl border shadow max-w-full",e.class)]),K(r,i),Ut()}var o6=Ve("<div><!></div>");function a6(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=o6();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("p-6",e.class)]),K(r,i),Ut()}var l6=Ve('<div class="m-4 text-destructive"><div class="min-w-0"> </div></div>');function ru(r,e){var t=l6(),n=Be(t),i=Be(n,!0);ke(n),ke(t),ct(()=>vt(i,e.e)),K(r,t)}const rd=(r,e)=>r.toLocaleTimeString(fa,{hour:"numeric",minute:"numeric",timeZone:e,hour12:!1}),c6=(r,e)=>r.toLocaleDateString(fa,{day:"numeric",month:"numeric",year:"numeric",timeZone:e});var u6=Ve('<div> </div> <div class="text-xs font-normal h-4"> </div>',1),h6=Ve('<div class="text-xs font-normal h-4"> </div>'),d6=Ve("<span> </span> <!>",1),f6=Ve("<div><!></div>");function uc(r,e){zt(e,!0);const t=Re(()=>new Date(e.timestamp)),n=Re(()=>new Date(e.scheduledTimestamp)),i=Re(()=>(A(t).getTime()-A(n).getTime())/6e4),l=Re(()=>e.isRealtime&&A(i)>3),u=Re(()=>e.isRealtime&&A(i)<=3),a=Re(()=>e.isRealtime&&A(i)<=-1),p=Re(()=>e.arriveBy?A(l):A(l)||A(a)),y=Re(()=>e.arriveBy?A(u):A(u)&&!A(a)),x=Re(()=>A(n)instanceof Date&&!isNaN(A(n).getTime())),T=Re(()=>A(x)?new Intl.DateTimeFormat(fa,{timeZone:e.timeZone,timeZoneName:"shortOffset"}).formatToParts(A(n)).find(V=>V.type==="timeZoneName").value:void 0),E=Re(()=>()=>A(x)?new Intl.DateTimeFormat(fa,{timeZoneName:"shortOffset"}).formatToParts(A(n)).find(V=>V.type==="timeZoneName").value==A(T):!1);function k(V){return e.variant==="realtime"?"":e.queriedTime===void 0?V.toLocaleDateString(fa,{timeZone:e.timeZone}):new Date(e.queriedTime).toLocaleDateString()===V.toLocaleDateString()?"":`(${V.toLocaleString(fa,{weekday:"short",timeZone:e.timeZone})})`}var F=f6(),D=Be(F);{var N=V=>{var U=u6(),j=xe(U),J=Be(j);ke(j);var oe=we(j,2),le=Be(oe,!0);ke(oe),ct((Ce,Ie,Ue)=>{vt(J,`${Ce??""}
			${Ie??""}`),vt(le,Ue)},[()=>rd(A(n),e.timeZone),()=>k(A(n)),()=>A(E)()?"":A(T)]),K(V,U)},B=(V,U)=>{{var j=J=>{var oe=d6(),le=xe(oe);let Ce;var Ie=Be(le);ke(le);var Ue=we(le,2);{var De=pe=>{var ze=h6(),Ne=Be(ze,!0);ke(ze),ct(()=>vt(Ne,A(E)?"":A(T))),K(pe,ze)};et(Ue,pe=>{e.variant==="realtime-show-always"&&!A(E)&&pe(De)})}ct((pe,ze,Ne)=>{Ce=Di(le,1,"",null,Ce,pe),vt(Ie,`${ze??""}
			${Ne??""}`)},[()=>({"text-destructive":A(p),"text-green-600":A(y)}),()=>rd(A(t),e.timeZone),()=>k(A(t))]),K(J,oe)};et(V,J=>{(e.variant==="realtime-show-always"||e.variant==="realtime"&&e.isRealtime)&&J(j)},U)}};et(D,V=>{e.variant=="schedule"?V(N):V(B,!1)})}ke(F),ct(V=>{Di(F,1,V),ls(F,"title",A(T))},[()=>rl(kn("text-nowrap grid-cols-1 grid-rows-2",e.class))]),K(r,F),Ut()}function wp(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"loader-circle"},()=>t,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var p6=VE('<svg class="relative mr-1 w-4 h-4 rounded-full"><use></use></svg>'),g6=Ve('<div class="flex items-center py-1 px-2 rounded-lg font-bold text-sm h-8 text-nowrap"><!> </div>');function m6(r,e){zt(e,!0);const t=an(e,["$$slots","$$events","$$legacy","d"]),n=[...new Map(e.d.legs.map(l=>[JSON.stringify(cc(l)),cc(l)])).values()],i=e.d.legs.find(l=>l.mode!=="WALK")??e.d.legs[0];Bn(r,cn({variant:"child"},()=>t,{children:(l,u)=>{var a=g6(),p=Be(a);jn(p,17,()=>n,Hi,(x,T)=>{let E=()=>A(T)[0];var k=p6(),F=Be(k);ke(k),ct(()=>Xv(F,"xlink:href",`#${E()}`)),K(x,k)});var y=we(p);ke(a),ct((x,T)=>{rc(a,x),vt(y,` ${T??""}`)},[()=>tb(i),()=>Ho(e.d.duration)]),K(l,a)},$$slots:{default:!0}})),Ut()}const _6=(r,e=Cr)=>{var t=y6(),n=Be(t),i=Be(n);ke(n);var l=we(n,2);{var u=p=>{var y=jr();ct(()=>vt(y,e().displayName)),K(p,y)},a=p=>{var y=jr();ct(x=>vt(y,x),[()=>Ho(e().duration)]),K(p,y)};et(l,p=>{e().displayName?p(u):p(a,!1)})}ke(t),ct((p,y)=>{rc(t,p),Xv(i,"xlink:href",y)},[()=>tb(e()),()=>`#${cc(e())[0]}`]),K(r,t)};var y6=Ve('<div class="flex items-center py-1 px-2 rounded-lg font-bold text-sm h-8 text-nowrap"><svg class="relative mr-1 w-4 h-4 rounded-full"><use></use></svg> <!></div>'),v6=Ve('<div class="my-4 flex flex-wrap gap-x-3 gap-y-3"></div>'),b6=(r,e,t,n)=>{e.routingResponses.splice(0,0,t(Fw({query:{...e.baseQuery.query,pageCursor:A(n).previousPageCursor}})).then(e.updateStartDest))},x6=Ve('<div class="w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white font-bold text-sm border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),w6=(r,e,t)=>{e.selectItinerary(A(t))},T6=Ve('<div class="text-base flex justify-around items-start space-x-1 w-full"><div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <!></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <!></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <div class="text-center text-nowrap"> </div></div> <!> <div class="overflow-hidden basis-1/4 h-full flex flex-col"><div class="text-xs font-bold uppercase text-slate-400"> </div> <div class="text-center text-nowrap"> </div></div></div> <!> <div class="mt-4 flex flex-wrap gap-x-3 gap-y-3"></div>',1),S6=Ve("<button><!></button>"),A6=(r,e,t,n)=>{e.routingResponses.push(t(Fw({query:{...e.baseQuery.query,pageCursor:A(n).nextPageCursor}})).then(e.updateStartDest))},E6=Ve('<div class="w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white text-sm font-bold border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),I6=Ve("<!> <!> <!>",1),C6=Ve('<div class="flex items-center justify-center w-full"><!></div>'),P6=Ve('<div class="flex flex-col space-y-6 px-4 py-8"></div>'),R6=Ve("<!> <!>",1),k6=Ve('<div class="flex items-center justify-center w-full"><!></div>');function M6(r,e){zt(e,!0);const t=u=>u.then(a=>{if(console.log(a.error),a.error)throw new Error(String(a.error.error??a.error));return a});var n=it(),i=xe(n);{var l=u=>{var a=it(),p=xe(a);Xl(p,()=>e.baseResponse,y=>{var x=k6(),T=Be(x);wp(T,{class:"animate-spin w-12 h-12 m-20"}),ke(x),K(y,x)},(y,x)=>{var T=R6(),E=xe(T);{var k=B=>{var V=v6();jn(V,21,()=>A(x).direct,Hi,(U,j)=>{m6(U,{get d(){return A(j)},onclick:()=>{e.selectItinerary(A(j))}})}),ke(V),K(B,V)};et(E,B=>{A(x).direct.length!==0&&B(k)})}var F=we(E,2);{var D=B=>{var V=P6();jn(V,21,()=>e.routingResponses,Hi,(U,j,J,oe)=>{var le=it(),Ce=xe(le);Xl(Ce,()=>A(j),Ie=>{var Ue=C6(),De=Be(Ue);wp(De,{class:"animate-spin w-12 h-12 m-20"}),ke(Ue),K(Ie,Ue)},(Ie,Ue)=>{var De=I6(),pe=xe(De);{var ze=Qe=>{var pt=x6(),_t=we(Be(pt),2);_t.__click=[b6,e,t,Ue];var Lt=Be(_t,!0);ke(_t),sn(2),ke(pt),ct(()=>vt(Lt,Rt.earlier)),K(Qe,pt)};et(pe,Qe=>{J===0&&e.baseQuery&&Qe(ze)})}var Ne=we(pe,2);jn(Ne,17,()=>A(Ue).itineraries,Hi,(Qe,pt)=>{var _t=S6();_t.__click=[w6,e,pt];var Lt=Be(_t);oa(Lt,{class:"p-4",children:(Ht,ar)=>{var Tt=T6(),Sr=xe(Tt),Et=Be(Sr),Or=Be(Et),ir=Be(Or,!0);ke(Or);var vr=we(Or,2);const ur=Re(()=>{var zr;return(zr=e.baseQuery)==null?void 0:zr.query.time});uc(vr,{get isRealtime(){return A(pt).legs[0].realTime},get timestamp(){return A(pt).startTime},get scheduledTimestamp(){return A(pt).legs[0].scheduledStartTime},variant:"realtime-show-always",get queriedTime(){return A(ur)},get timeZone(){return A(pt).legs[0].from.tz}}),ke(Et);var kr=we(Et,2);K_(kr,{orientation:"vertical"});var nn=we(kr,2),pr=Be(nn),Hr=Be(pr,!0);ke(pr);var Nr=we(pr,2);uc(Nr,{get isRealtime(){return A(pt).legs[A(pt).legs.length-1].realTime},get timestamp(){return A(pt).endTime},get scheduledTimestamp(){return A(pt).legs[A(pt).legs.length-1].scheduledEndTime},variant:"realtime-show-always",get queriedTime(){return A(pt).startTime},get timeZone(){return A(pt).legs[A(pt).legs.length-1].to.tz}}),ke(nn);var mt=we(nn,2);K_(mt,{orientation:"vertical"});var Te=we(mt,2),Qt=Be(Te),Ct=Be(Qt,!0);ke(Qt);var yt=we(Qt,2),sr=Be(yt,!0);ke(yt),ke(Te);var Br=we(Te,2);K_(Br,{orientation:"vertical"});var $r=we(Br,2),Jt=Be($r),Zt=Be(Jt,!0);ke(Jt);var Ar=we(Jt,2),Fr=Be(Ar,!0);ke(Ar),ke($r),ke(Sr);var Jr=we(Sr,2);K_(Jr,{class:"my-2"});var bt=we(Jr,2);jn(bt,21,()=>A(pt).legs.filter((zr,Mr)=>Mr==0&&zr.duration>1||Mr==A(pt).legs.length-1&&zr.duration>1||zr.displayName||zr.mode!="WALK"),Hi,(zr,Mr,Zr,xn)=>{_6(zr,()=>A(Mr))}),ke(bt),ct(zr=>{vt(ir,Rt.departure),vt(Hr,Rt.arrival),vt(Ct,Rt.transfers),vt(sr,A(pt).transfers),vt(Zt,Rt.duration),vt(Fr,zr)},[()=>Ho(A(pt).duration)]),K(Ht,Tt)},$$slots:{default:!0}}),ke(_t),K(Qe,_t)});var ot=we(Ne,2);{var At=Qe=>{var pt=E6(),_t=we(Be(pt),2);_t.__click=[A6,e,t,Ue];var Lt=Be(_t,!0);ke(_t),sn(2),ke(pt),ct(()=>vt(Lt,Rt.later)),K(Qe,pt)};et(ot,Qe=>{J===e.routingResponses.length-1&&e.baseQuery&&Qe(At)})}K(Ie,De)},(Ie,Ue)=>{ru(Ie,{get e(){return A(Ue)}})}),K(U,le)}),ke(V),K(B,V)},N=(B,V)=>{{var U=j=>{ru(j,{get e(){return Rt.noItinerariesFound}})};et(B,j=>{A(x).direct.length===0&&j(U)},V)}};et(F,B=>{A(x).itineraries.length!==0?B(D):B(N,!1)})}K(y,T)},(y,x)=>{ru(y,{get e(){return A(x)}})}),K(u,a)};et(i,u=>{e.baseResponse&&u(l)})}K(r,n),Ut()}pc(["click"]);function g1(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"arrow-right"},()=>t,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function O6(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"arrow-up"},()=>t,{iconNode:[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function D6(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"arrow-down"},()=>t,{iconNode:[["path",{d:"M12 5v14"}],["path",{d:"m19 12-7 7-7-7"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function N6(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"dollar-sign"},()=>t,{iconNode:[["line",{x1:"12",x2:"12",y1:"2",y2:"22"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}function rb(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"circle-x"},()=>t,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var F6=(r,e)=>{e.l.tripId?e.onClickTrip(e.l.tripId):console.log("tripId missing",e.l)},B6=Ve('<button><svg class="relative mr-2 min-w-6 min-h-6 max-w-6 max-h-6 rounded-full"><use></use></svg> <div class="text-center"> </div></button>');function W0(r,e){zt(e,!0);const t=Re(()=>cc(e.l)[0]);var n=B6();n.__click=[F6,e];var i=Be(n),l=Be(i);ke(i);var u=we(i,2),a=Be(u,!0);ke(u),ke(n),ct((p,y)=>{Di(n,1,p),rc(n,y),Xv(l,"xlink:href",`#${A(t)}`),vt(a,e.l.displayName)},[()=>rl(kn("flex items-center text-nowrap rounded-full pl-2 pr-1 h-8 font-bold",e.class,e.l.displayName?"pr-3":void 0)),()=>tb(e.l)]),K(r,n),Ut()}pc(["click"]);const L6=r=>{var e;switch(r.mode){case"WALK":return Rt.walk;case"BIKE":return Rt.bike;case"RENTAL":switch((e=r.rental)==null?void 0:e.formFactor){case"BICYCLE":return Rt.bike;case"CARGO_BICYCLE":return Rt.cargoBike;case"CAR":return Rt.car;case"MOPED":return Rt.moped;case"SCOOTER_SEATED":return Rt.scooterSeated;case"SCOOTER_STANDING":return Rt.scooterStanding;case"OTHER":default:return Rt.bike}case"CAR":case"CAR_PARKING":return Rt.car;case"ODM":return Rt.taxi;case"FLEX":return"Flex";default:return`${r.mode}`}},BC=r=>{switch(r){case"BUS":case"FERRY":case"TRAM":case"COACH":case"AIRPLANE":case"AERIAL_LIFT":return"Platform";default:return"Track"}};function z6(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"triangle-alert"},()=>t,{iconNode:[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var U6=(r,e)=>ve(e,!A(e)),V6=Ve('<span class="text-sm font-bold"> <!></span>'),j6=Ve('<span class="text-sm block font-bold"> <!></span>'),H6=Ve('<div class="w-full items-center bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-2 rounded shadow"><p class="font-bold overflow-hidden"> </p> <!> <!> <p class="text-sm overflow-hidden"> </p></div>'),W6=Ve('<div class="flex flex-col gap-2 max-w-xs items-start"><button class="p-1 bg-yellow-500 origin-top-left text-xs text-white font-bold rounded-lg hover:bg-yellow-600 transition-colors shadow-lg flex items-center"><!> <!></button> <!></div>');function m1(r,e){zt(e,!0);let t=Pt(!1);var n=W6(),i=Be(n);i.__click=[U6,t];var l=Be(i);z6(l,{class:"size-4 mr-1"});var u=we(l),a=we(u);const p=Re(()=>`transition-transform duration-500 ${A(t)?"rotate-180":""}`);Bm(a,{size:20,get class(){return A(p)}}),ke(i);var y=we(i,2);jn(y,17,()=>e.alerts,Hi,(x,T)=>{var E=it(),k=xe(E);{var F=D=>{var N=H6(),B=Be(N),V=Be(B,!0);ke(B);var U=we(B,2);{var j=Ie=>{var Ue=V6(),De=Be(Ue),pe=we(De);const ze=Re(()=>{var ot;return((ot=A(T).impactPeriod[0])==null?void 0:ot.start)??""}),Ne=Re(()=>{var ot;return((ot=A(T).impactPeriod[0])==null?void 0:ot.start)??""});uc(pe,{variant:"schedule",class:"text-sm font-bold inline-flex justify-center gap-2 align-middle items-center",get timeZone(){return e.timeZone},isRealtime:!1,get timestamp(){return A(ze)},get scheduledTimestamp(){return A(Ne)}}),ke(Ue),ct(()=>vt(De,`${Rt.from??""} `)),K(Ie,Ue)};et(U,Ie=>{var Ue;A(T).impactPeriod&&((Ue=A(T).impactPeriod[0])!=null&&Ue.start)&&Ie(j)})}var J=we(U,2);{var oe=Ie=>{var Ue=j6(),De=Be(Ue),pe=we(De);const ze=Re(()=>A(T).impactPeriod[A(T).impactPeriod.length-1].end??""),Ne=Re(()=>{var ot;return((ot=A(T).impactPeriod[0])==null?void 0:ot.start)??""});uc(pe,{variant:"schedule",class:"text-sm font-bold inline-flex justify-center gap-2 align-middle items-center",get timeZone(){return e.timeZone},isRealtime:!1,get timestamp(){return A(ze)},get scheduledTimestamp(){return A(Ne)}}),ke(Ue),ct(()=>vt(De,`${Rt.to??""} `)),K(Ie,Ue)};et(J,Ie=>{var Ue;A(T).impactPeriod&&A(T).impactPeriod.length>1&&((Ue=A(T).impactPeriod[A(T).impactPeriod.length-1])!=null&&Ue.end)&&Ie(oe)})}var le=we(J,2),Ce=Be(le,!0);ke(le),ke(N),ct(()=>{vt(V,A(T).headerText),vt(Ce,A(T).descriptionText)}),K(D,N)};et(k,D=>{A(t)&&D(F)})}K(x,E)}),ke(n),ct(()=>vt(u,` ${Rt.alertsAvailable??""} `)),K(r,n),Ut()}pc(["click"]);const sh=(r,e=Cr,t=Cr,n=Cr,i=Cr,l=Cr,u=Cr,a=Cr)=>{var p=J6();const y=Re(()=>u()==0||u()==1),x=Re(()=>u()==0?"text-muted-foreground":"");var T=xe(p),E=Be(T),k=Be(E);uc(k,{variant:"schedule",get class(){return`font-semibold w-14 md:w-16 ${A(x)??""}`},get queriedTime(){return e()},get timeZone(){return i().tz},get isRealtime(){return n()},get timestamp(){return e()},get scheduledTimestamp(){return t()},get arriveBy(){return A(y)}});var F=we(k,2);uc(F,{variant:"realtime",class:"font-semibold w-14 md:w-16",get timeZone(){return i().tz},get isRealtime(){return n()},get timestamp(){return e()},get scheduledTimestamp(){return t()},get arriveBy(){return A(y)}}),ke(E);var D=we(E,2),N=Be(D);{var B=J=>{var oe=Y6();const le=Re(()=>i().pickupType=="NOT_ALLOWED"&&u()!=1),Ce=Re(()=>i().dropoffType=="NOT_ALLOWED"&&u()!=-1);var Ie=xe(oe),Ue=Be(Ie);Bn(Ue,{get class(){return`text-[length:inherit] leading-none justify-normal text-wrap p-0 text-left ${A(x)??""}`},variant:"link",onclick:()=>fd(i().name,i().stopId,new Date(e())),children:(Qe,pt)=>{sn();var _t=jr();ct(()=>vt(_t,i().name)),K(Qe,_t)},$$slots:{default:!0}});var De=we(Ue,2);{var pe=Qe=>{var pt=q6(),_t=Be(pt);ke(pt),ct(Lt=>vt(_t,`${Lt??""}
							${i().track??""}`),[()=>BC(l())=="Track"?Rt.trackAbr:Rt.platformAbr]),K(Qe,pt)};et(De,Qe=>{i().track&&!a()&&Qe(pe)})}ke(Ie);var ze=we(Ie,2);{var Ne=Qe=>{var pt=X6();const _t=Re(()=>i().switchTo);var Lt=Be(pt),Ht=we(Lt);g1(Ht,{class:"mx-1 size-4"});var ar=we(Ht);ke(pt),ct(()=>{vt(Lt,`${Rt.continuesAs??""}
						${A(_t).displayName??""} `),vt(ar,` ${A(_t).headsign??""}`)}),K(Qe,pt)};et(ze,Qe=>{i().switchTo&&Qe(Ne)})}var ot=we(ze,2);{var At=Qe=>{var pt=Z6(),_t=Be(pt);rb(_t,{class:"stroke-destructive size-4"});var Lt=we(_t,2),Ht=Be(Lt,!0);ke(Lt),ke(pt),ct(()=>vt(Ht,A(le)&&A(Ce)?Rt.inOutDisallowed:A(le)?Rt.inDisallowed:Rt.outDisallowed)),K(Qe,pt)};et(ot,Qe=>{(A(le)||A(Ce))&&Qe(At)})}K(J,oe)},V=J=>{var oe=K6(),le=Be(oe,!0);ke(oe),ct(()=>vt(le,i().name||i().flex)),K(J,oe)};et(N,J=>{i().stopId?J(B):J(V,!1)})}ke(D),ke(T);var U=we(T,2);{var j=J=>{var oe=G6(),le=Be(oe);const Ce=Re(()=>i().tz??"");m1(le,{get timeZone(){return A(Ce)},get alerts(){return i().alerts}}),ke(oe),K(J,oe)};et(U,J=>{u()&&i().alerts&&J(j)})}ct(()=>Di(T,1,`flex items-baseline ${u()==0?"text-sm":""} pb-2 pr-2 justify-between w-full text-wrap`)),K(r,p)},$6=(r,e=Cr)=>{var t=s5();const n=Re(()=>{var j;return(j=e().steps)==null?void 0:j.filter(J=>J.elevationUp||J.elevationDown)}),i=Re(()=>{var j;return(j=e().steps)==null?void 0:j.filter(J=>J.toll)}),l=Re(()=>{var j;return(j=e().steps)==null?void 0:j.filter(J=>J.accessRestriction)});var u=Be(t),a=Be(u);ke(u);var p=we(u,2);{var y=j=>{var J=Q6(),oe=Be(J),le=we(oe),Ce=Be(le,!0);ke(le),ke(J),ct(()=>{vt(oe,`${Rt.sharingProvider??""}: `),ls(le,"href",e().rental.url),vt(Ce,e().rental.systemName)}),K(j,J)};et(p,j=>{e().rental&&e().rental.systemName&&j(y)})}var x=we(p,2);{var T=j=>{var J=e5(),oe=Be(J,!0);ke(J),ct(()=>vt(oe,Rt.roundtripStationReturnConstraint)),K(j,J)};et(x,j=>{var J;((J=e().rental)==null?void 0:J.returnConstraint)=="ROUNDTRIP_STATION"&&j(T)})}var E=we(x,2);{var k=j=>{var J=t5(),oe=Be(J);Bn(oe,{class:"font-bold",variant:"outline",get href(){return e().rental.rentalUriWeb},target:"_blank",children:(le,Ce)=>{sn();var Ie=jr();ct(()=>vt(Ie,Rt.rent)),K(le,Ie)},$$slots:{default:!0}}),ke(J),K(j,J)};et(E,j=>{var J;(J=e().rental)!=null&&J.rentalUriWeb&&j(k)})}var F=we(E,2);{var D=j=>{var J=r5(),oe=Be(J),le=we(oe),Ce=Be(le);O6(Ce,{class:"size-4"});var Ie=we(Ce);ke(le);var Ue=we(le,2),De=Be(Ue);D6(De,{class:"size-4"});var pe=we(De);ke(Ue),ke(J),ct((ze,Ne)=>{vt(oe,`${Rt.incline??""} `),vt(Ie,` ${ze??""} m`),vt(pe,` ${Ne??""} m`)},[()=>A(n).reduce((ze,Ne)=>ze+Ne.elevationUp,0),()=>A(n).reduce((ze,Ne)=>ze+Ne.elevationDown,0)]),K(j,J)};et(F,j=>{A(n)&&A(n).length>0&&j(D)})}var N=we(F,2);{var B=j=>{var J=n5(),oe=Be(J);N6(oe,{class:"size-4"});var le=we(oe);ke(J),ct(()=>vt(le,` ${Rt.toll??""}`)),K(j,J)};et(N,j=>{A(i)&&A(i).length>0&&j(B)})}var V=we(N,2);{var U=j=>{var J=i5(),oe=Be(J);rb(oe,{class:"size-4"});var le=we(oe);ke(J),ct(Ce=>vt(le,` ${Rt.accessRestriction??""}
				(${Ce??""})`),[()=>A(l).map(Ce=>Ce.accessRestriction).filter((Ce,Ie,Ue)=>Ue.indexOf(Ce)===Ie).join(", ")]),K(j,J)};et(V,j=>{A(l)&&A(l).length>0&&j(U)})}ke(t),ct((j,J,oe)=>vt(a,`${j??""}
			${J??""}
			${oe??""}`),[()=>Ho(e().duration),()=>L6(e()),()=>Dz(e().distance)]),K(r,t)},AS=(r,e=Cr)=>{sn();var t=u5(),n=xe(t),i=we(n);{var l=p=>{var y=l5(),x=we(xe(y));{var T=k=>{var F=o5();let D;var N=Be(F,!0);ke(F),ct(B=>{D=Di(F,1,"underline",null,D,B),ls(F,"href",e().riderCategory.eligibilityUrl),vt(N,e().riderCategory.riderCategoryName)},[()=>({italic:e().riderCategory.isDefaultFareCategory})]),K(k,F)},E=k=>{var F=a5();let D;var N=Be(F,!0);ke(F),ct(B=>{D=Di(F,1,"",null,D,B),vt(N,e().riderCategory.riderCategoryName)},[()=>({italic:e().riderCategory.isDefaultFareCategory})]),K(k,F)};et(x,k=>{e().riderCategory.eligibilityUrl?k(T):k(E,!1)})}K(p,y)};et(i,p=>{e().riderCategory&&p(l)})}var u=we(i,2);{var a=p=>{var y=c5(),x=we(xe(y));{var T=k=>{var F=jr();ct(()=>vt(F,e().media.fareMediaName)),K(k,F)},E=k=>{var F=jr();ct(()=>vt(F,e().media.fareMediaType)),K(k,F)};et(x,k=>{e().media.fareMediaName?k(T):k(E,!1)})}K(p,y)};et(u,p=>{e().media&&p(a)})}ct(p=>vt(n,`${e().name??""}
	${p??""} `),[()=>new Intl.NumberFormat(fa,{style:"currency",currency:e().currency}).format(e().amount)]),K(r,t)};var q6=Ve('<span class="text-nowrap px-2 border rounded-xl mx-1"> </span>'),X6=Ve('<div class="flex items-center text-sm"> <!> </div>'),Z6=Ve('<div class="flex items-center text-destructive text-sm"><!> <span class="ml-1 leading-none"> </span></div>'),Y6=Ve('<div class="flex max-h-6 items-center justify-between"><!> <!></div>  <!> <!>',1),K6=Ve("<span> </span>"),G6=Ve('<div class="-mt-1"><!></div>'),J6=Ve('<div><div class="flex justify-between"><!> <!></div> <div class="w-full min-w-0 break-words mb-7 ml-2"><!></div></div> <!>',1),Q6=Ve('<span class="ml-6"> <a target="_blank" class="hover:underline"> </a></span>'),e5=Ve('<span class="ml-6"> </span>'),t5=Ve('<span class="ml-6"><!></span>'),r5=Ve('<div class="ml-6 flex items-center gap-2 text-xs"> <div class="flex items-center"><!> </div> <div class="flex items-center"><!> </div></div>'),n5=Ve('<div class="ml-6 flex items-center gap-2 text-sm text-orange-500"><!> </div>'),i5=Ve('<div class="ml-6 flex items-center gap-2 text-sm text-orange-500"><!> </div>'),s5=Ve('<div class="py-12 pl-8 flex flex-col gap-y-4 text-muted-foreground"><span class="ml-6"> </span> <!> <!> <!> <!> <!> <!></div>'),o5=Ve("<a> </a>"),a5=Ve("<span> </span>"),l5=Ve("for <!>",1),c5=Ve("as <!>",1),u5=Ve(" <!> <!>",1),h5=Ve('<div class="mb-1"> </div>'),d5=Ve("<li><!></li>"),f5=Ve("<!> <ul></ul>",1),p5=Ve('<div class="pl-1 md:pl-4 my-8 text-xs font-bold"><!></div>'),g5=Ve('<div class="mb-1"> </div>'),m5=Ve("<li><!></li>"),_5=Ve('<br/> <span class="text-xs font-bold text-foreground text-left"><!> <ul></ul></span>',1),y5=Ve('<div class="border-t h-0 grow shrink"></div> <div class="text-sm text-muted-foreground leading-none px-2 text-center"><!> <!> <!></div>',1),v5=Ve("<br/> ",1),b5=Ve(" <!>",1),x5=Ve('<div class="mt-2 flex items-center text-destructive leading-none"> </div>'),w5=Ve('<div class="mt-2 flex items-center text-destructive leading-none"><!> <span class="ml-1 font-bold"> </span></div>'),T5=Ve('<div class="mt-2 flex items-center text-green-600 leading-none"><span class="ml-1"> </span></div>'),S5=Ve('<div class="pt-16 pb-8 pl-1 md:pl-4 flex items-center text-muted-foreground"> </div> <!>',1),A5=Ve('<!> <details class="[&amp;_.collapsible]:open:-rotate-180"><summary class="pt-4 pb-4 pl-1 md:pl-4 flex items-center text-muted-foreground"><svg class="collapsible rotate-0 transform transition-all duration-300" fill="none" height="20" width="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg> <span class="ml-2 cursor-pointer"> </span></summary> <div class="grid items-start content-start"></div></details>',1),E5=Ve('<div class="pb-2"></div>'),I5=Ve('<div class="w-full flex justify-between items-center space-x-1"><!> <!> <div class="border-t h-0 grow shrink"></div></div> <div class="px-6 pt-2 border-l-4 left-4 w-full relative"><!> <div class="mt-5 flex items-center"><!> <span class="ml-1"><!></span></div> <!> <!> <!> <!> <!> <!> <!></div>',1),C5=Ve('<div class="mt-2 flex items-center leading-none"><span class="ml-1 text-sm"> </span></div>'),P5=Ve('<!> <div class="pt-4 pl-6 border-l-4 left-4 relative"><!> <!> <!> <!></div>',1),R5=Ve('<div class="text-lg"><!> <div class="ml-[10px] w-[15px] h-[15px] rounded-full"></div> <div class="relative w-full px-6 left-4"><!></div></div>');function k5(r,e){zt(e,!0);const t=(x,T=Cr,E=Cr)=>{var k=it(),F=xe(k);{var D=N=>{var B=p5();const V=Re(()=>e.itinerary.fareTransfers[E().fareTransferIndex]),U=Re(()=>A(V).rule=="AB"||A(V).rule=="A_AB"&&E().effectiveFareLegIndex!==0);var j=Be(B);{var J=le=>{var Ce=jr();ct(()=>vt(Ce,Rt.includedInTicket)),K(le,Ce)},oe=le=>{var Ce=f5();const Ie=Re(()=>A(V).effectiveFareLegProducts[E().effectiveFareLegIndex]);var Ue=xe(Ce);{var De=Ne=>{var ot=h5(),At=Be(ot);ke(ot),ct(()=>vt(At,`${Rt.ticketOptions??""}:`)),K(Ne,ot)};et(Ue,Ne=>{A(Ie).length>1&&Ne(De)})}var pe=we(Ue,2);let ze;jn(pe,21,()=>A(Ie),Hi,(Ne,ot)=>{var At=it(),Qe=xe(At);jn(Qe,17,()=>A(ot),Hi,(pt,_t)=>{var Lt=d5(),Ht=Be(Lt);AS(Ht,()=>A(_t)),ke(Lt),K(pt,Lt)}),K(Ne,At)}),ke(pe),ct(Ne=>ze=Di(pe,1,"",null,ze,Ne),[()=>({"list-disc":A(Ie).length>1,"list-outside":A(Ie).length>1})]),K(le,Ce)};et(j,le=>{A(U)||T()&&T().fareTransferIndex===E().fareTransferIndex&&T().effectiveFareLegIndex===E().effectiveFareLegIndex?le(J):le(oe,!1)})}ke(B),K(N,B)};et(F,N=>{e.itinerary.fareTransfers!=null&&E().fareTransferIndex!=null&&E().effectiveFareLegIndex!=null&&N(D)})}K(x,k)},n=x=>x.duration!==0||x.displayName,i=Re(()=>e.itinerary.legs.findLast(n));var l=R5(),u=Be(l);jn(u,17,()=>e.itinerary.legs,Hi,(x,T,E)=>{var k=it();const F=Re(()=>E==e.itinerary.legs.length-1),D=Re(()=>E==e.itinerary.legs.length-2),N=Re(()=>E==0?void 0:e.itinerary.legs[E-1]),B=Re(()=>A(F)?void 0:e.itinerary.legs[E+1]),V=Re(()=>e.itinerary.legs.slice(0,E).find(oe=>oe.tripId));var U=xe(k);{var j=oe=>{var le=I5(),Ce=xe(le),Ie=Be(Ce);W0(Ie,{onClickTrip:fp,get l(){return A(T)}});var Ue=we(Ie,2);{var De=mt=>{var Te=y5(),Qt=we(xe(Te),2),Ct=Be(Qt);{var yt=Zt=>{var Ar=jr();ct(Fr=>vt(Ar,`${Fr??""} ${Rt.walk??""}`),[()=>Ho(A(N).duration)]),K(Zt,Ar)};et(Ct,Zt=>{A(N).duration&&Zt(yt)})}var sr=we(Ct,2);{var Br=Zt=>{var Ar=jr();ct(Fr=>vt(Ar,`(${Fr??""} m)`),[()=>Math.round(A(N).distance)]),K(Zt,Ar)};et(sr,Zt=>{A(N).distance&&Zt(Br)})}var $r=we(sr,2);{var Jt=Zt=>{var Ar=it();const Fr=Re(()=>e.itinerary.fareTransfers[A(V).fareTransferIndex].transferProducts);var Jr=xe(Ar);{var bt=zr=>{var Mr=_5(),Zr=we(xe(Mr),2),xn=Be(Zr);{var Ot=dt=>{var xt=g5(),at=Be(xt);ke(xt),ct(()=>vt(at,`${Rt.ticketOptions??""}:`)),K(dt,xt)};et(xn,dt=>{A(Fr).length>1&&dt(Ot)})}var qe=we(xn,2);let $e;jn(qe,21,()=>A(Fr),Hi,(dt,xt)=>{var at=m5(),Dt=Be(at);AS(Dt,()=>A(xt)),ke(at),K(dt,at)}),ke(qe),ke(Zr),ct(dt=>$e=Di(qe,1,"",null,$e,dt),[()=>({"list-disc":A(Fr).length>1,"list-outside":A(Fr).length>1})]),K(zr,Mr)};et(Jr,zr=>{A(V).effectiveFareLegIndex===0&&A(T).effectiveFareLegIndex===1&&zr(bt)})}K(Zt,Ar)};et($r,Zt=>{var Ar;((Ar=A(V))==null?void 0:Ar.fareTransferIndex)!=null&&e.itinerary.fareTransfers&&e.itinerary.fareTransfers[A(V).fareTransferIndex].transferProducts&&Zt(Jt)})}ke(Qt),K(mt,Te)};et(Ue,mt=>{A(N)&&(A(N).from.track||n(A(N)))&&(E!=1||A(N).displayName)&&mt(De)})}sn(2),ke(Ce);var pe=we(Ce,2),ze=Be(pe);sh(ze,()=>A(T).startTime,()=>A(T).scheduledStartTime,()=>A(T).realTime,()=>A(T).from,()=>A(T).mode,()=>-1);var Ne=we(ze,2),ot=Be(Ne);g1(ot,{class:"stroke-muted-foreground size-4"});var At=we(ot,2),Qe=Be(At);{var pt=mt=>{Bn(mt,{class:"text-[length:inherit] text-muted-foreground leading-none justify-normal text-wrap text-left ",variant:"link",onclick:()=>fd(A(T).tripTo.name,A(T).tripTo.stopId,new Date(A(T).tripTo.arrival)),children:(Te,Qt)=>{sn();var Ct=b5(),yt=xe(Ct),sr=we(yt);{var Br=$r=>{var Jt=v5(),Zt=we(xe(Jt));ct(()=>vt(Zt,`(${A(T).tripTo.name??""})`)),K($r,Jt)};et(sr,$r=>{(!A(T).headsign||!A(T).tripTo.name.startsWith(A(T).headsign))&&$r(Br)})}ct(()=>vt(yt,`${A(T).headsign??""} `)),K(Te,Ct)},$$slots:{default:!0}})},_t=mt=>{var Te=jr();ct(()=>vt(Te,A(T).headsign)),K(mt,Te)};et(Qe,mt=>{A(T).tripTo?mt(pt):mt(_t,!1)})}ke(At),ke(Ne);var Lt=we(Ne,2);{var Ht=mt=>{const Te=Re(()=>A(T).from.tz??"");m1(mt,{get timeZone(){return A(Te)},get alerts(){return A(T).alerts}})};et(Lt,mt=>{A(T).alerts&&mt(Ht)})}var ar=we(Lt,2);{var Tt=mt=>{var Te=x5(),Qt=Be(Te);ke(Te),ct(Ct=>vt(Qt,`${Rt.dataExpiredSince??""}
						${Ct??""}`),[()=>c6(new Date(A(T).loopedCalendarSince),A(T).from.tz)]),K(mt,Te)};et(ar,mt=>{A(T).loopedCalendarSince&&mt(Tt)})}var Sr=we(ar,2);{var Et=mt=>{var Te=w5(),Qt=Be(Te);rb(Qt,{class:"stroke-destructive size-4"});var Ct=we(Qt,2),yt=Be(Ct,!0);ke(Ct),ke(Te),ct(()=>vt(yt,Rt.tripCancelled)),K(mt,Te)};et(Sr,mt=>{A(T).cancelled&&mt(Et)})}var Or=we(Sr,2);{var ir=mt=>{var Te=T5(),Qt=Be(Te),Ct=Be(Qt,!0);ke(Qt),ke(Te),ct(()=>vt(Ct,Rt.unscheduledTrip)),K(mt,Te)};et(Or,mt=>{A(T).scheduled||mt(ir)})}var vr=we(Or,2);{var ur=mt=>{var Te=S5(),Qt=xe(Te),Ct=Be(Qt,!0);ke(Qt);var yt=we(Qt,2);t(yt,()=>A(V),()=>A(T)),ct(sr=>vt(Ct,sr),[()=>Rt.tripIntermediateStops(0)]),K(mt,Te)},kr=mt=>{var Te=A5(),Qt=xe(Te);t(Qt,()=>A(V),()=>A(T));var Ct=we(Qt,2),yt=Be(Ct),sr=we(Be(yt),2),Br=Be(sr);ke(sr),ke(yt);var $r=we(yt,2);jn($r,21,()=>A(T).intermediateStops,Hi,(Jt,Zt,Ar,Fr)=>{sh(Jt,()=>A(Zt).arrival,()=>A(Zt).scheduledArrival,()=>A(T).realTime,()=>A(Zt),()=>A(T).mode,()=>0)}),ke($r),ke(Ct),ct((Jt,Zt)=>vt(Br,`${Jt??""}
								(${Zt??""})`),[()=>{var Jt;return Rt.tripIntermediateStops(((Jt=A(T).intermediateStops)==null?void 0:Jt.length)??0)},()=>Ho(A(T).duration)]),K(mt,Te)};et(vr,mt=>{var Te;((Te=A(T).intermediateStops)==null?void 0:Te.length)===0?mt(ur):mt(kr,!1)})}var nn=we(vr,2);{var pr=mt=>{sh(mt,()=>A(T).endTime,()=>A(T).scheduledEndTime,()=>A(T).realTime,()=>A(T).to,()=>A(T).mode,()=>1)};et(nn,mt=>{!A(F)&&!(A(D)&&!n(A(B)))&&mt(pr)})}var Hr=we(nn,2);{var Nr=mt=>{var Te=E5();K(mt,Te)};et(Hr,mt=>{(A(F)||A(D)&&!n(A(B)))&&mt(Nr)})}ke(pe),ct(mt=>rc(pe,mt),[()=>wS(A(T))]),K(oe,le)},J=(oe,le)=>{{var Ce=Ie=>{var Ue=P5(),De=xe(Ue);W0(De,{onClickTrip:fp,get l(){return A(T)}});var pe=we(De,2),ze=Be(pe);sh(ze,()=>A(T).startTime,()=>A(T).scheduledStartTime,()=>A(T).realTime,()=>A(T).from,()=>A(T).mode,()=>-1,()=>!0);var Ne=we(ze,2);{var ot=_t=>{var Lt=C5(),Ht=Be(Lt),ar=Be(Ht);ke(Ht),ke(Lt),ct((Tt,Sr)=>vt(ar,`${Tt??""} -
							${Sr??""}`),[()=>rd(new Date(A(T).from.flexStartPickupDropOffWindow),A(T).from.tz),()=>rd(new Date(A(T).from.flexEndPickupDropOffWindow),A(T).from.tz)]),K(_t,Lt)};et(Ne,_t=>{A(T).mode=="FLEX"&&_t(ot)})}var At=we(Ne,2);$6(At,()=>A(T));var Qe=we(At,2);{var pt=_t=>{sh(_t,()=>A(T).endTime,()=>A(T).scheduledEndTime,()=>A(T).realTime,()=>A(T).to,()=>A(T).mode,()=>1,()=>!0)};et(Qe,_t=>{A(F)||_t(pt)})}ke(pe),ct(_t=>rc(pe,_t),[()=>wS(A(T))]),K(Ie,Ue)};et(oe,Ie=>{!(A(F)&&!n(A(T)))&&(E==0&&n(A(T))||!A(B)||!A(B).displayName||A(T).mode!="WALK"||A(N)&&(A(N).mode=="BIKE"||A(T).mode=="WALK"&&A(N).mode=="CAR"||A(N).mode=="RENTAL"))&&Ie(Ce)},le)}};et(U,oe=>{A(T).displayName?oe(j):oe(J,!1)})}K(x,k)});var a=we(u,2),p=we(a,2),y=Be(p);sh(y,()=>A(i).endTime,()=>A(i).scheduledEndTime,()=>A(i).realTime,()=>A(i).to,()=>A(i).mode,()=>1),ke(p),ke(l),ct(x=>rc(a,x),[()=>tb(A(i))]),K(r,l),Ut()}function Ci(r,e){zt(e,!0);let t=fe(e,"beforeLayerId",3,"road-ref-shield");const n=new WeakMap,i=le=>{let Ce=n.get(le);return Ce||(Ce={moves:new Map,frame:null},n.set(le,Ce)),Ce};function l(le){e.onclick&&e.onclick(le,E.map)}function u(le){e.onmousemove&&e.onmousemove(le,E.map)}function a(le){e.onmouseleave&&e.onmouseleave(le,E.map)}const p=le=>{const Ce=n.get(le);if(Ce){for(const[Ie,Ue]of Array.from(Ce.moves.entries())){if(!le.getLayer(Ie)){Ce.moves.delete(Ie);continue}le.getLayer(Ue)&&(le.moveLayer(Ie,Ue),Ce.moves.delete(Ie))}Ce.moves.size===0&&(Ce.frame!==null&&cancelAnimationFrame(Ce.frame),n.delete(le))}},y=(le,Ce,Ie)=>{if(!Ie||Ie===Ce)return;const Ue=i(le);Ue.moves.set(Ce,Ie),Ue.frame===null&&(Ue.frame=requestAnimationFrame(()=>{Ue.frame=null,p(le)}))},x=(le,Ce)=>{if(!le)return;const Ie=n.get(le);Ie&&(Ie.moves.delete(Ce),Ie.moves.size===0&&(Ie.frame!==null&&cancelAnimationFrame(Ie.frame),n.delete(le)))};let T=yn({id:e.id});qv("layer",T);let E=Ja("map"),k=Ja("source"),F=!1,D=Ks(e.filter),N=Ks(e.layout),B=Ks(e.paint),V=t(),U=()=>{const le=E.map,Ce=le==null?void 0:le.getLayer(e.id);if(!k.id){Ce&&(T.id=null,le==null||le.removeLayer(e.id)),x(le,e.id);return}if(Ce&&e.filter==D&&e.layout==N&&e.paint==B){le&&p(le);return}if(!Ce){const Ie=t()&&(le!=null&&le.getLayer(t()))?t():void 0;le.addLayer({source:k.id,id:e.id,type:e.type,filter:e.filter,layout:e.layout,paint:e.paint},Ie),D=Ks(e.filter),N=Ks(e.layout),B=Ks(e.paint),V=t(),T.id=e.id,t()&&!Ie&&y(le,e.id,t()),p(le);return}D!=e.filter&&(D=Ks(e.filter),le.setFilter(e.id,e.filter)),V!==t()&&(V=t(),t()&&(le!=null&&le.getLayer(t()))?le.moveLayer(e.id,t()):t()&&y(le,e.id,t())),le&&p(le)};Xr(()=>{E.map&&k.id&&(F||(e.onclick&&E.map.on("click",e.id,l),e.onmousemove&&E.map.on("mousemove",e.id,u),e.onmouseleave&&E.map.on("mouseleave",e.id,a),E.map.on("styledata",U),U(),F=!0),p(E.map))}),oc(()=>{var Ce,Ie,Ue,De,pe,ze;const le=(Ce=E.map)==null?void 0:Ce.getLayer(e.id);(Ie=E.map)==null||Ie.off("styledata",U),e.onclick&&((Ue=E.map)==null||Ue.off("click",e.id,l)),e.onmousemove&&((De=E.map)==null||De.off("mousemove",e.id,u)),e.onmouseleave&&((pe=E.map)==null||pe.off("mouseleave",e.id,a)),le&&((ze=E.map)==null||ze.removeLayer(e.id)),x(E.map,e.id)});var j=it(),J=xe(j);{var oe=le=>{var Ce=it(),Ie=xe(Ce);fr(Ie,()=>e.children),K(le,Ce)};et(J,le=>{e.children&&le(oe)})}K(r,j),Ut()}var M5={exports:{}};(function(r){(function(e){e.version="0.5.0",e.defaults={doThrows:{invalidGeometry:!1}};function t(){var D=1<=arguments.length?[].slice.call(arguments,0):[],N=D.shift(),B=D.shift();Error.apply(this,D),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(N)+", params: "+JSON.stringify(B)}t.prototype=Error,e.errors={InvalidGeometryError:t},e.isGeometryValid=function(D){return!D||!Object.keys(D).length?!1:!!D.type&&!!D.coordinates&&Array.isArray(D.coordinates)&&!!D.coordinates.length},e.parse=function(D,N,B){var V,U=l(N,this.defaults),j;if(i.length=0,p(U),j=k(U),Array.isArray(D)?(V={type:"FeatureCollection",features:[]},D.forEach(function(J){V.features.push(x({item:J,params:U,propFunc:j}))}),u(V,U)):(V=x({item:D,params:U,propFunc:j}),u(V,U)),B&&typeof B=="function")B(V);else return V};var n=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],i=[];function l(D,N){var B=D||{};for(var V in N)N.hasOwnProperty(V)&&!B[V]&&(B[V]=N[V]);return B}function u(D,N){if(N.crs&&a(N.crs)&&(N.isPostgres?D.geometry.crs=N.crs:D.crs=N.crs),N.bbox&&(D.bbox=N.bbox),N.extraGlobal){D.properties={};for(var B in N.extraGlobal)D.properties[B]=N.extraGlobal[B]}}function a(D){if(D.type==="name"){if(D.properties&&D.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}else if(D.type==="link"){if(D.properties&&D.properties.href&&D.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}else throw new Error('Invald CRS. Type attribute must be "name" or "link"')}function p(D){D.geom={};for(var N in D)D.hasOwnProperty(N)&&n.indexOf(N)!==-1&&(D.geom[N]=D[N],delete D[N]);y(D.geom)}function y(D){for(var N in D)D.hasOwnProperty(N)&&(typeof D[N]=="string"?i.push(D[N]):typeof D[N]=="object"&&(i.push(D[N][0]),i.push(D[N][1])));if(i.length===0)throw new Error("No geometry attributes specified")}function x(D){var N=D.item,B=D.params,V=D.propFunc,U={type:"Feature"};return U.geometry=E(N,B),U.properties=V.call(N),U}function T(D){return/^.+\..+$/.test(D)}function E(D,N){var B={};for(var V in N.geom){var U=N.geom[V];if(typeof U=="string"&&D.hasOwnProperty(U))V==="GeoJSON"?B=D[U]:(B.type=V,B.coordinates=D[U]);else if(typeof U=="object"&&!Array.isArray(U)){var j=Object.keys(U).map(function(Ue){var De=U[Ue],pe=D[Ue];return E(pe,{geom:{Point:De}})});B.type=V,B.coordinates=[].concat(j.map(function(Ue){return Ue.coordinates}))}else if(Array.isArray(U)&&D.hasOwnProperty(U[0])&&D.hasOwnProperty(U[1]))B.type=V,B.coordinates=[Number(D[U[1]]),Number(D[U[0]])];else if(Array.isArray(U)&&T(U[0])&&T(U[1])){for(var J=[],oe=0;oe<U.length;oe++){for(var le=U[oe].split("."),Ce=D,Ie=0;Ie<le.length;Ie++){if(!Ce.hasOwnProperty(le[Ie]))return!1;Ce=Ce[le[Ie]]}J[oe]=Ce}B.type=V,B.coordinates=[Number(J[1]),Number(J[0])]}}if(N.doThrows&&N.doThrows.invalidGeometry&&!e.isGeometryValid(B))throw new t(D,N);return B}function k(D){var N;return!D.exclude&&!D.include?N=function(B){for(var V in this)this.hasOwnProperty(V)&&i.indexOf(V)===-1&&(B[V]=this[V])}:D.include?N=function(B){D.include.forEach(function(V){B[V]=this[V]},this)}:D.exclude&&(N=function(B){for(var V in this)this.hasOwnProperty(V)&&i.indexOf(V)===-1&&D.exclude.indexOf(V)===-1&&(B[V]=this[V])}),function(){var B={};return N.call(this,B),D.extra&&F(B,D.extra),B}}function F(D,N){for(var B in N)N.hasOwnProperty(B)&&(D[B]=N[B]);return D}})(r.exports)})(M5);function ua(r,e){zt(e,!0);let t=Ja("map"),n=yn({id:null});qv("source",n);const i=()=>{if(!t.map||e.data==null)return;const p=t.map.getSource(e.id);p?p.setData(e.data):t.map.addSource(e.id,{type:"geojson",data:e.data,...e.options??{}}),n.id=e.id};let l=!1;Xr(()=>{t.map&&e.id&&e.data&&(i(),l||(t.map.on("styledata",i),n.id=e.id,l=!0))}),oc(()=>{var p,y;l&&((p=t.map)==null||p.off("styledata",i),n.id=null,t.map.getSource(e.id)&&((y=t.map)==null||y.removeSource(e.id)))});var u=it(),a=xe(u);fr(a,()=>e.children),K(r,u),Ut()}var O5={grad:.9,turn:360,rad:360/(2*Math.PI)},za=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},as=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},To=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},LC=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},ES=function(r){return{r:To(r.r,0,255),g:To(r.g,0,255),b:To(r.b,0,255),a:To(r.a)}},zx=function(r){return{r:as(r.r),g:as(r.g),b:as(r.b),a:as(r.a,3)}},D5=/^#([0-9a-f]{3,8})$/i,G_=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},zC=function(r){var e=r.r,t=r.g,n=r.b,i=r.a,l=Math.max(e,t,n),u=l-Math.min(e,t,n),a=u?l===e?(t-n)/u:l===t?2+(n-e)/u:4+(e-t)/u:0;return{h:60*(a<0?a+6:a),s:l?u/l*100:0,v:l/255*100,a:i}},UC=function(r){var e=r.h,t=r.s,n=r.v,i=r.a;e=e/360*6,t/=100,n/=100;var l=Math.floor(e),u=n*(1-t),a=n*(1-(e-l)*t),p=n*(1-(1-e+l)*t),y=l%6;return{r:255*[n,a,u,u,p,n][y],g:255*[p,n,n,a,u,u][y],b:255*[u,u,p,n,n,a][y],a:i}},IS=function(r){return{h:LC(r.h),s:To(r.s,0,100),l:To(r.l,0,100),a:To(r.a)}},CS=function(r){return{h:as(r.h),s:as(r.s),l:as(r.l),a:as(r.a,3)}},PS=function(r){return UC((t=(e=r).s,{h:e.h,s:(t*=((n=e.l)<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:e.a}));var e,t,n},rp=function(r){return{h:(e=zC(r)).h,s:(i=(200-(t=e.s))*(n=e.v)/100)>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,n,i},N5=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,F5=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,B5=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,L5=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,RS={string:[[function(r){var e=D5.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?as(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?as(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=B5.exec(r)||L5.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:ES({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=N5.exec(r)||F5.exec(r);if(!e)return null;var t,n,i=IS({h:(t=e[1],n=e[2],n===void 0&&(n="deg"),Number(t)*(O5[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return PS(i)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,n=r.b,i=r.a,l=i===void 0?1:i;return za(e)&&za(t)&&za(n)?ES({r:Number(e),g:Number(t),b:Number(n),a:Number(l)}):null},"rgb"],[function(r){var e=r.h,t=r.s,n=r.l,i=r.a,l=i===void 0?1:i;if(!za(e)||!za(t)||!za(n))return null;var u=IS({h:Number(e),s:Number(t),l:Number(n),a:Number(l)});return PS(u)},"hsl"],[function(r){var e=r.h,t=r.s,n=r.v,i=r.a,l=i===void 0?1:i;if(!za(e)||!za(t)||!za(n))return null;var u=function(a){return{h:LC(a.h),s:To(a.s,0,100),v:To(a.v,0,100),a:To(a.a)}}({h:Number(e),s:Number(t),v:Number(n),a:Number(l)});return UC(u)},"hsv"]]},kS=function(r,e){for(var t=0;t<e.length;t++){var n=e[t][0](r);if(n)return[n,e[t][1]]}return[null,void 0]},z5=function(r){return typeof r=="string"?kS(r.trim(),RS.string):typeof r=="object"&&r!==null?kS(r,RS.object):[null,void 0]},Ux=function(r,e){var t=rp(r);return{h:t.h,s:To(t.s+100*e,0,100),l:t.l,a:t.a}},Vx=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},MS=function(r,e){var t=rp(r);return{h:t.h,s:t.s,l:To(t.l+100*e,0,100),a:t.a}},OS=function(){function r(e){this.parsed=z5(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return as(Vx(this.rgba),2)},r.prototype.isDark=function(){return Vx(this.rgba)<.5},r.prototype.isLight=function(){return Vx(this.rgba)>=.5},r.prototype.toHex=function(){return e=zx(this.rgba),t=e.r,n=e.g,i=e.b,u=(l=e.a)<1?G_(as(255*l)):"","#"+G_(t)+G_(n)+G_(i)+u;var e,t,n,i,l,u},r.prototype.toRgb=function(){return zx(this.rgba)},r.prototype.toRgbString=function(){return e=zx(this.rgba),t=e.r,n=e.g,i=e.b,(l=e.a)<1?"rgba("+t+", "+n+", "+i+", "+l+")":"rgb("+t+", "+n+", "+i+")";var e,t,n,i,l},r.prototype.toHsl=function(){return CS(rp(this.rgba))},r.prototype.toHslString=function(){return e=CS(rp(this.rgba)),t=e.h,n=e.s,i=e.l,(l=e.a)<1?"hsla("+t+", "+n+"%, "+i+"%, "+l+")":"hsl("+t+", "+n+"%, "+i+"%)";var e,t,n,i,l},r.prototype.toHsv=function(){return e=zC(this.rgba),{h:as(e.h),s:as(e.s),v:as(e.v),a:as(e.a,3)};var e},r.prototype.invert=function(){return Lo({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),Lo(Ux(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),Lo(Ux(this.rgba,-e))},r.prototype.grayscale=function(){return Lo(Ux(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),Lo(MS(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),Lo(MS(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?Lo({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):as(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=rp(this.rgba);return typeof e=="number"?Lo({h:e,s:t.s,l:t.l,a:t.a}):as(t.h)},r.prototype.isEqual=function(e){return this.toHex()===Lo(e).toHex()},r}(),Lo=function(r){return r instanceof OS?r:new OS(r)},U5=Ve("<!> <!>",1);function V5(r,e){zt(e,!0);const t=6;function n(a){return a=="WALK"||a=="BIKE"||a=="CAR"}function i(a){switch(a){case"CAR":return"#bf75ff";default:return"#42a5f5"}}function l(a){return{type:"FeatureCollection",features:a.legs.flatMap(p=>{if(p.steps){const y=n(p.mode)?i(p.mode):`${nc(p)[0]}`,x=Lo(y).darken(.2).toHex();return p.steps.map(T=>({type:"Feature",properties:{color:y,outlineColor:x,level:T.fromLevel,way:T.osmWay},geometry:{type:"LineString",coordinates:tu.decode(T.polyline.points,t).map(([E,k])=>[k,E])}}))}else{const y=`${nc(p)[0]}`;return{type:"Feature",properties:{outlineColor:Lo(y).darken(.2).toHex(),color:y},geometry:{type:"LineString",coordinates:tu.decode(p.legGeometry.points,t).map(([T,E])=>[E,T])}}}})}}const u=Re(()=>l(e.itinerary));return ua(r,{id:"route",get data(){return A(u)},children:(a,p)=>{var y=U5(),x=xe(y);const T=Re(()=>["any",["!has","level"],["==","level",e.level]]);Ci(x,{id:"path-outline",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return A(T)},paint:{"line-color":["get","outlineColor"],"line-width":10,"line-opacity":.8}});var E=we(x,2);const k=Re(()=>["any",["!has","level"],["==","level",e.level]]);Ci(E,{id:"path",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return A(k)},paint:{"line-color":["get","color"],"line-width":7.5,"line-opacity":.8}}),K(a,y)},$$slots:{default:!0}}),Ut({PRECISION:t})}function j5(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"bug"},()=>t,{iconNode:[["path",{d:"m8 2 1.88 1.88"}],["path",{d:"M14.12 3.88 16 2"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"}],["path",{d:"M12 20v-9"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5"}],["path",{d:"M6 13H2"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4"}],["path",{d:"M22 13h-4"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var H5=Ve('<div class="relative w-full overflow-auto"><table><!></table></div>');function $0(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=H5(),l=Be(i);let u;var a=Be(l);fr(a,()=>e.children??Cr),ke(l),Cs(l,p=>t(p),()=>t()),ke(i),ct(p=>u=Tn(l,u,{class:p,...n}),[()=>kn("w-full caption-bottom text-sm",e.class)]),K(r,i),Ut()}var W5=Ve("<tbody><!></tbody>");function q0(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=W5();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("[&_tr:last-child]:border-0",e.class)]),K(r,i),Ut()}var $5=Ve("<td><!></td>");function xo(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=$5();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e.class)]),K(r,i),Ut()}var q5=Ve("<th><!></th>");function ta(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=q5();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("text-muted-foreground h-10 px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e.class)]),K(r,i),Ut()}var X5=Ve("<thead><!></thead>");function DS(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=X5();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("[&_tr]:border-b",e.class)]),K(r,i),Ut()}var Z5=Ve("<tr><!></tr>");function Xf(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=an(e,["$$slots","$$events","$$legacy","ref","class","children"]);var i=Z5();let l;var u=Be(i);fr(u,()=>e.children??Cr),ke(i),Cs(i,a=>t(a),()=>t()),ct(a=>l=Tn(i,l,{class:a,...n}),[()=>kn("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e.class)]),K(r,i),Ut()}function _h(r,e){zt(e,!0);let t=Ja("map"),n=fe(e,"location",15),i=fe(e,"marker",15),l=!1;Xr(()=>{t.map&&n().match&&(l||(i(new wi.Marker({draggable:e.draggable,color:e.color}).setLngLat(n().match).addTo(t.map).on("dragend",()=>{if(i()&&n().match){let u=Oi(i().getLngLat(),e.level??0);n(u),n(n().label=u.label,!0)}})),l=!0))}),Xr(()=>{i()&&n()&&n().match&&n().match.lat&&n().match.lon&&i().setLngLat(n().match)}),oc(()=>{i()&&(i().remove(),i(void 0))}),Ut()}var Y5=Ve("<div><!></div>");function Hl(r,e){zt(e,!0);let t=Ja("map"),n=Ja("layer"),i=Pt(void 0),l=Pt(void 0),u=Pt(void 0),a=Pt(void 0);const p=()=>{A(l)&&(A(l).remove(),ve(l,void 0))},y=N=>{t.map&&(A(l)&&A(l).remove(),ve(l,new wi.Popup({anchor:"top-left",closeButton:!1}),!0),A(l).setLngLat(N.lngLat),A(l).addTo(t.map),ve(u,N),ve(a,N.features))},x=()=>{t.map&&(t.map.getCanvas().style.cursor="pointer")},T=()=>{t.map&&(t.map.getCanvas().style.cursor="")};let E=!1;Xr(()=>{t.map&&(E||(n?(t.map.on(e.trigger,n.id,y),t.map.on("mouseenter",n.id,x),t.map.on("mouseleave",n.id,T)):t.map.on(e.trigger,y)),E=!0)}),Xr(()=>{A(l)&&A(i)&&A(l).setDOMContent(A(i))}),oc(()=>{A(l)&&(A(l).remove(),ve(l,void 0)),t.map&&E&&(n?(t.map.off(e.trigger,n.id,y),t.map.off("mouseenter",n.id,x),t.map.off("mouseleave",n.id,T)):t.map.off(e.trigger,y))});var k=it(),F=xe(k);{var D=N=>{var B=Y5(),V=Be(B);{var U=j=>{var J=it(),oe=xe(J);fr(oe,()=>e.children,()=>A(u),()=>p,()=>A(a)),K(j,J)};et(V,j=>{e.children&&j(U)})}ke(B),Cs(B,j=>ve(i,j),()=>A(i)),ct(()=>Di(B,1,rl(e.class))),K(N,B)};et(F,N=>{A(l)&&A(u)&&N(D)})}K(r,k),Ut()}const Wc=(r,e=Cr,t=Cr,n=Cr)=>{$0(r,{children:(i,l)=>{q0(i,{children:(u,a)=>{var p=it(),y=xe(p);jn(y,17,()=>Object.entries(n()[0].properties),Hi,(x,T)=>{let E=()=>A(T)[0],k=()=>A(T)[1];Xf(x,{children:(F,D)=>{var N=J5(),B=xe(N);xo(B,{children:(U,j)=>{sn();var J=jr();ct(()=>vt(J,E())),K(U,J)},$$slots:{default:!0}});var V=we(B,2);xo(V,{children:(U,j)=>{var J=it(),oe=xe(J);{var le=Ie=>{var Ue=K5(),De=Be(Ue,!0);ke(Ue),ct(()=>{ls(Ue,"href",`https://www.openstreetmap.org/node/${k()??""}`),vt(De,k())}),K(Ie,Ue)},Ce=(Ie,Ue)=>{{var De=ze=>{var Ne=G5(),ot=Be(Ne,!0);ke(Ne),ct(()=>{ls(Ne,"href",`https://www.openstreetmap.org/way/${k()??""}`),vt(ot,k())}),K(ze,Ne)},pe=ze=>{var Ne=jr();ct(()=>vt(Ne,k())),K(ze,Ne)};et(Ie,ze=>{E()==="osm_way_id"?ze(De):ze(pe,!1)},Ue)}};et(oe,Ie=>{E()==="osm_node_id"?Ie(le):Ie(Ce,!1)})}K(U,J)},$$slots:{default:!0}}),K(F,N)},$$slots:{default:!0}})}),K(u,p)},$$slots:{default:!0}})},$$slots:{default:!0}})};var K5=Ve('<a class="underline bold text-blue-400" target="_blank"> </a>'),G5=Ve('<a class="underline bold text-blue-400" target="_blank"> </a>'),J5=Ve("<!> <!>",1),Q5=Ve("<!> <!> <!>",1),eU=Ve("<!> <!> <!>",1),tU=Ve("<!> <!>",1),rU=Ve('<!> <div class="flex justify-between gap-4"><!> <!> <!></div>',1),nU=Ve('<div class="w-full flex justify-between bg-muted items-center"><h2 class="text-lg ml-2 font-bold"> <span class="ml-2 text-sm text-muted-foreground"> </span></h2> <!></div> <!>',1),iU=Ve("<!> <!>",1),sU=Ve("<!> <!>",1),oU=Ve("<!> <!> <!> <!> <!>",1),aU=Ve(' <br/> <span class="text-xs text-muted-foreground font-mono"> </span>',1),lU=Ve("<!> <!>",1),cU=Ve("<!> <!>",1),uU=Ve("<!> <!> <!> <!> <!>",1),hU=Ve("<!> <!>",1),dU=Ve('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"> <span class="text-xs text-muted-foreground font-mono"> </span> <span class="text-sm text-muted-foreground"> </span></h2> <!></div> <!>',1),fU=Ve("<!> <!>",1),pU=Ve("<!> <!> <!> <!>",1),gU=Ve("<!> <!>",1),mU=Ve("<!> <!> <!>",1),_U=Ve("<!> <!>",1),yU=Ve("<!> <!> <!> <!> <!> <!> <!> <!>",1),vU=Ve("<!>  <!> <!>",1);function bU(r,e){zt(e,!0);const t=rI.getConfig().baseUrl,n=async(Qe,pt)=>await(await fetch(`${t}${Qe}`,{method:"POST",mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify(pt)})).json(),i=async Qe=>await(await fetch(`${t}${Qe}`,{method:"GET",mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"}})).json(),l=Qe=>({lat:Qe.match.lat,lng:Qe.match.lon,level:Qe.match.level??0}),u=async Qe=>await n("/api/route",Qe),a=async Qe=>await n("/api/matches",Qe.toArray().flat()),p=async Qe=>{const pt=Qe.getSouthWest(),_t=Qe.getNorthEast();return await i(`/api/debug/flex?min=${pt.lat},${pt.lng}&max=${_t.lat},${_t.lng}`)},y=async Qe=>await n("/api/elevators",Qe.toArray().flat()),x=async Qe=>(console.log(JSON.stringify(Qe)),await n("/api/update_elevator",Qe)),T=async(Qe,pt)=>await n("/api/graph",{level:pt,waypoints:Qe.toArray().flat()});let E=Pt(!1),k=Pt(void 0),F=Re(()=>A(k)&&e.bounds&&A(E)?RM({query:{id:A(k)}}).then(Qe=>Qe.data):void 0),D=Re(()=>e.bounds&&A(E)&&e.zoom>15?a(wi.LngLatBounds.convert(e.bounds)):void 0),N=Re(()=>e.bounds&&A(E)?p(wi.LngLatBounds.convert(e.bounds)):void 0);const B=Qe=>({...Qe,outOfService:JSON.parse(Qe.outOfService).map(([pt,_t])=>[new Date(pt),new Date(_t)])});let V=Pt(null),U=Pt(null);Xr(()=>{A(E)&&e.bounds&&e.zoom>15?(T(wi.LngLatBounds.convert(e.bounds),e.level).then(Qe=>{ve(V,Qe,!0)}),y(wi.LngLatBounds.convert(e.bounds)).then(Qe=>{ve(U,Qe,!0)})):ve(V,null)});let j=Pt(void 0),J=Pt(void 0),oe=Pt(void 0),le=Re(()=>{var Qe,pt,_t,Lt,Ht,ar;return(pt=(Qe=A(J))==null?void 0:Qe.match)!=null&&pt.lat&&((_t=A(J))!=null&&_t.match.lon)&&((Ht=(Lt=A(oe))==null?void 0:Lt.match)!=null&&Ht.lat)&&((ar=A(oe))!=null&&ar.match.lon)&&A(j)?u({start:l(A(J)),destination:l(A(oe)),profile:A(j),direction:"forward"}):void 0}),Ce=Pt(null),Ie=Pt(null);var Ue=vU(),De=xe(Ue);const pe=Re(()=>A(E)?"default":"outline");Bn(De,{size:"icon",get variant(){return A(pe)},onclick:()=>{ve(E,!A(E))},children:(Qe,pt)=>{j5(Qe,{size:"icon",class:"h-[1.2rem] w-[1.2rem]"})},$$slots:{default:!0}});var ze=we(De,2);{var Ne=Qe=>{wo(Qe,{position:"bottom-right",children:(pt,_t)=>{var Lt=it(),Ht=xe(Lt);Tr(Ht,()=>oa,(ar,Tt)=>{Tt(ar,{class:"min-w-[550px] mb-4",children:(Sr,Et)=>{var Or=nU(),ir=xe(Or),vr=Be(ir),ur=Be(vr),kr=we(ur),nn=Be(kr,!0);ke(kr),ke(vr);var pr=we(vr,2);Bn(pr,{variant:"ghost",onclick:()=>ve(Ie,null),children:(Nr,mt)=>{tp(Nr,{})},$$slots:{default:!0}}),ke(ir);var Hr=we(ir,2);Tr(Hr,()=>a6,(Nr,mt)=>{mt(Nr,{class:"flex flex-col gap-6",children:(Te,Qt)=>{var Ct=rU(),yt=xe(Ct);$0(yt,{children:(Zt,Ar)=>{var Fr=tU(),Jr=xe(Fr);DS(Jr,{children:(zr,Mr)=>{Xf(zr,{children:(Zr,xn)=>{var Ot=Q5(),qe=xe(Ot);ta(qe,{class:"font-semibold",children:(xt,at)=>{sn();var Dt=jr("Not available from");K(xt,Dt)},$$slots:{default:!0}});var $e=we(qe,2);ta($e,{class:"font-semibold",children:(xt,at)=>{sn();var Dt=jr("to");K(xt,Dt)},$$slots:{default:!0}});var dt=we($e,2);ta(dt,{}),K(Zr,Ot)},$$slots:{default:!0}})},$$slots:{default:!0}});var bt=we(Jr,2);q0(bt,{children:(zr,Mr)=>{var Zr=it(),xn=xe(Zr);{var Ot=qe=>{var $e=it(),dt=xe($e);jn(dt,17,()=>A(Ie).outOfService,Hi,(xt,at,Dt)=>{Xf(xt,{children:(br,tn)=>{var pn=eU(),de=xe(pn);xo(de,{children:(te,he)=>{Fy(te,{get value(){return A(Ie).outOfService[Dt][0]},set value(Se){A(Ie).outOfService[Dt][0]=Se}})},$$slots:{default:!0}});var X=we(de,2);xo(X,{children:(te,he)=>{Fy(te,{get value(){return A(Ie).outOfService[Dt][1]},set value(Se){A(Ie).outOfService[Dt][1]=Se}})},$$slots:{default:!0}});var Y=we(X,2);xo(Y,{children:(te,he)=>{Bn(te,{variant:"outline",onclick:()=>A(Ie).outOfService.splice(Dt,1),children:(Se,Oe)=>{tp(Se,{})},$$slots:{default:!0}})},$$slots:{default:!0}}),K(br,pn)},$$slots:{default:!0}})}),K(qe,$e)};et(xn,qe=>{A(Ie).outOfService&&qe(Ot)})}K(zr,Zr)},$$slots:{default:!0}}),K(Zt,Fr)},$$slots:{default:!0}});var sr=we(yt,2),Br=Be(sr);Bn(Br,{variant:"outline",onclick:()=>A(Ie).outOfService.push([new Date,new Date]),children:(Zt,Ar)=>{sn();var Fr=jr("Add Maintainance");K(Zt,Fr)},$$slots:{default:!0}});var $r=we(Br,2);Bn($r,{class:"w-48",variant:"outline",onclick:()=>{ve(Ce,x(A(Ie)),!0)},children:(Zt,Ar)=>{var Fr=it(),Jr=xe(Fr);{var bt=Mr=>{var Zr=it(),xn=xe(Zr);Xl(xn,()=>A(Ce),Ot=>{wp(Ot,{class:"animate-spin w-4 h-4"})},(Ot,qe)=>{var $e=jr("Update");K(Ot,$e)}),K(Mr,Zr)},zr=Mr=>{var Zr=jr("Update");K(Mr,Zr)};et(Jr,Mr=>{A(Ce)!=null?Mr(bt):Mr(zr,!1)})}K(Zt,Fr)},$$slots:{default:!0}});var Jt=we($r,2);Bn(Jt,{onclick:()=>{ve(Ce,x({id:A(Ie).id,status:A(Ie).status==="ACTIVE"?"INACTIVE":"ACTIVE"}),!0)},children:(Zt,Ar)=>{var Fr=it(),Jr=xe(Fr);{var bt=Mr=>{var Zr=jr("DEACTIVATE");K(Mr,Zr)},zr=Mr=>{var Zr=jr("ACTIVATE");K(Mr,Zr)};et(Jr,Mr=>{A(Ie).status==="ACTIVE"?Mr(bt):Mr(zr,!1)})}K(Zt,Fr)},$$slots:{default:!0}}),ke(sr),K(Te,Ct)},$$slots:{default:!0}})}),ct(()=>{vt(ur,`Fahrstuhl ${A(Ie).desc??""} `),vt(nn,A(Ie).id)}),K(Sr,Or)},$$slots:{default:!0}})}),K(pt,Lt)},$$slots:{default:!0}})};et(ze,Qe=>{A(Ie)&&Qe(Ne)})}var ot=we(ze,2);{var At=Qe=>{var pt=yU(),_t=xe(pt);{var Lt=mt=>{var Te=it(),Qt=xe(Te);Xl(Qt,()=>A(F),null,(Ct,yt)=>{var sr=it(),Br=xe(sr);{var $r=Jt=>{wo(Jt,{position:"bottom-right",children:(Zt,Ar)=>{var Fr=it(),Jr=xe(Fr);Tr(Jr,()=>oa,(bt,zr)=>{zr(bt,{class:"w-[600px] h-[500px] overflow-y-auto bg-background rounded-lg",children:(Mr,Zr)=>{var xn=dU(),Ot=xe(xn),qe=Be(Ot),$e=Be(qe),dt=we($e),xt=Be(dt,!0);ke(dt);var at=we(dt,2),Dt=Be(at);ke(at),ke(qe);var br=we(qe,2);Bn(br,{variant:"ghost",onclick:()=>{ve(k,void 0)},children:(pn,de)=>{tp(pn,{})},$$slots:{default:!0}}),ke(Ot);var tn=we(Ot,2);$0(tn,{children:(pn,de)=>{var X=hU(),Y=xe(X);DS(Y,{children:(he,Se)=>{Xf(he,{children:(Oe,He)=>{var ye=oU(),We=xe(ye);ta(We,{class:"text-center",children:(wr,gr)=>{sn();var Yr=jr("Station");K(wr,Yr)},$$slots:{default:!0}});var ft=we(We,2);ta(ft,{class:"text-center",children:(wr,gr)=>{sn();var Yr=jr("Default");K(wr,Yr)},$$slots:{default:!0}});var Je=we(ft,2);{var kt=wr=>{var gr=iU(),Yr=xe(gr);ta(Yr,{class:"text-center",children:(Wt,Rr)=>{sn();var Dr=jr("Foot");K(Wt,Dr)},$$slots:{default:!0}});var Pr=we(Yr,2);ta(Pr,{class:"text-center",children:(Wt,Rr)=>{sn();var Dr=jr("Foot Routed");K(Wt,Dr)},$$slots:{default:!0}}),K(wr,gr)};et(Je,wr=>{A(yt).hasFootTransfers&&wr(kt)})}var Vt=we(Je,2);{var Kt=wr=>{var gr=sU(),Yr=xe(gr);ta(Yr,{class:"text-center",children:(Wt,Rr)=>{sn();var Dr=jr("Wheelchair");K(Wt,Dr)},$$slots:{default:!0}});var Pr=we(Yr,2);ta(Pr,{class:"text-center",children:(Wt,Rr)=>{sn();var Dr=jr("Wheelchair Routed");K(Wt,Dr)},$$slots:{default:!0}}),K(wr,gr)};et(Vt,wr=>{A(yt).hasWheelchairTransfers&&wr(Kt)})}var Wr=we(Vt,2);{var Er=wr=>{ta(wr,{class:"text-center",children:(gr,Yr)=>{sn();var Pr=jr("Car");K(gr,Pr)},$$slots:{default:!0}})};et(Wr,wr=>{A(yt).hasCarTransfers&&wr(Er)})}K(Oe,ye)},$$slots:{default:!0}})},$$slots:{default:!0}});var te=we(Y,2);q0(te,{children:(he,Se)=>{var Oe=it(),He=xe(Oe);jn(He,17,()=>A(yt).transfers,Hi,(ye,We)=>{Xf(ye,{children:(ft,Je)=>{var kt=uU(),Vt=xe(kt);xo(Vt,{children:(Wt,Rr)=>{sn();var Dr=aU(),It=xe(Dr),hn=we(It,3),Ur=Be(hn,!0);ke(hn),ct(()=>{vt(It,`${A(We).to.name??""} `),vt(Ur,A(We).to.stopId)}),K(Wt,Dr)},$$slots:{default:!0}});var Kt=we(Vt,2);xo(Kt,{children:(Wt,Rr)=>{var Dr=it(),It=xe(Dr);{var hn=Ur=>{Bn(Ur,{variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"foot")},children:(Qr,qr)=>{sn();var In=jr();ct(()=>vt(In,A(We).default)),K(Qr,In)},$$slots:{default:!0}})};et(It,Ur=>{A(We).default!==void 0&&Ur(hn)})}K(Wt,Dr)},$$slots:{default:!0}});var Wr=we(Kt,2);{var Er=Wt=>{var Rr=lU(),Dr=xe(Rr);xo(Dr,{children:(hn,Ur)=>{var Qr=it(),qr=xe(Qr);{var In=dn=>{Bn(dn,{variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"foot")},children:(wn,Cn)=>{sn();var vi=jr();ct(()=>vt(vi,A(We).foot)),K(wn,vi)},$$slots:{default:!0}})};et(qr,dn=>{A(We).foot!==void 0&&dn(In)})}K(hn,Qr)},$$slots:{default:!0}});var It=we(Dr,2);xo(It,{children:(hn,Ur)=>{var Qr=it(),qr=xe(Qr);{var In=dn=>{Bn(dn,{variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"foot")},children:(wn,Cn)=>{sn();var vi=jr();ct(()=>vt(vi,A(We).footRouted)),K(wn,vi)},$$slots:{default:!0}})};et(qr,dn=>{A(We).footRouted!==void 0&&dn(In)})}K(hn,Qr)},$$slots:{default:!0}}),K(Wt,Rr)};et(Wr,Wt=>{A(yt).hasFootTransfers&&Wt(Er)})}var wr=we(Wr,2);{var gr=Wt=>{var Rr=cU(),Dr=xe(Rr);xo(Dr,{children:(hn,Ur)=>{var Qr=it(),qr=xe(Qr);{var In=dn=>{const wn=Re(()=>A(We).wheelchairUsesElevator?"text-red-500":"text-green-500");Bn(dn,{get class(){return A(wn)},variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"wheelchair")},children:(Cn,vi)=>{sn();var Sn=jr();ct(()=>vt(Sn,A(We).wheelchair)),K(Cn,Sn)},$$slots:{default:!0}})};et(qr,dn=>{A(We).wheelchair!==void 0&&dn(In)})}K(hn,Qr)},$$slots:{default:!0}});var It=we(Dr,2);xo(It,{children:(hn,Ur)=>{var Qr=it(),qr=xe(Qr);{var In=dn=>{const wn=Re(()=>A(We).wheelchairUsesElevator?"text-red-500":"text-green-500");Bn(dn,{get class(){return A(wn)},variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"wheelchair")},children:(Cn,vi)=>{sn();var Sn=jr();ct(()=>vt(Sn,A(We).wheelchairRouted)),K(Cn,Sn)},$$slots:{default:!0}})};et(qr,dn=>{A(We).wheelchairRouted!==void 0&&dn(In)})}K(hn,Qr)},$$slots:{default:!0}}),K(Wt,Rr)};et(wr,Wt=>{A(yt).hasWheelchairTransfers&&Wt(gr)})}var Yr=we(wr,2);{var Pr=Wt=>{xo(Wt,{children:(Rr,Dr)=>{var It=it(),hn=xe(It);{var Ur=Qr=>{Bn(Qr,{variant:"outline",onclick:()=>{ve(J,Oi(A(yt).place,A(yt).place.level)),ve(oe,Oi(A(We).to,A(We).to.level)),ve(j,"car")},children:(qr,In)=>{sn();var dn=jr();ct(()=>vt(dn,A(We).car)),K(qr,dn)},$$slots:{default:!0}})};et(hn,Qr=>{A(We).car!==void 0&&Qr(Ur)})}K(Rr,It)},$$slots:{default:!0}})};et(Yr,Wt=>{A(yt).hasCarTransfers&&Wt(Pr)})}K(ft,kt)},$$slots:{default:!0}})}),K(he,Oe)},$$slots:{default:!0}}),K(pn,X)},$$slots:{default:!0}}),ct(()=>{vt($e,`${A(yt).place.name??""}
								${A(yt).place.track??""} `),vt(xt,A(yt).place.stopId),vt(Dt,`Level: ${A(yt).place.level??""}`)}),K(Mr,xn)},$$slots:{default:!0}})}),K(Zt,Fr)},$$slots:{default:!0}})};et(Br,Jt=>{A(yt)&&Jt($r)})}K(Ct,sr)}),K(mt,Te)};et(_t,mt=>{A(F)&&mt(Lt)})}var Ht=we(_t,2);{var ar=mt=>{var Te=it(),Qt=xe(Te);Xl(Qt,()=>A(D),null,(Ct,yt)=>{ua(Ct,{id:"matches",get data(){return A(yt)},children:(sr,Br)=>{var $r=fU(),Jt=xe($r);Ci(Jt,{onclick:Ar=>{const Fr=Ar.features[0].properties;ve(k,Fr.id,!0)},id:"matches",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","type"],"location","#34ebde","#fa921b"],"circle-radius":5},children:(Ar,Fr)=>{Hl(Ar,{trigger:"click",children:Wc})},$$slots:{default:!0}});var Zt=we(Jt,2);Ci(Zt,{id:"match",type:"line",filter:["all",["==","type","match"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ff00","line-width":3},children:(Ar,Fr)=>{Hl(Ar,{trigger:"click",children:Wc})},$$slots:{default:!0}}),K(sr,$r)},$$slots:{default:!0}})}),K(mt,Te)};et(Ht,mt=>{A(D)&&mt(ar)})}var Tt=we(Ht,2);{var Sr=mt=>{var Te=it(),Qt=xe(Te);Xl(Qt,()=>A(N),null,(Ct,yt)=>{ua(Ct,{id:"flex",get data(){return A(yt)},children:(sr,Br)=>{var $r=pU(),Jt=xe($r);Ci(Jt,{onclick:Jr=>{const bt=Jr.features[0].properties;ve(k,bt.id,!0)},id:"flex-location-groups",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":"#00ff00","circle-radius":5},children:(Jr,bt)=>{Hl(Jr,{trigger:"click",children:Wc})},$$slots:{default:!0}});var Zt=we(Jt,2);Ci(Zt,{id:"flex-areas",type:"fill",layout:{},filter:["literal",!0],paint:{"fill-color":"#088","fill-opacity":.4,"fill-outline-color":"#000"}});var Ar=we(Zt,2);Ci(Ar,{id:"flex-areas-outline",type:"line",layout:{},filter:["literal",!0],paint:{"line-color":"#000","line-width":2}});var Fr=we(Ar,2);Ci(Fr,{id:"flex-areas-labels",type:"symbol",layout:{"symbol-placement":"point","text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":16},filter:["literal",!0],paint:{"text-halo-width":12,"text-halo-color":"#fff","text-color":"#f00"}}),K(sr,$r)},$$slots:{default:!0}})}),K(mt,Te)};et(Tt,mt=>{A(N)&&mt(Sr)})}var Et=we(Tt,2);{var Or=mt=>{var Te=it(),Qt=xe(Te);Xl(Qt,()=>A(le),null,(Ct,yt)=>{var sr=it(),Br=xe(sr);{var $r=Jt=>{ua(Jt,{id:"route",get data(){return A(yt)},children:(Zt,Ar)=>{var Fr=gU(),Jr=xe(Fr);const bt=Re(()=>["any",["!has","level"],["==","level",e.level]]);Ci(Jr,{id:"path-outline",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return A(bt)},paint:{"line-color":"#cfa900","line-width":7.5,"line-opacity":.8}});var zr=we(Jr,2);const Mr=Re(()=>["any",["!has","level"],["==","level",e.level]]);Ci(zr,{id:"path",type:"line",layout:{"line-join":"round","line-cap":"round"},get filter(){return A(Mr)},paint:{"line-color":"#fccf03","line-width":5,"line-opacity":.8}}),K(Zt,Fr)},$$slots:{default:!0}})};et(Br,Jt=>{A(yt).type=="FeatureCollection"&&Jt($r)})}K(Ct,sr)}),K(mt,Te)};et(Et,mt=>{A(le)&&mt(Or)})}var ir=we(Et,2);{var vr=mt=>{ua(mt,{id:"graph",get data(){return A(V)},children:(Te,Qt)=>{var Ct=mU(),yt=xe(Ct);const sr=Re(()=>["all",["==","type","geometry"],["any",["!has","level"],["==","level",e.level]]]);Ci(yt,{id:"graph-geometry",type:"line",get filter(){return A(sr)},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#e55e5e","line-width":3,"line-opacity":1},children:(Zt,Ar)=>{Hl(Zt,{trigger:"click",children:Wc})},$$slots:{default:!0}});var Br=we(yt,2);const $r=Re(()=>["all",["==","type","edge"],["any",["!has","level"],["==","level",e.level]]]);Ci(Br,{id:"graph-edge",type:"line",get filter(){return A($r)},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#a300d9","line-width":3},children:(Zt,Ar)=>{Hl(Zt,{trigger:"click",children:Wc})},$$slots:{default:!0}});var Jt=we(Br,2);Ci(Jt,{id:"graph-node",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","label"],"unreachable","#ff1150","#11ffaf"],"circle-radius":5},children:(Zt,Ar)=>{Hl(Zt,{trigger:"click",children:Wc})},$$slots:{default:!0}}),K(Te,Ct)},$$slots:{default:!0}})};et(ir,mt=>{A(V)!=null&&mt(vr)})}var ur=we(ir,2);{var kr=mt=>{ua(mt,{id:"elevators",get data(){return A(U)},children:(Te,Qt)=>{var Ct=_U(),yt=xe(Ct);Ci(yt,{id:"elevators",type:"circle",filter:["all",["==","$type","Point"]],layout:{},paint:{"circle-color":["match",["get","status"],"ACTIVE","#ffff00","#ff00ff"],"circle-radius":8},onclick:Br=>{ve(Ie,B(Br.features[0].properties),!0)}});var sr=we(yt,2);Ci(sr,{id:"elevators-match",type:"line",filter:["all",["==","type","match"]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00ff00","line-width":3},children:(Br,$r)=>{Hl(Br,{trigger:"click",children:Wc})},$$slots:{default:!0}}),K(Te,Ct)},$$slots:{default:!0}})};et(ur,mt=>{A(U)&&mt(kr)})}var nn=we(ur,2);{var pr=mt=>{_h(mt,{color:"magenta",draggable:!1,get location(){return A(J)}})};et(nn,mt=>{A(J)&&mt(pr)})}var Hr=we(nn,2);{var Nr=mt=>{_h(mt,{color:"yellow",draggable:!1,get location(){return A(oe)}})};et(Hr,mt=>{A(oe)&&mt(Nr)})}K(Qe,pt)};et(ot,Qe=>{A(E)&&Qe(At)})}return K(r,Ue),Ut({getGraph:T})}function hc(r){const e=wi.LngLat.convert(r);return`${e.lat},${e.lng}`}const _y=17;var xU=Ve("<!> ",1);function wU(r,e){zt(e,!0);let t=fe(e,"level",15),n=Pt("level-0"),i=Pt(yn([]));Xr(()=>{t(Number(A(n).substring(6)))}),Xr(()=>{if(e.bounds&&e.zoom&&e.zoom>_y){const p=wi.LngLatBounds.convert(e.bounds),y=hc(p.getNorthWest()),x=hc(p.getSouthEast());kM({query:{min:y,max:x}}).then(T=>{var E;ve(i,((E=T.data)==null?void 0:E.filter(k=>Number.isInteger(k)).map(k=>String(k)))??[],!0)})}else ve(i,[],!0),t(0)});var l=it(),u=xe(l);{var a=p=>{wo(p,{position:"top-right",class:"mb-5",children:(y,x)=>{f1(y,{class:"flex flex-col items-end space-y-1",get value(){return A(n)},set value(T){ve(n,T,!0)},children:(T,E)=>{var k=it(),F=xe(k);jn(F,16,()=>A(i),D=>D,(D,N)=>{const B=Re(()=>`level-${N}`);xp(D,{get for(){return A(B)},class:"inline-flex items-center justify-center font-bold rounded-md border-2 border-muted bg-popover h-9 w-9 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(V,U)=>{var j=xU(),J=xe(j);const oe=Re(()=>`level-${N}`),le=Re(()=>`level-${N}`),Ce=Re(()=>`level-${N}`);vp(J,{get value(){return A(oe)},get id(){return A(le)},class:"sr-only",get"aria-label"(){return A(Ce)}});var Ie=we(J);ct(()=>vt(Ie,` ${N??""}`)),K(V,j)},$$slots:{default:!0}})}),K(T,k)},$$slots:{default:!0}})},$$slots:{default:!0}})};et(u,p=>{A(i).length>1&&p(a)})}K(r,l),Ut()}var TU=Ve(`<div><div class="mx-auto my-5 relative before:content-[''] before:absolute before:inset-[-20px] before:inset-x-[-50vw] flex items-center justify-center"><div><!></div> <div></div></div> <div><!></div></div>`);function SU(r,e){zt(e,!0);let t=fe(e,"ref",15,null),n=fe(e,"showMap",15),i=an(e,["$$slots","$$events","$$legacy","ref","showMap","class","children"]),l=Pt(!0);const u=.7,a=0;let p=0,y=0,x=!1,T=!1,E;Dm(()=>FC(E)),Xr(()=>i6(E));const k=pe=>{for(;pe&&pe!==document.documentElement;){const Ne=window.getComputedStyle(pe).overflowY;if(Ne!=="visible"&&Ne!=="hidden"&&pe.scrollHeight>pe.clientHeight)return pe;pe=pe.parentElement}return null},F=pe=>{const ze=T?null:pe.target,Ne=ze?k(ze):null;p=pe.touches[0].clientY,x=A(l)&&Ne?Ne.scrollTop===0:!0},D=pe=>{if(!x)return;y=pe.touches[0].clientY;const ze=y-p,Ne=A(l)?0:window.innerHeight*u;A(l)&&ze<0||!A(l)&&ze>0||(n(!0),t(t().style.transition="none",!0),t(t().style.transform=`translateY(${Ne+ze}px)`,!0))},N=pe=>{if(!x)return;x=!1,t(t().style.transition="",!0);const ze=pe.changedTouches[0].clientY-p;(70<ze||ze==0&&T)&&A(l)?(t(t().style.transform=`translateY(${window.innerHeight*u}px)`,!0),ve(l,!1)):(ze<-70||ze==0&&T)&&!A(l)?(t(t().style.transform=`translateY(${a}px)`,!0),ve(l,!0)):t(t().style.transform=`translateY(${A(l)?a:window.innerHeight*u}px)`,!0),T=!1};var B=TU();let V;var U=Be(B);U.__touchstart=pe=>{T=!0,n(!0),F(pe)};var j=Be(U);let J;var oe=Be(j);Bm(oe,{class:"size-12 text-gray-300 scale-x-150",strokeWidth:3.5}),ke(j);var le=we(j,2);let Ce;ke(U);var Ie=we(U,2);let Ue;var De=Be(Ie);fr(De,()=>e.children??Cr),ke(Ie),Cs(Ie,pe=>E=pe,()=>E),ke(B),Cs(B,pe=>t(pe),()=>t()),ct((pe,ze,Ne,ot)=>{V=Tn(B,V,{class:pe,...i,ontouchstart:F,ontouchmove:D,ontouchend:N}),J=Di(j,1,"absolute transition-all duration-200",null,J,ze),Ce=Di(le,1,"w-14 h-2 bg-gray-300 rounded-full transition-all duration-200",null,Ce,Ne),Ue=Di(Ie,1,"",null,Ue,ot)},[()=>kn("bg-card text-card-foreground rounded-xl pb-5 h-full border shadow max-w-full transition-transform duration-200 ease-out",e.class),()=>({"opacity-0":!A(l),"opacity-100":A(l)}),()=>({"opacity-0":A(l),"opacity-100":!A(l)}),()=>({"overflow-auto":A(l)})]),K(r,B),Ut()}pc(["touchstart"]);var AU=(r,e,t,n,i)=>{A(e).splice(0,0,t(Bw({query:{...A(n),pageCursor:A(i).previousPageCursor}})))},EU=Ve('<div class="col-span-full w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white font-bold text-sm border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),IU=Ve('<span class="mt-1 text-nowrap px-1 border text-xs rounded-xl"> </span>'),CU=Ve('<div class="mt-2"><!></div>'),PU=Ve('<div class="flex items-center text-destructive text-sm"><!> <span class="ml-1 leading-none"> </span></div>'),RU=Ve('<div><div class="flex col justify-between"><!> <div class="mx-4"><!> <!></div></div></div> <div class="w-full"><div class="flex items-start justify-between text-base"><div class="flex items-start gap-1"><!> <!></div> <!></div> <!> <!></div> <div class="border col-span-full"></div>',1),kU=Ve('<div class="col-span-full w-full flex items-center justify-center"><!></div>'),MU=(r,e,t,n,i)=>{A(e).push(t(Bw({query:{...A(n),pageCursor:A(i).nextPageCursor}})))},OU=Ve('<div class="col-span-full w-full flex justify-between items-center space-x-4"><div class="border-t w-full h-0"></div> <button class="px-2 py-1 bg-blue-600 hover:!bg-blue-700 text-white text-sm font-bold border rounded-lg text-nowrap"> </button> <div class="border-t w-full h-0"></div></div>'),DU=Ve("<!> <!> <!> <!>",1),NU=Ve('<div class="col-span-full w-full flex items-center justify-center"><!></div>'),FU=Ve('<div class="flex items-center justify-center"><!></div>'),BU=Ve('<div class="gap-y-3 mb-1 text-base grid grid-cols-[auto_1fr] items-start content-start"><div class="col-span-full w-full flex items-center justify-center"><!></div> <!></div>');function LU(r,e){zt(e,!0);let t=fe(e,"stopNameFromResponse",15),n=fe(e,"stop",15),i=Re(()=>({stopId:e.stopId,time:e.time.toISOString(),arriveBy:e.arriveBy,n:10,exactRadius:!1,radius:200,language:[fa]})),l=Pt(yn([]));Xr(()=>{ve(l,[u(Bw({query:A(i)}))],!0)});const u=T=>T.then(E=>{var F,D,N,B,V;if(E.error)throw console.log(E.error),new Error("HTTP "+((F=E.response)==null?void 0:F.status));t(((N=(D=E.data)==null?void 0:D.place)==null?void 0:N.name)||"");let k=(B=E.data)==null?void 0:B.place;return n(Oi(wi.LngLat.convert([k.lon,k.lat]))),(V=e.stopMarker)==null||V.setLngLat(n().match),E.data});var a=BU(),p=Be(a),y=Be(p);Bn(y,{class:"font-bold",variant:"outline",onclick:()=>{fd(e.stopName,e.stopId,e.time,!e.arriveBy)},children:(T,E)=>{var k=it(),F=xe(k);{var D=B=>{var V=jr();ct(()=>vt(V,Rt.switchToDepartures)),K(B,V)},N=B=>{var V=jr();ct(()=>vt(V,Rt.switchToArrivals)),K(B,V)};et(F,B=>{e.arriveBy?B(D):B(N,!1)})}K(T,k)},$$slots:{default:!0}}),ke(p);var x=we(p,2);jn(x,17,()=>A(l),Hi,(T,E,k)=>{var F=it(),D=xe(F);Xl(D,()=>A(E),N=>{var B=FU(),V=Be(B);wp(V,{class:"animate-spin w-12 h-12 m-20"}),ke(B),K(N,B)},(N,B)=>{var V=DU(),U=xe(V);{var j=Ue=>{var De=EU(),pe=we(Be(De),2);pe.__click=[AU,l,u,i,B];var ze=Be(pe,!0);ke(pe),sn(2),ke(De),ct(()=>vt(ze,Rt.earlier)),K(Ue,De)};et(U,Ue=>{k===0&&A(B).previousPageCursor.length&&Ue(j)})}var J=we(U,2);jn(J,17,()=>A(B).stopTimes,Hi,(Ue,De)=>{var pe=RU();const ze=Re(()=>e.arriveBy?A(De).place.arrival:A(De).place.departure),Ne=Re(()=>e.arriveBy?A(De).place.scheduledArrival:A(De).place.scheduledDeparture);var ot=xe(pe),At=Be(ot),Qe=Be(At);W0(Qe,{class:"max-w-20 text-ellipsis overflow-hidden",get l(){return A(De)},onClickTrip:fp});var pt=we(Qe,2),_t=Be(pt);const Lt=Re(()=>e.time.toISOString());uc(_t,{variant:"schedule",get timeZone(){return A(De).place.tz},get isRealtime(){return A(De).realTime},get timestamp(){return A(ze)},get scheduledTimestamp(){return A(Ne)},get queriedTime(){return A(Lt)},get arriveBy(){return e.arriveBy}});var Ht=we(_t,2);uc(Ht,{variant:"realtime",get timeZone(){return A(De).place.tz},get isRealtime(){return A(De).realTime},get timestamp(){return A(ze)},get scheduledTimestamp(){return A(Ne)},get arriveBy(){return e.arriveBy}}),ke(pt),ke(At),ke(ot);var ar=we(ot,2),Tt=Be(ar),Sr=Be(Tt),Et=Be(Sr);g1(Et,{class:"mt-1 shrink-0 stroke-muted-foreground h-4 w-4"});var Or=we(Et),ir=we(Or);{var vr=mt=>{var Te=jr();ct(()=>vt(Te,`(${A(De).tripTo.name??""})`)),K(mt,Te)};et(ir,mt=>{(!A(De).headsign||!A(De).tripTo.name.startsWith(A(De).headsign))&&mt(vr)})}ke(Sr);var ur=we(Sr,2);{var kr=mt=>{var Te=IU(),Qt=Be(Te);ke(Te),ct(Ct=>vt(Qt,`${Ct??""}
								${A(De).place.track??""}`),[()=>BC(A(De).mode)=="Track"?Rt.trackAbr:Rt.platformAbr]),K(mt,Te)};et(ur,mt=>{A(De).place.track&&mt(kr)})}ke(Tt);var nn=we(Tt,2);{var pr=mt=>{var Te=CU(),Qt=Be(Te);const Ct=Re(()=>A(De).place.tz??"");m1(Qt,{get timeZone(){return A(Ct)},get alerts(){return A(De).place.alerts}}),ke(Te),K(mt,Te)};et(nn,mt=>{A(De).place.alerts&&mt(pr)})}var Hr=we(nn,2);{var Nr=mt=>{var Te=PU(),Qt=Be(Te);rb(Qt,{class:"stroke-destructive h-4 w-4"});var Ct=we(Qt,2),yt=Be(Ct,!0);ke(Ct),ke(Te),ct(()=>vt(yt,A(De).tripCancelled?Rt.tripCancelled:A(De).cancelled?Rt.stopCancelled:e.arriveBy?Rt.outDisallowed:Rt.inDisallowed)),K(mt,Te)};et(Hr,mt=>{A(De).pickupDropoffType=="NOT_ALLOWED"&&mt(Nr)})}ke(ar),sn(2),ct(()=>vt(Or,` ${A(De).headsign??""} `)),K(Ue,pe)});var oe=we(J,2);{var le=Ue=>{var De=kU(),pe=Be(De);ru(pe,{get e(){return Rt.noItinerariesFound}}),ke(De),K(Ue,De)};et(oe,Ue=>{A(B).stopTimes.length||Ue(le)})}var Ce=we(oe,2);{var Ie=Ue=>{var De=OU(),pe=we(Be(De),2);pe.__click=[MU,l,u,i,B];var ze=Be(pe,!0);ke(pe),sn(2),ke(De),ct(()=>vt(ze,Rt.later)),K(Ue,De)};et(Ce,Ue=>{k===A(l).length-1&&A(B).nextPageCursor.length&&Ue(Ie)})}K(N,V)},(N,B)=>{var V=NU(),U=Be(V);ru(U,{get e(){return A(B)}}),ke(V),K(N,V)}),K(T,F)}),ke(a),K(r,a),Ut()}pc(["click"]);function By(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const _1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),NS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);NS&&parseFloat(NS[1]);const J_=globalThis,oh=globalThis.process||{},zU=globalThis.navigator||{};function VC(r){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function gc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||VC()}function UU(r){return gc()?VC()?"Electron":(zU.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const jC="4.1.0";function VU(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class jU{constructor(e,t,n="sessionStorage"){this.storage=VU(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function HU(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function WU(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Ly;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ly||(Ly={}));const $U=10;function FS(r){return typeof r!="string"?r:(r=r.toUpperCase(),Ly[r]||Ly.WHITE)}function qU(r,e,t){return!gc&&typeof r=="string"&&(e&&(r=`\x1B[${FS(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${FS(t)+$U}m${r}\x1B[49m`)),r}function XU(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const l of n){const u=i[l];typeof u=="function"&&(e.find(a=>l===a)||(i[l]=u.bind(r)))}}function y1(r,e){if(!r)throw new Error("Assertion failed")}function ah(){var e,t,n;let r;if(gc()&&J_.performance)r=(t=(e=J_==null?void 0:J_.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in oh){const i=(n=oh==null?void 0:oh.hrtime)==null?void 0:n.call(oh);r=i[0]*1e3+i[1]/1e6}else r=Date.now();return r}const lh={debug:gc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ZU={enabled:!0,level:0};function ch(){}const BS={},LS={once:!0};class Lm{constructor({id:e}={id:""}){this.VERSION=jC,this._startTs=ah(),this._deltaTs=ah(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new jU(`__probe-${this.id}__`,ZU),this.timeStamp(`${this.id} started`),XU(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ah()-this._startTs).toPrecision(10))}getDelta(){return Number((ah()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,lh.warn,arguments,LS)}error(e){return this._getLogFunction(0,e,lh.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,lh.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,lh.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,lh.debug||lh.info,arguments,LS)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||ch,n&&[n],{tag:KU(t)}):ch}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ch)}group(e,t,n={collapsed:!1}){const i=zS({logLevel:e,message:t,opts:n}),{collapsed:l}=n;return i.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ch)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=HC(e)}_getLogFunction(e,t,n,i,l){if(this._shouldLog(e)){l=zS({logLevel:e,message:t,args:i,opts:l}),n=n||l.method,y1(n),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=ah();const u=l.tag||l.message;if(l.once&&u)if(!BS[u])BS[u]=ah();else return ch;return t=YU(this.id,l.message,l),n.bind(console,t,...l.args)}return ch}}Lm.VERSION=jC;function HC(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return y1(Number.isFinite(e)&&e>=0),e}function zS(r){const{logLevel:e,message:t}=r;r.logLevel=HC(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return y1(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function YU(r,e,t){if(typeof e=="string"){const n=t.time?WU(HU(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=qU(e,t.color,t.background)}return e}function KU(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const jx="4.3.2",GU=jx[0]>="0"&&jx[0]<="9"?`v${jx}`:"";function JU(){const r=new Lm({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=GU,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const QU=JU();function e8(r,e){return WC(r||{},e)}function WC(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,l]of Object.entries(e))l&&typeof l=="object"&&!Array.isArray(l)?n[i]=WC(n[i]||{},e[i],t+1):n[i]=e[i];return n}const t8="latest";function r8(){var r;return(r=globalThis._loadersgl_)!=null&&r.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const n8=r8();function dc(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const nu=typeof process!="object"||String(process)!=="[object process]"||process.browser,i8=typeof window<"u"&&typeof window.orientation<"u",US=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);US&&parseFloat(US[1]);class s8{constructor(e,t){Z(this,"name");Z(this,"workerThread");Z(this,"isRunning",!0);Z(this,"result");Z(this,"_resolve",()=>{});Z(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){dc(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){dc(this.isRunning),this.isRunning=!1,this._reject(e)}}class Hx{terminate(){}}const Wx=new Map;function o8(r){dc(r.source&&!r.url||!r.source&&r.url);let e=Wx.get(r.source||r.url);return e||(r.url&&(e=a8(r.url),Wx.set(r.url,e)),r.source&&(e=$C(r.source),Wx.set(r.source,e))),dc(e),e}function a8(r){if(!r.startsWith("http"))return r;const e=l8(r);return $C(e)}function $C(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function l8(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function qC(r,e=!0,t){const n=t||new Set;if(r){if(VS(r))n.add(r);else if(VS(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)qC(r[i],e,n)}}return t===void 0?Array.from(n):[]}function VS(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const $x=()=>{};class X0{constructor(e){Z(this,"name");Z(this,"source");Z(this,"url");Z(this,"terminated",!1);Z(this,"worker");Z(this,"onMessage");Z(this,"onError");Z(this,"_loadableURL","");const{name:t,source:n,url:i}=e;dc(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=$x,this.onError=l=>console.log(l),this.worker=nu?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&nu||typeof Hx<"u"&&!nu}destroy(){this.onMessage=$x,this.onError=$x,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||qC(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=o8({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Hx(n,{eval:!1})}else if(this.source)e=new Hx(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class c8{constructor(e){Z(this,"name","unnamed");Z(this,"source");Z(this,"url");Z(this,"maxConcurrency",1);Z(this,"maxMobileConcurrency",1);Z(this,"onDebug",()=>{});Z(this,"reuseWorkers",!0);Z(this,"props",{});Z(this,"jobQueue",[]);Z(this,"idleQueue",[]);Z(this,"count",0);Z(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return X0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,l,u)=>i.done(u),n=(i,l)=>i.error(l)){const i=new Promise(l=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:l}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new s8(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!nu||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new X0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return i8?this.maxMobileConcurrency:this.maxConcurrency}}const u8={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ql=class ql{constructor(e){Z(this,"props");Z(this,"workerPools",new Map);this.props={...u8},this.setProps(e),this.workerPools=new Map}static isSupported(){return X0.isSupported()}static getWorkerFarm(e={}){return ql._workerFarm=ql._workerFarm||new ql({}),ql._workerFarm.setProps(e),ql._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let l=this.workerPools.get(t);return l||(l=new c8({name:t,source:n,url:i}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};Z(ql,"_workerFarm");let zy=ql;function h8(r,e={}){const t=e[r.id]||{},n=nu?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(nu?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let l=r.version;l==="latest"&&(l=t8);const u=l?`@${l}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${u}/dist/${n}`}return dc(i),i}function d8(r,e=n8){dc(r,"no worker provided");const t=r.version;return!(!e||!t)}function f8(r,e){return!zy.isSupported()||!nu&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function p8(r,e,t,n,i){const l=r.id,u=h8(r,t),p=zy.getWorkerFarm(t).getWorkerPool({name:l,url:u});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const y=await p.startJob("process-on-worker",g8.bind(null,i));return y.postMessage("process",{input:e,options:t,context:n}),await(await y.result).result}async function g8(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:l,options:u}=n;try{const a=await r(l,u);e.postMessage("done",{id:i,result:a})}catch(a){const p=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:p})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function m8(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let l=0;l<n.length;++l)if(n[l]!==i[l])return!1;return!0}function _8(...r){return y8(r)}function y8(r){const e=r.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),t=e.reduce((l,u)=>l+u.byteLength,0),n=new Uint8Array(t);let i=0;for(const l of e)n.set(l,i),i+=l.byteLength;return n.buffer}async function v8(r){const e=[];for await(const t of r)e.push(t);return _8(...e)}function jS(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class HS{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=jS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(jS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class nb{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof HS?i=e:i=new HS(t,n),this.stats[t]=i),i}}let b8="";const WS={};function x8(r){for(const e in WS)if(r.startsWith(e)){const t=WS[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${b8}${r}`),r}function w8(r){return r&&typeof r=="object"&&r.isBuffer}function XC(r){if(w8(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function ZC(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function T8(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const S8=r=>typeof r=="boolean",np=r=>typeof r=="function",zm=r=>r!==null&&typeof r=="object",$S=r=>zm(r)&&r.constructor==={}.constructor,A8=r=>!!r&&typeof r[Symbol.iterator]=="function",E8=r=>r&&typeof r[Symbol.asyncIterator]=="function",fu=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,pu=r=>typeof Blob<"u"&&r instanceof Blob,I8=r=>r&&typeof r=="object"&&r.isBuffer,C8=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||zm(r)&&np(r.tee)&&np(r.cancel)&&np(r.getReader),P8=r=>zm(r)&&np(r.read)&&np(r.pipe)&&S8(r.readable),YC=r=>C8(r)||P8(r);class R8 extends Error{constructor(t,n){super(t);Z(this,"reason");Z(this,"url");Z(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const k8=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,M8=/^([-\w.]+\/[-\w.+]+)/;function qS(r,e){return r.toLowerCase()===e.toLowerCase()}function O8(r){const e=M8.exec(r);return e?e[1]:r}function XS(r){const e=k8.exec(r);return e?e[1]:""}const KC=/\?.*/;function D8(r){const e=r.match(KC);return e&&e[0]}function v1(r){return r.replace(KC,"")}function N8(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function ib(r){return fu(r)?r.url:pu(r)?r.name||"":typeof r=="string"?r:""}function b1(r){if(fu(r)){const e=r,t=e.headers.get("content-type")||"",n=v1(e.url);return O8(t)||XS(n)}return pu(r)?r.type||"":typeof r=="string"?XS(r):""}function F8(r){return fu(r)?r.headers["content-length"]||-1:pu(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function GC(r){if(fu(r))return r;const e={},t=F8(r);t>=0&&(e["content-length"]=String(t));const n=ib(r),i=b1(r);i&&(e["content-type"]=i);const l=await z8(r);l&&(e["x-first-bytes"]=l),typeof r=="string"&&(r=new TextEncoder().encode(r));const u=new Response(r,{headers:e});return Object.defineProperty(u,"url",{value:n}),u}async function B8(r){if(!r.ok)throw await L8(r)}async function L8(r){const e=N8(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&(i!=null&&i.includes("application/json"))?await r.json():await r.text()}catch{}return new R8(t,n)}async function z8(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=l=>{var u;return n((u=l==null?void 0:l.target)==null?void 0:u.result)},i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${U8(t)}`}return null}function U8(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function V8(r){return!j8(r)&&!H8(r)}function j8(r){return r.startsWith("http:")||r.startsWith("https:")}function H8(r){return r.startsWith("data:")}async function ZS(r,e){var t,n;if(typeof r=="string"){const i=x8(r);return V8(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await GC(r)}const YS=new Lm({id:"loaders.gl"});class W8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class $8{constructor(){Z(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const JC={fetch:null,mimeType:void 0,nothrow:!1,log:new $8,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:_1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},q8={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function QC(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function e3(){const r=QC();return r.globalOptions=r.globalOptions||{...JC},r.globalOptions}function X8(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],Z8(r,t),K8(e,r,n)}function Z8(r,e){KS(r,null,JC,q8,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},l=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};KS(n,t.id,i,l,e)}}function KS(r,e,t,n,i){const l=e||"Top level",u=e?`${e}.`:"";for(const a in r){const p=!e&&zm(r[a]),y=a==="baseUri"&&!e,x=a==="workerUrl"&&e;if(!(a in t)&&!y&&!x){if(a in n)YS.warn(`${l} loader option '${u}${a}' no longer supported, use '${n[a]}'`)();else if(!p){const T=Y8(a,i);YS.warn(`${l} loader option '${u}${a}' not recognized. ${T}`)()}}}}function Y8(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const l in i.options){if(r===l)return`Did you mean '${i.id}.${l}'?`;const u=l.toLowerCase();(t.startsWith(u)||u.startsWith(t))&&(n=n||`Did you mean '${i.id}.${l}'?`)}return n}function K8(r,e,t){const i={...r.options||{}};return G8(i,t),i.log===null&&(i.log=new W8),GS(i,e3()),GS(i,e),i}function GS(r,e){for(const t in e)if(t in e){const n=e[t];$S(n)&&$S(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function G8(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function x1(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r==null?void 0:r.extensions)):!1}function w1(r){By(r,"null loader"),By(x1(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r!=null&&r.parseTextSync||r!=null&&r.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const t3=()=>{const r=QC();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function J8(r){const e=t3();r=Array.isArray(r)?r:[r];for(const t of r){const n=w1(t);e.find(i=>n===i)||e.unshift(n)}}function Q8(){return t3()}const eV=/\.([^.]+)$/;async function tV(r,e=[],t,n){if(!r3(r))return null;let i=JS(r,e,{...t,nothrow:!0},n);if(i)return i;if(pu(r)&&(r=await r.slice(0,10).arrayBuffer(),i=JS(r,e,t,n)),!i&&!(t!=null&&t.nothrow))throw new Error(n3(r));return i}function JS(r,e=[],t,n){if(!r3(r))return null;if(e&&!Array.isArray(e))return w1(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...Q8()),nV(i);const l=rV(r,i,t,n);if(!l&&!(t!=null&&t.nothrow))throw new Error(n3(r));return l}function rV(r,e,t,n){const i=ib(r),l=b1(r),u=v1(i)||(n==null?void 0:n.url);let a=null,p="";return t!=null&&t.mimeType&&(a=qx(e,t==null?void 0:t.mimeType),p=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),a=a||iV(e,u),p=p||(a?`matched url ${u}`:""),a=a||qx(e,l),p=p||(a?`matched MIME type ${l}`:""),a=a||oV(e,r),p=p||(a?`matched initial data ${i3(r)}`:""),t!=null&&t.fallbackMimeType&&(a=a||qx(e,t==null?void 0:t.fallbackMimeType),p=p||(a?`matched fallback MIME type ${l}`:"")),p&&QU.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${p}.`),a}function r3(r){return!(r instanceof Response&&r.status===204)}function n3(r){const e=ib(r),t=b1(r);let n="No valid loader found (";n+=e?`${ZC(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?i3(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function nV(r){for(const e of r)w1(e)}function iV(r,e){const t=e&&eV.exec(e),n=t&&t[1];return n?sV(r,n):null}function sV(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function qx(r,e){var t;for(const n of r)if((t=n.mimeTypes)!=null&&t.some(i=>qS(e,i))||qS(e,`application/x.${n.id}`))return n;return null}function oV(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(aV(e,t))return t}else if(ArrayBuffer.isView(e)){if(QS(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&QS(e,0,t))return t;return null}function aV(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function QS(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>lV(r,e,t,i))}function lV(r,e,t,n){if(n instanceof ArrayBuffer)return m8(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=Z0(r,e,n.length);return n===i;default:return!1}}function i3(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Z0(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Z0(r,0,e):""}function Z0(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let l=0;l<t;l++)i+=String.fromCharCode(n.getUint8(e+l));return i}const cV=256*1024;function*uV(r,e){const t=(e==null?void 0:e.chunkSize)||cV;let n=0;const i=new TextEncoder;for(;n<r.length;){const l=Math.min(r.length-n,t),u=r.slice(n,n+l);n+=l,yield i.encode(u)}}const hV=256*1024;function*dV(r,e={}){const{chunkSize:t=hV}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),l=new ArrayBuffer(i),u=new Uint8Array(r,n,i);new Uint8Array(l).set(u),n+=i,yield l}}const fV=1024*1024;async function*pV(r,e){const t=(e==null?void 0:e.chunkSize)||fV;let n=0;for(;n<r.size;){const i=n+t,l=await r.slice(n,i).arrayBuffer();n=i,yield l}}function eA(r,e){return _1?gV(r,e):mV(r)}async function*gV(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e!=null&&e._streamReadAhead&&(n=t.read());const{done:l,value:u}=await i;if(l)return;yield XC(u)}}catch{t.releaseLock()}}async function*mV(r,e){for await(const t of r)yield XC(t)}function _V(r,e){if(typeof r=="string")return uV(r,e);if(r instanceof ArrayBuffer)return dV(r,e);if(pu(r))return pV(r,e);if(YC(r))return eA(r,e);if(fu(r))return eA(r.body,e);throw new Error("makeIterator")}const s3="Cannot convert supplied data type";function yV(r,e,t){if(e.text&&typeof r=="string")return r;if(I8(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(s3)}async function vV(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return yV(r,e);if(pu(r)&&(r=await GC(r)),fu(r)){const i=r;return await B8(i),e.binary?await i.arrayBuffer():await i.text()}if(YC(r)&&(r=_V(r,t)),A8(r)||E8(r))return v8(r);throw new Error(s3)}function o3(r,e){const t=e3(),n=r||t;return typeof n.fetch=="function"?n.fetch:zm(n.fetch)?i=>ZS(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:ZS}function bV(r,e,t){if(t)return t;const n={fetch:o3(e,r),...r};if(n.url){const i=v1(n.url);n.baseUrl=i,n.queryString=D8(n.url),n.filename=ZC(i),n.baseUrl=T8(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function xV(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function Uy(r,e,t,n){e&&!Array.isArray(e)&&!x1(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=ib(r),u=xV(e,n),a=await tV(r,u,t);return a?(t=X8(t,a,u,i),n=bV({url:i,_parse:Uy,loaders:u},t,n||null),await wV(a,r,t,n)):null}async function wV(r,e,t,n){if(d8(r),t=e8(r.options,t),fu(e)){const l=e,{ok:u,redirected:a,status:p,statusText:y,type:x,url:T}=l,E=Object.fromEntries(l.headers.entries());n.response={headers:E,ok:u,redirected:a,status:p,statusText:y,type:x,url:T}}e=await vV(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(f8(r,t))return await p8(r,e,t,n,Uy);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw dc(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function Vy(r,e,t,n){let i,l;!Array.isArray(e)&&!x1(e)?(i=[],l=e):(i=e,l=t);const u=o3(l);let a=r;return typeof r=="string"&&(a=await u(r)),pu(r)&&(a=await u(r)),Array.isArray(i)?await Uy(a,i,l):await Uy(a,i,l)}const TV="4.3.2";var UE;const SV=(UE=globalThis.loaders)==null?void 0:UE.parseImageNode,Y0=typeof Image<"u",K0=typeof ImageBitmap<"u",AV=!!SV,G0=_1?!0:AV;function EV(r){switch(r){case"auto":return K0||Y0||G0;case"imagebitmap":return K0;case"image":return Y0;case"data":return G0;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function IV(){if(K0)return"imagebitmap";if(Y0)return"image";if(G0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function CV(r){const e=RV(r);if(!e)throw new Error("Not an image");return e}function PV(r){switch(CV(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function RV(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const kV=/^data:image\/svg\+xml/,MV=/\.svg((\?|#).*)?$/;function T1(r){return r&&(kV.test(r)||MV.test(r))}function OV(r,e){if(T1(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(l){throw new Error(l.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return a3(r,e)}function a3(r,e){if(T1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function l3(r,e,t){const n=OV(r,t),i=self.URL||self.webkitURL,l=typeof n!="string"&&i.createObjectURL(n);try{return await DV(l||n,e)}finally{l&&i.revokeObjectURL(l)}}async function DV(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=l=>{const u=l instanceof Error?l.message:"error";i(new Error(u))}}catch(l){i(l)}})}const NV={};let tA=!0;async function FV(r,e,t){let n;T1(t)?n=await l3(r,e,t):n=a3(r,t);const i=e&&e.imagebitmap;return await BV(n,i)}async function BV(r,e=null){if((LV(e)||!tA)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),tA=!1}return await createImageBitmap(r)}function LV(r){for(const e in r||NV)return!1;return!0}function zV(r){return!HV(r,"ftyp",4)||!(r[8]&96)?null:UV(r)}function UV(r){switch(VV(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function VV(r,e,t){return String.fromCharCode(...r.slice(e,t))}function jV(r){return[...r].map(e=>e.charCodeAt(0))}function HV(r,e,t=0){const n=jV(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const ha=!1,ip=!0;function c3(r){const e=Um(r);return $V(e)||ZV(e)||qV(e)||XV(e)||WV(e)}function WV(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=zV(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function $V(r){const e=Um(r);return e.byteLength>=24&&e.getUint32(0,ha)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ha),height:e.getUint32(20,ha)}:null}function qV(r){const e=Um(r);return e.byteLength>=10&&e.getUint32(0,ha)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ip),height:e.getUint16(8,ip)}:null}function XV(r){const e=Um(r);return e.byteLength>=14&&e.getUint16(0,ha)===16973&&e.getUint32(2,ip)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ip),height:e.getUint32(22,ip)}:null}function ZV(r){const e=Um(r);if(!(e.byteLength>=3&&e.getUint16(0,ha)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=YV();let l=2;for(;l+9<e.byteLength;){const u=e.getUint16(l,ha);if(i.has(u))return{mimeType:"image/jpeg",height:e.getUint16(l+5,ha),width:e.getUint16(l+7,ha)};if(!n.has(u))return null;l+=2,l+=e.getUint16(l,ha)}return null}function YV(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Um(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function KV(r,e){var i;const{mimeType:t}=c3(r)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return By(n),await n(r,t)}async function GV(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:l}=t||{},u=JV(i);let a;switch(u){case"imagebitmap":a=await FV(r,e,l);break;case"image":a=await l3(r,e,l);break;case"data":a=await KV(r);break;default:By(!1)}return i==="data"&&(a=PV(a)),a}function JV(r){switch(r){case"auto":case"data":return IV();default:return EV(r),r}}const QV=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ej=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],tj={image:{type:"auto",decode:!0}},rj={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:TV,mimeTypes:ej,extensions:QV,parse:GV,tests:[r=>!!c3(new DataView(r))],options:tj},ri=new Lm({id:"deck"});let J0={};function nj(r){J0=r}function Bs(r,e,t,n){ri.level>0&&J0[r]&&J0[r].call(null,e,t,n)}function ij(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const sj={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:ij,parseTextSync:JSON.parse};function oj(){const r="9.0.40",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(ri.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:ri,_registerLoggers:nj},J8([sj,[rj,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const aj=oj();function Kc(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const Xx={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function lj(r){const e={};for(const[t,n]of Object.entries(r))e[t]=uj(n);return e}function cj(r,e,t){const n={};for(const[i,l]of Object.entries(e))r&&i in r&&!l.private?(l.validate&&Kc(l.validate(r[i],l),`${t}: invalid ${i}`),n[i]=r[i]):n[i]=l.value;return n}function uj(r){let e=rA(r);if(e!=="object")return{value:r,...Xx[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...Xx[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=rA(r.value),{...r,...Xx[e],type:e}):{type:"object",value:null};throw new Error("props")}function rA(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const hj=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,dj=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,fj={vertex:hj,fragment:dj},nA=/void\s+main\s*\([^)]*\)\s*\{\n?/,iA=/}\n?[^{}]*$/,Zx=[],yy="__LUMA_INJECT_DECLARATIONS__";function pj(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=gj(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function gj(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function jy(r,e,t,n=!1){const i=e==="vertex";for(const l in t){const u=t[l];u.sort((p,y)=>p.order-y.order),Zx.length=u.length;for(let p=0,y=u.length;p<y;++p)Zx[p]=u[p].injection;const a=`${Zx.join(`
`)}
`;switch(l){case"vs:#decl":i&&(r=r.replace(yy,a));break;case"vs:#main-start":i&&(r=r.replace(nA,p=>p+a));break;case"vs:#main-end":i&&(r=r.replace(iA,p=>a+p));break;case"fs:#decl":i||(r=r.replace(yy,a));break;case"fs:#main-start":i||(r=r.replace(nA,p=>p+a));break;case"fs:#main-end":i||(r=r.replace(iA,p=>a+p));break;default:r=r.replace(l,p=>p+a)}}return r=r.replace(yy,""),n&&(r=r.replace(/\}\s*$/,l=>l+fj[e])),r}let mj=1;class Gc{constructor(e){Z(this,"name");Z(this,"vs");Z(this,"fs");Z(this,"getModuleUniforms");Z(this,"dependencies");Z(this,"deprecations");Z(this,"defines");Z(this,"injections");Z(this,"uniforms",{});Z(this,"uniformTypes",{});const{name:t,vs:n,fs:i,dependencies:l=[],uniformTypes:u={},uniformPropTypes:a={},getUniforms:p,deprecations:y=[],defines:x={},inject:T={}}=e;Kc(typeof t=="string"),this.name=t,this.vs=n,this.fs=i,this.getModuleUniforms=p,this.dependencies=Gc.instantiateModules(l),this.deprecations=this._parseDeprecationDefinitions(y),this.defines=x,this.injections=pj(T),this.uniformTypes=u,a&&(this.uniforms=lj(a))}static instantiateModules(e){return e.map(t=>{if(t instanceof Gc)return t;Kc(typeof t!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(t)}' and use it directly.`),t.name||(console.warn("shader module has no name"),t.name=`shader-module-${mj++}`);const n=new Gc(t);return n.dependencies=Gc.instantiateModules(t.dependencies||[]),n})}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:Kc(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${t}

`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):cj(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(n=>{var i;(i=n.regex)!=null&&i.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const i in n){const l=n[i];i in e&&!l.private?(l.validate&&Kc(l.validate(e[i],l),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=l.value}return t}}function sA(r){if(r.source&&r.platformInfo.type==="webgpu")return{...r,vs:void 0,fs:void 0};if(!r.vs)throw new Error("no vertex shader");const e=oA(r.platformInfo,r.vs);let t;return r.fs&&(t=oA(r.platformInfo,r.fs)),{...r,vs:e,fs:t}}function oA(r,e){if(typeof e=="string")return e;switch(r.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function sb(r){const e=Gc.instantiateModules(r);return _j(e)}function _j(r){const e={},t={};return u3({modules:r,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((n,i)=>t[i]-t[n]).map(n=>e[n])}function u3(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)n[l.name]=l,(i[l.name]===void 0||i[l.name]<t)&&(i[l.name]=t);for(const l of e)l.dependencies&&u3({modules:l.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function yj(r){switch(r==null?void 0:r.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vj(r,e){var n;if(Number(((n=r.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=aA(r,bj),r;case"fragment":return r=aA(r,xj),r;default:throw new Error(e)}}const h3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],bj=[...h3,[Q0("attribute"),"in $1"],[Q0("varying"),"out $1"]],xj=[...h3,[Q0("varying"),"in $1"]];function aA(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function Q0(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function d3(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const l=e[n];l.sort((u,a)=>u.order-a.order);for(const u of l)t+=`  ${u.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function f3(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[l,u]=i.split(":"),a=i.replace(/\(.+/,""),p=Object.assign(n,{signature:u});switch(l){case"vs":e.vertex[a]=p;break;case"fs":e.fragment[a]=p;break;default:throw new Error(l)}}return e}function wj(r,e){return{name:Tj(r,e),language:"glsl",version:Sj(r)}}function Tj(r,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function Sj(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const p3=`

${yy}
`,Aj=`precision highp float;
`;function Ej(r){const e=sb(r.modules||[]);return{source:ew(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:S1(e)}}function Ij(r){const e=sb(r.modules||[]);return{vs:ew(r.platformInfo,{...r,source:r.vs,stage:"vertex",modules:e}),fs:ew(r.platformInfo,{...r,source:r.fs,stage:"fragment",modules:e}),getUniforms:S1(e)}}function Cj(r){const{vs:e,fs:t}=r,n=sb(r.modules||[]);return{vs:lA(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:lA(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:S1(n)}}function ew(r,e){const{source:t,stage:n,modules:i,hookFunctions:l=[],inject:u={},log:a}=e;Kc(typeof t=="string","shader source must be a string");const p=t;let y="";const x=f3(l),T={},E={},k={};for(const D in u){const N=typeof u[D]=="string"?{injection:u[D],order:0}:u[D],B=/^(v|f)s:(#)?([\w-]+)$/.exec(D);if(B){const V=B[2],U=B[3];V?U==="decl"?E[D]=[N]:k[D]=[N]:T[D]=[N]}else k[D]=[N]}const F=r.type!=="webgpu"?i:[];for(const D of F){a&&D.checkDeprecations(p,a);const N=D.getModuleSource(n,"wgsl");y+=N;const B=D.injections[n];for(const V in B){const U=/^(v|f)s:#([\w-]+)$/.exec(V);if(U){const J=U[2]==="decl"?E:k;J[V]=J[V]||[],J[V].push(B[V])}else T[V]=T[V]||[],T[V].push(B[V])}}return y+=p3,y=jy(y,n,E),y+=d3(x[n],T),y+=p,y=jy(y,n,k),y}function lA(r,e){const{id:t,source:n,stage:i,language:l="glsl",modules:u,defines:a={},hookFunctions:p=[],inject:y={},prologue:x=!0,log:T}=e;Kc(typeof n=="string","shader source must be a string");const E=l==="glsl"?wj(n).version:-1,k=r.shaderLanguageVersion,F=E===100?"#version 100":"#version 300 es",N=n.split(`
`).slice(1).join(`
`),B={};u.forEach(le=>{Object.assign(B,le.getDefines())}),Object.assign(B,a);let V="";switch(l){case"wgsl":break;case"glsl":V=x?`${F}

// ----- PROLOGUE -------------------------
${Pj({id:t,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${yj(r)}
${i==="fragment"?Aj:""}

// ----- APPLICATION DEFINES -------------------------

${Rj(B)}

`:`${F}
`;break}const U=f3(p),j={},J={},oe={};for(const le in y){const Ce=typeof y[le]=="string"?{injection:y[le],order:0}:y[le],Ie=/^(v|f)s:(#)?([\w-]+)$/.exec(le);if(Ie){const Ue=Ie[2],De=Ie[3];Ue?De==="decl"?J[le]=[Ce]:oe[le]=[Ce]:j[le]=[Ce]}else oe[le]=[Ce]}for(const le of u){T&&le.checkDeprecations(N,T);const Ce=le.getModuleSource(i);V+=Ce;const Ie=le.injections[i];for(const Ue in Ie){const De=/^(v|f)s:#([\w-]+)$/.exec(Ue);if(De){const ze=De[2]==="decl"?J:oe;ze[Ue]=ze[Ue]||[],ze[Ue].push(Ie[Ue])}else j[Ue]=j[Ue]||[],j[Ue].push(Ie[Ue])}}return V+="// ----- MAIN SHADER SOURCE -------------------------",V+=p3,V=jy(V,i,J),V+=d3(U[i],j),V+=N,V=jy(V,i,oe),l==="glsl"&&E!==k&&(V=vj(V,i)),V.trim()}function S1(r){return function(t){const n={};for(const i of r){const l=i.getUniforms(t,n);Object.assign(n,l)}return n}}function Pj(r){const{id:e,source:t,stage:n}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}

`:""}function Rj(r={}){let e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}const Zc=class Zc{constructor(){Z(this,"_hookFunctions",[]);Z(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Zc.defaultShaderAssembler=Zc.defaultShaderAssembler||new Zc,Zc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=sA(e);return{...Ej({platformInfo:e.platformInfo,...i,modules:t,hookFunctions:n}),modules:t}}assembleShaderPair(e){const t=sA(e),n=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:l}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?Ij({platformInfo:l,...t,modules:n,hookFunctions:i}):Cj({platformInfo:l,...t,modules:n,hookFunctions:i}),modules:n}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let l=0,u=this._defaultModules.length;l<u;++l){const a=this._defaultModules[l],p=a.name;t[i++]=a,n[p]=!0}for(let l=0,u=e.length;l<u;++l){const a=e[l],p=a.name;n[p]||(t[i++]=a,n[p]=!0)}return t.length=i,Gc.instantiateModules(t)}};Z(Zc,"defaultShaderAssembler");let Hy=Zc;const kj=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,Mj=`#version 300 es
${kj}`;function Oj(r){const{input:e,inputChannels:t,output:n}={};if(!e)return Mj;if(!t)throw new Error("inputChannels");const i=Dj(t),l=Nj(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${l};
}`}function Dj(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function Nj(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}const Xt=new Lm({id:"luma.gl"});class Fj{constructor(){Z(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new nb({id:e})),this.stats.get(e)}}const A1=new Fj;function Bj(){const r="9.0.28",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==r)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${r}`);return globalThis.luma||(gc()&&Xt.log(1,`${r} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:r,version:r,log:Xt,stats:A1}),r}const Lj=Bj();function zj(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)?r:null}function Tp(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number"?r:null:zj(r)}const Yx={};function gu(r="id"){Yx[r]=Yx[r]||1;const e=Yx[r]++;return`${r}-${e}`}function Wy(r){let e=!0;for(const t in r){e=!1;break}return e}var T0;let ii=(T0=class{constructor(e,t,n){Z(this,"id");Z(this,"props");Z(this,"userData",{});Z(this,"_device");Z(this,"destroyed",!1);Z(this,"allocatedBytes",0);Z(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Uj(t,n);const i=this.props.id!=="undefined"?this.props.id:gu(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},Z(T0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),T0);function Uj(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}const ps=class ps extends ii{constructor(t,n){const i={...n};(n.usage||0)&ps.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16"));super(t,i,ps.defaultProps);Z(this,"usage");Z(this,"indexType");Z(this,"updateTimestamp");Z(this,"debugData",new ArrayBuffer(0));this.usage=n.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(t,n){throw new Error("not implemented")}_setDebugData(t,n,i){const l=ArrayBuffer.isView(t)?t.buffer:t,u=Math.min(t?t.byteLength:i,ps.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(u):n===0&&i===t.byteLength?this.debugData=l.slice(0,u):this.debugData=l.slice(n,n+u)}};Z(ps,"defaultProps",{...ii.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),Z(ps,"MAP_READ",1),Z(ps,"MAP_WRITE",2),Z(ps,"COPY_SRC",4),Z(ps,"COPY_DST",8),Z(ps,"INDEX",16),Z(ps,"VERTEX",32),Z(ps,"UNIFORM",64),Z(ps,"STORAGE",128),Z(ps,"INDIRECT",256),Z(ps,"QUERY_RESOLVE",512),Z(ps,"DEBUG_DATA_MAX_LENGTH",32);let Ti=ps;function g3(r){const e=cA[r],t=Vj(e),n=r.includes("norm"),i=!n&&!r.startsWith("float"),l=r.startsWith("s");return{dataType:cA[r],byteLength:t,integer:i,signed:l,normalized:n}}function Vj(r){return jj[r]}const cA={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},jj={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Hj=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Wj=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function $j(r){return Hj.some(e=>r.startsWith(e))}function m3(r){const e=Wj.exec(r);if(e){const[,t,n,i,l,u]=e;if(t){const a=`${i}${n}`,p=g3(a);return{format:t,components:t.length,srgb:l==="-srgb",unsized:u==="-unsized",webgl:u==="-webgl",...p}}}return Xj(r)}const qj={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function Xj(r){var t;const e=qj[r];if(!e)throw new Error(`Unknown format ${r}`);return{format:e.format||"",components:e.components||((t=e.format)==null?void 0:t.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class Zj{}class Yj{constructor(e=[],t){Z(this,"features");Z(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const up=class up{constructor(e){Z(this,"id");Z(this,"props");Z(this,"userData",{});Z(this,"statsManager",A1);Z(this,"_lumaData",{});Z(this,"timestamp",0);this.props={...up.defaultProps,...e},this.id=this.props.id||gu(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return $j(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ti.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Xt.warn("indices buffer content must be of integer type")()),t}};Z(up,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Xt.get("debug"),spector:!!(Xt.get("spector")||Xt.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Xt.error(e.message)}),Z(up,"VERSION",Lj);let nd=up;function oi(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}const Bf=new Map,Ah=class Ah{static registerDevices(e){for(const t of e)oi(t.type&&t.isSupported&&t.create),Bf.set(t.type,t)}static getAvailableDevices(){return Array.from(Bf).map(e=>e.type)}static getSupportedDevices(){return Array.from(Bf).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(nd.defaultProps,e)}static async attachDevice(e){const t=uA(e.devices)||Bf;if(e.handle instanceof WebGL2RenderingContext){const n=t.get("webgl");if(n)return await n.attach(e.handle)}if(e.handle===null){const n=t.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var l,u;e={...Ah.defaultProps,...e},e.gl&&(e.type="webgl");const t=uA(e.devices)||Bf;let n,i;switch(e.type){case"webgpu":if(n=t.get("webgpu"),n)return await n.create(e);break;case"webgl":if(i=t.get("webgl"),i)return await i.create(e);break;case"unknown":const a=t.get("unknown");if(a)return await a.create(e);break;case"best-available":if(n=t.get("webgpu"),(l=n==null?void 0:n.isSupported)!=null&&l.call(n))return await n.create(e);if(i=t.get("webgl"),(u=i==null?void 0:i.isSupported)!=null&&u.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(n,i){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(n,i)}}};Z(Ah,"defaultProps",{...nd.defaultProps,type:"best-available",devices:void 0}),Z(Ah,"stats",A1),Z(Ah,"log",Xt);let Dh=Ah;function uA(r){if(!r||(r==null?void 0:r.length)===0)return null;const e=new Map;for(const t of r)e.set(t.type,t);return e}const Kj=gc()&&typeof document<"u",ob=()=>Kj&&document.readyState==="complete",Gj={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class E1{constructor(e){Z(this,"id");Z(this,"props");Z(this,"canvas");Z(this,"htmlCanvas");Z(this,"offscreenCanvas");Z(this,"type");Z(this,"width",1);Z(this,"height",1);Z(this,"resizeObserver");Z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Gj,...e},e=this.props,!gc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=e9(e.canvas):this.canvas=e.canvas;else{const t=t9(e),n=Qj((e==null?void 0:e.container)||null);n.insertBefore(t,n.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const n of t)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return ob()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?t/n:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,l]=this.getDrawingBufferSize();return r9(e,n,i,l,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Xt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const l=this._canvasSizeInfo;if(l.clientWidth!==n||l.clientHeight!==i||l.devicePixelRatio!==e){let u=e;const a=Math.floor(n*u),p=Math.floor(i*u);this.htmlCanvas.width=a,this.htmlCanvas.height=p;const[y,x]=this.getDrawingBufferSize();(y!==a||x!==p)&&(u=Math.min(y/n,x/i),this.htmlCanvas.width=Math.floor(n*u),this.htmlCanvas.height=Math.floor(i*u),Xt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}Z(E1,"pageLoaded",Jj());function Jj(){return ob()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}function Qj(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e&&!ob())throw new Error(`Accessing '${r}' before page was loaded`);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function e9(r){const e=document.getElementById(r);if(!e&&!ob())throw new Error(`Accessing '${r}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function t9(r){const{width:e,height:t}=r,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",n}function r9(r,e,t,n,i){const l=r,u=hA(l[0],e,t);let a=dA(l[1],e,n,i),p=hA(l[0]+1,e,t);const y=p===t-1?p:p-1;p=dA(l[1]+1,e,n,i);let x;return i?(p=p===0?p:p+1,x=a,a=p):x=p===n-1?p:p-1,{x:u,y:a,width:Math.max(y-u+1,1),height:Math.max(x-a+1,1)}}function hA(r,e,t){return Math.min(Math.round(r*e),t-1)}function dA(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const Va=class Va extends ii{constructor(t,n,i=Va.defaultProps){super(t,n,i);Z(this,"dimension");Z(this,"format");Z(this,"width");Z(this,"height");Z(this,"depth");Z(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};Z(Va,"defaultProps",{...ii.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),Z(Va,"COPY_SRC",1),Z(Va,"COPY_DST",2),Z(Va,"TEXTURE_BINDING",4),Z(Va,"STORAGE_BINDING",8),Z(Va,"RENDER_ATTACHMENT",16);let So=Va;const Rv=class Rv extends ii{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Rv.defaultProps)}};Z(Rv,"defaultProps",{...ii.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let $y=Rv;function n9(r,e,t){let n="";const i=e.split(/\r?\n/),l=r.slice().sort((u,a)=>u.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let u=0;for(let a=1;a<=i.length;a++)for(n+=_3(i[a-1],a,t);l.length>u&&l[u].lineNum===a;){const p=l[u++];n+=fA(p,i,p.lineNum,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const a of r)n+=fA(a,i,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function fA(r,e,t,n){if(n!=null&&n.inlineSource){const i=i9(e,t),l=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${i}${l}${r.type.toUpperCase()}: ${r.message}

`}return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function i9(r,e,t){let n="";for(let i=e-2;i<=e;i++){const l=r[i-1];l!==void 0&&(n+=_3(l,e,t))}return n}function _3(r,e,t){const n=t!=null&&t.html?o9(r):r;return`${s9(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function s9(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function o9(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function y3(r,e){return{name:a9(r,e),language:"glsl",version:l9(r)}}function a9(r,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}function l9(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}return e}const kv=class kv extends ii{constructor(t,n){super(t,{id:c9(n),...n},kv.defaultProps);Z(this,"stage");Z(this,"source");Z(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();this.props.debug==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(t){var y;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=y3(this.source).name,i=`${this.stage} ${n}`;let l=n9(t,this.source,{showSourceCode:"all",html:!0});const u=this.getTranslatedSource();u&&(l+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${u}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${l}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const p=document.getElementsByClassName("luma-compiler-log-error");(y=p[0])!=null&&y.scrollIntoView&&p[0].scrollIntoView(),a.onclick=()=>{const x=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(x)}}};Z(kv,"defaultProps",{...ii.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let qy=kv;function c9(r){return y3(r.source).name||r.id||gu(`unnamed ${r.stage}-shader`)}const Mv=class Mv extends ii{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t,Mv.defaultProps)}};Z(Mv,"defaultProps",{...ii.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Xy=Mv;const Ov=class Ov extends ii{constructor(t,n={}){super(t,n,Ov.defaultProps);Z(this,"width");Z(this,"height");Z(this,"colorAttachments",[]);Z(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(t){let n=!t;if(t){const[i,l]=Array.isArray(t)?t:[t.width,t.height];n=n||l!==this.height||i!==this.width,this.width=i,this.height=l}n&&(Xt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(n=>{if(typeof n=="string"){const i=this.createColorTexture(n);return this.attachResource(i),i.view}return n instanceof So?n.view:n});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const n=this.createDepthStencilTexture(t);this.attachResource(n),this.depthStencilAttachment=n.view}else t instanceof So?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:So.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:So.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const l=this.device._createTexture({...this.colorAttachments[i].props,width:t,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=l.view,this.attachResource(l.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};Z(Ov,"defaultProps",{...ii.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Zy=Ov;const Dv=class Dv extends ii{constructor(t,n){super(t,n,Dv.defaultProps);Z(this,"shaderLayout");Z(this,"bufferLayout");Z(this,"linkStatus","pending");Z(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};Z(Dv,"defaultProps",{...ii.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let id=Dv;const Nv=class Nv extends ii{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t,Nv.defaultProps)}};Z(Nv,"defaultProps",{...ii.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let tw=Nv;const Fv=class Fv extends ii{constructor(t,n){super(t,n,Fv.defaultProps);Z(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};Z(Fv,"defaultProps",{...ii.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Yy=Fv;const Bv=class Bv extends ii{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Bv.defaultProps)}};Z(Bv,"defaultProps",{...ii.defaultProps,measureExecutionTime:void 0});let rw=Bv;const Lv=class Lv extends ii{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Lv.defaultProps)}};Z(Lv,"defaultProps",{...ii.defaultProps});let nw=Lv;function u9(r){const[e,t]=d9[r],n=e==="i32"||e==="u32",i=e!=="u32",l=f9[e]*t,u=h9(e,t);return{dataType:e,components:t,defaultVertexFormat:u,byteLength:l,integer:n,signed:i}}function h9(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const d9={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},f9={f32:4,f16:2,i32:4,u32:4};function v3(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,l=n?parseInt(n):1,u=g3(i),a={type:i,components:l,byteLength:u.byteLength*l,integer:u.integer,signed:u.signed,normalized:u.normalized};return e&&(a.webglOnly=!0),a}function b3(r,e){const t={};for(const n of r.attributes)t[n.name]=g9(r,e,n.name);return t}function p9(r,e,t=16){const n=b3(r,e),i=new Array(t).fill(null);for(const l of Object.values(n))i[l.location]=l;return i}function g9(r,e,t){const n=m9(r,t),i=_9(e,t);if(!n)return null;const l=u9(n.type),u=(i==null?void 0:i.vertexFormat)||l.defaultVertexFormat,a=v3(u);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:l.dataType,shaderComponents:l.components,vertexFormat:u,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:l.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function m9(r,e){const t=r.attributes.find(n=>n.name===e);return t||Xt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function _9(r,e){y9(r);let t=v9(r,e);return t||(t=b9(r,e),t)?t:(Xt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function y9(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Xt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function v9(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function b9(r,e){var t;for(const n of r){let i=n.byteStride;if(typeof n.byteStride!="number")for(const u of n.attributes||[]){const a=v3(u.format);i+=a.byteLength}const l=(t=n.attributes)==null?void 0:t.find(u=>u.attribute===e);if(l)return{attributeName:l.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:l.format,byteOffset:l.byteOffset,byteStride:i}}return null}function x9(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(l=>l.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Xt.warn(`shader layout attribute ${n.name} not present in shader`)}return t}const zv=class zv extends ii{constructor(t,n){super(t,n,zv.defaultProps);Z(this,"maxVertexAttributes");Z(this,"attributeInfos");Z(this,"indexBuffer",null);Z(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=p9(n.renderPipeline.shaderLayout,n.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,n){throw new Error("constant attributes not supported")}};Z(zv,"defaultProps",{...ii.defaultProps,renderPipeline:null});let iw=zv;const Uv=class Uv extends ii{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Uv.defaultProps)}};Z(Uv,"defaultProps",{...ii.defaultProps,layout:void 0,buffers:{}});let sw=Uv;const Vv=class Vv extends ii{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Vv.defaultProps)}};Z(Vv,"defaultProps",{...ii.defaultProps,type:void 0,count:void 0});let ow=Vv;const w9={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function T9(r){const e=w9[r];return oi(r),e}function S9(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}let Q_;function x3(r){return(!Q_||Q_.byteLength<r)&&(Q_=new ArrayBuffer(r)),Q_}function A9(r,e){const t=x3(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function E9(r){const{target:e,source:t,start:n=0,count:i=1}=r,l=t.length,u=i*l;let a=0;for(let p=n;a<l;a++)e[p++]=t[a];for(;a<u;)a<u-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+u-a),a=u);return r.target}const pA=1024;class I9{constructor(e){Z(this,"layout",{});Z(this,"byteLength");let t=0;for(const[i,l]of Object.entries(e)){const u=T9(l),{type:a,components:p}=u;t=S9(t,p);const y=t;t+=p,this.layout[i]={type:a,size:p,offset:y}}t+=(4-t%4)%4;const n=t*4;this.byteLength=Math.max(n,pA)}getData(e){const t=Math.max(this.byteLength,pA),n=x3(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[l,u]of Object.entries(e)){const a=this.layout[l];if(!a){Xt.warn(`Supplied uniform value ${l} not present in uniform block layout`)();continue}const{type:p,size:y,offset:x}=a,T=i[p];if(y===1){if(typeof u!="number"&&typeof u!="boolean"){Xt.warn(`Supplied value for single component uniform ${l} is not a number: ${u}`)();continue}T[x]=Number(u)}else{const E=Tp(u);if(!E){Xt.warn(`Supplied value for multi component / array uniform ${l} is not a numeric array: ${u}`)();continue}T.set(E,x)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function C9(r,e,t=16){if(r!==e)return!1;const n=Tp(r);if(!n)return!1;const i=Tp(e);if(i&&n.length===i.length){for(let l=0;l<n.length;++l)if(i[l]!==n[l])return!1}return!0}function P9(r){const e=Tp(r);return e?e.slice():r}class R9{constructor(e){Z(this,"name");Z(this,"uniforms",{});Z(this,"modifiedUniforms",{});Z(this,"modified",!0);Z(this,"bindingLayout",{});Z(this,"needsRedraw","initialized");var t;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(l=>l.type==="uniform"&&l.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const l of i.uniforms||[])this.bindingLayout[l.name]=l}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){C9(this.uniforms[e],t)||(this.uniforms[e]=P9(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class k9{constructor(e){Z(this,"uniformBlocks",new Map);Z(this,"uniformBufferLayouts",new Map);Z(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const i=t,l=new I9(n.uniformTypes||{});this.uniformBufferLayouts.set(i,l);const u=new R9({name:t});u.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,u)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),l=e.createBuffer({usage:Ti.UNIFORM|Ti.COPY_DST,byteLength:i}),u=this.getUniformBufferData(t);return l.write(u),l}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Ti.UNIFORM|Ti.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Xt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e),n=this.uniformBuffers.get(e);let i=!1;if(n&&t.needsRedraw){i||(i=t.needsRedraw);const l=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(l);const a=this.uniformBlocks.get(e).getAllUniforms();Xt.log(4,`Writing to uniform buffer ${String(e)}`,l,a)()}return i}}function w3(r){const e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function T3(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function M9(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=w3(r);if(i==="uint8"&&t&&n===1)return"unorm8-webgl";if(i==="uint8"&&t&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}function O9(r){return Tp(r)!==null||typeof r=="number"||typeof r=="boolean"}function I1(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];O9(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}function D9(r,e,t){const{removedProps:n={},deprecatedProps:i={},replacedProps:l={}}=t;for(const a in n)if(a in e){const y=n[a]?`${r}.${n[a]}`:"N/A";Xt.removed(`${r}.${a}`,y)()}for(const a in i)if(a in e){const p=i[a];Xt.deprecated(`${r}.${a}`,`${r}.${p}`)()}let u=null;for(const[a,p]of Object.entries(l))a in e&&(Xt.deprecated(`${r}.${a}`,`${r}.${p}`)(),u=u||Object.assign({},e),u[p]=e[a],delete u[a]);return u||e}let N9="";async function F9(r,e){return await new Promise((t,n)=>{try{const i=new Image;i.onload=()=>t(i),i.onerror=()=>n(new Error(`Could not load image ${r}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=r.startsWith("http")?r:N9+r}catch(i){n(i)}})}async function S3(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,l)=>{n.onload=i,n.onerror=u=>l(new Error(`Unable to load script '${r}': ${u}`)),t.appendChild(n)})}function aw(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!aw(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!aw(r[l],e[l],t-1))return!1;return!0}return!1}function B9(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function L9(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}class Ao{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class gA{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Jl extends Ao{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ic extends Ao{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class lw extends Ao{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class lu extends Ao{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var $l;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})($l||($l={}));class ey{constructor(e,t,n,i,l,u,a){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=l,this.resourceType=u,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class z9{constructor(e,t){this.name=e,this.type=t}}class U9{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class mA{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class V9{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class j9{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class H9{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class W9{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const A3=new Float32Array(1),$9=new Int32Array(A3.buffer),As=new Uint16Array(1);function q9(r){A3[0]=r;const e=$9[0],t=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return As[0]=t<<15|31744|(i!==0?512:0),As[0];if(n===0){if(i===0)return As[0]=t<<15,As[0];i|=8388608;let l=113;for(;!(8388608&i);)i<<=1,l--;return n=127-l,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),As[0]=t<<15|n<<10|i>>13,As[0]):(As[0]=t<<15,As[0])}return n=n-127+15,n>=31?(As[0]=t<<15|31744,As[0]):n<=0?n<-10?(As[0]=t<<15,As[0]):(i=(8388608|i)>>1-n,As[0]=t<<15|i>>13,As[0]):(i>>=13,As[0]=t<<15|n<<10|i,As[0])}const C1=new Uint32Array(1),E3=new Float32Array(C1.buffer,0,1);function _A(r){const e=112+(r>>6&31)<<23|(63&r)<<17;return C1[0]=e,E3[0]}function X9(r,e,t,n,i,l,u,a,p){const y=n*(u>>=i)*(l>>=i)+t*u+e*a;switch(p){case"r8unorm":return[Fn(r,y,"8unorm",1)[0]];case"r8snorm":return[Fn(r,y,"8snorm",1)[0]];case"r8uint":return[Fn(r,y,"8uint",1)[0]];case"r8sint":return[Fn(r,y,"8sint",1)[0]];case"rg8unorm":{const x=Fn(r,y,"8unorm",2);return[x[0],x[1]]}case"rg8snorm":{const x=Fn(r,y,"8snorm",2);return[x[0],x[1]]}case"rg8uint":{const x=Fn(r,y,"8uint",2);return[x[0],x[1]]}case"rg8sint":{const x=Fn(r,y,"8sint",2);return[x[0],x[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const x=Fn(r,y,"8unorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8snorm":{const x=Fn(r,y,"8snorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8uint":{const x=Fn(r,y,"8uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba8sint":{const x=Fn(r,y,"8sint",4);return[x[0],x[1],x[2],x[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const x=Fn(r,y,"8unorm",4);return[x[2],x[1],x[0],x[3]]}case"r16uint":return[Fn(r,y,"16uint",1)[0]];case"r16sint":return[Fn(r,y,"16sint",1)[0]];case"r16float":return[Fn(r,y,"16float",1)[0]];case"rg16uint":{const x=Fn(r,y,"16uint",2);return[x[0],x[1]]}case"rg16sint":{const x=Fn(r,y,"16sint",2);return[x[0],x[1]]}case"rg16float":{const x=Fn(r,y,"16float",2);return[x[0],x[1]]}case"rgba16uint":{const x=Fn(r,y,"16uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16sint":{const x=Fn(r,y,"16sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16float":{const x=Fn(r,y,"16float",4);return[x[0],x[1],x[2],x[3]]}case"r32uint":return[Fn(r,y,"32uint",1)[0]];case"r32sint":return[Fn(r,y,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Fn(r,y,"32float",1)[0]];case"rg32uint":{const x=Fn(r,y,"32uint",2);return[x[0],x[1]]}case"rg32sint":{const x=Fn(r,y,"32sint",2);return[x[0],x[1]]}case"rg32float":{const x=Fn(r,y,"32float",2);return[x[0],x[1]]}case"rgba32uint":{const x=Fn(r,y,"32uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32sint":{const x=Fn(r,y,"32sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32float":{const x=Fn(r,y,"32float",4);return[x[0],x[1],x[2],x[3]]}case"rg11b10ufloat":{const x=new Uint32Array(r.buffer,y,1)[0],T=(4192256&x)>>11,E=(4290772992&x)>>22;return[_A(2047&x),_A(T),function(k){const F=112+(k>>5&31)<<23|(31&k)<<18;return C1[0]=F,E3[0]}(E),1]}}return null}function Fn(r,e,t,n){const i=[0,0,0,0];for(let y=0;y<n;++y)switch(t){case"8unorm":i[y]=r[e]/255,e++;break;case"8snorm":i[y]=r[e]/255*2-1,e++;break;case"8uint":i[y]=r[e],e++;break;case"8sint":i[y]=r[e]-127,e++;break;case"16uint":i[y]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":i[y]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":i[y]=(l=r[e]|r[e+1]<<8,u=void 0,a=void 0,p=void 0,u=(32768&l)>>15,p=1023&l,(a=(31744&l)>>10)==0?(u?-1:1)*Math.pow(2,-14)*(p/Math.pow(2,10)):a==31?p?NaN:1/0*(u?-1:1):(u?-1:1)*Math.pow(2,a-15)*(1+p/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[y]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":i[y]=new Float32Array(r.buffer,e,1)[0],e+=4}var l,u,a,p;return i}function Un(r,e,t,n,i){for(let l=0;l<n;++l)switch(t){case"8unorm":r[e]=255*i[l],e++;break;case"8snorm":r[e]=.5*(i[l]+1)*255,e++;break;case"8uint":r[e]=i[l],e++;break;case"8sint":r[e]=i[l]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=i[l],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=i[l],e+=2;break;case"16float":{const u=q9(i[l]);new Uint16Array(r.buffer,e,1)[0]=u,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=i[l],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=i[l],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=i[l],e+=4}return i}const Kx={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ro{constructor(){this.id=Ro._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Ky.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Gy.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ro._id=0;class Ky extends Ro{}Ky.instance=new Ky;class Gy extends Ro{}Gy.instance=new Gy;const I3=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class yi extends Ro{constructor(){super()}}class Sp extends yi{constructor(e,t,n,i,l,u){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=l,this.endLine=u}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Z9 extends yi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class C3 extends yi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cw extends yi{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class P3 extends yi{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Za extends yi{constructor(e,t,n,i,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class P1 extends yi{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class sp extends yi{constructor(e,t,n,i,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class vy extends yi{constructor(e,t,n,i,l){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=l}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var yh,Zf,lt,Ke;(r=>{r.increment="++",r.decrement="--"})(yh||(yh={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(yh||(yh={}));class R3 extends yi{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(Zf||(Zf={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Zf||(Zf={}));class k3 extends yi{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class R1 extends yi{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return I3.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class M3 extends yi{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class O3 extends yi{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class D3 extends yi{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class N3 extends yi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Y9 extends yi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class K9 extends yi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class F3 extends yi{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class k1 extends yi{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class G9 extends yi{constructor(){super()}get astNodeType(){return"discard"}}class B3 extends yi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class L3 extends yi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Mt extends yi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Mt._priority.get(t.name);Mt._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?Mt.i32:t}getTypeName(){return this.name}}Mt.x32=new Mt("x32"),Mt.f32=new Mt("f32"),Mt.i32=new Mt("i32"),Mt.u32=new Mt("u32"),Mt.f16=new Mt("f16"),Mt.bool=new Mt("bool"),Mt.void=new Mt("void"),Mt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class yA extends Mt{constructor(e){super(e)}}class ja extends Mt{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class rt extends Mt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}rt.vec2f=new rt("vec2",Mt.f32,null),rt.vec3f=new rt("vec3",Mt.f32,null),rt.vec4f=new rt("vec4",Mt.f32,null),rt.vec2i=new rt("vec2",Mt.i32,null),rt.vec3i=new rt("vec3",Mt.i32,null),rt.vec4i=new rt("vec4",Mt.i32,null),rt.vec2u=new rt("vec2",Mt.u32,null),rt.vec3u=new rt("vec3",Mt.u32,null),rt.vec4u=new rt("vec4",Mt.u32,null),rt.vec2h=new rt("vec2",Mt.f16,null),rt.vec3h=new rt("vec3",Mt.f16,null),rt.vec4h=new rt("vec4",Mt.f16,null),rt.vec2b=new rt("vec2",Mt.bool,null),rt.vec3b=new rt("vec3",Mt.bool,null),rt.vec4b=new rt("vec4",Mt.bool,null),rt.mat2x2f=new rt("mat2x2",Mt.f32,null),rt.mat2x3f=new rt("mat2x3",Mt.f32,null),rt.mat2x4f=new rt("mat2x4",Mt.f32,null),rt.mat3x2f=new rt("mat3x2",Mt.f32,null),rt.mat3x3f=new rt("mat3x3",Mt.f32,null),rt.mat3x4f=new rt("mat3x4",Mt.f32,null),rt.mat4x2f=new rt("mat4x2",Mt.f32,null),rt.mat4x3f=new rt("mat4x3",Mt.f32,null),rt.mat4x4f=new rt("mat4x4",Mt.f32,null),rt.mat2x2h=new rt("mat2x2",Mt.f16,null),rt.mat2x3h=new rt("mat2x3",Mt.f16,null),rt.mat2x4h=new rt("mat2x4",Mt.f16,null),rt.mat3x2h=new rt("mat3x2",Mt.f16,null),rt.mat3x3h=new rt("mat3x3",Mt.f16,null),rt.mat3x4h=new rt("mat3x4",Mt.f16,null),rt.mat4x2h=new rt("mat4x2",Mt.f16,null),rt.mat4x3h=new rt("mat4x3",Mt.f16,null),rt.mat4x4h=new rt("mat4x4",Mt.f16,null),rt.mat2x2i=new rt("mat2x2",Mt.i32,null),rt.mat2x3i=new rt("mat2x3",Mt.i32,null),rt.mat2x4i=new rt("mat2x4",Mt.i32,null),rt.mat3x2i=new rt("mat3x2",Mt.i32,null),rt.mat3x3i=new rt("mat3x3",Mt.i32,null),rt.mat3x4i=new rt("mat3x4",Mt.i32,null),rt.mat4x2i=new rt("mat4x2",Mt.i32,null),rt.mat4x3i=new rt("mat4x3",Mt.i32,null),rt.mat4x4i=new rt("mat4x4",Mt.i32,null),rt.mat2x2u=new rt("mat2x2",Mt.u32,null),rt.mat2x3u=new rt("mat2x3",Mt.u32,null),rt.mat2x4u=new rt("mat2x4",Mt.u32,null),rt.mat3x2u=new rt("mat3x2",Mt.u32,null),rt.mat3x3u=new rt("mat3x3",Mt.u32,null),rt.mat3x4u=new rt("mat3x4",Mt.u32,null),rt.mat4x2u=new rt("mat4x2",Mt.u32,null),rt.mat4x3u=new rt("mat4x3",Mt.u32,null),rt.mat4x4u=new rt("mat4x4",Mt.u32,null);class by extends Mt{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class op extends Mt{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Yf extends Mt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class qo extends Ro{constructor(){super(),this.postfix=null}}class cu extends qo{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class aa extends qo{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class M1 extends qo{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return I3.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class uo extends qo{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class z3 extends qo{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Ki extends qo{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Ze}get isVector(){return this.value instanceof me||this.value instanceof rn}get scalarValue(){return this.value instanceof Ze?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof me||this.value instanceof rn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class U3 extends qo{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class sd extends qo{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class V3 extends qo{constructor(){super()}}class ji extends V3{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Bo extends V3{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Mt.f32:e.name==="u32"||t.name==="u32"?Mt.u32:Mt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class j3 extends Ro{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class xy extends qo{constructor(){super()}get astNodeType(){return"default"}}class H3 extends j3{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class W3 extends j3{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class vA extends Ro{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class J9 extends Ro{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class bA extends Ro{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class $3 extends Ro{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Co{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Co._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Co._id=0;class uw extends Co{constructor(){super(new Ao("void",null),null)}toString(){return"void"}}uw.void=new uw;class uh extends Co{constructor(e){super(new lw("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class Ze extends Co{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Ze(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ze(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ze(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);let l=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?l=Math.floor(l):this.typeInfo.name==="bool"&&(l=l?1:0),this.data[0]=l}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function Q9(r,e,t){const n=e.length;return n===2?t==="f32"?new me(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new me(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new me(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new me(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new me(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new me(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new me(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new me(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new me(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new me(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new me(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new me(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class me extends Co{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new me(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new me(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new me(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof cu?console.error("TODO: Set vector postfix"):t instanceof me?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof lu)i=this.typeInfo.format||i;else{const u=this.typeInfo.name;u==="vec2f"||u==="vec3f"||u==="vec4f"?i=e.getTypeInfo("f32"):u==="vec2i"||u==="vec3i"||u==="vec4i"?i=e.getTypeInfo("i32"):u==="vec2b"||u==="vec3b"||u==="vec4b"?i=e.getTypeInfo("bool"):u==="vec2u"||u==="vec3u"||u==="vec4u"?i=e.getTypeInfo("u32"):u==="vec2h"||u==="vec3h"||u==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${u}`)}let l=this;for(;t!==null&&l!==null;){if(t instanceof sd){const u=t.index;let a=-1;if(u instanceof Ki){if(!(u.value instanceof Ze))return console.error(`GetSubData: Invalid array index ${u.value}`),null;a=u.value.value}else{const p=e.evalExpression(u,n);if(!(p instanceof Ze))return console.error("GetSubData: Unknown index type",u),null;a=p.value}if(a<0||a>=l.data.length)return console.error("GetSubData: Index out of range",a),null;if(l.data instanceof Float32Array){const p=new Float32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Ze(p,i)}if(l.data instanceof Int32Array){const p=new Int32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Ze(p,i)}if(l.data instanceof Uint32Array){const p=new Uint32Array(l.data.buffer,l.data.byteOffset+4*a,1);return new Ze(p,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof cu))return console.error("GetSubData: Unknown postfix",t),null;{const u=t.value.toLowerCase();if(u.length===1){let p=0;if(u==="x"||u==="r")p=0;else if(u==="y"||u==="g")p=1;else if(u==="z"||u==="b")p=2;else{if(u!=="w"&&u!=="a")return console.error(`GetSubData: Unknown member ${u}`),null;p=3}if(this.data instanceof Float32Array){let y=new Float32Array(this.data.buffer,this.data.byteOffset+4*p,1);return new Ze(y,i,this)}if(this.data instanceof Int32Array){let y=new Int32Array(this.data.buffer,this.data.byteOffset+4*p,1);return new Ze(y,i,this)}if(this.data instanceof Uint32Array){let y=new Uint32Array(this.data.buffer,this.data.byteOffset+4*p,1);return new Ze(y,i,this)}}const a=[];for(const p of u)p==="x"||p==="r"?a.push(this.data[0]):p==="y"||p==="g"?a.push(this.data[1]):p==="z"||p==="b"?a.push(this.data[2]):p==="w"||p==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${p}`);l=Q9(e,a,i.name)}t=t.postfix}return l}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class rn extends Co{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new rn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof cu?console.error("TODO: Set matrix postfix"):t instanceof rn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof lu)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof sd){const l=t.index;let u=-1;if(l instanceof Ki){if(!(l.value instanceof Ze))return console.error(`GetDataValue: Invalid array index ${l.value}`),null;u=l.value.value}else{const y=e.evalExpression(l,n);if(!(y instanceof Ze))return console.error("GetDataValue: Unknown index type",l),null;u=y.value}if(u<0||u>=this.data.length)return console.error("GetDataValue: Index out of range",u),null;const a=i.endsWith("h")?"h":"f";let p;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")p=new me(new Float32Array(this.data.buffer,this.data.byteOffset+2*u*4,2),e.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")p=new me(new Float32Array(this.data.buffer,this.data.byteOffset+3*u*4,3),e.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;p=new me(new Float32Array(this.data.buffer,this.data.byteOffset+4*u*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?p.getSubData(e,t.postfix,n):p}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Pi extends Co{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Pi(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(t===null)return void console.log("setDataValue: NULL data.");let l=this.offset,u=this.typeInfo;for(;n;){if(n instanceof sd)if(u instanceof ic){const a=n.index;if(a instanceof Ki){if(!(a.value instanceof Ze))return void console.error(`SetDataValue: Invalid index type ${a.value}`);l+=a.value.value*u.stride}else{const p=e.evalExpression(a,i);if(!(p instanceof Ze))return void console.error("SetDataValue: Unknown index type",a);l+=p.value*u.stride}u=u.format}else console.error(`SetDataValue: Type ${u.getTypeName()} is not an array`);else{if(!(n instanceof cu))return void console.error("SetDataValue: Unknown postfix type",n);{const a=n.value;if(u instanceof Jl){let p=!1;for(const y of u.members)if(y.name===a){l+=y.offset,u=y.type,p=!0;break}if(!p)return void console.error(`SetDataValue: Member ${a} not found`)}else if(u instanceof Ao){const p=u.getTypeName();let y=0;if(a==="x"||a==="r")y=0;else if(a==="y"||a==="g")y=1;else if(a==="z"||a==="b")y=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);y=3}if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);const x=t.value;return p==="vec2f"?void(new Float32Array(this.buffer,l,2)[y]=x):p==="vec3f"?void(new Float32Array(this.buffer,l,3)[y]=x):p==="vec4f"?void(new Float32Array(this.buffer,l,4)[y]=x):p==="vec2i"?void(new Int32Array(this.buffer,l,2)[y]=x):p==="vec3i"?void(new Int32Array(this.buffer,l,3)[y]=x):p==="vec4i"?void(new Int32Array(this.buffer,l,4)[y]=x):p==="vec2u"?void(new Uint32Array(this.buffer,l,2)[y]=x):p==="vec3u"?void(new Uint32Array(this.buffer,l,3)[y]=x):p==="vec4u"?void(new Uint32Array(this.buffer,l,4)[y]=x):void console.error(`SetDataValue: Type ${p} is not a struct`)}}}n=n.postfix}this.setData(e,t,u,l,i)}setData(e,t,n,i,l){const u=n.getTypeName();if(u!=="f32"&&u!=="f16")if(u!=="i32"&&u!=="atomic<i32>"&&u!=="x32")if(u!=="u32"&&u!=="atomic<u32>")if(u!=="bool")if(u!=="vec2f"&&u!=="vec2h")if(u!=="vec3f"&&u!=="vec3h")if(u!=="vec4f"&&u!=="vec4h")if(u!=="vec2i")if(u!=="vec3i")if(u!=="vec4i")if(u!=="vec2u")if(u!=="vec3u")if(u!=="vec4u")if(u!=="vec2b")if(u!=="vec3b")if(u!=="vec4b")if(u!=="mat2x2f"&&u!=="mat2x2h")if(u!=="mat2x3f"&&u!=="mat2x3h")if(u!=="mat2x4f"&&u!=="mat2x4h")if(u!=="mat3x2f"&&u!=="mat3x2h")if(u!=="mat3x3f"&&u!=="mat3x3h")if(u!=="mat3x4f"&&u!=="mat3x4h")if(u!=="mat4x2f"&&u!=="mat4x2h")if(u!=="mat4x3f"&&u!=="mat4x3h")if(u!=="mat4x4f"&&u!=="mat4x4h")if(t instanceof Pi){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",u,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${u}`);else{const a=new Float32Array(this.buffer,i,16);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15])}else{const a=new Float32Array(this.buffer,i,12);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,i,8);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,i,12);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,i,9);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8])}else{const a=new Float32Array(this.buffer,i,6);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,i,8);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,i,6);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,i,4);t instanceof rn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,i,4);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,i,3);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,i,2);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Uint32Array(this.buffer,i,4);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,i,3);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,i,2);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Int32Array(this.buffer,i,4);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Int32Array(this.buffer,i,3);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Int32Array(this.buffer,i,2);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Float32Array(this.buffer,i,4);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Float32Array(this.buffer,i,3);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Float32Array(this.buffer,i,2);t instanceof me?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else t instanceof Ze&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Ze&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof Ze&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Ze&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,l,u;if(t===null)return this;let a=this.offset,p=this.typeInfo;for(;t;){if(t instanceof sd){const x=t.index,T=x instanceof qo?e.evalExpression(x,n):x;let E=0;if(T instanceof Ze?E=T.value:typeof T=="number"?E=T:console.error("GetDataValue: Invalid index type",x),p instanceof ic)a+=E*p.stride,p=p.format;else{const k=p.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(a+=16*E,p=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${p.getTypeName()} is not an array`)}}else{if(!(t instanceof cu))return console.error("GetDataValue: Unknown postfix type",t),null;{const x=t.value;if(p instanceof Jl){let T=!1;for(const E of p.members)if(E.name===x){a+=E.offset,p=E.type,T=!0;break}if(!T)return console.error(`GetDataValue: Member ${x} not found`),null}else if(p instanceof Ao){const T=p.getTypeName();if(T==="vec2f"||T==="vec3f"||T==="vec4f"||T==="vec2i"||T==="vec3i"||T==="vec4i"||T==="vec2u"||T==="vec3u"||T==="vec4u"||T==="vec2b"||T==="vec3b"||T==="vec4b"||T==="vec2h"||T==="vec3h"||T==="vec4h"||T==="vec2"||T==="vec3"||T==="vec4"){if(x.length>0&&x.length<5){let E="f";const k=[];for(let F=0;F<x.length;++F){const D=x[F].toLowerCase();let N=0;if(D==="x"||D==="r")N=0;else if(D==="y"||D==="g")N=1;else if(D==="z"||D==="b")N=2;else{if(D!=="w"&&D!=="a")return console.error(`Unknown member ${x}`),null;N=3}if(x.length===1){if(T.endsWith("f"))return this.buffer.byteLength<a+4*N+4?(console.log("Insufficient buffer data"),null):new Ze(new Float32Array(this.buffer,a+4*N,1),e.getTypeInfo("f32"),this);if(T.endsWith("h"))return new Ze(new Float32Array(this.buffer,a+4*N,1),e.getTypeInfo("f16"),this);if(T.endsWith("i"))return new Ze(new Int32Array(this.buffer,a+4*N,1),e.getTypeInfo("i32"),this);if(T.endsWith("b"))return new Ze(new Int32Array(this.buffer,a+4*N,1),e.getTypeInfo("bool"),this);if(T.endsWith("u"))return new Ze(new Uint32Array(this.buffer,a+4*N,1),e.getTypeInfo("i32"),this)}if(T==="vec2f")k.push(new Float32Array(this.buffer,a,2)[N]);else if(T==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const B=new Float32Array(this.buffer,a,3);k.push(B[N])}else if(T==="vec4f")k.push(new Float32Array(this.buffer,a,4)[N]);else if(T==="vec2i")E="i",k.push(new Int32Array(this.buffer,a,2)[N]);else if(T==="vec3i")E="i",k.push(new Int32Array(this.buffer,a,3)[N]);else if(T==="vec4i")E="i",k.push(new Int32Array(this.buffer,a,4)[N]);else if(T==="vec2u"){E="u";const B=new Uint32Array(this.buffer,a,2);k.push(B[N])}else T==="vec3u"?(E="u",k.push(new Uint32Array(this.buffer,a,3)[N])):T==="vec4u"&&(E="u",k.push(new Uint32Array(this.buffer,a,4)[N]))}return k.length===2?p=e.getTypeInfo(`vec2${E}`):k.length===3?p=e.getTypeInfo(`vec3${E}`):k.length===4?p=e.getTypeInfo(`vec4${E}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new me(k,p,null)}return console.error(`GetDataValue: Unknown member ${x}`),null}return console.error(`GetDataValue: Type ${T} is not a struct`),null}}}t=t.postfix}const y=p.getTypeName();return y==="f32"?new Ze(new Float32Array(this.buffer,a,1),p,this):y==="i32"?new Ze(new Int32Array(this.buffer,a,1),p,this):y==="u32"?new Ze(new Uint32Array(this.buffer,a,1),p,this):y==="vec2f"?new me(new Float32Array(this.buffer,a,2),p,this):y==="vec3f"?new me(new Float32Array(this.buffer,a,3),p,this):y==="vec4f"?new me(new Float32Array(this.buffer,a,4),p,this):y==="vec2i"?new me(new Int32Array(this.buffer,a,2),p,this):y==="vec3i"?new me(new Int32Array(this.buffer,a,3),p,this):y==="vec4i"?new me(new Int32Array(this.buffer,a,4),p,this):y==="vec2u"?new me(new Uint32Array(this.buffer,a,2),p,this):y==="vec3u"?new me(new Uint32Array(this.buffer,a,3),p,this):y==="vec4u"?new me(new Uint32Array(this.buffer,a,4),p,this):p instanceof lu&&p.name==="atomic"?((i=p.format)===null||i===void 0?void 0:i.name)==="u32"?new Ze(new Uint32Array(this.buffer,a,1)[0],p.format,this):((l=p.format)===null||l===void 0?void 0:l.name)==="i32"?new Ze(new Int32Array(this.buffer,a,1)[0],p.format,this):(console.error(`GetDataValue: Invalid atomic format ${(u=p.format)===null||u===void 0?void 0:u.name}`),null):new Pi(this.buffer,p,a,this)}toString(){let e="";if(this.typeInfo instanceof ic)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof Jl?e+="{...}":e="[...]";return e}}class Ha extends Co{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new Ha(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Kx[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Kx[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Kx[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,l=this.depthOrArrayLayers,u=this.dimension;return n/t.blockWidth*(u==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*l}getPixel(e,t,n=0,i=0){const l=this.texelByteSize,u=this.bytesPerRow,a=this.height,p=this.data[i];return X9(new Uint8Array(p),e,t,n,i,a,u,l,this.format)}setPixel(e,t,n,i,l){const u=this.texelByteSize,a=this.bytesPerRow,p=this.height,y=this.data[i];(function(x,T,E,k,F,D,N,B,V,U){const j=k*(N>>=F)*(D>>=F)+E*N+T*B;switch(V){case"r8unorm":return void Un(x,j,"8unorm",1,U);case"r8snorm":return void Un(x,j,"8snorm",1,U);case"r8uint":return void Un(x,j,"8uint",1,U);case"r8sint":return void Un(x,j,"8sint",1,U);case"rg8unorm":return void Un(x,j,"8unorm",2,U);case"rg8snorm":return void Un(x,j,"8snorm",2,U);case"rg8uint":return void Un(x,j,"8uint",2,U);case"rg8sint":return void Un(x,j,"8sint",2,U);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Un(x,j,"8unorm",4,U);case"rgba8snorm":return void Un(x,j,"8snorm",4,U);case"rgba8uint":return void Un(x,j,"8uint",4,U);case"rgba8sint":return void Un(x,j,"8sint",4,U);case"r16uint":return void Un(x,j,"16uint",1,U);case"r16sint":return void Un(x,j,"16sint",1,U);case"r16float":return void Un(x,j,"16float",1,U);case"rg16uint":return void Un(x,j,"16uint",2,U);case"rg16sint":return void Un(x,j,"16sint",2,U);case"rg16float":return void Un(x,j,"16float",2,U);case"rgba16uint":return void Un(x,j,"16uint",4,U);case"rgba16sint":return void Un(x,j,"16sint",4,U);case"rgba16float":return void Un(x,j,"16float",4,U);case"r32uint":return void Un(x,j,"32uint",1,U);case"r32sint":return void Un(x,j,"32sint",1,U);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Un(x,j,"32float",1,U);case"rg32uint":return void Un(x,j,"32uint",2,U);case"rg32sint":return void Un(x,j,"32sint",2,U);case"rg32float":return void Un(x,j,"32float",2,U);case"rgba32uint":return void Un(x,j,"32uint",4,U);case"rgba32sint":return void Un(x,j,"32sint",4,U);case"rgba32float":return void Un(x,j,"32float",4,U);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(y),e,t,n,i,p,a,u,this.format,l)}}(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(Ke||(Ke={}));class Ge{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class ue{}lt=ue,ue.none=new Ge("",Ke.reserved,""),ue.eof=new Ge("EOF",Ke.token,""),ue.reserved={asm:new Ge("asm",Ke.reserved,"asm"),bf16:new Ge("bf16",Ke.reserved,"bf16"),do:new Ge("do",Ke.reserved,"do"),enum:new Ge("enum",Ke.reserved,"enum"),f16:new Ge("f16",Ke.reserved,"f16"),f64:new Ge("f64",Ke.reserved,"f64"),handle:new Ge("handle",Ke.reserved,"handle"),i8:new Ge("i8",Ke.reserved,"i8"),i16:new Ge("i16",Ke.reserved,"i16"),i64:new Ge("i64",Ke.reserved,"i64"),mat:new Ge("mat",Ke.reserved,"mat"),premerge:new Ge("premerge",Ke.reserved,"premerge"),regardless:new Ge("regardless",Ke.reserved,"regardless"),typedef:new Ge("typedef",Ke.reserved,"typedef"),u8:new Ge("u8",Ke.reserved,"u8"),u16:new Ge("u16",Ke.reserved,"u16"),u64:new Ge("u64",Ke.reserved,"u64"),unless:new Ge("unless",Ke.reserved,"unless"),using:new Ge("using",Ke.reserved,"using"),vec:new Ge("vec",Ke.reserved,"vec"),void:new Ge("void",Ke.reserved,"void")},ue.keywords={array:new Ge("array",Ke.keyword,"array"),atomic:new Ge("atomic",Ke.keyword,"atomic"),bool:new Ge("bool",Ke.keyword,"bool"),f32:new Ge("f32",Ke.keyword,"f32"),i32:new Ge("i32",Ke.keyword,"i32"),mat2x2:new Ge("mat2x2",Ke.keyword,"mat2x2"),mat2x3:new Ge("mat2x3",Ke.keyword,"mat2x3"),mat2x4:new Ge("mat2x4",Ke.keyword,"mat2x4"),mat3x2:new Ge("mat3x2",Ke.keyword,"mat3x2"),mat3x3:new Ge("mat3x3",Ke.keyword,"mat3x3"),mat3x4:new Ge("mat3x4",Ke.keyword,"mat3x4"),mat4x2:new Ge("mat4x2",Ke.keyword,"mat4x2"),mat4x3:new Ge("mat4x3",Ke.keyword,"mat4x3"),mat4x4:new Ge("mat4x4",Ke.keyword,"mat4x4"),ptr:new Ge("ptr",Ke.keyword,"ptr"),sampler:new Ge("sampler",Ke.keyword,"sampler"),sampler_comparison:new Ge("sampler_comparison",Ke.keyword,"sampler_comparison"),struct:new Ge("struct",Ke.keyword,"struct"),texture_1d:new Ge("texture_1d",Ke.keyword,"texture_1d"),texture_2d:new Ge("texture_2d",Ke.keyword,"texture_2d"),texture_2d_array:new Ge("texture_2d_array",Ke.keyword,"texture_2d_array"),texture_3d:new Ge("texture_3d",Ke.keyword,"texture_3d"),texture_cube:new Ge("texture_cube",Ke.keyword,"texture_cube"),texture_cube_array:new Ge("texture_cube_array",Ke.keyword,"texture_cube_array"),texture_multisampled_2d:new Ge("texture_multisampled_2d",Ke.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ge("texture_storage_1d",Ke.keyword,"texture_storage_1d"),texture_storage_2d:new Ge("texture_storage_2d",Ke.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ge("texture_storage_2d_array",Ke.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ge("texture_storage_3d",Ke.keyword,"texture_storage_3d"),texture_depth_2d:new Ge("texture_depth_2d",Ke.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ge("texture_depth_2d_array",Ke.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ge("texture_depth_cube",Ke.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ge("texture_depth_cube_array",Ke.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ge("texture_depth_multisampled_2d",Ke.keyword,"texture_depth_multisampled_2d"),texture_external:new Ge("texture_external",Ke.keyword,"texture_external"),u32:new Ge("u32",Ke.keyword,"u32"),vec2:new Ge("vec2",Ke.keyword,"vec2"),vec3:new Ge("vec3",Ke.keyword,"vec3"),vec4:new Ge("vec4",Ke.keyword,"vec4"),bitcast:new Ge("bitcast",Ke.keyword,"bitcast"),block:new Ge("block",Ke.keyword,"block"),break:new Ge("break",Ke.keyword,"break"),case:new Ge("case",Ke.keyword,"case"),continue:new Ge("continue",Ke.keyword,"continue"),continuing:new Ge("continuing",Ke.keyword,"continuing"),default:new Ge("default",Ke.keyword,"default"),diagnostic:new Ge("diagnostic",Ke.keyword,"diagnostic"),discard:new Ge("discard",Ke.keyword,"discard"),else:new Ge("else",Ke.keyword,"else"),enable:new Ge("enable",Ke.keyword,"enable"),fallthrough:new Ge("fallthrough",Ke.keyword,"fallthrough"),false:new Ge("false",Ke.keyword,"false"),fn:new Ge("fn",Ke.keyword,"fn"),for:new Ge("for",Ke.keyword,"for"),function:new Ge("function",Ke.keyword,"function"),if:new Ge("if",Ke.keyword,"if"),let:new Ge("let",Ke.keyword,"let"),const:new Ge("const",Ke.keyword,"const"),loop:new Ge("loop",Ke.keyword,"loop"),while:new Ge("while",Ke.keyword,"while"),private:new Ge("private",Ke.keyword,"private"),read:new Ge("read",Ke.keyword,"read"),read_write:new Ge("read_write",Ke.keyword,"read_write"),return:new Ge("return",Ke.keyword,"return"),requires:new Ge("requires",Ke.keyword,"requires"),storage:new Ge("storage",Ke.keyword,"storage"),switch:new Ge("switch",Ke.keyword,"switch"),true:new Ge("true",Ke.keyword,"true"),alias:new Ge("alias",Ke.keyword,"alias"),type:new Ge("type",Ke.keyword,"type"),uniform:new Ge("uniform",Ke.keyword,"uniform"),var:new Ge("var",Ke.keyword,"var"),override:new Ge("override",Ke.keyword,"override"),workgroup:new Ge("workgroup",Ke.keyword,"workgroup"),write:new Ge("write",Ke.keyword,"write"),r8unorm:new Ge("r8unorm",Ke.keyword,"r8unorm"),r8snorm:new Ge("r8snorm",Ke.keyword,"r8snorm"),r8uint:new Ge("r8uint",Ke.keyword,"r8uint"),r8sint:new Ge("r8sint",Ke.keyword,"r8sint"),r16uint:new Ge("r16uint",Ke.keyword,"r16uint"),r16sint:new Ge("r16sint",Ke.keyword,"r16sint"),r16float:new Ge("r16float",Ke.keyword,"r16float"),rg8unorm:new Ge("rg8unorm",Ke.keyword,"rg8unorm"),rg8snorm:new Ge("rg8snorm",Ke.keyword,"rg8snorm"),rg8uint:new Ge("rg8uint",Ke.keyword,"rg8uint"),rg8sint:new Ge("rg8sint",Ke.keyword,"rg8sint"),r32uint:new Ge("r32uint",Ke.keyword,"r32uint"),r32sint:new Ge("r32sint",Ke.keyword,"r32sint"),r32float:new Ge("r32float",Ke.keyword,"r32float"),rg16uint:new Ge("rg16uint",Ke.keyword,"rg16uint"),rg16sint:new Ge("rg16sint",Ke.keyword,"rg16sint"),rg16float:new Ge("rg16float",Ke.keyword,"rg16float"),rgba8unorm:new Ge("rgba8unorm",Ke.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ge("rgba8unorm_srgb",Ke.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ge("rgba8snorm",Ke.keyword,"rgba8snorm"),rgba8uint:new Ge("rgba8uint",Ke.keyword,"rgba8uint"),rgba8sint:new Ge("rgba8sint",Ke.keyword,"rgba8sint"),bgra8unorm:new Ge("bgra8unorm",Ke.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ge("bgra8unorm_srgb",Ke.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ge("rgb10a2unorm",Ke.keyword,"rgb10a2unorm"),rg11b10float:new Ge("rg11b10float",Ke.keyword,"rg11b10float"),rg32uint:new Ge("rg32uint",Ke.keyword,"rg32uint"),rg32sint:new Ge("rg32sint",Ke.keyword,"rg32sint"),rg32float:new Ge("rg32float",Ke.keyword,"rg32float"),rgba16uint:new Ge("rgba16uint",Ke.keyword,"rgba16uint"),rgba16sint:new Ge("rgba16sint",Ke.keyword,"rgba16sint"),rgba16float:new Ge("rgba16float",Ke.keyword,"rgba16float"),rgba32uint:new Ge("rgba32uint",Ke.keyword,"rgba32uint"),rgba32sint:new Ge("rgba32sint",Ke.keyword,"rgba32sint"),rgba32float:new Ge("rgba32float",Ke.keyword,"rgba32float"),static_assert:new Ge("static_assert",Ke.keyword,"static_assert")},ue.tokens={decimal_float_literal:new Ge("decimal_float_literal",Ke.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ge("hex_float_literal",Ke.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ge("int_literal",Ke.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ge("uint_literal",Ke.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ge("name",Ke.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ge("ident",Ke.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ge("and",Ke.token,"&"),and_and:new Ge("and_and",Ke.token,"&&"),arrow:new Ge("arrow ",Ke.token,"->"),attr:new Ge("attr",Ke.token,"@"),forward_slash:new Ge("forward_slash",Ke.token,"/"),bang:new Ge("bang",Ke.token,"!"),bracket_left:new Ge("bracket_left",Ke.token,"["),bracket_right:new Ge("bracket_right",Ke.token,"]"),brace_left:new Ge("brace_left",Ke.token,"{"),brace_right:new Ge("brace_right",Ke.token,"}"),colon:new Ge("colon",Ke.token,":"),comma:new Ge("comma",Ke.token,","),equal:new Ge("equal",Ke.token,"="),equal_equal:new Ge("equal_equal",Ke.token,"=="),not_equal:new Ge("not_equal",Ke.token,"!="),greater_than:new Ge("greater_than",Ke.token,">"),greater_than_equal:new Ge("greater_than_equal",Ke.token,">="),shift_right:new Ge("shift_right",Ke.token,">>"),less_than:new Ge("less_than",Ke.token,"<"),less_than_equal:new Ge("less_than_equal",Ke.token,"<="),shift_left:new Ge("shift_left",Ke.token,"<<"),modulo:new Ge("modulo",Ke.token,"%"),minus:new Ge("minus",Ke.token,"-"),minus_minus:new Ge("minus_minus",Ke.token,"--"),period:new Ge("period",Ke.token,"."),plus:new Ge("plus",Ke.token,"+"),plus_plus:new Ge("plus_plus",Ke.token,"++"),or:new Ge("or",Ke.token,"|"),or_or:new Ge("or_or",Ke.token,"||"),paren_left:new Ge("paren_left",Ke.token,"("),paren_right:new Ge("paren_right",Ke.token,")"),semicolon:new Ge("semicolon",Ke.token,";"),star:new Ge("star",Ke.token,"*"),tilde:new Ge("tilde",Ke.token,"~"),underscore:new Ge("underscore",Ke.token,"_"),xor:new Ge("xor",Ke.token,"^"),plus_equal:new Ge("plus_equal",Ke.token,"+="),minus_equal:new Ge("minus_equal",Ke.token,"-="),times_equal:new Ge("times_equal",Ke.token,"*="),division_equal:new Ge("division_equal",Ke.token,"/="),modulo_equal:new Ge("modulo_equal",Ke.token,"%="),and_equal:new Ge("and_equal",Ke.token,"&="),or_equal:new Ge("or_equal",Ke.token,"|="),xor_equal:new Ge("xor_equal",Ke.token,"^="),shift_right_equal:new Ge("shift_right_equal",Ke.token,">>="),shift_left_equal:new Ge("shift_left_equal",Ke.token,"<<=")},ue.simpleTokens={"@":lt.tokens.attr,"{":lt.tokens.brace_left,"}":lt.tokens.brace_right,":":lt.tokens.colon,",":lt.tokens.comma,"(":lt.tokens.paren_left,")":lt.tokens.paren_right,";":lt.tokens.semicolon},ue.literalTokens={"&":lt.tokens.and,"&&":lt.tokens.and_and,"->":lt.tokens.arrow,"/":lt.tokens.forward_slash,"!":lt.tokens.bang,"[":lt.tokens.bracket_left,"]":lt.tokens.bracket_right,"=":lt.tokens.equal,"==":lt.tokens.equal_equal,"!=":lt.tokens.not_equal,">":lt.tokens.greater_than,">=":lt.tokens.greater_than_equal,">>":lt.tokens.shift_right,"<":lt.tokens.less_than,"<=":lt.tokens.less_than_equal,"<<":lt.tokens.shift_left,"%":lt.tokens.modulo,"-":lt.tokens.minus,"--":lt.tokens.minus_minus,".":lt.tokens.period,"+":lt.tokens.plus,"++":lt.tokens.plus_plus,"|":lt.tokens.or,"||":lt.tokens.or_or,"*":lt.tokens.star,"~":lt.tokens.tilde,_:lt.tokens.underscore,"^":lt.tokens.xor,"+=":lt.tokens.plus_equal,"-=":lt.tokens.minus_equal,"*=":lt.tokens.times_equal,"/=":lt.tokens.division_equal,"%=":lt.tokens.modulo_equal,"&=":lt.tokens.and_equal,"|=":lt.tokens.or_equal,"^=":lt.tokens.xor_equal,">>=":lt.tokens.shift_right_equal,"<<=":lt.tokens.shift_left_equal},ue.regexTokens={decimal_float_literal:lt.tokens.decimal_float_literal,hex_float_literal:lt.tokens.hex_float_literal,int_literal:lt.tokens.int_literal,uint_literal:lt.tokens.uint_literal,ident:lt.tokens.ident},ue.storage_class=[lt.keywords.function,lt.keywords.private,lt.keywords.workgroup,lt.keywords.uniform,lt.keywords.storage],ue.access_mode=[lt.keywords.read,lt.keywords.write,lt.keywords.read_write],ue.sampler_type=[lt.keywords.sampler,lt.keywords.sampler_comparison],ue.sampled_texture_type=[lt.keywords.texture_1d,lt.keywords.texture_2d,lt.keywords.texture_2d_array,lt.keywords.texture_3d,lt.keywords.texture_cube,lt.keywords.texture_cube_array],ue.multisampled_texture_type=[lt.keywords.texture_multisampled_2d],ue.storage_texture_type=[lt.keywords.texture_storage_1d,lt.keywords.texture_storage_2d,lt.keywords.texture_storage_2d_array,lt.keywords.texture_storage_3d],ue.depth_texture_type=[lt.keywords.texture_depth_2d,lt.keywords.texture_depth_2d_array,lt.keywords.texture_depth_cube,lt.keywords.texture_depth_cube_array,lt.keywords.texture_depth_multisampled_2d],ue.texture_external_type=[lt.keywords.texture_external],ue.any_texture_type=[...lt.sampled_texture_type,...lt.multisampled_texture_type,...lt.storage_texture_type,...lt.depth_texture_type,...lt.texture_external_type],ue.texel_format=[lt.keywords.r8unorm,lt.keywords.r8snorm,lt.keywords.r8uint,lt.keywords.r8sint,lt.keywords.r16uint,lt.keywords.r16sint,lt.keywords.r16float,lt.keywords.rg8unorm,lt.keywords.rg8snorm,lt.keywords.rg8uint,lt.keywords.rg8sint,lt.keywords.r32uint,lt.keywords.r32sint,lt.keywords.r32float,lt.keywords.rg16uint,lt.keywords.rg16sint,lt.keywords.rg16float,lt.keywords.rgba8unorm,lt.keywords.rgba8unorm_srgb,lt.keywords.rgba8snorm,lt.keywords.rgba8uint,lt.keywords.rgba8sint,lt.keywords.bgra8unorm,lt.keywords.bgra8unorm_srgb,lt.keywords.rgb10a2unorm,lt.keywords.rg11b10float,lt.keywords.rg32uint,lt.keywords.rg32sint,lt.keywords.rg32float,lt.keywords.rgba16uint,lt.keywords.rgba16sint,lt.keywords.rgba16float,lt.keywords.rgba32uint,lt.keywords.rgba32sint,lt.keywords.rgba32float],ue.const_literal=[lt.tokens.int_literal,lt.tokens.uint_literal,lt.tokens.decimal_float_literal,lt.tokens.hex_float_literal,lt.keywords.true,lt.keywords.false],ue.literal_or_ident=[lt.tokens.ident,lt.tokens.int_literal,lt.tokens.uint_literal,lt.tokens.decimal_float_literal,lt.tokens.hex_float_literal,lt.tokens.name],ue.element_count_expression=[lt.tokens.int_literal,lt.tokens.uint_literal,lt.tokens.ident],ue.template_types=[lt.keywords.vec2,lt.keywords.vec3,lt.keywords.vec4,lt.keywords.mat2x2,lt.keywords.mat2x3,lt.keywords.mat2x4,lt.keywords.mat3x2,lt.keywords.mat3x3,lt.keywords.mat3x4,lt.keywords.mat4x2,lt.keywords.mat4x3,lt.keywords.mat4x4,lt.keywords.atomic,lt.keywords.bitcast,...lt.any_texture_type],ue.attribute_name=[lt.tokens.ident,lt.keywords.block,lt.keywords.diagnostic],ue.assignment_operators=[lt.tokens.equal,lt.tokens.plus_equal,lt.tokens.minus_equal,lt.tokens.times_equal,lt.tokens.division_equal,lt.tokens.modulo_equal,lt.tokens.and_equal,lt.tokens.or_equal,lt.tokens.xor_equal,lt.tokens.shift_right_equal,lt.tokens.shift_left_equal],ue.increment_operators=[lt.tokens.plus_plus,lt.tokens.minus_minus];class xA{constructor(e,t,n,i,l){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=l}toString(){return this.lexeme}isTemplateType(){return ue.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ue.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class eH{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new xA(ue.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let u=1;for(;u>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),u--,u==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),u++)}return!0}}const t=ue.simpleTokens[e];if(t)return this._addToken(t),!0;let n=ue.none;const i=this._isAlpha(e),l=e==="_";if(this._isAlphaNumeric(e)){let u=this._peekAhead();for(;this._isAlphaNumeric(u);)e+=this._advance(),u=this._peekAhead()}if(i){const u=ue.keywords[e];if(u)return this._addToken(u),!0}if(i||l)return this._addToken(ue.tokens.ident),!0;for(;;){let u=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ue.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ue.tokens.minus_minus),!0;const p=this._tokens.length-1;if((ue.literal_or_ident.indexOf(this._tokens[p].type)!=-1||this._tokens[p].type==ue.tokens.paren_right)&&a!=">")return this._addToken(u),!0}if(e==">"&&(a==">"||a=="=")){let p=!1,y=this._tokens.length-1;for(let x=0;x<5&&y>=0&&ue.assignment_operators.indexOf(this._tokens[y].type)===-1;++x,--y)if(this._tokens[y].type===ue.tokens.less_than){y>0&&this._tokens[y-1].isArrayOrTemplateType()&&(p=!0);break}if(p)return this._addToken(u),!0}if(u===ue.none){let p=e,y=0;const x=2;for(let T=0;T<x;++T)if(p+=this._peekAhead(T),u=this._findType(p),u!==ue.none){y=T;break}if(u===ue.none)return n!==ue.none&&(this._current--,this._addToken(n),!0);e=p,this._current+=y+1}if(n=u,this._isAtEnd())break;e+=this._advance()}return n!==ue.none&&(this._addToken(n),!0)}_findType(e){for(const n in ue.regexTokens){const i=ue.regexTokens[n];if(this._match(e,i.rule))return i}return ue.literalTokens[e]||ue.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new xA(e,t,this._line,this._start,this._current))}}function cr(r){return Array.isArray(r)||(r==null?void 0:r.buffer)instanceof ArrayBuffer}const Jy=new Float32Array(1),tH=new Uint32Array(Jy.buffer),rH=new Uint32Array(Jy.buffer),Qy=new Int32Array(1),nH=new Float32Array(Qy.buffer),iH=new Uint32Array(Qy.buffer),ev=new Uint32Array(1),sH=new Float32Array(ev.buffer),oH=new Int32Array(ev.buffer);function wA(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return Jy[0]=r,tH[0];if(t==="u32")return Jy[0]=r,rH[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Qy[0]=r,nH[0];if(t==="u32")return Qy[0]=r,iH[0]}else if(e==="u32"){if(t==="f32")return ev[0]=r,sH[0];if(t==="i32"||t==="x32")return ev[0]=r,oH[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}class aH{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ty{constructor(e,t){this.align=e,this.size=t}}class pa{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new W9,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Sp&&this._functions.set(t.name,new aH(t));for(const t of e)if(t instanceof ja){const n=this.getTypeInfo(t,null);n instanceof Jl&&this.structs.push(n)}for(const t of e)if(t instanceof k1)this.aliases.push(this._getAliasInfo(t));else if(t instanceof P1){const n=t,i=this._getAttributeNum(n.attributes,"id",0),l=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new V9(n.name,l,n.attributes,i))}else if(this._isUniformVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),u=this.getTypeInfo(n.type,n.attributes),a=new ey(n.name,u,i,l,n.attributes,$l.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a)}else if(this._isStorageVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),u=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(u),p=new ey(n.name,u,i,l,n.attributes,a?$l.StorageTexture:$l.Storage,n.access);p.access||(p.access="read"),this.storage.push(p)}else if(this._isTextureVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),u=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(u),p=new ey(n.name,u,i,l,n.attributes,a?$l.StorageTexture:$l.Texture,n.access);p.access||(p.access="read"),a?this.storage.push(p):this.textures.push(p)}else if(this._isSamplerVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),l=this._getAttributeNum(n.attributes,"binding",0),u=this.getTypeInfo(n.type,n.attributes),a=new ey(n.name,u,i,l,n.attributes,$l.Sampler,n.access);this.samplers.push(a)}for(const t of e)if(t instanceof Sp){const n=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),l=this._getAttribute(t,"compute"),u=n||i||l,a=new H9(t.name,u==null?void 0:u.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,u&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!u),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[u.name].push(a)),a.arguments=t.args.map(p=>new j9(p.name,this.getTypeInfo(p.type,p.attributes),p.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var i,l,u;if(n instanceof $3){if(n.value)if(cr(n.value))for(const a of n.value)for(const p of this.overrides)a===p.name&&((i=t.info)===null||i===void 0||i.overrides.push(p));else for(const a of this.overrides)n.value===a.name&&((l=t.info)===null||l===void 0||l.overrides.push(a))}else if(n instanceof uo)for(const a of this.overrides)n.name===a.name&&((u=t.info)===null||u===void 0||u.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const l=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;l&&t.add(l)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==t)return l}for(const i of this.entry.vertex)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==t)return l}for(const i of this.entry.fragment)if(i.name===n){for(const l of i.resources)if(l.group==e&&l.binding==t)return l}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,l=[];return e.search(u=>{if(u instanceof Ky)l.push({});else if(u instanceof Gy)l.pop();else if(u instanceof Za){const a=u;t&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(u instanceof aa){const a=u;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(u instanceof sp){const a=u;t&&a.type!==null&&this._markStructsFromAST(a.type),l.length>0&&(l[l.length-1][a.name]=a)}else if(u instanceof uo){const a=u;if(l.length>0&&l[l.length-1][a.name])return;const p=i._findResource(a.name);p&&n.push(p)}else if(u instanceof M1){const a=u,p=i._functions.get(a.name);p&&(t&&(p.inUse=!0),e.calls.add(p.node),p.resources===null&&(p.resources=i._findResources(p.node,t)),n.push(...p.resources))}else if(u instanceof R1){const a=u,p=i._functions.get(a.name);p&&(t&&(p.inUse=!0),e.calls.add(p.node),p.resources===null&&(p.resources=i._findResources(p.node,t)),n.push(...p.resources))}}),[...new Map(n.map(u=>[u.name,u])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof ja)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ja)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const l=this.getTypeInfo(n.type,n.type.attributes),u=this._parseInt(i.value),a=new mA(n.name,l,i.name,u);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new mA("",n,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof ja)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ja)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),l=this._parseInt(t.value),u=new U9(e.name,i,t.name,l);return n!==null&&(u.interpolation=this._parseString(n.value)),u}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new z9(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof by){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,l=new lw(e.name,i,t);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof op){const i=e,l=i.format?this.getTypeInfo(i.format,i.attributes):null,u=new ic(i.name,t);return u.format=l,u.count=i.count,this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof ja){const i=e,l=new Jl(i.name,t);l.startLine=i.startLine,l.endLine=i.endLine;for(const u of i.members){const a=this.getTypeInfo(u.type,u.attributes);l.members.push(new gA(u.name,a,u.attributes))}return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof Yf){const i=e,l=i.format instanceof Mt,u=i.format?l?this.getTypeInfo(i.format,null):new Ao(i.format,null):null,a=new lu(i.name,u,t,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof rt){const i=e,l=i.format?this.getTypeInfo(i.format,null):null,u=new lu(i.name,l,t,i.access);return this._types.set(e,u),this._updateTypeInfo(u),u}const n=new Ao(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const l=this._getTypeSize(e);if(e.size=(t=l==null?void 0:l.size)!==null&&t!==void 0?t:0,e instanceof ic&&e.format){const u=this._getTypeSize(e.format);e.stride=Math.max((n=u==null?void 0:u.size)!==null&&n!==void 0?n:0,(i=u==null?void 0:u.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof lw&&this._updateTypeInfo(e.format),e instanceof Jl&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,l=0,u=0;for(let a=0,p=e.members.length;a<p;++a){const y=e.members[a],x=this._getTypeSize(y);if(!x)continue;(t=this._getAlias(y.type.name))!==null&&t!==void 0||y.type;const T=x.align,E=x.size;n=this._roundUp(T,n+i),i=E,l=n,u=Math.max(u,T),y.offset=n,y.size=E,this._updateTypeInfo(y.type)}e.size=this._roundUp(u,l+i),e.align=u}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),l=this._getAttributeNum(e.attributes,"align",0);if(e instanceof gA&&(e=e.type),e instanceof Ao){const u=this._getAlias(e.name);u!==null&&(e=u)}{const u=pa._typeInfo[e.name];if(u!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new ty(Math.max(l,u.align/a),Math.max(i,u.size/a))}}{const u=pa._typeInfo[e.name.substring(0,e.name.length-1)];if(u){const a=e.name[e.name.length-1]==="h"?2:1;return new ty(Math.max(l,u.align/a),Math.max(i,u.size/a))}}if(e instanceof ic){let u=e,a=8,p=8;const y=this._getTypeSize(u.format);return y!==null&&(p=y.size,a=y.align),p=u.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,p)),i&&(p=i),new ty(Math.max(l,a),Math.max(i,p))}if(e instanceof Jl){let u=0,a=0,p=0,y=0,x=0;for(const T of e.members){const E=this._getTypeSize(T.type);E!==null&&(u=Math.max(E.align,u),p=this._roundUp(E.align,p+y),y=E.size,x=p)}return a=this._roundUp(u,x+y),new ty(Math.max(l,u),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof Za&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Za&&e.storage=="storage"}_isTextureVar(e){return e instanceof Za&&e.type!==null&&pa._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Za&&e.type!==null&&pa._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let l of i)if(l.name==t)return l;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let l=i!==null&&i.value!==null?i.value:n;return l instanceof Array&&(l=l[0]),typeof l=="number"?l:typeof l=="string"?parseInt(l):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}pa._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},pa._textureTypes=ue.any_texture_type.map(r=>r.name),pa._samplerTypes=ue.sampler_type.map(r=>r.name);let O1=0;class D1{constructor(e,t,n){this.id=O1++,this.name=e,this.value=t,this.node=n}clone(){return new D1(this.name,this.value,this.node)}}class N1{constructor(e){this.id=O1++,this.name=e.name,this.node=e}clone(){return new N1(this.node)}}class F1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=O1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new D1(e,t,n??null))}setVariable(e,t,n){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n==null?void 0:n.value)!==null&&t!==void 0?t:null}clone(){return new F1(this)}}class lH{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class cH{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof me)return n.data.forEach(l=>{l||(i=!1)}),new Ze(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me){const i=n.data.some(l=>l);return new Ze(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Ze))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof Pi&&i.typeInfo.size===0){const l=i.typeInfo,u=i.buffer.byteLength/l.stride;return new Ze(u,this.getTypeInfo("u32"))}return new Ze(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.abs(l)),n.typeInfo);const i=n;return new Ze(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.acos(l)),n.typeInfo);const i=n;return new Ze(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.acosh(l)),n.typeInfo);const i=n;return new Ze(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.asin(l)),n.typeInfo);const i=n;return new Ze(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.asinh(l)),n.typeInfo);const i=n;return new Ze(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.atan(l)),n.typeInfo);const i=n;return new Ze(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.atanh(l)),n.typeInfo);const i=n;return new Ze(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me)return new me(n.data.map((a,p)=>Math.atan2(a,i.data[p])),n.typeInfo);const l=n,u=i;return new Ze(Math.atan2(l.value,u.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.ceil(l)),n.typeInfo);const i=n;return new Ze(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof me&&i instanceof me&&l instanceof me)return new me(n.data.map((y,x)=>this._clamp(y,i.data[x],l.data[x])),n.typeInfo);const u=n,a=i,p=l;return new Ze(this._clamp(u.value,a.value,p.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.cos(l)),n.typeInfo);const i=n;return new Ze(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.cosh(l)),n.typeInfo);const i=n;return new Ze(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.clz32(l)),n.typeInfo);const i=n;return new Ze(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>this._countOneBits(l)),n.typeInfo);const i=n;return new Ze(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>this._countTrailingZeros(l)),n.typeInfo);const i=n;return new Ze(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const l=n.data,u=i.data;return new me([l[1]*u[2]-u[1]*l[2],l[2]*u[0]-u[2]*l[0],l[0]*u[1]-u[0]*l[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof me?new me(n.data.map(l=>l*i),n.typeInfo):new Ze(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof rn){const i=n.data,l=n.typeInfo.getTypeName(),u=l.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(l==="mat2x2"||l==="mat2x2f"||l==="mat2x2h")return new Ze(i[0]*i[3]-i[1]*i[2],u);if(l==="mat2x3"||l==="mat2x3f"||l==="mat2x3h")return new Ze(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),u);if(l==="mat2x4"||l==="mat2x4f"||l==="mat2x4h")console.error(`TODO: Determinant for ${l}`);else if(l==="mat3x2"||l==="mat3x2f"||l==="mat3x2h")console.error(`TODO: Determinant for ${l}`);else{if(l==="mat3x3"||l==="mat3x3f"||l==="mat3x3h")return new Ze(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),u);l==="mat3x4"||l==="mat3x4f"||l==="mat3x4h"||l==="mat4x2"||l==="mat4x2f"||l==="mat4x2h"||l==="mat4x3"||l==="mat4x3f"||l==="mat4x3h"?console.error(`TODO: Determinant for ${l}`):l!=="mat4x4"&&l!=="mat4x4f"&&l!=="mat4x4h"||console.error(`TODO: Determinant for ${l}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me){let a=0;for(let p=0;p<n.data.length;++p)a+=(n.data[p]-i.data[p])*(n.data[p]-i.data[p]);return new Ze(Math.sqrt(a),this.getTypeInfo("f32"))}const l=n,u=i;return new Ze(Math.abs(l.value-u.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof me&&i instanceof me?new Ze(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.exp(l)),n.typeInfo);const i=n;return new Ze(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.pow(2,l)),n.typeInfo);const i=n;return new Ze(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const u=i.value,a=l.value;if(n instanceof me)return new me(n.data.map(y=>y>>u&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const p=n.value;return new Ze(p>>u&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof me&&i instanceof me&&l instanceof me){const u=this._dot(i.data,l.data);return new me(u<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>this._firstLeadingBit(l)),n.typeInfo);const i=n;return new Ze(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>this._firstTrailingBit(l)),n.typeInfo);const i=n;return new Ze(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.floor(l)),n.typeInfo);const i=n;return new Ze(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof me&&i instanceof me&&l instanceof me)return n.data.length!==i.data.length||n.data.length!==l.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new me(n.data.map((y,x)=>y*i.data[x]+l.data[x]),n.typeInfo);const u=n,a=i,p=l;return new Ze(u.value*a.value+p.value,u.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>l-Math.floor(l)),n.typeInfo);const i=n;return new Ze(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t),u=this.exec.evalExpression(e.args[3],t);if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=l.value,p=(1<<u.value)-1<<a,y=~p;if(n instanceof me&&i instanceof me)return new me(n.data.map((E,k)=>E&y|i.data[k]<<a&p),n.typeInfo);const x=n.value,T=i.value;return new Ze(x&y|T<<a&p,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>1/Math.sqrt(l)),n.typeInfo);const i=n;return new Ze(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me){let l=0;return n.data.forEach(u=>{l+=u*u}),new Ze(Math.sqrt(l),this.getTypeInfo("f32"))}const i=n;return new Ze(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.log(l)),n.typeInfo);const i=n;return new Ze(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.log2(l)),n.typeInfo);const i=n;return new Ze(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me)return new me(n.data.map((a,p)=>Math.max(a,i.data[p])),n.typeInfo);const l=n,u=i;return new Ze(Math.max(l.value,u.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me)return new me(n.data.map((a,p)=>Math.min(a,i.data[p])),n.typeInfo);const l=n,u=i;return new Ze(Math.min(l.value,u.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof me&&i instanceof me&&l instanceof me)return new me(n.data.map((p,y)=>n.data[y]*(1-l.data[y])+i.data[y]*l.data[y]),n.typeInfo);const u=i,a=l;return new Ze(n.value*(1-a.value)+u.value*a.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me)return new me(n.data.map((u,a)=>u%i.data[a]),n.typeInfo);const l=i;return new Ze(n.value%l.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me){const i=this.Length(e,t).value;return new me(n.data.map(l=>l/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me)return new me(n.data.map((a,p)=>Math.pow(a,i.data[p])),n.typeInfo);const l=n,u=i;return new Ze(Math.pow(l.value,u.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof me?new me(n.data.map(i=>i),n.typeInfo):new Ze(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof me?new me(n.data.map(i=>i*Math.PI/180),n.typeInfo):new Ze(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof me&&i instanceof me){const l=this._dot(n.data,i.data);return new me(n.data.map((u,a)=>u-2*l*i.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(n instanceof me&&i instanceof me&&l instanceof Ze){const u=this._dot(i.data,n.data);return new me(n.data.map((a,p)=>{const y=1-l.value*l.value*(1-u*u);if(y<0)return 0;const x=Math.sqrt(y);return l.value*a-(l.value*u+x)*i.data[p]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.round(l)),n.typeInfo);const i=n;return new Ze(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.min(Math.max(l,0),1)),n.typeInfo);const i=n;return new Ze(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.sign(l)),n.typeInfo);const i=n;return new Ze(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.sin(l)),n.typeInfo);const i=n;return new Ze(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.sinh(l)),n.typeInfo);const i=n;return new Ze(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),l=this.exec.evalExpression(e.args[2],t);if(l instanceof me&&n instanceof me&&i instanceof me)return new me(l.data.map((y,x)=>this._smoothstep(n.data[x],i.data[x],y)),l.typeInfo);const u=n,a=i,p=l;return new Ze(this._smoothstep(u.value,a.value,p.value),l.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.sqrt(l)),n.typeInfo);const i=n;return new Ze(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof me&&n instanceof me)return new me(i.data.map((u,a)=>u<n.data[a]?0:1),i.typeInfo);const l=n;return new Ze(i.value<l.value?0:1,l.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.tan(l)),n.typeInfo);const i=n;return new Ze(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.tanh(l)),n.typeInfo);const i=n;return new Ze(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof rn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const l=n.data;return new rn([l[0],l[2],l[1],l[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const l=n.data;return new rn([l[0],l[3],l[6],l[1],l[4],l[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const l=n.data;return new rn([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const l=n.data;return new rn([l[0],l[3],l[1],l[4],l[2],l[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const l=n.data;return new rn([l[0],l[3],l[6],l[1],l[4],l[7],l[2],l[5],l[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const l=n.data;return new rn([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const l=n.data;return new rn([l[0],l[4],l[1],l[5],l[2],l[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const l=n.data;return new rn([l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const l=n.data;return new rn([l[0],l[4],l[8],l[12],l[1],l[5],l[9],l[13],l[2],l[6],l[10],l[14],l[3],l[7],l[11],l[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof me)return new me(n.data.map(l=>Math.trunc(l)),n.typeInfo);const i=n;return new Ze(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof uo){const l=n.name,u=t.getVariableValue(l);if(u instanceof Ha){if(i<0||i>=u.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=u.getMipLevelSize(i),p=u.dimension;return p==="1d"?new Ze(a[0],this.getTypeInfo("u32")):p==="3d"?new me(a,this.getTypeInfo("vec3u")):p==="2d"?new me(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${p} not found. Line ${e.line}`),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),l=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof me)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof uo){const u=n.name,a=t.getVariableValue(u);if(a instanceof Ha){const p=Math.floor(i.data[0]),y=Math.floor(i.data[1]);if(p<0||p>=a.width||y<0||y>=a.height)return console.error(`Texture ${u} out of bounds. Line ${e.line}`),null;const x=a.getPixel(p,y,0,l);return x===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new me(x,this.getTypeInfo("vec4f"))}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof uo){const i=n.name,l=t.getVariableValue(i);return l instanceof Ha?new Ze(l.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof uo){const i=n.name,l=t.getVariableValue(i);return l instanceof Ha?new Ze(l.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof uo){const i=n.name,l=t.getVariableValue(i);return l instanceof Ha?new Ze(l.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),l=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,u=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(u.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof me)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof uo){const a=n.name,p=t.getVariableValue(a);if(p instanceof Ha){const y=p.getMipLevelSize(0),x=Math.floor(i.data[0]),T=Math.floor(i.data[1]);return x<0||x>=y[0]||T<0||T>=y[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(p.setPixel(x,T,0,l,Array.from(u)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t);return p instanceof Ze&&a instanceof Ze&&(p.value=a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value+=a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicSub(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value-=a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicMax(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=Math.max(p.value,a.value)),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicMin(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=Math.min(p.value,a.value)),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicAnd(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=p.value&a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicOr(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=p.value|a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicXor(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=p.value^a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicExchange(e,t){let n=e.args[0];n instanceof ji&&(n=n.right);const i=this.exec.getVariableName(n,t),l=t.getVariable(i);let u=e.args[1];const a=this.exec.evalExpression(u,t),p=l.value.getSubData(this.exec,n.postfix,t),y=new Ze(p.value,p.typeInfo);return p instanceof Ze&&a instanceof Ze&&(p.value=a.value),l.value instanceof Pi&&l.value.setDataValue(this.exec,p,n.postfix,t),y}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Gx={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Ns={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Is extends lH{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new pa,this.reflection.updateAST(this.ast),this.context=(n=t==null?void 0:t.clone())!==null&&n!==void 0?n:new F1,this.builtins=new cH(this),this.typeInfo={bool:this.getTypeInfo(Mt.bool),i32:this.getTypeInfo(Mt.i32),u32:this.getTypeInfo(Mt.u32),f32:this.getTypeInfo(Mt.f32),f16:this.getTypeInfo(Mt.f16),vec2f:this.getTypeInfo(rt.vec2f),vec2u:this.getTypeInfo(rt.vec2u),vec2i:this.getTypeInfo(rt.vec2i),vec2h:this.getTypeInfo(rt.vec2h),vec3f:this.getTypeInfo(rt.vec3f),vec3u:this.getTypeInfo(rt.vec3u),vec3i:this.getTypeInfo(rt.vec3i),vec3h:this.getTypeInfo(rt.vec3h),vec4f:this.getTypeInfo(rt.vec4f),vec4u:this.getTypeInfo(rt.vec4u),vec4i:this.getTypeInfo(rt.vec4i),vec4h:this.getTypeInfo(rt.vec4h),mat2x2f:this.getTypeInfo(rt.mat2x2f),mat2x3f:this.getTypeInfo(rt.mat2x3f),mat2x4f:this.getTypeInfo(rt.mat2x4f),mat3x2f:this.getTypeInfo(rt.mat3x2f),mat3x3f:this.getTypeInfo(rt.mat3x3f),mat3x4f:this.getTypeInfo(rt.mat3x4f),mat4x2f:this.getTypeInfo(rt.mat4x2f),mat4x3f:this.getTypeInfo(rt.mat4x3f),mat4x4f:this.getTypeInfo(rt.mat4x4f)}}getVariableValue(e){var t,n;const i=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof Ze)return i.value;if(i instanceof me||i instanceof rn)return Array.from(i.data);if(i instanceof Pi&&i.typeInfo instanceof ic){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const l=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,l),this._execStatements(this.ast,l);const u=l.getFunction(e);if(!u)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],p=t[1],y=t[2],x=this.getTypeInfo("vec3u");l.setVariable("@num_workgroups",new me(t,x));for(const T in n)for(const E in n[T]){const k=n[T][E];l.variables.forEach(F=>{var D;const N=F.node;if(N!=null&&N.attributes){let B=null,V=null;for(const U of N.attributes)U.name==="binding"?B=U.value:U.name==="group"&&(V=U.value);if(E==B&&T==V)if(k.texture!==void 0&&k.descriptor!==void 0){const U=new Ha(k.texture,this.getTypeInfo(N.type),k.descriptor,(D=k.texture.view)!==null&&D!==void 0?D:null);F.value=U}else k.uniform!==void 0?F.value=new Pi(k.uniform,this.getTypeInfo(N.type)):F.value=new Pi(k,this.getTypeInfo(N.type))}})}for(let T=0;T<y;++T)for(let E=0;E<p;++E)for(let k=0;k<a;++k)l.setVariable("@workgroup_id",new me([k,E,T],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(u,[k,E,T],l)}execStatement(e,t){if(e instanceof N3)return this.evalExpression(e.value,t);if(e instanceof B3){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))throw new Error("Invalid break-if condition");if(!n.value)return null}return Is._breakObj}if(e instanceof L3)return Is._continueObj;if(e instanceof sp)this._let(e,t);else if(e instanceof Za)this._var(e,t);else if(e instanceof vy)this._const(e,t);else if(e instanceof Sp)this._function(e,t);else{if(e instanceof D3)return this._if(e,t);if(e instanceof O3)return this._switch(e,t);if(e instanceof P3)return this._for(e,t);if(e instanceof C3)return this._while(e,t);if(e instanceof M3)return this._loop(e,t);if(e instanceof cw){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof k3)this._assign(e,t);else if(e instanceof R3)this._increment(e,t);else{if(e instanceof ja)return null;if(e instanceof P1){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new Ze(0,this.getTypeInfo("u32")))}else if(e instanceof R1)this._call(e,t);else{if(e instanceof F3||e instanceof k1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Bo?this._evalBinaryOp(e,t):e instanceof Ki?this._evalLiteral(e,t):e instanceof uo?this._evalVariable(e,t):e instanceof M1?this._evalCall(e,t):e instanceof aa?this._evalCreate(e,t):e instanceof z3?this._evalConst(e,t):e instanceof U3?this._evalBitcast(e,t):e instanceof ji?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Mt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],l=this.reflection.getOverrideInfo(n);l!==null?(l.type===null&&(l.type=this.getTypeInfo("u32")),l.type.name==="u32"||l.type.name==="i32"||l.type.name==="f32"||l.type.name==="f16"?t.setVariable(n,new Ze(i,l.type)):l.type.name==="bool"?t.setVariable(n,new Ze(i?1:0,l.type)):l.type.name==="vec2"||l.type.name==="vec3"||l.type.name==="vec4"||l.type.name==="vec2f"||l.type.name==="vec3f"||l.type.name==="vec4f"||l.type.name==="vec2i"||l.type.name==="vec3i"||l.type.name==="vec4i"||l.type.name==="vec2u"||l.type.name==="vec3u"||l.type.name==="vec4u"||l.type.name==="vec2h"||l.type.name==="vec3h"||l.type.name==="vec4h"?t.setVariable(n,new me(i,l.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const x of e.node.attributes)if(x.name==="workgroup_size"){if(x.value.length>0){const T=n.getVariableValue(x.value[0]);i[0]=T instanceof Ze?T.value:parseInt(x.value[0])}if(x.value.length>1){const T=n.getVariableValue(x.value[1]);i[1]=T instanceof Ze?T.value:parseInt(x.value[1])}if(x.value.length>2){const T=n.getVariableValue(x.value[2]);i[2]=T instanceof Ze?T.value:parseInt(x.value[2])}}const l=this.getTypeInfo("vec3u"),u=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new me(i,l));const a=i[0],p=i[1],y=i[2];for(let x=0,T=0;x<y;++x)for(let E=0;E<p;++E)for(let k=0;k<a;++k,++T){const F=[k,E,x],D=[k+t[0]*i[0],E+t[1]*i[1],x+t[2]*i[2]];n.setVariable("@local_invocation_id",new me(F,l)),n.setVariable("@global_invocation_id",new me(D,l)),n.setVariable("@local_invocation_index",new Ze(T,u)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const l=`@${i.value}`,u=t.getVariable(l);u!==void 0&&t.variables.set(n.name,u)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ji;)e=e.right;return e instanceof uo?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const l=t.clone(),u=this._execStatements(n,l);if(u)return u;continue}const i=this.execStatement(n,t);if(i)return i}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let l=0;l<i.node.args.length;++l){const u=i.node.args[l],a=this.evalExpression(e.args[l],n);n.setVariable(u.name,a,u)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?e.operator==="++"?i.value instanceof Ze?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof Ze?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof uo){const n=this.getVariableName(e,t),i=t.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof ji){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof uh?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new uh(n)}}return null}_assign(e,t){let n=null,i="<var>",l=null;if(e.variable instanceof ji){const p=this._getVariableData(e.variable,t),y=this.evalExpression(e.value,t),x=e.operator;if(x==="="){if(p instanceof Ze||p instanceof me||p instanceof rn){if(y instanceof Ze||y instanceof me||y instanceof rn&&p.data.length===y.data.length)return void p.data.set(y.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(p instanceof Pi&&y instanceof Pi&&p.buffer.byteLength-p.offset>=y.buffer.byteLength-y.offset)return void(p.buffer.byteLength%4==0?new Uint32Array(p.buffer,p.offset,p.typeInfo.size/4).set(new Uint32Array(y.buffer,y.offset,y.typeInfo.size/4)):new Uint8Array(p.buffer,p.offset,p.typeInfo.size).set(new Uint8Array(y.buffer,y.offset,y.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(x==="+=")return p instanceof Ze||p instanceof me||p instanceof rn?y instanceof Ze||y instanceof me||y instanceof rn?void p.data.set(y.data.map((T,E)=>p.data[E]+T)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(x==="-=")return(p instanceof Ze||p instanceof me||p instanceof rn)&&(y instanceof Ze||y instanceof me||y instanceof rn)?void p.data.set(y.data.map((T,E)=>p.data[E]-T)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ji){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const p=t.getVariable(i);if(!(p&&p.value instanceof uh))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=p.value.reference;let y=e.variable.postfix;if(!y){let x=e.variable.right;for(;x instanceof ji;){if(x.postfix){y=x.postfix;break}x=x.right}}y&&(n=n.getSubData(this,y,t))}}else{l=e.variable.postfix,i=this.getVariableName(e.variable,t);const p=t.getVariable(i);if(p===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=p.value}if(n instanceof uh&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const u=this.evalExpression(e.value,t),a=e.operator;if(a==="=")if(n instanceof Pi)n.setDataValue(this,u,l,t);else if(l){if(!(n instanceof me||n instanceof rn))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(l instanceof sd){const p=this.evalExpression(l.index,t).value;if(n instanceof me){if(!(u instanceof Ze))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[p]=u.value}else{if(!(n instanceof rn))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const y=this.evalExpression(l.index,t).value;if(y<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(u instanceof me))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const x=n.typeInfo.getTypeName();if(x==="mat2x2"||x==="mat2x2f"||x==="mat2x2h"){if(!(y<2&&u.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*y]=u.data[0],n.data[2*y+1]=u.data[1]}else if(x==="mat2x3"||x==="mat2x3f"||x==="mat2x3h"){if(!(y<2&&u.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*y]=u.data[0],n.data[3*y+1]=u.data[1],n.data[3*y+2]=u.data[2]}else if(x==="mat2x4"||x==="mat2x4f"||x==="mat2x4h"){if(!(y<2&&u.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*y]=u.data[0],n.data[4*y+1]=u.data[1],n.data[4*y+2]=u.data[2],n.data[4*y+3]=u.data[3]}else if(x==="mat3x2"||x==="mat3x2f"||x==="mat3x2h"){if(!(y<3&&u.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*y]=u.data[0],n.data[2*y+1]=u.data[1]}else if(x==="mat3x3"||x==="mat3x3f"||x==="mat3x3h"){if(!(y<3&&u.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*y]=u.data[0],n.data[3*y+1]=u.data[1],n.data[3*y+2]=u.data[2]}else if(x==="mat3x4"||x==="mat3x4f"||x==="mat3x4h"){if(!(y<3&&u.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*y]=u.data[0],n.data[4*y+1]=u.data[1],n.data[4*y+2]=u.data[2],n.data[4*y+3]=u.data[3]}else if(x==="mat4x2"||x==="mat4x2f"||x==="mat4x2h"){if(!(y<4&&u.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*y]=u.data[0],n.data[2*y+1]=u.data[1]}else if(x==="mat4x3"||x==="mat4x3f"||x==="mat4x3h"){if(!(y<4&&u.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*y]=u.data[0],n.data[3*y+1]=u.data[1],n.data[3*y+2]=u.data[2]}else{if(x!=="mat4x4"&&x!=="mat4x4f"&&x!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(y<4&&u.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*y]=u.data[0],n.data[4*y+1]=u.data[1],n.data[4*y+2]=u.data[2],n.data[4*y+3]=u.data[3]}}}}}else if(l instanceof cu){const p=l.value;if(!(n instanceof me))return void console.error(`Invalid assignment to ${p}. Variable ${i} is not a vector. Line ${e.line}`);if(u instanceof Ze){if(p.length>1)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);if(p==="x")n.data[0]=u.value;else if(p==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[1]=u.value}else if(p==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[2]=u.value}else if(p==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[3]=u.value}}else{if(!(u instanceof me))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(p.length!==u.data.length)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);for(let y=0;y<p.length;++y){const x=p[y];if(x==="x"||x==="r")n.data[0]=u.data[y];else if(x==="y"||x==="g"){if(u.data.length<2)return void console.error(`Invalid assignment to ${x} for variable ${i}. Line ${e.line}`);n.data[1]=u.data[y]}else if(x==="z"||x==="b"){if(u.data.length<3)return void console.error(`Invalid assignment to ${x} for variable ${i}. Line ${e.line}`);n.data[2]=u.data[y]}else{if(x!=="w"&&x!=="a")return void console.error(`Invalid assignment to ${x} for variable ${i}. Line ${e.line}`);if(u.data.length<4)return void console.error(`Invalid assignment to ${x} for variable ${i}. Line ${e.line}`);n.data[3]=u.data[y]}}}}}else n instanceof Ze&&u instanceof Ze?n.value=u.value:n instanceof me&&u instanceof me||n instanceof rn&&u instanceof rn?n.data.set(u.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const p=n.getSubData(this,l,t);if(p instanceof me&&u instanceof Ze){const y=p.data,x=u.value;if(a==="+=")for(let T=0;T<y.length;++T)y[T]+=x;else if(a==="-=")for(let T=0;T<y.length;++T)y[T]-=x;else if(a==="*=")for(let T=0;T<y.length;++T)y[T]*=x;else if(a==="/=")for(let T=0;T<y.length;++T)y[T]/=x;else if(a==="%=")for(let T=0;T<y.length;++T)y[T]%=x;else if(a==="&=")for(let T=0;T<y.length;++T)y[T]&=x;else if(a==="|=")for(let T=0;T<y.length;++T)y[T]|=x;else if(a==="^=")for(let T=0;T<y.length;++T)y[T]^=x;else if(a==="<<=")for(let T=0;T<y.length;++T)y[T]<<=x;else if(a===">>=")for(let T=0;T<y.length;++T)y[T]>>=x;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(p instanceof me&&u instanceof me){const y=p.data,x=u.data;if(y.length!==x.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let T=0;T<y.length;++T)y[T]+=x[T];else if(a==="-=")for(let T=0;T<y.length;++T)y[T]-=x[T];else if(a==="*=")for(let T=0;T<y.length;++T)y[T]*=x[T];else if(a==="/=")for(let T=0;T<y.length;++T)y[T]/=x[T];else if(a==="%=")for(let T=0;T<y.length;++T)y[T]%=x[T];else if(a==="&=")for(let T=0;T<y.length;++T)y[T]&=x[T];else if(a==="|=")for(let T=0;T<y.length;++T)y[T]|=x[T];else if(a==="^=")for(let T=0;T<y.length;++T)y[T]^=x[T];else if(a==="<<=")for(let T=0;T<y.length;++T)y[T]<<=x[T];else if(a===">>=")for(let T=0;T<y.length;++T)y[T]>>=x[T];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(p instanceof Ze&&u instanceof Ze))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?p.value+=u.value:a==="-="?p.value-=u.value:a==="*="?p.value*=u.value:a==="/="?p.value/=u.value:a==="%="?p.value%=u.value:a==="&="?p.value&=u.value:a==="|="?p.value|=u.value:a==="^="?p.value^=u.value:a==="<<="?p.value<<=u.value:a===">>="?p.value>>=u.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}n instanceof Pi&&n.setDataValue(this,p,l,t)}}_function(e,t){const n=new N1(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ji||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const l=new aa(e.type,[]);n=this._evalCreate(l,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ji||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof op||e.type instanceof ja||e.type instanceof rt){const l=new aa(e.type,[]);n=this._evalCreate(l,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const l of e.cases)if(l instanceof H3)for(const u of l.selectors){if(u instanceof xy){i=l;continue}const a=this.evalExpression(u,t);if(!(a instanceof Ze))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===n.value)return this._execStatements(l.body,t)}else l instanceof W3&&(i=l);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const l=this.evalExpression(i.condition,t);if(!(l instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(l.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Ze?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Is._breakObj)break;if(n!==null&&n!==Is._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Is._breakObj)break;if(n===Is._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Is._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Is._breakObj)break;if(n!==Is._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof Ze){const l=wA(n.value,n.typeInfo.name,i.name);return new Ze(l,this.getTypeInfo(i))}if(n instanceof me){const l=n.typeInfo.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;u="f16"}const a=i.getTypeName();let p="";if(a.endsWith("f"))p="f32";else if(a.endsWith("i"))p="i32";else if(a.endsWith("u"))p="u32";else if(a.endsWith("b"))p="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${p}. Line ${e.line}`),null;p="f16"}const y=function(x,T,E){if(T===E)return x;const k=new Array(x.length);for(let F=0;F<x.length;F++)k[F]=wA(x[F],T,E);return k}(Array.from(n.data),u,p);return new me(y,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof aa){if(e.type===null)return uw.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof aa?e.type.name:e.name,l=e instanceof aa?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(l===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(l.size===0)return null;const u=new Pi(new ArrayBuffer(l.size),l,0);if(l instanceof Jl){if(e.args)for(let a=0;a<e.args.length;++a){const p=l.members[a],y=e.args[a],x=this.evalExpression(y,t);u.setData(this,x,p.type,p.offset,t)}}else if(l instanceof ic){let a=0;if(e.args)for(let p=0;p<e.args.length;++p){const y=e.args[p],x=this.evalExpression(y,t);l.format===null&&(((n=x.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?l.format=this.getTypeInfo("i32"):l.format=x.typeInfo),u.setData(this,x,l.format,a,t),a+=l.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof aa?u.getSubData(this,e.postfix,t):u}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new Ze(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Is._priority.get(t.name);Is._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new uh(n);if(e.operator==="*")return n instanceof uh?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof Ze?n.value:n instanceof me?Array.from(n.data):null;switch(e.operator){case"+":{if(cr(i)){const a=i.map((p,y)=>+p);return new me(a,n.typeInfo)}const l=i,u=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(+l,u)}case"-":{if(cr(i)){const a=i.map((p,y)=>-p);return new me(a,n.typeInfo)}const l=i,u=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(-l,u)}case"!":{if(cr(i)){const a=i.map((p,y)=>p?0:1);return new me(a,n.typeInfo)}const l=i,u=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(l?0:1,u)}case"~":{if(cr(i)){const a=i.map((p,y)=>~p);return new me(a,n.typeInfo)}const l=i,u=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(~l,u)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),l=n instanceof Ze?n.value:n instanceof me||n instanceof rn?Array.from(n.data):null,u=i instanceof Ze?i.value:i instanceof me||i instanceof rn?Array.from(i.data):null;switch(e.operator){case"+":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k+T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E+x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x+E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a+p,y)}case"-":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k-T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E-x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x-E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a-p,y)}case"*":{if(cr(l)&&cr(u)){const x=l,T=u;if(n instanceof rn&&i instanceof rn){const E=function(N,B,V,U){if(Ns[B.name]===void 0||Ns[U.name]===void 0)return null;const j=Ns[B.name][0],J=Ns[B.name][1],oe=Ns[U.name][0];if(j!==Ns[U.name][1])return null;const le=new Array(oe*J);for(let Ce=0;Ce<J;Ce++)for(let Ie=0;Ie<oe;Ie++){let Ue=0;for(let De=0;De<j;De++)Ue+=N[De*J+Ce]*V[Ie*j+De];le[Ce*oe+Ie]=Ue}return le}(x,n.typeInfo,T,i.typeInfo);if(E===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const k=Ns[i.typeInfo.name][0],F=Ns[n.typeInfo.name][1],D=this.getTypeInfo(`mat${k}x${F}f`);return new rn(E,D)}if(n instanceof rn&&i instanceof me){const E=function(k,F,D,N){if(Ns[F.name]===void 0||Gx[N.name]===void 0)return null;const B=Ns[F.name][0],V=Ns[F.name][1];if(B!==D.length)return null;const U=new Array(V);for(let j=0;j<V;j++){let J=0;for(let oe=0;oe<B;oe++)J+=k[oe*V+j]*D[oe];U[j]=J}return U}(x,n.typeInfo,T,i.typeInfo);return E===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new me(E,i.typeInfo)}if(n instanceof me&&i instanceof rn){const E=function(k,F,D,N){if(Gx[F.name]===void 0||Ns[N.name]===void 0)return null;const B=Ns[N.name][0],V=Ns[N.name][1];if(V!==k.length)return null;const U=[];for(let j=0;j<B;j++){let J=0;for(let oe=0;oe<V;oe++)J+=k[oe]*D[oe*B+j];U[j]=J}return U}(x,n.typeInfo,T,i.typeInfo);return E===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new me(E,n.typeInfo)}{if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k*T[F]);return new me(E,n.typeInfo)}}if(cr(l)){const x=u,T=l.map((E,k)=>E*x);return n instanceof rn?new rn(T,n.typeInfo):new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x*E);return i instanceof rn?new rn(T,i.typeInfo):new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a*p,y)}case"%":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k%T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E%x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x%E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a%p,y)}case"/":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k/T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E/x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x/E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a/p,y)}case"&":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k&T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E&x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x&E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a&p,y)}case"|":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k|T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E|x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x|E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a|p,y)}case"^":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k^T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E^x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x^E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a^p,y)}case"<<":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k<<T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E<<x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x<<E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a<<p,y)}case">>":{if(cr(l)&&cr(u)){const x=l,T=u;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const E=x.map((k,F)=>k>>T[F]);return new me(E,n.typeInfo)}if(cr(l)){const x=u,T=l.map((E,k)=>E>>x);return new me(T,n.typeInfo)}if(cr(u)){const x=l,T=u.map((E,k)=>x>>E);return new me(T,i.typeInfo)}const a=l,p=u,y=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ze(a>>p,y)}case">":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x>p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y>a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a>y?1:0);return new me(p,i.typeInfo)}return new Ze(l>u?1:0,this.getTypeInfo("bool"));case"<":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x<p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y<a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a<y?1:0);return new me(p,i.typeInfo)}return new Ze(l<u?1:0,this.getTypeInfo("bool"));case"==":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x===p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y==a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a==y?1:0);return new me(p,i.typeInfo)}return new Ze(l===u?1:0,this.getTypeInfo("bool"));case"!=":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x!==p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y!==a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a!==y?1:0);return new me(p,i.typeInfo)}return new Ze(l!==u?1:0,this.getTypeInfo("bool"));case">=":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x>=p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y>=a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a>=y?1:0);return new me(p,i.typeInfo)}return new Ze(l>=u?1:0,this.getTypeInfo("bool"));case"<=":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x<=p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y<=a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a<=y?1:0);return new me(p,i.typeInfo)}return new Ze(l<=u?1:0,this.getTypeInfo("bool"));case"&&":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x&&p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y&&a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a&&y?1:0);return new me(p,i.typeInfo)}return new Ze(l&&u?1:0,this.getTypeInfo("bool"));case"||":if(cr(l)&&cr(u)){const a=l,p=u;if(a.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=a.map((x,T)=>x||p[T]?1:0);return new me(y,n.typeInfo)}if(cr(l)){const a=u,p=l.map((y,x)=>y||a?1:0);return new me(p,n.typeInfo)}if(cr(u)){const a=l,p=u.map((y,x)=>a||y?1:0);return new me(p,i.typeInfo)}return new Ze(l||u?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let l=0;l<i.node.args.length;++l){const u=i.node.args[l],a=this.evalExpression(e.args[l],n);n.createVariable(u.name,a,u)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let l=0;l<n.node.args.length;++l){const u=n.node.args[l],a=this.evalExpression(e.args[l],i);i.setVariable(u.name,a,u)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Ze(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),l=Gx[i];if(l===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const u=[];if(e instanceof Ki)if(e.isVector){const a=e.vectorValue;for(const p of a)u.push(p)}else u.push(e.scalarValue);else if(e.args)for(const a of e.args){const p=this.evalExpression(a,t);if(p instanceof me){const y=p.data;for(let x=0;x<y.length;++x){let T=y[x];u.push(T)}}else if(p instanceof Ze){let y=p.value;u.push(y)}}if(e.type instanceof rt&&e.type.format===null&&(e.type.format=rt.f32),u.length===0){const a=new Array(l).fill(0);return new me(a,n).getSubData(this,e.postfix,t)}if(u.length===1)for(;u.length<l;)u.push(u[0]);return u.length<l?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new me(u.length>l?u.slice(0,l):u,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),l=Ns[i];if(l===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const u=[];if(e instanceof Ki)if(e.isVector){const a=e.vectorValue;for(const p of a)u.push(p)}else u.push(e.scalarValue);else if(e.args)for(const a of e.args){const p=this.evalExpression(a,t);p instanceof me?u.push(...p.data):p instanceof Ze?u.push(p.value):p instanceof rn&&u.push(...p.data)}if(n instanceof lu&&n.format===null&&(n.format=this.getTypeInfo("f32")),u.length===0){const a=new Array(l[2]).fill(0);return new rn(a,n).getSubData(this,e.postfix,t)}return u.length!==l[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new rn(u,n).getSubData(this,e.postfix,t)}}Is._breakObj=new Co(new Ao("BREAK",null),null),Is._continueObj=new Co(new Ao("CONTINUE",null),null),Is._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class uH{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class hH{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new uH,this._exec=new Is,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,l=n.countNode;if(l instanceof uo){const u=l.name,a=this._context.constants.get(u);if(a)try{const p=a.constEvaluate(this._exec);i.count=p}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(i=>{i instanceof bA||i instanceof by?i.type=this._forwardType(i.type):i instanceof op?i.format=this._forwardType(i.format):i instanceof Za||i instanceof sp||i instanceof vy?i.type=this._forwardType(i.type):i instanceof Sp?i.returnType=this._forwardType(i.returnType):i instanceof vA&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof yA){const t=this._getType(e.name);if(t)return t}else e instanceof by?e.type=this._forwardType(e.type):e instanceof op&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new eH(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ue.eof}_match(e){if(e instanceof Ge)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const l of e){if(n===l)return!0;l===ue.tokens.name&&(i=!0)}if(i){const l=ue.tokens.name.rule.exec(t.lexeme);if(l&&l.index==0&&l[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===ue.tokens.name){const n=ue.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ue.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ue.keywords.alias)){const t=this._type_alias();return this._consume(ue.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ue.keywords.diagnostic)){const t=this._diagnostic();return this._consume(ue.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ue.keywords.requires)){const t=this._requires_directive();return this._consume(ue.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ue.keywords.enable)){const t=this._enable_directive();return this._consume(ue.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(ue.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(ue.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ue.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(ue.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ue.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(ue.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ue.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(ue.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ue.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(ue.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(ue.keywords.fn))return null;const e=this._currentLine,t=this._consume(ue.tokens.ident,"Expected function name.").toString();this._consume(ue.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ue.tokens.paren_right))do{if(this._check(ue.tokens.paren_right))break;const a=this._attribute(),p=this._consume(ue.tokens.name,"Expected argument name.").toString();this._consume(ue.tokens.colon,"Expected ':' for argument type.");const y=this._attribute(),x=this._type_decl();x!=null&&(x.attributes=y,n.push(this._updateNode(new vA(p,x,a))))}while(this._match(ue.tokens.comma));this._consume(ue.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(ue.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const l=this._compound_statement(),u=this._currentLine;return this._updateNode(new Sp(t,n,i,l,e,u),e)}_compound_statement(){const e=[];for(this._consume(ue.tokens.brace_left,"Expected '{' for block.");!this._check(ue.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(ue.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ue.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ue.tokens.attr)&&this._attribute(),this._check(ue.keywords.if))return this._if_statement();if(this._check(ue.keywords.switch))return this._switch_statement();if(this._check(ue.keywords.loop))return this._loop_statement();if(this._check(ue.keywords.for))return this._for_statement();if(this._check(ue.keywords.while))return this._while_statement();if(this._check(ue.keywords.continuing))return this._continuing_statement();if(this._check(ue.keywords.static_assert))return this._static_assert_statement();if(this._check(ue.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ue.keywords.return))e=this._return_statement();else if(this._check([ue.keywords.var,ue.keywords.let,ue.keywords.const]))e=this._variable_statement();else if(this._match(ue.keywords.discard))e=this._updateNode(new G9);else if(this._match(ue.keywords.break)){const t=this._updateNode(new B3);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(ue.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(ue.keywords.continue)){const t=this._updateNode(new L3);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ue.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ue.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Z9(t),e)}_while_statement(){if(!this._match(ue.keywords.while))return null;const e=this._updateNode(new C3(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ue.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ue.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new cw(n,e),t)}_for_statement(){if(!this._match(ue.keywords.for))return null;this._consume(ue.tokens.paren_left,"Expected '('.");const e=this._updateNode(new P3(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ue.tokens.semicolon)?null:this._for_init(),this._consume(ue.tokens.semicolon,"Expected ';'."),e.condition=this._check(ue.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ue.tokens.semicolon,"Expected ';'."),e.increment=this._check(ue.tokens.paren_right)?null:this._for_increment(),this._consume(ue.tokens.paren_right,"Expected ')'."),this._check(ue.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ue.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ue.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Za(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(ue.keywords.let)){const e=this._currentLine,t=this._consume(ue.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ue.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(ue.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new sp(t,n,null,null,i),e)}if(this._match(ue.keywords.const)){const e=this._currentLine,t=this._consume(ue.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ue.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}this._consume(ue.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof Ki&&(n=i.type),this._updateNode(new vy(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(ue.increment_operators))return this._current=e,null;const n=this._consume(ue.increment_operators,"Expected increment operator");return this._updateNode(new R3(n.type===ue.tokens.plus_plus?yh.increment:yh.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(ue.tokens.brace_right))return null;let n=this._match(ue.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(ue.assignment_operators,"Expected assignment operator."),l=this._short_circuit_or_expression();return this._updateNode(new k3(Zf.parse(i.lexeme),e,l),t)}_func_call_statement(){if(!this._check(ue.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(ue.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new R1(n.lexeme,i),e)}_loop_statement(){if(!this._match(ue.keywords.loop))return null;this._check(ue.tokens.attr)&&this._attribute(),this._consume(ue.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new M3([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof cw){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(ue.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ue.keywords.switch))return null;const e=this._updateNode(new O3(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ue.tokens.attr)&&this._attribute(),this._consume(ue.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ue.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([ue.keywords.default,ue.keywords.case]);){if(this._match(ue.keywords.case)){const n=this._case_selectors();for(const l of n)if(l instanceof xy){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(ue.tokens.colon),this._check(ue.tokens.attr)&&this._attribute(),this._consume(ue.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(ue.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new H3(n,i)))}if(this._match(ue.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ue.tokens.colon),this._check(ue.tokens.attr)&&this._attribute(),this._consume(ue.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ue.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new W3(n)))}}return e}_case_selectors(){const e=[];for(this._match(ue.keywords.default)?e.push(this._updateNode(new xy)):e.push(this._shift_expression());this._match(ue.tokens.comma);)this._match(ue.keywords.default)?e.push(this._updateNode(new xy)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ue.keywords.fallthrough))return this._consume(ue.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(ue.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(ue.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(ue.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let l=null;return this._match(ue.keywords.else)&&(this._check(ue.tokens.attr)&&this._attribute(),l=this._compound_statement()),this._updateNode(new D3(t,n,i,l),e)}_match_elseif(){return this._tokens[this._current].type===ue.keywords.else&&this._tokens[this._current+1].type===ue.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new J9(t,n))),this._match_elseif()&&(this._check(ue.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ue.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new N3(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ue.tokens.or_or);)e=this._updateNode(new Bo(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ue.tokens.and_and);)e=this._updateNode(new Bo(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ue.tokens.or);)e=this._updateNode(new Bo(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ue.tokens.xor);)e=this._updateNode(new Bo(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ue.tokens.and);)e=this._updateNode(new Bo(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ue.tokens.equal_equal,ue.tokens.not_equal])?this._updateNode(new Bo(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ue.tokens.less_than,ue.tokens.greater_than,ue.tokens.less_than_equal,ue.tokens.greater_than_equal]);)e=this._updateNode(new Bo(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ue.tokens.shift_left,ue.tokens.shift_right]);)e=this._updateNode(new Bo(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ue.tokens.plus,ue.tokens.minus]);)e=this._updateNode(new Bo(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ue.tokens.star,ue.tokens.forward_slash,ue.tokens.modulo]);)e=this._updateNode(new Bo(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ue.tokens.minus,ue.tokens.bang,ue.tokens.tilde,ue.tokens.star,ue.tokens.and])?this._updateNode(new ji(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ue.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ue.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new sd(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(ue.tokens.period)){const e=this._consume(ue.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new cu(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Mt.void;case"bool":return Mt.bool;case"i32":return Mt.i32;case"u32":return Mt.u32;case"f32":return Mt.f32;case"f16":return Mt.f16;case"vec2f":return rt.vec2f;case"vec3f":return rt.vec3f;case"vec4f":return rt.vec4f;case"vec2i":return rt.vec2i;case"vec3i":return rt.vec3i;case"vec4i":return rt.vec4i;case"vec2u":return rt.vec2u;case"vec3u":return rt.vec3u;case"vec4u":return rt.vec4u;case"vec2h":return rt.vec2h;case"vec3h":return rt.vec3h;case"vec4h":return rt.vec4h;case"mat2x2f":return rt.mat2x2f;case"mat2x3f":return rt.mat2x3f;case"mat2x4f":return rt.mat2x4f;case"mat3x2f":return rt.mat3x2f;case"mat3x3f":return rt.mat3x3f;case"mat3x4f":return rt.mat3x4f;case"mat4x2f":return rt.mat4x2f;case"mat4x3f":return rt.mat4x3f;case"mat4x4f":return rt.mat4x4f;case"mat2x2h":return rt.mat2x2h;case"mat2x3h":return rt.mat2x3h;case"mat2x4h":return rt.mat2x4h;case"mat3x2h":return rt.mat3x2h;case"mat3x3h":return rt.mat3x3h;case"mat3x4h":return rt.mat3x4h;case"mat4x2h":return rt.mat4x2h;case"mat4x3h":return rt.mat4x3h;case"mat4x4h":return rt.mat4x4h;case"mat2x2i":return rt.mat2x2i;case"mat2x3i":return rt.mat2x3i;case"mat2x4i":return rt.mat2x4i;case"mat3x2i":return rt.mat3x2i;case"mat3x3i":return rt.mat3x3i;case"mat3x4i":return rt.mat3x4i;case"mat4x2i":return rt.mat4x2i;case"mat4x3i":return rt.mat4x3i;case"mat4x4i":return rt.mat4x4i;case"mat2x2u":return rt.mat2x2u;case"mat2x3u":return rt.mat2x3u;case"mat2x4u":return rt.mat2x4u;case"mat3x2u":return rt.mat3x2u;case"mat3x3u":return rt.mat3x3u;case"mat3x4u":return rt.mat3x4u;case"mat4x2u":return rt.mat4x2u;case"mat4x3u":return rt.mat4x3u;case"mat4x4u":return rt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ue.tokens.ident)){const n=this._previous().toString();if(this._check(ue.tokens.paren_left)){const i=this._argument_expression_list(),l=this._getType(n);return l!==null?this._updateNode(new aa(l,i)):this._updateNode(new M1(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new z3(n,i.value))}return this._updateNode(new uo(n))}if(this._match(ue.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Mt.i32:n.endsWith("u")||n.endsWith("U")?Mt.u32:Mt.x32;const l=parseInt(n);return this._validateTypeRange(l,i),this._updateNode(new Ki(new Ze(l,this._exec.getTypeInfo(i)),i))}if(this._match(ue.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Mt.u32),this._updateNode(new Ki(new Ze(n,this._exec.getTypeInfo(Mt.u32)),Mt.u32))}if(this._match([ue.tokens.decimal_float_literal,ue.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const l=parseFloat(n);this._validateTypeRange(l,i?Mt.f16:Mt.f32);const u=i?Mt.f16:Mt.f32;return this._updateNode(new Ki(new Ze(l,this._exec.getTypeInfo(u)),u))}if(this._match([ue.keywords.true,ue.keywords.false])){let n=this._previous().toString()===ue.keywords.true.rule;return this._updateNode(new Ki(new Ze(n?1:0,this._exec.getTypeInfo(Mt.bool)),Mt.bool))}if(this._check(ue.tokens.paren_left))return this._paren_expression();if(this._match(ue.keywords.bitcast)){this._consume(ue.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ue.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new U3(n,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new aa(e,t))}_argument_expression_list(){if(!this._match(ue.tokens.paren_left))return null;const e=[];do{if(this._check(ue.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ue.tokens.comma));return this._consume(ue.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ue.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ue.tokens.paren_right),e}_paren_expression(){this._consume(ue.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ue.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ue.keywords.struct))return null;const e=this._currentLine,t=this._consume(ue.tokens.ident,"Expected name for struct.").toString();this._consume(ue.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ue.tokens.brace_right);){const u=this._attribute(),a=this._consume(ue.tokens.name,"Expected variable name.").toString();this._consume(ue.tokens.colon,"Expected ':' for struct member type.");const p=this._attribute(),y=this._type_decl();y!=null&&(y.attributes=p),this._check(ue.tokens.brace_right)?this._match(ue.tokens.comma):this._consume(ue.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new bA(a,y,u)))}this._consume(ue.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,l=this._updateNode(new ja(t,n,e,i),e);return this._context.structs.set(t,l),l}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ue.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Ki){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Ki&&(e.type=e.value.type.name==="x32"?Mt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ue.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ue.keywords.const))return null;const t=this._consume(ue.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(ue.tokens.colon)){const p=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=p)}let l=null;this._consume(ue.tokens.equal,"const declarations require an assignment");const u=this._short_circuit_or_expression();try{let p=[Mt.f32],y=u.constEvaluate(this._exec,p);y instanceof Ze&&this._validateTypeRange(y.value,p[0]),p[0]instanceof rt&&p[0].format===null&&y.typeInfo instanceof lu&&y.typeInfo.format!==null&&(y.typeInfo.format.name==="f16"?p[0].format=Mt.f16:y.typeInfo.format.name==="f32"?p[0].format=Mt.f32:y.typeInfo.format.name==="i32"?p[0].format=Mt.i32:y.typeInfo.format.name==="u32"?p[0].format=Mt.u32:y.typeInfo.format.name==="bool"?p[0].format=Mt.bool:console.error(`TODO: impelement template format type ${y.typeInfo.format.name}`)),l=this._updateNode(new Ki(y,p[0])),this._exec.context.setVariable(t.toString(),y)}catch{l=u}if(i!==null&&l instanceof Ki){if(l.type.name!=="x32"&&i.getTypeName()!==l.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${l.type.name} to ${i.name}. Line:${this._currentLine}`);l.type=i,l.isScalar&&this._validateTypeRange(l.scalarValue,l.type)}else i===null&&l instanceof Ki&&(i=(e=l==null?void 0:l.type)!==null&&e!==void 0?e:Mt.f32,i===Mt.x32&&(i=Mt.i32));const a=this._updateNode(new vy(t.toString(),i,"","",l),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ue.keywords.let))return null;const e=this._currentLine,t=this._consume(ue.tokens.name,"Expected variable name");let n=null;if(this._match(ue.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}let i=null;if(this._match(ue.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof Ki){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof Ki&&(n=i.type.name==="x32"?Mt.i32:i.type);return i instanceof Ki&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new sp(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ue.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(ue.tokens.less_than)&&(t=this._consume(ue.storage_class,"Expected storage_class.").toString(),this._match(ue.tokens.comma)&&(n=this._consume(ue.access_mode,"Expected access_mode.").toString()),this._consume(ue.tokens.greater_than,"Expected '>'."));const i=this._consume(ue.tokens.name,"Expected variable name");let l=null;if(this._match(ue.tokens.colon)){const u=this._attribute();l=this._type_decl(),l!=null&&(l.attributes=u)}return this._updateNode(new Za(i.toString(),l,t,n,null),e)}_override_decl(){if(!this._match(ue.keywords.override))return null;const e=this._consume(ue.tokens.name,"Expected variable name");let t=null;if(this._match(ue.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new P1(e.toString(),t,null))}_diagnostic(){this._consume(ue.tokens.paren_left,"Expected '('");const e=this._consume(ue.tokens.ident,"Expected severity control name.");this._consume(ue.tokens.comma,"Expected ','");let t=this._consume(ue.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ue.tokens.period)&&(t+=`.${this._consume(ue.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ue.tokens.paren_right,"Expected ')'"),this._updateNode(new F3(e.toString(),t))}_enable_directive(){const e=this._consume(ue.tokens.ident,"identity expected.");return this._updateNode(new Y9(e.toString()))}_requires_directive(){const e=[this._consume(ue.tokens.ident,"identity expected.").toString()];for(;this._match(ue.tokens.comma);){const t=this._consume(ue.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new K9(e))}_type_alias(){const e=this._consume(ue.tokens.ident,"identity expected.");this._consume(ue.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new k1(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ue.tokens.ident,...ue.texel_format,ue.keywords.bool,ue.keywords.f32,ue.keywords.i32,ue.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new yA(n));return this._forwardTypeCount++,i}return this._updateNode(new Mt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ue.template_types)){let n=this._advance().toString(),i=null,l=null;return this._match(ue.tokens.less_than)&&(i=this._type_decl(),l=null,this._match(ue.tokens.comma)&&(l=this._consume(ue.access_mode,"Expected access_mode for pointer").toString()),this._consume(ue.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new rt(n,i,l))}if(this._match(ue.keywords.ptr)){let n=this._previous().toString();this._consume(ue.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(ue.storage_class,"Expected storage_class for pointer");this._consume(ue.tokens.comma,"Expected ',' for pointer.");const l=this._type_decl();let u=null;return this._match(ue.tokens.comma)&&(u=this._consume(ue.access_mode,"Expected access_mode for pointer").toString()),this._consume(ue.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new by(n,i.toString(),l,u))}const t=this._attribute();if(this._match(ue.keywords.array)){let n=null,i=-1;const l=this._previous();let u=null;if(this._match(ue.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let p="";if(this._match(ue.tokens.comma)){u=this._shift_expression();try{p=u.constEvaluate(this._exec).toString(),u=null}catch{p="1"}}this._consume(ue.tokens.greater_than,"Expected '>' for array."),i=p?parseInt(p):0}const a=this._updateNode(new op(l.toString(),t,n,i));return u&&this._deferArrayCountEval.push({arrayType:a,countNode:u}),a}return null}_texture_sampler_types(){if(this._match(ue.sampler_type))return this._updateNode(new Yf(this._previous().toString(),null,null));if(this._match(ue.depth_texture_type))return this._updateNode(new Yf(this._previous().toString(),null,null));if(this._match(ue.sampled_texture_type)||this._match(ue.multisampled_texture_type)){const e=this._previous();this._consume(ue.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ue.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Yf(e.toString(),t,null))}if(this._match(ue.storage_texture_type)){const e=this._previous();this._consume(ue.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ue.texel_format,"Invalid texel format.").toString();this._consume(ue.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ue.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ue.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Yf(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(ue.tokens.attr);){const t=this._consume(ue.attribute_name,"Expected attribute name"),n=this._updateNode(new $3(t.toString(),null));if(this._match(ue.tokens.paren_left)){if(n.value=this._consume(ue.literal_or_ident,"Expected attribute value").toString(),this._check(ue.tokens.comma)){this._advance();do{const i=this._consume(ue.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(ue.tokens.comma))}this._consume(ue.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class dH extends pa{constructor(e){super(),e&&this.update(e)}update(e){const t=new hH().parse(e);this.updateAST(t)}}function fH(r){var l;const e={attributes:[],bindings:[]};let t;try{t=pH(r)}catch(u){return Xt.error(u.message)(),e}for(const u of t.uniforms){const a=[];for(const p of((l=u.type)==null?void 0:l.members)||[])a.push({name:p.name,type:TA(p.type)});e.bindings.push({type:"uniform",name:u.name,location:u.binding,group:u.group,members:a})}const n=t.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let u=0;u<i;u++){const a=n.inputs[u];if(a.locationType==="location"){const p=TA(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:p})}}return e}function TA(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function pH(r){try{return new dH(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const gH=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,mH={name:"fp32",vs:gH},_H=[0,1,1,1],yH=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,vH=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,SA={name:"picking",vs:yH,fs:vH,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:_H},getUniforms:bH};function bH(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(r.highlightColor){const n=Array.from(r.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}function q3(r,e=[],t=0){const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function xH(r){return r-Math.fround(r)}function wH(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;q3(r[n*4+t],e,i*2)}return e}const TH=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,SH={ONE:1};function AH(){return SH}const EH={name:"fp64-arithmetic",vs:TH,getUniforms:AH,fp64ify:q3,fp64LowPart:xH,fp64ifyMatrix4:wH},IH={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...IH}};const Eo=globalThis.mathgl.config;function CH(r,{precision:e=Eo.precision}={}){return r=PH(r),`${parseFloat(r.toPrecision(e))}`}function od(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Ql(r,e,t){return kH(r,n=>Math.max(e,Math.min(t,n)))}function tv(r,e,t){return od(r)?r.map((n,i)=>tv(n,e[i],t)):t*e+(1-t)*r}function Ap(r,e,t){const n=Eo.EPSILON;try{if(r===e)return!0;if(od(r)&&od(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Ap(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=Eo.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{Eo.EPSILON=n}}function PH(r){return Math.round(r/Eo.EPSILON)*Eo.EPSILON}function RH(r){return r.clone?r.clone():new Array(r.length)}function kH(r,e,t){if(od(r)){const n=r;t=t||RH(n);for(let i=0;i<t.length&&i<n.length;++i){const l=typeof r=="number"?r:r[i];t[i]=e(l,i,t)}return t}return e(r)}class X3 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:od(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Eo)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+CH(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ap(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const l=e[i],u=typeof t=="number"?t:t[i];this[i]=l+n*(u-l)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Eo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function MH(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function lo(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Jx(r,e,t=""){if(Eo.debug&&!MH(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function AA(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class OH extends X3{get x(){return this[0]}set x(e){this[0]=lo(e)}get y(){return this[1]}set y(e){this[1]=lo(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return lo(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return lo(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return AA(e>=0&&e<this.ELEMENTS,"index is out of range"),lo(this[e])}setComponent(e,t){return AA(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const wy=1e-6;let ad=typeof Float32Array<"u"?Float32Array:Array;function DH(){const r=new ad(2);return ad!=Float32Array&&(r[0]=0,r[1]=0),r}function EA(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function NH(r,e){return r[0]=-e[0],r[1]=-e[1],r}function Z3(r,e,t,n){const i=e[0],l=e[1];return r[0]=i+n*(t[0]-i),r[1]=l+n*(t[1]-l),r}function FH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=DH();return function(e,t,n,i,l,u){let a,p;for(t||(t=2),n||(n=0),i?p=Math.min(i*t+n,e.length):p=e.length,a=n;a<p;a+=t)r[0]=e[a],r[1]=e[a+1],l(r,r,u),e[a]=r[0],e[a+1]=r[1];return e}})();function BH(r,e,t){const n=e[0],i=e[1],l=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/l,r[1]=(t[1]*n+t[5]*i)/l,r}function Y3(r,e,t){const n=e[0],i=e[1],l=e[2],u=t[3]*n+t[7]*i+t[11]*l||1;return r[0]=(t[0]*n+t[4]*i+t[8]*l)/u,r[1]=(t[1]*n+t[5]*i+t[9]*l)/u,r[2]=(t[2]*n+t[6]*i+t[10]*l)/u,r}function LH(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function zH(){const r=new ad(3);return ad!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function UH(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function VH(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function jH(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function HH(r,e,t){const n=e[0],i=e[1],l=e[2],u=t[0],a=t[1],p=t[2];return r[0]=i*p-l*a,r[1]=l*u-n*p,r[2]=n*a-i*u,r}function K3(r,e,t){const n=e[0],i=e[1],l=e[2];let u=t[3]*n+t[7]*i+t[11]*l+t[15];return u=u||1,r[0]=(t[0]*n+t[4]*i+t[8]*l+t[12])/u,r[1]=(t[1]*n+t[5]*i+t[9]*l+t[13])/u,r[2]=(t[2]*n+t[6]*i+t[10]*l+t[14])/u,r}function WH(r,e,t){const n=e[0],i=e[1],l=e[2];return r[0]=n*t[0]+i*t[3]+l*t[6],r[1]=n*t[1]+i*t[4]+l*t[7],r[2]=n*t[2]+i*t[5]+l*t[8],r}function $H(r,e,t){const n=t[0],i=t[1],l=t[2],u=t[3],a=e[0],p=e[1],y=e[2];let x=i*y-l*p,T=l*a-n*y,E=n*p-i*a,k=i*E-l*T,F=l*x-n*E,D=n*T-i*x;const N=u*2;return x*=N,T*=N,E*=N,k*=2,F*=2,D*=2,r[0]=a+x+k,r[1]=p+T+F,r[2]=y+E+D,r}function qH(r,e,t,n){const i=[],l=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],l[0]=i[0],l[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),l[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function XH(r,e,t,n){const i=[],l=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],l[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),l[1]=i[1],l[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function ZH(r,e,t,n){const i=[],l=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],l[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),l[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),l[2]=i[2],r[0]=l[0]+t[0],r[1]=l[1]+t[1],r[2]=l[2]+t[2],r}function YH(r,e){const t=r[0],n=r[1],i=r[2],l=e[0],u=e[1],a=e[2],p=Math.sqrt((t*t+n*n+i*i)*(l*l+u*u+a*a)),y=p&&jH(r,e)/p;return Math.acos(Math.min(Math.max(y,-1),1))}const KH=UH;(function(){const r=zH();return function(e,t,n,i,l,u){let a,p;for(t||(t=3),n||(n=0),i?p=Math.min(i*t+n,e.length):p=e.length,a=n;a<p;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],l(r,r,u),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();const Qx=[0,0,0];let ry;class va extends OH{static get ZERO(){return ry||(ry=new va(0,0,0),Object.freeze(ry)),ry}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&od(e)?this.copy(e):(Eo.debug&&(lo(e),lo(t),lo(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Eo.debug&&(lo(e.x),lo(e.y),lo(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=lo(e)}angle(e){return YH(this,e)}cross(e){return HH(this,this,e),this.check()}rotateX({radians:e,origin:t=Qx}){return qH(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Qx}){return XH(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Qx}){return ZH(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return K3(this,this,e),this.check()}transformAsVector(e){return Y3(this,this,e),this.check()}transformByMatrix3(e){return WH(this,this,e),this.check()}transformByMatrix2(e){return LH(this,this,e),this.check()}transformByQuaternion(e){return $H(this,this,e),this.check()}}class GH extends X3{toString(){let e="[";if(Eo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=lo(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function JH(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function QH(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],l=e[6],u=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=l,r[11]=e[14],r[12]=i,r[13]=u,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function hw(r,e){const t=e[0],n=e[1],i=e[2],l=e[3],u=e[4],a=e[5],p=e[6],y=e[7],x=e[8],T=e[9],E=e[10],k=e[11],F=e[12],D=e[13],N=e[14],B=e[15],V=t*a-n*u,U=t*p-i*u,j=t*y-l*u,J=n*p-i*a,oe=n*y-l*a,le=i*y-l*p,Ce=x*D-T*F,Ie=x*N-E*F,Ue=x*B-k*F,De=T*N-E*D,pe=T*B-k*D,ze=E*B-k*N;let Ne=V*ze-U*pe+j*De+J*Ue-oe*Ie+le*Ce;return Ne?(Ne=1/Ne,r[0]=(a*ze-p*pe+y*De)*Ne,r[1]=(i*pe-n*ze-l*De)*Ne,r[2]=(D*le-N*oe+B*J)*Ne,r[3]=(E*oe-T*le-k*J)*Ne,r[4]=(p*Ue-u*ze-y*Ie)*Ne,r[5]=(t*ze-i*Ue+l*Ie)*Ne,r[6]=(N*j-F*le-B*U)*Ne,r[7]=(x*le-E*j+k*U)*Ne,r[8]=(u*pe-a*Ue+y*Ce)*Ne,r[9]=(n*Ue-t*pe-l*Ce)*Ne,r[10]=(F*oe-D*j+B*V)*Ne,r[11]=(T*j-x*oe-k*V)*Ne,r[12]=(a*Ie-u*De-p*Ce)*Ne,r[13]=(t*De-n*Ie+i*Ce)*Ne,r[14]=(D*U-F*J-N*V)*Ne,r[15]=(x*J-T*U+E*V)*Ne,r):null}function e7(r){const e=r[0],t=r[1],n=r[2],i=r[3],l=r[4],u=r[5],a=r[6],p=r[7],y=r[8],x=r[9],T=r[10],E=r[11],k=r[12],F=r[13],D=r[14],N=r[15],B=e*u-t*l,V=e*a-n*l,U=t*a-n*u,j=y*F-x*k,J=y*D-T*k,oe=x*D-T*F,le=e*oe-t*J+n*j,Ce=l*oe-u*J+a*j,Ie=y*U-x*V+T*B,Ue=k*U-F*V+D*B;return p*le-i*Ce+N*Ie-E*Ue}function iu(r,e,t){const n=e[0],i=e[1],l=e[2],u=e[3],a=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],k=e[10],F=e[11],D=e[12],N=e[13],B=e[14],V=e[15];let U=t[0],j=t[1],J=t[2],oe=t[3];return r[0]=U*n+j*a+J*T+oe*D,r[1]=U*i+j*p+J*E+oe*N,r[2]=U*l+j*y+J*k+oe*B,r[3]=U*u+j*x+J*F+oe*V,U=t[4],j=t[5],J=t[6],oe=t[7],r[4]=U*n+j*a+J*T+oe*D,r[5]=U*i+j*p+J*E+oe*N,r[6]=U*l+j*y+J*k+oe*B,r[7]=U*u+j*x+J*F+oe*V,U=t[8],j=t[9],J=t[10],oe=t[11],r[8]=U*n+j*a+J*T+oe*D,r[9]=U*i+j*p+J*E+oe*N,r[10]=U*l+j*y+J*k+oe*B,r[11]=U*u+j*x+J*F+oe*V,U=t[12],j=t[13],J=t[14],oe=t[15],r[12]=U*n+j*a+J*T+oe*D,r[13]=U*i+j*p+J*E+oe*N,r[14]=U*l+j*y+J*k+oe*B,r[15]=U*u+j*x+J*F+oe*V,r}function rv(r,e,t){const n=t[0],i=t[1],l=t[2];let u,a,p,y,x,T,E,k,F,D,N,B;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*l+e[12],r[13]=e[1]*n+e[5]*i+e[9]*l+e[13],r[14]=e[2]*n+e[6]*i+e[10]*l+e[14],r[15]=e[3]*n+e[7]*i+e[11]*l+e[15]):(u=e[0],a=e[1],p=e[2],y=e[3],x=e[4],T=e[5],E=e[6],k=e[7],F=e[8],D=e[9],N=e[10],B=e[11],r[0]=u,r[1]=a,r[2]=p,r[3]=y,r[4]=x,r[5]=T,r[6]=E,r[7]=k,r[8]=F,r[9]=D,r[10]=N,r[11]=B,r[12]=u*n+x*i+F*l+e[12],r[13]=a*n+T*i+D*l+e[13],r[14]=p*n+E*i+N*l+e[14],r[15]=y*n+k*i+B*l+e[15]),r}function B1(r,e,t){const n=t[0],i=t[1],l=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*l,r[9]=e[9]*l,r[10]=e[10]*l,r[11]=e[11]*l,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function t7(r,e,t,n){let i=n[0],l=n[1],u=n[2],a=Math.sqrt(i*i+l*l+u*u),p,y,x,T,E,k,F,D,N,B,V,U,j,J,oe,le,Ce,Ie,Ue,De,pe,ze,Ne,ot;return a<wy?null:(a=1/a,i*=a,l*=a,u*=a,y=Math.sin(t),p=Math.cos(t),x=1-p,T=e[0],E=e[1],k=e[2],F=e[3],D=e[4],N=e[5],B=e[6],V=e[7],U=e[8],j=e[9],J=e[10],oe=e[11],le=i*i*x+p,Ce=l*i*x+u*y,Ie=u*i*x-l*y,Ue=i*l*x-u*y,De=l*l*x+p,pe=u*l*x+i*y,ze=i*u*x+l*y,Ne=l*u*x-i*y,ot=u*u*x+p,r[0]=T*le+D*Ce+U*Ie,r[1]=E*le+N*Ce+j*Ie,r[2]=k*le+B*Ce+J*Ie,r[3]=F*le+V*Ce+oe*Ie,r[4]=T*Ue+D*De+U*pe,r[5]=E*Ue+N*De+j*pe,r[6]=k*Ue+B*De+J*pe,r[7]=F*Ue+V*De+oe*pe,r[8]=T*ze+D*Ne+U*ot,r[9]=E*ze+N*Ne+j*ot,r[10]=k*ze+B*Ne+J*ot,r[11]=F*ze+V*Ne+oe*ot,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function G3(r,e,t){const n=Math.sin(t),i=Math.cos(t),l=e[4],u=e[5],a=e[6],p=e[7],y=e[8],x=e[9],T=e[10],E=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=l*i+y*n,r[5]=u*i+x*n,r[6]=a*i+T*n,r[7]=p*i+E*n,r[8]=y*i-l*n,r[9]=x*i-u*n,r[10]=T*i-a*n,r[11]=E*i-p*n,r}function r7(r,e,t){const n=Math.sin(t),i=Math.cos(t),l=e[0],u=e[1],a=e[2],p=e[3],y=e[8],x=e[9],T=e[10],E=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*i-y*n,r[1]=u*i-x*n,r[2]=a*i-T*n,r[3]=p*i-E*n,r[8]=l*n+y*i,r[9]=u*n+x*i,r[10]=a*n+T*i,r[11]=p*n+E*i,r}function J3(r,e,t){const n=Math.sin(t),i=Math.cos(t),l=e[0],u=e[1],a=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*i+y*n,r[1]=u*i+x*n,r[2]=a*i+T*n,r[3]=p*i+E*n,r[4]=y*i-l*n,r[5]=x*i-u*n,r[6]=T*i-a*n,r[7]=E*i-p*n,r}function n7(r,e){const t=e[0],n=e[1],i=e[2],l=e[3],u=t+t,a=n+n,p=i+i,y=t*u,x=n*u,T=n*a,E=i*u,k=i*a,F=i*p,D=l*u,N=l*a,B=l*p;return r[0]=1-T-F,r[1]=x+B,r[2]=E-N,r[3]=0,r[4]=x-B,r[5]=1-y-F,r[6]=k+D,r[7]=0,r[8]=E+N,r[9]=k-D,r[10]=1-y-T,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function i7(r,e,t,n,i,l,u){const a=1/(t-e),p=1/(i-n),y=1/(l-u);return r[0]=l*2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l*2*p,r[6]=0,r[7]=0,r[8]=(t+e)*a,r[9]=(i+n)*p,r[10]=(u+l)*y,r[11]=-1,r[12]=0,r[13]=0,r[14]=u*l*2*y,r[15]=0,r}function s7(r,e,t,n,i){const l=1/Math.tan(e/2);if(r[0]=l/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const u=1/(n-i);r[10]=(i+n)*u,r[14]=2*i*n*u}else r[10]=-1,r[14]=-2*n;return r}const o7=s7;function a7(r,e,t,n,i,l,u){const a=1/(e-t),p=1/(n-i),y=1/(l-u);return r[0]=-2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*y,r[11]=0,r[12]=(e+t)*a,r[13]=(i+n)*p,r[14]=(u+l)*y,r[15]=1,r}const l7=a7;function c7(r,e,t,n){let i,l,u,a,p,y,x,T,E,k;const F=e[0],D=e[1],N=e[2],B=n[0],V=n[1],U=n[2],j=t[0],J=t[1],oe=t[2];return Math.abs(F-j)<wy&&Math.abs(D-J)<wy&&Math.abs(N-oe)<wy?JH(r):(T=F-j,E=D-J,k=N-oe,i=1/Math.sqrt(T*T+E*E+k*k),T*=i,E*=i,k*=i,l=V*k-U*E,u=U*T-B*k,a=B*E-V*T,i=Math.sqrt(l*l+u*u+a*a),i?(i=1/i,l*=i,u*=i,a*=i):(l=0,u=0,a=0),p=E*a-k*u,y=k*l-T*a,x=T*u-E*l,i=Math.sqrt(p*p+y*y+x*x),i?(i=1/i,p*=i,y*=i,x*=i):(p=0,y=0,x=0),r[0]=l,r[1]=p,r[2]=T,r[3]=0,r[4]=u,r[5]=y,r[6]=E,r[7]=0,r[8]=a,r[9]=x,r[10]=k,r[11]=0,r[12]=-(l*F+u*D+a*N),r[13]=-(p*F+y*D+x*N),r[14]=-(T*F+E*D+k*N),r[15]=1,r)}function u7(){const r=new ad(4);return ad!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function h7(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Vm(r,e,t){const n=e[0],i=e[1],l=e[2],u=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*l+t[12]*u,r[1]=t[1]*n+t[5]*i+t[9]*l+t[13]*u,r[2]=t[2]*n+t[6]*i+t[10]*l+t[14]*u,r[3]=t[3]*n+t[7]*i+t[11]*l+t[15]*u,r}(function(){const r=u7();return function(e,t,n,i,l,u){let a,p;for(t||(t=4),n||(n=0),i?p=Math.min(i*t+n,e.length):p=e.length,a=n;a<p;a+=t)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],r[3]=e[a+3],l(r,r,u),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2],e[a+3]=r[3];return e}})();var dw;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(dw||(dw={}));const d7=45*Math.PI/180,f7=1,e0=.1,t0=500,p7=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ba extends GH{static get IDENTITY(){return m7()}static get ZERO(){return g7()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return dw}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,l,u,a,p,y,x,T,E,k,F,D,N){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=l,this[5]=u,this[6]=a,this[7]=p,this[8]=y,this[9]=x,this[10]=T,this[11]=E,this[12]=k,this[13]=F,this[14]=D,this[15]=N,this.check()}setRowMajor(e,t,n,i,l,u,a,p,y,x,T,E,k,F,D,N){return this[0]=e,this[1]=l,this[2]=y,this[3]=k,this[4]=t,this[5]=u,this[6]=x,this[7]=F,this[8]=n,this[9]=a,this[10]=T,this[11]=D,this[12]=i,this[13]=p,this[14]=E,this[15]=N,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(p7)}fromObject(e){return this.check()}fromQuaternion(e){return n7(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:l,near:u=e0,far:a=t0}=e;return a===1/0?_7(this,t,n,i,l,u):i7(this,t,n,i,l,u,a),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return c7(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:l,near:u=e0,far:a=t0}=e;return l7(this,t,n,i,l,u,a),this.check()}orthographic(e){const{fovy:t=d7,aspect:n=f7,focalDistance:i=1,near:l=e0,far:u=t0}=e;IA(t);const a=t/2,p=i*Math.tan(a),y=p*n;return this.ortho({left:-y,right:y,bottom:-p,top:p,near:l,far:u})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:l=500}=e;return IA(t),o7(this,t,n,i,l),this.check()}determinant(){return e7(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],l=1/n[1],u=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*l,e[2]=this[2]*u,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*l,e[6]=this[6]*u,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*l,e[10]=this[10]*u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],l=1/n[1],u=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*l,e[2]=this[2]*u,e[3]=this[4]*i,e[4]=this[5]*l,e[5]=this[6]*u,e[6]=this[8]*i,e[7]=this[9]*l,e[8]=this[10]*u,e}transpose(){return QH(this,this),this.check()}invert(){return hw(this,this),this.check()}multiplyLeft(e){return iu(this,e,this),this.check()}multiplyRight(e){return iu(this,this,e),this.check()}rotateX(e){return G3(this,this,e),this.check()}rotateY(e){return r7(this,this,e),this.check()}rotateZ(e){return J3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return t7(this,this,e,t),this.check()}scale(e){return B1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return rv(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Vm(t||[-0,-0,-0,-0],e,this),Jx(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=FH(t||[-0,-0],e,this);break;case 3:i=K3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Jx(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=BH(t||[-0,-0],e,this);break;case 3:n=Y3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Jx(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let ny,iy;function g7(){return ny||(ny=new ba([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ny)),ny}function m7(){return iy||(iy=new ba,Object.freeze(iy)),iy}function IA(r){if(r>Math.PI*2)throw Error("expected radians")}function _7(r,e,t,n,i,l){const u=2*l/(t-e),a=2*l/(i-n),p=(t+e)/(t-e),y=(i+n)/(i-n),x=-1,T=-1,E=-2*l;return r[0]=u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=p,r[9]=y,r[10]=x,r[11]=T,r[12]=0,r[13]=0,r[14]=E,r[15]=0,r}const Q3="#define SMOOTH_EDGE_RADIUS 0.5",y7=`
${Q3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,v7=`
${Q3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,b7={name:"geometry",vs:y7,fs:v7},qn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(qn,"IDENTITY",{get:()=>(ri.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ga={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},fw={common:0,meters:1,pixels:2},pw={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},x7=Object.keys(qn).map(r=>`const int COORDINATE_SYSTEM_${r} = ${qn[r]};`).join(""),w7=Object.keys(ga).map(r=>`const int PROJECTION_MODE_${r} = ${ga[r]};`).join(""),T7=Object.keys(fw).map(r=>`const int UNIT_${r.toUpperCase()} = ${fw[r]};`).join(""),S7=`${x7}
${w7}
${T7}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function A7(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function jm(r){let e={},t;return n=>{for(const i in n)if(!A7(n[i],e[i])){t=r(n),e=n;break}return t}}const CA=[0,0,0,0],E7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],eP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],I7=[0,0,0],tP=[0,0,0],C7=jm(k7);function rP(r,e,t=tP){t.length<3&&(t=[t[0],t[1],0]);let n=t,i,l=!0;switch(e===qn.LNGLAT_OFFSETS||e===qn.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case ga.WEB_MERCATOR:(e===qn.LNGLAT||e===qn.CARTESIAN)&&(i=[0,0,0],l=!1);break;case ga.WEB_MERCATOR_AUTO_OFFSET:e===qn.LNGLAT?n=i:e===qn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case ga.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case ga.GLOBE:l=!1,i=null;break;default:l=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:l}}function P7(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:l,viewProjectionMatrix:u}=r,a=CA,p=CA,y=r.cameraPosition;const{geospatialOrigin:x,shaderCoordinateOrigin:T,offsetMode:E}=rP(r,e,t);return E&&(p=r.projectPosition(x||T),y=[y[0]-p[0],y[1]-p[1],y[2]-p[2]],p[3]=1,a=Vm([],p,u),l=n||l,u=iu([],i,l),u=iu([],u,E7)),{viewMatrix:l,viewProjectionMatrix:u,projectionCenter:a,originCommon:p,cameraPosCommon:y,shaderCoordinateOrigin:T,geospatialOrigin:x}}function R7({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=qn.DEFAULT,coordinateOrigin:i=tP,autoWrapLongitude:l=!1}){n===qn.DEFAULT&&(n=r.isGeospatial?qn.LNGLAT:qn.CARTESIAN);const u=C7({viewport:r,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return u.project_uWrapLongitude=l,u.project_uModelMatrix=t||eP,u}function k7({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:l,originCommon:u,cameraPosCommon:a,shaderCoordinateOrigin:p,geospatialOrigin:y}=P7(r,t,n),x=r.getDistanceScales(),T=[r.width*e,r.height*e],E=Vm([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,k={project_uCoordinateSystem:t,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:p,project_uCommonOrigin:u.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!r._pseudoMeters,project_uViewportSize:T,project_uDevicePixelRatio:e,project_uFocalDistance:E,project_uCommonUnitsPerMeter:x.unitsPerMeter,project_uCommonUnitsPerWorldUnit:x.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:I7,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:eP,project_uCameraPosition:a};if(y){const F=r.getDistanceScales(y);switch(t){case qn.METER_OFFSETS:k.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,k.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case qn.LNGLAT:case qn.LNGLAT_OFFSETS:r._pseudoMeters||(k.project_uCommonUnitsPerMeter=F.unitsPerMeter),k.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,k.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case qn.CARTESIAN:k.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],k.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return k}const M7={};function O7(r=M7){return"viewport"in r?R7(r):{}}const L1={name:"project",dependencies:[mH,b7],vs:S7,getUniforms:O7},D7=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,N7={name:"project32",dependencies:[L1],vs:D7};function F7(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Nh(r,e){const t=Vm([],e,r);return h7(t,t,1/t[3]),t}function PA(r,e){const t=r%e;return t<0?e+t:t}function gw(r,e,t){return r<e?e:r>t?t:r}function B7(r){return Math.log(r)*Math.LOG2E}const z1=Math.log2||B7;function tl(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Vo=Math.PI,nP=Vo/4,Io=Vo/180,mw=180/Vo,ld=512,nv=4003e4,RA=85.051129,L7=1.5;function z7(r){return z1(r)}function Ep(r){const[e,t]=r;tl(Number.isFinite(e)),tl(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Io,i=t*Io,l=ld*(n+Vo)/(2*Vo),u=ld*(Vo+Math.log(Math.tan(nP+i*.5)))/(2*Vo);return[l,u]}function cd(r){const[e,t]=r,n=e/ld*(2*Vo)-Vo,i=2*(Math.atan(Math.exp(t/ld*(2*Vo)-Vo))-nP);return[n*mw,i*mw]}function U7(r){const{latitude:e}=r;tl(Number.isFinite(e));const t=Math.cos(e*Io);return z7(nv*t)-9}function Ty(r){const e=Math.cos(r*Io);return ld/nv/e}function _w(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;tl(Number.isFinite(e)&&Number.isFinite(t));const i=ld,l=Math.cos(e*Io),u=i/360,a=u/l,p=i/nv/l,y={unitsPerMeter:[p,p,p],metersPerUnit:[1/p,1/p,1/p],unitsPerDegree:[u,a,p],degreesPerUnit:[1/u,1/a,1/p]};if(n){const x=Io*Math.tan(e*Io)/l,T=u*x/2,E=i/nv*x,k=E/a*p;y.unitsPerDegree2=[0,T,E],y.unitsPerMeter2=[k,0,k]}return y}function iP(r,e){const[t,n,i]=r,[l,u,a]=e,{unitsPerMeter:p,unitsPerMeter2:y}=_w({longitude:t,latitude:n,highPrecision:!0}),x=Ep(r);x[0]+=l*(p[0]+y[0]*u),x[1]+=u*(p[1]+y[1]*u);const T=cd(x),E=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[T[0],T[1],E]:T}function V7(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:l,center:u}=r,a=F7();rv(a,a,[0,0,-i]),G3(a,a,-t*Io),J3(a,a,n*Io);const p=l/e;return B1(a,a,[p,p,p]),u&&rv(a,a,VH([],u)),a}function j7(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:l,center:u,scale:a,nearZMultiplier:p=1,farZMultiplier:y=1}=r;let{fovy:x=iv(L7)}=r;n!==void 0&&(x=iv(n));const T=x*Io,E=i*Io,k=sP(x);let F=k;u&&(F+=u[2]*a/Math.cos(E)/t);const D=T*(.5+(l?l[1]:0)/t),N=Math.sin(D)*F/Math.sin(gw(Math.PI/2-E-D,.01,Math.PI-.01)),B=Math.sin(E)*N+F,V=F*10,U=Math.min(B*y,V);return{fov:T,aspect:e/t,focalDistance:k,near:p,far:U}}function iv(r){return 2*Math.atan(.5/r)*mw}function sP(r){return .5/Math.tan(.5*r*Io)}function oP(r,e){const[t,n,i=0]=r;return tl(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),Nh(e,[t,n,i,1])}function U1(r,e,t=0){const[n,i,l]=r;if(tl(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(l))return Nh(e,[n,i,l,1]);const u=Nh(e,[n,i,0,1]),a=Nh(e,[n,i,1,1]),p=u[2],y=a[2],x=p===y?0:((t||0)-p)/(y-p);return Z3([],u,a,x)}function H7(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:l=24,offset:u=[0,0]}=r,[[a,p],[y,x]]=n,T=W7(r.padding),E=Ep([a,gw(x,-85.051129,RA)]),k=Ep([y,gw(p,-85.051129,RA)]),F=[Math.max(Math.abs(k[0]-E[0]),i),Math.max(Math.abs(k[1]-E[1]),i)],D=[e-T.left-T.right-Math.abs(u[0])*2,t-T.top-T.bottom-Math.abs(u[1])*2];tl(D[0]>0&&D[1]>0);const N=D[0]/F[0],B=D[1]/F[1],V=(T.right-T.left)/2/N,U=(T.top-T.bottom)/2/B,j=[(k[0]+E[0])/2+V,(k[1]+E[1])/2+U],J=cd(j),oe=Math.min(l,z1(Math.abs(Math.min(N,B))));return tl(Number.isFinite(oe)),{longitude:J[0],latitude:J[1],zoom:oe}}function W7(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(tl(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const kA=Math.PI/180;function $7(r,e=0){const{width:t,height:n,unproject:i}=r,l={targetZ:e},u=i([0,n],l),a=i([t,n],l);let p,y;const x=r.fovy?.5*r.fovy*kA:Math.atan(.5/r.altitude),T=(90-r.pitch)*kA;return x>T-.01?(p=MA(r,0,e),y=MA(r,t,e)):(p=i([0,0],l),y=i([t,0],l)),[u,a,y,p]}function MA(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=Nh(n,[e,0,1,1]),l=Nh(n,[e,r.height,1,1]),a=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(l[2]-i[2]),p=Z3([],i,l,a),y=cd(p);return y.push(t),y}const OA=512;function q7(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:l,zoom:u,bearing:a=0}=r;(i<-180||i>180)&&(i=PA(i+180,360)-180),(a<-180||a>180)&&(a=PA(a+180,360)-180);const p=z1(t/OA);if(u<=p)u=p,l=0;else{const y=t/2/Math.pow(2,u),x=cd([0,y])[1];if(l<x)l=x;else{const T=cd([0,OA-y])[1];l>T&&(l=T)}}return{width:e,height:t,longitude:i,latitude:l,zoom:u,pitch:n,bearing:a}}const X7=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Z7=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Y7=jm(eW),K7=jm(tW),G7=[0,0,0,1],J7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Q7(r,e){const[t,n,i]=r,l=U1([t,n,i],e);return Number.isFinite(i)?l:[l[0],l[1],0]}function eW({viewport:r,center:e}){return new ba(r.viewProjectionMatrix).invert().transform(e)}function tW({viewport:r,shadowMatrices:e}){const t=[],n=r.pixelUnprojectionMatrix,i=r.isGeospatial?void 0:1,l=[[0,0,i],[r.width,0,i],[0,r.height,i],[r.width,r.height,i],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(u=>Q7(u,n));for(const u of e){const a=u.clone().translate(new va(r.center).negate()),p=l.map(x=>a.transform(x)),y=new ba().ortho({left:Math.min(...p.map(x=>x[0])),right:Math.max(...p.map(x=>x[0])),bottom:Math.min(...p.map(x=>x[1])),top:Math.max(...p.map(x=>x[1])),near:Math.min(...p.map(x=>-x[2])),far:Math.max(...p.map(x=>-x[2]))});t.push(y.multiplyRight(u))}return t}function rW(r,e){const{shadowEnabled:t=!0}=r;if(!t||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||G7,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},i=Y7({viewport:r.viewport,center:e.project_uCenter}),l=[],u=K7({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let a=0;a<r.shadowMatrices.length;a++){const p=u[a],y=p.clone().translate(new va(r.viewport.center).negate());e.project_uCoordinateSystem===qn.LNGLAT&&e.project_uProjectionMode===ga.WEB_MERCATOR?(u[a]=y,l[a]=i):(u[a]=p.clone().multiplyRight(J7),l[a]=y.transform(i))}for(let a=0;a<u.length;a++)n[`shadow_uViewProjectionMatrices[${a}]`]=u[a],n[`shadow_uProjectCenters[${a}]`]=l[a];for(let a=0;a<2;a++)n[`shadow_uShadowMap${a}`]=r.shadowMaps&&r.shadowMaps[a]||r.dummyShadowMap;return n}const DA={name:"shadow",dependencies:[L1],vs:X7,fs:Z7,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(r={},e={})=>"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?rW(r,e):{}},nW={...SA,defaultUniforms:{...SA.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},iW=[L1],sW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function oW(){const r=Hy.getDefaultShaderAssembler();for(const e of iW)r.addDefaultModule(e);for(const e of sW)r.addShaderHook(e);return r}const aW=[255,255,255],lW=1;let cW=0;class uW{constructor(e={}){this.type="ambient";const{color:t=aW}=e,{intensity:n=lW}=e;this.id=e.id||`ambient-${cW++}`,this.color=t,this.intensity=n}}const hW=[255,255,255],dW=1,fW=[0,0,-1];let pW=0;class NA{constructor(e={}){this.type="directional";const{color:t=hW}=e,{intensity:n=dW}=e,{direction:i=fW}=e,{_shadow:l=!1}=e;this.id=e.id||`directional-${pW++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new va(i).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class gW{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class V1 extends gW{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,l=e.clearColor??(i?[0,0,0,0]:!1),u=i?1:!1,a=i?0:!1,p=e.colorMask??15,y={viewport:[0,0,t,n]};e.colorMask&&(y.colorMask=p),e.scissorRect&&(y.scissorRect=e.scissorRect);const x=this.device.beginRenderPass({framebuffer:e.target,parameters:y,clearColor:l,clearDepth:u,clearStencil:a});try{return this._drawLayers(x,e)}finally{x.end()}}_drawLayers(e,t){const{target:n,moduleParameters:i,viewports:l,views:u,onViewportActive:a,clearStack:p=!0}=t;t.pass=t.pass||"unknown",p&&(this._lastRenderIndex=-1);const y=[];for(const x of l){const T=u&&u[x.id];a==null||a(x);const E=this._getDrawLayerParams(x,t),k=x.subViewports||[x];for(const F of k){const D=this._drawLayersInViewport(e,{target:n,moduleParameters:i,viewport:F,view:T,pass:t.pass,layers:t.layers},E);y.push(D)}}return y}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:l,cullRect:u,effects:a,moduleParameters:p},y=!1){var F;const x=[],T=aP(this._lastRenderIndex+1),E={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:u},k={};for(let D=0;D<t.length;D++){const N=t[D],B=this._shouldDrawLayer(N,E,l,k),V={shouldDrawLayer:B};B&&!y&&(V.layerRenderIndex=T(N,B),V.moduleParameters=this._getModuleParameters(N,a,n,p),V.layerParameters={...(F=N.context.deck)==null?void 0:F.props.parameters,...this.getLayerParameters(N,D,e)}),x[D]=V}return x}_drawLayersInViewport(e,{layers:t,moduleParameters:n,pass:i,target:l,viewport:u,view:a},p){const y=mW(this.device,{moduleParameters:n,target:l,viewport:u});if(a&&a.props.clear){const T=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:y},()=>this.device.clearWebGL(T))}const x={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:y});for(let T=0;T<t.length;T++){const E=t[T],{shouldDrawLayer:k,layerRenderIndex:F,moduleParameters:D,layerParameters:N}=p[T];if(k&&E.props.pickable&&x.pickableCount++,E.isComposite)x.compositeCount++;else if(k){x.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),D.viewport=u,E.context.renderPass=e;try{E._drawLayer({renderPass:e,moduleParameters:D,uniforms:{layerIndex:F},parameters:N})}catch(B){E.raiseError(B,`drawing ${E} to ${i}`)}}}return x}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let u=e.parent;for(;u;){if(!u.props.visible||!u.filterSubLayer(t))return!1;t.layer=u,u=u.parent}if(n){const a=t.layer.id;if(a in i||(i[a]=n(t)),!i[a])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,n,i){var a,p;const l=this.device.canvasContext.cssToDeviceRatio(),u=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:l});if(t)for(const y of t)Object.assign(u,(p=y.getModuleParameters)==null?void 0:p.call(y,e));return Object.assign(u,this.getModuleParameters(e,t),i)}}function aP(r=0,e={}){const t={},n=(i,l)=>{const u=i.props._offset,a=i.id,p=i.parent&&i.parent.id;let y;if(p&&!(p in e)&&n(i.parent,!1),p in t){const x=t[p]=t[p]||aP(e[p],e);y=x(i,l),t[a]=x}else Number.isFinite(u)?(y=u+(e[p]||0),t[a]=null):y=r;return l&&y>=r&&(r=y+1),e[a]=y,y};return n}function mW(r,{moduleParameters:e,target:t,viewport:n}){const i=e&&e.devicePixelRatio||r.canvasContext.cssToDeviceRatio(),[,l]=r.canvasContext.getDrawingBufferSize(),u=t?t.height:l,a=n;return[a.x*i,u-(a.y+a.height)*i,a.width*i,a.height*i]}class _W extends V1{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],l=i.width*n,u=i.height*n,a=[1,1,1,1];(l!==t.width||u!==t.height)&&t.resize({width:l,height:u}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const yW={color:[255,255,255],intensity:1},FA=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],vW=[0,0,0,200/255];class lP{constructor(e={}){this.id="lighting-effect",this.shadowColor=vW,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(DA),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:l}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let u=0;u<this.shadowPasses.length;u++)this.shadowPasses[u].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:l,moduleParameters:{shadowLightId:u,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:e})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:e}))},t}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(DA))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new ba().lookAt({eye:new va(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new _W(e);this.shadowPasses[t]=n,this.shadowMaps[t]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new uW(yW),this.directionalLights.push(new NA(FA[0]),new NA(FA[1])))}}class bW{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:l=0,copy:u=!1,initialize:a=!1,maxCount:p}){const y=i||e&&e.constructor||Float32Array,x=t*n+l;if(ArrayBuffer.isView(e)){if(x<=e.length)return e;if(x*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new y(e.buffer,0,x)}let T=1/0;p&&(T=p*n+l);const E=this._allocate(y,x,a,T);return e&&u?E.set(e):a||E.fill(0,0,4),this._release(e),E}release(e){this._release(e)}_allocate(e,t,n,i){let l=Math.max(Math.ceil(t*this.opts.overAlloc),1);l>i&&(l=i);const u=this._pool,a=e.BYTES_PER_ELEMENT*l,p=u.findIndex(y=>y.byteLength>=a);if(p>=0){const y=new e(u.splice(p,1)[0],0,l);return n&&y.fill(0),y}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,l=t.findIndex(u=>u.byteLength>=i);l<0?t.push(n):(l>0||t.length<this.opts.poolSize)&&t.splice(l,0,n),t.length>this.opts.poolSize&&t.shift()}}const Ip=new bW;function Kf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xW(r){return[r[12],r[13],r[14]]}function wW(r){return{left:hh(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:hh(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:hh(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:hh(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:hh(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:hh(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const BA=new va;function hh(r,e,t,n){BA.set(r,e,t);const i=BA.len();return{distance:n/i,normal:new va(-r/i,-e/i,-t/i)}}function TW(r){return r-Math.fround(r)}let Lf;function r0(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,l=(i-n)/t;Lf=Ip.allocate(Lf,l,{type:Float32Array,size:t*2});let u=n,a=0;for(;u<i;){for(let p=0;p<t;p++){const y=r[u++];Lf[a+p]=y,Lf[a+p+t]=TW(y)}a+=t*2}return Lf.subarray(0,l*t*2)}function SW(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const AW=Math.PI/180,EW=Kf(),LA=[0,0,0],IW={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function CW({width:r,height:e,orthographic:t,fovyRadians:n,focalDistance:i,padding:l,near:u,far:a}){const p=r/e,y=t?new ba().orthographic({fovy:n,aspect:p,focalDistance:i,near:u,far:a}):new ba().perspective({fovy:n,aspect:p,near:u,far:a});if(l){const{left:x=0,right:T=0,top:E=0,bottom:k=0}=l,F=Ql((x+r-T)/2,0,r)-r/2,D=Ql((E+e-k)/2,0,e)-e/2;y[8]-=F*2/r,y[9]+=D*2/e}return y}class Hm{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||IW,this.focalDistance=e.focalDistance||1,this.position=e.position||LA,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ga.WEB_MERCATOR:ga.WEB_MERCATOR_AUTO_OFFSET:ga.IDENTITY}equals(e){return e instanceof Hm?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ap(e.projectionMatrix,this.projectionMatrix)&&Ap(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),i=oP(n,this.pixelProjectionMatrix),[l,u]=i,a=t?u:this.height-u;return e.length===2?[l,a]:[l,a,i[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,l,u]=e,a=t?l:this.height-l,p=n&&n*this.distanceScales.unitsPerMeter[2],y=U1([i,a,u],this.pixelUnprojectionMatrix,p),[x,T,E]=this.unprojectPosition(y);return Number.isFinite(u)?[x,T,E]:Number.isFinite(n)?[x,T,n]:[x,T]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=Ep(e);return t[1]=Ql(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?cd(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),l=this.unproject([0,this.height],t),u=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],l[0],u[0]),Math.min(n[1],i[1],l[1],u[1]),Math.max(n[0],i[0],l[0],u[0]),Math.max(n[1],i[1],l[1],u[1])]}getDistanceScales(e){return e?_w({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,wW(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=U7({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||_w({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:l,modelMatrix:u}=e;let a=LA;if(l&&(a=u?new ba(u).transformAsVector(l,[]):l),this.isGeospatial){const p=this.projectPosition([t,n,0]);this.center=new va(a).scale(this.distanceScales.unitsPerMeter).add(p)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=EW,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:l,fovy:u=75,near:a=.1,far:p=1e3,padding:y=null,focalDistance:x=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new ba().multiplyRight(t).translate(new va(this.center).negate()),this.projectionMatrix=n||CW({width:this.width,height:this.height,orthographic:i,fovyRadians:l||u*AW,focalDistance:x,padding:y,near:a,far:p});const T=Kf();iu(T,T,this.projectionMatrix),iu(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=hw([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=xW(this.viewMatrixInverse);const E=Kf(),k=Kf();B1(E,E,[this.width/2,-this.height/2,1]),rv(E,E,[1,-1,0]),iu(k,E,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=hw(Kf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ri.warn("Pixel project matrix not invertible")()}}Hm.displayName="Viewport";class uu extends Hm{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:l=0,bearing:u=0,nearZMultiplier:a=.1,farZMultiplier:p=1.01,nearZ:y,farZ:x,orthographic:T=!1,projectionMatrix:E,repeat:k=!1,worldOffset:F=0,position:D,padding:N,legacyMeterSizes:B=!1}=e;let{width:V,height:U,altitude:j=1.5}=e;const J=Math.pow(2,i);V=V||1,U=U||1;let oe,le=null;if(E)j=E[5]/2,oe=iv(j);else{e.fovy?(oe=e.fovy,j=sP(oe)):oe=iv(j);let Ie;if(N){const{top:Ue=0,bottom:De=0}=N;Ie=[0,Ql((Ue+U-De)/2,0,U)-U/2]}le=j7({width:V,height:U,scale:J,center:D&&[0,0,D[2]*Ty(t)],offset:Ie,pitch:l,fovy:oe,nearZMultiplier:a,farZMultiplier:p}),Number.isFinite(y)&&(le.near=y),Number.isFinite(x)&&(le.far=x)}let Ce=V7({height:U,pitch:l,bearing:u,scale:J,altitude:j});F&&(Ce=new ba().translate([512*F,0,0]).multiplyLeft(Ce)),super({...e,width:V,height:U,viewMatrix:Ce,longitude:n,latitude:t,zoom:i,...le,fovy:oe,focalDistance:j}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=l,this.bearing=u,this.altitude=j,this.fovy=oe,this.orthographic=T,this._subViewports=k?[]:null,this._pseudoMeters=B,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const l=i?new uu({...this,worldOffset:i}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*Ty(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/Ty(n);return[t,n,i]}addMetersToLngLat(e,t){return iP(e,t)}panByPosition(e,t){const n=U1(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),l=EA([],i,NH([],n)),u=EA([],this.center,l),[a,p]=this.unprojectFlat(u);return{longitude:a,latitude:p}}getBounds(e={}){const t=$7(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:l,latitude:u,zoom:a}=H7({width:n,height:i,bounds:e,...t});return new uu({width:n,height:i,longitude:l,latitude:u,zoom:a})}}uu.displayName="WebMercatorViewport";const zA=[0,0,0];function n0(r,e,t=!1){const n=e.projectPosition(r);if(t&&e instanceof uu){const[i,l,u=0]=r,a=e.getDistanceScales([i,l]);n[2]=u*a.unitsPerMeter[2]}return n}function PW(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:l,fromCoordinateOrigin:u}=r;return i===qn.DEFAULT&&(i=e.isGeospatial?qn.LNGLAT:qn.CARTESIAN),l===void 0&&(l=i),u===void 0&&(u=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:l,fromCoordinateOrigin:u}}function cP(r,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:i,offsetMode:l}){let[u,a,p=0]=r;switch(t&&([u,a,p]=Vm([],[u,a,p,1],t)),n){case qn.LNGLAT:return n0([u,a,p],e,l);case qn.LNGLAT_OFFSETS:return n0([u+i[0],a+i[1],p+(i[2]||0)],e,l);case qn.METER_OFFSETS:return n0(iP(i,[u,a,p]),e,l);case qn.CARTESIAN:default:return e.isGeospatial?[u+i[0],a+i[1],p+i[2]]:e.projectPosition([u,a,p])}}function RW(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:l,fromCoordinateSystem:u,fromCoordinateOrigin:a}=PW(e),{autoOffset:p=!0}=e,{geospatialOrigin:y=zA,shaderCoordinateOrigin:x=zA,offsetMode:T=!1}=p?rP(t,n,i):{},E=cP(r,{viewport:t,modelMatrix:l,coordinateSystem:u,coordinateOrigin:a,offsetMode:T});if(T){const k=t.projectPosition(y||x);KH(E,E,k)}return E}let kW=1,MW=1;class uP{constructor(){Z(this,"time",0);Z(this,"channels",new Map);Z(this,"animations",new Map);Z(this,"playing",!1);Z(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:l=1}=e,u=kW++,a={time:0,delay:t,duration:n,rate:i,repeat:l};return this._setChannelTime(a,this.time),this.channels.set(u,a),u}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:l,channel:u}=i;l.setTime(this.getTime(u))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=MW++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let OW=0;const DW={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:Dh.stats.get(`animation-loop-${OW++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class NW{constructor(e){Z(this,"device",null);Z(this,"canvas",null);Z(this,"props");Z(this,"animationProps",null);Z(this,"timeline",null);Z(this,"stats");Z(this,"cpuTime");Z(this,"gpuTime");Z(this,"frameRate");Z(this,"display");Z(this,"needsRedraw","initialized");Z(this,"_initialized",!1);Z(this,"_running",!1);Z(this,"_animationFrameId",null);Z(this,"_nextFramePromise",null);Z(this,"_resolveNextFrame",null);Z(this,"_cpuStartTime",0);if(this.props={...DW,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new nb({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=B9(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(L9(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,t;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(t=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:t.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var l,u,a,p;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.getPixelSize())||[1,1];let n=1;const i=(p=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:p.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class UA{constructor(e){Z(this,"id");Z(this,"userData",{});Z(this,"topology");Z(this,"bufferLayout",[]);Z(this,"vertexCount");Z(this,"indices");Z(this,"attributes");this.id=e.id||gu("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&oi(this.indices.usage===Ti.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function FW(r,e){if(e instanceof UA)return e;const t=BW(r,e),{attributes:n,bufferLayout:i}=LW(r,e);return new UA({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function BW(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:Ti.INDEX,data:t})}function LW(r,e){const t=[],n={};for(const[l,u]of Object.entries(e.attributes)){let a=l;switch(l){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}n[a]=r.createBuffer({data:u.value,id:`${l}-buffer`});const{value:p,size:y,normalized:x}=u;t.push({name:a,format:M9(p,y,x)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}class zW{constructor(e){Z(this,"modules");Z(this,"moduleUniforms");Z(this,"moduleBindings");Z(this,"moduleUniformsChanged");const t=sb(Object.values(e).filter(n=>n.dependencies));for(const n of t)e[n.name]=n;Xt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,i]of Object.entries(e)){const l=n;this.moduleUniforms[l]=i.defaultUniforms||{},this.moduleBindings[l]={}}}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,l=e[i],u=this.modules[i];if(!u){Xt.warn(`Module ${n} not found`)();continue}const a=this.moduleUniforms[i],p=this.moduleBindings[i],y=((t=u.getUniforms)==null?void 0:t.call(u,l,a))||l,{uniforms:x,bindings:T}=I1(y);this.moduleUniforms[i]={...a,...x},this.moduleBindings[i]={...p,...T}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[l,u]of Object.entries(i))e[`${n}.${l}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[l],value:String(u)};return e}}const jv=class jv{constructor(e){Z(this,"device");Z(this,"_hashCounter",0);Z(this,"_hashes",{});Z(this,"_renderPipelineCache",{});Z(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new jv(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...id.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...Yy.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof Yy?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,n[t].useCount===0&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,i="-",l=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${n}V${i}BL${l}`;default:const u=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V${i}T${e.topology}P${u}BL${l}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};Z(jv,"defaultProps",{...id.defaultProps});let yw=jv;const Hv=class Hv{constructor(e){Z(this,"device");Z(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Hv(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,n.useCount===0&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};Z(Hv,"defaultProps",{...qy.defaultProps});let vw=Hv;function UW(r,e){var i;const t={},n="Values";if(r.attributes.length===0&&!((i=r.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const l of r.attributes)if(l){const u=`${l.location} ${l.name}: ${l.type}`;t[`in ${u}`]={[n]:l.stepMode||"vertex"}}for(const l of r.varyings||[]){const u=`${l.location} ${l.name}`;t[`out ${u}`]={[n]:JSON.stringify(l.accessor)}}return t}let os=null,i0=null;function VW(r,{id:e,minimap:t,opaque:n,top:i="0",left:l="0",rgbaScale:u=1}){os||(os=document.createElement("canvas"),os.id=e,os.title=e,os.style.zIndex="100",os.style.position="absolute",os.style.top=i,os.style.left=l,os.style.border="blue 1px solid",os.style.transform="scaleY(-1)",document.body.appendChild(os),i0=os.getContext("2d")),(os.width!==r.width||os.height!==r.height)&&(os.width=r.width/2,os.height=r.height/2,os.style.width="400px",os.style.height="400px");const a=r.device.readPixelsToArrayWebGL(r),p=i0.createImageData(r.width,r.height),y=0;for(let x=0;x<a.length;x+=4)p.data[y+x+0]=a[x+0]*u,p.data[y+x+1]=a[x+1]*u,p.data[y+x+2]=a[x+2]*u,p.data[y+x+3]=n?255:a[x+3]*u;i0.putImageData(p,0,0)}const dh=2,jW=1e4,Wv=class Wv{constructor(e,t){Z(this,"device");Z(this,"id");Z(this,"source");Z(this,"vs");Z(this,"fs");Z(this,"pipelineFactory");Z(this,"shaderFactory");Z(this,"userData",{});Z(this,"parameters");Z(this,"topology");Z(this,"bufferLayout");Z(this,"isInstanced");Z(this,"instanceCount",0);Z(this,"vertexCount");Z(this,"indexBuffer",null);Z(this,"bufferAttributes",{});Z(this,"constantAttributes",{});Z(this,"bindings",{});Z(this,"uniforms",{});Z(this,"vertexArray");Z(this,"transformFeedback",null);Z(this,"pipeline");Z(this,"shaderInputs");Z(this,"_uniformStore");Z(this,"_attributeInfos",{});Z(this,"_gpuGeometry",null);Z(this,"_getModuleUniforms");Z(this,"props");Z(this,"_pipelineNeedsUpdate","newly created");Z(this,"_needsRedraw","initializing");Z(this,"_destroyed",!1);Z(this,"_lastDrawTimestamp",-1);Z(this,"_lastLogTime",0);Z(this,"_logOpen",!1);Z(this,"_drawCount",0);var a,p,y,x;this.props={...Wv.defaultProps,...t},t=this.props,this.id=t.id||gu("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(T=>[T.name,T]))||[]);this.setShaderInputs(t.shaderInputs||new zW(n));const i=HW(e),l=(((p=this.props.modules)==null?void 0:p.length)>0?this.props.modules:(y=this.shaderInputs)==null?void 0:y.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(x=this.props).shaderLayout||(x.shaderLayout=fH(this.props.source));const{source:T,getUniforms:E}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:l});this.source=T,this._getModuleUniforms=E}else{const{vs:T,fs:E,getUniforms:k}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:l});this.vs=T,this.fs=E,this._getModuleUniforms=k}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||yw.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||vw.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&this.updateModuleSettings(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let t;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Wy(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,i=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const t=e&&FW(this.device,e);t&&(this.setTopology(t.topology||"triangle-list"),this.bufferLayout=VA(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)),this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?VA(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){aw(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new k9(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){e.indices&&Xt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,i]of Object.entries(e)){const l=this.bufferLayout.find(p=>jA(p).includes(n));if(!l){Xt.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const u=jA(l);let a=!1;for(const p of u){const y=this._attributeInfos[p];y&&(this.vertexArray.setBuffer(y.location,i),a=!0)}!a&&!((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)&&Xt.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const l=this._attributeInfos[n];l?this.vertexArray.setConstantWebGL(l.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||Xt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Wy(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:t,uniforms:n}=I1(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof $y?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ti||t instanceof So?e=Math.max(e,t.updateTimestamp):t instanceof Xy||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Xt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:i}),this._attributeInfos=b3(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Xt.level>3?0:jW;Xt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Xt.group(dh,`>>> DRAWING MODEL ${this.id}`,{collapsed:Xt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=UW(this.pipeline.shaderLayout,this.id);Xt.table(dh,e)();const t=this.shaderInputs.getDebugTable();for(const[i,l]of Object.entries(this.uniforms))t[i]={value:l};Xt.table(dh,t)();const n=this._getAttributeDebugTable();Xt.table(dh,this._attributeInfos)(),Xt.table(dh,n)(),Xt.groupEnd(dh)(),this._logOpen=!1}}_logFramebuffer(e){const t=Xt.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&VW(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=T3(t);return(e instanceof Ti?new n(e.debugData):e).toString()}};Z(Wv,"defaultProps",{...id.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Hy.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Cp=Wv;function VA(r,e){const t=[...r];for(const n of e){const i=t.findIndex(l=>l.name===n.name);i<0?t.push(n):t[i]=n}return t}function HW(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function jA(r){var e;return r.attributes?(e=r.attributes)==null?void 0:e.map(t=>t.attribute):[r.name]}class Pp{constructor(e,t=Cp.defaultProps){Z(this,"device");Z(this,"model");Z(this,"transformFeedback");oi(Pp.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Cp(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Oj(),topology:t.topology||"point-list",...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(t instanceof Ti)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:l=n.byteLength}=t;return n.readAsync(i,l)}}class WW{constructor(e){Z(this,"id");Z(this,"topology");Z(this,"vertexCount");Z(this,"indices");Z(this,"attributes");Z(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||gu("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[l,u]of Object.entries(t)){const a=ArrayBuffer.isView(u)?{value:u}:u;oi(ArrayBuffer.isView(a.value),`${this._print(l)}: must be typed array or object with value as typed array`),(l==="POSITION"||l==="positions")&&!a.size&&(a.size=3),l==="indices"?(oi(!this.indices),this.indices=a):this.attributes[l]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:l,size:u,constant:a}=i;!a&&l&&u>=1&&(n=Math.min(n,l.length/u))}return oi(Number.isFinite(n)),n}}const $W={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class hP extends V1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:l,pickingFBO:u,deviceRect:{x:a,y:p,width:y,height:x},cullRect:T,effects:E,pass:k="picking",pickZ:F,moduleParameters:D}){this.pickZ=F;const N=this._resetColorEncoder(F),B=[a,p,y,x],V=super.render({target:u,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:l,cullRect:T,effects:E==null?void 0:E.filter(j=>j.useInPicking),pass:k,isPicking:!0,moduleParameters:D,clearColor:[0,0,0,0],colorMask:15,scissorRect:B});return this._colorEncoderState=null,{decodePickingColor:N&&XW.bind(null,N),stats:V}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,n){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:l,operation:u}=e.props;return!this._colorEncoderState||u.includes("terrain")?i.blend=!1:l&&u.includes("draw")&&(Object.assign(i,$W),i.blend=!0,i.blendColor=qW(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function qW(r,e,t){const{byLayer:n,byAlpha:i}=r;let l,u=n.get(e);return u?(u.viewports.push(t),l=u.a):(l=n.size+1,l<=255?(u={a:l,layer:e,viewports:[t]},n.set(e,u),i[l]=u):(ri.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function XW(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const gh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},sv=Symbol.for("component"),su=Symbol.for("propTypes"),s0=Symbol.for("deprecatedProps"),Fh=Symbol.for("asyncPropDefaults"),hu=Symbol.for("asyncPropOriginal"),ec=Symbol.for("asyncPropResolved");function Rp(r,e=()=>!0){return Array.isArray(r)?dP(r,e,[]):e(r)?[r]:[]}function dP(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?dP(i,e,t):e(i)&&t.push(i)}return t}function ZW({target:r,source:e,start:t=0,count:n=1}){const i=e.length,l=n*i;let u=0;for(let a=t;u<i;u++)r[a++]=e[u];for(;u<l;)u<l-u?(r.copyWithin(t+u,t,t+u),u*=2):(r.copyWithin(t+u,t,t+l-u),u=l);return r}class YW{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=Vy(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===n&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class KW{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let l=this._resources[e];l?l.setData(t,n):(l=new YW(e,t,this._context),this._resources[e]=l),l.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const i=t[n],l=this._resources[i.resourceId];l&&l.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:l,protocol:u}=this;e.startsWith(u)&&(e=e.replace(u,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=l[e];if(this._track(n,i,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const l=this._consumers,u=l[e]=l[e]||{};let a=u[t];const p=a&&a.resourceId&&this._resources[a.resourceId];p&&(p.unsubscribe(a),this.prune()),n&&(a?(a.onChange=i,a.resourceId=n.id):a={onChange:i,resourceId:n.id},u[t]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const GW="layerManager.setLayers",JW="layerManager.activateViewport";class QW{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Bs(JW,this,a),a&&(this.context.viewport=a)};const{deck:n,stats:i,viewport:l,timeline:u}=t||{};this.layers=[],this.resourceManager=new KW({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:oW(),defaultShaderModules:[],renderPass:void 0,stats:i||new nb({id:"deck.gl"}),viewport:l||new Hm({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new uP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bs(GW,this,t,e),this._lastRenderedLayers=e;const n=Rp(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const u of e)n[u.id]?ri.warn(`Multiple old layers with same id ${u.id}`)():n[u.id]=u;if(this._defaultShaderModulesChanged){for(const u of e)u.setNeedsUpdate(),u.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let l=!1;for(const u of i)if(u.hasUniformTransition()){l=`Uniform transition in ${u}`;break}this._needsUpdate=l,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const l=t[i.id];l===null&&ri.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let u=null;try{this._debug&&l!==i&&i.validateProps(),l?(this._transferLayerState(l,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),u=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}u&&this._updateSublayersRecursively(u,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=gh.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=gh.MATCHED,t!==e&&(e.lifecycle=gh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=gh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=gh.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function jo(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!jo(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const l of n)if(!e.hasOwnProperty(l)||!jo(r[l],e[l],t-1))return!1;return!0}return!1}class e${constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let l=n.length-1;l>=0;--l){const u=n[l];if(u.containsPixel(i)){const a=e.slice();return a[0]-=u.x,a[1]-=u.y,u.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Rp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!jo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ri.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>{var u;return(u=this.getView(e.id))==null?void 0:u.makeViewport({viewState:l,width:this.width,height:this.height})}})}_updateController(e,t,n,i){const l=e.controller;if(l&&n){const u={...t,...l,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==l.type)&&(i=this._createController(e,u)),i&&i.setProps(u),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const l=e[i],u=this.getViewState(l),a=l.makeViewport({viewState:u,width:this.width,height:this.height});let p=t[l.id];const y=!!l.controller;y&&!p&&(n=!0),(n||!y)&&p&&(p.finalize(),p=null),this.controllers[l.id]=this._updateController(l,u,a,p),a&&this._viewports.unshift(a)}for(const i in t){const l=t[i];l&&!this.controllers[i]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const t$=/([0-9]+\.?[0-9]*)(%|px)/;function Ll(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=t$.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function zl(r,e){return r.relative?Math.round(r.position*e):r.position}class r${constructor(e){const{id:t,x:n=0,y:i=0,width:l="100%",height:u="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ll(n),this._y=Ll(i),this._width=Ll(l),this._height=Ll(u),this._padding=a&&{left:Ll(a.left||0),right:Ll(a.right||0),top:Ll(a.top||0),bottom:Ll(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&jo(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return!i.height||!i.width?null:new this.ViewportType({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:zl(this._x,e),y:zl(this._y,t),width:zl(this._width,e),height:zl(this._height,t)};return this._padding&&(n.padding={left:zl(this._padding.left,e),top:zl(this._padding.top,t),right:zl(this._padding.right,e),bottom:zl(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class ab{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(t=this.settings).onStart)==null||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const HA=()=>{},bw={BREAK:1,SNAP_TO_END:2,IGNORE:3},n$=r=>r,i$=bw.BREAK;class s${constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:l,endProps:u,duration:a,easing:p}}=t,y=p(n/a),x=i.interpolateProps(l,u,y);this.propsInTransition=this.getControllerState({...this.props,...x}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ab(e.timeline),this.onViewStateChange=e.onViewStateChange||HA,this.onStateChange=e.onStateChange||HA}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:l,endProps:u}=this.transition.settings;i={...n,...l===bw.SNAP_TO_END?u:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===bw.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),l=t.transitionInterpolator,u=l.getDuration?l.getDuration(e,t):t.transitionDuration;if(u===0)return;const a=l.initializeProps(e,i);this.propsInTransition={};const p={duration:u,easing:t.transitionEasing||n$,interpolator:l,interruption:t.transitionInterruption||i$,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(p),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Gi(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class o${constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Ap(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const l of this._propsToExtract)(l in e||l in t)&&(n[l]=e[l],i[l]=t[l]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Gi(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const a$=["longitude","latitude","zoom","bearing","pitch"],l$=["longitude","latitude","zoom"];class fP extends o${constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:a$,required:l$},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:l}=this.opts;if(i&&l){const u=i(e),a=i(t),p=u.unproject(l);n.start.around=l,Object.assign(n.end,{around:a.project(p),aroundPosition:p,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const l of this._propsToExtract)i[l]=tv(e[l]||0,t[l]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...t,...i});Object.assign(i,l.panByPosition(t.aroundPosition,tv(e.around,t.around,n)))}return i}}const Ul={transitionDuration:0},c$=300,sy=r=>1-(1-r)*(1-r),fh={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},$c={};class u${constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new s$({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const l=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return l&&t&&t.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?c$:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:l=!0,doubleClickZoom:u=!0,touchZoom:a=!0,touchRotate:p=!1,keyboard:y=!0}=e,x=!!this.onViewStateChange;this.toggleEvents(fh.WHEEL,x&&n),this.toggleEvents(fh.PAN,x),this.toggleEvents(fh.PINCH,x&&(a||p)),this.toggleEvents(fh.TRIPLE_PAN,x&&p),this.toggleEvents(fh.DOUBLE_TAP,x&&u),this.toggleEvents(fh.KEYBOARD,x&&y),this.scrollZoom=n,this.dragPan=i,this.dragRotate=l,this.doubleClickZoom=u,this.touchZoom=a,this.touchRotate=p,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),l){const u=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:u,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Ul,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Ul,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],l=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sy},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Ul,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],l=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sy},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let u=2/(1+Math.exp(-Math.abs(l*n)));l<0&&u!==0&&(u=1/u);const a=this.controllerState.zoom({pos:t,scale:u});return this.updateViewport(a,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Ul,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Ul,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],l=this.controllerState.rotate({pos:i});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sy},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return $c._startPinchRotation=e.rotation,$c._lastPinchEvent=e,this.updateViewport(n,Ul,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:$c._startPinchRotation-n})}return this.updateViewport(t,Ul,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),$c._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=$c;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let l=this.controllerState.rotateEnd();const u=Math.log2(e.scale),a=(u-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),p=Math.pow(2,u+a*t/2);l=l.zoom({pos:i,scale:p}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:sy},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return $c._startPinchRotation=null,$c._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:l,rotateSpeedY:u}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let p;const y={};switch(e.srcEvent.code){case"Minus":p=t?a.zoomOut(n).zoomOut(n):a.zoomOut(n),y.isZooming=!0;break;case"Equal":p=t?a.zoomIn(n).zoomIn(n):a.zoomIn(n),y.isZooming=!0;break;case"ArrowLeft":t?(p=a.rotateLeft(l),y.isRotating=!0):(p=a.moveLeft(i),y.isPanning=!0);break;case"ArrowRight":t?(p=a.rotateRight(l),y.isRotating=!0):(p=a.moveRight(i),y.isPanning=!0);break;case"ArrowUp":t?(p=a.rotateUp(u),y.isRotating=!0):(p=a.moveUp(i),y.isPanning=!0);break;case"ArrowDown":t?(p=a.rotateDown(u),y.isRotating=!0):(p=a.moveDown(i),y.isPanning=!0);break;default:return!1}return this.updateViewport(p,this._getTransitionProps(),y),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Ul:e?{...t,transitionInterpolator:new fP({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class h${constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const WA=5,d$=1.2;class f$ extends h${constructor(e){const{width:t,height:n,latitude:i,longitude:l,zoom:u,bearing:a=0,pitch:p=0,altitude:y=1.5,position:x=[0,0,0],maxZoom:T=20,minZoom:E=0,maxPitch:k=60,minPitch:F=0,startPanLngLat:D,startZoomLngLat:N,startRotatePos:B,startBearing:V,startPitch:U,startZoom:j,normalize:J=!0}=e;Gi(Number.isFinite(l)),Gi(Number.isFinite(i)),Gi(Number.isFinite(u)),super({width:t,height:n,latitude:i,longitude:l,zoom:u,bearing:a,pitch:p,altitude:y,maxZoom:T,minZoom:E,maxPitch:k,minPitch:F,normalize:J,position:x},{startPanLngLat:D,startZoomLngLat:N,startRotatePos:B,startBearing:V,startPitch:U,startZoom:j}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:l,startPitch:u}=this.getState();if(!i||l===void 0||u===void 0)return this;let a;return e?a=this._getNewRotation(e,i,u,l):a={bearing:l+t,pitch:u+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:l}=this.getState();if(l||(i=this.getViewportProps().zoom,l=this._unproject(t)||this._unproject(e)),!l)return this;const{maxZoom:u,minZoom:a}=this.getViewportProps();let p=i+Math.log2(n);p=Ql(p,a,u);const y=this.makeViewport({...this.getViewportProps(),zoom:p});return this._getUpdatedState({zoom:p,...y.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:l}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(l-t.longitude)>180&&(n.longitude=l<0?l+360:l-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Ql(i,n,t);const{maxPitch:l,minPitch:u,pitch:a}=e;e.pitch=Ql(a,u,l);const{normalize:p=!0}=e;return p&&Object.assign(e,q7(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const l=e[0]-t[0],u=e[1]-t[1],a=e[1],p=t[1],{width:y,height:x}=this.getViewportProps(),T=l/y;let E=0;u>0?Math.abs(x-p)>WA&&(E=u/(p-x)*d$):u<0&&p>WA&&(E=1-a/p),E=Ql(E,-1,1);const{minPitch:k,maxPitch:F}=this.getViewportProps(),D=i+180*T;let N=n;return E>0?N=n+E*(F-n):E<0&&(N=n-E*(k-n)),{pitch:N,bearing:D}}}class p$ extends u${constructor(){super(...arguments),this.ControllerState=f$,this.transition={transitionDuration:300,transitionInterpolator:new fP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class j1 extends r${constructor(e={}){super(e)}get ViewportType(){return uu}get ControllerType(){return p$}}j1.displayName="MapView";const g$=new lP;function m$(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class _${constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>m$(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(jo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const l=t[i.id];let u=i;l&&l!==i?l.setProps?(l.setProps(i.props),u=l):l.cleanup(this._context):l||i.setup(this._context),n.push(u),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof lP)||this._resolvedEffects.push(g$),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class y$ extends V1{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const v$="deckRenderer.renderLayers";class b${constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new y$(e),this.pickLayersPass=new hP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const l=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Bs(v$,this,l,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const l of e)if(l.postRender){i.target=l.id===this.lastPostProcessEffect?t.target:void 0;const u=l.postRender(i);i.inputBuffer=u,i.swapBuffer=u===n[0]?n[1]:n[0]}}}const x$={pickedColor:null,pickedObjectIndex:-1};function w$({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:i,deviceRect:l}){const{x:u,y:a,width:p,height:y}=l;let x=i*i,T=-1,E=0;for(let k=0;k<y;k++){const F=k+a-n,D=F*F;if(D>x)E+=4*p;else for(let N=0;N<p;N++){if(r[E+3]-1>=0){const V=N+u-t,U=V*V+D;U<=x&&(x=U,T=E)}E+=4}}if(T>=0){const k=r.slice(T,T+4),F=e(k);if(F){const D=Math.floor(T/4/p),N=T/4-D*p;return{...F,pickedColor:k,pickedX:u+N,pickedY:a+D}}ri.error("Picked non-existent layer. Is picking buffer corrupt?")()}return x$}function T$({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let n=0;n<r.length;n+=4)if(r[n+3]-1>=0){const l=r.slice(n,n+4),u=l.join(",");if(!t.has(u)){const a=e(l);a?t.set(u,{...a,color:l}):ri.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function pP({pickInfo:r,viewports:e,pixelRatio:t,x:n,y:i,z:l}){let u=e[0];e.length>1&&(u=A$((r==null?void 0:r.pickedViewports)||e,{x:n,y:i}));let a;if(u){const p=[n-u.x,i-u.y];l!==void 0&&(p[2]=l),a=u.unproject(p)}return{color:null,layer:null,viewport:u,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:a,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function S$(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:l,pickedLayer:u,pickedObjectIndex:a}=e,p=u?[u]:[];if(n==="hover"){const T=t.index,E=t.layerId,k=u?u.props.id:null;if(k!==E||a!==T){if(k!==E){const F=i.find(D=>D.props.id===E);F&&p.unshift(F)}t.layerId=k,t.index=a,t.info=null}}const y=pP(r),x=new Map;return x.set(null,y),p.forEach(T=>{let E={...y};T===u&&(E.color=l,E.index=a,E.picked=!0),E=gP({layer:T,info:E,mode:n});const k=E.layer;T===u&&n==="hover"&&(t.info=E),x.set(k.id,E),n==="hover"&&k.updateAutoHighlight(E)}),x}function gP({layer:r,info:e,mode:t}){for(;r&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:n}),r=r.parent}return e}function A$(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class E${constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new hP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},l=this.lastPickedInfo.info){const u=l&&l.layer&&l.layer.id,a=l&&l.viewport&&l.viewport.id,p=u?n.find(E=>E.id===u):null,y=a&&i.find(E=>E.id===a)||i[0],x=y&&y.unproject([e-y.x,t-y.y]);return{...l,...{x:e,y:t,viewport:y,coordinate:x,layer:p}}}_resizeBuffer(){var t,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:l,radius:u=0,depth:a=1,mode:p="query",unproject3D:y,onViewportActive:x,effects:T}){const E=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||n.length===0)return{result:[],emptyInfo:pP({viewports:n,x:i,y:l,pixelRatio:E})};this._resizeBuffer();const F=this.device.canvasContext.cssToDevicePixels([i,l],!0),D=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],N=Math.round(u*E),{width:B,height:V}=this.pickingFBO,U=this._getPickingRect({deviceX:D[0],deviceY:D[1],deviceRadius:N,deviceWidth:B,deviceHeight:V}),j={x:i-u,y:l-u,width:u*2+1,height:u*2+1};let J;const oe=[],le=new Set;for(let Ce=0;Ce<a;Ce++){let Ie;if(U){const De=this._drawAndSample({layers:k,views:t,viewports:n,onViewportActive:x,deviceRect:U,cullRect:j,effects:T,pass:`picking:${p}`});Ie=w$({...De,deviceX:D[0],deviceY:D[1],deviceRadius:N,deviceRect:U})}else Ie={pickedColor:null,pickedObjectIndex:-1};let Ue;if(Ie.pickedLayer&&y&&this.depthFBO){const{pickedColors:De}=this._drawAndSample({layers:[Ie.pickedLayer],views:t,viewports:n,onViewportActive:x,deviceRect:{x:Ie.pickedX,y:Ie.pickedY,width:1,height:1},cullRect:j,effects:T,pass:`picking:${p}:z`},!0);De[3]&&(Ue=De[0])}Ie.pickedLayer&&Ce+1<a&&(le.add(Ie.pickedLayer),Ie.pickedLayer.disablePickingIndex(Ie.pickedObjectIndex)),J=S$({pickInfo:Ie,lastPickedInfo:this.lastPickedInfo,mode:p,layers:k,viewports:n,x:i,y:l,z:Ue,pixelRatio:E});for(const De of J.values())De.layer&&oe.push(De);if(!Ie.pickedColor)break}for(const Ce of le)Ce.restorePickingColors();return{result:oe,emptyInfo:J.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:l,width:u=1,height:a=1,mode:p="query",maxObjects:y=null,onViewportActive:x,effects:T}){const E=this._getPickable(e);if(!E||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),F=this.device.canvasContext.cssToDevicePixels([i,l],!0),D=F.x,N=F.y+F.height,B=this.device.canvasContext.cssToDevicePixels([i+u,l+a],!0),V=B.x+B.width,U=B.y,j={x:D,y:U,width:V-D,height:N-U},J=this._drawAndSample({layers:E,views:t,viewports:n,onViewportActive:x,deviceRect:j,cullRect:{x:i,y:l,width:u,height:a},effects:T,pass:`picking:${p}`}),oe=T$(J),le=new Map,Ce=[],Ie=Number.isFinite(y);for(let Ue=0;Ue<oe.length&&!(Ie&&Ce.length>=y);Ue++){const De=oe[Ue];let pe={color:De.pickedColor,layer:null,index:De.pickedObjectIndex,picked:!0,x:i,y:l,pixelRatio:k};pe=gP({layer:De.pickedLayer,info:pe,mode:p});const ze=pe.layer.id;le.has(ze)||le.set(ze,new Set);const Ne=le.get(ze),ot=pe.object??pe.index;Ne.has(ot)||(Ne.add(ot),Ce.push(pe))}return Ce}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:l,cullRect:u,effects:a,pass:p},y=!1){const x=y?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:x,deviceRect:l,cullRect:u,effects:a,pass:p,pickZ:y,preRenderStats:{}};for(const V of a)V.useInPicking&&(T.preRenderStats[V.id]=V.preRender(T));const{decodePickingColor:E}=this.pickLayersPass.render(T),{x:k,y:F,width:D,height:N}=l,B=new(y?Float32Array:Uint8Array)(D*N*4);return this.device.readPixelsToArrayWebGL(x,{sourceX:k,sourceY:F,sourceWidth:D,sourceHeight:N,target:B}),{pickedColors:B,decodePickingColor:E}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:l}){const u=Math.max(0,e-n),a=Math.max(0,t-n),p=Math.min(i,e+n+1)-u,y=Math.min(l,t+n+1)-a;return p<=0||y<=0?null:{x:u,y:a,width:p,height:y}}}const I$={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},C$="top-left",$A="__root";class P${constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!jo(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=C$}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var u;const n=e||$A;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(u=this.parentElement)==null||u.append(i),this.containers[n]=i);let l=i.querySelector(`.${t}`);return l||(l=document.createElement("div"),l.className=t,l.style.position="absolute",l.style.zIndex="2",Object.assign(l.style,I$[t]),i.append(l)),l}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,l=n===$A||i,u=this.containers[n];l?(u.style.display="block",u.style.left=`${i?i.x:0}px`,u.style.top=`${i?i.y:0}px`,u.style.width=`${i?i.width:e}px`,u.style.height=`${i?i.height:t}px`):u.style.display="none"}}onRedraw({viewports:e,layers:t}){var l,u;const n=e.reduce((a,p)=>(a[p.id]=p,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:p}=a;if(p){const y=n[p];y&&(a.onViewportChange&&!y.equals(i[p])&&a.onViewportChange(y),(l=a.onRedraw)==null||l.call(a,{viewports:[y],layers:t}))}else{if(a.onViewportChange)for(const y of e)y.equals(i[y.id])||a.onViewportChange(y);(u=a.onRedraw)==null||u.call(a,{viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){var n,i;for(const l of this.getWidgets()){const{viewId:u}=l;(!u||u===((n=e.viewport)==null?void 0:n.id))&&((i=l.onHover)==null||i.call(l,e,t))}}onEvent(e,t){var i,l;const n=pw[t.type];if(n)for(const u of this.getWidgets()){const{viewId:a}=u;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((l=u[n.handler])==null||l.call(u,e,t))}}}const R$={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class k${constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,R$),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var vh;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(vh||(vh={}));const H1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vi=(r,e,t)=>e?r.enable(t):r.disable(t),qA=(r,e,t)=>r.hint(t,e),ao=(r,e,t)=>r.pixelStorei(t,e),XA=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},zf=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function o0(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const M$={3042:Vi,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:Vi,2885:(r,e)=>r.cullFace(e),2929:Vi,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:Vi,35723:qA,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>{var t;return(t=r.bindTransformFeedback)==null?void 0:t.call(r,36386,e)},34229:(r,e)=>r.bindVertexArray(e),36006:XA,36010:XA,34964:zf,36662:zf,36663:zf,35053:zf,35055:zf,2886:(r,e)=>r.frontFace(e),33170:qA,2849:(r,e)=>r.lineWidth(e),32823:Vi,32824:"polygonOffset",10752:"polygonOffset",35977:Vi,32926:Vi,32928:Vi,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vi,3088:(r,e)=>r.scissor(...e),2960:Vi,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:Vi,10754:Vi,12288:Vi,12289:Vi,12290:Vi,12291:Vi,12292:Vi,12293:Vi,12294:Vi,12295:Vi,3333:ao,3317:ao,37440:ao,37441:ao,37443:ao,3330:ao,3332:ao,3331:ao,3314:ao,32878:ao,3316:ao,3315:ao,32877:ao,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(...e),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=o0(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=o0(e)&&e.length===3?[...e,...e]:e;const[t,n,i,l,u,a]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,l,u,a)},stencilOp:(r,e)=>{e=o0(e)&&e.length===3?[...e,...e]:e;const[t,n,i,l,u,a]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,l,u,a)},viewport:(r,e)=>r.viewport(...e)};function Ii(r,e,t){return e[r]!==void 0?e[r]:t[r]}const O$={blendEquation:(r,e,t)=>r.blendEquationSeparate(Ii(32777,e,t),Ii(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(Ii(32969,e,t),Ii(32968,e,t),Ii(32971,e,t),Ii(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(Ii(32824,e,t),Ii(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(Ii(32938,e,t),Ii(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,Ii(2962,e,t),Ii(2967,e,t),Ii(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,Ii(34816,e,t),Ii(36003,e,t),Ii(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,Ii(2964,e,t),Ii(2965,e,t),Ii(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,Ii(34817,e,t),Ii(34818,e,t),Ii(34819,e,t))},ZA={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},ra=(r,e)=>r.isEnabled(e),YA={3042:ra,2884:ra,2929:ra,3024:ra,32823:ra,32926:ra,32928:ra,3089:ra,2960:ra,35977:ra},D$=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Td(r,e){if(F$(e))return;const t={};for(const i in e){const l=Number(i),u=M$[i];u&&(typeof u=="string"?t[u]=!0:u(r,e[i],l))}const n=r.state&&r.state.cache;if(n)for(const i in t){const l=O$[i];l(r,e,n)}}function mP(r,e=H1){if(typeof e=="number"){const i=e,l=YA[i];return l?l(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const l=YA[i];n[i]=l?l(r,Number(i)):r.getParameter(Number(i))}return n}function N$(r){Td(r,H1)}function F$(r){for(const e in r)return!1;return!0}function B$(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),n=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&n&&r.length===e.length){for(let i=0;i<r.length;++i)if(r[i]!==e[i])return!1;return!0}return!1}class L${constructor(e,{copyState:t=!1,log:n=()=>{}}={}){Z(this,"gl");Z(this,"program",null);Z(this,"stateStack",[]);Z(this,"enable",!0);Z(this,"cache");Z(this,"log");this.gl=e,this.cache=t?mP(e):Object.assign({},H1),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){oi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Td(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const l in e){oi(l!==void 0);const u=e[l],a=this.cache[l];B$(u,a)||(t=!0,n=a,i&&!(l in i)&&(i[l]=a),this.cache[l]=u)}return{valueChanged:t,oldValue:n}}}function du(r){return r.state}function _P(r,e){const{enable:t=!0,copyState:n}=e;if(oi(n!==void 0),!r.state){r.state=new L$(r,{copyState:n}),U$(r);for(const l in ZA){const u=ZA[l];z$(r,l,u)}KA(r,"getParameter"),KA(r,"isEnabled")}const i=du(r);return i.enable=t,r}function lb(r){let e=du(r);e||(_P(r,{copyState:!1}),e=du(r)),e.push()}function kp(r){const e=du(r);oi(e),e.pop()}function KA(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||D$.has(i))return t(i);const l=du(r);return i in l.cache||(l.cache[i]=t(i)),l.enable?l.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function z$(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(...l){const u=du(r),{valueChanged:a,oldValue:p}=t(u._updateCache,...l);return a&&n(...l),p},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function U$(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=du(r);i.program!==n&&(e(n),i.program=n)}}const V$={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function j$(r,e){e={...V$,...e};let t=null;const n=l=>t=l.statusMessage||t;r.addEventListener("webglcontextcreationerror",n,!1);let i=null;if(i||(i=r.getContext("webgl2",e)),r.removeEventListener("webglcontextcreationerror",n,!1),!i)throw new Error(`Failed to create WebGL context: ${t||"Unknown error"}`);if(e.onContextLost){const{onContextLost:l}=e;r.addEventListener("webglcontextlost",u=>l(u),!1)}if(e.onContextRestored){const{onContextRestored:l}=e;r.addEventListener("webglcontextrestored",u=>l(u),!1)}return i}function fc(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function H$(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);fc(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,l=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),u=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=l||t,p=u||n,y=r.getParameter(7938),x=yP(a,p),T=W$(a,p),E=$$(a,p);return{type:"webgl",gpu:x,gpuType:E,gpuBackend:T,vendor:a,renderer:p,version:y,shadingLanguage:"glsl",shadingLanguageVersion:300}}function yP(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function W$(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function $$(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(yP(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function vP(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const Es="texture-compression-bc",Qn="texture-compression-astc",na="texture-compression-etc2",q$="texture-compression-etc1-webgl",oy="texture-compression-pvrtc-webgl",a0="texture-compression-atc-webgl",Uf="float32-renderable-webgl",l0="float16-renderable-webgl",X$="rgb9e5ufloat_renderable-webgl",c0="snorm8-renderable-webgl",Vf="norm16-renderable-webgl",u0="snorm16-renderable-webgl",ay="float32-filterable",GA="float16-filterable-webgl",Gf="WEBGL_compressed_texture_s3tc",Jf="WEBGL_compressed_texture_s3tc_srgb",bh="EXT_texture_compression_rgtc",xh="EXT_texture_compression_bptc",Z$="WEBGL_compressed_texture_etc",Y$="WEBGL_compressed_texture_astc",K$="WEBGL_compressed_texture_etc1",G$="WEBGL_compressed_texture_pvrtc",J$="WEBGL_compressed_texture_atc",JA="EXT_texture_norm16",QA="EXT_render_snorm",Q$="EXT_color_buffer_float",W1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[QA],"norm16-renderable-webgl":[JA],"snorm16-renderable-webgl":[JA,QA],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Gf,Jf,bh,xh],"texture-compression-bc5-webgl":[bh],"texture-compression-bc7-webgl":[xh],"texture-compression-etc2":[Z$],"texture-compression-astc":[Y$],"texture-compression-etc1-webgl":[K$],"texture-compression-pvrtc-webgl":[G$],"texture-compression-atc-webgl":[J$]};function eq(r){return r in W1}function tq(r,e,t){return(W1[e]||[]).every(i=>fc(r,i,t))}const cb={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:c0},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:c0},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:l0,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Vf,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:u0},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:c0},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:l0,filter:GA,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Vf},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:u0},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Uf,filter:ay},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:X$},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Uf,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Vf},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Vf},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Uf,filter:ay,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:l0,filter:GA},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Vf,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:u0},"rgb32float-webgl":{gl:34837,render:Uf,filter:ay,gl2ext:Q$,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Uf,filter:ay,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Gf,f:Es},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Jf,f:Es},"bc1-rgba-unorm":{gl:33777,x:Gf,f:Es},"bc1-rgba-unorm-srgb":{gl:35916,x:Jf,f:Es},"bc2-rgba-unorm":{gl:33778,x:Gf,f:Es},"bc2-rgba-unorm-srgb":{gl:35918,x:Jf,f:Es},"bc3-rgba-unorm":{gl:33779,x:Gf,f:Es},"bc3-rgba-unorm-srgb":{gl:35919,x:Jf,f:Es},"bc4-r-unorm":{gl:36283,x:bh,f:Es},"bc4-r-snorm":{gl:36284,x:bh,f:Es},"bc5-rg-unorm":{gl:36285,x:bh,f:Es},"bc5-rg-snorm":{gl:36286,x:bh,f:Es},"bc6h-rgb-ufloat":{gl:36495,x:xh,f:Es},"bc6h-rgb-float":{gl:36494,x:xh,f:Es},"bc7-rgba-unorm":{gl:36492,x:xh,f:Es},"bc7-rgba-unorm-srgb":{gl:36493,x:xh,f:Es},"etc2-rgb8unorm":{gl:37492,f:na},"etc2-rgb8unorm-srgb":{gl:37494,f:na},"etc2-rgb8a1unorm":{gl:37496,f:na},"etc2-rgb8a1unorm-srgb":{gl:37497,f:na},"etc2-rgba8unorm":{gl:37493,f:na},"etc2-rgba8unorm-srgb":{gl:37495,f:na},"eac-r11unorm":{gl:37488,f:na},"eac-r11snorm":{gl:37489,f:na},"eac-rg11unorm":{gl:37490,f:na},"eac-rg11snorm":{gl:37491,f:na},"astc-4x4-unorm":{gl:37808,f:Qn},"astc-4x4-unorm-srgb":{gl:37840,f:Qn},"astc-5x4-unorm":{gl:37809,f:Qn},"astc-5x4-unorm-srgb":{gl:37841,f:Qn},"astc-5x5-unorm":{gl:37810,f:Qn},"astc-5x5-unorm-srgb":{gl:37842,f:Qn},"astc-6x5-unorm":{gl:37811,f:Qn},"astc-6x5-unorm-srgb":{gl:37843,f:Qn},"astc-6x6-unorm":{gl:37812,f:Qn},"astc-6x6-unorm-srgb":{gl:37844,f:Qn},"astc-8x5-unorm":{gl:37813,f:Qn},"astc-8x5-unorm-srgb":{gl:37845,f:Qn},"astc-8x6-unorm":{gl:37814,f:Qn},"astc-8x6-unorm-srgb":{gl:37846,f:Qn},"astc-8x8-unorm":{gl:37815,f:Qn},"astc-8x8-unorm-srgb":{gl:37847,f:Qn},"astc-10x5-unorm":{gl:37819,f:Qn},"astc-10x5-unorm-srgb":{gl:37851,f:Qn},"astc-10x6-unorm":{gl:37817,f:Qn},"astc-10x6-unorm-srgb":{gl:37849,f:Qn},"astc-10x8-unorm":{gl:37818,f:Qn},"astc-10x8-unorm-srgb":{gl:37850,f:Qn},"astc-10x10-unorm":{gl:37819,f:Qn},"astc-10x10-unorm-srgb":{gl:37851,f:Qn},"astc-12x10-unorm":{gl:37820,f:Qn},"astc-12x10-unorm-srgb":{gl:37852,f:Qn},"astc-12x12-unorm":{gl:37821,f:Qn},"astc-12x12-unorm-srgb":{gl:37853,f:Qn},"pvrtc-rgb4unorm-webgl":{gl:35840,f:oy},"pvrtc-rgba4unorm-webgl":{gl:35842,f:oy},"pvrtc-rbg2unorm-webgl":{gl:35841,f:oy},"pvrtc-rgba2unorm-webgl":{gl:35843,f:oy},"etc1-rbg-unorm-webgl":{gl:36196,f:q$},"atc-rgb-unorm-webgl":{gl:35986,f:a0},"atc-rgba-unorm-webgl":{gl:35986,f:a0},"atc-rgbai-unorm-webgl":{gl:34798,f:a0}},rq={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},nq={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function $1(r,e,t){const n=cb[e];if(!n||n.gl===void 0)return!1;const i=n.x||n.gl2ext;return i?!!fc(r,i,t):!0}function bP(r){const e=cb[r],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}function iq(r,e,t){if(!$1(r,e,t)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(m3(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!fc(r,"OES_texture_float_linear, extensions",t):e.endsWith("16float")?!!fc(r,"OES_texture_half_float_linear, extensions",t):!0}function sq(r,e,t){return!(!$1(r,e,t)||typeof e=="number")}function ov(r){var i;const e=cb[r],t=bP(r),n=m3(r);return{format:t,dataFormat:(e==null?void 0:e.dataFormat)||aq(n.format,n.integer,n.normalized,t),type:n.dataType?vP(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed}}function oq(r){const e=cb[r];if(!(e!=null&&e.attachment))throw new Error(`${r} is not a depth stencil format`);return e.attachment}function eE(r){const e=ov(r),t=rq[e.dataFormat]||4,n=nq[e.type]||1;return t*n}function aq(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;default:return 6408}}const tE={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class lq extends Yj{constructor(t,n,i){super([],i);Z(this,"gl");Z(this,"extensions");Z(this,"testedFeatures",new Set);this.gl=t,this.extensions=n,fc(t,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const t=this.getFeatures();for(const n of t)this.has(n)&&(yield n);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),eq(t)&&tq(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of t)this.has(n)}getFeatures(){return[...Object.keys(tE),...Object.keys(W1)]}getWebGLFeature(t){const n=tE[t];return typeof n=="string"?!!fc(this.gl,n,this.extensions):!!n}}class cq extends Zj{constructor(t){super();Z(this,"gl");Z(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}}function tc(r,e,t){if(uq(e))return t(r);const{nocatch:n=!0}=e;lb(r),Td(r,e);let i;if(n)i=t(r),kp(r);else try{i=t(r)}finally{kp(r)}return i}function uq(r){for(const e in r)return!1;return!0}function hq(r,e,t,n){if(Wy(e))return n(r);const i=r;lb(i.gl);try{return dq(r,e),Td(i.gl,t),n(r)}finally{kp(i.gl)}}function dq(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(ou("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const l=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,u=ou("provokingVertex",e.provokingVertex,{first:36429,last:36430});l==null||l.provokingVertexWEBGL(u)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const l=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,u=ou("polygonMode",e.polygonMode,{fill:6914,line:6913});l==null||l.polygonModeWEBGL(1028,u),l==null||l.polygonModeWEBGL(1029,u)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(pq("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(xw("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Xt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,l=xw("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,l,0,i),n.stencilFuncSeparate(1029,l,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=h0("stencilPassOperation",e.stencilPassOperation),l=h0("stencilFailOperation",e.stencilFailOperation),u=h0("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,l,u,i),n.stencilOpSeparate(1029,l,u,i)}if(e.blendColorOperation||e.blendAlphaOperation){n.enable(3042);const i=rE("blendColorOperation",e.blendColorOperation||"add"),l=rE("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,l);const u=ly("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=ly("blendColorDstFactor",e.blendColorDstFactor||"zero"),p=ly("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),y=ly("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(u,a,p,y)}}function xw(r,e){return ou(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function h0(r,e){return ou(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function rE(r,e){return ou(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ly(r,e){return ou(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function fq(r,e){return`Illegal parameter ${e} for ${r}`}function ou(r,e,t){if(!(e in t))throw new Error(fq(r,e));return t[e]}function pq(r,e){return e}function xP(r){const e={};return r.addressModeU&&(e[10242]=d0(r.addressModeU)),r.addressModeV&&(e[10243]=d0(r.addressModeV)),r.addressModeW&&(e[32882]=d0(r.addressModeW)),r.magFilter&&(e[10240]=wP(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=gq(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=xw("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function d0(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function wP(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function gq(r,e){if(!e)return wP(r);switch(r){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class sc extends Ti{constructor(t,n={}){super(t,n);Z(this,"device");Z(this,"gl");Z(this,"handle");Z(this,"glTarget");Z(this,"glUsage");Z(this,"glIndexType",5123);Z(this,"byteLength");Z(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=mq(this.props.usage),this.glUsage=_q(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(t,n=0,i=t.byteLength+n){const l=this.glTarget;this.gl.bindBuffer(l,this.handle),this.gl.bufferData(l,i,this.glUsage),this.gl.bufferSubData(l,n,t),this.gl.bindBuffer(l,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){oi(t>=0);let n=t;t===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,n,t.byteLength)}async readAsync(t=0,n){return this.readSyncWebGL(t,n)}readSyncWebGL(t=0,n){n=n??this.byteLength-t;const i=new Uint8Array(n),l=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,l,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,n),i}}function mq(r){return r&Ti.INDEX?34963:r&Ti.VERTEX?34962:r&Ti.UNIFORM?35345:34962}function _q(r){return r&Ti.INDEX||r&Ti.VERTEX?35044:r&Ti.UNIFORM?35048:35044}class ww extends Xy{constructor(t,n){super(t,n);Z(this,"device");Z(this,"handle");Z(this,"parameters");this.device=t,this.parameters=xP(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[n,i]of Object.entries(t)){const l=Number(n);switch(l){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,l,i);break;default:this.device.gl.samplerParameteri(this.handle,l,i);break}}}}class wh extends $y{constructor(t,n){super(t,{...So.defaultProps,...n});Z(this,"device");Z(this,"gl");Z(this,"handle");Z(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const yq={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},hp=class hp extends So{constructor(t,n){var i;super(t,{...yq,format:"rgba8unorm",...n});Z(this,"MAX_ATTRIBUTES");Z(this,"device");Z(this,"gl");Z(this,"handle");Z(this,"sampler");Z(this,"view");Z(this,"glFormat");Z(this,"type");Z(this,"dataFormat");Z(this,"mipmaps");Z(this,"target");Z(this,"textureUnit");Z(this,"loaded",!1);Z(this,"_video");this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=vq(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:F9(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new wh(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let n=t.data;if(n instanceof Promise)return n.then(B=>this.initialize(Object.assign({},t,{pixels:B,data:B}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(t)),this;const{parameters:l={}}=t,{pixels:u=null,pixelStore:a={},textureUnit:p=void 0,mipmaps:y=!0}=t;n||(n=u);let{width:x,height:T,dataFormat:E,type:k,compressed:F=!1}=t;const{depth:D=0}=t,N=bP(t.format);return{width:x,height:T,compressed:F,dataFormat:E,type:k}=this._deduceParameters({format:t.format,type:k,dataFormat:E,compressed:F,data:n,width:x,height:T}),this.width=x,this.height=T,this.glFormat=N,this.type=k,this.dataFormat=E,this.textureUnit=p,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=y,this.setImageData({data:n,width:x,height:T,depth:D,format:t.format,type:k,dataFormat:E,parameters:a,compressed:F}),this.setSampler(t.sampler),this._setSamplerParameters(l),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),y&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}initializeCube(t){const{mipmaps:n=!0,parameters:i={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,n&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(i)}),this}setSampler(t={}){let n;t instanceof ww?(this.sampler=t,n=t.props):(this.sampler=new ww(this.device,t),n=t);const i=xP(n);return this._setSamplerParameters(i),this}resize(t){const{height:n,width:i,mipmaps:l=!1}=t;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:l}):this}update(){if(this._video){const{video:t,parameters:n,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),tc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:l=0,glFormat:u=this.glFormat,offset:a=0,parameters:p={}}=t;let{data:y=null,type:x=this.type,width:T=this.width,height:E=this.height,dataFormat:k=this.dataFormat,compressed:F=!1}=t;y||(y=i),{type:x,dataFormat:k,compressed:F,width:T,height:E}=this._deduceParameters({format:this.props.format,type:x,dataFormat:k,compressed:F,data:y,width:T,height:E});const{gl:D}=this;D.bindTexture(this.target,this.handle);let N=null;if({data:y,dataType:N}=this._getDataType({data:y,compressed:F}),tc(this.gl,p,()=>{switch(N){case"null":D.texImage2D(n,l,u,T,E,0,k,x,y);break;case"typed-array":D.texImage2D(n,l,u,T,E,0,k,x,y,a);break;case"buffer":this.device.gl.bindBuffer(35052,y.handle||y),this.device.gl.texImage2D(n,l,u,T,E,0,k,x,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":D.texImage2D(n,l,u,T,E,0,k,x,y);break;case"compressed":for(const[B,V]of y.entries())D.compressedTexImage2D(n,B,V.format,V.width,V.height,0,V.data);break;default:oi(!1,"Unknown image data type")}}),y&&y.byteLength)this.trackAllocatedMemory(y.byteLength,"Texture");else{const B=eE(this.props.format);this.trackAllocatedMemory(this.width*this.height*B,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:n=null,data:i=null,x:l=0,y:u=0,width:a=this.width,height:p=this.height,level:y=0,glFormat:x=this.glFormat,type:T=this.type,dataFormat:E=this.dataFormat,compressed:k=!1,offset:F=0,parameters:D={}}){if({type:T,dataFormat:E,compressed:k,width:a,height:p}=this._deduceParameters({format:this.props.format,type:T,dataFormat:E,compressed:k,data:i,width:a,height:p}),oi(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const N=i;i=N.data,a=N.shape[0],p=N.shape[1]}i instanceof sc&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),tc(this.gl,D,()=>{k?this.gl.compressedTexSubImage2D(t,y,l,u,a,p,x,i):i===null?this.gl.texSubImage2D(t,y,l,u,a,p,E,T,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(t,y,l,u,a,p,E,T,i,F):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(t,y,l,u,a,p,E,T,F),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,y,l,u,a,p,E,T,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return Xt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:n}=this;return t!==void 0&&(this.textureUnit=t,n.activeTexture(33984+t)),n.bindTexture(this.target,null),t}_getDataType({data:t,compressed:n=!1}){return n?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof sc?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:n,data:i}=t;let{width:l,height:u,dataFormat:a,type:p,compressed:y}=t;const x=ov(n);return a=a||x.dataFormat,p=p||x.type,y=y||x.compressed,{width:l,height:u}=this._deduceImageSize(i,l,u),{dataFormat:a,type:p,compressed:y,width:l,height:u,format:n,data:i}}_deduceImageSize(t,n,i){let l;return typeof ImageData<"u"&&t instanceof ImageData?l={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?l={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?l={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?l={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?l={width:t.videoWidth,height:t.videoHeight}:t?l={width:n,height:i}:l={width:n>=0?n:1,height:i>=0?i:1},oi(l,"Could not deduced texture size"),oi(n===void 0||l.width===n,"Deduced texture width does not match supplied width"),oi(i===void 0||l.height===i,"Deduced texture height does not match supplied height"),l}async setCubeMapImageData(t){const{gl:n}=this,{width:i,height:l,pixels:u,data:a,format:p=6408,type:y=5121}=t,x=u||a,T=await Promise.all(hp.FACES.map(E=>{const k=x[E];return Promise.all(Array.isArray(k)?k:[k])}));this.bind(),hp.FACES.forEach((E,k)=>{T[k].length>1&&this.props.mipmaps!==!1&&Xt.warn(`${this.id} has mipmap and multiple LODs.`)(),T[k].forEach((F,D)=>{i&&l?n.texImage2D(E,D,p,i,l,0,p,y,F):n.texImage2D(E,D,p,p,y,F)})}),this.unbind()}setImageDataForFace(t){const{face:n,width:i,height:l,pixels:u,data:a,format:p=6408,type:y=5121}=t,{gl:x}=this,T=u||a;return this.bind(),T instanceof Promise?T.then(E=>this.setImageDataForFace(Object.assign({},t,{face:n,data:E,pixels:E}))):this.width||this.height?x.texImage2D(n,0,p,i,l,0,p,y,T):x.texImage2D(n,0,p,p,y,T),this}setImageData3D(t){const{level:n=0,dataFormat:i,format:l,type:u,width:a,height:p,depth:y=1,offset:x=0,data:T,parameters:E={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const k=ov(l);if(tc(this.gl,E,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,n,k.format,a,p,y,0,k.dataFormat,k.type,T),T instanceof sc&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,n,i,a,p,y,0,l,u,x))}),T&&T.byteLength)this.trackAllocatedMemory(T.byteLength,"Texture");else{const F=eE(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*F,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!Wy(t)){bq(t),this.gl.bindTexture(this.target,this.handle);for(const[n,i]of Object.entries(t)){const l=Number(n),u=i;switch(l){case 33082:case 33083:this.gl.texParameterf(this.target,l,u);break;default:this.gl.texParameteri(this.target,l,u);break}}this.gl.bindTexture(this.target,null)}}};Z(hp,"FACES",[34069,34070,34071,34072,34073,34074]);let ma=hp;function vq(r){switch(r.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(r.dimension)}}function bq(r){Xt.log(1,"texture sampler parameters",r)()}class ap extends Zy{constructor(t,n){super(t,n);Z(this,"device");Z(this,"gl");Z(this,"handle");const i=n.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const l=this.gl.bindFramebuffer(36160,this.handle);for(let u=0;u<this.colorAttachments.length;++u){const a=this.colorAttachments[u],p=36064+u;a&&this._attachOne(p,a)}if(this.depthStencilAttachment&&this._attachOne(oq(this.depthStencilAttachment.props.format),this.depthStencilAttachment),n.check!==!1){const u=this.gl.checkFramebufferStatus(36160);if(u!==36053)throw new Error(`Framebuffer ${wq(u)}`)}this.gl.bindFramebuffer(36160,l)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new ma(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,n){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:t,height:n});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:n}),this}_attachOne(t,n){if(Array.isArray(n)){const[i,l=0,u=0]=n;return this._attachTexture(t,i,l,u),i}if(n instanceof ma)return this._attachTexture(t,n,0,0),n;if(n instanceof wh){const i=n;return this._attachTexture(t,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),n.texture}throw new Error("attach")}_attachTexture(t,n,i,l){const{gl:u}=this.device;switch(u.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:u.framebufferTextureLayer(36160,t,n.target,l,i);break;case 34067:const a=xq(i);u.framebufferTexture2D(36160,t,a,n.handle,l);break;case 3553:u.framebufferTexture2D(36160,t,3553,n.handle,l);break;default:oi(!1,"Illegal texture type")}u.bindTexture(n.target,null)}}function xq(r){return r<34069?r+34069:r}function wq(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class Tq extends E1{constructor(t,n){super(n);Z(this,"device");Z(this,"presentationSize");Z(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ap(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(n,t);return}}commit(){}}const Sq={spector:Xt.get("spector")||Xt.get("spectorjs")},Aq="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",Eq=1;let ei=null,nE=!1;async function Iq(r){if(!globalThis.SPECTOR)try{await S3(Aq)}catch(e){Xt.warn(String(e))}}function Cq(r){if(r={...Sq,...r},!(r!=null&&r.spector)||(!ei&&globalThis.SPECTOR&&(Xt.probe(Eq,"SPECTOR found and initialized")(),ei=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ei)),!ei))return null;if(nE||(nE=!0,ei.spyCanvases(),ei==null||ei.onCaptureStarted.add(e=>Xt.info("Spector capture started:",e)()),ei==null||ei.onCapture.add(e=>{Xt.info("Spector capture complete:",e)(),ei==null||ei.getResultUI(),ei==null||ei.resultView.display(),ei==null||ei.resultView.addCapture(e)})),r!=null&&r.canvas){if(typeof r.spector=="string"&&r.spector!==r.canvas.id)return ei;ei==null||ei.startCapture(r==null?void 0:r.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Xt.info("Spector capture stopped after 2 seconds")(),ei==null||ei.stopCapture()})}return ei}const Pq="https://unpkg.com/webgl-debug@2.0.1/index.js";function TP(r){return r.luma=r.luma||{},r.luma}async function Rq(){gc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await S3(Pq))}function kq(r,e={}){return r?e.debug?Oq(r,e):Mq(r):null}function Mq(r){const e=TP(r);return e.realContext?e.realContext:r}function Oq(r,e){if(!globalThis.WebGLDebugUtils)return Xt.warn("webgl-debug not loaded")(),r;const t=TP(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...vh,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,Dq.bind(null,e),Nq.bind(null,e));for(const u in vh)!(u in n)&&typeof vh[u]=="number"&&(n[u]=vh[u]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const l=Object.create(i);return t.realContext=r,t.debugContext=l,l.debug=!0,l}function f0(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function Dq(r,e,t,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),l=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),u=`${i} in gl.${t}(${l})`;Xt.error(u)();debugger;if(r.throwOnError)throw new Error(u)}function Nq(r,e,t){let n="";if(Xt.level>=1&&(n=f0(e,t),Xt.log(1,n)()),r.break&&r.break.length>0&&(n=n||f0(e,t),r.break.every(l=>n.indexOf(l)!==-1)))debugger;for(const i of t)if(i===void 0){if(n=n||f0(e,t),r.throwOnError)throw new Error(`Undefined argument: ${n}`);Xt.error(`Undefined argument: ${n}`)();debugger}}function Fq(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[T,E]=i;t.push({message:E.trim(),type:iE(T),lineNum:0,linePos:0});continue}const[l,u,a,...p]=i;let y=parseInt(a,10);isNaN(y)&&(y=0);let x=parseInt(u,10);isNaN(x)&&(x=0),t.push({message:p.join(":").trim(),type:iE(l),lineNum:y,linePos:x})}return t}function iE(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class Bq extends qy{constructor(t,n){super(t,n);Z(this,"device");Z(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return Fq(t)}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return n==null?void 0:n.getTranslatedShaderSource(this.handle)}async _compile(t){t=(l=>l.startsWith("#version ")?l:`#version 100
${l}`)(t);const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),Xt.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Xt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Xt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async l=>await new Promise(u=>setTimeout(u,l));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const Lq=256,zq=1024,Uq=16384,p0=6144,Vq=[1,2,4,8];class jq extends tw{constructor(t,n){super(t,n);Z(this,"device");Z(this,"glParameters");this.device=t,lb(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){kp(this.device.gl)}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const n={...this.glParameters};this.props.framebuffer&&(n.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(n.viewport=t.viewport.slice(0,4),n.depthRange=[t.viewport[4],t.viewport[5]]):n.viewport=t.viewport),t.scissorRect&&(n.scissorTest=!0,n.scissor=t.scissorRect),t.blendConstant&&(n.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(n.colorMask=Vq.map(i=>!!(i&t.colorMask))),this.glParameters=n,Td(this.device.gl,n)}beginOcclusionQuery(t){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let n=0;this.props.clearColor!==!1&&(n|=Uq,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=Lq,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=zq,t.clearStencil=this.props.clearStencil),n!==0&&tc(this.device.gl,t,()=>{this.device.gl.clear(n)})}clearColorBuffer(t=0,n=[0,0,0,0]){tc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int32Array:this.device.gl.clearBufferiv(p0,t,n);break;case Uint32Array:this.device.gl.clearBufferuiv(p0,t,n);break;case Float32Array:default:this.device.gl.clearBufferfv(p0,t,n);break}})}}const Hq="Failed to deduce GL constant from typed array";function Wq(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Hq)}}function Tw(r,e){const{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const $q={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},qq={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class lp{constructor(...e){Z(this,"offset");Z(this,"stride");Z(this,"type");Z(this,"size");Z(this,"divisor");Z(this,"normalized");Z(this,"integer");Z(this,"buffer");Z(this,"index");e.forEach(t=>this._assign(t)),Object.freeze(this)}static getBytesPerElement(e){return Tw(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return oi(e.size),Tw(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new lp($q,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return lp.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return lp.getBytesPerVertex(this)}_assign(e={}){return e=D9("Accessor",e,qq),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function Xq(r){return Zq.includes(r)}const Zq=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],SP={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function AP(r){const e=SP[r];if(!e)throw new Error("uniform");const[t,n,,i]=e;return{format:i,components:n,glType:t}}function Yq(r){const e=SP[r];if(!e)throw new Error("attribute");const[,t,,n,i]=e;return{attributeType:n,vertexFormat:i,components:t}}function Kq(r,e){const t={attributes:[],bindings:[]};t.attributes=Gq(r,e);const n=eX(r,e);for(const a of n){const p=a.uniforms.map(y=>({name:y.name,format:y.format,byteOffset:y.byteOffset,byteStride:y.byteStride,arrayLength:y.arrayLength}));t.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:p})}const i=Qq(r,e);let l=0;for(const a of i)if(Xq(a.type)){const{viewDimension:p,sampleType:y}=rX(a.type);t.bindings.push({type:"texture",name:a.name,location:l,viewDimension:p,sampleType:y}),a.textureUnit=l,l+=1}i.length&&(t.uniforms=i);const u=Jq(r,e);return u!=null&&u.length&&(t.varyings=u),t}function Gq(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const l=r.getActiveAttrib(e,i);if(!l)throw new Error("activeInfo");const{name:u,type:a}=l,p=r.getAttribLocation(e,u);if(p>=0){const{attributeType:y}=Yq(a),x=/instance/i.test(u)?"instance":"vertex";t.push({name:u,location:p,stepMode:x,type:y})}}return t.sort((i,l)=>i.location-l.location),t}function Jq(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const l=r.getTransformFeedbackVarying(e,i);if(!l)throw new Error("activeInfo");const{name:u,type:a,size:p}=l,{glType:y,components:x}=AP(a),T=new lp({type:y,size:p*x}),E={location:i,name:u,accessor:T};t.push(E)}return t.sort((i,l)=>i.location-l.location),t}function Qq(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const l=r.getActiveUniform(e,i);if(!l)throw new Error("activeInfo");const{name:u,size:a,type:p}=l,{name:y,isArray:x}=nX(u);let T=r.getUniformLocation(e,y);const E={location:T,name:y,size:a,type:p,isArray:x};if(t.push(E),E.size>1)for(let k=0;k<E.size;k++){const F=`${y}[${k}]`;T=r.getUniformLocation(e,F);const D={...E,name:F,location:T};t.push(D)}}return t}function eX(r,e){const t=(l,u)=>r.getActiveUniformBlockParameter(e,l,u),n=[],i=r.getProgramParameter(e,35382);for(let l=0;l<i;l++){const u={name:r.getActiveUniformBlockName(e,l)||"",location:t(l,35391),byteLength:t(l,35392),vertex:t(l,35396),fragment:t(l,35398),uniformCount:t(l,35394),uniforms:[]},a=t(l,35395)||[],p=r.getActiveUniforms(e,a,35383),y=r.getActiveUniforms(e,a,35384),x=r.getActiveUniforms(e,a,35387),T=r.getActiveUniforms(e,a,35388);for(let E=0;E<u.uniformCount;++E){const k=r.getActiveUniform(e,a[E]);if(!k)throw new Error("activeInfo");u.uniforms.push({name:k.name,format:AP(p[E]).format,type:p[E],arrayLength:y[E],byteOffset:x[E],byteStride:T[E]})}n.push(u)}return n.sort((l,u)=>l.location-u.location),n}const tX={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function rX(r){const e=tX[r];if(!e)throw new Error("sampler");const[t,n]=e;return{viewDimension:t,sampleType:n}}function nX(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function iX(r,e,t,n){const i=r;let l=n;l===!0&&(l=1),l===!1&&(l=0);const u=typeof l=="number"?[l]:l;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,u);case 35664:return r.uniform2fv(e,u);case 35665:return r.uniform3fv(e,u);case 35666:return r.uniform4fv(e,u);case 5124:return r.uniform1iv(e,u);case 35667:return r.uniform2iv(e,u);case 35668:return r.uniform3iv(e,u);case 35669:return r.uniform4iv(e,u);case 35670:return r.uniform1iv(e,u);case 35671:return r.uniform2iv(e,u);case 35672:return r.uniform3iv(e,u);case 35673:return r.uniform4iv(e,u);case 5125:return i.uniform1uiv(e,u,1);case 36294:return i.uniform2uiv(e,u,2);case 36295:return i.uniform3uiv(e,u,3);case 36296:return i.uniform4uiv(e,u,4);case 35674:return r.uniformMatrix2fv(e,!1,u);case 35675:return r.uniformMatrix3fv(e,!1,u);case 35676:return r.uniformMatrix4fv(e,!1,u);case 35685:return i.uniformMatrix2x3fv(e,!1,u);case 35686:return i.uniformMatrix2x4fv(e,!1,u);case 35687:return i.uniformMatrix3x2fv(e,!1,u);case 35688:return i.uniformMatrix3x4fv(e,!1,u);case 35689:return i.uniformMatrix4x2fv(e,!1,u);case 35690:return i.uniformMatrix4x3fv(e,!1,u)}throw new Error("Illegal uniform")}function sX(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(r)}}function oX(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(r)}}const sE=4;class aX extends id{constructor(t,n){super(t,n);Z(this,"device");Z(this,"handle");Z(this,"vs");Z(this,"fs");Z(this,"introspectedLayout");Z(this,"uniforms",{});Z(this,"bindings",{});Z(this,"varyings",null);Z(this,"_uniformCount",0);Z(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:l=35981}=n;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,l)),this._linkShaders(),Xt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Kq(this.device.gl,this.handle),Xt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=x9(this.introspectedLayout,n.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Xt.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,n){for(const[i,l]of Object.entries(t)){const u=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!u){const a=this.shaderLayout.bindings.map(p=>`"${p.name}"`).join(", ");n!=null&&n.disableWarnings||Xt.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(l||Xt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),u.type){case"uniform":if(!(l instanceof sc)&&!(l.buffer instanceof sc))throw new Error("buffer value");break;case"texture":if(!(l instanceof wh||l instanceof ma||l instanceof ap))throw new Error("texture value");break;case"sampler":Xt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(u.type)}this.bindings[i]=l}}draw(t){var N;const{renderPass:n,parameters:i=this.props.parameters,topology:l=this.props.topology,vertexArray:u,vertexCount:a,instanceCount:p,isInstanced:y=!1,firstVertex:x=0,transformFeedback:T}=t,E=sX(l),k=!!u.indexBuffer,F=(N=u.indexBuffer)==null?void 0:N.glIndexType;if(this.linkStatus!=="success")return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),u.bindBeforeRender(n),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const D=n;return hq(this.device,i,D.glParameters,()=>{k&&y?this.device.gl.drawElementsInstanced(E,a||0,F,x,p||0):k?this.device.gl.drawElements(E,a||0,F,x):y?this.device.gl.drawArraysInstanced(E,x,a||0,p||0):this.device.gl.drawArrays(E,x,a||0),T&&T.end()}),u.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:n}=I1(t);Object.keys(n).forEach(i=>{Xt.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Xt.time(sE,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Xt.timeEnd(sE,`linkProgram for ${this.id}`)(),Xt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Xt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Xt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}_reportLinkStatus(t){var n;switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((n=this.fs)==null?void 0:n.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async l=>await new Promise(u=>setTimeout(u,l));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const[,n]of Object.entries(this.bindings))n instanceof ma&&(n.update(),t=t&&n.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let n=0,i=0;for(const l of this.shaderLayout.bindings){const u=this.bindings[l.name]||this.bindings[l.name.replace(/Uniforms$/,"")];if(!u)throw new Error(`No value for binding ${l.name} in ${this.id}`);switch(l.type){case"uniform":const{name:a}=l,p=t.getUniformBlockIndex(this.handle,a);if(p===4294967295)throw new Error(`Invalid uniform block name ${a}`);t.uniformBlockBinding(this.handle,i,p),u instanceof sc?t.bindBufferBase(35345,i,u.handle):t.bindBufferRange(35345,i,u.buffer.handle,u.offset||0,u.size||u.buffer.byteLength-u.offset),i+=1;break;case"texture":if(!(u instanceof wh||u instanceof ma||u instanceof ap))throw new Error("texture");let y;if(u instanceof wh)y=u.texture;else if(u instanceof ma)y=u;else if(u instanceof ap&&u.colorAttachments[0]instanceof wh)Xt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),y=u.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+n),t.bindTexture(y.target,y.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${l.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:l,textureUnit:u}=t,a=this.uniforms[n]??u;a!==void 0&&iX(this.device.gl,i,l,a)}}}class lX extends nw{constructor(t){super(t,{});Z(this,"device");Z(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const n of t)switch(n.name){case"copy-buffer-to-buffer":cX(this.device,n.options);break;case"copy-buffer-to-texture":uX(this.device,n.options);break;case"copy-texture-to-buffer":hX(this.device,n.options);break;case"copy-texture-to-texture":dX(this.device,n.options);break}}}function cX(r,e){const t=e.source,n=e.destination;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function uX(r,e){throw new Error("Not implemented")}function hX(r,e){const{source:t,mipLevel:n=0,aspect:i="all",width:l=e.source.width,height:u=e.source.height,depthOrArrayLayers:a=0,origin:p=[0,0],destination:y,byteOffset:x=0,bytesPerRow:T,rowsPerImage:E}=e;if(i!=="all")throw new Error("not supported");if(n!==0||a!==0||T||E)throw new Error("not implemented");const{framebuffer:k,destroyFramebuffer:F}=EP(t);let D;try{const N=y,B=l||k.width,V=u||k.height,U=ov(k.texture.props.format),j=U.dataFormat,J=U.type;r.gl.bindBuffer(35051,N.handle),D=r.gl.bindFramebuffer(36160,k.handle),r.gl.readPixels(p[0],p[1],B,V,j,J,x)}finally{r.gl.bindBuffer(35051,null),D!==void 0&&r.gl.bindFramebuffer(36160,D),F&&k.destroy()}}function dX(r,e){const{source:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:l=[0,0],destination:u}=e;let{width:a=e.destination.width,height:p=e.destination.height}=e;const{framebuffer:y,destroyFramebuffer:x}=EP(t),[T,E]=i,[k,F,D]=l,N=r.gl.bindFramebuffer(36160,y.handle);let B=null,V;if(u instanceof ma)B=u,a=Number.isFinite(a)?a:B.width,p=Number.isFinite(p)?p:B.height,B.bind(0),V=B.target;else throw new Error("invalid destination");switch(V){case 3553:case 34067:r.gl.copyTexSubImage2D(V,n,k,F,T,E,a,p);break;case 35866:case 32879:r.gl.copyTexSubImage3D(V,n,k,F,D,T,E,a,p);break}B&&B.unbind(),r.gl.bindFramebuffer(36160,N),x&&y.destroy()}function EP(r){if(r instanceof So){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}class fX extends rw{constructor(t,n){super(t,n);Z(this,"device");Z(this,"commandBuffer");this.device=t,this.commandBuffer=new lX(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,n,i){}}class q1 extends iw{constructor(t,n){super(t,n);Z(this,"device");Z(this,"handle");Z(this,"buffer",null);Z(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return UU()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const n=t;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(t,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:l,type:u,stride:a,offset:p,normalized:y,integer:x,divisor:T}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),x?this.device.gl.vertexAttribIPointer(t,l,u,a,p):this.device.gl.vertexAttribPointer(t,l,u,y,a,p),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,T||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,n){this._enable(t,!1),this.attributes[t]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const n=this.attributes[t];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(t,n)}}_getAccessor(t){const n=this.attributeInfos[t];if(!n)throw new Error(`Unknown attribute location ${t}`);const i=vP(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(t,n=!0){const l=q1.isConstantAttributeZeroSupported(this.device)||t!==0;(n||l)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,n){const i=pX(n),l=i.byteLength*t,u=i.length*t;if(this.buffer&&l!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${l} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:l}),a=a||!gX(i,this.bufferValue),a){const p=A9(n.constructor,u);E9({target:p,source:i,start:0,count:u}),this.buffer.write(p),this.bufferValue=n}return this.buffer}}function pX(r){return Array.isArray(r)?new Float32Array(r):r}function gX(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class mX extends sw{constructor(t,n){super(t,n);Z(this,"device");Z(this,"gl");Z(this,"handle");Z(this,"layout");Z(this,"buffers",{});Z(this,"unusedBuffers",{});Z(this,"bindOnUse",!0);Z(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(oX(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in t)this.setBuffer(n,t[n])})}setBuffer(t,n){const i=this._getVaryingIndex(t),{buffer:l,byteLength:u,byteOffset:a}=this._getBufferRange(n);if(i<0){this.unusedBuffers[t]=l,Xt.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:l,byteLength:u,byteOffset:a},this.bindOnUse||this._bindBuffer(i,l,a,u)}getBuffer(t){if(oE(t))return this.buffers[t]||null;const n=this._getVaryingIndex(t);return n>=0?this.buffers[n]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let n;return this._bound?n=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof sc)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:n,byteOffset:i=0,byteLength:l=t.buffer.byteLength}=t;return{buffer:n,byteOffset:i,byteLength:l}}_getVaryingIndex(t){if(oE(t))return Number(t);for(const n of this.layout.varyings)if(t===n.name)return n.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:n,byteLength:i,byteOffset:l}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),n,l,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,n,i=0,l){const u=n&&n.handle;!u||l===void 0?this.gl.bindBufferBase(35982,t,u):this.gl.bindBufferRange(35982,t,u,i,l)}}function oE(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class _X extends ow{constructor(t,n){super(t,n);Z(this,"device");Z(this,"handle");Z(this,"target",null);Z(this,"_queryPending",!1);Z(this,"_pollingPromise",null);if(this.device=t,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,l)=>{const u=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>t?(l("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}}function IP(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return oi(!1),0}}function yX(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return oi(!1),0}}function vX(r,e){var N,B;const{sourceX:t=0,sourceY:n=0,sourceFormat:i=6408,sourceAttachment:l=36064}=e||{};let{target:u=null,sourceWidth:a,sourceHeight:p,sourceType:y}=e||{};const{framebuffer:x,deleteFramebuffer:T}=CP(r);oi(x);const{gl:E,handle:k}=x;a=a||x.width,p=p||x.height;const F=l-36064;y=y||((B=(N=x.colorAttachments[F])==null?void 0:N.texture)==null?void 0:B.type)||5121,u=wX(u,y,i,a,p),y=y||Wq(u);const D=E.bindFramebuffer(36160,k);return E.readPixels(t,n,a,p,i,y,u),E.bindFramebuffer(36160,D||null),T&&x.destroy(),u}function bX(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:l=6408,targetByteOffset:u=0}=e||{};let{sourceWidth:a,sourceHeight:p,sourceType:y}=e||{};const{framebuffer:x,deleteFramebuffer:T}=CP(r);oi(x),a=a||x.width,p=p||x.height;const E=x;y=y||5121;let k=t;if(!k){const D=IP(l),N=yX(y),B=u+a*p*D*N;k=E.device.createBuffer({byteLength:B})}const F=r.device.createCommandEncoder();return F.copyTextureToBuffer({source:r,width:a,height:p,origin:[n,i],destination:k,byteOffset:u}),F.destroy(),T&&x.destroy(),k}function CP(r){return r instanceof Zy?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:xX(r),deleteFramebuffer:!0}}function xX(r,e){const{device:t,width:n,height:i,id:l}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${l}`,width:n,height:i,colorAttachments:[r]})}function wX(r,e,t,n,i){if(r)return r;e=e||5121;const l=Tw(e,{clamped:!1}),u=IP(t);return new l(n*i*u)}const TX=256,SX=1024,AX=16384,EX="clear: bad arguments";function IX(r,e){const{framebuffer:t=null,color:n=null,depth:i=null,stencil:l=null}=e||{},u={};t&&(u.framebuffer=t);let a=0;n&&(a|=AX,n!==!0&&(u.clearColor=n)),i&&(a|=TX,i!==!0&&(u.clearDepth=i)),l&&(a|=SX,i!==!0&&(u.clearStencil=i)),oi(a!==0,EX);const p=r.gl;tc(p,u,()=>{p.clear(a)})}const jf=1,Yc=class Yc extends nd{constructor(t){var y,x;super({...t,id:t.id||gu("webgl-device")});Z(this,"type","webgl");Z(this,"handle");Z(this,"features");Z(this,"limits");Z(this,"info");Z(this,"canvasContext");Z(this,"lost");Z(this,"_resolveContextLost");Z(this,"renderPass",null);Z(this,"gl");Z(this,"debug",!1);Z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});Z(this,"_extensions",{});Z(this,"_polyfilled",!1);Z(this,"spectorJS");Z(this,"_constants");const n=(y=t.gl)==null?void 0:y.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);const i=((x=t.gl)==null?void 0:x.canvas)||t.canvas,l=!t.gl;this.canvasContext=new Tq(this,{...t,autoResize:l,canvas:i}),this.lost=new Promise(T=>{this._resolveContextLost=T});let u=t.gl||null;if(u||(u=j$(this.canvasContext.canvas,{...t,onContextLost:T=>{var E;return(E=this._resolveContextLost)==null?void 0:E.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!u)throw new Error("WebGL context creation failed");this.handle=u,this.gl=u,this.gl.device=this,this.gl._version=2,t.spector&&(this.spectorJS=Cq({...this.props,canvas:this.handle.canvas})),this.info=H$(this.gl,this._extensions),this.limits=new cq(this.gl),this.features=new lq(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),l&&this.canvasContext.resize();const{enable:a=!0,copyState:p=!1}=t;_P(this.gl,{enable:a,copyState:p}),t.debug&&(this.gl=kq(this.gl,{...t,throwOnError:!0}),this.debug=!0,Xt.level=Math.max(Xt.level,1),Xt.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof Yc)return t;if((t==null?void 0:t.device)instanceof nd)return t.device;if(!CX(t))throw new Error("Invalid WebGL2RenderingContext");return new Yc({gl:t})}static async create(t={}){var a;Xt.groupCollapsed(jf,"WebGLDevice created")();const n=[];t.debug&&n.push(Rq()),t.spector&&n.push(Iq()),typeof t.canvas=="string"&&n.push(E1.pageLoaded);const i=await Promise.allSettled(n);for(const p of i)p.status==="rejected"&&Xt.error(`Failed to initialize debug libraries ${p.reason}`)();if(Xt.probe(jf+1,"DOM is loaded")(),(a=t.gl)!=null&&a.device)return Xt.warn("reattaching existing device")(),Yc.attach(t.gl);const l=new Yc(t),u=`Created ${l.type}${l.debug?" debug":""} context: ${l.info.vendor}, ${l.info.renderer} for canvas: ${l.canvasContext.id}`;return Xt.probe(jf,u)(),Xt.table(jf,l.info)(),Xt.groupEnd(jf)(),l}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return $1(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return iq(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return sq(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const n=this._getBufferProps(t);return new sc(this,n)}_createTexture(t){return new ma(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new ww(this,t)}createShader(t){return new Bq(this,t)}createFramebuffer(t){return new ap(this,t)}createVertexArray(t){return new q1(this,t)}createTransformFeedback(t){return new mX(this,t)}createQuerySet(t){return new _X(this,t)}createRenderPipeline(t){return new aX(this,t)}beginRenderPass(t){return new jq(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t){return new fX(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,n){return vX(t,n)}readPixelsToBufferWebGL(t,n){return bX(t,n)}setParametersWebGL(t){Td(this.gl,t)}getParametersWebGL(t){return mP(this.gl,t)}withParametersWebGL(t,n){return tc(this.gl,t,n)}clearWebGL(t){IX(this,t)}resetWebGL(){Xt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),N$(this.gl)}loseDevice(){var l;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(l=this._resolveContextLost)==null||l.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){lb(this.gl)}popState(){kp(this.gl)}setSpectorMetadata(t,n){t.__SPECTOR_Metadata=n}getGLKey(t,n){n=n||this.gl2||this.gl;const i=Number(t);for(const l in n)if(n[l]===i)return`GL.${l}`;return String(t)}setConstantAttributeWebGL(t,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const l=this._constants[t];switch(l&&MX(l,n)&&Xt.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=n,n.constructor){case Float32Array:PX(this,t,n);break;case Int32Array:RX(this,t,n);break;case Uint32Array:kX(this,t,n);break;default:oi(!1)}}getExtension(t){return fc(this.gl,t,this._extensions),this._extensions}};Z(Yc,"type","webgl");let cp=Yc;function CX(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function PX(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break;default:oi(!1)}}function RX(r,e,t){r.gl.vertexAttribI4iv(e,t)}function kX(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function MX(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}var PP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(e,t,n,i){var l=["","webkit","Moz","MS","ms","o"],u=t.createElement("div"),a="function",p=Math.round,y=Math.abs,x=Date.now;function T(re,ae,Me){return setTimeout(U(re,Me),ae)}function E(re,ae,Me){return Array.isArray(re)?(k(re,Me[ae],Me),!0):!1}function k(re,ae,Me){var ht;if(re)if(re.forEach)re.forEach(ae,Me);else if(re.length!==i)for(ht=0;ht<re.length;)ae.call(Me,re[ht],ht,re),ht++;else for(ht in re)re.hasOwnProperty(ht)&&ae.call(Me,re[ht],ht,re)}function F(re,ae,Me){var ht="DEPRECATED METHOD: "+ae+`
`+Me+` AT 
`;return function(){var Ft=new Error("get-stack-trace"),hr=Ft&&Ft.stack?Ft.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",fn=e.console&&(e.console.warn||e.console.log);return fn&&fn.call(e.console,ht,hr),re.apply(this,arguments)}}var D;typeof Object.assign!="function"?D=function(ae){if(ae===i||ae===null)throw new TypeError("Cannot convert undefined or null to object");for(var Me=Object(ae),ht=1;ht<arguments.length;ht++){var Ft=arguments[ht];if(Ft!==i&&Ft!==null)for(var hr in Ft)Ft.hasOwnProperty(hr)&&(Me[hr]=Ft[hr])}return Me}:D=Object.assign;var N=F(function(ae,Me,ht){for(var Ft=Object.keys(Me),hr=0;hr<Ft.length;)(!ht||ht&&ae[Ft[hr]]===i)&&(ae[Ft[hr]]=Me[Ft[hr]]),hr++;return ae},"extend","Use `assign`."),B=F(function(ae,Me){return N(ae,Me,!0)},"merge","Use `assign`.");function V(re,ae,Me){var ht=ae.prototype,Ft;Ft=re.prototype=Object.create(ht),Ft.constructor=re,Ft._super=ht,Me&&D(Ft,Me)}function U(re,ae){return function(){return re.apply(ae,arguments)}}function j(re,ae){return typeof re==a?re.apply(ae&&ae[0]||i,ae):re}function J(re,ae){return re===i?ae:re}function oe(re,ae,Me){k(Ue(ae),function(ht){re.addEventListener(ht,Me,!1)})}function le(re,ae,Me){k(Ue(ae),function(ht){re.removeEventListener(ht,Me,!1)})}function Ce(re,ae){for(;re;){if(re==ae)return!0;re=re.parentNode}return!1}function Ie(re,ae){return re.indexOf(ae)>-1}function Ue(re){return re.trim().split(/\s+/g)}function De(re,ae,Me){if(re.indexOf&&!Me)return re.indexOf(ae);for(var ht=0;ht<re.length;){if(Me&&re[ht][Me]==ae||!Me&&re[ht]===ae)return ht;ht++}return-1}function pe(re){return Array.prototype.slice.call(re,0)}function ze(re,ae,Me){for(var ht=[],Ft=[],hr=0;hr<re.length;){var fn=re[hr][ae];De(Ft,fn)<0&&ht.push(re[hr]),Ft[hr]=fn,hr++}return ht=ht.sort(function(Ai,qi){return Ai[ae]>qi[ae]}),ht}function Ne(re,ae){for(var Me,ht,Ft=ae[0].toUpperCase()+ae.slice(1),hr=0;hr<l.length;){if(Me=l[hr],ht=Me?Me+Ft:ae,ht in re)return ht;hr++}return i}var ot=1;function At(){return ot++}function Qe(re){var ae=re.ownerDocument||re;return ae.defaultView||ae.parentWindow||e}var pt=/mobile|tablet|ip(ad|hone|od)|android/i,_t="ontouchstart"in e,Lt=Ne(e,"PointerEvent")!==i,Ht=_t&&pt.test(navigator.userAgent),ar="touch",Tt="pen",Sr="mouse",Et="kinect",Or=25,ir=1,vr=2,ur=4,kr=8,nn=1,pr=2,Hr=4,Nr=8,mt=16,Te=pr|Hr,Qt=Nr|mt,Ct=Te|Qt,yt=["x","y"],sr=["clientX","clientY"];function Br(re,ae){var Me=this;this.manager=re,this.callback=ae,this.element=re.element,this.target=re.options.inputTarget,this.domHandler=function(ht){j(re.options.enable,[re])&&Me.handler(ht)},this.init()}Br.prototype={handler:function(){},init:function(){this.evEl&&oe(this.element,this.evEl,this.domHandler),this.evTarget&&oe(this.target,this.evTarget,this.domHandler),this.evWin&&oe(Qe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&le(this.element,this.evEl,this.domHandler),this.evTarget&&le(this.target,this.evTarget,this.domHandler),this.evWin&&le(Qe(this.element),this.evWin,this.domHandler)}};function $r(re){var ae,Me=re.options.inputClass;return Me?ae=Me:Lt?ae=de:Ht?ae=ye:_t?ae=kt:ae=at,new ae(re,Jt)}function Jt(re,ae,Me){var ht=Me.pointers.length,Ft=Me.changedPointers.length,hr=ae&ir&&ht-Ft===0,fn=ae&(ur|kr)&&ht-Ft===0;Me.isFirst=!!hr,Me.isFinal=!!fn,hr&&(re.session={}),Me.eventType=ae,Zt(re,Me),re.emit("hammer.input",Me),re.recognize(Me),re.session.prevInput=Me}function Zt(re,ae){var Me=re.session,ht=ae.pointers,Ft=ht.length;Me.firstInput||(Me.firstInput=Jr(ae)),Ft>1&&!Me.firstMultiple?Me.firstMultiple=Jr(ae):Ft===1&&(Me.firstMultiple=!1);var hr=Me.firstInput,fn=Me.firstMultiple,Si=fn?fn.center:hr.center,Ai=ae.center=bt(ht);ae.timeStamp=x(),ae.deltaTime=ae.timeStamp-hr.timeStamp,ae.angle=xn(Si,Ai),ae.distance=Zr(Si,Ai),Ar(Me,ae),ae.offsetDirection=Mr(ae.deltaX,ae.deltaY);var qi=zr(ae.deltaTime,ae.deltaX,ae.deltaY);ae.overallVelocityX=qi.x,ae.overallVelocityY=qi.y,ae.overallVelocity=y(qi.x)>y(qi.y)?qi.x:qi.y,ae.scale=fn?qe(fn.pointers,ht):1,ae.rotation=fn?Ot(fn.pointers,ht):0,ae.maxPointers=Me.prevInput?ae.pointers.length>Me.prevInput.maxPointers?ae.pointers.length:Me.prevInput.maxPointers:ae.pointers.length,Fr(Me,ae);var Bi=re.element;Ce(ae.srcEvent.target,Bi)&&(Bi=ae.srcEvent.target),ae.target=Bi}function Ar(re,ae){var Me=ae.center,ht=re.offsetDelta||{},Ft=re.prevDelta||{},hr=re.prevInput||{};(ae.eventType===ir||hr.eventType===ur)&&(Ft=re.prevDelta={x:hr.deltaX||0,y:hr.deltaY||0},ht=re.offsetDelta={x:Me.x,y:Me.y}),ae.deltaX=Ft.x+(Me.x-ht.x),ae.deltaY=Ft.y+(Me.y-ht.y)}function Fr(re,ae){var Me=re.lastInterval||ae,ht=ae.timeStamp-Me.timeStamp,Ft,hr,fn,Si;if(ae.eventType!=kr&&(ht>Or||Me.velocity===i)){var Ai=ae.deltaX-Me.deltaX,qi=ae.deltaY-Me.deltaY,Bi=zr(ht,Ai,qi);hr=Bi.x,fn=Bi.y,Ft=y(Bi.x)>y(Bi.y)?Bi.x:Bi.y,Si=Mr(Ai,qi),re.lastInterval=ae}else Ft=Me.velocity,hr=Me.velocityX,fn=Me.velocityY,Si=Me.direction;ae.velocity=Ft,ae.velocityX=hr,ae.velocityY=fn,ae.direction=Si}function Jr(re){for(var ae=[],Me=0;Me<re.pointers.length;)ae[Me]={clientX:p(re.pointers[Me].clientX),clientY:p(re.pointers[Me].clientY)},Me++;return{timeStamp:x(),pointers:ae,center:bt(ae),deltaX:re.deltaX,deltaY:re.deltaY}}function bt(re){var ae=re.length;if(ae===1)return{x:p(re[0].clientX),y:p(re[0].clientY)};for(var Me=0,ht=0,Ft=0;Ft<ae;)Me+=re[Ft].clientX,ht+=re[Ft].clientY,Ft++;return{x:p(Me/ae),y:p(ht/ae)}}function zr(re,ae,Me){return{x:ae/re||0,y:Me/re||0}}function Mr(re,ae){return re===ae?nn:y(re)>=y(ae)?re<0?pr:Hr:ae<0?Nr:mt}function Zr(re,ae,Me){Me||(Me=yt);var ht=ae[Me[0]]-re[Me[0]],Ft=ae[Me[1]]-re[Me[1]];return Math.sqrt(ht*ht+Ft*Ft)}function xn(re,ae,Me){Me||(Me=yt);var ht=ae[Me[0]]-re[Me[0]],Ft=ae[Me[1]]-re[Me[1]];return Math.atan2(Ft,ht)*180/Math.PI}function Ot(re,ae){return xn(ae[1],ae[0],sr)+xn(re[1],re[0],sr)}function qe(re,ae){return Zr(ae[0],ae[1],sr)/Zr(re[0],re[1],sr)}var $e={mousedown:ir,mousemove:vr,mouseup:ur},dt="mousedown",xt="mousemove mouseup";function at(){this.evEl=dt,this.evWin=xt,this.pressed=!1,Br.apply(this,arguments)}V(at,Br,{handler:function(ae){var Me=$e[ae.type];Me&ir&&ae.button===0&&(this.pressed=!0),Me&vr&&ae.which!==1&&(Me=ur),this.pressed&&(Me&ur&&(this.pressed=!1),this.callback(this.manager,Me,{pointers:[ae],changedPointers:[ae],pointerType:Sr,srcEvent:ae}))}});var Dt={pointerdown:ir,pointermove:vr,pointerup:ur,pointercancel:kr,pointerout:kr},br={2:ar,3:Tt,4:Sr,5:Et},tn="pointerdown",pn="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(tn="MSPointerDown",pn="MSPointerMove MSPointerUp MSPointerCancel");function de(){this.evEl=tn,this.evWin=pn,Br.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}V(de,Br,{handler:function(ae){var Me=this.store,ht=!1,Ft=ae.type.toLowerCase().replace("ms",""),hr=Dt[Ft],fn=br[ae.pointerType]||ae.pointerType,Si=fn==ar,Ai=De(Me,ae.pointerId,"pointerId");hr&ir&&(ae.button===0||Si)?Ai<0&&(Me.push(ae),Ai=Me.length-1):hr&(ur|kr)&&(ht=!0),!(Ai<0)&&(Me[Ai]=ae,this.callback(this.manager,hr,{pointers:Me,changedPointers:[ae],pointerType:fn,srcEvent:ae}),ht&&Me.splice(Ai,1))}});var X={touchstart:ir,touchmove:vr,touchend:ur,touchcancel:kr},Y="touchstart",te="touchstart touchmove touchend touchcancel";function he(){this.evTarget=Y,this.evWin=te,this.started=!1,Br.apply(this,arguments)}V(he,Br,{handler:function(ae){var Me=X[ae.type];if(Me===ir&&(this.started=!0),!!this.started){var ht=Se.call(this,ae,Me);Me&(ur|kr)&&ht[0].length-ht[1].length===0&&(this.started=!1),this.callback(this.manager,Me,{pointers:ht[0],changedPointers:ht[1],pointerType:ar,srcEvent:ae})}}});function Se(re,ae){var Me=pe(re.touches),ht=pe(re.changedTouches);return ae&(ur|kr)&&(Me=ze(Me.concat(ht),"identifier")),[Me,ht]}var Oe={touchstart:ir,touchmove:vr,touchend:ur,touchcancel:kr},He="touchstart touchmove touchend touchcancel";function ye(){this.evTarget=He,this.targetIds={},Br.apply(this,arguments)}V(ye,Br,{handler:function(ae){var Me=Oe[ae.type],ht=We.call(this,ae,Me);ht&&this.callback(this.manager,Me,{pointers:ht[0],changedPointers:ht[1],pointerType:ar,srcEvent:ae})}});function We(re,ae){var Me=pe(re.touches),ht=this.targetIds;if(ae&(ir|vr)&&Me.length===1)return ht[Me[0].identifier]=!0,[Me,Me];var Ft,hr,fn=pe(re.changedTouches),Si=[],Ai=this.target;if(hr=Me.filter(function(qi){return Ce(qi.target,Ai)}),ae===ir)for(Ft=0;Ft<hr.length;)ht[hr[Ft].identifier]=!0,Ft++;for(Ft=0;Ft<fn.length;)ht[fn[Ft].identifier]&&Si.push(fn[Ft]),ae&(ur|kr)&&delete ht[fn[Ft].identifier],Ft++;if(Si.length)return[ze(hr.concat(Si),"identifier"),Si]}var ft=2500,Je=25;function kt(){Br.apply(this,arguments);var re=U(this.handler,this);this.touch=new ye(this.manager,re),this.mouse=new at(this.manager,re),this.primaryTouch=null,this.lastTouches=[]}V(kt,Br,{handler:function(ae,Me,ht){var Ft=ht.pointerType==ar,hr=ht.pointerType==Sr;if(!(hr&&ht.sourceCapabilities&&ht.sourceCapabilities.firesTouchEvents)){if(Ft)Vt.call(this,Me,ht);else if(hr&&Wr.call(this,ht))return;this.callback(ae,Me,ht)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Vt(re,ae){re&ir?(this.primaryTouch=ae.changedPointers[0].identifier,Kt.call(this,ae)):re&(ur|kr)&&Kt.call(this,ae)}function Kt(re){var ae=re.changedPointers[0];if(ae.identifier===this.primaryTouch){var Me={x:ae.clientX,y:ae.clientY};this.lastTouches.push(Me);var ht=this.lastTouches,Ft=function(){var hr=ht.indexOf(Me);hr>-1&&ht.splice(hr,1)};setTimeout(Ft,ft)}}function Wr(re){for(var ae=re.srcEvent.clientX,Me=re.srcEvent.clientY,ht=0;ht<this.lastTouches.length;ht++){var Ft=this.lastTouches[ht],hr=Math.abs(ae-Ft.x),fn=Math.abs(Me-Ft.y);if(hr<=Je&&fn<=Je)return!0}return!1}var Er=Ne(u.style,"touchAction"),wr=Er!==i,gr="compute",Yr="auto",Pr="manipulation",Wt="none",Rr="pan-x",Dr="pan-y",It=Qr();function hn(re,ae){this.manager=re,this.set(ae)}hn.prototype={set:function(re){re==gr&&(re=this.compute()),wr&&this.manager.element.style&&It[re]&&(this.manager.element.style[Er]=re),this.actions=re.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var re=[];return k(this.manager.recognizers,function(ae){j(ae.options.enable,[ae])&&(re=re.concat(ae.getTouchAction()))}),Ur(re.join(" "))},preventDefaults:function(re){var ae=re.srcEvent,Me=re.offsetDirection;if(this.manager.session.prevented){ae.preventDefault();return}var ht=this.actions,Ft=Ie(ht,Wt)&&!It[Wt],hr=Ie(ht,Dr)&&!It[Dr],fn=Ie(ht,Rr)&&!It[Rr];if(Ft){var Si=re.pointers.length===1,Ai=re.distance<2,qi=re.deltaTime<250;if(Si&&Ai&&qi)return}if(!(fn&&hr)&&(Ft||hr&&Me&Te||fn&&Me&Qt))return this.preventSrc(ae)},preventSrc:function(re){this.manager.session.prevented=!0,re.preventDefault()}};function Ur(re){if(Ie(re,Wt))return Wt;var ae=Ie(re,Rr),Me=Ie(re,Dr);return ae&&Me?Wt:ae||Me?ae?Rr:Dr:Ie(re,Pr)?Pr:Yr}function Qr(){if(!wr)return!1;var re={},ae=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Me){re[Me]=ae?e.CSS.supports("touch-action",Me):!0}),re}var qr=1,In=2,dn=4,wn=8,Cn=wn,vi=16,Sn=32;function si(re){this.options=D({},this.defaults,re||{}),this.id=At(),this.manager=null,this.options.enable=J(this.options.enable,!0),this.state=qr,this.simultaneous={},this.requireFail=[]}si.prototype={defaults:{},set:function(re){return D(this.options,re),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(re){if(E(re,"recognizeWith",this))return this;var ae=this.simultaneous;return re=Ln(re,this),ae[re.id]||(ae[re.id]=re,re.recognizeWith(this)),this},dropRecognizeWith:function(re){return E(re,"dropRecognizeWith",this)?this:(re=Ln(re,this),delete this.simultaneous[re.id],this)},requireFailure:function(re){if(E(re,"requireFailure",this))return this;var ae=this.requireFail;return re=Ln(re,this),De(ae,re)===-1&&(ae.push(re),re.requireFailure(this)),this},dropRequireFailure:function(re){if(E(re,"dropRequireFailure",this))return this;re=Ln(re,this);var ae=De(this.requireFail,re);return ae>-1&&this.requireFail.splice(ae,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(re){return!!this.simultaneous[re.id]},emit:function(re){var ae=this,Me=this.state;function ht(Ft){ae.manager.emit(Ft,re)}Me<wn&&ht(ae.options.event+Ps(Me)),ht(ae.options.event),re.additionalEvent&&ht(re.additionalEvent),Me>=wn&&ht(ae.options.event+Ps(Me))},tryEmit:function(re){if(this.canEmit())return this.emit(re);this.state=Sn},canEmit:function(){for(var re=0;re<this.requireFail.length;){if(!(this.requireFail[re].state&(Sn|qr)))return!1;re++}return!0},recognize:function(re){var ae=D({},re);if(!j(this.options.enable,[this,ae])){this.reset(),this.state=Sn;return}this.state&(Cn|vi|Sn)&&(this.state=qr),this.state=this.process(ae),this.state&(In|dn|wn|vi)&&this.tryEmit(ae)},process:function(re){},getTouchAction:function(){},reset:function(){}};function Ps(re){return re&vi?"cancel":re&wn?"end":re&dn?"move":re&In?"start":""}function zs(re){return re==mt?"down":re==Nr?"up":re==pr?"left":re==Hr?"right":""}function Ln(re,ae){var Me=ae.manager;return Me?Me.get(re):re}function ki(){si.apply(this,arguments)}V(ki,si,{defaults:{pointers:1},attrTest:function(re){var ae=this.options.pointers;return ae===0||re.pointers.length===ae},process:function(re){var ae=this.state,Me=re.eventType,ht=ae&(In|dn),Ft=this.attrTest(re);return ht&&(Me&kr||!Ft)?ae|vi:ht||Ft?Me&ur?ae|wn:ae&In?ae|dn:In:Sn}});function Ni(){ki.apply(this,arguments),this.pX=null,this.pY=null}V(Ni,ki,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var re=this.options.direction,ae=[];return re&Te&&ae.push(Dr),re&Qt&&ae.push(Rr),ae},directionTest:function(re){var ae=this.options,Me=!0,ht=re.distance,Ft=re.direction,hr=re.deltaX,fn=re.deltaY;return Ft&ae.direction||(ae.direction&Te?(Ft=hr===0?nn:hr<0?pr:Hr,Me=hr!=this.pX,ht=Math.abs(re.deltaX)):(Ft=fn===0?nn:fn<0?Nr:mt,Me=fn!=this.pY,ht=Math.abs(re.deltaY))),re.direction=Ft,Me&&ht>ae.threshold&&Ft&ae.direction},attrTest:function(re){return ki.prototype.attrTest.call(this,re)&&(this.state&In||!(this.state&In)&&this.directionTest(re))},emit:function(re){this.pX=re.deltaX,this.pY=re.deltaY;var ae=zs(re.direction);ae&&(re.additionalEvent=this.options.event+ae),this._super.emit.call(this,re)}});function Hn(){ki.apply(this,arguments)}V(Hn,ki,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Wt]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.scale-1)>this.options.threshold||this.state&In)},emit:function(re){if(re.scale!==1){var ae=re.scale<1?"in":"out";re.additionalEvent=this.options.event+ae}this._super.emit.call(this,re)}});function cs(){si.apply(this,arguments),this._timer=null,this._input=null}V(cs,si,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Yr]},process:function(re){var ae=this.options,Me=re.pointers.length===ae.pointers,ht=re.distance<ae.threshold,Ft=re.deltaTime>ae.time;if(this._input=re,!ht||!Me||re.eventType&(ur|kr)&&!Ft)this.reset();else if(re.eventType&ir)this.reset(),this._timer=T(function(){this.state=Cn,this.tryEmit()},ae.time,this);else if(re.eventType&ur)return Cn;return Sn},reset:function(){clearTimeout(this._timer)},emit:function(re){this.state===Cn&&(re&&re.eventType&ur?this.manager.emit(this.options.event+"up",re):(this._input.timeStamp=x(),this.manager.emit(this.options.event,this._input)))}});function Wi(){ki.apply(this,arguments)}V(Wi,ki,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Wt]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.rotation)>this.options.threshold||this.state&In)}});function ko(){ki.apply(this,arguments)}V(ko,ki,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Te|Qt,pointers:1},getTouchAction:function(){return Ni.prototype.getTouchAction.call(this)},attrTest:function(re){var ae=this.options.direction,Me;return ae&(Te|Qt)?Me=re.overallVelocity:ae&Te?Me=re.overallVelocityX:ae&Qt&&(Me=re.overallVelocityY),this._super.attrTest.call(this,re)&&ae&re.offsetDirection&&re.distance>this.options.threshold&&re.maxPointers==this.options.pointers&&y(Me)>this.options.velocity&&re.eventType&ur},emit:function(re){var ae=zs(re.offsetDirection);ae&&this.manager.emit(this.options.event+ae,re),this.manager.emit(this.options.event,re)}});function Fi(){si.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}V(Fi,si,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Pr]},process:function(re){var ae=this.options,Me=re.pointers.length===ae.pointers,ht=re.distance<ae.threshold,Ft=re.deltaTime<ae.time;if(this.reset(),re.eventType&ir&&this.count===0)return this.failTimeout();if(ht&&Ft&&Me){if(re.eventType!=ur)return this.failTimeout();var hr=this.pTime?re.timeStamp-this.pTime<ae.interval:!0,fn=!this.pCenter||Zr(this.pCenter,re.center)<ae.posThreshold;this.pTime=re.timeStamp,this.pCenter=re.center,!fn||!hr?this.count=1:this.count+=1,this._input=re;var Si=this.count%ae.taps;if(Si===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Cn,this.tryEmit()},ae.interval,this),In):Cn}return Sn},failTimeout:function(){return this._timer=T(function(){this.state=Sn},this.options.interval,this),Sn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Cn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function $i(re,ae){return ae=ae||{},ae.recognizers=J(ae.recognizers,$i.defaults.preset),new ms(re,ae)}$i.VERSION="2.0.7",$i.defaults={domEvents:!1,touchAction:gr,enable:!0,inputTarget:null,inputClass:null,preset:[[Wi,{enable:!1}],[Hn,{enable:!1},["rotate"]],[ko,{direction:Te}],[Ni,{direction:Te},["swipe"]],[Fi],[Fi,{event:"doubletap",taps:2},["tap"]],[cs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xo=1,Us=2;function ms(re,ae){this.options=D({},$i.defaults,ae||{}),this.options.inputTarget=this.options.inputTarget||re,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=re,this.input=$r(this),this.touchAction=new hn(this,this.options.touchAction),ln(this,!0),k(this.options.recognizers,function(Me){var ht=this.add(new Me[0](Me[1]));Me[2]&&ht.recognizeWith(Me[2]),Me[3]&&ht.requireFailure(Me[3])},this)}ms.prototype={set:function(re){return D(this.options,re),re.touchAction&&this.touchAction.update(),re.inputTarget&&(this.input.destroy(),this.input.target=re.inputTarget,this.input.init()),this},stop:function(re){this.session.stopped=re?Us:Xo},recognize:function(re){var ae=this.session;if(!ae.stopped){this.touchAction.preventDefaults(re);var Me,ht=this.recognizers,Ft=ae.curRecognizer;(!Ft||Ft&&Ft.state&Cn)&&(Ft=ae.curRecognizer=null);for(var hr=0;hr<ht.length;)Me=ht[hr],ae.stopped!==Us&&(!Ft||Me==Ft||Me.canRecognizeWith(Ft))?Me.recognize(re):Me.reset(),!Ft&&Me.state&(In|dn|wn)&&(Ft=ae.curRecognizer=Me),hr++}},get:function(re){if(re instanceof si)return re;for(var ae=this.recognizers,Me=0;Me<ae.length;Me++)if(ae[Me].options.event==re)return ae[Me];return null},add:function(re){if(E(re,"add",this))return this;var ae=this.get(re.options.event);return ae&&this.remove(ae),this.recognizers.push(re),re.manager=this,this.touchAction.update(),re},remove:function(re){if(E(re,"remove",this))return this;if(re=this.get(re),re){var ae=this.recognizers,Me=De(ae,re);Me!==-1&&(ae.splice(Me,1),this.touchAction.update())}return this},on:function(re,ae){if(re!==i&&ae!==i){var Me=this.handlers;return k(Ue(re),function(ht){Me[ht]=Me[ht]||[],Me[ht].push(ae)}),this}},off:function(re,ae){if(re!==i){var Me=this.handlers;return k(Ue(re),function(ht){ae?Me[ht]&&Me[ht].splice(De(Me[ht],ae),1):delete Me[ht]}),this}},emit:function(re,ae){this.options.domEvents&&mc(re,ae);var Me=this.handlers[re]&&this.handlers[re].slice();if(!(!Me||!Me.length)){ae.type=re,ae.preventDefault=function(){ae.srcEvent.preventDefault()};for(var ht=0;ht<Me.length;)Me[ht](ae),ht++}},destroy:function(){this.element&&ln(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ln(re,ae){var Me=re.element;if(Me.style){var ht;k(re.options.cssProps,function(Ft,hr){ht=Ne(Me.style,hr),ae?(re.oldCssProps[ht]=Me.style[ht],Me.style[ht]=Ft):Me.style[ht]=re.oldCssProps[ht]||""}),ae||(re.oldCssProps={})}}function mc(re,ae){var Me=t.createEvent("Event");Me.initEvent(re,!0,!0),Me.gesture=ae,ae.target.dispatchEvent(Me)}D($i,{INPUT_START:ir,INPUT_MOVE:vr,INPUT_END:ur,INPUT_CANCEL:kr,STATE_POSSIBLE:qr,STATE_BEGAN:In,STATE_CHANGED:dn,STATE_ENDED:wn,STATE_RECOGNIZED:Cn,STATE_CANCELLED:vi,STATE_FAILED:Sn,DIRECTION_NONE:nn,DIRECTION_LEFT:pr,DIRECTION_RIGHT:Hr,DIRECTION_UP:Nr,DIRECTION_DOWN:mt,DIRECTION_HORIZONTAL:Te,DIRECTION_VERTICAL:Qt,DIRECTION_ALL:Ct,Manager:ms,Input:Br,TouchAction:hn,TouchInput:ye,MouseInput:at,PointerEventInput:de,TouchMouseInput:kt,SingleTouchInput:he,Recognizer:si,AttrRecognizer:ki,Tap:Fi,Pan:Ni,Swipe:ko,Pinch:Hn,Rotate:Wi,Press:cs,on:oe,off:le,each:k,merge:B,extend:N,assign:D,inherit:V,bindFn:U,prefixed:Ne});var _c=typeof e<"u"?e:typeof self<"u"?self:{};_c.Hammer=$i,r.exports?r.exports=$i:e[n]=$i})(window,document,"Hammer")})(PP);var Wm=PP.exports;const OX=zw(Wm),ia=FM({__proto__:null,default:OX},[Wm]),RP=1,kP=2,Sw=4,DX={mousedown:RP,mousemove:kP,mouseup:Sw};function NX(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return!0;return!1}function FX(r){const e=r.prototype.handler;r.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(NX(i,l=>l.pointerId===n.pointerId)||i.push(n)),e.call(this,n)}}function BX(r){r.prototype.handler=function(t){let n=DX[t.type];n&RP&&t.button>=0&&(this.pressed=!0),n&kP&&t.buttons===0&&(n=Sw),this.pressed&&(n&Sw&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}FX(Wm.PointerEventInput);BX(Wm.MouseInput);const LX=Wm.Manager;class ub{constructor(e,t,n){this.element=e,this.callback=t,this.options={enable:!0,...n}}}const zX=ia?[[ia.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ia.Rotate,{enable:!1}],[ia.Pinch,{enable:!1}],[ia.Swipe,{enable:!1}],[ia.Pan,{threshold:0,enable:!1}],[ia.Press,{enable:!1}],[ia.Tap,{event:"doubletap",taps:2,enable:!1}],[ia.Tap,{event:"anytap",enable:!1}],[ia.Tap,{enable:!1}]]:null,aE={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},UX={doubletap:["tap"]},VX={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},X1={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},jX={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},lE={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},HX=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Th=typeof window<"u"?window:global;let Aw=!1;try{const r={get passive(){return Aw=!0,!0}};Th.addEventListener("test",null,r),Th.removeEventListener("test",null)}catch{Aw=!1}const WX=HX.indexOf("firefox")!==-1,{WHEEL_EVENTS:$X}=X1,cE="wheel",uE=4.000244140625,qX=40,XX=.25;class ZX extends ub{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{if(!this.options.enable)return;let l=i.deltaY;Th.WheelEvent&&(WX&&i.deltaMode===Th.WheelEvent.DOM_DELTA_PIXEL&&(l/=Th.devicePixelRatio),i.deltaMode===Th.WheelEvent.DOM_DELTA_LINE&&(l*=qX)),l!==0&&l%uE===0&&(l=Math.floor(l/uE)),i.shiftKey&&l&&(l=l*XX),this.callback({type:cE,center:{x:i.clientX,y:i.clientY},delta:-l,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat($X),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Aw?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===cE&&(this.options.enable=t)}}const{MOUSE_EVENTS:YX}=X1,hE="pointermove",dE="pointerover",fE="pointerout",pE="pointerenter",gE="pointerleave";class KX extends ub{constructor(e,t,n){super(e,t,n),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(YX),this.events.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===hE&&(this.enableMoveEvent=t),e===dE&&(this.enableOverEvent=t),e===fE&&(this.enableOutEvent=t),e===pE&&(this.enableEnterEvent=t),e===gE&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(dE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(fE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(pE,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(gE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(hE,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:GX}=X1,mE="keydown",_E="keyup";class JX extends ub{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{const l=i.target||i.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:mE,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:_E,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(GX),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===mE&&(this.enableDownEvent=t),e===_E&&(this.enableUpEvent=t)}}const yE="contextmenu";class QX extends ub{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:yE,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===yE&&(this.options.enable=t)}}const vE=1,Ew=2,bE=4,eZ={pointerdown:vE,pointermove:Ew,pointerup:bE,mousedown:vE,mousemove:Ew,mouseup:bE},tZ=0,rZ=1,nZ=2,iZ=1,sZ=2,oZ=4;function aZ(r){const e=eZ[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,l=!1,u=!1;return e===Ew?(i=!!(t&iZ),l=!!(t&oZ),u=!!(t&sZ)):(i=n===tZ,l=n===rZ,u=n===nZ),{leftButton:i,middleButton:l,rightButton:u}}function lZ(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,l=n.height/e.offsetHeight||1,u={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/l};return{center:t,offsetCenter:u}}const g0={srcElement:"root",priority:0};class cZ{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const n=this._normalizeEvent(t);let i=t.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,l=!1){const{handlers:u,handlersByElement:a}=this;let p=g0;typeof n=="string"||n&&n.addEventListener?p={...g0,srcElement:n}:n&&(p={...g0,...n});let y=a.get(p.srcElement);y||(y=[],a.set(p.srcElement,y));const x={type:e,handler:t,srcElement:p.srcElement,priority:p.priority};i&&(x.once=!0),l&&(x.passive=!0),u.push(x),this._active=this._active||!x.passive;let T=y.length-1;for(;T>=0&&!(y[T].priority>=x.priority);)T--;y.splice(T+1,0,x)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let l=n.length-1;l>=0;l--){const u=n[l];if(u.type===e&&u.handler===t){n.splice(l,1);const a=i.get(u.srcElement);a.splice(a.indexOf(u),1),a.length===0&&i.delete(u.srcElement)}}this._active=n.some(l=>!l.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const l=()=>{e.handled=!0},u=()=>{e.handled=!0,i=!0},a=[];for(let p=0;p<n.length;p++){const{type:y,handler:x,once:T}=n[p];if(x({...e,type:y,stopPropagation:l,stopImmediatePropagation:u}),T&&a.push(n[p]),i)break}for(let p=0;p<a.length;p++){const{type:y,handler:x}=a[p];this.remove(y,x)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...aZ(e),...lZ(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const uZ={events:null,recognizers:null,recognizerOptions:{},Manager:LX,touchAction:"none",tabIndex:0};class hZ{constructor(e=null,t){this._onBasicInput=i=>{const{srcEvent:l}=i,u=VX[l.type];u&&this.manager.emit(u,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...uZ,...t},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||zX}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(aE).forEach(i=>{const l=this.manager.get(i);l&&aE[i].forEach(u=>{l.recognizeWith(u)})});for(const i in t.recognizerOptions){const l=this.manager.get(i);if(l){const u=t.recognizerOptions[i];delete u.enable,l.set(u)}}this.wheelInput=new ZX(e,this._onOtherEvent,{enable:!1}),this.moveInput=new KX(e,this._onOtherEvent,{enable:!1}),this.keyInput=new JX(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new QX(e,this._onOtherEvent,{enable:!1});for(const[i,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(i,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const l=UX[e];l&&!this.options.recognizers&&l.forEach(u=>{const a=n.get(u);t?(a.requireFailure(e),i.dropRequireFailure(u)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,l){if(typeof e!="string"){n=t;for(const x in e)this._addEventHandler(x,e[x],n,i,l);return}const{manager:u,events:a}=this,p=lE[e]||e;let y=a.get(p);y||(y=new cZ(this),a.set(p,y),y.recognizerName=jX[p]||p,u&&u.on(p,y.handleEvent)),y.add(e,t,n,i,l),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const u in e)this._removeEventHandler(u,e[u]);return}const{events:n}=this,i=lE[e]||e,l=n.get(i);if(l&&(l.remove(e,t),l.isEmpty())){const{recognizerName:u}=l;let a=!1;for(const p of n.values())if(p.recognizerName===u&&!p.isEmpty()){a=!0;break}a||this._toggleRecognizer(u,!1)}}}function Vl(){}const dZ=({isDragging:r})=>r?"grabbing":"grab",MP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Vl,onWebGLInitialized:Vl,onResize:Vl,onViewStateChange:Vl,onInteractionStateChange:Vl,onBeforeRender:Vl,onAfterRender:Vl,onLoad:Vl,onError:r=>ri.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:dZ,getTooltip:null,debug:!1,drawPickingColors:!1};class Mp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new nb({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const l=n.offsetCenter;if(!l)return;i.x=l.x,i.y=l.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=pw[n.type],l=n.offsetCenter;if(!i||!l||!this.layerManager)return;const u=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:l.x,y:l.y,layers:u,viewports:this.getViewports(l)},this._lastPointerDownInfo),{layer:p}=a,y=p&&(p[i.handler]||p.props[i.handler]),x=this.props[i.handler];let T=!1;y&&(T=y.call(p,a,n)),T||(x==null||x(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{const i=n.offsetCenter,l=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=l.result[0]||l.emptyInfo},this.props={...MP,...e},e=this.props,e.viewState&&e.initialViewState&&ri.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ri.error("WebGL1 context not supported.")(),this.device=cp.attach(e.gl));let t=this.device;t||(Dh.registerDevices([cp]),t=Dh.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Ip.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,l,u,a,p,y,x;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(l=this.effectManager)==null||l.finalize(),this.effectManager=null,(u=this.deckRenderer)==null||u.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(p=this.eventManager)==null||p.destroy(),this.eventManager=null,(y=this.widgetManager)==null||y.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((x=this.canvas.parentElement)==null||x.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ri.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ri.removed("onLayerClick","onClick")(),e.initialViewState&&!jo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),u=this.deckRenderer.needsRedraw(e);return t=t||n||i||l||u,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Gi(this.viewManager),this.viewManager.views}getViewports(e){return Gi(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,n){Gi(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),l}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Gi(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const l=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=l}if(n||n===0){const l=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=l}}_updateCanvasSize(){var i,l;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,(i=this.viewManager)==null||i.setProps({width:t,height:n}),(l=this.layerManager)==null||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:l}=t;return new NW({device:e,useDevicePixels:l,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:u=>this._setDevice(u.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new j1({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,n,i;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:u}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let a=u,p=!1;for(const y of l)a=y,p=((t=y.layer)==null?void 0:t.onHover(y,e.event))||p;p||((i=(n=this.props).onHover)==null||i.call(n,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,l;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof cp&&this.props.onWebGLInitialized(this.device.gl);const t=new uP;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new hZ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const u in pw)this.eventManager.on(u,this._onEvent);this.viewManager=new e$({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new QW(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new _$({deck:this,device:this.device}),this.deckRenderer=new b$(this.device),this.deckPicker=new E$(this.device),this.widgetManager=new P$({deck:this,parentElement:(l=this.canvas)==null?void 0:l.parentElement}),this.widgetManager.addDefault(new k$),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var u;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const l={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(u=this.deckRenderer)==null||u.renderLayers(l),l.pass==="screen"&&this.widgetManager.onRedraw({viewports:l.viewports,layers:l.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ri.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Dh.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Mp.defaultProps=MP;Mp.VERSION=aj;function fZ(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return T3(r)}}const pZ=w3;function cy(r,e){return{attribute:r,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Jc(r){return r.stride||r.size*r.bytesPerElement}function gZ(r,e){return r.type===e.type&&r.size===e.size&&Jc(r)===Jc(e)&&(r.offset||0)===(e.offset||0)}function Iw(r,e){e.offset&&ri.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Jc(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,l=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:l,stride:t}}function mZ(r,e){const t=Iw(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class _Z{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,l=i==="float64";let{defaultValue:u}=t;u=Number.isFinite(u)?[u]:u||new Array(this.size).fill(0);let a;l?a="float32":!i&&t.isIndexed?a="uint32":a=i||"float32";let p=fZ(i||a);this.doublePrecision=l,l&&t.fp64===!1&&(p=Float32Array),this.value=null,this.settings={...t,defaultType:p,defaultValue:u,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:p.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Jc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ip.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const l=Iw(this.getAccessor(),t),u=l.offset/i.BYTES_PER_ELEMENT,a=l.size||this.size;n[e]=i.subarray(u,u+a)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],l={name:this.id,byteStride:Jc(n),attributes:i};if(this.doublePrecision){const u=mZ(n,t||{});i.push(cy(e,{...n,...u.high}),cy(`${e}64Low`,{...n,...u.low}))}else if(t){const u=Iw(n,t);i.push(cy(e,{...n,...u}))}else i.push(cy(e,n));return l}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,l=n*i;if(t&&l&&t.length>=l){const u=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let p=0;p<l;)for(let y=0;y<i;y++){const x=t[p++];x<u[y]&&(u[y]=x),x>a[y]&&(a[y]=x)}e=[u,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ti?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const u=pZ(n.value);i.type=i.normalized?u.replace("int","norm"):u}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Jc(i)}if(t.bounds=null,n.constant){let l=n.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!t.constant||!this._areValuesEqual(l,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(l)?l:new Float32Array(l)}else if(n.buffer){const l=n.buffer;t.externalBuffer=l,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let l=n.value;t.externalBuffer=null,t.constant=!1,this.value=l;let{buffer:u}=this;const a=Jc(i),p=(i.vertexOffset||0)*a;if(this.doublePrecision&&l instanceof Float64Array&&(l=r0(l,i)),this.settings.isIndexed){const x=this.settings.defaultType;l.constructor!==x&&(l=new x(l))}const y=l.byteLength+p+a*2;(!u||u.byteLength<y)&&(u=this._createBuffer(y)),u.write(l,p)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?r0(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,l=Ip.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=l;const{byteOffset:u}=this;let{buffer:a}=this;return(!a||a.byteLength<l.byteLength+u)&&(a=this._createBuffer(l.byteLength+u),t&&i&&a.write(i instanceof Float64Array?r0(i,this):i,u)),n.allocatedValue=l,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&ri.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:l}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let u=l;for(;--u>=0;)t[n+u]=i[u];return t}switch(l){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let u=l;for(;--u>=0;)t[n+u]=Number.isFinite(e[u])?e[u]:i[u]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:t?Ti.INDEX:Ti.VERTEX,indexType:t?n:void 0,byteLength:e}),this._buffer}}const xE=[],wE=[];function OP(r,e=0,t=1/0){let n=xE;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(wE.length=r.length,n=wE):n=xE,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function DP(r){return r&&r[Symbol.asyncIterator]}function yZ(r,e){const{size:t,stride:n,offset:i,startIndices:l,nested:u}=e,a=r.BYTES_PER_ELEMENT,p=n?n/a:t,y=i?i/a:0,x=Math.floor((r.length-y)/p);return(T,{index:E,target:k})=>{if(!l){const B=E*p+y;for(let V=0;V<t;V++)k[V]=r[B+V];return k}const F=l[E],D=l[E+1]||x;let N;if(u){N=new Array(D-F);for(let B=F;B<D;B++){const V=B*p+y;k=new Array(t);for(let U=0;U<t;U++)k[U]=r[V+U];N[B-F]=k}}else if(p===t)N=r.subarray(F*t+y,D*t+y);else{N=new r.constructor((D-F)*t);let B=0;for(let V=F;V<D;V++){const U=V*p+y;for(let j=0;j<t;j++)N[B++]=r[U+j]}}return N}}const vZ=[],Sy=[[0,1/0]];function bZ(r,e){if(r===Sy||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let l=0;l<n;l++){const u=r[l];u[1]<e[0]?(t.push(u),i=l+1):u[0]>e[1]?t.push(u):e=[Math.min(u[0],e[0]),Math.max(u[1],e[1])]}return t.splice(i,0,e),t}const xZ={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function NP(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...xZ[t],...e,...r,type:t}}class FP extends _Z{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Sy}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!gZ(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(l=>e[l])]:e[t];return NP(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=bZ(this.state.updateRanges,[n,i])}else this.state.updateRanges=Sy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=vZ}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==Sy),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:u,noAlloc:a}}=this;let p=!0;if(u){for(const[y,x]of l)u.call(i,this,{data:t,startRow:y,endRow:x,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[y,x]of l){const T=Number.isFinite(y)?this.getVertexOffset(y):0,E=Number.isFinite(x)?this.getVertexOffset(x):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:E})}this._checkAttributeArray()}else p=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),p}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const u=e;Gi(ArrayBuffer.isView(u.value),`invalid ${i.accessor}`);const a=!!u.size&&u.size!==this.size;return n.binaryAccessor=yZ(u.value,{size:u.size||this.size,stride:u.stride,offset:u.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const l in t){const u=super._getBufferLayout(l,t[l]);n.attributes.push(...u.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:l,numInstances:u}){if(e.constant)return;const{settings:a,state:p,value:y,size:x,startIndices:T}=e,{accessor:E,transform:k}=a,F=p.binaryAccessor||(typeof E=="function"?E:l[E]);Gi(typeof F=="function",`accessor "${E}" is not a function`);let D=e.getVertexOffset(n);const{iterable:N,objectInfo:B}=OP(t,n,i);for(const V of N){B.index++;let U=F(V,B);if(k&&(U=k.call(this,U)),T){const j=(B.index<T.length-1?T[B.index+1]:u)-T[B.index];if(U&&Array.isArray(U[0])){let J=D;for(const oe of U)e._normalizeValue(oe,y,J),J+=x}else U&&U.length>x?y.set(U,D):(e._normalizeValue(U,B.target,0),ZW({target:y,source:B.target,start:D,count:j}));D+=j*x}else e._normalizeValue(U,y,D),D+=x}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function m0(r){const{source:e,target:t,start:n=0,size:i,getData:l}=r,u=r.end||t.length,a=e.length,p=u-n;if(a>p){t.set(e.subarray(0,p),n);return}if(t.set(e,n),!l)return;let y=a;for(;y<p;){const x=l(y,e);for(let T=0;T<i;T++)t[n+y]=x[T]||0,y++}}function wZ({source:r,target:e,size:t,getData:n,sourceStartIndices:i,targetStartIndices:l}){if(!i||!l)return m0({source:r,target:e,size:t,getData:n}),e;let u=0,a=0;const p=n&&((x,T)=>n(x+a,T)),y=Math.min(i.length,l.length);for(let x=1;x<y;x++){const T=i[x]*t,E=l[x]*t;m0({source:r.subarray(u,T),target:e,start:a,end:E,size:t,getData:p}),u=T,a=E}return a<e.length&&m0({source:[],target:e,start:a,size:t,getData:p}),e}function TZ(r){const{device:e,settings:t,value:n}=r,i=new FP(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function BP(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function LP(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function zP(r){r.push(r.shift())}function SZ(r,e){const{doublePrecision:t,settings:n,value:i,size:l}=r,u=t&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:p}=r.settings;if(p)for(const y of Object.values(p))a=Math.max(a,y.vertexOffset??0);return(n.noAlloc?i.length:(e+a)*l)*u}function UP({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function VP({device:r,buffer:e,attribute:t,fromLength:n,toLength:i,fromStartIndices:l,getData:u=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,p=t.size*a,y=t.byteOffset,x=t.settings.bytesPerElement<4?y/t.settings.bytesPerElement*4:y,T=t.startIndices,E=l&&T,k=t.isConstant;if(!E&&e&&n>=i)return e;const F=t.value instanceof Float64Array?Float32Array:t.value.constructor,D=k?t.value:new F(t.getBuffer().readSyncWebGL(y,i*F.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!k){const U=u;u=(j,J)=>t.normalizeConstant(U(j,J))}const N=k?(U,j)=>u(D,j):(U,j)=>u(D.subarray(U+y,U+y+p),j),B=e?new Float32Array(e.readSyncWebGL(x,n*4).buffer):new Float32Array(0),V=new Float32Array(i);return wZ({source:B,target:V,sourceStartIndices:l,targetStartIndices:T,size:p,getData:N}),(!e||e.byteLength<V.byteLength+x)&&(e==null||e.destroy(),e=r.createBuffer({byteLength:V.byteLength+x,usage:35050})),e.write(V,x),e}class jP{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new ab(n),this.attribute=t,this.attributeInTransition=TZ(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=SZ(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class AZ extends jP{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=CZ(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:l,attribute:u}=this;zP(l),l[0]=VP({device:this.device,buffer:l[0],attribute:u,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),l[1]=UP({device:this.device,source:l[0],target:l[1]}),this.setBuffer(l[1]);const{transform:a}=this,p=a.model;let y=Math.floor(this.currentLength/u.size);HP(u)&&(y/=2),p.setVertexCount(y),u.isConstant?(p.setAttributes({aFrom:l[0]}),p.setConstantAttributes({aTo:u.value})):p.setAttributes({aFrom:l[0],aTo:u.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:l[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:l}=this.transform;l.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const EZ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,IZ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function HP(r){return r.doublePrecision&&r.value instanceof Float64Array}function CZ(r,e){const t=e.size,n=BP(t),i=LP(t),l=e.getBufferLayout();return HP(e)?new Pp(r,{vs:IZ,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[EH],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Pp(r,{vs:EZ,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:l.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class PZ extends jP{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=OZ(e),this.framebuffer=DZ(e,this.texture),this.transform=MZ(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:l,attribute:u}=this;for(let p=0;p<2;p++)l[p]=VP({device:this.device,buffer:l[p],attribute:u,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});l[2]=UP({device:this.device,source:l[0],target:l[2]}),this.setBuffer(l[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/u.size)),u.isConstant?a.setConstantAttributes({aTo:u.value}):a.setAttributes({aTo:u.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,l=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:l.stiffness,damping:l.damping}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),zP(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const RZ=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,kZ=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function MZ(r,e){const t=BP(e.size),n=LP(e.size);return new Pp(r,{vs:RZ,fs:kZ,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function OZ(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function DZ(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const NZ={interpolation:AZ,spring:PZ};class FZ{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const l=e[i],u=l.getTransitionSetting(t);u&&this._updateAttribute(i,l,u)}for(const i in this.transitions){const l=e[i];(!l||!l.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let l=!i||i.type!==n.type;if(l){i&&this._removeTransition(e);const u=NZ[n.type];u?this.transitions[e]=new u({attribute:t,timeline:this.timeline,device:this.device}):(ri.error(`unsupported transition type '${n.type}'`)(),l=!1)}(l||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const TE="attributeManager.invalidate",BZ="attributeManager.updateStart",LZ="attributeManager.updateEnd",zZ="attribute.updateStart",UZ="attribute.allocate",VZ="attribute.updateEnd";class jZ{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=jm(SW),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new FZ(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Bs(TE,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bs(TE,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:l={},buffers:u={},context:a={}}){let p=!1;Bs(BZ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const y in this.attributes){const x=this.attributes[y],T=x.settings.accessor;x.startIndices=n,x.numInstances=t,l[y]&&ri.removed(`props.${y}`,`data.attributes.${y}`)(),x.setExternalBuffer(u[y])||x.setBinaryValue(typeof T=="string"?u[T]:void 0,e.startIndices)||typeof T=="string"&&!u[T]&&x.setConstantValue(l[T])||x.needsUpdate()&&(p=!0,this._updateAttribute({attribute:x,numInstances:t,data:e,props:l,context:a})),this.needsRedraw=this.needsRedraw||x.needsRedraw()}p&&Bs(LZ,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const l in t){const u=t[l];u.needsRedraw(e)&&!n.hasAttribute(l)&&(i[l]=u)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],l={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new FP(this.device,l)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,l=i[e];return l&&l.forEach(u=>{const a=n[u];a&&a.setNeedsUpdate(a.id,t)}),l}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Bs(zZ,t),t.constant){t.setConstantValue(t.value);return}t.allocate(n)&&Bs(UZ,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,Bs(VZ,t,n))}}class HZ extends ab{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:l}}=this,u=l(e/i);this._value=tv(t,n,u)}}const SE=1e-5;function AE(r,e,t,n,i){const l=e-r,a=(t-e)*i,p=-l*n;return a+p+l+e}function WZ(r,e,t,n,i){if(Array.isArray(t)){const l=[];for(let u=0;u<t.length;u++)l[u]=AE(r[u],e[u],t[u],n,i);return l}return AE(r,e,t,n,i)}function EE(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class $Z extends ab{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:l=e,_currValue:u=e}=this;let a=WZ(l,u,t,n,i);const p=EE(a,t),y=EE(a,u);p<SE&&y<SE&&(a=t,this.end()),this._prevValue=u,this._currValue=a}}const qZ={interpolation:HZ,spring:$Z};class XZ{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:l}=this;if(l.has(e)){const p=l.get(e),{value:y=p.settings.fromValue}=p;t=y,this.remove(e)}if(i=NP(i),!i)return;const u=qZ[i.type];if(!u){ri.error(`unsupported transition type '${i.type}'`)();return}const a=new u(this.timeline);a.start({...i,fromValue:t,toValue:n}),l.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ZZ(r){const e=r[su];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function YZ(r,e){const t=WP({newProps:r,oldProps:e,propTypes:r[su],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=GZ(r,e);let i=!1;return n||(i=JZ(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:QZ(r,e),transitionsChanged:KZ(r,e)}}function KZ(r,e){if(!r.transitions)return!1;const t={},n=r[su];let i=!1;for(const l in r.transitions){const u=n[l],a=u&&u.type;(a==="number"||a==="color"||a==="array")&&Cw(r[l],e[l],u)&&(t[l]=!0,i=!0)}return i?t:!1}function WP({newProps:r,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:i="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const l of Object.keys(r))if(!(l in t)){if(!(l in e))return`${i}.${l} added`;const u=Cw(r[l],e[l],n[l]);if(u)return`${i}.${l} ${u}`}for(const l of Object.keys(e))if(!(l in t)){if(!(l in r))return`${i}.${l} dropped`;if(!Object.hasOwnProperty.call(r,l)){const u=Cw(r[l],e[l],n[l]);if(u)return`${i}.${l} ${u}`}}return!1}function Cw(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function GZ(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function JZ(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&IE(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&IE(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function QZ(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function IE(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},WP({oldProps:i,newProps:n,triggerName:t})}const eY="count(): argument not an object",tY="count(): argument not a container";function rY(r){if(!iY(r))throw new Error(eY);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(nY(r))return Object.keys(r).length;throw new Error(tY)}function nY(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function iY(r){return r!==null&&typeof r=="object"}function CE(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const sY={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Pw={};function oY(r,e,t,n){if(t instanceof So)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const l=e.createTexture({...t,sampler:{...sY,...i,...n}});return Pw[l.id]=r,l}function aY(r,e){!e||!(e instanceof So)||Pw[e.id]===r&&(e.delete(),delete Pw[e.id])}const lY={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||Rw(r)&&(r.length===3||r.length===4)},equal(r,e,t){return jo(r,e,1)}},accessor:{validate(r,e){const t=av(r);return t==="function"||t===av(e.value)},equal(r,e,t){return typeof e=="function"?!0:jo(r,e,1)}},array:{validate(r,e){return e.optional&&!r||Rw(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?jo(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?jo(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:oY(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{aY(t.id,r)}}};function cY(r){const e={},t={},n={};for(const[i,l]of Object.entries(r)){const u=l==null?void 0:l.deprecatedFor;if(u)n[i]=Array.isArray(u)?u:[u];else{const a=uY(i,l);e[i]=a,t[i]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function uY(r,e){switch(av(e)){case"object":return Hf(r,e);case"array":return Hf(r,{type:"array",value:e,compare:!1});case"boolean":return Hf(r,{type:"boolean",value:e});case"number":return Hf(r,{type:"number",value:e});case"function":return Hf(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function Hf(r,e){return"type"in e?{name:r,...lY[e.type],...e}:"value"in e?{name:r,type:av(e.value),...e}:{name:r,type:"object",value:e}}function Rw(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function av(r){return Rw(r)?"array":r===null?"null":typeof r}function hY(r,e){let t;for(let l=e.length-1;l>=0;l--){const u=e[l];"extensions"in u&&(t=u.extensions)}const n=kw(r.constructor,t),i=Object.create(n);i[sv]=r,i[hu]={},i[ec]={};for(let l=0;l<e.length;++l){const u=e[l];for(const a in u)i[a]=u[a]}return Object.freeze(i),i}const dY="_mergedDefaultProps";function kw(r,e){if(!(r instanceof hb.constructor))return{};let t=dY;if(e)for(const i of e){const l=i.constructor;l&&(t+=`:${l.extensionName||l.name}`)}const n=$P(r,t);return n||(r[t]=fY(r,e||[]))}function fY(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=kw(n),l=$P(r,"defaultProps")||{},u=cY(l),a=Object.assign(Object.create(null),i,u.defaultProps),p=Object.assign(Object.create(null),i==null?void 0:i[su],u.propTypes),y=Object.assign(Object.create(null),i==null?void 0:i[s0],u.deprecatedProps);for(const x of e){const T=kw(x.constructor);T&&(Object.assign(a,T),Object.assign(p,T[su]),Object.assign(y,T[s0]))}return pY(a,r),mY(a,p),gY(a,y),a[su]=p,a[s0]=y,e.length===0&&!Z1(r,"_propTypes")&&(r._propTypes=p),a}function pY(r,e){const t=yY(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function gY(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const l of e[t])Z1(this,l)||(this[l]=n);ri.deprecated(i,e[t].join("/"))()}})}function mY(r,e){const t={},n={};for(const i in e){const l=e[i],{name:u,value:a}=l;l.async&&(t[u]=a,n[u]=_Y(u))}r[Fh]=t,r[hu]={},Object.defineProperties(r,n)}function _Y(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||DP(e)?this[hu][r]=e:this[ec][r]=e},get(){if(this[ec]){if(r in this[ec])return this[ec][r]||this[Fh][r];if(r in this[hu]){const e=this[sv]&&this[sv].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[Fh][r]}}return this[Fh][r]}}}function Z1(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function $P(r,e){return Z1(r,e)&&r[e]}function yY(r){const e=r.componentName;return e||ri.warn(`${r.name}.componentName not specified`)(),e||r.name}let vY=0;class hb{constructor(...e){this.props=hY(this,e),this.id=this.props.id,this.count=vY++}clone(e){const{props:t}=this,n={};for(const i in t[Fh])i in t[ec]?n[i]=t[ec][i]:i in t[hu]&&(n[i]=t[hu][i]);return new this.constructor({...t,...n,...e})}}hb.componentName="Component";hb.defaultProps={};const bY=Object.freeze({});class xY{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||bY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[sv]||this.component;const t=e[ec]||{},n=e[hu]||e,i=e[Fh]||{};for(const l in t){const u=t[l];this._createAsyncPropData(l,i[l]),this._updateAsyncProp(l,u),t[l]=this.getAsyncProp(l)}for(const l in n){const u=n[l];this._createAsyncPropData(l,i[l]),this._updateAsyncProp(l,u)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(DP(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(l=>{this.component&&(l=this._postProcessValue(n,l),this._setAsyncPropValue(e,l,i),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let l=[],u=0;for await(const a of t){if(!this.component)return;const{dataTransform:p}=this.component.props;p?l=p(a,l):l=l.concat(a),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:u,endRow:l.length}]}),u=l.length,this._setAsyncPropValue(e,l,i)}this._onResolve(e,l)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[su];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class wY extends xY{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const TY="layer.changeFlag",SY="layer.initialize",AY="layer.update",EY="layer.finalize",IY="layer.matched",PE=2**24-1,CY=Object.freeze([]),PY=jm(({oldViewport:r,viewport:e})=>r.equals(e));let sa=new Uint8ClampedArray(0);const RY={data:{type:"data",value:CY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:n,loadOptions:i,signal:l})=>{const{resourceManager:u}=t.context;i=i||t.getLoadOptions(),n=n||t.props.loaders,l&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:l}});let a=u.contains(r);return!a&&!i&&(u.add({resourceId:r,data:Vy(r,n),persistent:!1}),a=!0),a?u.subscribe({resourceId:r,onChange:p=>{var y;return(y=t.internalState)==null?void 0:y.reloadAsyncProp(e,p)},consumerId:t.id,requestId:e}):Vy(r,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:qn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Y1 extends hb{constructor(){super(...arguments),this.internalState=null,this.lifecycle=gh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Gi(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=cP(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,l,u]=oP(n,t.pixelProjectionMatrix);return e.length===2?[i,l]:[i,l,u]}unproject(e){return Gi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Gi(this.internalState);const n=this.internalState.viewport||this.context.viewport;return RW(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===qn.DEFAULT||e===qn.LNGLAT||e===qn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Gi(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:rY(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=CE(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=CE(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,l=this.internalState.hasPickingBuffer,u=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(l!==u){this.internalState.hasPickingBuffer=u;const{pickingColors:a,instancePickingColors:p}=t.attributes,y=a||p;y&&(u&&y.constant&&(y.constant=!1,t.invalidate(y.id)),!y.value&&!u&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var n,i,l,u;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(u=(l=this.context)==null?void 0:l.onError)==null||u.call(l,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!PY({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(sa.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>PE&&ri.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),sa=Ip.allocate(sa,t,{size:4,copy:!0,maxCount:Math.max(t,PE)});const i=Math.floor(sa.length/4),l=[];for(let u=n;u<i;u++)this.encodePickingColor(u,l),sa[u*4+0]=l[0],sa[u*4+1]=l[1],sa[u*4+2]=l[2]}e.value=sa.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){var a;if(!Object.keys(t).length)return;if(n){const p=this.getAttributeManager();e.setBufferLayout(p.getBufferLayouts(e)),t=p.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},l={},u={};for(const p in t){if(i[p])continue;const y=t[p].getValue();for(const x in y){const T=y[x];T instanceof Ti?t[p].settings.isIndexed?e.setIndexBuffer(T):l[x]=T:T&&(u[x]=T)}}e.setAttributes(l),e.setConstantAttributes(u)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,l=n||i,u=l&&t.attributes&&t.attributes[l.id];if(u&&u.value){const a=u.value,p=this.encodePickingColor(e);for(let y=0;y<t.length;y++){const x=l.getVertexOffset(y);a[x]===p[0]&&a[x+1]===p[1]&&a[x+2]===p[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const l=i.getVertexOffset(e),u=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(u-l),l)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==sa.buffer&&(n.value=sa.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Gi(!this.internalState),Gi(Number.isFinite(this.props.coordinateSystem)),Bs(SY,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new wY({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ri.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new XZ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bs(IY,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bs(AY,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,l=n.viewport,u=this._updateUniformTransition();i.propsInTransition=u,n.viewport=i.viewport||l,this.props=u;try{const a=this._getUpdateParams(),p=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const x of this.props.extensions)x.updateState.call(this,a,x);const y=this.getModels()[0]!==p[0];this._postUpdate(a,y)}finally{n.viewport=l,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Bs(EY,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const l=this.props,u=this.context;this.props=this.internalState.propsInTransition||l;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(t){const{isActive:x,isAttribute:T}=t.picking;this.setModuleParameters(t),this.setShaderModuleProps({picking:{isActive:x,isAttribute:T}})}const{getPolygonOffset:p}=this.props,y=p&&p(n)||[0,0];u.device.setParametersWebGL({polygonOffset:y});for(const x of this.getModels())x.setParameters(i);u.device.withParametersWebGL(i,()=>{const x={renderPass:e,moduleParameters:t,uniforms:n,parameters:i,context:u};for(const T of this.props.extensions)T.draw.call(this,x,T);this.draw(x)})}finally{this.props=l}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let l=!1;switch(i){case"dataChanged":const u=e[i],a=t[i];u&&Array.isArray(a)&&(t.dataChanged=Array.isArray(u)?a.concat(u):u,l=!0);default:t[i]||(t[i]=e[i],l=!0)}l&&Bs(TY,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const n=YZ(e,t);if(n.updateTriggersChanged)for(const l in n.updateTriggersChanged)n.updateTriggersChanged[l]&&this.invalidateAttribute(l);if(n.transitionsChanged)for(const l in n.transitionsChanged)this.internalState.uniformTransitions.add(l,t[l],e[l],(i=e.transitions)==null?void 0:i[l]);return this.setChangeFlags(n)}validateProps(){ZZ(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new jZ(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const l=this.state.model;l!=null&&l.isInstanced&&l.setInstanceCount(this.getNumInstances());const{autoHighlight:u,highlightedObjectIndex:a,highlightColor:p}=n;if(t||i.autoHighlight!==u||i.highlightedObjectIndex!==a||i.highlightColor!==p){const y={};Array.isArray(p)&&(y.highlightColor=p),(t||i.autoHighlight!==u||a!==i.highlightedObjectIndex)&&(y.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:y})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const l of this.props.extensions)l.onNeedsRedraw.call(this,l);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Y1.defaultProps=RY;Y1.layerName="Layer";const _0=512,kY=Math.PI/180;function qP({map:r,gl:e,deck:t}){if(r.__deck)return r.__deck;const n=t==null?void 0:t.props._customRender,i=t==null?void 0:t.props.onLoad,l=ZP({...t==null?void 0:t.props,_customRender:()=>{r.triggerRepaint(),n==null||n("")}});let u;return(!t||t.props.gl===e)&&(Object.assign(l,{gl:e,width:null,height:null,touchAction:"unset",viewState:Op(r)}),t!=null&&t.isInitialized?RE(t,r):l.onLoad=()=>{i==null||i(),RE(u,r)}),t?(u=t,t.setProps(l),t.userData.isExternal=!0):(u=new Mp(l),r.on("remove",()=>{XP(r)})),u.userData.mapboxLayers=new Set,r.__deck=u,r.on("render",()=>{u.isInitialized&&BY(u,r)}),u}function RE(r,e){const t=()=>{r.isInitialized?LY(r,e):e.off("move",t)};e.on("move",t)}function XP(r){var e;(e=r.__deck)==null||e.finalize(),r.__deck=null}function ZP(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new j1({id:"mapbox"})]}}function MY(r,e){r.userData.mapboxLayers.add(e),K1(r)}function OY(r,e){r.userData.mapboxLayers.delete(e),K1(r)}function DY(r,e){K1(r)}function NY(r,e,t){let{currentViewport:n}=r.userData,i=!1;n||(n=YP(r,e,!0),r.userData.currentViewport=n,i=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:l})=>t.id===l.id||l.props.operation.includes("terrain"),clearStack:i,clearCanvas:!1})}function Op(r){var i;const{lng:e,lat:t}=r.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(i=r.getTerrain)!=null&&i.call(r)&&FY(r,n),n}function FY(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:l,pitch:u}=e,a=t.x*_0,p=(1-t.y)*_0,y=t.z*_0,x=Ep([i,l]),T=a-x[0],E=p-x[1],k=Math.sqrt(T*T+E*E),F=u*kY,D=1.5*n,N=F<.001?D*Math.cos(F)/y:D*Math.sin(F)/k;e.zoom=Math.log2(N);const B=D*Math.cos(F)/N,V=y-B;e.position=[0,0,V/Ty(l)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function YP(r,e,t=!0){return new uu({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...Op(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function BY(r,e){const{mapboxLayers:t,isExternal:n}=r.userData;if(n){const i=Array.from(t,x=>x.id),u=Rp(r.props.layers,Boolean).some(x=>x&&!i.includes(x.id));let a=r.getViewports();const p=a.findIndex(x=>x.id==="mapbox"),y=a.length>1||p<0;(u||y)&&(p>=0&&(a=a.slice(),a[p]=YP(r,e,!1)),r._drawLayers("mapbox-repaint",{viewports:a,layerFilter:x=>(!r.props.layerFilter||r.props.layerFilter(x))&&(x.viewport.id!=="mapbox"||!i.includes(x.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function LY(r,e){r.setProps({viewState:Op(e)}),r.needsRedraw({clearRedrawFlags:!0})}function K1(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const n=t.props.type,i=new n(t.props);e.push(i)}),r.setProps({layers:e})}class zY{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=qP({map:e,gl:t,deck:this.props.deck}),MY(this.deck,this)}onRemove(){this.deck&&OY(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&DY(this.deck)}render(){NY(this.deck,this.map,this)}}const y0="__UNDEFINED__";function uy(r,e,t,n){if(!r||!e||!r.style||!r.style._loaded)return;const i=Rp(n,Boolean);if(t!==n){const a=Rp(t,Boolean),p=new Set(a.map(y=>y.id));for(const y of i)p.delete(y.id);for(const y of p)r.getLayer(y)&&r.removeLayer(y)}for(const a of i){const p=r.getLayer(a.id);p?(p.implementation||p).setProps(a.props):r.addLayer(new zY({id:a.id,deck:e}),a.props.beforeId)}const l=r.style._order,u={};for(const a of i){let{beforeId:p}=a.props;(!p||!l.includes(p))&&(p=y0),u[p]=u[p]||[],u[p].push(a.id)}for(const a in u){const p=u[a];let y=a===y0?l.length:l.indexOf(a),x=a===y0?void 0:a;for(let T=p.length-1;T>=0;T--){const E=p[T],k=l.indexOf(E);k!==y-1&&(r.moveLayer(E,x),k>y&&y++),y--,x=E}}}class UY{constructor(e){this._handleStyleChange=()=>{uy(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:i,clientHeight:l}=this._map.getContainer();Object.assign(this._container.style,{width:`${i}px`,height:`${l}px`})}},this._updateViewState=()=>{const i=this._deck;i&&(i.setProps({viewState:Op(this._map)}),i.isInitialized&&i.redraw())},this._handleMouseEvent=i=>{const l=this._deck;if(!l||!l.isInitialized)return;const u={type:i.type,offsetCenter:i.point,srcEvent:i},a=this._lastMouseDownPoint;switch(!i.point&&a&&(u.deltaX=i.originalEvent.clientX-a.clientX,u.deltaY=i.originalEvent.clientY-a.clientY,u.offsetCenter={x:a.x+u.deltaX,y:a.y+u.deltaY}),u.type){case"mousedown":l._onPointerDown(u),this._lastMouseDownPoint={...i.point,clientX:i.originalEvent.clientX,clientY:i.originalEvent.clientY};break;case"dragstart":u.type="panstart",l._onEvent(u);break;case"drag":u.type="panmove",l._onEvent(u);break;case"dragend":u.type="panend",l._onEvent(u);break;case"click":u.tapCount=1,l._onEvent(u);break;case"dblclick":u.type="click",u.tapCount=2,l._onEvent(u);break;case"mousemove":u.type="pointermove",l._onPointerMove(u);break;case"mouseout":u.type="pointerleave",l._onPointerMove(u);break;default:return}};const{interleaved:t=!1,...n}=e;this._interleaved=t,this._props=n}setProps(e){this._interleaved&&e.layers&&uy(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?ZP(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Mp({...this._props,parent:t,viewState:Op(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&ri.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=qP({map:e,gl:t,deck:new Mp({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),uy(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(t=this._deck)==null||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),uy(e,this._deck,this._props.layers,[]),XP(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Gi(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Gi(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Gi(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const VY=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,jY=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,HY=1024,WY=4,kE=()=>{},ME={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$Y={x:0,y:0,width:0,height:0};function qY(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function XY(r,e,t,n){const i=Math.min(t/e.width,n/e.height),l=Math.floor(e.width*i),u=Math.floor(e.height*i);return i===1?{data:e,width:l,height:u}:(r.canvas.height=u,r.canvas.width=l,r.clearRect(0,0,l,u),r.drawImage(e,0,0,e.width,e.height,0,0,l,u),{data:r.canvas,width:l,height:u})}function Dp(r){return r&&(r.id||r.url)}function ZY(r,e,t,n){const{width:i,height:l,device:u}=r,a=u.createTexture({format:"rgba8unorm",width:e,height:t,sampler:n}),p=u.createCommandEncoder();return p.copyTextureToTexture({source:r,destination:a,width:i,height:l}),p.finish(),r.destroy(),a}function OE(r,e,t){for(let n=0;n<e.length;n++){const{icon:i,xOffset:l}=e[n],u=Dp(i);r[u]={...i,x:l,y:t}}}function YY({icons:r,buffer:e,mapping:t={},xOffset:n=0,yOffset:i=0,rowHeight:l=0,canvasWidth:u}){let a=[];for(let p=0;p<r.length;p++){const y=r[p],x=Dp(y);if(!t[x]){const{height:T,width:E}=y;n+E+e>u&&(OE(t,a,i),n=0,i=l+i+e,l=0,a=[]),a.push({icon:y,xOffset:n}),n=n+E+e,l=Math.max(l,T)}}return a.length>0&&OE(t,a,i),{mapping:t,rowHeight:l,xOffset:n,yOffset:i,canvasWidth:u,canvasHeight:qY(l+i+e)}}function KY(r,e,t){if(!r||!e)return null;t=t||{};const n={},{iterable:i,objectInfo:l}=OP(r);for(const u of i){l.index++;const a=e(u,l),p=Dp(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[p]&&(!t[p]||a.url!==t[p].url)&&(n[p]={...a,source:u,sourceIndex:l.index})}return n}class GY{constructor(e,{onUpdate:t=kE,onError:n=kE}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=WY,this._canvasWidth=HY,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Dp(e):e;return this._mapping[t]||$Y}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:l}){var u;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),n&&((u=this._texture)==null||u.delete(),this._texture=null,this._externalTexture=n),l&&(this._textureParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(KY(e,t,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:l,yOffset:u,rowHeight:a,canvasHeight:p}=YY({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=l,this._yOffset=u,this._canvasHeight=p,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||ME})),this._texture.height!==this._canvasHeight&&(this._texture=ZY(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||ME)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,Vy(n.url,this._loadOptions).then(i=>{const l=Dp(n),u=this._mapping[l],{x:a,y:p,width:y,height:x}=u,{data:T,width:E,height:k}=XY(t,i,y,x);this._texture.setSubImageData({data:T,x:a+(y-E)/2,y:p+(x-k)/2,width:E,height:k}),u.width=E,u.height=k,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const KP=[0,0,0,255],JY={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:KP},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class G1 extends Y1{getShaders(){return super.getShaders({vs:VY,fs:jY,modules:[N7,nW]})}initializeState(){this.state={iconManager:new GY(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:KP},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var k;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,l=this.getAttributeManager(),{iconAtlas:u,iconMapping:a,data:p,getIcon:y,textureParameters:x}=t,{iconManager:T}=this.state;if(typeof u=="string")return;const E=u||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:t.loadOptions,autoPacking:!E,iconAtlas:u,iconMapping:E?a:null,textureParameters:x}),E?n.iconMapping!==t.iconMapping&&l.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&T.packIcons(p,y),i.extensionsChanged&&((k=this.state.model)==null||k.destroy(),this.state.model=this._getModel(),l.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:l,billboard:u,alphaCutoff:a}=this.props,{iconManager:p}=this.state,y=p.getTexture();if(y){const x=this.state.model;x.setBindings({iconsTexture:y}),x.setUniforms(e),x.setUniforms({iconsTextureDim:[y.width,y.height],sizeUnits:fw[l],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:u,alphaCutoff:a}),x.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Cp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new WW({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const t=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;t?t(e):ri.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:l=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-l]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:l}=this.state.iconManager.getIconMapping(e);return[t,n,i,l]}}G1.defaultProps=JY;G1.layerName="IconLayer";function QY(r){const e=.03125*r,t=(r-r/2)/2+e,n=r-2*t,i=r/2,l=n/3.5,u=document.createElement("canvas");u.width=r,u.height=r;const a=u.getContext("2d",{alpha:!0});return a&&(a.beginPath(),a.arc(t+l,i,l,1/2*Math.PI,3/2*Math.PI,!1),a.bezierCurveTo(t+l+l,i-l,r-t,i,r-t,i),a.bezierCurveTo(r-t,i,t+l+l,i+l,t+l,i+l),a.closePath(),a.fillStyle="rgba(255, 0, 0, 0.7)",a.fill(),a.lineWidth=e,a.strokeStyle="rgba(120, 120, 120, 1.0)",a.stroke()),u}var Ys=63710088e-1,GP={centimeters:Ys*100,centimetres:Ys*100,degrees:360/(2*Math.PI),feet:Ys*3.28084,inches:Ys*39.37,kilometers:Ys/1e3,kilometres:Ys/1e3,meters:Ys,metres:Ys,miles:Ys/1609.344,millimeters:Ys*1e3,millimetres:Ys*1e3,nauticalmiles:Ys/1852,radians:1,yards:Ys*1.0936};function eK(r,e="kilometers"){const t=GP[e];if(!t)throw new Error(e+" units is invalid");return r*t}function tK(r,e="kilometers"){const t=GP[e];if(!t)throw new Error(e+" units is invalid");return r/t}function rK(r){return r%(2*Math.PI)*180/Math.PI}function v0(r){return r%360*Math.PI/180}function nK(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return eK(tK(r,e),t)}function Sh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function iK(r,e,t={}){const n=Sh(r),i=Sh(e);i[0]+=i[0]-n[0]>180?-360:n[0]-i[0]>180?360:0;const l=sK(n,i);return nK(l,"meters",t.units)}function sK(r,e,t){t=t===void 0?Ys:Number(t);const n=t,i=r[1]*Math.PI/180,l=e[1]*Math.PI/180,u=l-i;let a=Math.abs(e[0]-r[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);const p=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),y=Math.abs(p)>1e-11?u/p:Math.cos(i);return Math.sqrt(u*u+y*y*a*a)*n}var DE=iK;function oK(r,e,t={}){let n;return t.final?n=NE(Sh(e),Sh(r)):n=NE(Sh(r),Sh(e)),n>180?-(360-n):n}function NE(r,e){const t=v0(r[1]),n=v0(e[1]);let i=v0(e[0]-r[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);const l=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(t/2+Math.PI/4)),u=Math.atan2(i,l);return(rK(u)+360)%360}var aK=oK;function lK(r,e){zt(e,!0);let t=Pt(void 0);function n(N){var B=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(N);if(!B)throw`${N} is not a hex color #RRGGBB`;return[parseInt(B[1],16),parseInt(B[2],16),parseInt(B[3],16),255]}const i=N=>{let B=[];const V=new Date(N.departure).getTime(),U=new Date(N.arrival).getTime(),j=new Date(N.scheduledArrival).getTime(),J=new Date(N.scheduledDeparture).getTime(),oe=U-j,le=V-J,Ce=tu.decode(N.polyline).map(([pe,ze])=>[ze,pe]),Ie=U-V;let Ue=0,De=0;for(let pe=0;pe<Ce.length-1;pe++){let ze=Ce[pe],Ne=Ce[pe+1];De+=DE(ze,Ne,{units:"meters"})}for(let pe=0;pe<Ce.length-1;pe++){let ze=Ce[pe],Ne=Ce[pe+1];const ot=DE(ze,Ne,{units:"meters"}),At=aK(ze,Ne),Qe=Ue/De;B.push({point:ze,heading:At,time:V+Qe*Ie}),Ue+=ot}return Math.abs(De-Ue)>1&&console.log(De,Ue),B.push({point:Ce[Ce.length-1],time:U,heading:0}),{keyFrames:B,arrival:U,departure:V,arrivalDelay:oe,departureDelay:le}},l=(N,B)=>{const V=N.findIndex(oe=>oe.time>=B);if(V===-1||V===0){console.log("not found, timestamp=",new Date(B)," #keyframes=",N.length," first=",new Date(N[0].time),", last=",new Date(N[N.length-1].time));return}const U=N[V-1],j=N[V],J=(B-U.time)/(j.time-U.time);return{point:[U.point[0]*(1-J)+j.point[0]*J,U.point[1]*(1-J)+j.point[1]*J],heading:U.heading}},u=N=>{const B=new Date().getTime(),V=N.filter(j=>B>=j.departure&&B<=j.arrival).map(j=>({...j,...l(j.keyFrames,B)})).filter(j=>j.point),U=(j,J,oe)=>{const le=j/6e4,Ce=J/6e4;return oe?le<=-1?[255,48,71,255]:Ce<=3?[69,209,74,255]:Ce<=5?[255,237,0,255]:Ce<=10?[255,102,0,255]:Ce<=15?[255,48,71,255]:[163,0,10,255]:[100,100,100,255]};return new G1({id:"trips",data:V,beforeId:"road-name-text",getColor:j=>{switch(e.colorMode){case"rt":return U(j.departureDelay,j.arrivalDelay,j.realTime);case"mode":return n(cc(j)[1]);case"route":return n(nc(j)[0])}},getAngle:j=>-j.heading+90,getPosition:j=>j.point,getSize:j=>48,getIcon:j=>"marker",pickable:!0,iconAtlas:QY(128),iconMapping:{marker:{x:0,y:0,width:128,height:128,anchorY:64,anchorX:64,mask:!0}}})},a=()=>{const N=wi.LngLatBounds.convert(e.bounds),B=hc(N.getNorthWest()),V=hc(N.getSouthEast()),U=new Date,j=new Date(U.getTime()+18e4);return MM({query:{min:B,max:V,startTime:U.toISOString(),endTime:j.toISOString(),zoom:e.zoom}})};let p=null;const y=async()=>{try{const{data:N,error:B,response:V}=await a();if(p&&cancelAnimationFrame(p),B){ve(t,`map trips error status ${V.status}`);return}ve(t,void 0);const U=N.map(J=>({...J,...i(J)})),j=()=>{A(T).setProps({layers:[u(U)]}),p=requestAnimationFrame(j)};j()}catch(N){ve(t,N,!0)}};let x,T=Pt(void 0);const E=async()=>{await y(),clearTimeout(x),x=setTimeout(()=>{console.log("updateRailviz: timer"),E()},6e4)};Xr(()=>{e.map&&!A(T)&&(ve(T,new UY({interleaved:!0,layers:[],getTooltip:({object:N})=>N?{html:`${N.trips[0].displayName}<br>
						${rd(new Date(N.departure),N.from.tz)} ${N.from.name}<br>
						${rd(new Date(N.arrival),N.to.tz)} ${N.to.name}`}:null,onClick:({object:N})=>{N&&fp(N.trips[0].tripId)},getCursor:()=>e.map.getCanvas().style.cursor})),e.map.addControl(A(T)),console.log("updateRailviz: init"),fo(()=>E()))}),Xr(()=>{A(T)&&e.bounds&&e.zoom&&e.colorMode&&fo(()=>{console.log(`updateRailviz: effect ${A(T)} ${e.bounds} ${e.zoom} ${e.colorMode}`),E()})}),oc(()=>{p&&cancelAnimationFrame(p),clearTimeout(x),e.map&&A(T)&&e.map.removeControl(A(T))});var k=it(),F=xe(k);{var D=N=>{wo(N,{position:"bottom-left",children:(B,V)=>{sn();var U=jr();ct(()=>vt(U,A(t))),K(B,U)},$$slots:{default:!0}})};et(F,N=>{A(t)&&N(D)})}K(r,k),Ut()}function b0(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]),n=ni(t,["class","value"]);zt(e,!1);let i=fe(e,"class",8,void 0),l=fe(e,"value",8);Nm();const u=Gs(()=>kn("ring-offset-background focus-visible:ring-ring mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",i()));AL(r,cn({get class(){return A(u)},get value(){return l()}},()=>n,{children:(a,p)=>{var y=it(),x=xe(y);fi(x,e,"default",{}),K(a,y)},$$slots:{default:!0}})),Ut()}function cK(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]),n=ni(t,["class"]);zt(e,!1);let i=fe(e,"class",8,void 0);Nm();const l=Gs(()=>kn("bg-muted text-muted-foreground inline-flex h-10 items-center justify-center rounded-md p-1",i()));IL(r,cn({get class(){return A(l)}},()=>n,{children:(u,a)=>{var p=it(),y=xe(p);fi(y,e,"default",{}),K(u,p)},$$slots:{default:!0}})),Ut()}function x0(r,e){zt(e,!0),fe(e,"ref",11,null);let t=fe(e,"class",7),n=an(e,["$$slots","$$events","$$legacy","ref","class","value"]);var i=it(),l=xe(i);const u=Re(()=>kn("ring-offset-background focus-visible:ring-ring data-[state=active]:bg-background data-[state=active]:text-foreground inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm",t()));return Tr(l,()=>PL,(a,p)=>{p(a,cn({get class(){return A(u)},get value(){return e.value}},()=>n))}),K(r,i),Ut({get class(){return t()},set class(a){t(a)}})}const uK=TL;var hK=Ve('<div id="searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!></div>');function dK(r,e){zt(e,!0);let t=Pt(void 0),n=Pt(yn([]));var i=hK(),l=Be(i);Dy(l,{name:"from",get placeholder(){return Rt.from},onlyStations:!0,get selected(){return A(t)},set selected(u){ve(t,u,!0)},get items(){return A(n)},set items(u){ve(n,u,!0)}}),ke(i),K(r,i),Ut()}const FE=["NONE","OVERLAY_RECTS","OVERLAY_CIRCLES","GEOMETRY_CIRCLES"],JP=(r,e)=>FE.indexOf(r)<FE.indexOf(e),fK=(r,e)=>JP(r,e)?r:e,BE=r=>r=="OVERLAY_RECTS"||r=="OVERLAY_CIRCLES";function pK(r){return new Worker(""+new URL("../workers/IsochronesWorker-CQGl3Yub.js",import.meta.url).href,{name:r==null?void 0:r.name})}function gK(r,e){zt(e,!0);let t=fe(e,"options",15);const n={type:"LineString",coordinates:[]};let i=Pt(void 0),l=Pt("NONE");const u=Re(()=>e.streetModes.includes("BIKE")?.0038:e.wheelchair?8e-4:.0012),a=Re(()=>wi.LngLatBounds.convert(e.bounds??[[0,0],[1,1]])),p=Re(()=>[[A(a)._sw.lng,A(a)._ne.lat],[A(a)._ne.lng,A(a)._ne.lat],[A(a)._ne.lng,A(a)._sw.lat],[A(a)._sw.lng,A(a)._sw.lat]]);let y=[],x=0,T=0,E=0;Dm(()=>{x=e.maxAllTime,T=A(u)}),Xr(()=>{if(!e.map||!e.active||A(i)!==void 0)return;const F="isochrones-canvas",D="isochrones-circles";let N=document.createElement("canvas");if(N===void 0){console.log("Canvas not supported");return}let B=N.transferControlToOffscreen();e.map.addSource(F,{type:"canvas",canvas:N,coordinates:A(p)}),e.map.addLayer({id:F,type:"raster",source:F,paint:{"raster-opacity":t().opacity/1e3}});const V=e.map.getSource(F);e.map.addSource(D,{type:"geojson",data:n}),e.map.addLayer({id:D,type:"fill",source:D,paint:{"fill-color":t().color,"fill-opacity":t().opacity/1e3}});const U=e.map.getSource(D),j=new pK;j.onmessage=J=>{const oe=J.data.method;switch(oe){case"update-display-level":{const le=J.data.index;if(le<E){console.log(`Got stale index from worker (Got ${le}, expected ${E})`);return}const Ce=J.data.level;Ce=="GEOMETRY_CIRCLES"&&A(i)&&A(i).circlesSource.setData(J.data.geometry??n),JP(A(l),Ce)&&ve(l,Ce,!0)}break;default:console.log(`Unknown method '${oe}'`)}},j.postMessage({method:"set-canvas",canvas:B},[B]),ve(i,{worker:j,canvasLayer:F,circlesLayer:D,canvasSource:V,circlesSource:U},!0)}),Xr(()=>{!e.active||t().status=="FAILED"||A(i)===void 0||(((y.length!=0||e.isochronesData.length!=0)&&y!=e.isochronesData||x!=e.maxAllTime||T!=A(u))&&(A(i).worker.postMessage({method:"update-data",index:++E,data:Ks(e.isochronesData),kilometersPerSecond:Ks(A(u)),maxSeconds:Ks(e.maxAllTime),circleResolution:e.circleResolution}),y=e.isochronesData,x=e.maxAllTime,T=A(u),ve(l,"NONE"),A(i).circlesSource.setData(n)),A(i).worker.postMessage({method:"set-max-display-level",displayLevel:t().displayLevel}))}),Xr(()=>{!e.map||A(i)===void 0||(e.map.setLayoutProperty(A(i).canvasLayer,"visibility",e.active&&BE(A(k))?"visible":"none"),e.map.setLayoutProperty(A(i).circlesLayer,"visibility",e.active&&A(k)=="GEOMETRY_CIRCLES"?"visible":"none"))}),Xr(()=>{!e.map||A(i)===void 0||(e.map.setPaintProperty(A(i).canvasLayer,"raster-opacity",t().opacity/1e3),e.map.setPaintProperty(A(i).circlesLayer,"fill-opacity",t().opacity/1e3))}),Xr(()=>{!e.map||A(i)===void 0||e.map.setPaintProperty(A(i).circlesLayer,"fill-color",t().color)});let k=Re(()=>{if(!e.map||!e.active||A(i)===void 0)return"NONE";const F=fK(t().displayLevel,A(l));if(BE(F)){A(i).canvasSource.setCoordinates(A(p));const D=e.map._containerDimensions();A(i).worker.postMessage({method:"render-canvas",level:F,boundingBox:Ks(A(a)),dimensions:D,color:t().color})}return F});Xr(()=>{t(t().status=e.isochronesData.length==0?"EMPTY":A(k)=="NONE"||A(k)==t().displayLevel?"DONE":"WORKING",!0)}),Ut()}var mK=Ve('<div class="flex items-center justify-center w-full"><!></div>'),_K=Ve("<div><!> <!> <!></div>");function yK(r,e){zt(e,!0);var t=_K(),n=Be(t);{var i=y=>{var x=mK(),T=Be(x);wp(T,{class:"animate-spin w-12 h-12 m-4"}),ke(x),K(y,x)};et(n,y=>{e.options.status=="WORKING"&&y(i)})}var l=we(n,2);{var u=y=>{ru(y,{get e(){return Rt.isochrones.noData}})};et(l,y=>{e.options.status=="EMPTY"&&y(u)})}var a=we(l,2);{var p=y=>{const x=Re(()=>`${Rt.isochrones.requestFailed}`+(e.options.error?`: ${e.options.error}`:""));ru(y,{get e(){return A(x)}})};et(a,y=>{e.options.status=="FAILED"&&y(p)})}ke(t),K(r,t),Ut()}var vK=Ve("<!> <!>",1),bK=Ve('<span class="bg-dark-10 relative h-2 w-full grow cursor-pointer overflow-hidden rounded-full"><!></span> <!>',1),xK=Ve('<div class="grid grid-cols-[2fr_2fr_1fr] items-center gap-2"><!> <!> <input class="flex right-0 align-right" type="color"/></div>'),wK=Ve("<!> <span> </span>",1),TK=Ve("<!> <span> </span>",1),SK=Ve("<!> <!>",1),AK=Ve('<div id="isochrones-searchmask-container" class="flex flex-col space-y-4 p-4 relative"><!> <!> <div class="flex flex-row gap-2 flex-wrap"><!> <!> <!></div></div>');function EK(r,e){zt(e,!0);const t=Et=>{var Or=xK(),ir=Be(Or);Tr(ir,()=>td,(kr,nn)=>{nn(kr,{type:"single",get value(){return J().displayLevel},set value(pr){J(J().displayLevel=pr,!0)},children:(pr,Hr)=>{var Nr=vK(),mt=xe(Nr);Tr(mt,()=>ed,(Qt,Ct)=>{Ct(Qt,{class:"overflow-hidden",get"aria-label"(){return Rt.isochrones.displayLevel},children:(yt,sr)=>{sn();var Br=jr();ct($r=>vt(Br,$r),[()=>le.get(J().displayLevel)]),K(yt,Br)},$$slots:{default:!0}})});var Te=we(mt,2);Tr(Te,()=>Qh,(Qt,Ct)=>{Ct(Qt,{sideOffset:10,children:(yt,sr)=>{var Br=it(),$r=xe(Br);jn($r,19,()=>Ce,(Jt,Zt)=>Zt+Jt.value,(Jt,Zt)=>{var Ar=it(),Fr=xe(Ar);Tr(Fr,()=>Jh,(Jr,bt)=>{bt(Jr,{get value(){return A(Zt).value},get label(){return A(Zt).label},children:(zr,Mr)=>{sn();var Zr=jr();ct(()=>vt(Zr,A(Zt).label)),K(zr,Zr)},$$slots:{default:!0}})}),K(Jt,Ar)}),K(yt,Br)},$$slots:{default:!0}})}),K(pr,Nr)},$$slots:{default:!0}})});var vr=we(ir,2);Tr(vr,()=>qB,(kr,nn)=>{nn(kr,{type:"single",min:0,max:1e3,class:"relative flex w-full touch-none select-none items-center",get value(){return J().opacity},set value(pr){J(J().opacity=pr,!0)},children:(pr,Hr)=>{var Nr=bK(),mt=xe(Nr),Te=Be(mt);Tr(Te,()=>ZB,(Ct,yt)=>{yt(Ct,{class:"bg-foreground absolute h-full"})}),ke(mt);var Qt=we(mt,2);Tr(Qt,()=>KB,(Ct,yt)=>{yt(Ct,{index:0,class:"border-border-input bg-background hover:border-dark-40 focus-visible:ring-foreground dark:bg-foreground dark:shadow-card focus-visible:outline-hidden block size-[25px] cursor-pointer rounded-full border shadow-sm transition-colors focus-visible:ring-2 focus-visible:ring-offset-2 active:scale-[0.98] disabled:pointer-events-none disabled:opacity-50"})}),K(pr,Nr)},$$slots:{default:!0}})});var ur=we(vr,2);Ay(ur),ke(Or),cI(ur,()=>J().color,kr=>J(J().color=kr,!0)),K(Et,Or)},n=Et=>Et.map(Or=>Or*60);let i=fe(e,"one",15),l=fe(e,"maxTravelTime",15),u=fe(e,"time",15),a=fe(e,"useRoutedTransfers",15),p=fe(e,"pedestrianProfile",15),y=fe(e,"requireBikeTransport",15),x=fe(e,"requireCarTransport",15),T=fe(e,"transitModes",15),E=fe(e,"maxTransfers",15),k=fe(e,"preTransitModes",15),F=fe(e,"postTransitModes",15),D=fe(e,"maxPreTransitTime",15),N=fe(e,"maxPostTransitTime",15),B=fe(e,"arriveBy",15),V=fe(e,"elevationCosts",15),U=fe(e,"ignorePreTransitRentalReturnConstraints",15),j=fe(e,"ignorePostTransitRentalReturnConstraints",15),J=fe(e,"options",15);const oe=n([1,5,10,15,20,25,30,35,40,45,50,55,60,70,75,80,90,120,150,180,210,240]).map(Et=>({value:Et.toString(),label:Ho(Et)})),le=new Map([["OVERLAY_RECTS",Rt.isochrones.canvasRects],["OVERLAY_CIRCLES",Rt.isochrones.canvasCircles],["GEOMETRY_CIRCLES",Rt.isochrones.geojsonCircles]]),Ce=[...[...le.entries()].map(([Et,Or])=>({value:Et,label:Or}))];let Ie=Pt(yn([])),Ue=B()?"arrival":"departure";const De=()=>{navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(ze,Et=>console.log(Et),{enableHighAccuracy:!0})},pe=Et=>{if(Et!=Ue){const Or=k();k(F()),F(Or);const ir=D();D(N()),N(ir),Ue=Et}},ze=Et=>{i(Oi({lat:Et.coords.latitude,lon:Et.coords.longitude},0))};var Ne=AK(),ot=Be(Ne);Dy(ot,{get place(){return e.geocodingBiasPlace},name:"one",get placeholder(){return Rt.position},get selected(){return i()},set selected(Et){i(Et)},get items(){return A(Ie)},set items(Et){ve(Ie,Et,!0)}});var At=we(ot,2);Bn(At,{variant:"ghost",class:"absolute z-10 right-4 top-0",size:"icon",onclick:()=>De(),children:(Et,Or)=>{Lw(Et,{class:"w-5 h-5"})},$$slots:{default:!0}});var Qe=we(At,2),pt=Be(Qe);Fy(pt,{get value(){return u()},set value(Et){u(Et)}});var _t=we(pt,2),Lt=()=>B()?"arrival":"departure",Ht=Et=>B(Et==="arrival");Tr(_t,()=>f1,(Et,Or)=>{Or(Et,{class:"flex",get value(){return Lt()},set value(ir){Ht(ir)},onValueChange:pe,children:(ir,vr)=>{var ur=SK(),kr=xe(ur);xp(kr,{for:"isochrones-departure",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(pr,Hr)=>{var Nr=wK(),mt=xe(Nr);Tr(mt,()=>vp,(Ct,yt)=>{yt(Ct,{value:"departure",id:"isochrones-departure",class:"sr-only",get"aria-label"(){return Rt.departure}})});var Te=we(mt,2),Qt=Be(Te,!0);ke(Te),ct(()=>vt(Qt,Rt.departure)),K(pr,Nr)},$$slots:{default:!0}});var nn=we(kr,2);xp(nn,{for:"isochrones-arrival",class:"flex items-center rounded-md border-2 border-muted bg-popover p-1 px-2 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-blue-600 hover:cursor-pointer",children:(pr,Hr)=>{var Nr=TK(),mt=xe(Nr);Tr(mt,()=>vp,(Ct,yt)=>{yt(Ct,{value:"arrival",id:"isochrones-arrival",class:"sr-only",get"aria-label"(){return Rt.arrival}})});var Te=we(mt,2),Qt=Be(Te,!0);ke(Te),ct(()=>vt(Qt,Rt.arrival)),K(pr,Nr)},$$slots:{default:!0}}),K(ir,ur)},$$slots:{default:!0}})});var ar=we(_t,2),Tt=()=>p()==="WHEELCHAIR",Sr=Et=>p(Et?"WHEELCHAIR":"FOOT");NC(ar,{get wheelchair(){return Tt()},set wheelchair(Et){Sr(Et)},possibleMaxTravelTimes:oe,directModes:void 0,maxDirectTime:void 0,ignoreDirectRentalReturnConstraints:void 0,additionalComponents:t,get useRoutedTransfers(){return a()},set useRoutedTransfers(Et){a(Et)},get requireCarTransport(){return x()},set requireCarTransport(Et){x(Et)},get requireBikeTransport(){return y()},set requireBikeTransport(Et){y(Et)},get transitModes(){return T()},set transitModes(Et){T(Et)},get maxTransfers(){return E()},set maxTransfers(Et){E(Et)},get maxTravelTime(){return l()},set maxTravelTime(Et){l(Et)},get preTransitModes(){return k()},set preTransitModes(Et){k(Et)},get postTransitModes(){return F()},set postTransitModes(Et){F(Et)},get maxPreTransitTime(){return D()},set maxPreTransitTime(Et){D(Et)},get maxPostTransitTime(){return N()},set maxPostTransitTime(Et){N(Et)},get elevationCosts(){return V()},set elevationCosts(Et){V(Et)},get ignorePreTransitRentalReturnConstraints(){return U()},set ignorePreTransitRentalReturnConstraints(Et){U(Et)},get ignorePostTransitRentalReturnConstraints(){return j()},set ignorePostTransitRentalReturnConstraints(Et){j(Et)}}),ke(Qe),ke(Ne),K(r,Ne),Ut()}const IK="BICYCLE",qc={BICYCLE:{svg:"bike",station:"bike_station",vehicle:"floating_bike",cluster:"floating_bike_cluster",label:Rt.RENTAL_BICYCLE},CARGO_BICYCLE:{svg:"cargo_bike",station:"cargo_bike_station",vehicle:"floating_cargo_bike",cluster:"floating_cargo_bike_cluster",label:Rt.RENTAL_CARGO_BICYCLE},CAR:{svg:"car",station:"car_station",vehicle:"floating_car",cluster:"floating_car_cluster",label:Rt.RENTAL_CAR},MOPED:{svg:"moped",station:"moped_station",vehicle:"floating_moped",cluster:"floating_moped_cluster",label:Rt.RENTAL_MOPED},SCOOTER_SEATED:{svg:"scooter",station:"scooter_station",vehicle:"floating_scooter",cluster:"floating_scooter_cluster",label:Rt.RENTAL_SCOOTER_SEATED},SCOOTER_STANDING:{svg:"scooter",station:"scooter_station",vehicle:"floating_scooter",cluster:"floating_scooter_cluster",label:Rt.RENTAL_SCOOTER_STANDING},OTHER:{svg:"bike",station:"bike_station",vehicle:"floating_bike",cluster:"floating_bike_cluster",label:Rt.RENTAL_OTHER}};var CK=Ve('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),PK=Ve('<div class="space-y-3 text-sm leading-tight text-foreground"><div class="space-y-1"><div class="font-semibold"> </div> <div> <!></div></div> <!></div>');function RK(r,e){zt(e,!0);let t=fe(e,"showActions",3,!1);var n=PK(),i=Be(n),l=Be(i),u=Be(l,!0);ke(l);var a=we(l,2),p=Be(a),y=we(p);{var x=F=>{var D=CK(),N=Be(D,!0);ke(D),ct(()=>{ls(D,"href",e.provider.url),vt(N,e.provider.name)}),K(F,D)},T=F=>{var D=jr();ct(()=>vt(D,e.provider.name)),K(F,D)};et(y,F=>{e.provider.url?F(x):F(T,!1)})}ke(a),ke(i);var E=we(i,2);{var k=F=>{Bn(F,{class:"font-bold",variant:"outline",get href(){return e.station.rentalUriWeb},target:"_blank",children:(D,N)=>{sn();var B=jr();ct(()=>vt(B,Rt.rent)),K(D,B)},$$slots:{default:!0}})};et(E,F=>{t()&&e.station.rentalUriWeb&&F(k)})}ke(n),ct(()=>{vt(u,e.station.name),vt(p,`${Rt.sharingProvider??""}: `)}),K(r,n),Ut()}var kK=Ve('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),MK=Ve('<div class="space-y-3 text-sm leading-tight text-foreground"><div> <!></div> <!></div>');function OK(r,e){zt(e,!0);let t=fe(e,"showActions",3,!1);var n=MK(),i=Be(n),l=Be(i),u=we(l);{var a=T=>{var E=kK(),k=Be(E,!0);ke(E),ct(()=>{ls(E,"href",e.provider.url),vt(k,e.provider.name)}),K(T,E)},p=T=>{var E=jr();ct(()=>vt(E,e.provider.name)),K(T,E)};et(u,T=>{e.provider.url?T(a):T(p,!1)})}ke(i);var y=we(i,2);{var x=T=>{Bn(T,{class:"font-bold",variant:"outline",get href(){return e.vehicle.rentalUriWeb},target:"_blank",children:(E,k)=>{sn();var F=jr();ct(()=>vt(F,Rt.rent)),K(E,F)},$$slots:{default:!0}})};et(y,T=>{t()&&e.vehicle.rentalUriWeb&&T(x)})}ke(n),ct(()=>vt(l,`${Rt.sharingProvider??""}: `)),K(r,n),Ut()}var DK=Ve('<div class="font-semibold"> </div>'),NK=Ve('<a target="_blank" class="text-blue-600 dark:text-blue-300 hover:underline"> </a>'),FK=Ve('<div class="space-y-3 text-sm leading-tight text-foreground"><div class="space-y-1"><!> <div> <!></div></div> <div class="space-y-1"><div> </div> <div> </div></div></div>');function BK(r,e){zt(e,!0);var t=FK(),n=Be(t),i=Be(n);{var l=N=>{var B=DK(),V=Be(B,!0);ke(B),ct(()=>vt(V,e.zone.name)),K(N,B)};et(i,N=>{e.zone.name&&N(l)})}var u=we(i,2),a=Be(u),p=we(a);{var y=N=>{var B=NK(),V=Be(B,!0);ke(B),ct(()=>{ls(B,"href",e.provider.url),vt(V,e.provider.name)}),K(N,B)},x=N=>{var B=jr();ct(()=>vt(B,e.provider.name)),K(N,B)};et(p,N=>{e.provider.url?N(y):N(x,!1)})}ke(u),ke(n);var T=we(n,2),E=Be(T),k=Be(E,!0);ke(E);var F=we(E,2),D=Be(F,!0);ke(F),ke(T),ke(t),ct(()=>{vt(a,`${Rt.sharingProvider??""}: `),vt(k,e.rideThroughAllowed?Rt.rideThroughAllowed:Rt.rideThroughNotAllowed),vt(D,e.rideEndAllowed?Rt.rideEndAllowed:Rt.rideEndNotAllowed)}),K(r,t),Ut()}const w0=["interpolate",["linear"],["zoom"],14,.6,18,1],LK=["interpolate",["linear"],["zoom"],14,7.2,18,12],zK=["interpolate",["linear"],["zoom"],14,6,18,10],UK=r=>["interpolate",["linear"],["zoom"],14,["literal",[r[0]*.8,r[1]*.9]],18,["literal",r]],LE=UK([.8,-1.25]);var VK=Ve("<!> <!>",1),jK=Ve("<!> <!>",1),HK=(r,e,t)=>e(A(t)),WK=Ve('<button type="button"><span class="truncate"> </span> <span class="flex items-center gap-1 text-xs font-medium"><svg class="h-4 w-4 fill-current" aria-hidden="true" focusable="false"><use></use></svg></span></button>'),$K=Ve('<div class="flex flex-col items-end space-y-2"></div>'),qK=Ve("<!> <!> <!> <!>",1);function XK(r,e){zt(e,!0);const t=14,n=.5,i="rentals-stations",l="rentals-vehicles",u=50,a="rentals-zones",p="rentals-zones-outline",y=Object.keys(qc);let x=Pt(null),T=Pt(null),E=0,k=Pt(null);const F=y.map(qe=>{const $e=qe.toLowerCase();return{formFactor:qe,sourceId:`${l}-${$e}`,clusterLayerId:`${l}-${$e}-cluster`,pointLayerId:`${l}-${$e}-point`}}),D=qe=>qe.flatMap($e=>$e.formFactors.map(dt=>({providerId:$e.id,providerName:$e.name,formFactor:dt}))).sort(($e,dt)=>$e.providerName.localeCompare(dt.providerName,void 0,{sensitivity:"base"})||$e.formFactor.localeCompare(dt.formFactor,void 0,{sensitivity:"base"}));let N=Re(()=>A(x)?D(A(x).providers):[]);const B=(qe,$e)=>(qe==null?void 0:qe.providerId)===($e==null?void 0:$e.providerId)&&(qe==null?void 0:qe.formFactor)===($e==null?void 0:$e.formFactor),V=qe=>{ve(k,B(A(k),qe)?null:qe,!0)},U=(qe,$e,dt)=>Math.min(dt,Math.max($e,qe)),j=qe=>{const $e=qe.getSouthWest(),dt=qe.getNorthEast(),xt=(dt.lng-$e.lng)*n,at=(dt.lat-$e.lat)*n;return new wi.LngLatBounds([U($e.lng-xt,-180,180),U($e.lat-at,-90,90)],[U(dt.lng+xt,-180,180),U(dt.lat+at,-90,90)])},J=(qe,$e)=>!!qe&&qe.contains($e.getSouthWest())&&qe.contains($e.getNorthEast()),oe=async qe=>{const $e=j(qe),dt=hc($e.getNorthWest()),xt=hc($e.getSouthEast()),at=++E;console.debug("[Rentals] requesting rentals",{min:xt,max:dt});const{data:Dt,error:br}=await OM({query:{max:dt,min:xt}});if(at!==E)return;if(br){console.error("[Rentals] rentals request failed",br);return}ve(x,Dt,!0),ve(T,$e,!0);const tn=Dt;console.debug("[Rentals] received rentals",{providers:tn.providers.length,stations:tn.stations.length,vehicles:tn.vehicles.length,zones:tn.zones.length})};Xr(()=>{if(!e.map||!e.bounds||e.zoom<=t){ve(x,null),ve(T,null),E+=1;return}const qe=wi.LngLatBounds.convert(e.bounds);J(A(T),qe)||oe(qe)}),Xr(()=>{A(k)&&!A(N).some(qe=>B(qe,A(k)))&&ve(k,null)}),oc(()=>{E+=1});const le=(qe,$e,dt)=>!dt||!$e?qe.numVehiclesAvailable:Object.entries(qe.vehicleTypesAvailable).reduce((xt,[at,Dt])=>$e.get(at)===dt.formFactor?xt+Dt:xt,0);let Ce=Re(()=>{var xt;if(!A(x))return{type:"FeatureCollection",features:[]};const qe=A(k),$e=qe?A(x).stations.filter(at=>at.providerId===qe.providerId&&at.formFactors.includes(qe.formFactor)):A(x).stations,dt=qe?new Map(((xt=A(x).providers.find(at=>at.id===qe.providerId))==null?void 0:xt.vehicleTypes.map(at=>[at.id,at.formFactor]))??[]):null;return{type:"FeatureCollection",features:$e.map(at=>({type:"Feature",geometry:{type:"Point",coordinates:[at.lon,at.lat]},properties:{icon:qc[qe?qe.formFactor:at.formFactors[0]??IK].station,available:le(at,dt,qe),providerId:at.providerId,stationId:at.id}}))}}),Ie=Re(()=>{const qe=y.reduce((xt,at)=>(xt[at]={type:"FeatureCollection",features:[]},xt),{});if(!A(x))return qe;const $e=A(k);return($e?A(x).vehicles.filter(xt=>xt.providerId===$e.providerId&&xt.formFactor===$e.formFactor):A(x).vehicles).filter(xt=>!xt.stationId).forEach(xt=>{qe[xt.formFactor].features.push({type:"Feature",geometry:{type:"Point",coordinates:[xt.lon,xt.lat]},properties:{icon:qc[xt.formFactor].vehicle,providerId:xt.providerId,vehicleId:xt.id}})}),qe});const Ue=qe=>({type:"MultiPolygon",coordinates:qe.area.map($e=>$e.map(dt=>tu.decode(dt.points,dt.precision).map(([xt,at])=>[at,xt])))}),De=(qe,$e,dt)=>qe.rules.find(xt=>xt.vehicleTypeIdxs.length?xt.vehicleTypeIdxs.some(at=>{var Dt;return((Dt=$e.vehicleTypes[at])==null?void 0:Dt.formFactor)===dt}):!0);let pe=Re(()=>{var dt,xt;const qe=[],$e=(xt=(dt=A(x))==null?void 0:dt.providers)==null?void 0:xt.find(at=>{var Dt;return at.id===((Dt=A(k))==null?void 0:Dt.providerId)});if(!A(x)||!A(k)||!$e)return{type:"FeatureCollection",features:qe};for(let at=0;at<A(x).zones.length;++at){const Dt=A(x).zones[at];if(Dt.providerId!==A(k).providerId)continue;const br=De(Dt,$e,A(k).formFactor);br&&qe.push({type:"Feature",geometry:Ue(Dt),properties:{zoneIndex:at,providerId:Dt.providerId,z:Dt.z,rideEndAllowed:br.rideEndAllowed&&!br.stationParking,rideThroughAllowed:br.rideThroughAllowed}})}return{type:"FeatureCollection",features:qe}});const ze=(qe,$e)=>`${qe}::${$e}`;let Ne=Re(()=>{var qe;return new Map(((qe=A(x))==null?void 0:qe.providers.map($e=>[$e.id,$e]))??[])}),ot=Re(()=>{var qe;return new Map(((qe=A(x))==null?void 0:qe.stations.map($e=>[ze($e.providerId,$e.id),$e]))??[])}),At=Re(()=>{var qe;return new Map(((qe=A(x))==null?void 0:qe.vehicles.map($e=>[ze($e.providerId,$e.id),$e]))??[])});const Qe=qe=>{const $e=ze(qe.providerId,qe.stationId);return{key:$e,provider:A(Ne).get(qe.providerId),station:A(ot).get($e)}},pt=qe=>{const $e=ze(qe.providerId,qe.vehicleId);return{key:$e,provider:A(Ne).get(qe.providerId),vehicle:A(At).get($e)}},_t=qe=>{var dt;const $e=(dt=A(x))==null?void 0:dt.zones[qe.zoneIndex];return{key:String(qe.zoneIndex),provider:A(Ne).get(qe.providerId),zone:$e,rideThroughAllowed:qe.rideThroughAllowed,rideEndAllowed:qe.rideEndAllowed}},Lt=(qe,$e,dt)=>{const xt=document.createElement("div"),at=hy(RK,{target:xt,props:{provider:qe,station:$e,showActions:dt}});return{element:xt,destroy:()=>{dy(at)}}},Ht=(qe,$e,dt)=>{const xt=document.createElement("div"),at=hy(OK,{target:xt,props:{provider:qe,vehicle:$e,showActions:dt}});return{element:xt,destroy:()=>{dy(at)}}},ar=(qe,$e,dt,xt)=>{const at=document.createElement("div"),Dt=hy(BK,{target:at,props:{provider:qe,zone:$e,rideThroughAllowed:dt,rideEndAllowed:xt}});return{element:at,destroy:()=>{dy(Dt)}}};let Tt=null,Sr=null,Et=null,Or=null,ir=null,vr=null,ur=null;const kr=()=>(Tt||(Tt=new wi.Popup({closeButton:!1,closeOnClick:!1,offset:12}),Tt.on("close",()=>{vr==null||vr(),vr=null,Et=null})),Tt),nn=()=>(Sr||(Sr=new wi.Popup({closeButton:!0,closeOnClick:!0,offset:12}),Sr.on("close",()=>{ur==null||ur(),ur=null,Or=null})),Sr),pr=()=>{vr==null||vr(),vr=null,Tt&&Tt.remove(),Et=null},Hr=()=>{ur==null||ur(),ur=null,Sr&&Sr.remove(),Or=null},Nr=()=>{ir&&(ir.style.cursor="",ir=null)},mt=(qe,$e,dt,xt)=>{const at=kr();if(Et!==dt){vr==null||vr();const{element:Dt,destroy:br}=xt();vr=br,at.setDOMContent(Dt),Et=dt}at.setLngLat($e),at.isOpen()||at.addTo(qe)},Te=(qe,$e,dt,xt)=>{const at=nn();ur==null||ur();const{element:Dt,destroy:br}=xt();ur=br,at.setDOMContent(Dt),at.setLngLat($e),at.isOpen()||at.addTo(qe),Or=dt},Qt=(qe,$e)=>(dt,xt)=>{var tn;const at=(tn=dt.features)==null?void 0:tn[0];if(!xt||!at){pr(),Nr();return}const Dt=qe(at.properties),br=Dt.station||Dt.vehicle;if(!br||!Dt.provider){pr(),Nr();return}if(ir=xt.getCanvas(),ir.style.cursor="pointer",Or===Dt.key){pr();return}mt(xt,dt.lngLat,Dt.key,()=>$e(Dt.provider,br))},Ct=()=>(qe,$e)=>{Nr(),pr()},yt=(qe,$e)=>(dt,xt)=>{var tn;const at=(tn=dt.features)==null?void 0:tn[0];if(!xt||!at){Hr();return}const Dt=qe(at.properties),br=Dt.station||Dt.vehicle;if(!br||!Dt.provider){Hr();return}pr(),Hr(),Te(xt,dt.lngLat,Dt.key,()=>$e(Dt.provider,br))},sr=Qt(Qe,(qe,$e)=>Lt(qe,$e,!0)),Br=Ct(),$r=yt(Qe,(qe,$e)=>Lt(qe,$e,!0)),Jt=Qt(pt,(qe,$e)=>Ht(qe,$e,!0)),Zt=Ct(),Ar=yt(pt,(qe,$e)=>Ht(qe,$e,!0)),Fr=(qe,$e)=>{var tn;if(!$e)return;const dt=F.map(pn=>pn.pointLayerId),xt=[i,...dt];if($e.queryRenderedFeatures(qe.point,{layers:xt}).length>0)return;const Dt=(tn=qe.features)==null?void 0:tn[0];if(!Dt){Hr();return}const br=_t(Dt.properties);if(!br.zone||!br.provider){Hr();return}pr(),Hr(),Te($e,qe.lngLat,br.key,()=>ar(br.provider,br.zone,br.rideThroughAllowed,br.rideEndAllowed))};Xr(()=>{if(!A(x)){pr(),Hr(),Nr();return}Et&&!A(ot).has(Et)&&!A(At).has(Et)&&pr(),Or&&!A(ot).has(Or)&&!A(At).has(Or)&&Hr()}),oc(()=>{pr(),Hr(),Nr(),Tt=null,Sr=null});var Jr=qK(),bt=xe(Jr);{var zr=qe=>{const $e=Re(()=>{var dt;return((dt=F[0])==null?void 0:dt.pointLayerId)??i});ua(qe,{id:a,get data(){return A(pe)},children:(dt,xt)=>{var at=VK(),Dt=xe(at);Ci(Dt,{id:a,get beforeLayerId(){return A($e)},type:"fill",filter:!0,layout:{"fill-sort-key":["get","z"]},onclick:Fr,paint:{"fill-color":["case",["==",["get","rideEndAllowed"],!0],"#22c55e",["==",["get","rideThroughAllowed"],!1],"#ef4444","#f97316"],"fill-opacity":.3}});var br=we(Dt,2);Ci(br,{id:p,get beforeLayerId(){return A($e)},type:"line",filter:!0,layout:{},paint:{"line-color":["case",["==",["get","rideEndAllowed"],!0],"#15803d",["==",["get","rideThroughAllowed"],!1],"#b91c1c","#c2410c"],"line-width":3,"line-opacity":.9}}),K(dt,at)},$$slots:{default:!0}})};et(bt,qe=>{A(pe).features.length>0&&qe(zr)})}var Mr=we(bt,2);ua(Mr,{id:i,get data(){return A(Ce)},children:(qe,$e)=>{Ci(qe,{id:i,beforeLayerId:"",type:"symbol",filter:!0,layout:{"icon-image":["get","icon"],"icon-size":w0,"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["to-string",["get","available"]],"text-allow-overlap":!0,"text-ignore-placement":!0,"text-anchor":"center","text-offset":LE,"text-size":LK,"text-font":["Noto Sans Display Regular"]},onmousemove:sr,onmouseleave:Br,onclick:$r,paint:{"icon-opacity":1,"text-color":"#1e293b","text-halo-color":"#ffffff","text-halo-width":1.5}})},$$slots:{default:!0}});var Zr=we(Mr,2);jn(Zr,17,()=>F,qe=>qe.sourceId,(qe,$e)=>{ua(qe,{get id(){return A($e).sourceId},get data(){return A(Ie)[A($e).formFactor]},options:{cluster:!0,clusterRadius:u},children:(dt,xt)=>{var at=jK(),Dt=xe(at);const br=Re(()=>({"icon-image":qc[A($e).formFactor].cluster,"icon-size":w0,"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-field":["to-string",["get","point_count"]],"text-allow-overlap":!0,"text-ignore-placement":!0,"text-anchor":"center","text-offset":LE,"text-size":zK,"text-font":["Noto Sans Display Regular"]}));Ci(Dt,{get id(){return A($e).clusterLayerId},beforeLayerId:i,type:"symbol",filter:["has","point_count"],get layout(){return A(br)},paint:{"icon-opacity":1,"text-color":"#1e293b","text-halo-color":"#ffffff","text-halo-width":1.5}});var tn=we(Dt,2);const pn=Re(()=>({"icon-image":qc[A($e).formFactor].vehicle,"icon-size":w0,"icon-allow-overlap":!0,"icon-ignore-placement":!0}));Ci(tn,{get id(){return A($e).pointLayerId},beforeLayerId:i,type:"symbol",filter:["!",["has","point_count"]],get layout(){return A(pn)},onmousemove:Jt,onmouseleave:Zt,onclick:Ar,paint:{}}),K(dt,at)},$$slots:{default:!0}})});var xn=we(Zr,2);{var Ot=qe=>{wo(qe,{position:"bottom-right",class:"mb-5",children:($e,dt)=>{var xt=$K();jn(xt,21,()=>A(N),at=>`${at.providerId}::${at.formFactor}`,(at,Dt)=>{var br=WK();const tn=Re(()=>B(A(k),A(Dt)));br.__click=[HK,V,Dt];var pn=Be(br),de=Be(pn,!0);ke(pn);var X=we(pn,2),Y=Be(X),te=Be(Y);ke(Y),ke(X),ke(br),ct(he=>{ls(br,"title",`${A(Dt).providerName} (${qc[A(Dt).formFactor].label})`),Di(br,1,he),ls(br,"aria-pressed",A(tn)),vt(de,A(Dt).providerName),ls(te,"href",`#${qc[A(Dt).formFactor].svg}`)},[()=>rl(kn("inline-flex max-w-sm items-center gap-2 rounded-md border-2 px-3 py-1.5 text-sm font-semibold transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500",A(tn)?"border-blue-600 bg-accent text-accent-foreground":"border-muted bg-popover text-foreground hover:bg-accent hover:text-accent-foreground"))]),K(at,br)}),ke(xt),K($e,xt)},$$slots:{default:!0}})};et(xn,qe=>{A(N).length>0&&qe(Ot)})}K(r,Jr),Ut()}pc(["click"]);var ZK=Ve("<!> <!>",1);function YK(r,e){zt(e,!0);function t(i){return{type:"FeatureCollection",features:i.filter(l=>l.mode!=="WALK"&&l.mode!=="BIKE"&&l.mode!=="CAR").flatMap(l=>{const u=[{type:"Feature",geometry:{type:"Point",coordinates:[l.from.lon,l.from.lat]},properties:{stopId:l.from.stopId,name:l.from.name,time:l.from.arrival??l.from.departure,color:nc(l)[0]}},{type:"Feature",geometry:{type:"Point",coordinates:[l.to.lon,l.to.lat]},properties:{stopId:l.to.stopId,name:l.to.name,time:l.to.arrival,color:nc(l)[0]}}],a=l.intermediateStops?l.intermediateStops.map(p=>({type:"Feature",geometry:{type:"Point",coordinates:[p.lon,p.lat]},properties:{stopId:p.stopId,name:p.name,time:p.arrival,color:nc(l)[0]}})):[];return[...u,...a]})}}const n=Re(()=>t(e.itinerary.legs));ua(r,{id:"stops",get data(){return A(n)},children:(i,l)=>{var u=ZK(),a=xe(u);Ci(a,{id:"stops",type:"circle",layout:{},filter:["all"],paint:{"circle-radius":5,"circle-color":"white","circle-stroke-width":4,"circle-stroke-color":["get","color"]},onclick:x=>{var E,k;const T=(E=x.features)==null?void 0:E[0];(k=T==null?void 0:T.properties)!=null&&k.stopId&&(console.log("Clicked Stop:",T.properties.name),fd(T.properties.name,T.properties.stopId,new Date(T.properties.time)))},onmousemove:(x,T)=>T.getCanvas().style.cursor="pointer",onmouseleave:(x,T)=>T.getCanvas().style.cursor=""});var p=we(a,2);const y=Re(()=>({"text-halo-width":2,"text-halo-color":["interpolate-hcl",["linear"],.6,0,["get","color"],1,e.theme=="dark"?"#000":"#fff"],"text-color":e.theme=="dark"?"#fff":"#000"}));Ci(p,{id:"intermediate-stops-name",type:"symbol",layout:{"text-field":["get","name"],"text-font":["Noto Sans Display Regular"],"text-size":12,"text-offset":[0,1],"text-anchor":"top"},filter:!0,get paint(){return A(y)}}),K(i,u)},$$slots:{default:!0}}),Ut()}function KK(r,e){const t=ni(e,["children","$$slots","$$events","$$legacy"]);Ri(r,cn({name:"train-front"},()=>t,{iconNode:[["path",{d:"M8 3.1V7a4 4 0 0 0 8 0V3.1"}],["path",{d:"m9 15-1-1"}],["path",{d:"m15 15 1-1"}],["path",{d:"M9 19c-2.8 0-5-2.2-5-5v-4a8 8 0 0 1 16 0v4c0 2.8-2.2 5-5 5Z"}],["path",{d:"m8 19-2 3"}],["path",{d:"m16 19 2 3"}]],children:(i,l)=>{var u=it(),a=xe(u);fi(a,e,"default",{}),K(i,u)},$$slots:{default:!0}}))}var GK=Ve("<!> <!>",1),JK=Ve("<!> <!> <!>",1),QK=Ve("<!> <!> <!> <!>",1),eG=Ve('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"> </h2> <!></div> <div><!></div>',1),tG=Ve("<!> <!>",1),rG=Ve("<!> <!>",1),nG=Ve('<div class="w-full flex justify-between items-center shadow-md pl-1 mb-1"><h2 class="ml-2 text-base font-semibold"><!> </h2> <!></div> <div class="p-2 md:p-4 overflow-y-auto overflow-x-hidden min-h-0 md:max-h-[60vh]"><!></div>',1),iG=Ve("<!> <!> <!> <!> <!>",1),sG=Ve('<div class="maplibregl-ctrl-top-left"><!></div>'),oG=Ve('| <a target="_blank"> </a>',1),aG=Ve("<!> <!>",1),lG=Ve("<!> <!>",1),cG=Ve("<!> <!>",1),uG=Ve("<!> <!> <!> <!> <!> <!> <!>",1),hG=Ve('<!> <!> <!> <div><div class="maplibregl-ctrl maplibregl-ctrl-attrib"><div class="maplibregl-ctrl-attrib-inner">&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> <!></div></div></div> <!>',1);function TG(r,e){zt(e,!0);const t=(dt,xt=Cr,at=Cr)=>{var Dt=it(),br=xe(Dt);{var tn=de=>{var X=GK(),Y=xe(X);Bn(Y,{variant:"outline",onclick:()=>{var he;ve(ze,Oi(xt().lngLat,A(V)>_y?A(B):void 0),!0),(he=A(Ie))==null||he.setLngLat(A(ze).match),at()()},children:(he,Se)=>{sn();var Oe=jr("From");K(he,Oe)},$$slots:{default:!0}});var te=we(Y,2);Bn(te,{variant:"outline",onclick:()=>{var he;ve(Ne,Oi(xt().lngLat,A(V)>_y?A(B):void 0),!0),(he=A(Ue))==null||he.setLngLat(A(Ne).match),at()()},children:(he,Se)=>{sn();var Oe=jr("To");K(he,Oe)},$$slots:{default:!0}}),K(de,X)},pn=(de,X)=>{{var Y=te=>{Bn(te,{variant:"outline",onclick:()=>{var he;ve(ot,Oi(xt().lngLat,A(V)>_y?A(B):void 0),!0),(he=A(De))==null||he.setLngLat(A(ot).match),at()()},children:(he,Se)=>{sn();var Oe=jr();ct(()=>vt(Oe,Rt.position)),K(he,Oe)},$$slots:{default:!0}})};et(de,te=>{A(y)=="isochrones"&&te(Y)},X)}};et(br,de=>{A(y)=="connections"?de(tn):de(pn,!1)})}K(dt,Dt)},n=dt=>{var xt=iG(),at=xe(xt);const Dt=Re(()=>p&&(ti.state.selectedItinerary||ti.state.selectedStop)?"hide":"");wo(at,{get class(){return A(Dt)},children:(Se,Oe)=>{var He=it(),ye=xe(He);Tr(ye,()=>uK,(We,ft)=>{ft(We,{class:"max-w-full w-[520px] overflow-y-auto",get value(){return A(y)},set value(Je){ve(y,Je,!0)},children:(Je,kt)=>{var Vt=QK(),Kt=xe(Vt);Tr(Kt,()=>cK,(gr,Yr)=>{Yr(gr,{class:"grid grid-cols-3",children:(Pr,Wt)=>{var Rr=JK(),Dr=xe(Rr);Tr(Dr,()=>x0,(Ur,Qr)=>{Qr(Ur,{value:"connections",children:(qr,In)=>{sn();var dn=jr();ct(()=>vt(dn,Rt.connections)),K(qr,dn)},$$slots:{default:!0}})});var It=we(Dr,2);Tr(It,()=>x0,(Ur,Qr)=>{Qr(Ur,{value:"departures",children:(qr,In)=>{sn();var dn=jr();ct(()=>vt(dn,Rt.departures)),K(qr,dn)},$$slots:{default:!0}})});var hn=we(It,2);Tr(hn,()=>x0,(Ur,Qr)=>{Qr(Ur,{value:"isochrones",children:(qr,In)=>{sn();var dn=jr();ct(()=>vt(dn,Rt.isochrones.title)),K(qr,dn)},$$slots:{default:!0}})}),K(Pr,Rr)},$$slots:{default:!0}})});var Wr=we(Kt,2);Tr(Wr,()=>b0,(gr,Yr)=>{Yr(gr,{value:"connections",children:(Pr,Wt)=>{oa(Pr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Rr,Dr)=>{n6(Rr,{get geocodingBiasPlace(){return A(N)},get from(){return A(ze)},set from(It){ve(ze,It,!0)},get to(){return A(Ne)},set to(It){ve(Ne,It,!0)},get time(){return A(Qe)},set time(It){ve(Qe,It,!0)},get arriveBy(){return A(ar)},set arriveBy(It){ve(ar,It,!0)},get useRoutedTransfers(){return A(Sr)},set useRoutedTransfers(It){ve(Sr,It,!0)},get maxTransfers(){return A(Hr)},set maxTransfers(It){ve(Hr,It,!0)},get pedestrianProfile(){return A(Et)},set pedestrianProfile(It){ve(Et,It,!0)},get requireCarTransport(){return A(ir)},set requireCarTransport(It){ve(ir,It,!0)},get requireBikeTransport(){return A(Or)},set requireBikeTransport(It){ve(Or,It,!0)},get transitModes(){return A(vr)},set transitModes(It){ve(vr,It,!0)},get preTransitModes(){return A(ur)},set preTransitModes(It){ve(ur,It,!0)},get postTransitModes(){return A(kr)},set postTransitModes(It){ve(kr,It,!0)},get directModes(){return A(nn)},set directModes(It){ve(nn,It,!0)},get elevationCosts(){return A(pr)},set elevationCosts(It){ve(pr,It,!0)},get maxPreTransitTime(){return A(mt)},set maxPreTransitTime(It){ve(mt,It,!0)},get maxPostTransitTime(){return A(Te)},set maxPostTransitTime(It){ve(Te,It,!0)},get maxDirectTime(){return A(Qt)},set maxDirectTime(It){ve(Qt,It,!0)},get ignorePreTransitRentalReturnConstraints(){return A(Ct)},set ignorePreTransitRentalReturnConstraints(It){ve(Ct,It,!0)},get ignorePostTransitRentalReturnConstraints(){return A(yt)},set ignorePostTransitRentalReturnConstraints(It){ve(yt,It,!0)},get ignoreDirectRentalReturnConstraints(){return A(sr)},set ignoreDirectRentalReturnConstraints(It){ve(sr,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})});var Er=we(Wr,2);Tr(Er,()=>b0,(gr,Yr)=>{Yr(gr,{value:"departures",children:(Pr,Wt)=>{oa(Pr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Rr,Dr)=>{dK(Rr,{get time(){return A(Qe)},set time(It){ve(Qe,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})});var wr=we(Er,2);Tr(wr,()=>b0,(gr,Yr)=>{Yr(gr,{value:"isochrones",children:(Pr,Wt)=>{oa(Pr,{class:"overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(Rr,Dr)=>{EK(Rr,{get geocodingBiasPlace(){return A(N)},get one(){return A(ot)},set one(It){ve(ot,It,!0)},get maxTravelTime(){return A(Nr)},set maxTravelTime(It){ve(Nr,It,!0)},get time(){return A(Qe)},set time(It){ve(Qe,It,!0)},get useRoutedTransfers(){return A(Sr)},set useRoutedTransfers(It){ve(Sr,It,!0)},get pedestrianProfile(){return A(Et)},set pedestrianProfile(It){ve(Et,It,!0)},get requireCarTransport(){return A(ir)},set requireCarTransport(It){ve(ir,It,!0)},get requireBikeTransport(){return A(Or)},set requireBikeTransport(It){ve(Or,It,!0)},get transitModes(){return A(vr)},set transitModes(It){ve(vr,It,!0)},get maxTransfers(){return A(Hr)},set maxTransfers(It){ve(Hr,It,!0)},get preTransitModes(){return A(ur)},set preTransitModes(It){ve(ur,It,!0)},get postTransitModes(){return A(kr)},set postTransitModes(It){ve(kr,It,!0)},get maxPreTransitTime(){return A(mt)},set maxPreTransitTime(It){ve(mt,It,!0)},get maxPostTransitTime(){return A(Te)},set maxPostTransitTime(It){ve(Te,It,!0)},get arriveBy(){return A(ar)},set arriveBy(It){ve(ar,It,!0)},get elevationCosts(){return A(pr)},set elevationCosts(It){ve(pr,It,!0)},get ignorePreTransitRentalReturnConstraints(){return A(Ct)},set ignorePreTransitRentalReturnConstraints(It){ve(Ct,It,!0)},get ignorePostTransitRentalReturnConstraints(){return A(yt)},set ignorePostTransitRentalReturnConstraints(It){ve(yt,It,!0)},get options(){return A(Jt)},set options(It){ve(Jt,It,!0)}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),K(Je,Vt)},$$slots:{default:!0}})}),K(Se,He)},$$slots:{default:!0}});var br=we(at,2);{var tn=Se=>{const Oe=Re(()=>ti.state.selectedItinerary?"hide":"");wo(Se,{get class(){return`min-h-0 md:mb-2 ${A(Oe)??""}`},children:(He,ye)=>{oa(He,{class:`scrollable w-[520px] h-full md:max-h-[60vh] ${p?"border-0 shadow-none":""} overflow-x-hidden bg-background rounded-lg mb-2`,children:(We,ft)=>{const Je=Re(()=>Z2(A(ze),A(Ne)));M6(We,{get baseResponse(){return A(zr)},get routingResponses(){return A(Mr)},get baseQuery(){return A(Fr)},selectItinerary:kt=>{tI("",{selectedItinerary:kt,scrollY:void 0})},get updateStartDest(){return A(Je)}})},$$slots:{default:!0}})},$$slots:{default:!0}})};et(br,Se=>{A(y)!="isochrones"&&A(Mr).length!==0&&!ti.state.showDepartures&&Se(tn)})}var pn=we(br,2);{var de=Se=>{var Oe=rG(),He=xe(Oe);wo(He,{class:"min-h-0 md:mb-2",children:(ft,Je)=>{oa(ft,{class:"w-[520px] md:max-h-[60vh] h-full bg-background rounded-lg flex flex-col mb-2",children:(kt,Vt)=>{var Kt=eG(),Wr=xe(Kt),Er=Be(Wr),wr=Be(Er,!0);ke(Er);var gr=we(Er,2);Bn(gr,{variant:"ghost",onclick:()=>{history.back()},children:(Wt,Rr)=>{tp(Wt,{})},$$slots:{default:!0}}),ke(Wr);var Yr=we(Wr,2),Pr=Be(Yr);k5(Pr,{get itinerary(){return ti.state.selectedItinerary}}),ke(Yr),ct(()=>{vt(wr,Rt.journeyDetails),Di(Yr,1,"p-2 md:p-4 overflow-y-auto overflow-x-hidden min-h-0 "+(A(E)?"md:max-h-[60vh]":""))}),K(kt,Kt)},$$slots:{default:!0}})},$$slots:{default:!0}});var ye=we(He,2);{var We=ft=>{var Je=tG(),kt=xe(Je);V5(kt,{get itinerary(){return ti.state.selectedItinerary},get level(){return A(B)}});var Vt=we(kt,2);YK(Vt,{get itinerary(){return ti.state.selectedItinerary},theme:D}),K(ft,Je)};et(ye,ft=>{A(E)&&ft(We)})}K(Se,Oe)};et(pn,Se=>{A(y)!="isochrones"&&ti.state.selectedItinerary&&!ti.state.showDepartures&&Se(de)})}var X=we(pn,2);{var Y=Se=>{wo(Se,{class:"min-h-0 md:mb-2",children:(Oe,He)=>{oa(Oe,{class:"w-[520px] md:max-h-[60vh] h-full bg-background rounded-lg flex flex-col mb-2",children:(ye,We)=>{var ft=nG(),Je=xe(ft),kt=Be(Je),Vt=Be(kt);{var Kt=Pr=>{var Wt=jr();ct(()=>vt(Wt,Rt.arrivals)),K(Pr,Wt)},Wr=Pr=>{var Wt=jr();ct(()=>vt(Wt,Rt.departures)),K(Pr,Wt)};et(Vt,Pr=>{ti.state.stopArriveBy?Pr(Kt):Pr(Wr,!1)})}var Er=we(Vt);ke(kt);var wr=we(kt,2);Bn(wr,{variant:"ghost",onclick:()=>{history.back()},children:(Pr,Wt)=>{tp(Pr,{})},$$slots:{default:!0}}),ke(Je);var gr=we(Je,2),Yr=Be(gr);LU(Yr,{get stopId(){return ti.state.selectedStop.stopId},get stopName(){return ti.state.selectedStop.name},get time(){return ti.state.selectedStop.time},get arriveBy(){return ti.state.stopArriveBy},get stop(){return A(At)},set stop(Pr){ve(At,Pr,!0)},get stopMarker(){return A(pe)},set stopMarker(Pr){ve(pe,Pr,!0)},get stopNameFromResponse(){return A(Zr)},set stopNameFromResponse(Pr){ve(Zr,Pr,!0)}}),ke(gr),ct(()=>vt(Er,` in
						${A(Zr)??""}`)),K(ye,ft)},$$slots:{default:!0}})},$$slots:{default:!0}})};et(X,Se=>{A(y)!="isochrones"&&ti.state.selectedStop&&ti.state.showDepartures&&Se(Y)})}var te=we(X,2);{var he=Se=>{const Oe=Re(()=>A(Jt).status=="DONE"?"hide":"");wo(Se,{get class(){return`min-h-0 md:mb-2 ${A(Oe)??""}`},children:(He,ye)=>{oa(He,{class:"w-[520px] overflow-y-auto overflow-x-hidden bg-background rounded-lg",children:(We,ft)=>{yK(We,{get options(){return A(Jt)}})},$$slots:{default:!0}})},$$slots:{default:!0}})};et(te,Se=>{A(y)=="isochrones"&&A(ot).match&&Se(he)})}K(dt,xt)},i=new URLSearchParams(window.location.search),l=!!(i!=null&&i.has("debug")),u=!!(i!=null&&i.has("dark")),a=!!(i!=null&&i.has("light")),p=window.innerWidth<768;let y=Pt("connections"),x=Pt(void 0),T=Pt("route"),E=Pt(!p),k,F,D=(u?"dark":a?"light":void 0)??(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");D==="dark"&&document.documentElement.classList.add("dark");let N=Pt([2.258882912876089,48.72559118651327]),B=Pt(0),V=Pt(15),U=Pt(void 0),j=Pt(void 0);const J=new wi.GeolocateControl({positionOptions:{enableHighAccuracy:!0},showAccuracyCircle:!1}),oe=()=>{J.trigger()};Dm(async()=>{DM().then(dt=>{dt.response.headers.has("Link")&&ve(x,dt.response.headers.get("Link").replace(/^<(.*)>; rel="license"$/,"$1"),!0);const xt=dt.data;xt&&(ve(N,[xt.lon,xt.lat]),ve(V,xt.zoom,!0))}),await Nw(),le()});const le=()=>{if(i&&(i.has("tripId")&&fp(i.get("tripId"),!0),i.has("stopId"))){const dt=i.has("time")?new Date(i.get("time")):new Date;fd("",i.get("stopId"),dt,i.get("stopArriveBy")=="true",!0)}};function Ce(dt,xt){if(dt){const at=parseInt(dt);return isNaN(at)?xt:at}else return xt}let Ie=Pt(void 0),Ue=Pt(void 0),De=Pt(void 0),pe=Pt(void 0),ze=Pt(yn(Nx(i==null?void 0:i.get("fromPlace"),i==null?void 0:i.get("fromName")))),Ne=Pt(yn(Nx(i==null?void 0:i.get("toPlace"),i==null?void 0:i.get("toName")))),ot=Pt(yn(Nx(i==null?void 0:i.get("one"),i==null?void 0:i.get("oneName")))),At=Pt(void 0),Qe=Pt(yn(new Date((i==null?void 0:i.get("time"))||Date.now()))),pt=(i==null?void 0:i.get("timetableView"))!="false",_t=yn(i!=null&&i.get("searchWindow")?parseInt(i.get("searchWindow")):xi.searchWindow),Lt=yn(i!=null&&i.get("numItineraries")?Ce(i.get("numItineraries"),xi.numItineraries):xi.numItineraries),Ht=yn(i!=null&&i.get("maxItineraries")?Ce(i.get("maxItineraries"),void 0):void 0),ar=Pt((i==null?void 0:i.get("arriveBy"))=="true"),Tt=yn((i==null?void 0:i.get("algorithm"))??"RAPTOR"),Sr=Pt(yn((i==null?void 0:i.get("useRoutedTransfers"))=="true"||xi.useRoutedTransfers)),Et=Pt(yn(i!=null&&i.has("pedestrianProfile")?i.get("pedestrianProfile"):xi.pedestrianProfile)),Or=Pt((i==null?void 0:i.get("requireBikeTransport"))=="true"),ir=Pt((i==null?void 0:i.get("requireCarTransport"))=="true"),vr=Pt(yn(Hc("transitModes",xi.transitModes))),ur=Pt(yn(Fx(Hc("preTransitModes",xi.preTransitModes),Hc("preTransitRentalFormFactors")))),kr=Pt(yn(Fx(Hc("postTransitModes",xi.postTransitModes),Hc("postTransitRentalFormFactors")))),nn=Pt(yn(Fx(Hc("directModes",xi.directModes),Hc("directRentalFormFactors")))),pr=Pt(yn((i==null?void 0:i.get("elevationCosts"))??"NONE")),Hr=Pt(yn(Ce(i==null?void 0:i.get("maxTransfers"),xi.maxTransfers))),Nr=Pt(yn(Ce(i==null?void 0:i.get("maxTravelTime"),xi.maxTravelTime))),mt=Pt(yn(Ce(i==null?void 0:i.get("maxPreTransitTime"),xi.maxPreTransitTime))),Te=Pt(yn(Ce(i==null?void 0:i.get("maxPostTransitTime"),xi.maxPostTransitTime))),Qt=Pt(yn(Ce(i==null?void 0:i.get("maxDirectTime"),xi.maxDirectTime))),Ct=Pt((i==null?void 0:i.get("ignorePreTransitRentalReturnConstraints"))=="true"),yt=Pt((i==null?void 0:i.get("ignorePostTransitRentalReturnConstraints"))=="true"),sr=Pt((i==null?void 0:i.get("ignoreDirectRentalReturnConstraints"))=="true"),Br=(i==null?void 0:i.get("slowDirect"))=="true",$r=Pt(yn([])),Jt=Pt(yn({displayLevel:(i==null?void 0:i.get("isochronesDisplayLevel"))??xi.isochronesDisplayLevel,color:(i==null?void 0:i.get("isochronesColor"))??xi.isochronesColor,opacity:Ce(i==null?void 0:i.get("isochronesOpacity"),xi.isochronesOpacity),status:"DONE",error:void 0}));const Zt=i!=null&&i.get("isochronesCircleResolution")?Ce(i.get("isochronesCircleResolution"),xi.circleResolution):xi.circleResolution,Ar=dt=>{var xt,at;return((xt=dt.match)==null?void 0:xt.type)==="STOP"?dt.match.id:(at=dt.match)!=null&&at.level?`${hc(dt.match)},${dt.match.level}`:`${hc(dt.match)}`};let Fr=Re(()=>A(ze).match&&A(Ne).match?{query:Oz({time:A(Qe).toISOString(),fromPlace:Ar(A(ze)),toPlace:Ar(A(Ne)),arriveBy:A(ar),timetableView:pt,searchWindow:_t,numItineraries:Lt,maxItineraries:Ht,withFares:!0,slowDirect:Br,fastestDirectFactor:1.5,pedestrianProfile:A(Et),joinInterlinedLegs:!1,transitModes:A(vr).length==Ny.length?xi.transitModes:A(vr),preTransitModes:Ff(A(ur)),postTransitModes:Ff(A(kr)),directModes:Ff(A(nn)),preTransitRentalFormFactors:Bx(A(ur)),postTransitRentalFormFactors:Bx(A(kr)),directRentalFormFactors:Bx(A(nn)),requireBikeTransport:A(Or),requireCarTransport:A(ir),elevationCosts:A(pr),useRoutedTransfers:A(Sr),maxTransfers:A(Hr),maxMatchingDistance:A(Et)=="WHEELCHAIR"?8:250,maxPreTransitTime:A(mt),maxPostTransitTime:A(Te),maxDirectTime:A(Qt),ignorePreTransitRentalReturnConstraints:A(Ct),ignorePostTransitRentalReturnConstraints:A(yt),ignoreDirectRentalReturnConstraints:A(sr),algorithm:Tt})}:void 0),Jr=Re(()=>{var dt;return(dt=A(ot))!=null&&dt.match?{query:{one:Ar(A(ot)),maxTravelTime:Math.ceil(A(Nr)/60),time:A(Qe).toISOString(),transitModes:A(vr),maxTransfers:A(Hr),arriveBy:A(ar),useRoutedTransfers:A(Sr),pedestrianProfile:A(Et),requireBikeTransport:A(Or),requireCarTransport:A(ir),preTransitModes:Ff(A(ur)),postTransitModes:Ff(A(kr)),maxPreTransitTime:A(mt),maxPostTransitTime:A(Te),elevationCosts:A(pr),maxMatchingDistance:A(Et)=="WHEELCHAIR"?8:250,ignorePreTransitRentalReturnConstraints:A(Ct),ignorePostTransitRentalReturnConstraints:A(yt)}}:void 0}),bt,zr=Pt(void 0),Mr=Pt(yn([])),Zr=Pt("");Xr(()=>{A(Fr)&&A(y)=="connections"&&(clearTimeout(bt),bt=setTimeout(()=>{const dt=Fw(A(Fr)).then(Z2(A(ze),A(Ne))),xt=A(Fr).query;ve(zr,dt,!0),ve(Mr,[dt],!0),Ey({...xt,...xt.fromPlace==A(ze).label?{}:{fromName:A(ze).label},...xt.toPlace==A(Ne).label?{}:{toName:A(Ne).label}},{},!0)},400))});let xn;Xr(()=>{if(A(Jr)&&A(y)=="isochrones"){const[dt,xt,at]=[A(Jt).color,A(Jt).opacity,A(Jt).displayLevel];F!=A(Jr)&&(F=A(Jr),clearTimeout(xn),A(Jt).status="WORKING",A(Jt).error=void 0,xn=setTimeout(()=>{NM(A(Jr)).then(Dt=>{if(Dt.error){const tn=Dt.error.error;throw new Error(String(tn))}const br=Dt.data.all.map(tn=>{var pn,de,X;return{lat:(pn=tn.place)==null?void 0:pn.lat,lng:(de=tn.place)==null?void 0:de.lon,seconds:A(Nr)-60*(tn.duration??0),name:(X=tn.place)==null?void 0:X.name}});ve($r,[...br],!0),A(Jt).status=A($r).length==0?"EMPTY":"WORKING"}).catch(Dt=>{A(Jt).status="FAILED",A(Jt).error=Dt.message})},60)),fo(()=>{const Dt=A(Jr).query;Ey({...Dt,...Dt.one==A(ot).label?{}:{oneName:A(ot).label},maxTravelTime:Dt.maxTravelTime*60,isochronesColor:dt,isochronesOpacity:xt,isochronesDisplayLevel:at,...Zt&&Zt>2?{isochronesCircleResolution:Zt}:{}},{},!0)})}}),addEventListener("paste",dt=>{const xt=dt.clipboardData.getData("text"),at=JSON.parse(xt);console.log("paste: ",at);const Dt=new Promise((br,tn)=>{br(at)});ve(zr,Dt,!0),ve(Mr,[Dt],!0)});const Ot=()=>{if(k!==ti.state.selectedItinerary){if(ti.state.selectedItinerary&&A(j)){const dt=wi.LngLat.convert(ti.state.selectedItinerary.legs[0].from),xt=new wi.LngLatBounds(dt,dt);ti.state.selectedItinerary.legs.forEach(Dt=>{var br;xt.extend(Dt.from),xt.extend(Dt.to),(br=Dt.intermediateStops)==null||br.forEach(tn=>{xt.extend(tn)})});const at={top:96,right:96,bottom:p?window.innerHeight*.3:96,left:p?96:640};A(j).flyTo({...A(j).cameraForBounds(xt,{padding:at})})}k=ti.state.selectedItinerary}};Xr(()=>{A(j)&&A(j).addControl(J)}),Xr(Ot);const qe=Re(()=>kn("h-dvh overflow-clip",D)),$e=Re(()=>A(E)?nO(D,A(B)):void 0);oO(r,{transformRequest:dt=>{if(dt.startsWith("/sprite"))return{url:new URL(dt.slice(1),window.location.href).toString()};if(dt.startsWith("/"))return{url:`${rI.getConfig().baseUrl}/tiles${dt}`}},get class(){return A(qe)},get style(){return A($e)},attribution:!1,get map(){return A(j)},set map(dt){ve(j,dt,!0)},get bounds(){return A(U)},set bounds(dt){ve(U,dt,!0)},get zoom(){return A(V)},set zoom(dt){ve(V,dt,!0)},get center(){return A(N)},set center(dt){ve(N,dt)},children:(dt,xt)=>{var at=hG(),Dt=xe(at);{var br=ye=>{wo(ye,{position:"top-right",children:(We,ft)=>{bU(We,{get bounds(){return A(U)},get level(){return A(B)},get zoom(){return A(V)}})},$$slots:{default:!0}})};et(Dt,ye=>{l&&ye(br)})}var tn=we(Dt,2);wU(tn,{get bounds(){return A(U)},get zoom(){return A(V)},get level(){return A(B)},set level(ye){ve(B,ye,!0)}});var pn=we(tn,2);{var de=ye=>{var We=it(),ft=xe(We);{var Je=Vt=>{SU(Vt,{class:"relative z-10 h-full mt-5 flex flex-col",get showMap(){return A(E)},set showMap(Kt){ve(E,Kt,!0)},children:(Kt,Wr)=>{n(Kt)},$$slots:{default:!0}})},kt=Vt=>{var Kt=sG(),Wr=Be(Kt);n(Wr),ke(Kt),K(Vt,Kt)};et(ft,Vt=>{p?Vt(Je):Vt(kt,!1)})}K(ye,We)};et(pn,ye=>{ye(de)})}var X=we(pn,2);Di(X,1,`maplibregl-ctrl-${p?"top-left":"bottom-right"}`);var Y=Be(X),te=Be(Y),he=we(Be(te),3);{var Se=ye=>{var We=oG(),ft=we(xe(We)),Je=Be(ft,!0);ke(ft),ct(()=>{ls(ft,"href",A(x)),vt(Je,Rt.timetableSources)}),K(ye,We)};et(he,ye=>{A(x)&&ye(Se)})}ke(te),ke(Y),ke(X);var Oe=we(X,2);{var He=ye=>{var We=uG(),ft=xe(We);{var Je=Ur=>{var Qr=cG(),qr=xe(Qr);wo(qr,{position:"top-right",class:"pb-4",children:(wn,Cn)=>{var vi=aG(),Sn=xe(vi);Bn(Sn,{size:"icon",onclick:()=>{ve(T,function(){switch(A(T)){case"rt":return"route";case"route":return"mode";case"mode":return"none";case"none":return"rt"}}(),!0)},children:(Ps,zs)=>{var Ln=it(),ki=xe(Ln);{var Ni=cs=>{eO(cs,{class:"h-[1.2rem] w-[1.2rem]"})},Hn=(cs,Wi)=>{{var ko=$i=>{KK($i,{class:"h-[1.2rem] w-[1.2rem]"})},Fi=($i,Xo)=>{{var Us=ln=>{tO(ln,{class:"h-[1.2rem] w-[1.2rem]"})},ms=ln=>{QM(ln,{class:"h-[1.2rem] w-[1.2rem]"})};et($i,ln=>{A(T)=="none"?ln(Us):ln(ms,!1)},Xo)}};et(cs,$i=>{A(T)=="mode"?$i(ko):$i(Fi,!1)},Wi)}};et(ki,cs=>{A(T)=="rt"?cs(Ni):cs(Hn,!1)})}K(Ps,Ln)},$$slots:{default:!0}});var si=we(Sn,2);Bn(si,{size:"icon",onclick:()=>oe(),children:(Ps,zs)=>{Lw(Ps,{class:"w-5 h-5"})},$$slots:{default:!0}}),K(wn,vi)},$$slots:{default:!0}});var In=we(qr,2);{var dn=wn=>{var Cn=lG(),vi=xe(Cn);lK(vi,{get map(){return A(j)},get bounds(){return A(U)},get zoom(){return A(V)},get colorMode(){return A(T)}});var Sn=we(vi,2);XK(Sn,{get map(){return A(j)},get bounds(){return A(U)},get zoom(){return A(V)}}),K(wn,Cn)};et(In,wn=>{A(T)!="none"&&wn(dn)})}K(Ur,Qr)};et(ft,Ur=>{A(y)!="isochrones"&&Ur(Je)})}var kt=we(ft,2);const Vt=Re(()=>A(ar)?A(ur):A(kr)),Kt=Re(()=>A(Et)==="WHEELCHAIR"),Wr=Re(()=>A(ar)?A(mt):A(Te)),Er=Re(()=>A(y)=="isochrones");gK(kt,{get map(){return A(j)},get bounds(){return A(U)},get isochronesData(){return A($r)},get streetModes(){return A(Vt)},get wheelchair(){return A(Kt)},get maxAllTime(){return A(Wr)},circleResolution:Zt,get active(){return A(Er)},get options(){return A(Jt)},set options(Ur){ve(Jt,Ur,!0)}});var wr=we(kt,2);Hl(wr,{trigger:"contextmenu",children:t});var gr=we(wr,2);{var Yr=Ur=>{_h(Ur,{color:"green",draggable:!0,get level(){return A(B)},get location(){return A(ze)},set location(Qr){ve(ze,Qr,!0)},get marker(){return A(Ie)},set marker(Qr){ve(Ie,Qr,!0)}})};et(gr,Ur=>{A(ze)&&A(y)=="connections"&&Ur(Yr)})}var Pr=we(gr,2);{var Wt=Ur=>{_h(Ur,{color:"black",draggable:!1,get level(){return A(B)},get location(){return A(At)},set location(Qr){ve(At,Qr,!0)},get marker(){return A(pe)},set marker(Qr){ve(pe,Qr,!0)}})};et(Pr,Ur=>{A(At)&&ti.state.showDepartures&&A(y)!="isochrones"&&Ur(Wt)})}var Rr=we(Pr,2);{var Dr=Ur=>{_h(Ur,{color:"red",draggable:!0,get level(){return A(B)},get location(){return A(Ne)},set location(Qr){ve(Ne,Qr,!0)},get marker(){return A(Ue)},set marker(Qr){ve(Ue,Qr,!0)}})};et(Rr,Ur=>{A(Ne)&&A(y)=="connections"&&Ur(Dr)})}var It=we(Rr,2);{var hn=Ur=>{_h(Ur,{color:"yellow",draggable:!0,get level(){return A(B)},get location(){return A(ot)},set location(Qr){ve(ot,Qr,!0)},get marker(){return A(De)},set marker(Qr){ve(De,Qr,!0)}})};et(It,Ur=>{A(ot)&&A(y)=="isochrones"&&Ur(hn)})}K(ye,We)};et(Oe,ye=>{A(E)&&ye(He)})}K(dt,at)},$$slots:{default:!0}}),Ut()}export{TG as component};
